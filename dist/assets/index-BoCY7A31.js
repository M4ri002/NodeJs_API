import"v-calendar/style.css";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const T of document.querySelectorAll('link[rel="modulepreload"]'))y(T);new MutationObserver(T=>{for(const M of T)if(M.type==="childList")for(const C of M.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&y(C)}).observe(document,{childList:!0,subtree:!0});function p(T){const M={};return T.integrity&&(M.integrity=T.integrity),T.referrerPolicy&&(M.referrerPolicy=T.referrerPolicy),T.crossOrigin==="use-credentials"?M.credentials="include":T.crossOrigin==="anonymous"?M.credentials="omit":M.credentials="same-origin",M}function y(T){if(T.ep)return;T.ep=!0;const M=p(T);fetch(T.href,M)}})();/**
* @vue/shared v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Px(i,c){const p=new Set(i.split(","));return c?y=>p.has(y.toLowerCase()):y=>p.has(y)}const pi={},$h=[],io=()=>{},Dk=()=>!1,Kg=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&(i.charCodeAt(2)>122||i.charCodeAt(2)<97),Dx=i=>i.startsWith("onUpdate:"),qi=Object.assign,Lx=(i,c)=>{const p=i.indexOf(c);p>-1&&i.splice(p,1)},Lk=Object.prototype.hasOwnProperty,Nn=(i,c)=>Lk.call(i,c),Xr=Array.isArray,Uh=i=>tm(i)==="[object Map]",sd=i=>tm(i)==="[object Set]",jS=i=>tm(i)==="[object Date]",xn=i=>typeof i=="function",Ii=i=>typeof i=="string",lc=i=>typeof i=="symbol",oi=i=>i!==null&&typeof i=="object",PA=i=>(oi(i)||xn(i))&&xn(i.then)&&xn(i.catch),DA=Object.prototype.toString,tm=i=>DA.call(i),Rk=i=>tm(i).slice(8,-1),LA=i=>tm(i)==="[object Object]",Rx=i=>Ii(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,Pp=Px(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Jg=i=>{const c=Object.create(null);return p=>c[p]||(c[p]=i(p))},kk=/-(\w)/g,_a=Jg(i=>i.replace(kk,(c,p)=>p?p.toUpperCase():"")),Ok=/\B([A-Z])/g,Iu=Jg(i=>i.replace(Ok,"-$1").toLowerCase()),Qg=Jg(i=>i.charAt(0).toUpperCase()+i.slice(1)),mg=Jg(i=>i?`on${Qg(i)}`:""),cc=(i,c)=>!Object.is(i,c),_g=(i,c)=>{for(let p=0;p<i.length;p++)i[p](c)},Dg=(i,c,p)=>{Object.defineProperty(i,c,{configurable:!0,enumerable:!1,value:p})},Vp=i=>{const c=parseFloat(i);return isNaN(c)?i:c},zk=i=>{const c=Ii(i)?Number(i):NaN;return isNaN(c)?i:c};let GS;const RA=()=>GS||(GS=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Ya(i){if(Xr(i)){const c={};for(let p=0;p<i.length;p++){const y=i[p],T=Ii(y)?Vk(y):Ya(y);if(T)for(const M in T)c[M]=T[M]}return c}else if(Ii(i)||oi(i))return i}const Fk=/;(?![^(]*\))/g,Bk=/:([^]+)/,Nk=/\/\*[^]*?\*\//g;function Vk(i){const c={};return i.replace(Nk,"").split(Fk).forEach(p=>{if(p){const y=p.split(Bk);y.length>1&&(c[y[0].trim()]=y[1].trim())}}),c}function Rn(i){let c="";if(Ii(i))c=i;else if(Xr(i))for(let p=0;p<i.length;p++){const y=Rn(i[p]);y&&(c+=y+" ")}else if(oi(i))for(const p in i)i[p]&&(c+=p+" ");return c.trim()}function Dp(i){if(!i)return null;let{class:c,style:p}=i;return c&&!Ii(c)&&(i.class=Rn(c)),p&&(i.style=Ya(p)),i}const $k="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Uk=Px($k);function kA(i){return!!i||i===""}function jk(i,c){if(i.length!==c.length)return!1;let p=!0;for(let y=0;p&&y<i.length;y++)p=rm(i[y],c[y]);return p}function rm(i,c){if(i===c)return!0;let p=jS(i),y=jS(c);if(p||y)return p&&y?i.getTime()===c.getTime():!1;if(p=lc(i),y=lc(c),p||y)return i===c;if(p=Xr(i),y=Xr(c),p||y)return p&&y?jk(i,c):!1;if(p=oi(i),y=oi(c),p||y){if(!p||!y)return!1;const T=Object.keys(i).length,M=Object.keys(c).length;if(T!==M)return!1;for(const C in i){const R=i.hasOwnProperty(C),o=c.hasOwnProperty(C);if(R&&!o||!R&&o||!rm(i[C],c[C]))return!1}}return String(i)===String(c)}function kx(i,c){return i.findIndex(p=>rm(p,c))}const Mi=i=>Ii(i)?i:i==null?"":Xr(i)||oi(i)&&(i.toString===DA||!xn(i.toString))?JSON.stringify(i,OA,2):String(i),OA=(i,c)=>c&&c.__v_isRef?OA(i,c.value):Uh(c)?{[`Map(${c.size})`]:[...c.entries()].reduce((p,[y,T],M)=>(p[S0(y,M)+" =>"]=T,p),{})}:sd(c)?{[`Set(${c.size})`]:[...c.values()].map(p=>S0(p))}:lc(c)?S0(c):oi(c)&&!Xr(c)&&!LA(c)?String(c):c,S0=(i,c="")=>{var p;return lc(i)?`Symbol(${(p=i.description)!=null?p:c})`:i};/**
* @vue/reactivity v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Zs;class zA{constructor(c=!1){this.detached=c,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Zs,!c&&Zs&&(this.index=(Zs.scopes||(Zs.scopes=[])).push(this)-1)}get active(){return this._active}run(c){if(this._active){const p=Zs;try{return Zs=this,c()}finally{Zs=p}}}on(){Zs=this}off(){Zs=this.parent}stop(c){if(this._active){let p,y;for(p=0,y=this.effects.length;p<y;p++)this.effects[p].stop();for(p=0,y=this.cleanups.length;p<y;p++)this.cleanups[p]();if(this.scopes)for(p=0,y=this.scopes.length;p<y;p++)this.scopes[p].stop(!0);if(!this.detached&&this.parent&&!c){const T=this.parent.scopes.pop();T&&T!==this&&(this.parent.scopes[this.index]=T,T.index=this.index)}this.parent=void 0,this._active=!1}}}function FA(i){return new zA(i)}function Gk(i,c=Zs){c&&c.active&&c.effects.push(i)}function BA(){return Zs}function Hk(i){Zs&&Zs.cleanups.push(i)}let Tu;class Ox{constructor(c,p,y,T){this.fn=c,this.trigger=p,this.scheduler=y,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,Gk(this,T)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,Cu();for(let c=0;c<this._depsLength;c++){const p=this.deps[c];if(p.computed&&(qk(p.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),Pu()}return this._dirtyLevel>=4}set dirty(c){this._dirtyLevel=c?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let c=sc,p=Tu;try{return sc=!0,Tu=this,this._runnings++,HS(this),this.fn()}finally{qS(this),this._runnings--,Tu=p,sc=c}}stop(){var c;this.active&&(HS(this),qS(this),(c=this.onStop)==null||c.call(this),this.active=!1)}}function qk(i){return i.value}function HS(i){i._trackId++,i._depsLength=0}function qS(i){if(i.deps.length>i._depsLength){for(let c=i._depsLength;c<i.deps.length;c++)NA(i.deps[c],i);i.deps.length=i._depsLength}}function NA(i,c){const p=i.get(c);p!==void 0&&c._trackId!==p&&(i.delete(c),i.size===0&&i.cleanup())}let sc=!0,W0=0;const VA=[];function Cu(){VA.push(sc),sc=!1}function Pu(){const i=VA.pop();sc=i===void 0?!0:i}function zx(){W0++}function Fx(){for(W0--;!W0&&Y0.length;)Y0.shift()()}function $A(i,c,p){if(c.get(i)!==i._trackId){c.set(i,i._trackId);const y=i.deps[i._depsLength];y!==c?(y&&NA(y,i),i.deps[i._depsLength++]=c):i._depsLength++}}const Y0=[];function UA(i,c,p){zx();for(const y of i.keys()){let T;y._dirtyLevel<c&&(T??(T=i.get(y)===y._trackId))&&(y._shouldSchedule||(y._shouldSchedule=y._dirtyLevel===0),y._dirtyLevel=c),y._shouldSchedule&&(T??(T=i.get(y)===y._trackId))&&(y.trigger(),(!y._runnings||y.allowRecurse)&&y._dirtyLevel!==2&&(y._shouldSchedule=!1,y.scheduler&&Y0.push(y.scheduler)))}Fx()}const jA=(i,c)=>{const p=new Map;return p.cleanup=i,p.computed=c,p},Lg=new WeakMap,Su=Symbol(""),Z0=Symbol("");function Os(i,c,p){if(sc&&Tu){let y=Lg.get(i);y||Lg.set(i,y=new Map);let T=y.get(p);T||y.set(p,T=jA(()=>y.delete(p))),$A(Tu,T)}}function Za(i,c,p,y,T,M){const C=Lg.get(i);if(!C)return;let R=[];if(c==="clear")R=[...C.values()];else if(p==="length"&&Xr(i)){const o=Number(y);C.forEach((B,$)=>{($==="length"||!lc($)&&$>=o)&&R.push(B)})}else switch(p!==void 0&&R.push(C.get(p)),c){case"add":Xr(i)?Rx(p)&&R.push(C.get("length")):(R.push(C.get(Su)),Uh(i)&&R.push(C.get(Z0)));break;case"delete":Xr(i)||(R.push(C.get(Su)),Uh(i)&&R.push(C.get(Z0)));break;case"set":Uh(i)&&R.push(C.get(Su));break}zx();for(const o of R)o&&UA(o,4);Fx()}function Wk(i,c){var p;return(p=Lg.get(i))==null?void 0:p.get(c)}const Yk=Px("__proto__,__v_isRef,__isVue"),GA=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter(lc)),WS=Zk();function Zk(){const i={};return["includes","indexOf","lastIndexOf"].forEach(c=>{i[c]=function(...p){const y=Fn(this);for(let M=0,C=this.length;M<C;M++)Os(y,"get",M+"");const T=y[c](...p);return T===-1||T===!1?y[c](...p.map(Fn)):T}}),["push","pop","shift","unshift","splice"].forEach(c=>{i[c]=function(...p){Cu(),zx();const y=Fn(this)[c].apply(this,p);return Fx(),Pu(),y}}),i}function Xk(i){const c=Fn(this);return Os(c,"has",i),c.hasOwnProperty(i)}class HA{constructor(c=!1,p=!1){this._isReadonly=c,this._isShallow=p}get(c,p,y){const T=this._isReadonly,M=this._isShallow;if(p==="__v_isReactive")return!T;if(p==="__v_isReadonly")return T;if(p==="__v_isShallow")return M;if(p==="__v_raw")return y===(T?M?cO:ZA:M?YA:WA).get(c)||Object.getPrototypeOf(c)===Object.getPrototypeOf(y)?c:void 0;const C=Xr(c);if(!T){if(C&&Nn(WS,p))return Reflect.get(WS,p,y);if(p==="hasOwnProperty")return Xk}const R=Reflect.get(c,p,y);return(lc(p)?GA.has(p):Yk(p))||(T||Os(c,"get",p),M)?R:ui(R)?C&&Rx(p)?R:R.value:oi(R)?T?KA(R):Xs(R):R}}class qA extends HA{constructor(c=!1){super(!1,c)}set(c,p,y,T){let M=c[p];if(!this._isShallow){const o=Yh(M);if(!Rg(y)&&!Yh(y)&&(M=Fn(M),y=Fn(y)),!Xr(c)&&ui(M)&&!ui(y))return o?!1:(M.value=y,!0)}const C=Xr(c)&&Rx(p)?Number(p)<c.length:Nn(c,p),R=Reflect.set(c,p,y,T);return c===Fn(T)&&(C?cc(y,M)&&Za(c,"set",p,y):Za(c,"add",p,y)),R}deleteProperty(c,p){const y=Nn(c,p);c[p];const T=Reflect.deleteProperty(c,p);return T&&y&&Za(c,"delete",p,void 0),T}has(c,p){const y=Reflect.has(c,p);return(!lc(p)||!GA.has(p))&&Os(c,"has",p),y}ownKeys(c){return Os(c,"iterate",Xr(c)?"length":Su),Reflect.ownKeys(c)}}class Kk extends HA{constructor(c=!1){super(!0,c)}set(c,p){return!0}deleteProperty(c,p){return!0}}const Jk=new qA,Qk=new Kk,eO=new qA(!0),Bx=i=>i,ey=i=>Reflect.getPrototypeOf(i);function ig(i,c,p=!1,y=!1){i=i.__v_raw;const T=Fn(i),M=Fn(c);p||(cc(c,M)&&Os(T,"get",c),Os(T,"get",M));const{has:C}=ey(T),R=y?Bx:p?$x:$p;if(C.call(T,c))return R(i.get(c));if(C.call(T,M))return R(i.get(M));i!==T&&i.get(c)}function sg(i,c=!1){const p=this.__v_raw,y=Fn(p),T=Fn(i);return c||(cc(i,T)&&Os(y,"has",i),Os(y,"has",T)),i===T?p.has(i):p.has(i)||p.has(T)}function og(i,c=!1){return i=i.__v_raw,!c&&Os(Fn(i),"iterate",Su),Reflect.get(i,"size",i)}function YS(i){i=Fn(i);const c=Fn(this);return ey(c).has.call(c,i)||(c.add(i),Za(c,"add",i,i)),this}function ZS(i,c){c=Fn(c);const p=Fn(this),{has:y,get:T}=ey(p);let M=y.call(p,i);M||(i=Fn(i),M=y.call(p,i));const C=T.call(p,i);return p.set(i,c),M?cc(c,C)&&Za(p,"set",i,c):Za(p,"add",i,c),this}function XS(i){const c=Fn(this),{has:p,get:y}=ey(c);let T=p.call(c,i);T||(i=Fn(i),T=p.call(c,i)),y&&y.call(c,i);const M=c.delete(i);return T&&Za(c,"delete",i,void 0),M}function KS(){const i=Fn(this),c=i.size!==0,p=i.clear();return c&&Za(i,"clear",void 0,void 0),p}function ag(i,c){return function(y,T){const M=this,C=M.__v_raw,R=Fn(C),o=c?Bx:i?$x:$p;return!i&&Os(R,"iterate",Su),C.forEach((B,$)=>y.call(T,o(B),o($),M))}}function lg(i,c,p){return function(...y){const T=this.__v_raw,M=Fn(T),C=Uh(M),R=i==="entries"||i===Symbol.iterator&&C,o=i==="keys"&&C,B=T[i](...y),$=p?Bx:c?$x:$p;return!c&&Os(M,"iterate",o?Z0:Su),{next(){const{value:H,done:ie}=B.next();return ie?{value:H,done:ie}:{value:R?[$(H[0]),$(H[1])]:$(H),done:ie}},[Symbol.iterator](){return this}}}}function Gl(i){return function(...c){return i==="delete"?!1:i==="clear"?void 0:this}}function tO(){const i={get(M){return ig(this,M)},get size(){return og(this)},has:sg,add:YS,set:ZS,delete:XS,clear:KS,forEach:ag(!1,!1)},c={get(M){return ig(this,M,!1,!0)},get size(){return og(this)},has:sg,add:YS,set:ZS,delete:XS,clear:KS,forEach:ag(!1,!0)},p={get(M){return ig(this,M,!0)},get size(){return og(this,!0)},has(M){return sg.call(this,M,!0)},add:Gl("add"),set:Gl("set"),delete:Gl("delete"),clear:Gl("clear"),forEach:ag(!0,!1)},y={get(M){return ig(this,M,!0,!0)},get size(){return og(this,!0)},has(M){return sg.call(this,M,!0)},add:Gl("add"),set:Gl("set"),delete:Gl("delete"),clear:Gl("clear"),forEach:ag(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(M=>{i[M]=lg(M,!1,!1),p[M]=lg(M,!0,!1),c[M]=lg(M,!1,!0),y[M]=lg(M,!0,!0)}),[i,p,c,y]}const[rO,nO,iO,sO]=tO();function Nx(i,c){const p=c?i?sO:iO:i?nO:rO;return(y,T,M)=>T==="__v_isReactive"?!i:T==="__v_isReadonly"?i:T==="__v_raw"?y:Reflect.get(Nn(p,T)&&T in y?p:y,T,M)}const oO={get:Nx(!1,!1)},aO={get:Nx(!1,!0)},lO={get:Nx(!0,!1)},WA=new WeakMap,YA=new WeakMap,ZA=new WeakMap,cO=new WeakMap;function uO(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function hO(i){return i.__v_skip||!Object.isExtensible(i)?0:uO(Rk(i))}function Xs(i){return Yh(i)?i:Vx(i,!1,Jk,oO,WA)}function XA(i){return Vx(i,!1,eO,aO,YA)}function KA(i){return Vx(i,!0,Qk,lO,ZA)}function Vx(i,c,p,y,T){if(!oi(i)||i.__v_raw&&!(c&&i.__v_isReactive))return i;const M=T.get(i);if(M)return M;const C=hO(i);if(C===0)return i;const R=new Proxy(i,C===2?y:p);return T.set(i,R),R}function oc(i){return Yh(i)?oc(i.__v_raw):!!(i&&i.__v_isReactive)}function Yh(i){return!!(i&&i.__v_isReadonly)}function Rg(i){return!!(i&&i.__v_isShallow)}function JA(i){return oc(i)||Yh(i)}function Fn(i){const c=i&&i.__v_raw;return c?Fn(c):i}function ty(i){return Object.isExtensible(i)&&Dg(i,"__v_skip",!0),i}const $p=i=>oi(i)?Xs(i):i,$x=i=>oi(i)?KA(i):i;class QA{constructor(c,p,y,T){this.getter=c,this._setter=p,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new Ox(()=>c(this._value),()=>gg(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!T,this.__v_isReadonly=y}get value(){const c=Fn(this);return(!c._cacheable||c.effect.dirty)&&cc(c._value,c._value=c.effect.run())&&gg(c,4),eI(c),c.effect._dirtyLevel>=2&&gg(c,2),c._value}set value(c){this._setter(c)}get _dirty(){return this.effect.dirty}set _dirty(c){this.effect.dirty=c}}function dO(i,c,p=!1){let y,T;const M=xn(i);return M?(y=i,T=io):(y=i.get,T=i.set),new QA(y,T,M||!T,p)}function eI(i){var c;sc&&Tu&&(i=Fn(i),$A(Tu,(c=i.dep)!=null?c:i.dep=jA(()=>i.dep=void 0,i instanceof QA?i:void 0)))}function gg(i,c=4,p){i=Fn(i);const y=i.dep;y&&UA(y,c)}function ui(i){return!!(i&&i.__v_isRef===!0)}function Zr(i){return tI(i,!1)}function fO(i){return tI(i,!0)}function tI(i,c){return ui(i)?i:new pO(i,c)}class pO{constructor(c,p){this.__v_isShallow=p,this.dep=void 0,this.__v_isRef=!0,this._rawValue=p?c:Fn(c),this._value=p?c:$p(c)}get value(){return eI(this),this._value}set value(c){const p=this.__v_isShallow||Rg(c)||Yh(c);c=p?c:Fn(c),cc(c,this._rawValue)&&(this._rawValue=c,this._value=p?c:$p(c),gg(this,4))}}function yt(i){return ui(i)?i.value:i}const mO={get:(i,c,p)=>yt(Reflect.get(i,c,p)),set:(i,c,p,y)=>{const T=i[c];return ui(T)&&!ui(p)?(T.value=p,!0):Reflect.set(i,c,p,y)}};function rI(i){return oc(i)?i:new Proxy(i,mO)}function nI(i){const c=Xr(i)?new Array(i.length):{};for(const p in i)c[p]=iI(i,p);return c}class _O{constructor(c,p,y){this._object=c,this._key=p,this._defaultValue=y,this.__v_isRef=!0}get value(){const c=this._object[this._key];return c===void 0?this._defaultValue:c}set value(c){this._object[this._key]=c}get dep(){return Wk(Fn(this._object),this._key)}}class gO{constructor(c){this._getter=c,this.__v_isRef=!0,this.__v_isReadonly=!0}get value(){return this._getter()}}function yg(i,c,p){return ui(i)?i:xn(i)?new gO(i):oi(i)&&arguments.length>1?iI(i,c,p):Zr(i)}function iI(i,c,p){const y=i[c];return ui(y)?y:new _O(i,c,p)}/**
* @vue/runtime-core v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ac(i,c,p,y){try{return y?i(...y):i()}catch(T){ry(T,c,p)}}function oo(i,c,p,y){if(xn(i)){const M=ac(i,c,p,y);return M&&PA(M)&&M.catch(C=>{ry(C,c,p)}),M}const T=[];for(let M=0;M<i.length;M++)T.push(oo(i[M],c,p,y));return T}function ry(i,c,p,y=!0){const T=c?c.vnode:null;if(c){let M=c.parent;const C=c.proxy,R=`https://vuejs.org/error-reference/#runtime-${p}`;for(;M;){const B=M.ec;if(B){for(let $=0;$<B.length;$++)if(B[$](i,C,R)===!1)return}M=M.parent}const o=c.appContext.config.errorHandler;if(o){ac(o,null,10,[i,C,R]);return}}yO(i,p,T,y)}function yO(i,c,p,y=!0){console.error(i)}let Up=!1,X0=!1;const ds=[];let ha=0;const jh=[];let Kl=null,vu=0;const sI=Promise.resolve();let Ux=null;function qa(i){const c=Ux||sI;return i?c.then(this?i.bind(this):i):c}function vO(i){let c=ha+1,p=ds.length;for(;c<p;){const y=c+p>>>1,T=ds[y],M=jp(T);M<i||M===i&&T.pre?c=y+1:p=y}return c}function jx(i){(!ds.length||!ds.includes(i,Up&&i.allowRecurse?ha+1:ha))&&(i.id==null?ds.push(i):ds.splice(vO(i.id),0,i),oI())}function oI(){!Up&&!X0&&(X0=!0,Ux=sI.then(lI))}function xO(i){const c=ds.indexOf(i);c>ha&&ds.splice(c,1)}function bO(i){Xr(i)?jh.push(...i):(!Kl||!Kl.includes(i,i.allowRecurse?vu+1:vu))&&jh.push(i),oI()}function JS(i,c,p=Up?ha+1:0){for(;p<ds.length;p++){const y=ds[p];if(y&&y.pre){if(i&&y.id!==i.uid)continue;ds.splice(p,1),p--,y()}}}function aI(i){if(jh.length){const c=[...new Set(jh)].sort((p,y)=>jp(p)-jp(y));if(jh.length=0,Kl){Kl.push(...c);return}for(Kl=c,vu=0;vu<Kl.length;vu++)Kl[vu]();Kl=null,vu=0}}const jp=i=>i.id==null?1/0:i.id,wO=(i,c)=>{const p=jp(i)-jp(c);if(p===0){if(i.pre&&!c.pre)return-1;if(c.pre&&!i.pre)return 1}return p};function lI(i){X0=!1,Up=!0,ds.sort(wO);try{for(ha=0;ha<ds.length;ha++){const c=ds[ha];c&&c.active!==!1&&ac(c,null,14)}}finally{ha=0,ds.length=0,aI(),Up=!1,Ux=null,(ds.length||jh.length)&&lI()}}function TO(i,c,...p){if(i.isUnmounted)return;const y=i.vnode.props||pi;let T=p;const M=c.startsWith("update:"),C=M&&c.slice(7);if(C&&C in y){const $=`${C==="modelValue"?"model":C}Modifiers`,{number:H,trim:ie}=y[$]||pi;ie&&(T=p.map(oe=>Ii(oe)?oe.trim():oe)),H&&(T=p.map(Vp))}let R,o=y[R=mg(c)]||y[R=mg(_a(c))];!o&&M&&(o=y[R=mg(Iu(c))]),o&&oo(o,i,6,T);const B=y[R+"Once"];if(B){if(!i.emitted)i.emitted={};else if(i.emitted[R])return;i.emitted[R]=!0,oo(B,i,6,T)}}function cI(i,c,p=!1){const y=c.emitsCache,T=y.get(i);if(T!==void 0)return T;const M=i.emits;let C={},R=!1;if(!xn(i)){const o=B=>{const $=cI(B,c,!0);$&&(R=!0,qi(C,$))};!p&&c.mixins.length&&c.mixins.forEach(o),i.extends&&o(i.extends),i.mixins&&i.mixins.forEach(o)}return!M&&!R?(oi(i)&&y.set(i,null),null):(Xr(M)?M.forEach(o=>C[o]=null):qi(C,M),oi(i)&&y.set(i,C),C)}function ny(i,c){return!i||!Kg(c)?!1:(c=c.slice(2).replace(/Once$/,""),Nn(i,c[0].toLowerCase()+c.slice(1))||Nn(i,Iu(c))||Nn(i,c))}let ji=null,iy=null;function kg(i){const c=ji;return ji=i,iy=i&&i.type.__scopeId||null,c}function fc(i){iy=i}function pc(){iy=null}function Ai(i,c=ji,p){if(!c||i._n)return i;const y=(...T)=>{y._d&&uM(-1);const M=kg(c);let C;try{C=i(...T)}finally{kg(M),y._d&&uM(1)}return C};return y._n=!0,y._c=!0,y._d=!0,y}function M0(i){const{type:c,vnode:p,proxy:y,withProxy:T,props:M,propsOptions:[C],slots:R,attrs:o,emit:B,render:$,renderCache:H,data:ie,setupState:oe,ctx:_e,inheritAttrs:Me}=i;let Re,Ee;const mt=kg(i);try{if(p.shapeFlag&4){const dt=T||y,ut=dt;Re=ua($.call(ut,dt,H,M,oe,ie,_e)),Ee=o}else{const dt=c;Re=ua(dt.length>1?dt(M,{attrs:o,slots:R,emit:B}):dt(M,null)),Ee=c.props?o:SO(o)}}catch(dt){kp.length=0,ry(dt,i,1),Re=_r(ao)}let gt=Re;if(Ee&&Me!==!1){const dt=Object.keys(Ee),{shapeFlag:ut}=gt;dt.length&&ut&7&&(C&&dt.some(Dx)&&(Ee=MO(Ee,C)),gt=hc(gt,Ee))}return p.dirs&&(gt=hc(gt),gt.dirs=gt.dirs?gt.dirs.concat(p.dirs):p.dirs),p.transition&&(gt.transition=p.transition),Re=gt,kg(mt),Re}const SO=i=>{let c;for(const p in i)(p==="class"||p==="style"||Kg(p))&&((c||(c={}))[p]=i[p]);return c},MO=(i,c)=>{const p={};for(const y in i)(!Dx(y)||!(y.slice(9)in c))&&(p[y]=i[y]);return p};function EO(i,c,p){const{props:y,children:T,component:M}=i,{props:C,children:R,patchFlag:o}=c,B=M.emitsOptions;if(c.dirs||c.transition)return!0;if(p&&o>=0){if(o&1024)return!0;if(o&16)return y?QS(y,C,B):!!C;if(o&8){const $=c.dynamicProps;for(let H=0;H<$.length;H++){const ie=$[H];if(C[ie]!==y[ie]&&!ny(B,ie))return!0}}}else return(T||R)&&(!R||!R.$stable)?!0:y===C?!1:y?C?QS(y,C,B):!0:!!C;return!1}function QS(i,c,p){const y=Object.keys(c);if(y.length!==Object.keys(i).length)return!0;for(let T=0;T<y.length;T++){const M=y[T];if(c[M]!==i[M]&&!ny(p,M))return!0}return!1}function AO({vnode:i,parent:c},p){for(;c;){const y=c.subTree;if(y.suspense&&y.suspense.activeBranch===i&&(y.el=i.el),y===i)(i=c.vnode).el=p,c=c.parent;else break}}const Gx="components",IO="directives";function ca(i,c){return Hx(Gx,i,!0,c)||i}const uI=Symbol.for("v-ndc");function hI(i){return Ii(i)?Hx(Gx,i,!1)||i:i||uI}function CO(i){return Hx(IO,i)}function Hx(i,c,p=!0,y=!1){const T=ji||Zi;if(T){const M=T.type;if(i===Gx){const R=Sz(M,!1);if(R&&(R===c||R===_a(c)||R===Qg(_a(c))))return M}const C=eM(T[i]||M[i],c)||eM(T.appContext[i],c);return!C&&y?M:C}}function eM(i,c){return i&&(i[c]||i[_a(c)]||i[Qg(_a(c))])}const PO=i=>i.__isSuspense;function DO(i,c){c&&c.pendingBranch?Xr(i)?c.effects.push(...i):c.effects.push(i):bO(i)}const LO=Symbol.for("v-scx"),RO=()=>fs(LO);function dI(i,c){return qx(i,null,c)}const cg={};function Oi(i,c,p){return qx(i,c,p)}function qx(i,c,{immediate:p,deep:y,flush:T,once:M,onTrack:C,onTrigger:R}=pi){if(c&&M){const ht=c;c=(...lt)=>{ht(...lt),ut()}}const o=Zi,B=ht=>y===!0?ht:bu(ht,y===!1?1:void 0);let $,H=!1,ie=!1;if(ui(i)?($=()=>i.value,H=Rg(i)):oc(i)?($=()=>B(i),H=!0):Xr(i)?(ie=!0,H=i.some(ht=>oc(ht)||Rg(ht)),$=()=>i.map(ht=>{if(ui(ht))return ht.value;if(oc(ht))return B(ht);if(xn(ht))return ac(ht,o,2)})):xn(i)?c?$=()=>ac(i,o,2):$=()=>(oe&&oe(),oo(i,o,3,[_e])):$=io,c&&y){const ht=$;$=()=>bu(ht())}let oe,_e=ht=>{oe=gt.onStop=()=>{ac(ht,o,4),oe=gt.onStop=void 0}},Me;if(cy)if(_e=io,c?p&&oo(c,o,3,[$(),ie?[]:void 0,_e]):$(),T==="sync"){const ht=RO();Me=ht.__watcherHandles||(ht.__watcherHandles=[])}else return io;let Re=ie?new Array(i.length).fill(cg):cg;const Ee=()=>{if(!(!gt.active||!gt.dirty))if(c){const ht=gt.run();(y||H||(ie?ht.some((lt,Qe)=>cc(lt,Re[Qe])):cc(ht,Re)))&&(oe&&oe(),oo(c,o,3,[ht,Re===cg?void 0:ie&&Re[0]===cg?[]:Re,_e]),Re=ht)}else gt.run()};Ee.allowRecurse=!!c;let mt;T==="sync"?mt=Ee:T==="post"?mt=()=>Ls(Ee,o&&o.suspense):(Ee.pre=!0,o&&(Ee.id=o.uid),mt=()=>jx(Ee));const gt=new Ox($,io,mt),dt=BA(),ut=()=>{gt.stop(),dt&&Lx(dt.effects,gt)};return c?p?Ee():Re=gt.run():T==="post"?Ls(gt.run.bind(gt),o&&o.suspense):gt.run(),Me&&Me.push(ut),ut}function kO(i,c,p){const y=this.proxy,T=Ii(i)?i.includes(".")?fI(y,i):()=>y[i]:i.bind(y,y);let M;xn(c)?M=c:(M=c.handler,p=c);const C=sm(this),R=qx(T,M.bind(y),p);return C(),R}function fI(i,c){const p=c.split(".");return()=>{let y=i;for(let T=0;T<p.length&&y;T++)y=y[p[T]];return y}}function bu(i,c,p=0,y){if(!oi(i)||i.__v_skip)return i;if(c&&c>0){if(p>=c)return i;p++}if(y=y||new Set,y.has(i))return i;if(y.add(i),ui(i))bu(i.value,c,p,y);else if(Xr(i))for(let T=0;T<i.length;T++)bu(i[T],c,p,y);else if(sd(i)||Uh(i))i.forEach(T=>{bu(T,c,p,y)});else if(LA(i))for(const T in i)bu(i[T],c,p,y);return i}function uc(i,c){if(ji===null)return i;const p=uy(ji)||ji.proxy,y=i.dirs||(i.dirs=[]);for(let T=0;T<c.length;T++){let[M,C,R,o=pi]=c[T];M&&(xn(M)&&(M={mounted:M,updated:M}),M.deep&&bu(C),y.push({dir:M,instance:p,value:C,oldValue:void 0,arg:R,modifiers:o}))}return i}function pu(i,c,p,y){const T=i.dirs,M=c&&c.dirs;for(let C=0;C<T.length;C++){const R=T[C];M&&(R.oldValue=M[C].value);let o=R.dir[y];o&&(Cu(),oo(o,p,8,[i.el,R,i,c]),Pu())}}const Jl=Symbol("_leaveCb"),ug=Symbol("_enterCb");function OO(){const i={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return ya(()=>{i.isMounted=!0}),yI(()=>{i.isUnmounting=!0}),i}const no=[Function,Array],pI={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:no,onEnter:no,onAfterEnter:no,onEnterCancelled:no,onBeforeLeave:no,onLeave:no,onAfterLeave:no,onLeaveCancelled:no,onBeforeAppear:no,onAppear:no,onAfterAppear:no,onAppearCancelled:no},zO={name:"BaseTransition",props:pI,setup(i,{slots:c}){const p=LI(),y=OO();return()=>{const T=c.default&&_I(c.default(),!0);if(!T||!T.length)return;let M=T[0];if(T.length>1){for(const ie of T)if(ie.type!==ao){M=ie;break}}const C=Fn(i),{mode:R}=C;if(y.isLeaving)return E0(M);const o=tM(M);if(!o)return E0(M);const B=K0(o,C,y,p);J0(o,B);const $=p.subTree,H=$&&tM($);if(H&&H.type!==ao&&!xu(o,H)){const ie=K0(H,C,y,p);if(J0(H,ie),R==="out-in")return y.isLeaving=!0,ie.afterLeave=()=>{y.isLeaving=!1,p.update.active!==!1&&(p.effect.dirty=!0,p.update())},E0(M);R==="in-out"&&o.type!==ao&&(ie.delayLeave=(oe,_e,Me)=>{const Re=mI(y,H);Re[String(H.key)]=H,oe[Jl]=()=>{_e(),oe[Jl]=void 0,delete B.delayedLeave},B.delayedLeave=Me})}return M}}},FO=zO;function mI(i,c){const{leavingVNodes:p}=i;let y=p.get(c.type);return y||(y=Object.create(null),p.set(c.type,y)),y}function K0(i,c,p,y){const{appear:T,mode:M,persisted:C=!1,onBeforeEnter:R,onEnter:o,onAfterEnter:B,onEnterCancelled:$,onBeforeLeave:H,onLeave:ie,onAfterLeave:oe,onLeaveCancelled:_e,onBeforeAppear:Me,onAppear:Re,onAfterAppear:Ee,onAppearCancelled:mt}=c,gt=String(i.key),dt=mI(p,i),ut=(Qe,Se)=>{Qe&&oo(Qe,y,9,Se)},ht=(Qe,Se)=>{const Xt=Se[1];ut(Qe,Se),Xr(Qe)?Qe.every(xr=>xr.length<=1)&&Xt():Qe.length<=1&&Xt()},lt={mode:M,persisted:C,beforeEnter(Qe){let Se=R;if(!p.isMounted)if(T)Se=Me||R;else return;Qe[Jl]&&Qe[Jl](!0);const Xt=dt[gt];Xt&&xu(i,Xt)&&Xt.el[Jl]&&Xt.el[Jl](),ut(Se,[Qe])},enter(Qe){let Se=o,Xt=B,xr=$;if(!p.isMounted)if(T)Se=Re||o,Xt=Ee||B,xr=mt||$;else return;let Ve=!1;const jt=Qe[ug]=Ur=>{Ve||(Ve=!0,Ur?ut(xr,[Qe]):ut(Xt,[Qe]),lt.delayedLeave&&lt.delayedLeave(),Qe[ug]=void 0)};Se?ht(Se,[Qe,jt]):jt()},leave(Qe,Se){const Xt=String(i.key);if(Qe[ug]&&Qe[ug](!0),p.isUnmounting)return Se();ut(H,[Qe]);let xr=!1;const Ve=Qe[Jl]=jt=>{xr||(xr=!0,Se(),jt?ut(_e,[Qe]):ut(oe,[Qe]),Qe[Jl]=void 0,dt[Xt]===i&&delete dt[Xt])};dt[Xt]=i,ie?ht(ie,[Qe,Ve]):Ve()},clone(Qe){return K0(Qe,c,p,y)}};return lt}function E0(i){if(sy(i))return i=hc(i),i.children=null,i}function tM(i){return sy(i)?i.children?i.children[0]:void 0:i}function J0(i,c){i.shapeFlag&6&&i.component?J0(i.component.subTree,c):i.shapeFlag&128?(i.ssContent.transition=c.clone(i.ssContent),i.ssFallback.transition=c.clone(i.ssFallback)):i.transition=c}function _I(i,c=!1,p){let y=[],T=0;for(let M=0;M<i.length;M++){let C=i[M];const R=p==null?C.key:String(p)+String(C.key!=null?C.key:M);C.type===Mn?(C.patchFlag&128&&T++,y=y.concat(_I(C.children,c,R))):(c||C.type!==ao)&&y.push(R!=null?hc(C,{key:R}):C)}if(T>1)for(let M=0;M<y.length;M++)y[M].patchFlag=-2;return y}/*! #__NO_SIDE_EFFECTS__ */function Gi(i,c){return xn(i)?qi({name:i.name},c,{setup:i}):i}const Lp=i=>!!i.type.__asyncLoader,sy=i=>i.type.__isKeepAlive;function BO(i,c){gI(i,"a",c)}function NO(i,c){gI(i,"da",c)}function gI(i,c,p=Zi){const y=i.__wdc||(i.__wdc=()=>{let T=p;for(;T;){if(T.isDeactivated)return;T=T.parent}return i()});if(oy(c,y,p),p){let T=p.parent;for(;T&&T.parent;)sy(T.parent.vnode)&&VO(y,c,p,T),T=T.parent}}function VO(i,c,p,y){const T=oy(c,i,y,!0);nm(()=>{Lx(y[c],T)},p)}function oy(i,c,p=Zi,y=!1){if(p){const T=p[i]||(p[i]=[]),M=c.__weh||(c.__weh=(...C)=>{if(p.isUnmounted)return;Cu();const R=sm(p),o=oo(c,p,i,C);return R(),Pu(),o});return y?T.unshift(M):T.push(M),M}}const rl=i=>(c,p=Zi)=>(!cy||i==="sp")&&oy(i,(...y)=>c(...y),p),$O=rl("bm"),ya=rl("m"),UO=rl("bu"),jO=rl("u"),yI=rl("bum"),nm=rl("um"),GO=rl("sp"),HO=rl("rtg"),qO=rl("rtc");function WO(i,c=Zi){oy("ec",i,c)}function Xi(i,c,p,y){let T;const M=p&&p[y];if(Xr(i)||Ii(i)){T=new Array(i.length);for(let C=0,R=i.length;C<R;C++)T[C]=c(i[C],C,void 0,M&&M[C])}else if(typeof i=="number"){T=new Array(i);for(let C=0;C<i;C++)T[C]=c(C+1,C,void 0,M&&M[C])}else if(oi(i))if(i[Symbol.iterator])T=Array.from(i,(C,R)=>c(C,R,void 0,M&&M[R]));else{const C=Object.keys(i);T=new Array(C.length);for(let R=0,o=C.length;R<o;R++){const B=C[R];T[R]=c(i[B],B,R,M&&M[R])}}else T=[];return p&&(p[y]=T),T}function od(i,c,p={},y,T){if(ji.isCE||ji.parent&&Lp(ji.parent)&&ji.parent.isCE)return c!=="default"&&(p.name=c),_r("slot",p,y&&y());let M=i[c];M&&M._c&&(M._d=!1),It();const C=M&&vI(M(p)),R=rs(Mn,{key:p.key||C&&C.key||`_${c}`},C||(y?y():[]),C&&i._===1?64:-2);return!T&&R.scopeId&&(R.slotScopeIds=[R.scopeId+"-s"]),M&&M._c&&(M._d=!0),R}function vI(i){return i.some(c=>zg(c)?!(c.type===ao||c.type===Mn&&!vI(c.children)):!0)?i:null}function xI(i,c){const p={};for(const y in i)p[c&&/[A-Z]/.test(y)?`on:${y}`:mg(y)]=i[y];return p}const Q0=i=>i?RI(i)?uy(i)||i.proxy:Q0(i.parent):null,Rp=qi(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>Q0(i.parent),$root:i=>Q0(i.root),$emit:i=>i.emit,$options:i=>Wx(i),$forceUpdate:i=>i.f||(i.f=()=>{i.effect.dirty=!0,jx(i.update)}),$nextTick:i=>i.n||(i.n=qa.bind(i.proxy)),$watch:i=>kO.bind(i)}),A0=(i,c)=>i!==pi&&!i.__isScriptSetup&&Nn(i,c),YO={get({_:i},c){const{ctx:p,setupState:y,data:T,props:M,accessCache:C,type:R,appContext:o}=i;let B;if(c[0]!=="$"){const oe=C[c];if(oe!==void 0)switch(oe){case 1:return y[c];case 2:return T[c];case 4:return p[c];case 3:return M[c]}else{if(A0(y,c))return C[c]=1,y[c];if(T!==pi&&Nn(T,c))return C[c]=2,T[c];if((B=i.propsOptions[0])&&Nn(B,c))return C[c]=3,M[c];if(p!==pi&&Nn(p,c))return C[c]=4,p[c];ex&&(C[c]=0)}}const $=Rp[c];let H,ie;if($)return c==="$attrs"&&Os(i,"get",c),$(i);if((H=R.__cssModules)&&(H=H[c]))return H;if(p!==pi&&Nn(p,c))return C[c]=4,p[c];if(ie=o.config.globalProperties,Nn(ie,c))return ie[c]},set({_:i},c,p){const{data:y,setupState:T,ctx:M}=i;return A0(T,c)?(T[c]=p,!0):y!==pi&&Nn(y,c)?(y[c]=p,!0):Nn(i.props,c)||c[0]==="$"&&c.slice(1)in i?!1:(M[c]=p,!0)},has({_:{data:i,setupState:c,accessCache:p,ctx:y,appContext:T,propsOptions:M}},C){let R;return!!p[C]||i!==pi&&Nn(i,C)||A0(c,C)||(R=M[0])&&Nn(R,C)||Nn(y,C)||Nn(Rp,C)||Nn(T.config.globalProperties,C)},defineProperty(i,c,p){return p.get!=null?i._.accessCache[c]=0:Nn(p,"value")&&this.set(i,c,p.value,null),Reflect.defineProperty(i,c,p)}};function ZO(){return XO().slots}function XO(){const i=LI();return i.setupContext||(i.setupContext=OI(i))}function rM(i){return Xr(i)?i.reduce((c,p)=>(c[p]=null,c),{}):i}let ex=!0;function KO(i){const c=Wx(i),p=i.proxy,y=i.ctx;ex=!1,c.beforeCreate&&nM(c.beforeCreate,i,"bc");const{data:T,computed:M,methods:C,watch:R,provide:o,inject:B,created:$,beforeMount:H,mounted:ie,beforeUpdate:oe,updated:_e,activated:Me,deactivated:Re,beforeDestroy:Ee,beforeUnmount:mt,destroyed:gt,unmounted:dt,render:ut,renderTracked:ht,renderTriggered:lt,errorCaptured:Qe,serverPrefetch:Se,expose:Xt,inheritAttrs:xr,components:Ve,directives:jt,filters:Ur}=c;if(B&&JO(B,y,null),C)for(const gr in C){const zt=C[gr];xn(zt)&&(y[gr]=zt.bind(p))}if(T){const gr=T.call(p,p);oi(gr)&&(i.data=Xs(gr))}if(ex=!0,M)for(const gr in M){const zt=M[gr],vn=xn(zt)?zt.bind(p,p):xn(zt.get)?zt.get.bind(p,p):io,Ft=!xn(zt)&&xn(zt.set)?zt.set.bind(p):io,zr=rt({get:vn,set:Ft});Object.defineProperty(y,gr,{enumerable:!0,configurable:!0,get:()=>zr.value,set:nr=>zr.value=nr})}if(R)for(const gr in R)bI(R[gr],y,p,gr);if(o){const gr=xn(o)?o.call(p):o;Reflect.ownKeys(gr).forEach(zt=>{Xa(zt,gr[zt])})}$&&nM($,i,"c");function ur(gr,zt){Xr(zt)?zt.forEach(vn=>gr(vn.bind(p))):zt&&gr(zt.bind(p))}if(ur($O,H),ur(ya,ie),ur(UO,oe),ur(jO,_e),ur(BO,Me),ur(NO,Re),ur(WO,Qe),ur(qO,ht),ur(HO,lt),ur(yI,mt),ur(nm,dt),ur(GO,Se),Xr(Xt))if(Xt.length){const gr=i.exposed||(i.exposed={});Xt.forEach(zt=>{Object.defineProperty(gr,zt,{get:()=>p[zt],set:vn=>p[zt]=vn})})}else i.exposed||(i.exposed={});ut&&i.render===io&&(i.render=ut),xr!=null&&(i.inheritAttrs=xr),Ve&&(i.components=Ve),jt&&(i.directives=jt)}function JO(i,c,p=io){Xr(i)&&(i=tx(i));for(const y in i){const T=i[y];let M;oi(T)?"default"in T?M=fs(T.from||y,T.default,!0):M=fs(T.from||y):M=fs(T),ui(M)?Object.defineProperty(c,y,{enumerable:!0,configurable:!0,get:()=>M.value,set:C=>M.value=C}):c[y]=M}}function nM(i,c,p){oo(Xr(i)?i.map(y=>y.bind(c.proxy)):i.bind(c.proxy),c,p)}function bI(i,c,p,y){const T=y.includes(".")?fI(p,y):()=>p[y];if(Ii(i)){const M=c[i];xn(M)&&Oi(T,M)}else if(xn(i))Oi(T,i.bind(p));else if(oi(i))if(Xr(i))i.forEach(M=>bI(M,c,p,y));else{const M=xn(i.handler)?i.handler.bind(p):c[i.handler];xn(M)&&Oi(T,M,i)}}function Wx(i){const c=i.type,{mixins:p,extends:y}=c,{mixins:T,optionsCache:M,config:{optionMergeStrategies:C}}=i.appContext,R=M.get(c);let o;return R?o=R:!T.length&&!p&&!y?o=c:(o={},T.length&&T.forEach(B=>Og(o,B,C,!0)),Og(o,c,C)),oi(c)&&M.set(c,o),o}function Og(i,c,p,y=!1){const{mixins:T,extends:M}=c;M&&Og(i,M,p,!0),T&&T.forEach(C=>Og(i,C,p,!0));for(const C in c)if(!(y&&C==="expose")){const R=QO[C]||p&&p[C];i[C]=R?R(i[C],c[C]):c[C]}return i}const QO={data:iM,props:sM,emits:sM,methods:Ap,computed:Ap,beforeCreate:xs,created:xs,beforeMount:xs,mounted:xs,beforeUpdate:xs,updated:xs,beforeDestroy:xs,beforeUnmount:xs,destroyed:xs,unmounted:xs,activated:xs,deactivated:xs,errorCaptured:xs,serverPrefetch:xs,components:Ap,directives:Ap,watch:tz,provide:iM,inject:ez};function iM(i,c){return c?i?function(){return qi(xn(i)?i.call(this,this):i,xn(c)?c.call(this,this):c)}:c:i}function ez(i,c){return Ap(tx(i),tx(c))}function tx(i){if(Xr(i)){const c={};for(let p=0;p<i.length;p++)c[i[p]]=i[p];return c}return i}function xs(i,c){return i?[...new Set([].concat(i,c))]:c}function Ap(i,c){return i?qi(Object.create(null),i,c):c}function sM(i,c){return i?Xr(i)&&Xr(c)?[...new Set([...i,...c])]:qi(Object.create(null),rM(i),rM(c??{})):c}function tz(i,c){if(!i)return c;if(!c)return i;const p=qi(Object.create(null),i);for(const y in c)p[y]=xs(i[y],c[y]);return p}function wI(){return{app:null,config:{isNativeTag:Dk,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let rz=0;function nz(i,c){return function(y,T=null){xn(y)||(y=qi({},y)),T!=null&&!oi(T)&&(T=null);const M=wI(),C=new WeakSet;let R=!1;const o=M.app={_uid:rz++,_component:y,_props:T,_container:null,_context:M,_instance:null,version:Ez,get config(){return M.config},set config(B){},use(B,...$){return C.has(B)||(B&&xn(B.install)?(C.add(B),B.install(o,...$)):xn(B)&&(C.add(B),B(o,...$))),o},mixin(B){return M.mixins.includes(B)||M.mixins.push(B),o},component(B,$){return $?(M.components[B]=$,o):M.components[B]},directive(B,$){return $?(M.directives[B]=$,o):M.directives[B]},mount(B,$,H){if(!R){const ie=_r(y,T);return ie.appContext=M,H===!0?H="svg":H===!1&&(H=void 0),$&&c?c(ie,B):i(ie,B,H),R=!0,o._container=B,B.__vue_app__=o,uy(ie.component)||ie.component.proxy}},unmount(){R&&(i(null,o._container),delete o._container.__vue_app__)},provide(B,$){return M.provides[B]=$,o},runWithContext(B){const $=Gh;Gh=o;try{return B()}finally{Gh=$}}};return o}}let Gh=null;function Xa(i,c){if(Zi){let p=Zi.provides;const y=Zi.parent&&Zi.parent.provides;y===p&&(p=Zi.provides=Object.create(y)),p[i]=c}}function fs(i,c,p=!1){const y=Zi||ji;if(y||Gh){const T=y?y.parent==null?y.vnode.appContext&&y.vnode.appContext.provides:y.parent.provides:Gh._context.provides;if(T&&i in T)return T[i];if(arguments.length>1)return p&&xn(c)?c.call(y&&y.proxy):c}}function iz(){return!!(Zi||ji||Gh)}function sz(i,c,p,y=!1){const T={},M={};Dg(M,ly,1),i.propsDefaults=Object.create(null),TI(i,c,T,M);for(const C in i.propsOptions[0])C in T||(T[C]=void 0);p?i.props=y?T:XA(T):i.type.props?i.props=T:i.props=M,i.attrs=M}function oz(i,c,p,y){const{props:T,attrs:M,vnode:{patchFlag:C}}=i,R=Fn(T),[o]=i.propsOptions;let B=!1;if((y||C>0)&&!(C&16)){if(C&8){const $=i.vnode.dynamicProps;for(let H=0;H<$.length;H++){let ie=$[H];if(ny(i.emitsOptions,ie))continue;const oe=c[ie];if(o)if(Nn(M,ie))oe!==M[ie]&&(M[ie]=oe,B=!0);else{const _e=_a(ie);T[_e]=rx(o,R,_e,oe,i,!1)}else oe!==M[ie]&&(M[ie]=oe,B=!0)}}}else{TI(i,c,T,M)&&(B=!0);let $;for(const H in R)(!c||!Nn(c,H)&&(($=Iu(H))===H||!Nn(c,$)))&&(o?p&&(p[H]!==void 0||p[$]!==void 0)&&(T[H]=rx(o,R,H,void 0,i,!0)):delete T[H]);if(M!==R)for(const H in M)(!c||!Nn(c,H))&&(delete M[H],B=!0)}B&&Za(i,"set","$attrs")}function TI(i,c,p,y){const[T,M]=i.propsOptions;let C=!1,R;if(c)for(let o in c){if(Pp(o))continue;const B=c[o];let $;T&&Nn(T,$=_a(o))?!M||!M.includes($)?p[$]=B:(R||(R={}))[$]=B:ny(i.emitsOptions,o)||(!(o in y)||B!==y[o])&&(y[o]=B,C=!0)}if(M){const o=Fn(p),B=R||pi;for(let $=0;$<M.length;$++){const H=M[$];p[H]=rx(T,o,H,B[H],i,!Nn(B,H))}}return C}function rx(i,c,p,y,T,M){const C=i[p];if(C!=null){const R=Nn(C,"default");if(R&&y===void 0){const o=C.default;if(C.type!==Function&&!C.skipFactory&&xn(o)){const{propsDefaults:B}=T;if(p in B)y=B[p];else{const $=sm(T);y=B[p]=o.call(null,c),$()}}else y=o}C[0]&&(M&&!R?y=!1:C[1]&&(y===""||y===Iu(p))&&(y=!0))}return y}function SI(i,c,p=!1){const y=c.propsCache,T=y.get(i);if(T)return T;const M=i.props,C={},R=[];let o=!1;if(!xn(i)){const $=H=>{o=!0;const[ie,oe]=SI(H,c,!0);qi(C,ie),oe&&R.push(...oe)};!p&&c.mixins.length&&c.mixins.forEach($),i.extends&&$(i.extends),i.mixins&&i.mixins.forEach($)}if(!M&&!o)return oi(i)&&y.set(i,$h),$h;if(Xr(M))for(let $=0;$<M.length;$++){const H=_a(M[$]);oM(H)&&(C[H]=pi)}else if(M)for(const $ in M){const H=_a($);if(oM(H)){const ie=M[$],oe=C[H]=Xr(ie)||xn(ie)?{type:ie}:qi({},ie);if(oe){const _e=cM(Boolean,oe.type),Me=cM(String,oe.type);oe[0]=_e>-1,oe[1]=Me<0||_e<Me,(_e>-1||Nn(oe,"default"))&&R.push(H)}}}const B=[C,R];return oi(i)&&y.set(i,B),B}function oM(i){return i[0]!=="$"&&!Pp(i)}function aM(i){return i===null?"null":typeof i=="function"?i.name||"":typeof i=="object"&&i.constructor&&i.constructor.name||""}function lM(i,c){return aM(i)===aM(c)}function cM(i,c){return Xr(c)?c.findIndex(p=>lM(p,i)):xn(c)&&lM(c,i)?0:-1}const MI=i=>i[0]==="_"||i==="$stable",Yx=i=>Xr(i)?i.map(ua):[ua(i)],az=(i,c,p)=>{if(c._n)return c;const y=Ai((...T)=>Yx(c(...T)),p);return y._c=!1,y},EI=(i,c,p)=>{const y=i._ctx;for(const T in i){if(MI(T))continue;const M=i[T];if(xn(M))c[T]=az(T,M,y);else if(M!=null){const C=Yx(M);c[T]=()=>C}}},AI=(i,c)=>{const p=Yx(c);i.slots.default=()=>p},lz=(i,c)=>{if(i.vnode.shapeFlag&32){const p=c._;p?(i.slots=Fn(c),Dg(c,"_",p)):EI(c,i.slots={})}else i.slots={},c&&AI(i,c);Dg(i.slots,ly,1)},cz=(i,c,p)=>{const{vnode:y,slots:T}=i;let M=!0,C=pi;if(y.shapeFlag&32){const R=c._;R?p&&R===1?M=!1:(qi(T,c),!p&&R===1&&delete T._):(M=!c.$stable,EI(c,T)),C=c}else c&&(AI(i,c),C={default:1});if(M)for(const R in T)!MI(R)&&C[R]==null&&delete T[R]};function nx(i,c,p,y,T=!1){if(Xr(i)){i.forEach((ie,oe)=>nx(ie,c&&(Xr(c)?c[oe]:c),p,y,T));return}if(Lp(y)&&!T)return;const M=y.shapeFlag&4?uy(y.component)||y.component.proxy:y.el,C=T?null:M,{i:R,r:o}=i,B=c&&c.r,$=R.refs===pi?R.refs={}:R.refs,H=R.setupState;if(B!=null&&B!==o&&(Ii(B)?($[B]=null,Nn(H,B)&&(H[B]=null)):ui(B)&&(B.value=null)),xn(o))ac(o,R,12,[C,$]);else{const ie=Ii(o),oe=ui(o);if(ie||oe){const _e=()=>{if(i.f){const Me=ie?Nn(H,o)?H[o]:$[o]:o.value;T?Xr(Me)&&Lx(Me,M):Xr(Me)?Me.includes(M)||Me.push(M):ie?($[o]=[M],Nn(H,o)&&(H[o]=$[o])):(o.value=[M],i.k&&($[i.k]=o.value))}else ie?($[o]=C,Nn(H,o)&&(H[o]=C)):oe&&(o.value=C,i.k&&($[i.k]=C))};C?(_e.id=-1,Ls(_e,p)):_e()}}}const Ls=DO;function uz(i){return hz(i)}function hz(i,c){const p=RA();p.__VUE__=!0;const{insert:y,remove:T,patchProp:M,createElement:C,createText:R,createComment:o,setText:B,setElementText:$,parentNode:H,nextSibling:ie,setScopeId:oe=io,insertStaticContent:_e}=i,Me=(pe,ye,qe,ft=null,ct=null,Bt=null,tr=void 0,vt=null,Yt=!!ye.dynamicChildren)=>{if(pe===ye)return;pe&&!xu(pe,ye)&&(ft=it(pe),nr(pe,ct,Bt,!0),pe=null),ye.patchFlag===-2&&(Yt=!1,ye.dynamicChildren=null);const{type:Pt,ref:rr,shapeFlag:br}=ye;switch(Pt){case ay:Re(pe,ye,qe,ft);break;case ao:Ee(pe,ye,qe,ft);break;case vg:pe==null&&mt(ye,qe,ft,tr);break;case Mn:Ve(pe,ye,qe,ft,ct,Bt,tr,vt,Yt);break;default:br&1?ut(pe,ye,qe,ft,ct,Bt,tr,vt,Yt):br&6?jt(pe,ye,qe,ft,ct,Bt,tr,vt,Yt):(br&64||br&128)&&Pt.process(pe,ye,qe,ft,ct,Bt,tr,vt,Yt,ir)}rr!=null&&ct&&nx(rr,pe&&pe.ref,Bt,ye||pe,!ye)},Re=(pe,ye,qe,ft)=>{if(pe==null)y(ye.el=R(ye.children),qe,ft);else{const ct=ye.el=pe.el;ye.children!==pe.children&&B(ct,ye.children)}},Ee=(pe,ye,qe,ft)=>{pe==null?y(ye.el=o(ye.children||""),qe,ft):ye.el=pe.el},mt=(pe,ye,qe,ft)=>{[pe.el,pe.anchor]=_e(pe.children,ye,qe,ft,pe.el,pe.anchor)},gt=({el:pe,anchor:ye},qe,ft)=>{let ct;for(;pe&&pe!==ye;)ct=ie(pe),y(pe,qe,ft),pe=ct;y(ye,qe,ft)},dt=({el:pe,anchor:ye})=>{let qe;for(;pe&&pe!==ye;)qe=ie(pe),T(pe),pe=qe;T(ye)},ut=(pe,ye,qe,ft,ct,Bt,tr,vt,Yt)=>{ye.type==="svg"?tr="svg":ye.type==="math"&&(tr="mathml"),pe==null?ht(ye,qe,ft,ct,Bt,tr,vt,Yt):Se(pe,ye,ct,Bt,tr,vt,Yt)},ht=(pe,ye,qe,ft,ct,Bt,tr,vt)=>{let Yt,Pt;const{props:rr,shapeFlag:br,transition:yr,dirs:Ie}=pe;if(Yt=pe.el=C(pe.type,Bt,rr&&rr.is,rr),br&8?$(Yt,pe.children):br&16&&Qe(pe.children,Yt,null,ft,ct,I0(pe,Bt),tr,vt),Ie&&pu(pe,null,ft,"created"),lt(Yt,pe,pe.scopeId,tr,ft),rr){for(const te in rr)te!=="value"&&!Pp(te)&&M(Yt,te,null,rr[te],Bt,pe.children,ft,ct,bn);"value"in rr&&M(Yt,"value",null,rr.value,Bt),(Pt=rr.onVnodeBeforeMount)&&la(Pt,ft,pe)}Ie&&pu(pe,null,ft,"beforeMount");const Z=dz(ct,yr);Z&&yr.beforeEnter(Yt),y(Yt,ye,qe),((Pt=rr&&rr.onVnodeMounted)||Z||Ie)&&Ls(()=>{Pt&&la(Pt,ft,pe),Z&&yr.enter(Yt),Ie&&pu(pe,null,ft,"mounted")},ct)},lt=(pe,ye,qe,ft,ct)=>{if(qe&&oe(pe,qe),ft)for(let Bt=0;Bt<ft.length;Bt++)oe(pe,ft[Bt]);if(ct){let Bt=ct.subTree;if(ye===Bt){const tr=ct.vnode;lt(pe,tr,tr.scopeId,tr.slotScopeIds,ct.parent)}}},Qe=(pe,ye,qe,ft,ct,Bt,tr,vt,Yt=0)=>{for(let Pt=Yt;Pt<pe.length;Pt++){const rr=pe[Pt]=vt?Ql(pe[Pt]):ua(pe[Pt]);Me(null,rr,ye,qe,ft,ct,Bt,tr,vt)}},Se=(pe,ye,qe,ft,ct,Bt,tr)=>{const vt=ye.el=pe.el;let{patchFlag:Yt,dynamicChildren:Pt,dirs:rr}=ye;Yt|=pe.patchFlag&16;const br=pe.props||pi,yr=ye.props||pi;let Ie;if(qe&&mu(qe,!1),(Ie=yr.onVnodeBeforeUpdate)&&la(Ie,qe,ye,pe),rr&&pu(ye,pe,qe,"beforeUpdate"),qe&&mu(qe,!0),Pt?Xt(pe.dynamicChildren,Pt,vt,qe,ft,I0(ye,ct),Bt):tr||zt(pe,ye,vt,null,qe,ft,I0(ye,ct),Bt,!1),Yt>0){if(Yt&16)xr(vt,ye,br,yr,qe,ft,ct);else if(Yt&2&&br.class!==yr.class&&M(vt,"class",null,yr.class,ct),Yt&4&&M(vt,"style",br.style,yr.style,ct),Yt&8){const Z=ye.dynamicProps;for(let te=0;te<Z.length;te++){const he=Z[te],ke=br[he],We=yr[he];(We!==ke||he==="value")&&M(vt,he,ke,We,ct,pe.children,qe,ft,bn)}}Yt&1&&pe.children!==ye.children&&$(vt,ye.children)}else!tr&&Pt==null&&xr(vt,ye,br,yr,qe,ft,ct);((Ie=yr.onVnodeUpdated)||rr)&&Ls(()=>{Ie&&la(Ie,qe,ye,pe),rr&&pu(ye,pe,qe,"updated")},ft)},Xt=(pe,ye,qe,ft,ct,Bt,tr)=>{for(let vt=0;vt<ye.length;vt++){const Yt=pe[vt],Pt=ye[vt],rr=Yt.el&&(Yt.type===Mn||!xu(Yt,Pt)||Yt.shapeFlag&70)?H(Yt.el):qe;Me(Yt,Pt,rr,null,ft,ct,Bt,tr,!0)}},xr=(pe,ye,qe,ft,ct,Bt,tr)=>{if(qe!==ft){if(qe!==pi)for(const vt in qe)!Pp(vt)&&!(vt in ft)&&M(pe,vt,qe[vt],null,tr,ye.children,ct,Bt,bn);for(const vt in ft){if(Pp(vt))continue;const Yt=ft[vt],Pt=qe[vt];Yt!==Pt&&vt!=="value"&&M(pe,vt,Pt,Yt,tr,ye.children,ct,Bt,bn)}"value"in ft&&M(pe,"value",qe.value,ft.value,tr)}},Ve=(pe,ye,qe,ft,ct,Bt,tr,vt,Yt)=>{const Pt=ye.el=pe?pe.el:R(""),rr=ye.anchor=pe?pe.anchor:R("");let{patchFlag:br,dynamicChildren:yr,slotScopeIds:Ie}=ye;Ie&&(vt=vt?vt.concat(Ie):Ie),pe==null?(y(Pt,qe,ft),y(rr,qe,ft),Qe(ye.children||[],qe,rr,ct,Bt,tr,vt,Yt)):br>0&&br&64&&yr&&pe.dynamicChildren?(Xt(pe.dynamicChildren,yr,qe,ct,Bt,tr,vt),(ye.key!=null||ct&&ye===ct.subTree)&&II(pe,ye,!0)):zt(pe,ye,qe,rr,ct,Bt,tr,vt,Yt)},jt=(pe,ye,qe,ft,ct,Bt,tr,vt,Yt)=>{ye.slotScopeIds=vt,pe==null?ye.shapeFlag&512?ct.ctx.activate(ye,qe,ft,tr,Yt):Ur(ye,qe,ft,ct,Bt,tr,Yt):$e(pe,ye,Yt)},Ur=(pe,ye,qe,ft,ct,Bt,tr)=>{const vt=pe.component=xz(pe,ft,ct);if(sy(pe)&&(vt.ctx.renderer=ir),bz(vt),vt.asyncDep){if(ct&&ct.registerDep(vt,ur),!pe.el){const Yt=vt.subTree=_r(ao);Ee(null,Yt,ye,qe)}}else ur(vt,pe,ye,qe,ct,Bt,tr)},$e=(pe,ye,qe)=>{const ft=ye.component=pe.component;if(EO(pe,ye,qe))if(ft.asyncDep&&!ft.asyncResolved){gr(ft,ye,qe);return}else ft.next=ye,xO(ft.update),ft.effect.dirty=!0,ft.update();else ye.el=pe.el,ft.vnode=ye},ur=(pe,ye,qe,ft,ct,Bt,tr)=>{const vt=()=>{if(pe.isMounted){let{next:rr,bu:br,u:yr,parent:Ie,vnode:Z}=pe;{const nt=CI(pe);if(nt){rr&&(rr.el=Z.el,gr(pe,rr,tr)),nt.asyncDep.then(()=>{pe.isUnmounted||vt()});return}}let te=rr,he;mu(pe,!1),rr?(rr.el=Z.el,gr(pe,rr,tr)):rr=Z,br&&_g(br),(he=rr.props&&rr.props.onVnodeBeforeUpdate)&&la(he,Ie,rr,Z),mu(pe,!0);const ke=M0(pe),We=pe.subTree;pe.subTree=ke,Me(We,ke,H(We.el),it(We),pe,ct,Bt),rr.el=ke.el,te===null&&AO(pe,ke.el),yr&&Ls(yr,ct),(he=rr.props&&rr.props.onVnodeUpdated)&&Ls(()=>la(he,Ie,rr,Z),ct)}else{let rr;const{el:br,props:yr}=ye,{bm:Ie,m:Z,parent:te}=pe,he=Lp(ye);if(mu(pe,!1),Ie&&_g(Ie),!he&&(rr=yr&&yr.onVnodeBeforeMount)&&la(rr,te,ye),mu(pe,!0),br&&Kr){const ke=()=>{pe.subTree=M0(pe),Kr(br,pe.subTree,pe,ct,null)};he?ye.type.__asyncLoader().then(()=>!pe.isUnmounted&&ke()):ke()}else{const ke=pe.subTree=M0(pe);Me(null,ke,qe,ft,pe,ct,Bt),ye.el=ke.el}if(Z&&Ls(Z,ct),!he&&(rr=yr&&yr.onVnodeMounted)){const ke=ye;Ls(()=>la(rr,te,ke),ct)}(ye.shapeFlag&256||te&&Lp(te.vnode)&&te.vnode.shapeFlag&256)&&pe.a&&Ls(pe.a,ct),pe.isMounted=!0,ye=qe=ft=null}},Yt=pe.effect=new Ox(vt,io,()=>jx(Pt),pe.scope),Pt=pe.update=()=>{Yt.dirty&&Yt.run()};Pt.id=pe.uid,mu(pe,!0),Pt()},gr=(pe,ye,qe)=>{ye.component=pe;const ft=pe.vnode.props;pe.vnode=ye,pe.next=null,oz(pe,ye.props,ft,qe),cz(pe,ye.children,qe),Cu(),JS(pe),Pu()},zt=(pe,ye,qe,ft,ct,Bt,tr,vt,Yt=!1)=>{const Pt=pe&&pe.children,rr=pe?pe.shapeFlag:0,br=ye.children,{patchFlag:yr,shapeFlag:Ie}=ye;if(yr>0){if(yr&128){Ft(Pt,br,qe,ft,ct,Bt,tr,vt,Yt);return}else if(yr&256){vn(Pt,br,qe,ft,ct,Bt,tr,vt,Yt);return}}Ie&8?(rr&16&&bn(Pt,ct,Bt),br!==Pt&&$(qe,br)):rr&16?Ie&16?Ft(Pt,br,qe,ft,ct,Bt,tr,vt,Yt):bn(Pt,ct,Bt,!0):(rr&8&&$(qe,""),Ie&16&&Qe(br,qe,ft,ct,Bt,tr,vt,Yt))},vn=(pe,ye,qe,ft,ct,Bt,tr,vt,Yt)=>{pe=pe||$h,ye=ye||$h;const Pt=pe.length,rr=ye.length,br=Math.min(Pt,rr);let yr;for(yr=0;yr<br;yr++){const Ie=ye[yr]=Yt?Ql(ye[yr]):ua(ye[yr]);Me(pe[yr],Ie,qe,null,ct,Bt,tr,vt,Yt)}Pt>rr?bn(pe,ct,Bt,!0,!1,br):Qe(ye,qe,ft,ct,Bt,tr,vt,Yt,br)},Ft=(pe,ye,qe,ft,ct,Bt,tr,vt,Yt)=>{let Pt=0;const rr=ye.length;let br=pe.length-1,yr=rr-1;for(;Pt<=br&&Pt<=yr;){const Ie=pe[Pt],Z=ye[Pt]=Yt?Ql(ye[Pt]):ua(ye[Pt]);if(xu(Ie,Z))Me(Ie,Z,qe,null,ct,Bt,tr,vt,Yt);else break;Pt++}for(;Pt<=br&&Pt<=yr;){const Ie=pe[br],Z=ye[yr]=Yt?Ql(ye[yr]):ua(ye[yr]);if(xu(Ie,Z))Me(Ie,Z,qe,null,ct,Bt,tr,vt,Yt);else break;br--,yr--}if(Pt>br){if(Pt<=yr){const Ie=yr+1,Z=Ie<rr?ye[Ie].el:ft;for(;Pt<=yr;)Me(null,ye[Pt]=Yt?Ql(ye[Pt]):ua(ye[Pt]),qe,Z,ct,Bt,tr,vt,Yt),Pt++}}else if(Pt>yr)for(;Pt<=br;)nr(pe[Pt],ct,Bt,!0),Pt++;else{const Ie=Pt,Z=Pt,te=new Map;for(Pt=Z;Pt<=yr;Pt++){const Et=ye[Pt]=Yt?Ql(ye[Pt]):ua(ye[Pt]);Et.key!=null&&te.set(Et.key,Pt)}let he,ke=0;const We=yr-Z+1;let nt=!1,Ut=0;const Ge=new Array(We);for(Pt=0;Pt<We;Pt++)Ge[Pt]=0;for(Pt=Ie;Pt<=br;Pt++){const Et=pe[Pt];if(ke>=We){nr(Et,ct,Bt,!0);continue}let Pe;if(Et.key!=null)Pe=te.get(Et.key);else for(he=Z;he<=yr;he++)if(Ge[he-Z]===0&&xu(Et,ye[he])){Pe=he;break}Pe===void 0?nr(Et,ct,Bt,!0):(Ge[Pe-Z]=Pt+1,Pe>=Ut?Ut=Pe:nt=!0,Me(Et,ye[Pe],qe,null,ct,Bt,tr,vt,Yt),ke++)}const Ht=nt?fz(Ge):$h;for(he=Ht.length-1,Pt=We-1;Pt>=0;Pt--){const Et=Z+Pt,Pe=ye[Et],ue=Et+1<rr?ye[Et+1].el:ft;Ge[Pt]===0?Me(null,Pe,qe,ue,ct,Bt,tr,vt,Yt):nt&&(he<0||Pt!==Ht[he]?zr(Pe,qe,ue,2):he--)}}},zr=(pe,ye,qe,ft,ct=null)=>{const{el:Bt,type:tr,transition:vt,children:Yt,shapeFlag:Pt}=pe;if(Pt&6){zr(pe.component.subTree,ye,qe,ft);return}if(Pt&128){pe.suspense.move(ye,qe,ft);return}if(Pt&64){tr.move(pe,ye,qe,ir);return}if(tr===Mn){y(Bt,ye,qe);for(let br=0;br<Yt.length;br++)zr(Yt[br],ye,qe,ft);y(pe.anchor,ye,qe);return}if(tr===vg){gt(pe,ye,qe);return}if(ft!==2&&Pt&1&&vt)if(ft===0)vt.beforeEnter(Bt),y(Bt,ye,qe),Ls(()=>vt.enter(Bt),ct);else{const{leave:br,delayLeave:yr,afterLeave:Ie}=vt,Z=()=>y(Bt,ye,qe),te=()=>{br(Bt,()=>{Z(),Ie&&Ie()})};yr?yr(Bt,Z,te):te()}else y(Bt,ye,qe)},nr=(pe,ye,qe,ft=!1,ct=!1)=>{const{type:Bt,props:tr,ref:vt,children:Yt,dynamicChildren:Pt,shapeFlag:rr,patchFlag:br,dirs:yr}=pe;if(vt!=null&&nx(vt,null,qe,pe,!0),rr&256){ye.ctx.deactivate(pe);return}const Ie=rr&1&&yr,Z=!Lp(pe);let te;if(Z&&(te=tr&&tr.onVnodeBeforeUnmount)&&la(te,ye,pe),rr&6)Bn(pe.component,qe,ft);else{if(rr&128){pe.suspense.unmount(qe,ft);return}Ie&&pu(pe,null,ye,"beforeUnmount"),rr&64?pe.type.remove(pe,ye,qe,ct,ir,ft):Pt&&(Bt!==Mn||br>0&&br&64)?bn(Pt,ye,qe,!1,!0):(Bt===Mn&&br&384||!ct&&rr&16)&&bn(Yt,ye,qe),ft&&En(pe)}(Z&&(te=tr&&tr.onVnodeUnmounted)||Ie)&&Ls(()=>{te&&la(te,ye,pe),Ie&&pu(pe,null,ye,"unmounted")},qe)},En=pe=>{const{type:ye,el:qe,anchor:ft,transition:ct}=pe;if(ye===Mn){dn(qe,ft);return}if(ye===vg){dt(pe);return}const Bt=()=>{T(qe),ct&&!ct.persisted&&ct.afterLeave&&ct.afterLeave()};if(pe.shapeFlag&1&&ct&&!ct.persisted){const{leave:tr,delayLeave:vt}=ct,Yt=()=>tr(qe,Bt);vt?vt(pe.el,Bt,Yt):Yt()}else Bt()},dn=(pe,ye)=>{let qe;for(;pe!==ye;)qe=ie(pe),T(pe),pe=qe;T(ye)},Bn=(pe,ye,qe)=>{const{bum:ft,scope:ct,update:Bt,subTree:tr,um:vt}=pe;ft&&_g(ft),ct.stop(),Bt&&(Bt.active=!1,nr(tr,pe,ye,qe)),vt&&Ls(vt,ye),Ls(()=>{pe.isUnmounted=!0},ye),ye&&ye.pendingBranch&&!ye.isUnmounted&&pe.asyncDep&&!pe.asyncResolved&&pe.suspenseId===ye.pendingId&&(ye.deps--,ye.deps===0&&ye.resolve())},bn=(pe,ye,qe,ft=!1,ct=!1,Bt=0)=>{for(let tr=Bt;tr<pe.length;tr++)nr(pe[tr],ye,qe,ft,ct)},it=pe=>pe.shapeFlag&6?it(pe.component.subTree):pe.shapeFlag&128?pe.suspense.next():ie(pe.anchor||pe.el);let Kt=!1;const Gt=(pe,ye,qe)=>{pe==null?ye._vnode&&nr(ye._vnode,null,null,!0):Me(ye._vnode||null,pe,ye,null,null,null,qe),Kt||(Kt=!0,JS(),aI(),Kt=!1),ye._vnode=pe},ir={p:Me,um:nr,m:zr,r:En,mt:Ur,mc:Qe,pc:zt,pbc:Xt,n:it,o:i};let Vr,Kr;return c&&([Vr,Kr]=c(ir)),{render:Gt,hydrate:Vr,createApp:nz(Gt,Vr)}}function I0({type:i,props:c},p){return p==="svg"&&i==="foreignObject"||p==="mathml"&&i==="annotation-xml"&&c&&c.encoding&&c.encoding.includes("html")?void 0:p}function mu({effect:i,update:c},p){i.allowRecurse=c.allowRecurse=p}function dz(i,c){return(!i||i&&!i.pendingBranch)&&c&&!c.persisted}function II(i,c,p=!1){const y=i.children,T=c.children;if(Xr(y)&&Xr(T))for(let M=0;M<y.length;M++){const C=y[M];let R=T[M];R.shapeFlag&1&&!R.dynamicChildren&&((R.patchFlag<=0||R.patchFlag===32)&&(R=T[M]=Ql(T[M]),R.el=C.el),p||II(C,R)),R.type===ay&&(R.el=C.el)}}function fz(i){const c=i.slice(),p=[0];let y,T,M,C,R;const o=i.length;for(y=0;y<o;y++){const B=i[y];if(B!==0){if(T=p[p.length-1],i[T]<B){c[y]=T,p.push(y);continue}for(M=0,C=p.length-1;M<C;)R=M+C>>1,i[p[R]]<B?M=R+1:C=R;B<i[p[M]]&&(M>0&&(c[y]=p[M-1]),p[M]=y)}}for(M=p.length,C=p[M-1];M-- >0;)p[M]=C,C=c[C];return p}function CI(i){const c=i.subTree.component;if(c)return c.asyncDep&&!c.asyncResolved?c:CI(c)}const pz=i=>i.__isTeleport,Mn=Symbol.for("v-fgt"),ay=Symbol.for("v-txt"),ao=Symbol.for("v-cmt"),vg=Symbol.for("v-stc"),kp=[];let Ro=null;function It(i=!1){kp.push(Ro=i?null:[])}function mz(){kp.pop(),Ro=kp[kp.length-1]||null}let Gp=1;function uM(i){Gp+=i}function PI(i){return i.dynamicChildren=Gp>0?Ro||$h:null,mz(),Gp>0&&Ro&&Ro.push(i),i}function Wt(i,c,p,y,T,M){return PI(Ue(i,c,p,y,T,M,!0))}function rs(i,c,p,y,T){return PI(_r(i,c,p,y,T,!0))}function zg(i){return i?i.__v_isVNode===!0:!1}function xu(i,c){return i.type===c.type&&i.key===c.key}const ly="__vInternal",DI=({key:i})=>i??null,xg=({ref:i,ref_key:c,ref_for:p})=>(typeof i=="number"&&(i=""+i),i!=null?Ii(i)||ui(i)||xn(i)?{i:ji,r:i,k:c,f:!!p}:i:null);function Ue(i,c=null,p=null,y=0,T=null,M=i===Mn?0:1,C=!1,R=!1){const o={__v_isVNode:!0,__v_skip:!0,type:i,props:c,key:c&&DI(c),ref:c&&xg(c),scopeId:iy,slotScopeIds:null,children:p,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:M,patchFlag:y,dynamicProps:T,dynamicChildren:null,appContext:null,ctx:ji};return R?(Zx(o,p),M&128&&i.normalize(o)):p&&(o.shapeFlag|=Ii(p)?8:16),Gp>0&&!C&&Ro&&(o.patchFlag>0||M&6)&&o.patchFlag!==32&&Ro.push(o),o}const _r=_z;function _z(i,c=null,p=null,y=0,T=null,M=!1){if((!i||i===uI)&&(i=ao),zg(i)){const R=hc(i,c,!0);return p&&Zx(R,p),Gp>0&&!M&&Ro&&(R.shapeFlag&6?Ro[Ro.indexOf(i)]=R:Ro.push(R)),R.patchFlag|=-2,R}if(Mz(i)&&(i=i.__vccOpts),c){c=Fg(c);let{class:R,style:o}=c;R&&!Ii(R)&&(c.class=Rn(R)),oi(o)&&(JA(o)&&!Xr(o)&&(o=qi({},o)),c.style=Ya(o))}const C=Ii(i)?1:PO(i)?128:pz(i)?64:oi(i)?4:xn(i)?2:0;return Ue(i,c,p,y,T,C,M,!0)}function Fg(i){return i?JA(i)||ly in i?qi({},i):i:null}function hc(i,c,p=!1){const{props:y,ref:T,patchFlag:M,children:C}=i,R=c?mc(y||{},c):y;return{__v_isVNode:!0,__v_skip:!0,type:i.type,props:R,key:R&&DI(R),ref:c&&c.ref?p&&T?Xr(T)?T.concat(xg(c)):[T,xg(c)]:xg(c):T,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:C,target:i.target,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:c&&i.type!==Mn?M===-1?16:M|16:M,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:i.transition,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&hc(i.ssContent),ssFallback:i.ssFallback&&hc(i.ssFallback),el:i.el,anchor:i.anchor,ctx:i.ctx,ce:i.ce}}function im(i=" ",c=0){return _r(ay,null,i,c)}function gz(i,c){const p=_r(vg,null,i);return p.staticCount=c,p}function Ei(i="",c=!1){return c?(It(),rs(ao,null,i)):_r(ao,null,i)}function ua(i){return i==null||typeof i=="boolean"?_r(ao):Xr(i)?_r(Mn,null,i.slice()):typeof i=="object"?Ql(i):_r(ay,null,String(i))}function Ql(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:hc(i)}function Zx(i,c){let p=0;const{shapeFlag:y}=i;if(c==null)c=null;else if(Xr(c))p=16;else if(typeof c=="object")if(y&65){const T=c.default;T&&(T._c&&(T._d=!1),Zx(i,T()),T._c&&(T._d=!0));return}else{p=32;const T=c._;!T&&!(ly in c)?c._ctx=ji:T===3&&ji&&(ji.slots._===1?c._=1:(c._=2,i.patchFlag|=1024))}else xn(c)?(c={default:c,_ctx:ji},p=32):(c=String(c),y&64?(p=16,c=[im(c)]):p=8);i.children=c,i.shapeFlag|=p}function mc(...i){const c={};for(let p=0;p<i.length;p++){const y=i[p];for(const T in y)if(T==="class")c.class!==y.class&&(c.class=Rn([c.class,y.class]));else if(T==="style")c.style=Ya([c.style,y.style]);else if(Kg(T)){const M=c[T],C=y[T];C&&M!==C&&!(Xr(M)&&M.includes(C))&&(c[T]=M?[].concat(M,C):C)}else T!==""&&(c[T]=y[T])}return c}function la(i,c,p,y=null){oo(i,c,7,[p,y])}const yz=wI();let vz=0;function xz(i,c,p){const y=i.type,T=(c?c.appContext:i.appContext)||yz,M={uid:vz++,vnode:i,type:y,parent:c,appContext:T,root:null,next:null,subTree:null,effect:null,update:null,scope:new zA(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:c?c.provides:Object.create(T.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:SI(y,T),emitsOptions:cI(y,T),emit:null,emitted:null,propsDefaults:pi,inheritAttrs:y.inheritAttrs,ctx:pi,data:pi,props:pi,attrs:pi,slots:pi,refs:pi,setupState:pi,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:p,suspenseId:p?p.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return M.ctx={_:M},M.root=c?c.root:M,M.emit=TO.bind(null,M),i.ce&&i.ce(M),M}let Zi=null;const LI=()=>Zi||ji;let Bg,ix;{const i=RA(),c=(p,y)=>{let T;return(T=i[p])||(T=i[p]=[]),T.push(y),M=>{T.length>1?T.forEach(C=>C(M)):T[0](M)}};Bg=c("__VUE_INSTANCE_SETTERS__",p=>Zi=p),ix=c("__VUE_SSR_SETTERS__",p=>cy=p)}const sm=i=>{const c=Zi;return Bg(i),i.scope.on(),()=>{i.scope.off(),Bg(c)}},hM=()=>{Zi&&Zi.scope.off(),Bg(null)};function RI(i){return i.vnode.shapeFlag&4}let cy=!1;function bz(i,c=!1){c&&ix(c);const{props:p,children:y}=i.vnode,T=RI(i);sz(i,p,T,c),lz(i,y);const M=T?wz(i,c):void 0;return c&&ix(!1),M}function wz(i,c){const p=i.type;i.accessCache=Object.create(null),i.proxy=ty(new Proxy(i.ctx,YO));const{setup:y}=p;if(y){const T=i.setupContext=y.length>1?OI(i):null,M=sm(i);Cu();const C=ac(y,i,0,[i.props,T]);if(Pu(),M(),PA(C)){if(C.then(hM,hM),c)return C.then(R=>{dM(i,R,c)}).catch(R=>{ry(R,i,0)});i.asyncDep=C}else dM(i,C,c)}else kI(i,c)}function dM(i,c,p){xn(c)?i.type.__ssrInlineRender?i.ssrRender=c:i.render=c:oi(c)&&(i.setupState=rI(c)),kI(i,p)}let fM;function kI(i,c,p){const y=i.type;if(!i.render){if(!c&&fM&&!y.render){const T=y.template||Wx(i).template;if(T){const{isCustomElement:M,compilerOptions:C}=i.appContext.config,{delimiters:R,compilerOptions:o}=y,B=qi(qi({isCustomElement:M,delimiters:R},C),o);y.render=fM(T,B)}}i.render=y.render||io}{const T=sm(i);Cu();try{KO(i)}finally{Pu(),T()}}}function Tz(i){return i.attrsProxy||(i.attrsProxy=new Proxy(i.attrs,{get(c,p){return Os(i,"get","$attrs"),c[p]}}))}function OI(i){const c=p=>{i.exposed=p||{}};return{get attrs(){return Tz(i)},slots:i.slots,emit:i.emit,expose:c}}function uy(i){if(i.exposed)return i.exposeProxy||(i.exposeProxy=new Proxy(rI(ty(i.exposed)),{get(c,p){if(p in c)return c[p];if(p in Rp)return Rp[p](i)},has(c,p){return p in c||p in Rp}}))}function Sz(i,c=!0){return xn(i)?i.displayName||i.name:i.name||c&&i.__name}function Mz(i){return xn(i)&&"__vccOpts"in i}const rt=(i,c)=>dO(i,c,cy);function Xx(i,c,p){const y=arguments.length;return y===2?oi(c)&&!Xr(c)?zg(c)?_r(i,null,[c]):_r(i,c):_r(i,null,c):(y>3?p=Array.prototype.slice.call(arguments,2):y===3&&zg(p)&&(p=[p]),_r(i,c,p))}const Ez="3.4.21";/**
* @vue/runtime-dom v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const Az="http://www.w3.org/2000/svg",Iz="http://www.w3.org/1998/Math/MathML",ec=typeof document<"u"?document:null,pM=ec&&ec.createElement("template"),Cz={insert:(i,c,p)=>{c.insertBefore(i,p||null)},remove:i=>{const c=i.parentNode;c&&c.removeChild(i)},createElement:(i,c,p,y)=>{const T=c==="svg"?ec.createElementNS(Az,i):c==="mathml"?ec.createElementNS(Iz,i):ec.createElement(i,p?{is:p}:void 0);return i==="select"&&y&&y.multiple!=null&&T.setAttribute("multiple",y.multiple),T},createText:i=>ec.createTextNode(i),createComment:i=>ec.createComment(i),setText:(i,c)=>{i.nodeValue=c},setElementText:(i,c)=>{i.textContent=c},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>ec.querySelector(i),setScopeId(i,c){i.setAttribute(c,"")},insertStaticContent(i,c,p,y,T,M){const C=p?p.previousSibling:c.lastChild;if(T&&(T===M||T.nextSibling))for(;c.insertBefore(T.cloneNode(!0),p),!(T===M||!(T=T.nextSibling)););else{pM.innerHTML=y==="svg"?`<svg>${i}</svg>`:y==="mathml"?`<math>${i}</math>`:i;const R=pM.content;if(y==="svg"||y==="mathml"){const o=R.firstChild;for(;o.firstChild;)R.appendChild(o.firstChild);R.removeChild(o)}c.insertBefore(R,p)}return[C?C.nextSibling:c.firstChild,p?p.previousSibling:c.lastChild]}},Hl="transition",xp="animation",Hp=Symbol("_vtc"),hy=(i,{slots:c})=>Xx(FO,Pz(i),c);hy.displayName="Transition";const zI={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};hy.props=qi({},pI,zI);const _u=(i,c=[])=>{Xr(i)?i.forEach(p=>p(...c)):i&&i(...c)},mM=i=>i?Xr(i)?i.some(c=>c.length>1):i.length>1:!1;function Pz(i){const c={};for(const Ve in i)Ve in zI||(c[Ve]=i[Ve]);if(i.css===!1)return c;const{name:p="v",type:y,duration:T,enterFromClass:M=`${p}-enter-from`,enterActiveClass:C=`${p}-enter-active`,enterToClass:R=`${p}-enter-to`,appearFromClass:o=M,appearActiveClass:B=C,appearToClass:$=R,leaveFromClass:H=`${p}-leave-from`,leaveActiveClass:ie=`${p}-leave-active`,leaveToClass:oe=`${p}-leave-to`}=i,_e=Dz(T),Me=_e&&_e[0],Re=_e&&_e[1],{onBeforeEnter:Ee,onEnter:mt,onEnterCancelled:gt,onLeave:dt,onLeaveCancelled:ut,onBeforeAppear:ht=Ee,onAppear:lt=mt,onAppearCancelled:Qe=gt}=c,Se=(Ve,jt,Ur)=>{gu(Ve,jt?$:R),gu(Ve,jt?B:C),Ur&&Ur()},Xt=(Ve,jt)=>{Ve._isLeaving=!1,gu(Ve,H),gu(Ve,oe),gu(Ve,ie),jt&&jt()},xr=Ve=>(jt,Ur)=>{const $e=Ve?lt:mt,ur=()=>Se(jt,Ve,Ur);_u($e,[jt,ur]),_M(()=>{gu(jt,Ve?o:M),ql(jt,Ve?$:R),mM($e)||gM(jt,y,Me,ur)})};return qi(c,{onBeforeEnter(Ve){_u(Ee,[Ve]),ql(Ve,M),ql(Ve,C)},onBeforeAppear(Ve){_u(ht,[Ve]),ql(Ve,o),ql(Ve,B)},onEnter:xr(!1),onAppear:xr(!0),onLeave(Ve,jt){Ve._isLeaving=!0;const Ur=()=>Xt(Ve,jt);ql(Ve,H),kz(),ql(Ve,ie),_M(()=>{Ve._isLeaving&&(gu(Ve,H),ql(Ve,oe),mM(dt)||gM(Ve,y,Re,Ur))}),_u(dt,[Ve,Ur])},onEnterCancelled(Ve){Se(Ve,!1),_u(gt,[Ve])},onAppearCancelled(Ve){Se(Ve,!0),_u(Qe,[Ve])},onLeaveCancelled(Ve){Xt(Ve),_u(ut,[Ve])}})}function Dz(i){if(i==null)return null;if(oi(i))return[C0(i.enter),C0(i.leave)];{const c=C0(i);return[c,c]}}function C0(i){return zk(i)}function ql(i,c){c.split(/\s+/).forEach(p=>p&&i.classList.add(p)),(i[Hp]||(i[Hp]=new Set)).add(c)}function gu(i,c){c.split(/\s+/).forEach(y=>y&&i.classList.remove(y));const p=i[Hp];p&&(p.delete(c),p.size||(i[Hp]=void 0))}function _M(i){requestAnimationFrame(()=>{requestAnimationFrame(i)})}let Lz=0;function gM(i,c,p,y){const T=i._endId=++Lz,M=()=>{T===i._endId&&y()};if(p)return setTimeout(M,p);const{type:C,timeout:R,propCount:o}=Rz(i,c);if(!C)return y();const B=C+"end";let $=0;const H=()=>{i.removeEventListener(B,ie),M()},ie=oe=>{oe.target===i&&++$>=o&&H()};setTimeout(()=>{$<o&&H()},R+1),i.addEventListener(B,ie)}function Rz(i,c){const p=window.getComputedStyle(i),y=_e=>(p[_e]||"").split(", "),T=y(`${Hl}Delay`),M=y(`${Hl}Duration`),C=yM(T,M),R=y(`${xp}Delay`),o=y(`${xp}Duration`),B=yM(R,o);let $=null,H=0,ie=0;c===Hl?C>0&&($=Hl,H=C,ie=M.length):c===xp?B>0&&($=xp,H=B,ie=o.length):(H=Math.max(C,B),$=H>0?C>B?Hl:xp:null,ie=$?$===Hl?M.length:o.length:0);const oe=$===Hl&&/\b(transform|all)(,|$)/.test(y(`${Hl}Property`).toString());return{type:$,timeout:H,propCount:ie,hasTransform:oe}}function yM(i,c){for(;i.length<c.length;)i=i.concat(i);return Math.max(...c.map((p,y)=>vM(p)+vM(i[y])))}function vM(i){return i==="auto"?0:Number(i.slice(0,-1).replace(",","."))*1e3}function kz(){return document.body.offsetHeight}function Oz(i,c,p){const y=i[Hp];y&&(c=(c?[c,...y]:[...y]).join(" ")),c==null?i.removeAttribute("class"):p?i.setAttribute("class",c):i.className=c}const xM=Symbol("_vod"),zz=Symbol("_vsh"),Fz=Symbol(""),Bz=/(^|;)\s*display\s*:/;function Nz(i,c,p){const y=i.style,T=Ii(p);let M=!1;if(p&&!T){if(c)if(Ii(c))for(const C of c.split(";")){const R=C.slice(0,C.indexOf(":")).trim();p[R]==null&&bg(y,R,"")}else for(const C in c)p[C]==null&&bg(y,C,"");for(const C in p)C==="display"&&(M=!0),bg(y,C,p[C])}else if(T){if(c!==p){const C=y[Fz];C&&(p+=";"+C),y.cssText=p,M=Bz.test(p)}}else c&&i.removeAttribute("style");xM in i&&(i[xM]=M?y.display:"",i[zz]&&(y.display="none"))}const bM=/\s*!important$/;function bg(i,c,p){if(Xr(p))p.forEach(y=>bg(i,c,y));else if(p==null&&(p=""),c.startsWith("--"))i.setProperty(c,p);else{const y=Vz(i,c);bM.test(p)?i.setProperty(Iu(y),p.replace(bM,""),"important"):i[y]=p}}const wM=["Webkit","Moz","ms"],P0={};function Vz(i,c){const p=P0[c];if(p)return p;let y=_a(c);if(y!=="filter"&&y in i)return P0[c]=y;y=Qg(y);for(let T=0;T<wM.length;T++){const M=wM[T]+y;if(M in i)return P0[c]=M}return c}const TM="http://www.w3.org/1999/xlink";function $z(i,c,p,y,T){if(y&&c.startsWith("xlink:"))p==null?i.removeAttributeNS(TM,c.slice(6,c.length)):i.setAttributeNS(TM,c,p);else{const M=Uk(c);p==null||M&&!kA(p)?i.removeAttribute(c):i.setAttribute(c,M?"":p)}}function Uz(i,c,p,y,T,M,C){if(c==="innerHTML"||c==="textContent"){y&&C(y,T,M),i[c]=p??"";return}const R=i.tagName;if(c==="value"&&R!=="PROGRESS"&&!R.includes("-")){const B=R==="OPTION"?i.getAttribute("value")||"":i.value,$=p??"";(B!==$||!("_value"in i))&&(i.value=$),p==null&&i.removeAttribute(c),i._value=p;return}let o=!1;if(p===""||p==null){const B=typeof i[c];B==="boolean"?p=kA(p):p==null&&B==="string"?(p="",o=!0):B==="number"&&(p=0,o=!0)}try{i[c]=p}catch{}o&&i.removeAttribute(c)}function rc(i,c,p,y){i.addEventListener(c,p,y)}function jz(i,c,p,y){i.removeEventListener(c,p,y)}const SM=Symbol("_vei");function Gz(i,c,p,y,T=null){const M=i[SM]||(i[SM]={}),C=M[c];if(y&&C)C.value=y;else{const[R,o]=Hz(c);if(y){const B=M[c]=Yz(y,T);rc(i,R,B,o)}else C&&(jz(i,R,C,o),M[c]=void 0)}}const MM=/(?:Once|Passive|Capture)$/;function Hz(i){let c;if(MM.test(i)){c={};let y;for(;y=i.match(MM);)i=i.slice(0,i.length-y[0].length),c[y[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):Iu(i.slice(2)),c]}let D0=0;const qz=Promise.resolve(),Wz=()=>D0||(qz.then(()=>D0=0),D0=Date.now());function Yz(i,c){const p=y=>{if(!y._vts)y._vts=Date.now();else if(y._vts<=p.attached)return;oo(Zz(y,p.value),c,5,[y])};return p.value=i,p.attached=Wz(),p}function Zz(i,c){if(Xr(c)){const p=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{p.call(i),i._stopped=!0},c.map(y=>T=>!T._stopped&&y&&y(T))}else return c}const EM=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&i.charCodeAt(2)>96&&i.charCodeAt(2)<123,Xz=(i,c,p,y,T,M,C,R,o)=>{const B=T==="svg";c==="class"?Oz(i,y,B):c==="style"?Nz(i,p,y):Kg(c)?Dx(c)||Gz(i,c,p,y,C):(c[0]==="."?(c=c.slice(1),!0):c[0]==="^"?(c=c.slice(1),!1):Kz(i,c,y,B))?Uz(i,c,y,M,C,R,o):(c==="true-value"?i._trueValue=y:c==="false-value"&&(i._falseValue=y),$z(i,c,y,B))};function Kz(i,c,p,y){if(y)return!!(c==="innerHTML"||c==="textContent"||c in i&&EM(c)&&xn(p));if(c==="spellcheck"||c==="draggable"||c==="translate"||c==="form"||c==="list"&&i.tagName==="INPUT"||c==="type"&&i.tagName==="TEXTAREA")return!1;if(c==="width"||c==="height"){const T=i.tagName;if(T==="IMG"||T==="VIDEO"||T==="CANVAS"||T==="SOURCE")return!1}return EM(c)&&Ii(p)?!1:c in i}const Zh=i=>{const c=i.props["onUpdate:modelValue"]||!1;return Xr(c)?p=>_g(c,p):c};function Jz(i){i.target.composing=!0}function AM(i){const c=i.target;c.composing&&(c.composing=!1,c.dispatchEvent(new Event("input")))}const Ka=Symbol("_assign"),sx={created(i,{modifiers:{lazy:c,trim:p,number:y}},T){i[Ka]=Zh(T);const M=y||T.props&&T.props.type==="number";rc(i,c?"change":"input",C=>{if(C.target.composing)return;let R=i.value;p&&(R=R.trim()),M&&(R=Vp(R)),i[Ka](R)}),p&&rc(i,"change",()=>{i.value=i.value.trim()}),c||(rc(i,"compositionstart",Jz),rc(i,"compositionend",AM),rc(i,"change",AM))},mounted(i,{value:c}){i.value=c??""},beforeUpdate(i,{value:c,modifiers:{lazy:p,trim:y,number:T}},M){if(i[Ka]=Zh(M),i.composing)return;const C=T||i.type==="number"?Vp(i.value):i.value,R=c??"";C!==R&&(document.activeElement===i&&i.type!=="range"&&(p||y&&i.value.trim()===R)||(i.value=R))}},IM={deep:!0,created(i,c,p){i[Ka]=Zh(p),rc(i,"change",()=>{const y=i._modelValue,T=qp(i),M=i.checked,C=i[Ka];if(Xr(y)){const R=kx(y,T),o=R!==-1;if(M&&!o)C(y.concat(T));else if(!M&&o){const B=[...y];B.splice(R,1),C(B)}}else if(sd(y)){const R=new Set(y);M?R.add(T):R.delete(T),C(R)}else C(FI(i,M))})},mounted:CM,beforeUpdate(i,c,p){i[Ka]=Zh(p),CM(i,c,p)}};function CM(i,{value:c,oldValue:p},y){i._modelValue=c,Xr(c)?i.checked=kx(c,y.props.value)>-1:sd(c)?i.checked=c.has(y.props.value):c!==p&&(i.checked=rm(c,FI(i,!0)))}const Qz={deep:!0,created(i,{value:c,modifiers:{number:p}},y){const T=sd(c);rc(i,"change",()=>{const M=Array.prototype.filter.call(i.options,C=>C.selected).map(C=>p?Vp(qp(C)):qp(C));i[Ka](i.multiple?T?new Set(M):M:M[0]),i._assigning=!0,qa(()=>{i._assigning=!1})}),i[Ka]=Zh(y)},mounted(i,{value:c,modifiers:{number:p}}){PM(i,c,p)},beforeUpdate(i,c,p){i[Ka]=Zh(p)},updated(i,{value:c,modifiers:{number:p}}){i._assigning||PM(i,c,p)}};function PM(i,c,p){const y=i.multiple,T=Xr(c);if(!(y&&!T&&!sd(c))){for(let M=0,C=i.options.length;M<C;M++){const R=i.options[M],o=qp(R);if(y)if(T){const B=typeof o;B==="string"||B==="number"?R.selected=c.includes(p?Vp(o):o):R.selected=kx(c,o)>-1}else R.selected=c.has(o);else if(rm(qp(R),c)){i.selectedIndex!==M&&(i.selectedIndex=M);return}}!y&&i.selectedIndex!==-1&&(i.selectedIndex=-1)}}function qp(i){return"_value"in i?i._value:i.value}function FI(i,c){const p=c?"_trueValue":"_falseValue";return p in i?i[p]:c}const e3=["ctrl","shift","alt","meta"],t3={stop:i=>i.stopPropagation(),prevent:i=>i.preventDefault(),self:i=>i.target!==i.currentTarget,ctrl:i=>!i.ctrlKey,shift:i=>!i.shiftKey,alt:i=>!i.altKey,meta:i=>!i.metaKey,left:i=>"button"in i&&i.button!==0,middle:i=>"button"in i&&i.button!==1,right:i=>"button"in i&&i.button!==2,exact:(i,c)=>e3.some(p=>i[`${p}Key`]&&!c.includes(p))},wg=(i,c)=>{const p=i._withMods||(i._withMods={}),y=c.join(".");return p[y]||(p[y]=(T,...M)=>{for(let C=0;C<c.length;C++){const R=t3[c[C]];if(R&&R(T,c))return}return i(T,...M)})},r3={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},DM=(i,c)=>{const p=i._withKeys||(i._withKeys={}),y=c.join(".");return p[y]||(p[y]=T=>{if(!("key"in T))return;const M=Iu(T.key);if(c.some(C=>C===M||r3[C]===M))return i(T)})},n3=qi({patchProp:Xz},Cz);let LM;function i3(){return LM||(LM=uz(n3))}const s3=(...i)=>{const c=i3().createApp(...i),{mount:p}=c;return c.mount=y=>{const T=a3(y);if(!T)return;const M=c._component;!xn(M)&&!M.render&&!M.template&&(M.template=T.innerHTML),T.innerHTML="";const C=p(T,!1,o3(T));return T instanceof Element&&(T.removeAttribute("v-cloak"),T.setAttribute("data-v-app","")),C},c};function o3(i){if(i instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&i instanceof MathMLElement)return"mathml"}function a3(i){return Ii(i)?document.querySelector(i):i}var l3=!1;/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let BI;const dy=i=>BI=i,NI=Symbol();function ox(i){return i&&typeof i=="object"&&Object.prototype.toString.call(i)==="[object Object]"&&typeof i.toJSON!="function"}var Op;(function(i){i.direct="direct",i.patchObject="patch object",i.patchFunction="patch function"})(Op||(Op={}));function c3(){const i=FA(!0),c=i.run(()=>Zr({}));let p=[],y=[];const T=ty({install(M){dy(T),T._a=M,M.provide(NI,T),M.config.globalProperties.$pinia=T,y.forEach(C=>p.push(C)),y=[]},use(M){return!this._a&&!l3?y.push(M):p.push(M),this},_p:p,_a:null,_e:i,_s:new Map,state:c});return T}const VI=()=>{};function RM(i,c,p,y=VI){i.push(c);const T=()=>{const M=i.indexOf(c);M>-1&&(i.splice(M,1),y())};return!p&&BA()&&Hk(T),T}function Fh(i,...c){i.slice().forEach(p=>{p(...c)})}const u3=i=>i();function ax(i,c){i instanceof Map&&c instanceof Map&&c.forEach((p,y)=>i.set(y,p)),i instanceof Set&&c instanceof Set&&c.forEach(i.add,i);for(const p in c){if(!c.hasOwnProperty(p))continue;const y=c[p],T=i[p];ox(T)&&ox(y)&&i.hasOwnProperty(p)&&!ui(y)&&!oc(y)?i[p]=ax(T,y):i[p]=y}return i}const h3=Symbol();function d3(i){return!ox(i)||!i.hasOwnProperty(h3)}const{assign:Xl}=Object;function f3(i){return!!(ui(i)&&i.effect)}function p3(i,c,p,y){const{state:T,actions:M,getters:C}=c,R=p.state.value[i];let o;function B(){R||(p.state.value[i]=T?T():{});const $=nI(p.state.value[i]);return Xl($,M,Object.keys(C||{}).reduce((H,ie)=>(H[ie]=ty(rt(()=>{dy(p);const oe=p._s.get(i);return C[ie].call(oe,oe)})),H),{}))}return o=$I(i,B,c,p,y,!0),o}function $I(i,c,p={},y,T,M){let C;const R=Xl({actions:{}},p),o={deep:!0};let B,$,H=[],ie=[],oe;const _e=y.state.value[i];!M&&!_e&&(y.state.value[i]={}),Zr({});let Me;function Re(Qe){let Se;B=$=!1,typeof Qe=="function"?(Qe(y.state.value[i]),Se={type:Op.patchFunction,storeId:i,events:oe}):(ax(y.state.value[i],Qe),Se={type:Op.patchObject,payload:Qe,storeId:i,events:oe});const Xt=Me=Symbol();qa().then(()=>{Me===Xt&&(B=!0)}),$=!0,Fh(H,Se,y.state.value[i])}const Ee=M?function(){const{state:Se}=p,Xt=Se?Se():{};this.$patch(xr=>{Xl(xr,Xt)})}:VI;function mt(){C.stop(),H=[],ie=[],y._s.delete(i)}function gt(Qe,Se){return function(){dy(y);const Xt=Array.from(arguments),xr=[],Ve=[];function jt(ur){xr.push(ur)}function Ur(ur){Ve.push(ur)}Fh(ie,{args:Xt,name:Qe,store:ut,after:jt,onError:Ur});let $e;try{$e=Se.apply(this&&this.$id===i?this:ut,Xt)}catch(ur){throw Fh(Ve,ur),ur}return $e instanceof Promise?$e.then(ur=>(Fh(xr,ur),ur)).catch(ur=>(Fh(Ve,ur),Promise.reject(ur))):(Fh(xr,$e),$e)}}const dt={_p:y,$id:i,$onAction:RM.bind(null,ie),$patch:Re,$reset:Ee,$subscribe(Qe,Se={}){const Xt=RM(H,Qe,Se.detached,()=>xr()),xr=C.run(()=>Oi(()=>y.state.value[i],Ve=>{(Se.flush==="sync"?$:B)&&Qe({storeId:i,type:Op.direct,events:oe},Ve)},Xl({},o,Se)));return Xt},$dispose:mt},ut=Xs(dt);y._s.set(i,ut);const lt=(y._a&&y._a.runWithContext||u3)(()=>y._e.run(()=>(C=FA()).run(c)));for(const Qe in lt){const Se=lt[Qe];if(ui(Se)&&!f3(Se)||oc(Se))M||(_e&&d3(Se)&&(ui(Se)?Se.value=_e[Qe]:ax(Se,_e[Qe])),y.state.value[i][Qe]=Se);else if(typeof Se=="function"){const Xt=gt(Qe,Se);lt[Qe]=Xt,R.actions[Qe]=Se}}return Xl(ut,lt),Xl(Fn(ut),lt),Object.defineProperty(ut,"$state",{get:()=>y.state.value[i],set:Qe=>{Re(Se=>{Xl(Se,Qe)})}}),y._p.forEach(Qe=>{Xl(ut,C.run(()=>Qe({store:ut,app:y._a,pinia:y,options:R})))}),_e&&M&&p.hydrate&&p.hydrate(ut.$state,_e),B=!0,$=!0,ut}function Kx(i,c,p){let y,T;const M=typeof c=="function";typeof i=="string"?(y=i,T=M?p:c):(T=i,y=i.id);function C(R,o){const B=iz();return R=R||(B?fs(NI,null):null),R&&dy(R),R=BI,R._s.has(y)||(M?$I(y,c,T,R):p3(y,T,R)),R._s.get(y)}return C.$id=y,C}/*!
  * vue-router v4.3.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Bh=typeof document<"u";function m3(i){return i.__esModule||i[Symbol.toStringTag]==="Module"}const ri=Object.assign;function L0(i,c){const p={};for(const y in c){const T=c[y];p[y]=ko(T)?T.map(i):i(T)}return p}const zp=()=>{},ko=Array.isArray,UI=/#/g,_3=/&/g,g3=/\//g,y3=/=/g,v3=/\?/g,jI=/\+/g,x3=/%5B/g,b3=/%5D/g,GI=/%5E/g,w3=/%60/g,HI=/%7B/g,T3=/%7C/g,qI=/%7D/g,S3=/%20/g;function Jx(i){return encodeURI(""+i).replace(T3,"|").replace(x3,"[").replace(b3,"]")}function M3(i){return Jx(i).replace(HI,"{").replace(qI,"}").replace(GI,"^")}function lx(i){return Jx(i).replace(jI,"%2B").replace(S3,"+").replace(UI,"%23").replace(_3,"%26").replace(w3,"`").replace(HI,"{").replace(qI,"}").replace(GI,"^")}function E3(i){return lx(i).replace(y3,"%3D")}function A3(i){return Jx(i).replace(UI,"%23").replace(v3,"%3F")}function I3(i){return i==null?"":A3(i).replace(g3,"%2F")}function Wp(i){try{return decodeURIComponent(""+i)}catch{}return""+i}const C3=/\/$/,P3=i=>i.replace(C3,"");function R0(i,c,p="/"){let y,T={},M="",C="";const R=c.indexOf("#");let o=c.indexOf("?");return R<o&&R>=0&&(o=-1),o>-1&&(y=c.slice(0,o),M=c.slice(o+1,R>-1?R:c.length),T=i(M)),R>-1&&(y=y||c.slice(0,R),C=c.slice(R,c.length)),y=k3(y??c,p),{fullPath:y+(M&&"?")+M+C,path:y,query:T,hash:Wp(C)}}function D3(i,c){const p=c.query?i(c.query):"";return c.path+(p&&"?")+p+(c.hash||"")}function kM(i,c){return!c||!i.toLowerCase().startsWith(c.toLowerCase())?i:i.slice(c.length)||"/"}function L3(i,c,p){const y=c.matched.length-1,T=p.matched.length-1;return y>-1&&y===T&&Xh(c.matched[y],p.matched[T])&&WI(c.params,p.params)&&i(c.query)===i(p.query)&&c.hash===p.hash}function Xh(i,c){return(i.aliasOf||i)===(c.aliasOf||c)}function WI(i,c){if(Object.keys(i).length!==Object.keys(c).length)return!1;for(const p in i)if(!R3(i[p],c[p]))return!1;return!0}function R3(i,c){return ko(i)?OM(i,c):ko(c)?OM(c,i):i===c}function OM(i,c){return ko(c)?i.length===c.length&&i.every((p,y)=>p===c[y]):i.length===1&&i[0]===c}function k3(i,c){if(i.startsWith("/"))return i;if(!i)return c;const p=c.split("/"),y=i.split("/"),T=y[y.length-1];(T===".."||T===".")&&y.push("");let M=p.length-1,C,R;for(C=0;C<y.length;C++)if(R=y[C],R!==".")if(R==="..")M>1&&M--;else break;return p.slice(0,M).join("/")+"/"+y.slice(C).join("/")}var Yp;(function(i){i.pop="pop",i.push="push"})(Yp||(Yp={}));var Fp;(function(i){i.back="back",i.forward="forward",i.unknown=""})(Fp||(Fp={}));function O3(i){if(!i)if(Bh){const c=document.querySelector("base");i=c&&c.getAttribute("href")||"/",i=i.replace(/^\w+:\/\/[^\/]+/,"")}else i="/";return i[0]!=="/"&&i[0]!=="#"&&(i="/"+i),P3(i)}const z3=/^[^#]+#/;function F3(i,c){return i.replace(z3,"#")+c}function B3(i,c){const p=document.documentElement.getBoundingClientRect(),y=i.getBoundingClientRect();return{behavior:c.behavior,left:y.left-p.left-(c.left||0),top:y.top-p.top-(c.top||0)}}const fy=()=>({left:window.scrollX,top:window.scrollY});function N3(i){let c;if("el"in i){const p=i.el,y=typeof p=="string"&&p.startsWith("#"),T=typeof p=="string"?y?document.getElementById(p.slice(1)):document.querySelector(p):p;if(!T)return;c=B3(T,i)}else c=i;"scrollBehavior"in document.documentElement.style?window.scrollTo(c):window.scrollTo(c.left!=null?c.left:window.scrollX,c.top!=null?c.top:window.scrollY)}function zM(i,c){return(history.state?history.state.position-c:-1)+i}const cx=new Map;function V3(i,c){cx.set(i,c)}function $3(i){const c=cx.get(i);return cx.delete(i),c}let U3=()=>location.protocol+"//"+location.host;function YI(i,c){const{pathname:p,search:y,hash:T}=c,M=i.indexOf("#");if(M>-1){let R=T.includes(i.slice(M))?i.slice(M).length:1,o=T.slice(R);return o[0]!=="/"&&(o="/"+o),kM(o,"")}return kM(p,i)+y+T}function j3(i,c,p,y){let T=[],M=[],C=null;const R=({state:ie})=>{const oe=YI(i,location),_e=p.value,Me=c.value;let Re=0;if(ie){if(p.value=oe,c.value=ie,C&&C===_e){C=null;return}Re=Me?ie.position-Me.position:0}else y(oe);T.forEach(Ee=>{Ee(p.value,_e,{delta:Re,type:Yp.pop,direction:Re?Re>0?Fp.forward:Fp.back:Fp.unknown})})};function o(){C=p.value}function B(ie){T.push(ie);const oe=()=>{const _e=T.indexOf(ie);_e>-1&&T.splice(_e,1)};return M.push(oe),oe}function $(){const{history:ie}=window;ie.state&&ie.replaceState(ri({},ie.state,{scroll:fy()}),"")}function H(){for(const ie of M)ie();M=[],window.removeEventListener("popstate",R),window.removeEventListener("beforeunload",$)}return window.addEventListener("popstate",R),window.addEventListener("beforeunload",$,{passive:!0}),{pauseListeners:o,listen:B,destroy:H}}function FM(i,c,p,y=!1,T=!1){return{back:i,current:c,forward:p,replaced:y,position:window.history.length,scroll:T?fy():null}}function G3(i){const{history:c,location:p}=window,y={value:YI(i,p)},T={value:c.state};T.value||M(y.value,{back:null,current:y.value,forward:null,position:c.length-1,replaced:!0,scroll:null},!0);function M(o,B,$){const H=i.indexOf("#"),ie=H>-1?(p.host&&document.querySelector("base")?i:i.slice(H))+o:U3()+i+o;try{c[$?"replaceState":"pushState"](B,"",ie),T.value=B}catch(oe){console.error(oe),p[$?"replace":"assign"](ie)}}function C(o,B){const $=ri({},c.state,FM(T.value.back,o,T.value.forward,!0),B,{position:T.value.position});M(o,$,!0),y.value=o}function R(o,B){const $=ri({},T.value,c.state,{forward:o,scroll:fy()});M($.current,$,!0);const H=ri({},FM(y.value,o,null),{position:$.position+1},B);M(o,H,!1),y.value=o}return{location:y,state:T,push:R,replace:C}}function H3(i){i=O3(i);const c=G3(i),p=j3(i,c.state,c.location,c.replace);function y(M,C=!0){C||p.pauseListeners(),history.go(M)}const T=ri({location:"",base:i,go:y,createHref:F3.bind(null,i)},c,p);return Object.defineProperty(T,"location",{enumerable:!0,get:()=>c.location.value}),Object.defineProperty(T,"state",{enumerable:!0,get:()=>c.state.value}),T}function q3(i){return typeof i=="string"||i&&typeof i=="object"}function ZI(i){return typeof i=="string"||typeof i=="symbol"}const Wl={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},XI=Symbol("");var BM;(function(i){i[i.aborted=4]="aborted",i[i.cancelled=8]="cancelled",i[i.duplicated=16]="duplicated"})(BM||(BM={}));function Kh(i,c){return ri(new Error,{type:i,[XI]:!0},c)}function Ha(i,c){return i instanceof Error&&XI in i&&(c==null||!!(i.type&c))}const NM="[^/]+?",W3={sensitive:!1,strict:!1,start:!0,end:!0},Y3=/[.+*?^${}()[\]/\\]/g;function Z3(i,c){const p=ri({},W3,c),y=[];let T=p.start?"^":"";const M=[];for(const B of i){const $=B.length?[]:[90];p.strict&&!B.length&&(T+="/");for(let H=0;H<B.length;H++){const ie=B[H];let oe=40+(p.sensitive?.25:0);if(ie.type===0)H||(T+="/"),T+=ie.value.replace(Y3,"\\$&"),oe+=40;else if(ie.type===1){const{value:_e,repeatable:Me,optional:Re,regexp:Ee}=ie;M.push({name:_e,repeatable:Me,optional:Re});const mt=Ee||NM;if(mt!==NM){oe+=10;try{new RegExp(`(${mt})`)}catch(dt){throw new Error(`Invalid custom RegExp for param "${_e}" (${mt}): `+dt.message)}}let gt=Me?`((?:${mt})(?:/(?:${mt}))*)`:`(${mt})`;H||(gt=Re&&B.length<2?`(?:/${gt})`:"/"+gt),Re&&(gt+="?"),T+=gt,oe+=20,Re&&(oe+=-8),Me&&(oe+=-20),mt===".*"&&(oe+=-50)}$.push(oe)}y.push($)}if(p.strict&&p.end){const B=y.length-1;y[B][y[B].length-1]+=.7000000000000001}p.strict||(T+="/?"),p.end?T+="$":p.strict&&(T+="(?:/|$)");const C=new RegExp(T,p.sensitive?"":"i");function R(B){const $=B.match(C),H={};if(!$)return null;for(let ie=1;ie<$.length;ie++){const oe=$[ie]||"",_e=M[ie-1];H[_e.name]=oe&&_e.repeatable?oe.split("/"):oe}return H}function o(B){let $="",H=!1;for(const ie of i){(!H||!$.endsWith("/"))&&($+="/"),H=!1;for(const oe of ie)if(oe.type===0)$+=oe.value;else if(oe.type===1){const{value:_e,repeatable:Me,optional:Re}=oe,Ee=_e in B?B[_e]:"";if(ko(Ee)&&!Me)throw new Error(`Provided param "${_e}" is an array but it is not repeatable (* or + modifiers)`);const mt=ko(Ee)?Ee.join("/"):Ee;if(!mt)if(Re)ie.length<2&&($.endsWith("/")?$=$.slice(0,-1):H=!0);else throw new Error(`Missing required param "${_e}"`);$+=mt}}return $||"/"}return{re:C,score:y,keys:M,parse:R,stringify:o}}function X3(i,c){let p=0;for(;p<i.length&&p<c.length;){const y=c[p]-i[p];if(y)return y;p++}return i.length<c.length?i.length===1&&i[0]===80?-1:1:i.length>c.length?c.length===1&&c[0]===80?1:-1:0}function K3(i,c){let p=0;const y=i.score,T=c.score;for(;p<y.length&&p<T.length;){const M=X3(y[p],T[p]);if(M)return M;p++}if(Math.abs(T.length-y.length)===1){if(VM(y))return 1;if(VM(T))return-1}return T.length-y.length}function VM(i){const c=i[i.length-1];return i.length>0&&c[c.length-1]<0}const J3={type:0,value:""},Q3=/[a-zA-Z0-9_]/;function eF(i){if(!i)return[[]];if(i==="/")return[[J3]];if(!i.startsWith("/"))throw new Error(`Invalid path "${i}"`);function c(oe){throw new Error(`ERR (${p})/"${B}": ${oe}`)}let p=0,y=p;const T=[];let M;function C(){M&&T.push(M),M=[]}let R=0,o,B="",$="";function H(){B&&(p===0?M.push({type:0,value:B}):p===1||p===2||p===3?(M.length>1&&(o==="*"||o==="+")&&c(`A repeatable param (${B}) must be alone in its segment. eg: '/:ids+.`),M.push({type:1,value:B,regexp:$,repeatable:o==="*"||o==="+",optional:o==="*"||o==="?"})):c("Invalid state to consume buffer"),B="")}function ie(){B+=o}for(;R<i.length;){if(o=i[R++],o==="\\"&&p!==2){y=p,p=4;continue}switch(p){case 0:o==="/"?(B&&H(),C()):o===":"?(H(),p=1):ie();break;case 4:ie(),p=y;break;case 1:o==="("?p=2:Q3.test(o)?ie():(H(),p=0,o!=="*"&&o!=="?"&&o!=="+"&&R--);break;case 2:o===")"?$[$.length-1]=="\\"?$=$.slice(0,-1)+o:p=3:$+=o;break;case 3:H(),p=0,o!=="*"&&o!=="?"&&o!=="+"&&R--,$="";break;default:c("Unknown state");break}}return p===2&&c(`Unfinished custom RegExp for param "${B}"`),H(),C(),T}function tF(i,c,p){const y=Z3(eF(i.path),p),T=ri(y,{record:i,parent:c,children:[],alias:[]});return c&&!T.record.aliasOf==!c.record.aliasOf&&c.children.push(T),T}function rF(i,c){const p=[],y=new Map;c=jM({strict:!1,end:!0,sensitive:!1},c);function T($){return y.get($)}function M($,H,ie){const oe=!ie,_e=nF($);_e.aliasOf=ie&&ie.record;const Me=jM(c,$),Re=[_e];if("alias"in $){const gt=typeof $.alias=="string"?[$.alias]:$.alias;for(const dt of gt)Re.push(ri({},_e,{components:ie?ie.record.components:_e.components,path:dt,aliasOf:ie?ie.record:_e}))}let Ee,mt;for(const gt of Re){const{path:dt}=gt;if(H&&dt[0]!=="/"){const ut=H.record.path,ht=ut[ut.length-1]==="/"?"":"/";gt.path=H.record.path+(dt&&ht+dt)}if(Ee=tF(gt,H,Me),ie?ie.alias.push(Ee):(mt=mt||Ee,mt!==Ee&&mt.alias.push(Ee),oe&&$.name&&!UM(Ee)&&C($.name)),_e.children){const ut=_e.children;for(let ht=0;ht<ut.length;ht++)M(ut[ht],Ee,ie&&ie.children[ht])}ie=ie||Ee,(Ee.record.components&&Object.keys(Ee.record.components).length||Ee.record.name||Ee.record.redirect)&&o(Ee)}return mt?()=>{C(mt)}:zp}function C($){if(ZI($)){const H=y.get($);H&&(y.delete($),p.splice(p.indexOf(H),1),H.children.forEach(C),H.alias.forEach(C))}else{const H=p.indexOf($);H>-1&&(p.splice(H,1),$.record.name&&y.delete($.record.name),$.children.forEach(C),$.alias.forEach(C))}}function R(){return p}function o($){let H=0;for(;H<p.length&&K3($,p[H])>=0&&($.record.path!==p[H].record.path||!KI($,p[H]));)H++;p.splice(H,0,$),$.record.name&&!UM($)&&y.set($.record.name,$)}function B($,H){let ie,oe={},_e,Me;if("name"in $&&$.name){if(ie=y.get($.name),!ie)throw Kh(1,{location:$});Me=ie.record.name,oe=ri($M(H.params,ie.keys.filter(mt=>!mt.optional).concat(ie.parent?ie.parent.keys.filter(mt=>mt.optional):[]).map(mt=>mt.name)),$.params&&$M($.params,ie.keys.map(mt=>mt.name))),_e=ie.stringify(oe)}else if($.path!=null)_e=$.path,ie=p.find(mt=>mt.re.test(_e)),ie&&(oe=ie.parse(_e),Me=ie.record.name);else{if(ie=H.name?y.get(H.name):p.find(mt=>mt.re.test(H.path)),!ie)throw Kh(1,{location:$,currentLocation:H});Me=ie.record.name,oe=ri({},H.params,$.params),_e=ie.stringify(oe)}const Re=[];let Ee=ie;for(;Ee;)Re.unshift(Ee.record),Ee=Ee.parent;return{name:Me,path:_e,params:oe,matched:Re,meta:sF(Re)}}return i.forEach($=>M($)),{addRoute:M,resolve:B,removeRoute:C,getRoutes:R,getRecordMatcher:T}}function $M(i,c){const p={};for(const y of c)y in i&&(p[y]=i[y]);return p}function nF(i){return{path:i.path,redirect:i.redirect,name:i.name,meta:i.meta||{},aliasOf:void 0,beforeEnter:i.beforeEnter,props:iF(i),children:i.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in i?i.components||null:i.component&&{default:i.component}}}function iF(i){const c={},p=i.props||!1;if("component"in i)c.default=p;else for(const y in i.components)c[y]=typeof p=="object"?p[y]:p;return c}function UM(i){for(;i;){if(i.record.aliasOf)return!0;i=i.parent}return!1}function sF(i){return i.reduce((c,p)=>ri(c,p.meta),{})}function jM(i,c){const p={};for(const y in i)p[y]=y in c?c[y]:i[y];return p}function KI(i,c){return c.children.some(p=>p===i||KI(i,p))}function oF(i){const c={};if(i===""||i==="?")return c;const y=(i[0]==="?"?i.slice(1):i).split("&");for(let T=0;T<y.length;++T){const M=y[T].replace(jI," "),C=M.indexOf("="),R=Wp(C<0?M:M.slice(0,C)),o=C<0?null:Wp(M.slice(C+1));if(R in c){let B=c[R];ko(B)||(B=c[R]=[B]),B.push(o)}else c[R]=o}return c}function GM(i){let c="";for(let p in i){const y=i[p];if(p=E3(p),y==null){y!==void 0&&(c+=(c.length?"&":"")+p);continue}(ko(y)?y.map(M=>M&&lx(M)):[y&&lx(y)]).forEach(M=>{M!==void 0&&(c+=(c.length?"&":"")+p,M!=null&&(c+="="+M))})}return c}function aF(i){const c={};for(const p in i){const y=i[p];y!==void 0&&(c[p]=ko(y)?y.map(T=>T==null?null:""+T):y==null?y:""+y)}return c}const lF=Symbol(""),HM=Symbol(""),py=Symbol(""),JI=Symbol(""),ux=Symbol("");function bp(){let i=[];function c(y){return i.push(y),()=>{const T=i.indexOf(y);T>-1&&i.splice(T,1)}}function p(){i=[]}return{add:c,list:()=>i.slice(),reset:p}}function tc(i,c,p,y,T,M=C=>C()){const C=y&&(y.enterCallbacks[T]=y.enterCallbacks[T]||[]);return()=>new Promise((R,o)=>{const B=ie=>{ie===!1?o(Kh(4,{from:p,to:c})):ie instanceof Error?o(ie):q3(ie)?o(Kh(2,{from:c,to:ie})):(C&&y.enterCallbacks[T]===C&&typeof ie=="function"&&C.push(ie),R())},$=M(()=>i.call(y&&y.instances[T],c,p,B));let H=Promise.resolve($);i.length<3&&(H=H.then(B)),H.catch(ie=>o(ie))})}function k0(i,c,p,y,T=M=>M()){const M=[];for(const C of i)for(const R in C.components){let o=C.components[R];if(!(c!=="beforeRouteEnter"&&!C.instances[R]))if(cF(o)){const $=(o.__vccOpts||o)[c];$&&M.push(tc($,p,y,C,R,T))}else{let B=o();M.push(()=>B.then($=>{if(!$)return Promise.reject(new Error(`Couldn't resolve component "${R}" at "${C.path}"`));const H=m3($)?$.default:$;C.components[R]=H;const oe=(H.__vccOpts||H)[c];return oe&&tc(oe,p,y,C,R,T)()}))}}return M}function cF(i){return typeof i=="object"||"displayName"in i||"props"in i||"__vccOpts"in i}function qM(i){const c=fs(py),p=fs(JI),y=rt(()=>c.resolve(yt(i.to))),T=rt(()=>{const{matched:o}=y.value,{length:B}=o,$=o[B-1],H=p.matched;if(!$||!H.length)return-1;const ie=H.findIndex(Xh.bind(null,$));if(ie>-1)return ie;const oe=WM(o[B-2]);return B>1&&WM($)===oe&&H[H.length-1].path!==oe?H.findIndex(Xh.bind(null,o[B-2])):ie}),M=rt(()=>T.value>-1&&fF(p.params,y.value.params)),C=rt(()=>T.value>-1&&T.value===p.matched.length-1&&WI(p.params,y.value.params));function R(o={}){return dF(o)?c[yt(i.replace)?"replace":"push"](yt(i.to)).catch(zp):Promise.resolve()}return{route:y,href:rt(()=>y.value.href),isActive:M,isExactActive:C,navigate:R}}const uF=Gi({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:qM,setup(i,{slots:c}){const p=Xs(qM(i)),{options:y}=fs(py),T=rt(()=>({[YM(i.activeClass,y.linkActiveClass,"router-link-active")]:p.isActive,[YM(i.exactActiveClass,y.linkExactActiveClass,"router-link-exact-active")]:p.isExactActive}));return()=>{const M=c.default&&c.default(p);return i.custom?M:Xx("a",{"aria-current":p.isExactActive?i.ariaCurrentValue:null,href:p.href,onClick:p.navigate,class:T.value},M)}}}),hF=uF;function dF(i){if(!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)&&!i.defaultPrevented&&!(i.button!==void 0&&i.button!==0)){if(i.currentTarget&&i.currentTarget.getAttribute){const c=i.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(c))return}return i.preventDefault&&i.preventDefault(),!0}}function fF(i,c){for(const p in c){const y=c[p],T=i[p];if(typeof y=="string"){if(y!==T)return!1}else if(!ko(T)||T.length!==y.length||y.some((M,C)=>M!==T[C]))return!1}return!0}function WM(i){return i?i.aliasOf?i.aliasOf.path:i.path:""}const YM=(i,c,p)=>i??c??p,pF=Gi({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(i,{attrs:c,slots:p}){const y=fs(ux),T=rt(()=>i.route||y.value),M=fs(HM,0),C=rt(()=>{let B=yt(M);const{matched:$}=T.value;let H;for(;(H=$[B])&&!H.components;)B++;return B}),R=rt(()=>T.value.matched[C.value]);Xa(HM,rt(()=>C.value+1)),Xa(lF,R),Xa(ux,T);const o=Zr();return Oi(()=>[o.value,R.value,i.name],([B,$,H],[ie,oe,_e])=>{$&&($.instances[H]=B,oe&&oe!==$&&B&&B===ie&&($.leaveGuards.size||($.leaveGuards=oe.leaveGuards),$.updateGuards.size||($.updateGuards=oe.updateGuards))),B&&$&&(!oe||!Xh($,oe)||!ie)&&($.enterCallbacks[H]||[]).forEach(Me=>Me(B))},{flush:"post"}),()=>{const B=T.value,$=i.name,H=R.value,ie=H&&H.components[$];if(!ie)return ZM(p.default,{Component:ie,route:B});const oe=H.props[$],_e=oe?oe===!0?B.params:typeof oe=="function"?oe(B):oe:null,Re=Xx(ie,ri({},_e,c,{onVnodeUnmounted:Ee=>{Ee.component.isUnmounted&&(H.instances[$]=null)},ref:o}));return ZM(p.default,{Component:Re,route:B})||Re}}});function ZM(i,c){if(!i)return null;const p=i(c);return p.length===1?p[0]:p}const hx=pF;function mF(i){const c=rF(i.routes,i),p=i.parseQuery||oF,y=i.stringifyQuery||GM,T=i.history,M=bp(),C=bp(),R=bp(),o=fO(Wl);let B=Wl;Bh&&i.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const $=L0.bind(null,it=>""+it),H=L0.bind(null,I3),ie=L0.bind(null,Wp);function oe(it,Kt){let Gt,ir;return ZI(it)?(Gt=c.getRecordMatcher(it),ir=Kt):ir=it,c.addRoute(ir,Gt)}function _e(it){const Kt=c.getRecordMatcher(it);Kt&&c.removeRoute(Kt)}function Me(){return c.getRoutes().map(it=>it.record)}function Re(it){return!!c.getRecordMatcher(it)}function Ee(it,Kt){if(Kt=ri({},Kt||o.value),typeof it=="string"){const ye=R0(p,it,Kt.path),qe=c.resolve({path:ye.path},Kt),ft=T.createHref(ye.fullPath);return ri(ye,qe,{params:ie(qe.params),hash:Wp(ye.hash),redirectedFrom:void 0,href:ft})}let Gt;if(it.path!=null)Gt=ri({},it,{path:R0(p,it.path,Kt.path).path});else{const ye=ri({},it.params);for(const qe in ye)ye[qe]==null&&delete ye[qe];Gt=ri({},it,{params:H(ye)}),Kt.params=H(Kt.params)}const ir=c.resolve(Gt,Kt),Vr=it.hash||"";ir.params=$(ie(ir.params));const Kr=D3(y,ri({},it,{hash:M3(Vr),path:ir.path})),pe=T.createHref(Kr);return ri({fullPath:Kr,hash:Vr,query:y===GM?aF(it.query):it.query||{}},ir,{redirectedFrom:void 0,href:pe})}function mt(it){return typeof it=="string"?R0(p,it,o.value.path):ri({},it)}function gt(it,Kt){if(B!==it)return Kh(8,{from:Kt,to:it})}function dt(it){return lt(it)}function ut(it){return dt(ri(mt(it),{replace:!0}))}function ht(it){const Kt=it.matched[it.matched.length-1];if(Kt&&Kt.redirect){const{redirect:Gt}=Kt;let ir=typeof Gt=="function"?Gt(it):Gt;return typeof ir=="string"&&(ir=ir.includes("?")||ir.includes("#")?ir=mt(ir):{path:ir},ir.params={}),ri({query:it.query,hash:it.hash,params:ir.path!=null?{}:it.params},ir)}}function lt(it,Kt){const Gt=B=Ee(it),ir=o.value,Vr=it.state,Kr=it.force,pe=it.replace===!0,ye=ht(Gt);if(ye)return lt(ri(mt(ye),{state:typeof ye=="object"?ri({},Vr,ye.state):Vr,force:Kr,replace:pe}),Kt||Gt);const qe=Gt;qe.redirectedFrom=Kt;let ft;return!Kr&&L3(y,ir,Gt)&&(ft=Kh(16,{to:qe,from:ir}),zr(ir,ir,!0,!1)),(ft?Promise.resolve(ft):Xt(qe,ir)).catch(ct=>Ha(ct)?Ha(ct,2)?ct:Ft(ct):zt(ct,qe,ir)).then(ct=>{if(ct){if(Ha(ct,2))return lt(ri({replace:pe},mt(ct.to),{state:typeof ct.to=="object"?ri({},Vr,ct.to.state):Vr,force:Kr}),Kt||qe)}else ct=Ve(qe,ir,!0,pe,Vr);return xr(qe,ir,ct),ct})}function Qe(it,Kt){const Gt=gt(it,Kt);return Gt?Promise.reject(Gt):Promise.resolve()}function Se(it){const Kt=dn.values().next().value;return Kt&&typeof Kt.runWithContext=="function"?Kt.runWithContext(it):it()}function Xt(it,Kt){let Gt;const[ir,Vr,Kr]=_F(it,Kt);Gt=k0(ir.reverse(),"beforeRouteLeave",it,Kt);for(const ye of ir)ye.leaveGuards.forEach(qe=>{Gt.push(tc(qe,it,Kt))});const pe=Qe.bind(null,it,Kt);return Gt.push(pe),bn(Gt).then(()=>{Gt=[];for(const ye of M.list())Gt.push(tc(ye,it,Kt));return Gt.push(pe),bn(Gt)}).then(()=>{Gt=k0(Vr,"beforeRouteUpdate",it,Kt);for(const ye of Vr)ye.updateGuards.forEach(qe=>{Gt.push(tc(qe,it,Kt))});return Gt.push(pe),bn(Gt)}).then(()=>{Gt=[];for(const ye of Kr)if(ye.beforeEnter)if(ko(ye.beforeEnter))for(const qe of ye.beforeEnter)Gt.push(tc(qe,it,Kt));else Gt.push(tc(ye.beforeEnter,it,Kt));return Gt.push(pe),bn(Gt)}).then(()=>(it.matched.forEach(ye=>ye.enterCallbacks={}),Gt=k0(Kr,"beforeRouteEnter",it,Kt,Se),Gt.push(pe),bn(Gt))).then(()=>{Gt=[];for(const ye of C.list())Gt.push(tc(ye,it,Kt));return Gt.push(pe),bn(Gt)}).catch(ye=>Ha(ye,8)?ye:Promise.reject(ye))}function xr(it,Kt,Gt){R.list().forEach(ir=>Se(()=>ir(it,Kt,Gt)))}function Ve(it,Kt,Gt,ir,Vr){const Kr=gt(it,Kt);if(Kr)return Kr;const pe=Kt===Wl,ye=Bh?history.state:{};Gt&&(ir||pe?T.replace(it.fullPath,ri({scroll:pe&&ye&&ye.scroll},Vr)):T.push(it.fullPath,Vr)),o.value=it,zr(it,Kt,Gt,pe),Ft()}let jt;function Ur(){jt||(jt=T.listen((it,Kt,Gt)=>{if(!Bn.listening)return;const ir=Ee(it),Vr=ht(ir);if(Vr){lt(ri(Vr,{replace:!0}),ir).catch(zp);return}B=ir;const Kr=o.value;Bh&&V3(zM(Kr.fullPath,Gt.delta),fy()),Xt(ir,Kr).catch(pe=>Ha(pe,12)?pe:Ha(pe,2)?(lt(pe.to,ir).then(ye=>{Ha(ye,20)&&!Gt.delta&&Gt.type===Yp.pop&&T.go(-1,!1)}).catch(zp),Promise.reject()):(Gt.delta&&T.go(-Gt.delta,!1),zt(pe,ir,Kr))).then(pe=>{pe=pe||Ve(ir,Kr,!1),pe&&(Gt.delta&&!Ha(pe,8)?T.go(-Gt.delta,!1):Gt.type===Yp.pop&&Ha(pe,20)&&T.go(-1,!1)),xr(ir,Kr,pe)}).catch(zp)}))}let $e=bp(),ur=bp(),gr;function zt(it,Kt,Gt){Ft(it);const ir=ur.list();return ir.length?ir.forEach(Vr=>Vr(it,Kt,Gt)):console.error(it),Promise.reject(it)}function vn(){return gr&&o.value!==Wl?Promise.resolve():new Promise((it,Kt)=>{$e.add([it,Kt])})}function Ft(it){return gr||(gr=!it,Ur(),$e.list().forEach(([Kt,Gt])=>it?Gt(it):Kt()),$e.reset()),it}function zr(it,Kt,Gt,ir){const{scrollBehavior:Vr}=i;if(!Bh||!Vr)return Promise.resolve();const Kr=!Gt&&$3(zM(it.fullPath,0))||(ir||!Gt)&&history.state&&history.state.scroll||null;return qa().then(()=>Vr(it,Kt,Kr)).then(pe=>pe&&N3(pe)).catch(pe=>zt(pe,it,Kt))}const nr=it=>T.go(it);let En;const dn=new Set,Bn={currentRoute:o,listening:!0,addRoute:oe,removeRoute:_e,hasRoute:Re,getRoutes:Me,resolve:Ee,options:i,push:dt,replace:ut,go:nr,back:()=>nr(-1),forward:()=>nr(1),beforeEach:M.add,beforeResolve:C.add,afterEach:R.add,onError:ur.add,isReady:vn,install(it){const Kt=this;it.component("RouterLink",hF),it.component("RouterView",hx),it.config.globalProperties.$router=Kt,Object.defineProperty(it.config.globalProperties,"$route",{enumerable:!0,get:()=>yt(o)}),Bh&&!En&&o.value===Wl&&(En=!0,dt(T.location).catch(Vr=>{}));const Gt={};for(const Vr in Wl)Object.defineProperty(Gt,Vr,{get:()=>o.value[Vr],enumerable:!0});it.provide(py,Kt),it.provide(JI,XA(Gt)),it.provide(ux,o);const ir=it.unmount;dn.add(it),it.unmount=function(){dn.delete(it),dn.size<1&&(B=Wl,jt&&jt(),jt=null,o.value=Wl,En=!1,gr=!1),ir()}}};function bn(it){return it.reduce((Kt,Gt)=>Kt.then(()=>Se(Gt)),Promise.resolve())}return Bn}function _F(i,c){const p=[],y=[],T=[],M=Math.max(c.matched.length,i.matched.length);for(let C=0;C<M;C++){const R=c.matched[C];R&&(i.matched.find(B=>Xh(B,R))?y.push(R):p.push(R));const o=i.matched[C];o&&(c.matched.find(B=>Xh(B,o))||T.push(o))}return[p,y,T]}function Qx(){return fs(py)}const gF={__name:"App",setup(i){return localStorage.language="es",(c,p)=>(It(),Wt(Mn,null,[_r(yt(hx)),_r(yt(hx))],64))}},yF=["es","en"],vF=[["Seccin 1","Section 1"],["Seccin 2","Section 2"],["Seccin 3","Section 3"],["es-fot-1","en-fot-1"],["es-fot-2","en-fot-2"],["es-fot-3","en-fot-3"]],XM={languages:yF,dictionary:vF},mo=Kx("i18n",()=>{const i=Xs(XM.languages),c=Xs(XM.dictionary),p=Zr(M());function y(C){const R=c.findIndex(B=>B[0]===C),o=i.findIndex(B=>B===p.value);return R===-1||o===-1?C:c[R][o]}function T(C){i.includes(C)&&(p.value=C),localStorage.setItem("language",p.value)}function M(){return localStorage.getItem("language")||i[0]}return{_:y,languages:i,language:p,set:T,get:M}}),ho=Kx("data",()=>{const i=Xs({header:{es:{txt1:"Producto",txt2:"Contacto",txt3:"Blog",txt4:"Sobre nosotros",txt5:"Inscribirse",txt6:"Registrarse"},en:{txt1:"Product",txt2:"Contact",txt3:"Blog",txt4:"About",txt5:"Login",txt6:"Sign in"},links:{link1:"/product",link2:"/contact",link3:"/blog",link4:"/about",link5:"/login",link6:"/login"}},layer1:{es:{txt1:"Transformando la Experiencia de Viaje",txt2:"Encuentra el camino hacia tu viaje",txt3:"Organiza tu viaje ideal con nosotros"},en:{txt1:"Transforming the Travel Experience",txt2:"Find the way to your journey",txt3:"Organize your ideal trip with us"}},search:{es:{txt1:"Donde quieres ir de viaje?",txt2:"Generar viaje"},en:{txt1:"Where are you going to?",txt2:"Generate trip"}},aboutSection1:{es:{span1:"Descubre tu",span2:"prxima aventura",txt1:"Selecciona y personaliza tu viaje",txt2:"Comienza tu viaje"},en:{span1:"Discover your",span2:"next adventure",txt1:"Select and customize your trip",txt2:"Start your journey"}},aboutSection3:{es:{type0:{txt1:"Simplicidad en Accion",txt2:"Introduce un prompt, genera un plan de viaje",btn1:"Ver cmo"},type1:{txt1:"Emprende la aventura",txt2:"El mundo te espera, descbrelo",btn1:"nete Ahora",btn2:"Saber ms"}},en:{type0:{txt1:"Simplicity in Action",txt2:"Enter a prompt, generate a travel plan",btn1:"See how"},type1:{txt1:"Start the adventure",txt2:"The world awaits you, discover it",btn1:"Join Now",btn2:"Learn more"}}},aboutSection4:{es:{title1:"Propmt Inteligente",title2:"Aventuras a medida",title3:"Exploracin mundial",title4:"Itinerarios instantneos",txt1:"Tecnologa que convierte palabras en itinerarios",txt2:"Personalice sus viajes con la creatividad de la IA",txt3:"Descubra destinos gracias a la inteligencia artificial",txt4:"Generar rpidamente planes para cualquier ayuda"},en:{title1:"Propmt Inteligence",title2:"Custom Adventures",title3:"Global Exploration",title4:"Instant Itinieraries",txt1:"Technology that turns words into itineraries",txt2:"Personalize your travel with AI creativity",txt3:"Discover destinations throught AI insights",txt4:"Quickly generate plans for any help"}},footerTeo:{es:{txt1:"Todos los derechos reservados 2024"},en:{txt1:"All rights reserved 2024"}}});function c(p,y){return i[p][y]}return{get:c}}),xF="/assets/logo-CKH6eN2w.png",Ki=(i,c)=>{const p=i.__vccOpts||i;for(const[y,T]of c)p[y]=T;return p},bF=["value"],wF={__name:"traduction",setup(i){const c=mo(),p=localStorage.language?localStorage.language:"es",y=Zr(p);function T(M){c.set(M.target.value)}return(M,C)=>(It(),Wt("div",null,[uc(Ue("select",{onChange:T,"onUpdate:modelValue":C[0]||(C[0]=R=>y.value=R)},[(It(!0),Wt(Mn,null,Xi(yt(c).languages,(R,o)=>(It(),Wt("option",{key:o,value:R},Mi(R),9,bF))),128))],544),[[Qz,y.value]])]))}},QI=Ki(wF,[["__scopeId","data-v-af2f236d"]]),TF=i=>(fc("data-v-597799ef"),i=i(),pc(),i),SF=TF(()=>Ue("img",{src:"",alt:""},null,-1)),MF={id:"menu-content"},EF={id:"nav"},AF={id:"col1"},IF=["href","innerHTML"],CF={__name:"mobileMenu",setup(i){const c=mo(),p=rt(()=>ho().get("header",c.language)),y=rt(()=>ho().get("header","links")),T=Zr(Object.keys(p.value).length),M=Zr(!1),C=Zr(window.innerWidth);window.addEventListener("resize",()=>{window.innerWidth<=1200?C.value=!0:(C.value,M.value=!1)});function R(){M.value=!M.value}return(o,B)=>(It(),Wt("div",null,[Ue("div",{id:"desp",onClick:R},[SF,im("= ")]),_r(QI,{id:"Mtraduction"}),C.value<=1200?(It(),Wt("div",{key:0,id:"menu",class:Rn({desplegar:M.value})},[Ue("div",MF,[Ue("nav",EF,[Ue("ul",AF,[(It(!0),Wt(Mn,null,Xi(T.value,($,H)=>(It(),Wt("li",{key:H},[Ue("a",{href:y.value["link"+$],innerHTML:p.value["txt"+$]},null,8,IF)]))),128))])])])],2)):Ei("",!0)]))}},PF=Ki(CF,[["__scopeId","data-v-597799ef"]]),DF={class:"logo"},LF={href:"/"},RF=["src"],kF={id:"col1"},OF=["href","innerHTML"],zF={id:"col2"},FF=["href","innerHTML"],KM=4,BF={__name:"HeaderComponent",setup(i){const c=mo(),p=ho(),y=rt(()=>p.get("header",c.language)),T=rt(()=>p.get("header","links")),M=rt(()=>Object.keys(y.value).length);return(C,R)=>(It(),Wt(Mn,null,[_r(PF),Ue("header",null,[Ue("div",DF,[Ue("a",LF,[Ue("img",{src:yt(xF),alt:"logo"},null,8,RF)])]),Ue("ul",kF,[(It(!0),Wt(Mn,null,Xi(Math.min(M.value,KM),(o,B)=>(It(),Wt("li",{key:B},[Ue("a",{href:T.value["link"+o],innerHTML:y.value["txt"+o]},null,8,OF)]))),128))]),Ue("ul",zF,[_r(QI,{id:"traduction"}),(It(!0),Wt(Mn,null,Xi(Math.max(0,M.value-KM),(o,B)=>(It(),Wt("li",{key:B},[Ue("a",{href:T.value["link"+(M.value-B)],innerHTML:y.value["txt"+(M.value-B)]},null,8,FF)]))),128))])])],64))}},my=Ki(BF,[["__scopeId","data-v-1b7d3dad"]]);var NF=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function VF(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var eC={exports:{}};(function(i,c){var p={};(function(y,T){i.exports=T()})(NF,function(){var y,T,M;function C(o,B){if(!y)y=B;else if(!T)T=B;else{var $="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+y+")(sharedChunk); ("+T+")(sharedChunk); self.onerror = null;",H={};y(H),M=B(H),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(M.workerUrl=window.URL.createObjectURL(new Blob([$],{type:"text/javascript"})))}}C(["exports"],function(o){var B="3.3.0";let $;const H={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if($==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{$=p.API_URL_REGEX!=null?new RegExp(p.API_URL_REGEX):t}catch{$=t}}return $},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!H.API_URL)return null;try{const t=new URL(H.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function ie(t){return H.API_URL_REGEX.test(t)}function oe(t){return t.indexOf("mapbox:")===0}function _e(t){return H.API_CDN_URL_REGEX.test(t)}function Me(t){return H.API_SPRITE_REGEX.test(t)}function Re(t){return H.API_STYLE_REGEX.test(t)&&!Me(t)}const Ee={create:"create",load:"load",fullLoad:"fullLoad"};function mt(t){const e=t.name.split("?")[0];return _e(e)&&e.includes("mapbox-gl.js")?"javascript":_e(e)&&e.includes("mapbox-gl.css")?"css":function(r){return H.API_FONTS_REGEX.test(r)}(e)?"fontRange":Me(e)?"sprite":Re(e)?"style":function(r){return H.API_TILEJSON_REGEX.test(r)}(e)?"tilejson":"other"}function gt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var dt=ut;function ut(t,e,r,s){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=r,this.p2y=s}ut.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var r=t,s=0;s<8;s++){var l=this.sampleCurveX(r)-t;if(Math.abs(l)<e)return r;var u=this.sampleCurveDerivativeX(r);if(Math.abs(u)<1e-6)break;r-=l/u}var f=0,_=1;for(r=t,s=0;s<20&&(l=this.sampleCurveX(r),!(Math.abs(l-t)<e));s++)t>l?f=r:_=r,r=.5*(_-f)+f;return r},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var ht=gt(dt),lt=Qe;function Qe(t,e){this.x=t,this.y=e}Qe.prototype={clone:function(){return new Qe(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(t,e){var r=Math.cos(t),s=Math.sin(t),l=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Qe.convert=function(t){return t instanceof Qe?t:Array.isArray(t)?new Qe(t[0],t[1]):t};var Se=gt(lt);const Xt=Math.PI/180,xr=180/Math.PI;function Ve(t){return t*Xt}function jt(t){return t*xr}const Ur=[[0,0],[1,0],[1,1],[0,1]];function $e(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function ur(t,e,r,s){const l=new ht(t,e,r,s);return function(u){return l.solve(u)}}const gr=ur(.25,.1,.25,1);function zt(t,e,r){return Math.min(r,Math.max(e,t))}function vn(t,e,r){return(r=zt((r-t)/(e-t),0,1))*r*(3-2*r)}function Ft(t,e,r){const s=r-e,l=((t-e)%s+s)%s+e;return l===e?r:l}function zr(t,e,r){if(!t.length)return r(null,[]);let s=t.length;const l=new Array(t.length);let u=null;t.forEach((f,_)=>{e(f,(v,x)=>{v&&(u=v),l[_]=x,--s==0&&r(u,l)})})}function nr(t,...e){for(const r of e)for(const s in r)t[s]=r[s];return t}let En=1;function dn(){return En++}function Bn(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function bn(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function it(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Kt(t,e){t.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Gt(t,e){return t.indexOf(e,t.length-e.length)!==-1}function ir(t,e,r){const s={};for(const l in t)s[l]=e.call(r||this,t[l],l,t);return s}function Vr(t,e,r){const s={};for(const l in t)e.call(r||this,t[l],l,t)&&(s[l]=t[l]);return s}function Kr(t){return Array.isArray(t)?t.map(Kr):typeof t=="object"&&t?ir(t,Kr):t}const pe={};function ye(t){pe[t]||(typeof console<"u"&&console.warn(t),pe[t]=!0)}function qe(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function ft(t){let e=0;for(let r,s,l=0,u=t.length,f=u-1;l<u;f=l++)r=t[l],s=t[f],e+=(s.x-r.x)*(r.y+s.y);return e}function ct([t,e,r]){const s=Ve(e+90),l=Ve(r);return{x:t*Math.cos(s)*Math.sin(l),y:t*Math.sin(s)*Math.sin(l),z:t*Math.cos(l),azimuthal:e,polar:r}}function Bt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function tr(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,l,u)=>{const f=l||u;return e[s]=!f||f.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let vt,Yt,Pt,rr,br,yr,Ie=null;function Z(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function te(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function he(t,e,r,s){for(;e<r;){const l=e+r>>1;t[l]<s?e=l+1:r=l}return e}function ke(t,e,r,s){for(;e<r;){const l=e+r>>1;t[l]<=s?e=l+1:r=l}return e}function We(){return vt==null&&(vt=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),vt}const nt={now:()=>rr!==void 0?rr:performance.now(),setNow(t){rr=t},restoreNow(){rr=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:r,height:s}=t;br||(br=document.createElement("canvas"));const l=br.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(r>br.width||s>br.height)&&(br.width=r,br.height=s),l.clearRect(-e,-e,r+2*e,s+2*e),l.drawImage(t,0,0,r,s),l.getImageData(-e,-e,r+2*e,s+2*e)},resolveURL:t=>(Yt||(Yt=document.createElement("a")),Yt.href=t,Yt.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Pt==null&&(Pt=window.matchMedia("(prefers-reduced-motion: reduce)")),Pt.matches)},hasCanvasFingerprintNoise(){if(yr!==void 0)return yr;if(!We())return yr=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let r=0;for(let l=0;l<t.width;++l)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(l,0,1,1);const s=e.getImageData(0,0,t.width,t.height);r=0;for(let l=0;l<s.data.length;++l)if(l%4!=3&&r++!==s.data[l])return yr=!0,!0;return yr=!1,!1}},Ut="mapbox-tiles";let Ge=500,Ht=50,Et,Pe;function ue(){try{return caches}catch{}}function Je(){const t=ue();t&&!Et&&(Et=t.open(Ut))}function Ot(t){const e=t.indexOf("?");if(e<0)return t;const r=["language","worldview"],s=new URLSearchParams,l=new URLSearchParams(t.slice(e));for(const u of r){const f=l.get(u);f&&s.set(u,f)}return`${t.slice(0,e)}?${s.toString()}`}function hr(t,e){const r=t.indexOf("?");if(r<0)return`${t}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(t.slice(r));for(const l in e)s.set(l,e[l]);return`${t.slice(0,r)}?${s.toString()}`}let Sr=1/0;const Rr={supported:!1,testSupport:function(t){!Qn&&Tn&&(An?bi(t):Hr=t)}};let Hr,Tn,Qn=!1,An=!1;const Vn=typeof self<"u"?self:{};function bi(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Tn),t.isContextLost())return;Rr.supported=!0}catch{}t.deleteTexture(e),Qn=!0}Vn.document&&(Tn=Vn.document.createElement("img"),Tn.onload=function(){Hr&&bi(Hr),Hr=null,An=!0},Tn.onerror=function(){Qn=!0,Hr=null},Tn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ci={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Ci);class Wn extends Error{constructor(e,r,s){r===401&&ie(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const jn=Bt()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,He=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(jn())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(s,l){const u=new AbortController,f=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:jn(),referrerPolicy:s.referrerPolicy,signal:u.signal});let _=!1,v=!1;const x=(w=f.url).indexOf("sku=")>0&&ie(w);var w;s.type==="json"&&f.headers.set("Accept","application/json");const E=(L,O,z)=>{if(v)return;if(L&&L.message!=="SecurityError"&&ye(L.toString()),O&&z)return I(O);const V=Date.now();fetch(f).then(j=>{if(j.ok){const K=x?j.clone():null;return I(j,K,V)}return l(new Wn(j.statusText,j.status,s.url))}).catch(j=>{j.name!=="AbortError"&&l(new Error(`${j.message} ${s.url}`))})},I=(L,O,z)=>{(s.type==="arrayBuffer"?L.arrayBuffer():s.type==="json"?L.json():L.text()).then(V=>{v||(O&&z&&function(j,K,ee){if(Je(),!Et)return;const Q=tr(K.headers.get("Cache-Control")||"");if(Q["no-store"])return;const le={status:K.status,statusText:K.statusText,headers:new Headers};K.headers.forEach((ve,we)=>le.headers.set(we,ve)),Q["max-age"]&&le.headers.set("Expires",new Date(ee+1e3*Q["max-age"]).toUTCString());const ae=le.headers.get("Expires");if(!ae||new Date(ae).getTime()-ee<42e4)return;let fe=Ot(j.url);if(K.status===206){const ve=j.headers.get("Range");if(!ve)return;le.status=200,fe=hr(fe,{range:ve})}(function(ve,we){if(Pe===void 0)try{new Response(new ReadableStream),Pe=!0}catch{Pe=!1}Pe?we(ve.body):ve.blob().then(we)})(K,ve=>{const we=new Response(ve,le);Je(),Et&&Et.then(Le=>Le.put(fe,we)).catch(Le=>ye(Le.message))})}(f,O,z),_=!0,l(null,V,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(V=>{v||l(new Error(V.message))})};return x?function(L,O){if(Je(),!Et)return O(null);Et.then(z=>{let V=Ot(L.url);const j=L.headers.get("Range");j&&(V=hr(V,{range:j})),z.match(V).then(K=>{const ee=function(Q){if(!Q)return!1;const le=new Date(Q.headers.get("Expires")||0),ae=tr(Q.headers.get("Cache-Control")||"");return le>Date.now()&&!ae["no-cache"]}(K);z.delete(V),ee&&z.put(V,K.clone()),O(null,K,ee)}).catch(O)}).catch(O)}(f,E):E(null,null),{cancel:()=>{v=!0,_||u.abort()}}}(t,e);if(Bt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(s,l){const u=new XMLHttpRequest;u.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const f in s.headers)u.setRequestHeader(f,s.headers[f]);return s.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=s.credentials==="include",u.onerror=()=>{l(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let f=u.response;if(s.type==="json")try{f=JSON.parse(u.response)}catch(_){return l(_)}l(null,f,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else l(new Wn(u.statusText,u.status,s.url))},u.send(s.body),{cancel:()=>u.abort()}}(t,e)},Ye=function(t,e){return He(nr(t,{type:"arrayBuffer"}),e)};function pt(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const Mt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let bt,Lt;bt=[],Lt=0;const Rt=function(t,e){if(Rr.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Lt>=H.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return bt.push(u),u}Lt++;let r=!1;const s=()=>{if(!r)for(r=!0,Lt--;bt.length&&Lt<H.MAX_PARALLEL_IMAGE_REQUESTS;){const u=bt.shift(),{requestParameters:f,callback:_,cancelled:v}=u;v||(u.cancel=Rt(f,_).cancel)}},l=Ye(t,(u,f,_,v)=>{s(),u?e(u):f&&(self.createImageBitmap?function(x,w){const E=new Blob([new Uint8Array(x)],{type:"image/png"});createImageBitmap(E).then(I=>{w(null,I)}).catch(I=>{w(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(x,w)=>e(x,w,_,v)):function(x,w){const E=new Image;E.onload=()=>{w(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=Mt})},E.onerror=()=>w(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new Blob([new Uint8Array(x)],{type:"image/png"});E.src=x.byteLength?URL.createObjectURL(I):Mt}(f,(x,w)=>e(x,w,_,v)))});return{cancel:()=>{l.cancel(),s()}}},Tt="01",Nt="NO_ACCESS_TOKEN",At=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Tr(t){const e=t.match(At);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Qr(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const lr="mapbox.eventData";function In(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Gn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=In(H.ACCESS_TOKEN);let s="";return s=r&&r.u?btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(l,u)=>String.fromCharCode(+("0x"+u)))):H.ACCESS_TOKEN||"",e?`${lr}.${e}:${s}`:`${lr}:${s}`}fetchEventData(){const e=Z("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const l=localStorage.getItem(r);l&&(this.eventData=JSON.parse(l));const u=localStorage.getItem(s);u&&(this.anonId=u)}catch{ye("Unable to read from LocalStorage")}}saveEventData(){const e=Z("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid"),l=this.anonId;if(e&&l)try{localStorage.setItem(s,l),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData))}catch{ye("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,s,l){if(!H.EVENTS_URL)return;const u=Tr(H.EVENTS_URL);u.params.push(`access_token=${l||H.ACCESS_TOKEN||""}`);const f={event:this.type,created:new Date(e).toISOString()},_=r?nr(f,r):f,v={url:Qr(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};this.pendingRequest=function(x,w){return He(nr(x,{method:"POST"}),w)}(v,x=>{this.pendingRequest=null,s(x),this.saveEventData(),this.processRequests(l)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Ln=new class extends Gn{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){H.EVENTS_URL&&H.ACCESS_TOKEN&&Array.isArray(t)&&t.some(r=>oe(r)||ie(r))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=In(H.ACCESS_TOKEN),r=e?e.u:H.ACCESS_TOKEN;let s=r!==this.eventData.tokenU;it(this.anonId)||(this.anonId=Bn(),s=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),f=new Date(l),_=(l-this.eventData.lastSuccess)/864e5;s=s||_>=1||_<-1||u.getDate()!==f.getDate()}else s=!0;s?this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:B,skuId:Tt,"enabled.telemetry":!1,userId:this.anonId},u=>{u||(this.eventData.lastSuccess=l,this.eventData.tokenU=r)},t):this.processRequests()}},mi=Ln.postTurnstileEvent.bind(Ln),Fi=new class extends Gn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,r,s){this.skuToken=e,this.errorCb=s,H.EVENTS_URL&&(r||H.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(Nt)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),it(this.anonId)||(this.anonId=Bn()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:B,skuId:Tt,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},pn=Fi.postMapLoadEvent.bind(Fi),ms=new class extends Gn{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){H.EVENTS_URL&&(t||H.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:r}=this.queue.shift(),s=function(l){const u=performance.getEntriesByType("resource"),f=performance.getEntriesByType("mark"),_=function(L){const O={};if(L){for(const z in L)if(z!=="other")for(const V of L[z]){const j=`${z}ResolveRangeMin`,K=`${z}ResolveRangeMax`,ee=`${z}RequestCount`,Q=`${z}RequestCachedCount`;O[j]=Math.min(O[j]||1/0,V.startTime),O[K]=Math.max(O[K]||-1/0,V.responseEnd);const le=ae=>{O[ae]===void 0&&(O[ae]=0),++O[ae]};V.transferSize!==void 0&&V.transferSize===0&&le(Q),le(ee)}}return O}(function(L,O){const z={};if(L)for(const V of L){const j=O(V);z[j]===void 0&&(z[j]=[]),z[j].push(V)}return z}(u,mt)),v=window.devicePixelRatio,x=navigator.connection||navigator.mozConnection||navigator.webkitConnection,w=x?x.effectiveType:void 0,E={counters:[],metadata:[],attributes:[]},I=(L,O,z)=>{z!=null&&L.push({name:O,value:z.toString()})};for(const L in _)I(E.counters,L,_[L]);if(l.interactionRange[0]!==1/0&&l.interactionRange[1]!==-1/0&&(I(E.counters,"interactionRangeMin",l.interactionRange[0]),I(E.counters,"interactionRangeMax",l.interactionRange[1])),f)for(const L of Object.keys(Ee)){const O=Ee[L],z=f.find(V=>V.name===O);z&&I(E.counters,O,z.startTime)}return I(E.counters,"visibilityHidden",l.visibilityHidden),I(E.attributes,"style",function(L){if(L)for(const O of L){const z=O.name.split("?")[0];if(Re(z)){const V=z.split("/").slice(-2);if(V.length===2)return`mapbox://styles/${V[0]}/${V[1]}`}}}(u)),I(E.attributes,"terrainEnabled",l.terrainEnabled?"true":"false"),I(E.attributes,"fogEnabled",l.fogEnabled?"true":"false"),I(E.attributes,"projection",l.projection),I(E.attributes,"zoom",l.zoom),I(E.metadata,"devicePixelRatio",v),I(E.metadata,"connectionEffectiveType",w),I(E.metadata,"navigatorUserAgent",navigator.userAgent),I(E.metadata,"screenWidth",window.screen.width),I(E.metadata,"screenHeight",window.screen.height),I(E.metadata,"windowWidth",window.innerWidth),I(E.metadata,"windowHeight",window.innerHeight),I(E.metadata,"mapWidth",l.width/v),I(E.metadata,"mapHeight",l.height/v),I(E.metadata,"webglRenderer",l.renderer),I(E.metadata,"webglVendor",l.vendor),I(E.metadata,"sdkVersion",B),I(E.metadata,"sdkIdentifier","mapbox-gl-js"),E}(r);for(const l of s.metadata);for(const l of s.counters);for(const l of s.attributes);this.postEvent(e,s,()=>{},t)}},zs=ms.postPerformanceEvent.bind(ms),Bi=new class extends Gn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,r,s){if(!H.API_URL||!H.SESSION_PATH)return;const l=Tr(H.API_URL+H.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${s||H.ACCESS_TOKEN||""}`);const u={url:Qr(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(f,_){return He(nr(f,{method:"GET"}),_)}(u,f=>{this.pendingRequest=null,r(f),this.saveEventData(),this.processRequests(s)})}getSessionAPI(t,e,r,s){this.skuToken=e,this.errorCb=s,H.SESSION_PATH&&H.API_URL&&(r||H.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(Nt)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},yc=Bi.getSessionAPI.bind(Bi),Bo=new Set;function sl(t,e,r){r[t]&&r[t].indexOf(e)!==-1||(r[t]=r[t]||[],r[t].push(e))}function gd(t,e,r){if(r&&r[t]){const s=r[t].indexOf(e);s!==-1&&r[t].splice(s,1)}}class wa{constructor(e,r={}){nr(this,r),this.type=e}}class yd extends wa{constructor(e,r={}){super("error",nr({error:e},r))}}class ol{on(e,r){return this._listeners=this._listeners||{},sl(e,r,this._listeners),this}off(e,r){return gd(e,r,this._listeners),gd(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},sl(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){typeof e=="string"&&(e=new wa(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const _ of l)_.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const _ of u)gd(s,_,this._oneTimeListeners),_.call(this,e);const f=this._eventedParent;f&&(nr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof yd&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}o.y=void 0;var dm={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ku(t){return(t=Math.round(t))<0?0:t>255?255:t}function vd(t){return ku(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Ou(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function xd(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{o.y={}.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in dm)return dm[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=r.indexOf("("),l=r.indexOf(")");if(s!==-1&&l+1===r.length){var u=r.substr(0,s),f=r.substr(s+1,l-(s+1)).split(","),_=1;switch(u){case"rgba":if(f.length!==4)return null;_=Ou(f.pop());case"rgb":return f.length!==3?null:[vd(f[0]),vd(f[1]),vd(f[2]),_];case"hsla":if(f.length!==4)return null;_=Ou(f.pop());case"hsl":if(f.length!==3)return null;var v=(parseFloat(f[0])%360+360)%360/360,x=Ou(f[1]),w=Ou(f[2]),E=w<=.5?w*(x+1):w+x-w*x,I=2*w-E;return[ku(255*xd(I,E,v+1/3)),ku(255*xd(I,E,v)),ku(255*xd(I,E,v-1/3)),_];default:return null}}return null}}catch{}class ns{constructor(e,r,s,l=1){this.r=e,this.g=r,this.b=s,this.a=l}static parse(e){if(!e)return;if(e instanceof ns)return e;if(typeof e!="string")return;const r=o.y(e);return r?new ns(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,s,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(s)},${l})`}toArray(){const{r:e,g:r,b:s,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*r/l,255*s/l,l]}toArray01(){const{r:e,g:r,b:s,a:l}=this;return l===0?[0,0,0,0]:[e/l,r/l,s/l,l]}toArray01Scaled(e){const{r,g:s,b:l,a:u}=this;return u===0?[0,0,0]:[r/u*e,s/u*e,l/u*e]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:s,a:l}=this;return[e,r,s,l]}toArray01Linear(){const{r:e,g:r,b:s,a:l}=this;return l===0?[0,0,0,0]:[Math.pow(e/l,2.2),Math.pow(r/l,2.2),Math.pow(s/l,2.2),l]}}ns.black=new ns(0,0,0,1),ns.white=new ns(1,1,1,1),ns.transparent=new ns(0,0,0,0),ns.red=new ns(1,0,0,1),ns.blue=new ns(0,0,1,1);var hi=ns;function en(t,e,r){return t*(1-r)+e*r}function fm(t,e,r){return t.map((s,l)=>en(s,e[l],r))}var zu=Object.freeze({__proto__:null,array:fm,color:function(t,e,r){return new hi(en(t.r,e.r,r),en(t.g,e.g,r),en(t.b,e.b,r),en(t.a,e.a,r))},number:en});function bd(t,...e){for(const r of e)for(const s in r)t[s]=r[s];return t}class Ry extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var Js=Ry;class wd{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,l]of r)this.bindings[s]=l}concat(e){return new wd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var ky=wd;const al={kind:"null"},$t={kind:"number"},_n={kind:"string"},gn={kind:"boolean"},Ss={kind:"color"},ll={kind:"object"},on={kind:"value"},Fu={kind:"collator"},cl={kind:"formatted"},vc={kind:"resolvedImage"};function is(t,e){return{kind:"array",itemType:t,N:e}}function ci(t){if(t.kind==="array"){const e=ci(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const pr=[al,$t,_n,gn,Ss,cl,ll,is(on),vc];function Ta(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ta(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const r of pr)if(!Ta(r,e))return null}}return`Expected ${ci(t)} but found ${ci(e)} instead.`}function Er(t,e){return e.some(r=>r.kind===t.kind)}function No(t,e){return e.some(r=>r==="null"?t===null:r==="array"?Array.isArray(t):r==="object"?t&&!Array.isArray(t)&&typeof t=="object":r===typeof t)}class jr{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ul{constructor(e,r,s,l,u){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=s,this.fontStack=l,this.textColor=u}}class Ni{constructor(e){this.sections=e}static fromString(e){return new Ni([new ul(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Ni?e:Ni.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.namePrimary]);continue}e.push(r.text);const s={};r.fontStack&&(s["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(s["font-scale"]=r.scale),r.textColor&&(s["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(s)}return e}}class mr{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,r){return e?new mr({namePrimary:e,nameSecondary:r,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function pm(t,e,r,s){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[t,e,r,s]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Sa(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof hi||t instanceof jr||t instanceof Ni||t instanceof mr)return!0;if(Array.isArray(t)){for(const e of t)if(!Sa(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Sa(t[e]))return!1;return!0}return!1}function _i(t){if(t===null)return al;if(typeof t=="string")return _n;if(typeof t=="boolean")return gn;if(typeof t=="number")return $t;if(t instanceof hi)return Ss;if(t instanceof jr)return Fu;if(t instanceof Ni)return cl;if(t instanceof mr)return vc;if(Array.isArray(t)){const e=t.length;let r;for(const s of t){const l=_i(s);if(r){if(r===l)continue;r=on;break}r=l}return is(r||on,e)}return ll}function Ms(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof hi||t instanceof Ni||t instanceof mr?t.toString():JSON.stringify(t)}class Vo{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Sa(e[1]))return r.error("invalid value");const s=e[1];let l=_i(s);const u=r.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new Vo(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof hi?["rgba"].concat(this.value.toArray()):this.value instanceof Ni?this.value.serialize():this.value}}var _o=Vo,gi=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Td={string:_n,number:$t,boolean:gn,object:ll};class Sd{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,l=1;const u=e[0];if(u==="array"){let _,v;if(e.length>2){const x=e[1];if(typeof x!="string"||!(x in Td)||x==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);_=Td[x],l++}else _=on;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);v=e[2],l++}s=is(_,v)}else s=Td[u];const f=[];for(;l<e.length;l++){const _=r.parse(e[l],l,on);if(!_)return null;f.push(_)}return new Sd(s,f)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!Ta(this.type,_i(s)))return s;if(r===this.args.length-1)throw new gi(`Expected value to be of type ${ci(this.type)}, but found ${ci(_i(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){r.push(s.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&r.push(l)}}return r.concat(this.args.map(s=>s.serialize()))}}var go=Sd;class hl{constructor(e){this.type=cl,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const l=[];let u=!1;for(let f=1;f<=e.length-1;++f){const _=e[f];if(u&&typeof _=="object"&&!Array.isArray(_)){u=!1;let v=null;if(_["font-scale"]&&(v=r.parse(_["font-scale"],1,$t),!v))return null;let x=null;if(_["text-font"]&&(x=r.parse(_["text-font"],1,is(_n)),!x))return null;let w=null;if(_["text-color"]&&(w=r.parse(_["text-color"],1,Ss),!w))return null;const E=l[l.length-1];E.scale=v,E.font=x,E.textColor=w}else{const v=r.parse(e[f],1,on);if(!v)return null;const x=v.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:v,scale:null,font:null,textColor:null})}}return new hl(l)}evaluate(e){return new Ni(this.sections.map(r=>{const s=r.content.evaluate(e);return _i(s)===vc?new ul("",s,null,null,null):new ul(Ms(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const s={};r.scale&&(s["font-scale"]=r.scale.serialize()),r.font&&(s["text-font"]=r.font.serialize()),r.textColor&&(s["text-color"]=r.textColor.serialize()),e.push(s)}return e}}class Ma{constructor(e,r){this.type=vc,this.inputPrimary=e,this.inputSecondary=r}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");const s=r.parse(e[1],1,_n);if(!s)return r.error("No image name provided.");if(e.length===2)return new Ma(s);const l=r.parse(e[2],1,_n);return l?new Ma(s,l):r.error("Secondary image variant is not a string.")}evaluate(e){const r=mr.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&e.availableImages&&(r.available=e.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function dl(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const Fs={"to-boolean":gn,"to-color":Ss,"to-number":$t,"to-string":_n};class Bu{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0],l=[];let u=al;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);u=is(r.expectedType.itemType,f)}else{if(!(f>0&&Sa(e[1][0])))return null;u=is(_i(e[1][0]),f)}for(let _=0;_<f;_++){const v=e[1][_];let x;if(dl(v)==="array")x=r.parse(v,void 0,u.itemType);else{const w=dl(v);if(w!==u.itemType.kind)return r.error(`Expected ${u.itemType.kind} but found ${w}.`);x=r.registry.literal.parse(["literal",v===void 0?null:v],r)}if(!x)return null;l.push(x)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");u=Fs[s];for(let f=1;f<e.length;f++){const _=r.parse(e[f],f,on);if(!_)return null;l.push(_)}}return new Bu(u,l)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,s;for(const l of this.args){if(r=l.evaluate(e),s=null,r instanceof hi)return r;if(typeof r=="string"){const u=e.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:pm(r[0],r[1],r[2],r[3]),!s))return new hi(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new gi(s||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new gi(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Ni.fromString(Ms(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?mr.fromString(Ms(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):Ms(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new hl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ma(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var yo=Bu;const xc=["Unknown","Point","LineString","Polygon"];var mm=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?xc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-t[0])+this.featureDistanceData.bearing[1]*(s*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=hi.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class Ea{constructor(e,r,s,l,u){this.name=e,this.type=r,this._evaluate=s,this.args=l,this._overloadIndex=u}evaluate(e){if(!this._evaluate){const r=Ea.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const s=e[0],l=Ea.definitions[s];if(!l)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,_=[];let v=null,x=-1;for(const[w,E]of f){if(Array.isArray(w)&&w.length!==e.length-1)continue;_.push(w),x++,v=new wm(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);const I=[];let L=!1;for(let O=1;O<e.length;O++){const z=e[O],V=Array.isArray(w)?w[O-1]:w.type,j=v.parse(z,1+I.length,V);if(!j){L=!0;break}I.push(j)}if(!L)if(Array.isArray(w)&&w.length!==I.length)v.error(`Expected ${w.length} arguments, but found ${I.length} instead.`);else{for(let O=0;O<I.length;O++){const z=Array.isArray(w)?w[O]:w.type,V=I[O];v.concat(O+1).checkSubtype(z,V.type)}if(v.errors.length===0)return new Ea(s,u,E,I,x)}}if(_.length===1)r.errors.push(...v.errors);else{const w=(_.length?_:f.map(([I])=>I)).map(_m).join(" | "),E=[];for(let I=1;I<e.length;I++){const L=r.parse(e[I],1+E.length);if(!L)return null;E.push(ci(L.type))}r.error(`Expected arguments of type ${w}, but found (${E.join(", ")}) instead.`)}return null}static register(e,r){Ea.definitions=r;for(const s in r)e[s]=Ea}}function _m(t){return Array.isArray(t)?`(${t.map(ci).join(", ")})`:`(${ci(t.type)}...)`}var rn=Ea;class bc{constructor(e,r,s){this.type=Fu,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const l=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,gn);if(!l)return null;const u=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,gn);if(!u)return null;let f=null;return s.locale&&(f=r.parse(s.locale,1,_n),!f)?null:new bc(l,u,f)}evaluate(e){return new jr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Md={exports:{}};Md.exports=function(){function t(s,l,u,f,_){for(;f>u;){if(f-u>600){var v=f-u+1,x=l-u+1,w=Math.log(v),E=.5*Math.exp(2*w/3),I=.5*Math.sqrt(w*E*(v-E)/v)*(x-v/2<0?-1:1);t(s,l,Math.max(u,Math.floor(l-x*E/v+I)),Math.min(f,Math.floor(l+(v-x)*E/v+I)),_)}var L=s[l],O=u,z=f;for(e(s,u,l),_(s[f],L)>0&&e(s,u,f);O<z;){for(e(s,O,z),O++,z--;_(s[O],L)<0;)O++;for(;_(s[z],L)>0;)z--}_(s[u],L)===0?e(s,u,z):e(s,++z,f),z<=l&&(u=z+1),l<=z&&(f=z-1)}}function e(s,l,u){var f=s[l];s[l]=s[u],s[u]=f}function r(s,l){return s<l?-1:s>l?1:0}return function(s,l,u,f,_){t(s,l,u||0,f||s.length-1,_||r)}}();var Oy=gt(Md.exports);function zy(t){let e=0;for(let r,s,l=0,u=t.length,f=u-1;l<u;f=l++)r=t[l],s=t[f],e+=(s.x-r.x)*(r.y+s.y);return e}function $o(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Uo(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Nu(t,e,r){const s=t[0]-e[0],l=t[1]-e[1],u=t[0]-r[0],f=t[1]-r[1];return s*f-u*l==0&&s*u<=0&&l*f<=0}function fl(t,e,r=!1){let s=!1;for(let _=0,v=e.length;_<v;_++){const x=e[_];for(let w=0,E=x.length,I=E-1;w<E;I=w++){const L=x[I],O=x[w];if(Nu(t,L,O))return r;(u=L)[1]>(l=t)[1]!=(f=O)[1]>l[1]&&l[0]<(f[0]-u[0])*(l[1]-u[1])/(f[1]-u[1])+u[0]&&(s=!s)}}var l,u,f;return s}function Ed(t,e,r,s){const l=s[0]-r[0],u=s[1]-r[1],f=(t[0]-r[0])*u-l*(t[1]-r[1]),_=(e[0]-r[0])*u-l*(e[1]-r[1]);return f>0&&_<0||f<0&&_>0}function vo(t,e,r,s){return(l=[s[0]-r[0],s[1]-r[1]])[0]*(u=[e[0]-t[0],e[1]-t[1]])[1]-l[1]*u[0]!=0&&!(!Ed(t,e,r,s)||!Ed(r,s,t,e));var l,u}const jo=8192;function wc(t,e){const r=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*jo),Math.round(s*l*jo)]}function Ad(t,e){for(let r=0;r<e.length;r++)if(fl(t,e[r]))return!0;return!1}function Id(t,e,r){for(const s of r)for(let l=0,u=s.length,f=u-1;l<u;f=l++)if(vo(t,e,s[f],s[l]))return!0;return!1}function Es(t,e){for(let r=0;r<t.length;++r)if(!fl(t[r],e))return!1;for(let r=0;r<t.length-1;++r)if(Id(t[r],t[r+1],e))return!1;return!0}function gm(t,e){for(let r=0;r<e.length;r++)if(Es(t,e[r]))return!0;return!1}function Cd(t,e,r){const s=[];for(let l=0;l<t.length;l++){const u=[];for(let f=0;f<t[l].length;f++){const _=wc(t[l][f],r);$o(e,_),u.push(_)}s.push(u)}return s}function Pd(t,e,r){const s=[];for(let l=0;l<t.length;l++){const u=Cd(t[l],e,r);s.push(u)}return s}function Dd(t,e,r,s){if(t[0]<r[0]||t[0]>r[2]){const l=.5*s;let u=t[0]-r[0]>l?-s:r[0]-t[0]>l?s:0;u===0&&(u=t[0]-r[2]>l?-s:r[2]-t[0]>l?s:0),t[0]+=u}$o(e,t)}function Ld(t,e,r,s){const l=Math.pow(2,s.z)*jo,u=[s.x*jo,s.y*jo],f=[];if(!t)return f;for(const _ of t)for(const v of _){const x=[v.x+u[0],v.y+u[1]];Dd(x,e,r,l),f.push(x)}return f}function Rd(t,e,r,s){const l=Math.pow(2,s.z)*jo,u=[s.x*jo,s.y*jo],f=[];if(!t)return f;for(const v of t){const x=[];for(const w of v){const E=[w.x+u[0],w.y+u[1]];$o(e,E),x.push(E)}f.push(x)}if(e[2]-e[0]<=l/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const v of f)for(const x of v)Dd(x,e,r,l)}var _;return f}class pl{constructor(e,r){this.type=gn,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Sa(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let l=0;l<s.features.length;++l){const u=s.features[l].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new pl(s,s.features[l].geometry)}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new pl(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new pl(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(!f)return!1;if(s.type==="Polygon"){const _=Cd(s.coordinates,u,f),v=Ld(r.geometry(),l,u,f);if(!Uo(l,u))return!1;for(const x of v)if(!fl(x,_))return!1}if(s.type==="MultiPolygon"){const _=Pd(s.coordinates,u,f),v=Ld(r.geometry(),l,u,f);if(!Uo(l,u))return!1;for(const x of v)if(!Ad(x,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(!f)return!1;if(s.type==="Polygon"){const _=Cd(s.coordinates,u,f),v=Rd(r.geometry(),l,u,f);if(!Uo(l,u))return!1;for(const x of v)if(!Es(x,_))return!1}if(s.type==="MultiPolygon"){const _=Pd(s.coordinates,u,f),v=Rd(r.geometry(),l,u,f);if(!Uo(l,u))return!1;for(const x of v)if(!gm(x,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Vu=pl,Tc={exports:{}};Tc.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,r=e*(2-e),s=Math.PI/180,l=function(x,w){if(x===void 0)throw new Error("No latitude given.");if(w&&!t[w])throw new Error("Unknown unit "+w+". Use one of: "+Object.keys(t).join(", "));var E=6378.137*s*(w?t[w]:1),I=Math.cos(x*s),L=1/(1-r*(1-I*I)),O=Math.sqrt(L);this.kx=E*O*I,this.ky=E*O*L*(1-r)},u={units:{configurable:!0}};function f(x,w){return x[0]===w[0]&&x[1]===w[1]}function _(x,w,E){var I=v(w[0]-x[0]);return[x[0]+I*E,x[1]+(w[1]-x[1])*E]}function v(x){for(;x<-180;)x+=360;for(;x>180;)x-=360;return x}return l.fromTile=function(x,w,E){var I=Math.PI*(1-2*(x+.5)/Math.pow(2,w)),L=Math.atan(.5*(Math.exp(I)-Math.exp(-I)))/s;return new l(L,E)},u.units.get=function(){return t},l.prototype.distance=function(x,w){var E=v(x[0]-w[0])*this.kx,I=(x[1]-w[1])*this.ky;return Math.sqrt(E*E+I*I)},l.prototype.bearing=function(x,w){var E=v(w[0]-x[0])*this.kx;return Math.atan2(E,(w[1]-x[1])*this.ky)/s},l.prototype.destination=function(x,w,E){var I=E*s;return this.offset(x,Math.sin(I)*w,Math.cos(I)*w)},l.prototype.offset=function(x,w,E){return[x[0]+w/this.kx,x[1]+E/this.ky]},l.prototype.lineDistance=function(x){for(var w=0,E=0;E<x.length-1;E++)w+=this.distance(x[E],x[E+1]);return w},l.prototype.area=function(x){for(var w=0,E=0;E<x.length;E++)for(var I=x[E],L=0,O=I.length,z=O-1;L<O;z=L++)w+=v(I[L][0]-I[z][0])*(I[L][1]+I[z][1])*(E?-1:1);return Math.abs(w)/2*this.kx*this.ky},l.prototype.along=function(x,w){var E=0;if(w<=0)return x[0];for(var I=0;I<x.length-1;I++){var L=x[I],O=x[I+1],z=this.distance(L,O);if((E+=z)>w)return _(L,O,(w-(E-z))/z)}return x[x.length-1]},l.prototype.pointToSegmentDistance=function(x,w,E){var I=w[0],L=w[1],O=v(E[0]-I)*this.kx,z=(E[1]-L)*this.ky,V=0;return O===0&&z===0||((V=(v(x[0]-I)*this.kx*O+(x[1]-L)*this.ky*z)/(O*O+z*z))>1?(I=E[0],L=E[1]):V>0&&(I+=O/this.kx*V,L+=z/this.ky*V)),O=v(x[0]-I)*this.kx,z=(x[1]-L)*this.ky,Math.sqrt(O*O+z*z)},l.prototype.pointOnLine=function(x,w){for(var E,I,L,O,z=1/0,V=0;V<x.length-1;V++){var j=x[V][0],K=x[V][1],ee=v(x[V+1][0]-j)*this.kx,Q=(x[V+1][1]-K)*this.ky,le=0;ee===0&&Q===0||((le=(v(w[0]-j)*this.kx*ee+(w[1]-K)*this.ky*Q)/(ee*ee+Q*Q))>1?(j=x[V+1][0],K=x[V+1][1]):le>0&&(j+=ee/this.kx*le,K+=Q/this.ky*le));var ae=(ee=v(w[0]-j)*this.kx)*ee+(Q=(w[1]-K)*this.ky)*Q;ae<z&&(z=ae,E=j,I=K,L=V,O=le)}return{point:[E,I],index:L,t:Math.max(0,Math.min(1,O))}},l.prototype.lineSlice=function(x,w,E){var I=this.pointOnLine(E,x),L=this.pointOnLine(E,w);if(I.index>L.index||I.index===L.index&&I.t>L.t){var O=I;I=L,L=O}var z=[I.point],V=I.index+1,j=L.index;!f(E[V],z[0])&&V<=j&&z.push(E[V]);for(var K=V+1;K<=j;K++)z.push(E[K]);return f(E[j],L.point)||z.push(L.point),z},l.prototype.lineSliceAlong=function(x,w,E){for(var I=0,L=[],O=0;O<E.length-1;O++){var z=E[O],V=E[O+1],j=this.distance(z,V);if((I+=j)>x&&L.length===0&&L.push(_(z,V,(x-(I-j))/j)),I>=w)return L.push(_(z,V,(w-(I-j))/j)),L;I>x&&L.push(V)}return L},l.prototype.bufferPoint=function(x,w){var E=w/this.ky,I=w/this.kx;return[x[0]-I,x[1]-E,x[0]+I,x[1]+E]},l.prototype.bufferBBox=function(x,w){var E=w/this.ky,I=w/this.kx;return[x[0]-I,x[1]-E,x[2]+I,x[3]+E]},l.prototype.insideBBox=function(x,w){return v(x[0]-w[0])>=0&&v(x[0]-w[2])<=0&&x[1]>=w[1]&&x[1]<=w[3]},Object.defineProperties(l,u),l}();var Go=gt(Tc.exports),kd={exports:{}};kd.exports=function(){var t=function(r,s){if(r===void 0&&(r=[]),s===void 0&&(s=e),this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(var l=(this.length>>1)-1;l>=0;l--)this._down(l)};function e(r,s){return r<s?-1:r>s?1:0}return t.prototype.push=function(r){this.data.push(r),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var r=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),r}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(r){for(var s=this.data,l=this.compare,u=s[r];r>0;){var f=r-1>>1,_=s[f];if(l(u,_)>=0)break;s[r]=_,r=f}s[r]=u},t.prototype._down=function(r){for(var s=this.data,l=this.compare,u=this.length>>1,f=s[r];r<u;){var _=1+(r<<1),v=s[_],x=_+1;if(x<this.length&&l(s[x],v)<0&&(_=x,v=s[x]),l(v,f)>=0)break;s[r]=v,r=_}s[r]=f},t}();var As=gt(kd.exports),kt=8192;function $u(t,e){return e.dist-t.dist}const Od=100,Sc=50;function zd(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Ho(t){return t[1]-t[0]+1}function Bs(t,e){const r=t[1]>=t[0]&&t[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function Fd(t,e){if(t[0]>t[1])return[null,null];const r=Ho(t);if(e){if(r===2)return[t,null];const s=Math.floor(r/2);return[[t[0],t[0]+s],[t[0]+s,t[1]]]}{if(r===1)return[t,null];const s=Math.floor(r/2)-1;return[[t[0],t[0]+s],[t[0]+s+1,t[1]]]}}function Aa(t,e){const r=[1/0,1/0,-1/0,-1/0];if(!Bs(e,t.length))return r;for(let s=e[0];s<=e[1];++s)$o(r,t[s]);return r}function Uu(t){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<t.length;++r)for(let s=0;s<t[r].length;++s)$o(e,t[r][s]);return e}function Ia(t,e,r){if(zd(t)||zd(e))return NaN;let s=0,l=0;return t[2]<e[0]&&(s=e[0]-t[2]),t[0]>e[2]&&(s=t[0]-e[2]),t[1]>e[3]&&(l=t[1]-e[3]),t[3]<e[1]&&(l=e[1]-t[3]),r.distance([0,0],[s,l])}function Bd(t){return 360*t-180}function Fy(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function ml(t,e){const r=Math.pow(2,e.z),s=(t.y/kt+e.y)/r;return[Bd((t.x/kt+e.x)/r),Fy(s)]}function By(t,e){const r=[];for(let s=0;s<t.length;++s)r.push(ml(t[s],e));return r}function ym(t,e,r){const s=r.pointOnLine(e,t).point;return r.distance(t,s)}function vm(t,e,r,s,l){const u=r.slice(s[0],s[1]+1);let f=1/0;for(let _=e[0];_<=e[1];++_)if((f=Math.min(f,ym(t[_],u,l)))===0)return 0;return f}function Nd(t,e,r,s,l){const u=Math.min(l.pointToSegmentDistance(t,r,s),l.pointToSegmentDistance(e,r,s)),f=Math.min(l.pointToSegmentDistance(r,t,e),l.pointToSegmentDistance(s,t,e));return Math.min(u,f)}function Ny(t,e,r,s,l){if(!Bs(e,t.length)||!Bs(s,r.length))return NaN;let u=1/0;for(let f=e[0];f<e[1];++f)for(let _=s[0];_<s[1];++_){if(vo(t[f],t[f+1],r[_],r[_+1]))return 0;u=Math.min(u,Nd(t[f],t[f+1],r[_],r[_+1],l))}return u}function Vy(t,e,r,s,l){if(!Bs(e,t.length)||!Bs(s,r.length))return NaN;let u=1/0;for(let f=e[0];f<=e[1];++f)for(let _=s[0];_<=s[1];++_)if((u=Math.min(u,l.distance(t[f],r[_])))===0)return u;return u}function $y(t,e,r){if(fl(t,e,!0))return 0;let s=1/0;for(const l of e){const u=l.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(l[0]!==l[u-1]&&(s=Math.min(s,r.pointToSegmentDistance(t,l[u-1],l[0])))===0||(s=Math.min(s,ym(t,l,r)))===0)return s}return s}function xm(t,e,r,s){if(!Bs(e,t.length))return NaN;for(let u=e[0];u<=e[1];++u)if(fl(t[u],r,!0))return 0;let l=1/0;for(let u=e[0];u<e[1];++u)for(const f of r)for(let _=0,v=f.length,x=v-1;_<v;x=_++){if(vo(t[u],t[u+1],f[x],f[_]))return 0;l=Math.min(l,Nd(t[u],t[u+1],f[x],f[_],s))}return l}function Mc(t,e){for(const r of t)for(let s=0;s<=r.length-1;++s)if(fl(r[s],e,!0))return!0;return!1}function Uy(t,e,r,s=1/0){const l=Uu(t),u=Uu(e);if(s!==1/0&&Ia(l,u,r)>=s)return s;if(Uo(l,u)){if(Mc(t,e))return 0}else if(Mc(e,t))return 0;let f=s;for(const _ of t)for(let v=0,x=_.length,w=x-1;v<x;w=v++)for(const E of e)for(let I=0,L=E.length,O=L-1;I<L;O=I++){if(vo(_[w],_[v],E[O],E[I]))return 0;f=Math.min(f,Nd(_[w],_[v],E[O],E[I],r))}return f}function ju(t,e,r,s,l,u,f){if(u===null||f===null)return;const _=Ia(Aa(s,u),Aa(l,f),r);_<e&&t.push({dist:_,range1:u,range2:f})}function Vd(t,e,r,s,l=1/0){let u=Math.min(s.distance(t[0],r[0][0]),l);if(u===0)return u;const f=new As([{dist:0,range1:[0,t.length-1],range2:[0,0]}],$u),_=e?Sc:Od,v=Uu(r);for(;f.length;){const x=f.pop();if(x.dist>=u)continue;const w=x.range1;if(Ho(w)<=_){if(!Bs(w,t.length))return NaN;if(e){const E=xm(t,w,r,s);if((u=Math.min(u,E))===0)return u}else for(let E=w[0];E<=w[1];++E){const I=$y(t[E],r,s);if((u=Math.min(u,I))===0)return u}}else{const E=Fd(w,e);if(E[0]!==null){const I=Ia(Aa(t,E[0]),v,s);I<u&&f.push({dist:I,range1:E[0],range2:[0,0]})}if(E[1]!==null){const I=Ia(Aa(t,E[1]),v,s);I<u&&f.push({dist:I,range1:E[1],range2:[0,0]})}}}return u}function bm(t,e,r,s,l,u=1/0){let f=Math.min(u,l.distance(t[0],r[0]));if(f===0)return f;const _=new As([{dist:0,range1:[0,t.length-1],range2:[0,r.length-1]}],$u),v=e?Sc:Od,x=s?Sc:Od;for(;_.length;){const w=_.pop();if(w.dist>=f)continue;const E=w.range1,I=w.range2;if(Ho(E)<=v&&Ho(I)<=x){if(!Bs(E,t.length)||!Bs(I,r.length))return NaN;if(e&&s?f=Math.min(f,Ny(t,E,r,I,l)):e||s?e&&!s?f=Math.min(f,vm(r,I,t,E,l)):!e&&s&&(f=Math.min(f,vm(t,E,r,I,l))):f=Math.min(f,Vy(t,E,r,I,l)),f===0)return f}else{const L=Fd(E,e),O=Fd(I,s);ju(_,f,l,t,r,L[0],O[0]),ju(_,f,l,t,r,L[0],O[1]),ju(_,f,l,t,r,L[1],O[0]),ju(_,f,l,t,r,L[1],O[1])}}return f}function $d(t,e,r,s,l=1/0){let u=l;const f=Aa(t,[0,t.length-1]);for(const _ of r)if(!(u!==1/0&&Ia(f,Aa(_,[0,_.length-1]),s)>=u)&&(u=Math.min(u,bm(t,e,_,!0,s,u)),u===0))return u;return u}function Gu(t,e,r,s,l=1/0){let u=l;const f=Aa(t,[0,t.length-1]);for(const _ of r){if(u!==1/0&&Ia(f,Uu(_),s)>=u)continue;const v=Vd(t,e,_,s,u);if(isNaN(v))return v;if((u=Math.min(u,v))===0)return u}return u}function Ud(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Ca{constructor(e,r){this.type=$t,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Sa(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let l=0;l<s.features.length;++l)if(Ud(s.features[l].geometry.type))return new Ca(s,s.features[l].geometry)}else if(s.type==="Feature"){if(Ud(s.geometry.type))return new Ca(s,s.geometry)}else if(Ud(s.type))return new Ca(s,s)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const r=e.geometry(),s=e.canonicalID();if(r!=null&&s!=null){if(e.geometryType()==="Point")return function(l,u,f){const _=[];for(const x of l)for(const w of x)_.push(ml(w,u));const v=new Go(_[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?bm(_,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",v):f.type==="MultiLineString"?$d(_,!1,f.coordinates,v):f.type==="Polygon"||f.type==="MultiPolygon"?Gu(_,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,v):null}(r,s,this.geometries);if(e.geometryType()==="LineString")return function(l,u,f){const _=[];for(const x of l){const w=[];for(const E of x)w.push(ml(E,u));_.push(w)}const v=new Go(_[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return $d(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",_,v);if(f.type==="MultiLineString"){let x=1/0;for(let w=0;w<f.coordinates.length;w++){const E=$d(f.coordinates[w],!0,_,v,x);if(isNaN(E))return E;if((x=Math.min(x,E))===0)return x}return x}if(f.type==="Polygon"||f.type==="MultiPolygon"){let x=1/0;for(let w=0;w<_.length;w++){const E=Gu(_[w],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,v,x);if(isNaN(E))return E;if((x=Math.min(x,E))===0)return x}return x}return null}(r,s,this.geometries);if(e.geometryType()==="Polygon")return function(l,u,f){const _=[];for(const x of function(w,E){const I=w.length;if(I<=1)return[w];const L=[];let O,z;for(let V=0;V<I;V++){const j=zy(w[V]);j!==0&&(w[V].area=Math.abs(j),z===void 0&&(z=j<0),z===j<0?(O&&L.push(O),O=[w[V]]):O.push(w[V]))}return O&&L.push(O),L}(l)){const w=[];for(let E=0;E<x.length;++E)w.push(By(x[E],u));_.push(w)}const v=new Go(_[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return Gu(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",_,v);if(f.type==="MultiLineString"){let x=1/0;for(let w=0;w<f.coordinates.length;w++){const E=Gu(f.coordinates[w],!0,_,v,x);if(isNaN(E))return E;if((x=Math.min(x,E))===0)return x}return x}return f.type==="Polygon"||f.type==="MultiPolygon"?function(x,w,E){let I=1/0;for(const L of x)for(const O of w){const z=Uy(L,O,E,I);if(isNaN(z))return z;if((I=Math.min(I,z))===0)return I}return I}(f.type==="Polygon"?[f.coordinates]:f.coordinates,_,v):null}(r,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Hu=Ca;function Ec(t,e){switch(t){case"string":return Ms(e);case"number":return+e;case"boolean":return!!e;case"color":return hi.parse(e);case"formatted":return Ni.fromString(Ms(e));case"resolvedImage":return mr.fromString(Ms(e))}return e}function jd(t,e,r,s){return s!==void 0&&(t=s*Math.round(t/s)),e!==void 0&&t<e&&(t=e),r!==void 0&&t>r&&(t=r),t}class Ac{constructor(e,r,s){this.type=e,this.key=r,this.scope=s}static parse(e,r){let s=r.expectedType;if(s==null&&(s=on),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");const l=r.parse(e[1],1);if(!(l instanceof _o))return r.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const u=r.parse(e[2],2);return u instanceof _o?new Ac(s,Ms(l.value),Ms(u.value)):r.error("Scope of 'config' expression must be a string literal.")}return new Ac(s,Ms(l.value))}evaluate(e){const r=[this.key,this.scope,e.scope].filter(Boolean).join(""),s=e.getConfig(r);if(!s)return null;const{type:l,value:u,values:f,minValue:_,maxValue:v,stepValue:x}=s,w=s.default.evaluate(e);let E=w;if(u){const I=e.scope;e.scope=(I||"").split("").slice(1).join(""),E=u.evaluate(e),e.scope=I}return l&&(E=Ec(l,E)),E===void 0||_===void 0&&v===void 0&&x===void 0||(typeof E=="number"?E=jd(E,_,v,x):Array.isArray(E)&&(E=E.map(I=>typeof I=="number"?jd(I,_,v,x):I))),u!==void 0&&E!==void 0&&f&&!f.includes(E)&&(E=w,l&&(E=Ec(l,E))),(l&&l!==this.type||E!==void 0&&_i(E)!==this.type)&&(E=Ec(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}var _l=Ac;function gl(t){if(t instanceof rn&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Vu||t instanceof Hu)return!1;let e=!0;return t.eachChild(r=>{e&&!gl(r)&&(e=!1)}),e}function Ic(t){if(t instanceof rn&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(r=>{e&&!Ic(r)&&(e=!1)}),e}function Cc(t){if(t instanceof _l)return!1;let e=!0;return t.eachChild(r=>{e&&!Cc(r)&&(e=!1)}),e}function Vi(t,e){if(t instanceof rn&&e.indexOf(t.name)>=0)return!1;let r=!0;return t.eachChild(s=>{r&&!Vi(s,e)&&(r=!1)}),r}class qo{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new qo(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Ji=qo;class Gd{constructor(e,r=[],s,l=new ky,u=[],f,_){this.registry=e,this.path=r,this.key=r.map(v=>`[${v}]`).join(""),this.scope=l,this.errors=u,this.expectedType=s,this._scope=f,this.options=_}parse(e,r,s,l,u={}){return r||s?this.concat(r,s,l)._parse(e,u):this._parse(e,u)}_parse(e,r){function s(l,u,f){return f==="assert"?new go(u,[l]):f==="coerce"?new yo(u,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(l){let u=l.parse(e,this);if(!u)return null;if(this.expectedType){const f=this.expectedType,_=u.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||_.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(f,_))return null}else u=s(u,f,r.typeAnnotation||"coerce");else u=s(u,f,r.typeAnnotation||"assert")}if(!(u instanceof _o)&&u.type.kind!=="resolvedImage"&&Hd(u)){const f=new mm(this._scope,this.options);try{u=new _o(u.type,u.evaluate(f))}catch(_){return this.error(_.message),null}}return u}return yo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const l=typeof e=="number"?this.path.concat(e):this.path,u=s?this.scope.concat(s):this.scope;return new Gd(this.registry,l,r||null,u,this.errors,this._scope,this.options)}error(e,...r){const s=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new Js(s,e))}checkSubtype(e,r){const s=Ta(e,r);return s&&this.error(s),s}}var wm=Gd;function Hd(t){if(t instanceof Ji)return Hd(t.boundExpression);if(t instanceof rn&&t.name==="error"||t instanceof bc||t instanceof Vu||t instanceof Hu||t instanceof _l)return!1;const e=t instanceof yo||t instanceof go;let r=!0;return t.eachChild(s=>{r=e?r&&Hd(s):r&&s instanceof _o}),!!r&&gl(t)&&Vi(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Pa(t,e){const r=t.length-1;let s,l,u=0,f=r,_=0;for(;u<=f;)if(_=Math.floor((u+f)/2),s=t[_],l=t[_+1],s<=e){if(_===r||e<l)return _;u=_+1}else{if(!(s>e))throw new gi("Input is not a number.");f=_-1}return 0}class qu{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[l,u]of s)this.labels.push(l),this.outputs.push(u)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,$t);if(!s)return null;const l=[];let u=null;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);for(let f=1;f<e.length;f+=2){const _=f===1?-1/0:e[f],v=e[f+1],x=f,w=f+1;if(typeof _!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(l.length&&l[l.length-1][0]>=_)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const E=r.parse(v,w,u);if(!E)return null;u=u||E.type,l.push([_,E])}return new qu(u,s,l)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return s[0].evaluate(e);const u=r.length;return l>=r[u-1]?s[u-1].evaluate(e):s[Pa(r,l)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var Pc=qu;const Tm=.95047,Wo=1.08883,Sm=4/29,yl=6/29,qd=3*yl*yl,Mm=yl*yl*yl,jy=Math.PI/180,Ns=180/Math.PI;function Wu(t){return t>Mm?Math.pow(t,1/3):t/qd+Sm}function Yu(t){return t>yl?t*t*t:qd*(t-Sm)}function Zu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Xu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Wd(t){const e=Xu(t.r),r=Xu(t.g),s=Xu(t.b),l=Wu((.4124564*e+.3575761*r+.1804375*s)/Tm),u=Wu((.2126729*e+.7151522*r+.072175*s)/1);return{l:116*u-16,a:500*(l-u),b:200*(u-Wu((.0193339*e+.119192*r+.9503041*s)/Wo)),alpha:t.a}}function Yd(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*Yu(e),r=Tm*Yu(r),s=Wo*Yu(s),new hi(Zu(3.2404542*r-1.5371385*e-.4985314*s),Zu(-.969266*r+1.8760108*e+.041556*s),Zu(.0556434*r-.2040259*e+1.0572252*s),t.alpha)}function Em(t,e,r){const s=e-t;return t+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const vl={forward:Wd,reverse:Yd,interpolate:function(t,e,r){return{l:en(t.l,e.l,r),a:en(t.a,e.a,r),b:en(t.b,e.b,r),alpha:en(t.alpha,e.alpha,r)}}},xl={forward:function(t){const{l:e,a:r,b:s}=Wd(t),l=Math.atan2(s,r)*Ns;return{h:l<0?l+360:l,c:Math.sqrt(r*r+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*jy,r=t.c;return Yd({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:Em(t.h,e.h,r),c:en(t.c,e.c,r),l:en(t.l,e.l,r),alpha:en(t.alpha,e.alpha,r)}}};var Zd=Object.freeze({__proto__:null,hcl:xl,lab:vl});class Dc{constructor(e,r,s,l,u){this.type=e,this.operator=r,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[f,_]of u)this.labels.push(f),this.outputs.push(_)}static interpolationFactor(e,r,s,l){let u=0;if(e.name==="exponential")u=bl(r,e.base,s,l);else if(e.name==="linear")u=bl(r,1,s,l);else if(e.name==="cubic-bezier"){const f=e.controlPoints;u=new ht(f[0],f[1],f[2],f[3]).solve(bl(r,1,s,l))}return u}static parse(e,r){let[s,l,u,...f]=e;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const x=l[1];if(typeof x!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:x}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const x=l.slice(1);if(x.length!==4||x.some(w=>typeof w!="number"||w<0||w>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,$t),!u)return null;const _=[];let v=null;s==="interpolate-hcl"||s==="interpolate-lab"?v=Ss:r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType);for(let x=0;x<f.length;x+=2){const w=f[x],E=f[x+1],I=x+3,L=x+4;if(typeof w!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(_.length&&_[_.length-1][0]>=w)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const O=r.parse(E,L,v);if(!O)return null;v=v||O.type,_.push([w,O])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new Dc(v,s,l,u,_):r.error(`Type ${ci(v)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return s[0].evaluate(e);const u=r.length;if(l>=r[u-1])return s[u-1].evaluate(e);const f=Pa(r,l),_=Dc.interpolationFactor(this.interpolation,l,r[f],r[f+1]),v=s[f].evaluate(e),x=s[f+1].evaluate(e);return this.operator==="interpolate"?zu[this.type.kind.toLowerCase()](v,x,_):this.operator==="interpolate-hcl"?xl.reverse(xl.interpolate(xl.forward(v),xl.forward(x),_)):vl.reverse(vl.interpolate(vl.forward(v),vl.forward(x),_))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)r.push(this.labels[s],this.outputs[s].serialize());return r}}function bl(t,e,r,s){const l=s-r,u=t-r;return l===0?0:e===1?u/l:(Math.pow(e,u)-1)/(Math.pow(e,l)-1)}var _s=Dc;class wl{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const l=r.expectedType;l&&l.kind!=="value"&&(s=l);const u=[];for(const _ of e.slice(1)){const v=r.parse(_,1+u.length,s,void 0,{typeAnnotation:"omit"});if(!v)return null;s=s||v.type,u.push(v)}const f=l&&u.some(_=>Ta(l,_.type));return new wl(f?on:s,u)}evaluate(e){let r,s=null,l=0;for(const u of this.args){if(l++,s=u.evaluate(e),s&&s instanceof mr&&!s.available&&(r||(r=s),s=null,l===this.args.length))return r;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Xd=wl;class Ku{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let u=1;u<e.length-1;u+=2){const f=e[u];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,u);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);const _=r.parse(e[u+1],u+1);if(!_)return null;s.push([f,_])}const l=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return l?new Ku(s,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,s]of this.bindings)e.push(r,s.serialize());return e.push(this.result.serialize()),e}}var Kd=Ku;class Yo{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,$t),l=r.parse(e[2],2,is(r.expectedType||on));return s&&l?new Yo(l.type.itemType,s,l):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new gi(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new gi(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new gi(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var an=Yo;class Jd{constructor(e,r){this.type=gn,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,on),l=r.parse(e[2],2,on);return s&&l?Er(s.type,[gn,_n,$t,al,on])?new Jd(s,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!No(r,["boolean","string","number","null"]))throw new gi(`Expected first argument to be of type boolean, string, number or null, but found ${ci(_i(r))} instead.`);if(!No(s,["string","array"]))throw new gi(`Expected second argument to be of type array or string, but found ${ci(_i(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Gy=Jd;class Ju{constructor(e,r,s){this.type=$t,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,on),l=r.parse(e[2],2,on);if(!s||!l)return null;if(!Er(s.type,[gn,_n,$t,al,on]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(s.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,$t);return u?new Ju(s,l,u):null}return new Ju(s,l)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!No(r,["boolean","string","number","null"]))throw new gi(`Expected first argument to be of type boolean, string, number or null, but found ${ci(_i(r))} instead.`);if(!No(s,["string","array"]))throw new gi(`Expected second argument to be of type array or string, but found ${ci(_i(s))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return s.indexOf(r,l)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Am=Ju;class Qd{constructor(e,r,s,l,u,f){this.inputType=e,this.type=r,this.input=s,this.cases=l,this.outputs=u,this.otherwise=f}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const u={},f=[];for(let x=2;x<e.length-1;x+=2){let w=e[x];const E=e[x+1];Array.isArray(w)||(w=[w]);const I=r.concat(x);if(w.length===0)return I.error("Expected at least one branch label.");for(const O of w){if(typeof O!="number"&&typeof O!="string")return I.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return I.error("Numeric branch labels must be integer values.");if(s){if(I.checkSubtype(s,_i(O)))return null}else s=_i(O);if(u[String(O)]!==void 0)return I.error("Branch labels must be unique.");u[String(O)]=f.length}const L=r.parse(E,x,l);if(!L)return null;l=l||L.type,f.push(L)}const _=r.parse(e[1],1,on);if(!_)return null;const v=r.parse(e[e.length-1],e.length-1,l);return v?_.type.kind!=="value"&&r.concat(1).checkSubtype(s,_.type)?null:new Qd(s,l,_,u,f,v):null}evaluate(e){const r=this.input.evaluate(e);return(_i(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),s=[],l={};for(const f of r){const _=l[this.cases[f]];_===void 0?(l[this.cases[f]]=s.length,s.push([this.cases[f],[f]])):s[_][1].push(f)}const u=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,_]of s)e.push(_.length===1?u(_[0]):_.map(u)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}var Im=Qd;class Qu{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const l=[];for(let f=1;f<e.length-1;f+=2){const _=r.parse(e[f],f,gn);if(!_)return null;const v=r.parse(e[f+1],f+1,s);if(!v)return null;l.push([_,v]),s=s||v.type}const u=r.parse(e[e.length-1],e.length-1,s);return u?new Qu(s,l,u):null}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Cm=Qu;class Lc{constructor(e,r,s,l){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,on),l=r.parse(e[2],2,$t);if(!s||!l)return null;if(!Er(s.type,[is(on),_n,on]))return r.error(`Expected first argument to be of type array or string, but found ${ci(s.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,$t);return u?new Lc(s.type,s,l,u):null}return new Lc(s.type,s,l)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!No(r,["string","array"]))throw new gi(`Expected first argument to be of type array or string, but found ${ci(_i(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return r.slice(s,l)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Tl=Lc;function ef(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function tf(t,e,r,s){return s.compare(e,r)===0}function Sl(t,e,r){const s=t!=="=="&&t!=="!=";return class tC{constructor(u,f,_){this.type=gn,this.lhs=u,this.rhs=f,this.collator=_,this.hasUntypedArgument=u.type.kind==="value"||f.type.kind==="value"}static parse(u,f){if(u.length!==3&&u.length!==4)return f.error("Expected two or three arguments.");const _=u[0];let v=f.parse(u[1],1,on);if(!v)return null;if(!ef(_,v.type))return f.concat(1).error(`"${_}" comparisons are not supported for type '${ci(v.type)}'.`);let x=f.parse(u[2],2,on);if(!x)return null;if(!ef(_,x.type))return f.concat(2).error(`"${_}" comparisons are not supported for type '${ci(x.type)}'.`);if(v.type.kind!==x.type.kind&&v.type.kind!=="value"&&x.type.kind!=="value")return f.error(`Cannot compare types '${ci(v.type)}' and '${ci(x.type)}'.`);s&&(v.type.kind==="value"&&x.type.kind!=="value"?v=new go(x.type,[v]):v.type.kind!=="value"&&x.type.kind==="value"&&(x=new go(v.type,[x])));let w=null;if(u.length===4){if(v.type.kind!=="string"&&x.type.kind!=="string"&&v.type.kind!=="value"&&x.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(w=f.parse(u[3],3,Fu),!w)return null}return new tC(v,x,w)}evaluate(u){const f=this.lhs.evaluate(u),_=this.rhs.evaluate(u);if(s&&this.hasUntypedArgument){const v=_i(f),x=_i(_);if(v.kind!==x.kind||v.kind!=="string"&&v.kind!=="number")throw new gi(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${v.kind}, ${x.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const v=_i(f),x=_i(_);if(v.kind!=="string"||x.kind!=="string")return e(u,f,_)}return this.collator?r(u,f,_,this.collator.evaluate(u)):e(u,f,_)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[t];return this.eachChild(f=>{u.push(f.serialize())}),u}}}const rf=Sl("==",function(t,e,r){return e===r},tf),nf=Sl("!=",function(t,e,r){return e!==r},function(t,e,r,s){return!tf(0,e,r,s)}),Hy=Sl("<",function(t,e,r){return e<r},function(t,e,r,s){return s.compare(e,r)<0}),qy=Sl(">",function(t,e,r){return e>r},function(t,e,r,s){return s.compare(e,r)>0}),Pm=Sl("<=",function(t,e,r){return e<=r},function(t,e,r,s){return s.compare(e,r)<=0}),Wy=Sl(">=",function(t,e,r){return e>=r},function(t,e,r,s){return s.compare(e,r)>=0});class sf{constructor(e,r,s,l,u,f){this.type=_n,this.number=e,this.locale=r,this.currency=s,this.unit=l,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,$t);if(!s)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=r.parse(l.locale,1,_n),!u))return null;let f=null;if(l.currency&&(f=r.parse(l.currency,1,_n),!f))return null;let _=null;if(l.unit&&(_=r.parse(l.unit,1,_n),!_))return null;let v=null;if(l["min-fraction-digits"]&&(v=r.parse(l["min-fraction-digits"],1,$t),!v))return null;let x=null;return l["max-fraction-digits"]&&(x=r.parse(l["max-fraction-digits"],1,$t),!x)?null:new sf(s,u,f,_,v,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class of{constructor(e){this.type=$t,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${ci(s.type)} instead.`):new of(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new gi(`Expected value to be of type string or array, but found ${ci(_i(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function Dm(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const af={"==":rf,"!=":nf,">":qy,"<":Hy,">=":Wy,"<=":Pm,array:go,at:an,boolean:go,case:Cm,coalesce:Xd,collator:bc,format:hl,image:Ma,in:Gy,"index-of":Am,interpolate:_s,"interpolate-hcl":_s,"interpolate-lab":_s,length:of,let:Kd,literal:_o,match:Im,number:go,"number-format":sf,object:go,slice:Tl,step:Pc,string:go,"to-boolean":yo,"to-color":yo,"to-number":yo,"to-string":yo,var:Ji,within:Vu,distance:Hu,config:_l};function lf(t,[e,r,s,l]){e=e.evaluate(t),r=r.evaluate(t),s=s.evaluate(t);const u=l?l.evaluate(t):1,f=pm(e,r,s,u);if(f)throw new gi(f);return new hi(e/255*u,r/255*u,s/255*u,u)}function Lm(t,[e,r,s,l]){e=e.evaluate(t),r=r.evaluate(t),s=s.evaluate(t);const u=l?l.evaluate(t):1,f=function(x,w,E,I){return typeof x=="number"&&x>=0&&x<=360?typeof w=="number"&&w>=0&&w<=100&&typeof E=="number"&&E>=0&&E<=100?I===void 0||typeof I=="number"&&I>=0&&I<=1?null:`Invalid hsla value [${[x,w,E,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof I=="number"?[x,w,E,I]:[x,w,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof I=="number"?[x,w,E,I]:[x,w,E]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,s,u);if(f)throw new gi(f);const _=`hsla(${e}, ${r}%, ${s}%, ${u})`,v=hi.parse(_);if(!v)throw new gi(`Failed to parse HSLA color: ${_}`);return v}function cf(t,e){return t in e}function uf(t,e){const r=e[t];return r===void 0?null:r}function Da(t){return{type:t}}rn.register(af,{error:[{kind:"error"},[_n],(t,[e])=>{throw new gi(e.evaluate(t))}],typeof:[_n,[on],(t,[e])=>ci(_i(e.evaluate(t)))],"to-rgba":[is($t,4),[Ss],(t,[e])=>e.evaluate(t).toArray()],rgb:[Ss,[$t,$t,$t],lf],rgba:[Ss,[$t,$t,$t,$t],lf],hsl:[Ss,[$t,$t,$t],Lm],hsla:[Ss,[$t,$t,$t,$t],Lm],has:{type:gn,overloads:[[[_n],(t,[e])=>cf(e.evaluate(t),t.properties())],[[_n,ll],(t,[e,r])=>cf(e.evaluate(t),r.evaluate(t))]]},get:{type:on,overloads:[[[_n],(t,[e])=>uf(e.evaluate(t),t.properties())],[[_n,ll],(t,[e,r])=>uf(e.evaluate(t),r.evaluate(t))]]},"feature-state":[on,[_n],(t,[e])=>uf(e.evaluate(t),t.featureState||{})],properties:[ll,[],t=>t.properties()],"geometry-type":[_n,[],t=>t.geometryType()],id:[on,[],t=>t.id()],zoom:[$t,[],t=>t.globals.zoom],pitch:[$t,[],t=>t.globals.pitch||0],"distance-from-center":[$t,[],t=>t.distanceFromCenter()],"measure-light":[$t,[_n],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[$t,[],t=>t.globals.heatmapDensity||0],"line-progress":[$t,[],t=>t.globals.lineProgress||0],"raster-value":[$t,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[$t,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[$t,[],t=>t.globals.skyRadialProgress||0],accumulated:[on,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[$t,Da($t),(t,e)=>{let r=0;for(const s of e)r+=s.evaluate(t);return r}],"*":[$t,Da($t),(t,e)=>{let r=1;for(const s of e)r*=s.evaluate(t);return r}],"-":{type:$t,overloads:[[[$t,$t],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[$t],(t,[e])=>-e.evaluate(t)]]},"/":[$t,[$t,$t],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[$t,[$t,$t],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[$t,[],()=>Math.LN2],pi:[$t,[],()=>Math.PI],e:[$t,[],()=>Math.E],"^":[$t,[$t,$t],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[$t,[$t],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[$t,[$t],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[$t,[$t],(t,[e])=>Math.log(e.evaluate(t))],log2:[$t,[$t],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[$t,[$t],(t,[e])=>Math.sin(e.evaluate(t))],cos:[$t,[$t],(t,[e])=>Math.cos(e.evaluate(t))],tan:[$t,[$t],(t,[e])=>Math.tan(e.evaluate(t))],asin:[$t,[$t],(t,[e])=>Math.asin(e.evaluate(t))],acos:[$t,[$t],(t,[e])=>Math.acos(e.evaluate(t))],atan:[$t,[$t],(t,[e])=>Math.atan(e.evaluate(t))],min:[$t,Da($t),(t,e)=>Math.min(...e.map(r=>r.evaluate(t)))],max:[$t,Da($t),(t,e)=>Math.max(...e.map(r=>r.evaluate(t)))],abs:[$t,[$t],(t,[e])=>Math.abs(e.evaluate(t))],round:[$t,[$t],(t,[e])=>{const r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[$t,[$t],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[$t,[$t],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[gn,[_n,on],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[gn,[on],(t,[e])=>t.id()===e.value],"filter-type-==":[gn,[_n],(t,[e])=>t.geometryType()===e.value],"filter-<":[gn,[_n,on],(t,[e,r])=>{const s=t.properties()[e.value],l=r.value;return typeof s==typeof l&&s<l}],"filter-id-<":[gn,[on],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[gn,[_n,on],(t,[e,r])=>{const s=t.properties()[e.value],l=r.value;return typeof s==typeof l&&s>l}],"filter-id->":[gn,[on],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[gn,[_n,on],(t,[e,r])=>{const s=t.properties()[e.value],l=r.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[gn,[on],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[gn,[_n,on],(t,[e,r])=>{const s=t.properties()[e.value],l=r.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[gn,[on],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[gn,[on],(t,[e])=>e.value in t.properties()],"filter-has-id":[gn,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[gn,[is(_n)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[gn,[is(on)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[gn,[_n,is(on)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[gn,[_n,is(on)],(t,[e,r])=>function(s,l,u,f){for(;u<=f;){const _=u+f>>1;if(l[_]===s)return!0;l[_]>s?f=_-1:u=_+1}return!1}(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:gn,overloads:[[[gn,gn],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[Da(gn),(t,e)=>{for(const r of e)if(!r.evaluate(t))return!1;return!0}]]},any:{type:gn,overloads:[[[gn,gn],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[Da(gn),(t,e)=>{for(const r of e)if(r.evaluate(t))return!0;return!1}]]},"!":[gn,[gn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[gn,[_n],(t,[e])=>{const r=t.globals&&t.globals.isSupportedScript;return!r||r(e.evaluate(t))}],upcase:[_n,[_n],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[_n,[_n],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[_n,Da(on),(t,e)=>e.map(r=>Ms(r.evaluate(t))).join("")],"resolved-locale":[_n,[Fu],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[$t,[$t,$t,on],(t,e)=>{const[r,s,l]=e.map(f=>f.evaluate(t));if(r>s||r===s)return r;let u;if(typeof l=="string")u=function(f){let _=0;if(f.length===0)return _;for(let v=0;v<f.length;v++)_=(_<<5)-_+f.charCodeAt(v),_|=0;return _}(l);else{if(typeof l!="number")throw new gi(`Invalid seed input: ${l}`);u=l}return r+Dm(u)()*(s-r)}]});var Ml=af;function hf(t){return{result:"success",value:t}}function La(t){return{result:"error",value:t}}function Rm(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function eh(t){return t["property-type"]==="data-driven"}function df(t){return Rm(t.expression,"measure-light")}function km(t){return Rm(t.expression,"zoom")}function ff(t){return!!t.expression&&t.expression.interpolated}function th(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Om(t){return t}function pf(t,e){const r=e.type==="color",s=t.stops&&typeof t.stops[0][0]=="object",l=s||!(s||t.property!==void 0),u=t.type||(ff(e)?"exponential":"interval");if(r&&((t=bd({},t)).stops&&(t.stops=t.stops.map(x=>[x[0],hi.parse(x[1])])),t.default=hi.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Zd[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let f,_,v;if(u==="exponential")f=zm;else if(u==="interval")f=Zy;else if(u==="categorical"){f=Yy,_=Object.create(null);for(const x of t.stops)_[x[0]]=x[1];v=typeof t.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);f=Fm}if(s){const x={},w=[];for(let L=0;L<t.stops.length;L++){const O=t.stops[L],z=O[0].zoom;x[z]===void 0&&(x[z]={zoom:z,type:t.type,property:t.property,default:t.default,stops:[]},w.push(z)),x[z].stops.push([O[0].value,O[1]])}const E=[];for(const L of w)E.push([x[L].zoom,pf(x[L],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:_s.interpolationFactor.bind(void 0,I),zoomStops:E.map(L=>L[0]),evaluate:({zoom:L},O)=>zm({stops:E,base:t.base},e,L).evaluate(L,O)}}if(l){const x=u==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:_s.interpolationFactor.bind(void 0,x),zoomStops:t.stops.map(w=>w[0]),evaluate:({zoom:w})=>f(t,e,w,_,v)}}return{kind:"source",evaluate(x,w){const E=w&&w.properties?w.properties[t.property]:void 0;return E===void 0?Rc(t.default,e.default):f(t,e,E,_,v)}}}function Rc(t,e,r){return t!==void 0?t:e!==void 0?e:r!==void 0?r:void 0}function Yy(t,e,r,s,l){return Rc(typeof r===l?s[r]:void 0,t.default,e.default)}function Zy(t,e,r){if(dl(r)!=="number")return Rc(t.default,e.default);const s=t.stops.length;if(s===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[s-1][0])return t.stops[s-1][1];const l=Pa(t.stops.map(u=>u[0]),r);return t.stops[l][1]}function zm(t,e,r){const s=t.base!==void 0?t.base:1;if(dl(r)!=="number")return Rc(t.default,e.default);const l=t.stops.length;if(l===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[l-1][0])return t.stops[l-1][1];const u=Pa(t.stops.map(w=>w[0]),r),f=function(w,E,I,L){const O=L-I,z=w-I;return O===0?0:E===1?z/O:(Math.pow(E,z)-1)/(Math.pow(E,O)-1)}(r,s,t.stops[u][0],t.stops[u+1][0]),_=t.stops[u][1],v=t.stops[u+1][1];let x=zu[e.type]||Om;if(t.colorSpace&&t.colorSpace!=="rgb"){const w=Zd[t.colorSpace];x=(E,I)=>w.reverse(w.interpolate(w.forward(E),w.forward(I),f))}return typeof _.evaluate=="function"?{evaluate(...w){const E=_.evaluate.apply(void 0,w),I=v.evaluate.apply(void 0,w);if(E!==void 0&&I!==void 0)return x(E,I,f)}}:x(_,v,f)}function Fm(t,e,r){return e.type==="color"?r=hi.parse(r):e.type==="formatted"?r=Ni.fromString(r.toString()):e.type==="resolvedImage"?r=mr.fromString(r.toString()):dl(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Rc(r,t.default,e.default)}class rh{constructor(e,r,s,l){this.expression=e,this._warningHistory={},this._evaluator=new mm(s,l),this._defaultValue=r?function(u){return u.type==="color"&&(th(u.default)||Array.isArray(u.default))?new hi(0,0,0,0):u.type==="color"?hi.parse(u.default)||null:u.default===void 0?null:u.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,l,u,f,_,v){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,l,u,f,_,v){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=v||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new gi(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function kc(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ml}function nh(t,e,r,s){const l=new wm(Ml,[],e?function(f){const _={color:Ss,string:_n,number:$t,enum:_n,boolean:gn,formatted:cl,resolvedImage:vc};return f.type==="array"?is(_[f.value]||on,f.length):_[f.type]}(e):void 0,void 0,void 0,r,s),u=l.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?hf(new rh(u,e,r,s)):La(l.errors)}class mf{constructor(e,r,s){this.kind=e,this._styleExpression=r,this.isLightConstant=s,this.isStateDependent=e!=="constant"&&!Ic(r.expression),this.isConfigDependent=!Cc(r.expression)}evaluateWithoutErrorHandling(e,r,s,l,u,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,l,u,f)}evaluate(e,r,s,l,u,f){return this._styleExpression.evaluate(e,r,s,l,u,f)}}class Oc{constructor(e,r,s,l,u){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Ic(r.expression),this.isLightConstant=u,this.isConfigDependent=!Cc(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,r,s,l,u,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,l,u,f)}evaluate(e,r,s,l,u,f){return this._styleExpression.evaluate(e,r,s,l,u,f)}interpolationFactor(e,r,s){return this.interpolationType?_s.interpolationFactor(this.interpolationType,e,r,s):0}}function ih(t,e,r,s){if((t=nh(t,e,r,s)).result==="error")return t;const l=t.value.expression,u=gl(l);if(!u&&!eh(e))return La([new Js("","data expressions not supported")]);const f=Vi(l,["zoom","pitch","distance-from-center"]);if(!f&&!km(e))return La([new Js("","zoom expressions not supported")]);const _=Vi(l,["measure-light"]);if(!_&&!df(e))return La([new Js("","measure-light expression not supported")]);const v=e.expression&&e.expression.relaxZoomRestriction,x=Fc(l);return x||f||v?x instanceof Js?La([x]):x instanceof _s&&!ff(e)?La([new Js("",'"interpolate" expressions cannot be used with this property')]):hf(x?new Oc(u?"camera":"composite",t.value,x.labels,x instanceof _s?x.interpolation:void 0,_):new mf(u?"constant":"source",t.value,_)):La([new Js("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class zc{constructor(e,r){this._parameters=e,this._specification=r,bd(this,pf(this._parameters,this._specification))}static deserialize(e){return new zc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Fc(t){let e=null;if(t instanceof Kd)e=Fc(t.result);else if(t instanceof Xd){for(const r of t.args)if(e=Fc(r),e)break}else(t instanceof Pc||t instanceof _s)&&t.input instanceof rn&&t.input.name==="zoom"&&(e=t);return e instanceof Js||t.eachChild(r=>{const s=Fc(r);s instanceof Js?e=s:e&&s&&e!==s&&(e=new Js("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Xy=$s,Vs=3;function $s(t,e,r){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var l=new Int32Array(this.arrayBuffer);t=l[0],this.d=(e=l[1])+2*(r=l[2]);for(var u=0;u<this.d*this.d;u++){var f=l[Vs+u],_=l[Vs+u+1];s.push(f===_?null:l.subarray(f,_))}var v=l[Vs+s.length+1];this.keys=l.subarray(l[Vs+s.length],v),this.bboxes=l.subarray(v),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var x=0;x<this.d*this.d;x++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var w=r/e*t;this.min=-w,this.max=t+w}$s.prototype.insert=function(t,e,r,s,l){this._forEachCell(e,r,s,l,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l)},$s.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},$s.prototype._insertCell=function(t,e,r,s,l,u){this.cells[l].push(u)},$s.prototype.query=function(t,e,r,s,l){var u=this.min,f=this.max;if(t<=u&&e<=u&&f<=r&&f<=s&&!l)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(t,e,r,s,this._queryCell,_,{},l),_},$s.prototype._queryCell=function(t,e,r,s,l,u,f,_){var v=this.cells[l];if(v!==null)for(var x=this.keys,w=this.bboxes,E=0;E<v.length;E++){var I=v[E];if(f[I]===void 0){var L=4*I;(_?_(w[L+0],w[L+1],w[L+2],w[L+3]):t<=w[L+2]&&e<=w[L+3]&&r>=w[L+0]&&s>=w[L+1])?(f[I]=!0,u.push(x[I])):f[I]=!1}}},$s.prototype._forEachCell=function(t,e,r,s,l,u,f,_){for(var v=this._convertToCellCoord(t),x=this._convertToCellCoord(e),w=this._convertToCellCoord(r),E=this._convertToCellCoord(s),I=v;I<=w;I++)for(var L=x;L<=E;L++){var O=this.d*L+I;if((!_||_(this._convertFromCellCoord(I),this._convertFromCellCoord(L),this._convertFromCellCoord(I+1),this._convertFromCellCoord(L+1)))&&l.call(this,t,e,r,s,O,u,f,_))return}},$s.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},$s.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},$s.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Vs+this.cells.length+1+1,r=0,s=0;s<this.cells.length;s++)r+=this.cells[s].length;var l=new Int32Array(e+r+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var u=e,f=0;f<t.length;f++){var _=t[f];l[Vs+f]=u,l.set(_,u),u+=_.length}return l[Vs+t.length]=u,l.set(this.keys,u),l[Vs+t.length+1]=u+=this.keys.length,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer};var xo=gt(Xy);const Bc={};function qt(t,e,r={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Bc[e]={klass:t,omit:r.omit||[]}}qt(Object,"Object"),xo.serialize=function(t,e){const r=t.toArrayBuffer();return e&&e.add(r),{buffer:r}},xo.deserialize=function(t){return new xo(t.buffer)},Object.defineProperty(xo,"name",{value:"Grid"}),qt(xo,"Grid"),qt(hi,"Color"),qt(Error,"Error"),qt(Ni,"Formatted"),qt(ul,"FormattedSection"),qt(Wn,"AJAXError"),qt(mr,"ResolvedImage"),qt(zc,"StylePropertyFunction"),qt(rh,"StyleExpression",{omit:["_evaluator"]}),qt(Oc,"ZoomDependentExpression"),qt(mf,"ZoomConstantExpression"),qt(rn,"CompoundExpression",{omit:["_evaluate"]});for(const t in Ml)Bc[Ml[t]._classRegistryKey]||qt(Ml[t],`Expression${t}`);function Bm(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function sh(t){return self.ImageBitmap&&t instanceof ImageBitmap}function Zo(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Bm(t)||sh(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const r=t;return e&&e.add(r.buffer),r}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const s of t)r.push(Zo(s,e));return r}if(t instanceof Map){const r={$name:"Map"};for(const[s,l]of t.entries())r[s]=Zo(l);return r}if(typeof t=="object"){const r=t.constructor,s=r._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const l=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(const u in t)t.hasOwnProperty(u)&&(Bc[s].omit.indexOf(u)>=0||(l[u]=Zo(t[u],e)));t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof t)}function Ra(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Bm(t)||sh(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Ra);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const l=new Map;for(const u of Object.keys(t))u!=="$name"&&l.set(u,Ra(t[u]));return l}const{klass:r}=Bc[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(t);const s=Object.create(r.prototype);for(const l of Object.keys(t))l!=="$name"&&(s[l]=Ra(t[l]));return s}throw new Error("can't deserialize object of type "+typeof t)}const er={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Xo(t){for(const e of t)if(_f(e.charCodeAt(0)))return!0;return!1}function Ky(t){for(const e of t)if(!Jy(e.charCodeAt(0)))return!1;return!0}function Jy(t){return!(er.Arabic(t)||er["Arabic Supplement"](t)||er["Arabic Extended-A"](t)||er["Arabic Presentation Forms-A"](t)||er["Arabic Presentation Forms-B"](t))}function _f(t){return!(t!==746&&t!==747&&(t<4352||!(er["Bopomofo Extended"](t)||er.Bopomofo(t)||er["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||er["CJK Compatibility Ideographs"](t)||er["CJK Compatibility"](t)||er["CJK Radicals Supplement"](t)||er["CJK Strokes"](t)||!(!er["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||er["CJK Unified Ideographs Extension A"](t)||er["CJK Unified Ideographs"](t)||er["Enclosed CJK Letters and Months"](t)||er["Hangul Compatibility Jamo"](t)||er["Hangul Jamo Extended-A"](t)||er["Hangul Jamo Extended-B"](t)||er["Hangul Jamo"](t)||er["Hangul Syllables"](t)||er.Hiragana(t)||er["Ideographic Description Characters"](t)||er.Kanbun(t)||er["Kangxi Radicals"](t)||er["Katakana Phonetic Extensions"](t)||er.Katakana(t)&&t!==12540||!(!er["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!er["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||er["Unified Canadian Aboriginal Syllabics"](t)||er["Unified Canadian Aboriginal Syllabics Extended"](t)||er["Vertical Forms"](t)||er["Yijing Hexagram Symbols"](t)||er["Yi Syllables"](t)||er["Yi Radicals"](t))))}function Nm(t){return!(_f(t)||function(e){return!!(er["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||er["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||er["Letterlike Symbols"](e)||er["Number Forms"](e)||er["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||er["Control Pictures"](e)&&e!==9251||er["Optical Character Recognition"](e)||er["Enclosed Alphanumerics"](e)||er["Geometric Shapes"](e)||er["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||er["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||er["CJK Symbols and Punctuation"](e)||er.Katakana(e)||er["Private Use Area"](e)||er["CJK Compatibility Forms"](e)||er["Small Form Variants"](e)||er["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function Vm(t){return t>=1424&&t<=2303||er["Arabic Presentation Forms-A"](t)||er["Arabic Presentation Forms-B"](t)}function $m(t,e){return!(!e&&Vm(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||er.Khmer(t))}function gf(t){for(const e of t)if(Vm(e.charCodeAt(0)))return!0;return!1}const yf="deferred",vf="loading",xf="loaded";let bf=null,ss="unavailable",Ko=null;const Um=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(ss="error"),bf&&bf(t)};function wf(){Tf.fire(new wa("pluginStateChange",{pluginStatus:ss,pluginURL:Ko}))}const Tf=new ol,Jo=function(){return ss},Sf=function(){if(ss!==yf||!Ko)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ss=vf,wf(),Ko&&Ye({url:Ko},t=>{t?Um(t):(ss=xf,wf())})},gs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ss===xf||gs.applyArabicShaping!=null,isLoading:()=>ss===vf,setState(t){ss=t.pluginStatus,Ko=t.pluginURL},isParsed:()=>gs.applyArabicShaping!=null&&gs.processBidirectionalText!=null&&gs.processStyledBidirectionalText!=null,getPluginURL:()=>Ko};class Yn{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,s){for(const l of r)if(!$m(l.charCodeAt(0),s))return!1;return!0}(e,gs.isLoaded())}}class oh{constructor(e,r,s,l){this.property=e,this.value=r,this.expression=function(u,f,_,v){if(th(u))return new zc(u,f);if(kc(u)||Array.isArray(u)&&u.length>0){const x=ih(u,f,_,v);if(x.result==="error")throw new Error(x.value.map(w=>`${w.key}: ${w.message}`).join(", "));return x.value}{let x=u;return typeof u=="string"&&f.type==="color"&&(x=hi.parse(u)),{kind:"constant",isConfigDependent:!1,evaluate:()=>x}}}(r===void 0?e.specification.default:r,e.specification,s,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class Mf{constructor(e,r,s){this.property=e,this.value=new oh(e,void 0,r,s)}transitioned(e,r){return new Ef(this.property,this.value,r,nr({},e.transition,this.transition),e.now)}untransitioned(){return new Ef(this.property,this.value,null,{},0)}}class bo{constructor(e,r,s){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=s,this.isConfigDependent=!1}getValue(e){return Kr(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Mf(this._values[e].property,this._scope,this._options)),this._values[e].value=new oh(this._values[e].property,r===null?void 0:Kr(r),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,r){r&&(this._options=r);const s=this._properties.properties;if(e)for(const l in e){const u=e[l];if(Gt(l,"-transition")){const f=l.slice(0,-11);s[f]&&this.setTransition(f,u)}else s[l]&&this.setValue(l,u)}}getTransition(e){return Kr(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Mf(this._values[e].property)),this._values[e].transition=Kr(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const l=this.getTransition(r);l!==void 0&&(e[`${r}-transition`]=l)}return e}transitioned(e,r){const s=new ka(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(e,r._values[l]);return s}untransitioned(){const e=new ka(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Ef{constructor(e,r,s,l,u){const f=l.delay||0,_=l.duration||0;u=u||0,this.property=e,this.value=r,this.begin=u+f,this.end=this.begin+_,e.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const l=e.now||0,u=this.value.possiblyEvaluate(e,r,s),f=this.prior;if(f){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return f.possiblyEvaluate(e,r,s);{const _=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,r,s),u,$e(_))}}return u}}class ka{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const l=new Nc(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,r,s);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Qy{constructor(e,r,s){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=s,this.isConfigDependent=!1}getValue(e){return Kr(this._values[e].value)}setValue(e,r){this._values[e]=new oh(this._values[e].property,r===null?void 0:Kr(r),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const l=new Nc(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,r,s);return l}}class El{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,l){return this.property.evaluate(this.value,this.parameters,e,r,s,l)}}class Nc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class wt{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,s){const l=zu[this.specification.type];return l?l(e,r,s):e}}class dr{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,l){return new El(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,l)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new El(this,{kind:"constant",value:void 0},e.parameters);const l=zu[this.specification.type];return l?new El(this,{kind:"constant",value:l(e.value.value,r.value.value,s)},e.parameters):e}evaluate(e,r,s,l,u,f){return e.kind==="constant"?e.value:e.evaluate(r,s,l,u,f)}}class Oa{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,l){return!!e.expression.evaluate(r,null,{},s,l)}interpolate(){return!1}}class Zn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new Yn(0,{});for(const s in e){const l=e[s];l.specification.overridable&&this.overridableProperties.push(s);const u=this.defaultPropertyValues[s]=new oh(l,void 0),f=this.defaultTransitionablePropertyValues[s]=new Mf(l);this.defaultTransitioningPropertyValues[s]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=u.possiblyEvaluate(r)}}}function Vc(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function $c(t){if(Array.isArray(t))return t.map($c);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const r in t)e[r]=$c(t[r]);return e}return Vc(t)}qt(dr,"DataDrivenProperty"),qt(wt,"DataConstantProperty"),qt(Oa,"ColorRampProperty");var Ce=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Af(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Af(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function ys(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Af(t)||(t=Uc(t));const r=t;let s=!0;try{s=function(x){if(!Al(x))return x;let w=$c(x);return If(w),w=jm(w),w}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const l=Ce[`filter_${e}`],u=nh(s,l);let f=null;if(u.result==="error")throw new Error(u.value.map(x=>`${x.key}: ${x.message}`).join(", "));f=(x,w,E)=>u.value.evaluate(x,w,{},E);let _=null,v=null;if(s!==r){const x=nh(r,l);if(x.result==="error")throw new Error(x.value.map(w=>`${w.key}: ${w.message}`).join(", "));_=(w,E,I,L,O)=>x.value.evaluate(w,E,{},I,void 0,void 0,L,O),v=!gl(x.value.expression)}return{filter:f,dynamicFilter:_||void 0,needGeometry:Gm(s),needFeature:!!v}}function jm(t){if(!Array.isArray(t))return t;const e=function(r){if(ev.has(r[0])){for(let s=1;s<r.length;s++)if(Al(r[s]))return!0}return r}(t);return e===!0?e:e.map(r=>jm(r))}function If(t){let e=!1;const r=[];if(t[0]==="case"){for(let s=1;s<t.length-1;s+=2)e=e||Al(t[s]),r.push(t[s+1]);r.push(t[t.length-1])}else if(t[0]==="match"){e=e||Al(t[1]);for(let s=2;s<t.length-1;s+=2)r.push(t[s+1]);r.push(t[t.length-1])}else if(t[0]==="step"){e=e||Al(t[1]);for(let s=1;s<t.length-1;s+=2)r.push(t[s+1])}e&&(t.length=0,t.push("any",...r));for(let s=1;s<t.length;s++)If(t[s])}function Al(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<t.length;r++)if(Al(t[r]))return!0;return!1}const ev=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function tv(t,e){return t<e?-1:t>e?1:0}function Gm(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Gm(t[e]))return!0;return!1}function Uc(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?jc(t[1],t[2],"=="):e==="!="?Gc(jc(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?jc(t[1],t[2],e):e==="any"?(r=t.slice(1),["any"].concat(r.map(Uc))):e==="all"?["all"].concat(t.slice(1).map(Uc)):e==="none"?["all"].concat(t.slice(1).map(Uc).map(Gc)):e==="in"?Cf(t[1],t.slice(2)):e==="!in"?Gc(Cf(t[1],t.slice(2))):e==="has"?Hm(t[1]):e!=="!has"||Gc(Hm(t[1]));var r}function jc(t,e,r){switch(t){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,t,e]}}function Cf(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",t,["literal",e.sort(tv)]]:["filter-in-small",t,["literal",e]]}}function Hm(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Gc(t){return["!",t]}const ah="";function Pf(t,e){return e?`${t}${ah}${e}`:t}const Hc="-transition";class os extends ol{constructor(e,r,s,l){if(super(),this.id=e.id,this.fqid=Pf(this.id,s),this.type=e.type,this.scope=s,this.options=l,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new Qy(r.layout,this.scope,l),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),r.paint)){this._transitionablePaint=new bo(r.paint,this.scope,l);for(const u in e.paint)this.setPaintProperty(u,e.paint[u]);for(const u in e.layout)this.setLayoutProperty(u,e.layout[u]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Nc(r.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,r),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Gt(e,Hc)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){const s=this._transitionablePaint,l=s._properties.properties;if(Gt(e,Hc)){const E=e.slice(0,-11);return l[E]&&s.setTransition(E,r||void 0),!1}if(!l[e])return!1;const u=s._values[e],f=u.value.isDataDriven(),_=u.value;s.setValue(e,r),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const v=s._values[e].value,x=v.isDataDriven(),w=Gt(e,"pattern")||e==="line-dasharray";return x||f||w||this._handleOverridablePaintPropertyUpdate(e,_,v)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r){return null}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return Vr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof El&&eh(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ys(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}const rv={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class lh{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class $n{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function wn(t,e=1){let r=0,s=0;return{members:t.map(l=>{const u=rv[l.type].BYTES_PER_ELEMENT,f=r=qc(r,Math.max(e,u)),_=l.components||1;return s=Math.max(s,u),r+=u*_,{name:l.name,type:l.type,components:_,offset:f}}),size:qc(r,Math.max(s,e)),alignment:e}}function qc(t,e){return Math.ceil(t/e)*e}class Us extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.int16[l+0]=r,this.int16[l+1]=s,e}}Us.prototype.bytesPerElement=4,qt(Us,"StructArrayLayout2i4");class Qi extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const u=3*e;return this.int16[u+0]=r,this.int16[u+1]=s,this.int16[u+2]=l,e}}Qi.prototype.bytesPerElement=6,qt(Qi,"StructArrayLayout3i6");class wo extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s,l)}emplace(e,r,s,l,u){const f=4*e;return this.int16[f+0]=r,this.int16[f+1]=s,this.int16[f+2]=l,this.int16[f+3]=u,e}}wo.prototype.bytesPerElement=8,qt(wo,"StructArrayLayout4i8");class Df extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,l,u)}emplace(e,r,s,l,u,f){const _=5*e;return this.int16[_+0]=r,this.int16[_+1]=s,this.int16[_+2]=l,this.int16[_+3]=u,this.int16[_+4]=f,e}}Df.prototype.bytesPerElement=10,qt(Df,"StructArrayLayout5i10");class Lf extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,f,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,s,l,u,f,_)}emplace(e,r,s,l,u,f,_,v){const x=6*e,w=12*e,E=3*e;return this.int16[x+0]=r,this.int16[x+1]=s,this.uint8[w+4]=l,this.uint8[w+5]=u,this.uint8[w+6]=f,this.uint8[w+7]=_,this.float32[E+2]=v,e}}Lf.prototype.bytesPerElement=12,qt(Lf,"StructArrayLayout2i4ub1f12");class Qo extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s,l)}emplace(e,r,s,l,u){const f=4*e;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=l,this.float32[f+3]=u,e}}Qo.prototype.bytesPerElement=16,qt(Qo,"StructArrayLayout4f16");class ea extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,l,u)}emplace(e,r,s,l,u,f){const _=6*e,v=3*e;return this.uint16[_+0]=r,this.uint16[_+1]=s,this.uint16[_+2]=l,this.uint16[_+3]=u,this.float32[v+2]=f,e}}ea.prototype.bytesPerElement=12,qt(ea,"StructArrayLayout4ui1f12");class Il extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s,l)}emplace(e,r,s,l,u){const f=4*e;return this.uint16[f+0]=r,this.uint16[f+1]=s,this.uint16[f+2]=l,this.uint16[f+3]=u,e}}Il.prototype.bytesPerElement=8,qt(Il,"StructArrayLayout4ui8");class ch extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,s,l,u,f)}emplace(e,r,s,l,u,f,_){const v=6*e;return this.int16[v+0]=r,this.int16[v+1]=s,this.int16[v+2]=l,this.int16[v+3]=u,this.int16[v+4]=f,this.int16[v+5]=_,e}}ch.prototype.bytesPerElement=12,qt(ch,"StructArrayLayout6i12");class Wc extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,f,_,v,x,w,E,I){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,s,l,u,f,_,v,x,w,E,I)}emplace(e,r,s,l,u,f,_,v,x,w,E,I,L){const O=12*e;return this.int16[O+0]=r,this.int16[O+1]=s,this.int16[O+2]=l,this.int16[O+3]=u,this.uint16[O+4]=f,this.uint16[O+5]=_,this.uint16[O+6]=v,this.uint16[O+7]=x,this.int16[O+8]=w,this.int16[O+9]=E,this.int16[O+10]=I,this.int16[O+11]=L,e}}Wc.prototype.bytesPerElement=24,qt(Wc,"StructArrayLayout4i4ui4i24");class Rf extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,s,l,u,f)}emplace(e,r,s,l,u,f,_){const v=10*e,x=5*e;return this.int16[v+0]=r,this.int16[v+1]=s,this.int16[v+2]=l,this.float32[x+2]=u,this.float32[x+3]=f,this.float32[x+4]=_,e}}Rf.prototype.bytesPerElement=20,qt(Rf,"StructArrayLayout3i3f20");class kf extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}kf.prototype.bytesPerElement=4,qt(kf,"StructArrayLayout1ul4");class Qs extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.uint16[l+0]=r,this.uint16[l+1]=s,e}}Qs.prototype.bytesPerElement=4,qt(Qs,"StructArrayLayout2ui4");class Of extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,f,_,v,x,w,E,I,L){const O=this.length;return this.resize(O+1),this.emplace(O,e,r,s,l,u,f,_,v,x,w,E,I,L)}emplace(e,r,s,l,u,f,_,v,x,w,E,I,L,O){const z=20*e,V=10*e;return this.int16[z+0]=r,this.int16[z+1]=s,this.int16[z+2]=l,this.int16[z+3]=u,this.int16[z+4]=f,this.float32[V+3]=_,this.float32[V+4]=v,this.float32[V+5]=x,this.float32[V+6]=w,this.int16[z+14]=E,this.uint32[V+8]=I,this.uint16[z+18]=L,this.uint16[z+19]=O,e}}Of.prototype.bytesPerElement=40,qt(Of,"StructArrayLayout5i4f1i1ul2ui40");class Yc extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,f,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,s,l,u,f,_)}emplace(e,r,s,l,u,f,_,v){const x=8*e;return this.int16[x+0]=r,this.int16[x+1]=s,this.int16[x+2]=l,this.int16[x+4]=u,this.int16[x+5]=f,this.int16[x+6]=_,this.int16[x+7]=v,e}}Yc.prototype.bytesPerElement=16,qt(Yc,"StructArrayLayout3i2i2i16");class uh extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,l,u)}emplace(e,r,s,l,u,f){const _=4*e,v=8*e;return this.float32[_+0]=r,this.float32[_+1]=s,this.float32[_+2]=l,this.int16[v+6]=u,this.int16[v+7]=f,e}}uh.prototype.bytesPerElement=16,qt(uh,"StructArrayLayout2f1f2i16");class zf extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s,l)}emplace(e,r,s,l,u){const f=12*e,_=3*e;return this.uint8[f+0]=r,this.uint8[f+1]=s,this.float32[_+1]=l,this.float32[_+2]=u,e}}zf.prototype.bytesPerElement=12,qt(zf,"StructArrayLayout2ub2f12");class wi extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const u=3*e;return this.uint16[u+0]=r,this.uint16[u+1]=s,this.uint16[u+2]=l,e}}wi.prototype.bytesPerElement=6,qt(wi,"StructArrayLayout3ui6");class Cl extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,f,_,v,x,w,E,I,L,O,z,V,j,K,ee,Q,le){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,r,s,l,u,f,_,v,x,w,E,I,L,O,z,V,j,K,ee,Q,le)}emplace(e,r,s,l,u,f,_,v,x,w,E,I,L,O,z,V,j,K,ee,Q,le,ae){const fe=30*e,ve=15*e,we=60*e;return this.int16[fe+0]=r,this.int16[fe+1]=s,this.int16[fe+2]=l,this.float32[ve+2]=u,this.float32[ve+3]=f,this.uint16[fe+8]=_,this.uint16[fe+9]=v,this.uint32[ve+5]=x,this.uint32[ve+6]=w,this.uint32[ve+7]=E,this.uint16[fe+16]=I,this.uint16[fe+17]=L,this.uint16[fe+18]=O,this.float32[ve+10]=z,this.float32[ve+11]=V,this.uint8[we+48]=j,this.uint8[we+49]=K,this.uint8[we+50]=ee,this.uint32[ve+13]=Q,this.int16[fe+28]=le,this.uint8[we+58]=ae,e}}Cl.prototype.bytesPerElement=60,qt(Cl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class hh extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,f,_,v,x,w,E,I,L,O,z,V,j,K,ee,Q,le,ae,fe,ve,we,Le,Te,je,Ke,Be,Xe,ze){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,e,r,s,l,u,f,_,v,x,w,E,I,L,O,z,V,j,K,ee,Q,le,ae,fe,ve,we,Le,Te,je,Ke,Be,Xe,ze)}emplace(e,r,s,l,u,f,_,v,x,w,E,I,L,O,z,V,j,K,ee,Q,le,ae,fe,ve,we,Le,Te,je,Ke,Be,Xe,ze,Ze){const St=20*e,et=40*e,Jt=80*e;return this.float32[St+0]=r,this.float32[St+1]=s,this.int16[et+4]=l,this.int16[et+5]=u,this.int16[et+6]=f,this.int16[et+7]=_,this.int16[et+8]=v,this.int16[et+9]=x,this.int16[et+10]=w,this.int16[et+11]=E,this.int16[et+12]=I,this.uint16[et+13]=L,this.uint16[et+14]=O,this.uint16[et+15]=z,this.uint16[et+16]=V,this.uint16[et+17]=j,this.uint16[et+18]=K,this.uint16[et+19]=ee,this.uint16[et+20]=Q,this.uint16[et+21]=le,this.uint16[et+22]=ae,this.uint16[et+23]=fe,this.uint16[et+24]=ve,this.uint16[et+25]=we,this.uint16[et+26]=Le,this.uint16[et+27]=Te,this.uint32[St+14]=je,this.float32[St+15]=Ke,this.float32[St+16]=Be,this.float32[St+17]=Xe,this.float32[St+18]=ze,this.uint8[Jt+76]=Ze,e}}hh.prototype.bytesPerElement=80,qt(hh,"StructArrayLayout2f9i15ui1ul4f1ub80");class Zc extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Zc.prototype.bytesPerElement=4,qt(Zc,"StructArrayLayout1f4");class ta extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,l,u)}emplace(e,r,s,l,u,f){const _=5*e;return this.float32[_+0]=r,this.float32[_+1]=s,this.float32[_+2]=l,this.float32[_+3]=u,this.float32[_+4]=f,e}}ta.prototype.bytesPerElement=20,qt(ta,"StructArrayLayout5f20");class Ff extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,f,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,s,l,u,f,_)}emplace(e,r,s,l,u,f,_,v){const x=7*e;return this.float32[x+0]=r,this.float32[x+1]=s,this.float32[x+2]=l,this.float32[x+3]=u,this.float32[x+4]=f,this.float32[x+5]=_,this.float32[x+6]=v,e}}Ff.prototype.bytesPerElement=28,qt(Ff,"StructArrayLayout7f28");class Xc extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s,l)}emplace(e,r,s,l,u){const f=6*e;return this.uint32[3*e+0]=r,this.uint16[f+2]=s,this.uint16[f+3]=l,this.uint16[f+4]=u,e}}Xc.prototype.bytesPerElement=12,qt(Xc,"StructArrayLayout1ul3ui12");class Bf extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Bf.prototype.bytesPerElement=2,qt(Bf,"StructArrayLayout1ui2");class za extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const u=3*e;return this.float32[u+0]=r,this.float32[u+1]=s,this.float32[u+2]=l,e}}za.prototype.bytesPerElement=12,qt(za,"StructArrayLayout3f12");class Kc extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.float32[l+0]=r,this.float32[l+1]=s,e}}Kc.prototype.bytesPerElement=8,qt(Kc,"StructArrayLayout2f8");class Nf extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,f,_,v,x,w,E,I,L,O,z,V){const j=this.length;return this.resize(j+1),this.emplace(j,e,r,s,l,u,f,_,v,x,w,E,I,L,O,z,V)}emplace(e,r,s,l,u,f,_,v,x,w,E,I,L,O,z,V,j){const K=16*e;return this.float32[K+0]=r,this.float32[K+1]=s,this.float32[K+2]=l,this.float32[K+3]=u,this.float32[K+4]=f,this.float32[K+5]=_,this.float32[K+6]=v,this.float32[K+7]=x,this.float32[K+8]=w,this.float32[K+9]=E,this.float32[K+10]=I,this.float32[K+11]=L,this.float32[K+12]=O,this.float32[K+13]=z,this.float32[K+14]=V,this.float32[K+15]=j,e}}Nf.prototype.bytesPerElement=64,qt(Nf,"StructArrayLayout16f64");class Jc extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,f,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,s,l,u,f,_)}emplace(e,r,s,l,u,f,_,v){const x=10*e,w=5*e;return this.uint16[x+0]=r,this.uint16[x+1]=s,this.uint16[x+2]=l,this.uint16[x+3]=u,this.float32[w+2]=f,this.float32[w+3]=_,this.float32[w+4]=v,e}}Jc.prototype.bytesPerElement=20,qt(Jc,"StructArrayLayout4ui3f20");class Vf extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}Vf.prototype.bytesPerElement=1,qt(Vf,"StructArrayLayout1ub1");class qm extends lh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}qm.prototype.size=40;class Wm extends Of{get(e){return new qm(this,e)}}qt(Wm,"CollisionBoxArray");class Ym extends lh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Ym.prototype.size=60;class Zm extends Cl{get(e){return new Ym(this,e)}}qt(Zm,"PlacedSymbolArray");class Xm extends lh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Xm.prototype.size=80;class Km extends hh{get(e){return new Xm(this,e)}}qt(Km,"SymbolInstanceArray");class Jm extends Zc{getoffsetX(e){return this.float32[1*e+0]}}qt(Jm,"GlyphOffsetArray");class Qc extends Us{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}qt(Qc,"SymbolLineVertexArray");class Qm extends lh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Qm.prototype.size=12;class e_ extends Xc{get(e){return new Qm(this,e)}}qt(e_,"FeatureIndexArray");class eu extends Qs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}qt(eu,"FillExtrusionCentroidArray");const nv=wn([{name:"a_pos",components:2,type:"Int16"}],4),t_=wn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ni{constructor(e=[]){this.segments=e}_prepareSegment(e,r,s,l){let u=this.segments[this.segments.length-1];return e>ni.MAX_VERTEX_ARRAY_LENGTH&&ye(`Max vertices per segment is ${ni.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>ni.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:r,primitiveOffset:s,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}prepareSegment(e,r,s,l){return this._prepareSegment(e,r.length,s.length,l)}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,l){return new ni([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function $f(t,e){return 256*(t=zt(Math.floor(t),0,255))+zt(Math.floor(e),0,255)}ni.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qt(ni,"SegmentVector");const r_=wn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),n_=wn([{name:"a_dash",components:4,type:"Uint16"}]);var tu={exports:{}},dh={exports:{}};(function(t){t.exports=function(e,r){var s,l,u,f,_,v,x,w;for(l=e.length-(s=3&e.length),u=r,_=3432918353,v=461845907,w=0;w<l;)x=255&e.charCodeAt(w)|(255&e.charCodeAt(++w))<<8|(255&e.charCodeAt(++w))<<16|(255&e.charCodeAt(++w))<<24,++w,u=27492+(65535&(f=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*_+(((x>>>16)*_&65535)<<16)&4294967295)<<15|x>>>17))*v+(((x>>>16)*v&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(x=0,s){case 3:x^=(255&e.charCodeAt(w+2))<<16;case 2:x^=(255&e.charCodeAt(w+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&e.charCodeAt(w)))*_+(((x>>>16)*_&65535)<<16)&4294967295)<<15|x>>>17))*v+(((x>>>16)*v&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}})(dh);var Uf=dh.exports,i_={exports:{}};(function(t){t.exports=function(e,r){for(var s,l=e.length,u=r^l,f=0;l>=4;)s=1540483477*(65535&(s=255&e.charCodeAt(f)|(255&e.charCodeAt(++f))<<8|(255&e.charCodeAt(++f))<<16|(255&e.charCodeAt(++f))<<24))+((1540483477*(s>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),l-=4,++f;switch(l){case 3:u^=(255&e.charCodeAt(f+2))<<16;case 2:u^=(255&e.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}})(i_);var s_=Uf,o_=i_.exports;tu.exports=s_,tu.exports.murmur3=s_,tu.exports.murmur2=o_;var jf=gt(tu.exports);class ru{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,s,l){this.ids.push(a_(e)),this.positions.push(r,s,l)}eachPosition(e,r){const s=a_(e);let l=0,u=this.ids.length-1;for(;l<u;){const f=l+u>>1;this.ids[f]>=s?u=f:l=f+1}for(;this.ids[l]===s;)r(this.positions[3*l],this.positions[3*l+1],this.positions[3*l+2]),l++}static serialize(e,r){const s=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Gf(s,l,0,s.length-1),r&&(r.add(s.buffer),r.add(l.buffer)),{ids:s,positions:l}}static deserialize(e){const r=new ru;let s;r.ids=e.ids,r.positions=e.positions;for(const l of r.ids)l!==s&&r.uniqueIds.push(l),s=l;return r.indexed=!0,r}}function a_(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:jf(String(t))}function Gf(t,e,r,s){for(;r<s;){const l=t[r+s>>1];let u=r-1,f=s+1;for(;;){do u++;while(t[u]<l);do f--;while(t[f]>l);if(u>=f)break;fh(t,u,f),fh(e,3*u,3*f),fh(e,3*u+1,3*f+1),fh(e,3*u+2,3*f+2)}f-r<s-f?(Gf(t,e,r,f),r=f+1):(Gf(t,e,f+1,s),s=f)}}function fh(t,e,r){const s=t[e];t[e]=t[r],t[r]=s}qt(ru,"FeaturePositionMap");class To{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}}class ph extends To{constructor(e){super(e),this.current=0}set(e,r,s){this.fetchUniformLocation(e,r)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class Wi extends To{constructor(e){super(e),this.current=0}set(e,r,s){this.fetchUniformLocation(e,r)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class ra extends To{constructor(e){super(e),this.current=[0,0]}set(e,r,s){this.fetchUniformLocation(e,r)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class l_ extends To{constructor(e){super(e),this.current=[0,0,0]}set(e,r,s){this.fetchUniformLocation(e,r)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class h extends To{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,s){this.fetchUniformLocation(e,r)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class n extends To{constructor(e){super(e),this.current=hi.transparent}set(e,r,s){this.fetchUniformLocation(e,r)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const a=new Float32Array(16);class d extends To{constructor(e){super(e),this.current=a}set(e,r,s){if(this.fetchUniformLocation(e,r)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let l=1;l<16;l++)if(s[l]!==this.current[l]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const m=new Float32Array(9),g=new Float32Array(4);class b extends To{constructor(e){super(e),this.current=g}set(e,r,s){if(this.fetchUniformLocation(e,r)){for(let l=0;l<4;l++)if(s[l]!==this.current[l]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function S(t){return[$f(255*t.r,255*t.g),$f(255*t.b,255*t.a)]}class A{constructor(e,r,s){this.value=e,this.uniformNames=r.map(l=>`u_${l}`),this.type=s}setUniform(e,r,s,l,u){r.set(e,u,l.constantOr(this.value))}getBinding(e,r){return this.type==="color"?new n(e):new Wi(e)}}class P{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,s,l,u){const f=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;f&&r.set(e,u,f)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new h(e):new Wi(e)}}class D{constructor(e,r,s,l){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(u=>({name:`a_${u}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,r,s,l,u,f,_){const v=this.paintVertexArray.length,x=this.expression.evaluate(new Yn(0,{brightness:f}),r,{},u,l,_);this.paintVertexArray.resize(e),this._setPaintValue(v,e,x)}updatePaintArray(e,r,s,l,u,f,_){const v=this.expression.evaluate({zoom:0,brightness:_},s,l,void 0,u);this._setPaintValue(e,r,v)}_setPaintValue(e,r,s){if(this.type==="color"){const l=S(s);for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class k{constructor(e,r,s,l,u,f){this.expression=e,this.uniformNames=r.map(_=>`u_${_}_t`),this.type=s,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,r,s,l,u,f,_){const v=this.expression.evaluate(new Yn(this.zoom,{brightness:f}),r,{},u,l,_),x=this.expression.evaluate(new Yn(this.zoom+1,{brightness:f}),r,{},u,l,_),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,v,x)}updatePaintArray(e,r,s,l,u,f,_){const v=this.expression.evaluate({zoom:this.zoom,brightness:_},s,l,void 0,u),x=this.expression.evaluate({zoom:this.zoom+1,brightness:_},s,l,void 0,u);this._setPaintValue(e,r,v,x)}_setPaintValue(e,r,s,l){if(this.type==="color"){const u=S(s),f=S(l);for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,u[0],u[1],f[0],f[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,s,l,u){const f=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,_=zt(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);r.set(e,u,_)}getBinding(e,r){return new Wi(e)}}class F{constructor(e,r,s,l,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(s==="array"?n_:r_).members;for(let f=0;f<r.length;++f);this.paintVertexArray=new l}populatePaintArray(e,r,s){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,l,u,f,_){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],f)}_setPaintValues(e,r,s,l){if(!l||!s)return;const u=l[s];if(!u)return;const{tl:f,br:_,pixelRatio:v}=u;for(let x=e;x<r;x++)this.paintVertexArray.emplace(x,f[0],f[1],_[0],_[1],v)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class N{constructor(e,r,s=()=>!0){this.binders={},this._buffers=[];const l=[];for(const u in e.paint._values){const f=e.paint.get(u);if(!s(u)||!(f instanceof El&&eh(f.property.specification)))continue;const _=W(u,e.type),v=f.value,x=f.property.specification.type,w=!!f.property.useIntegerZoom,E=u==="line-dasharray"||u.endsWith("pattern"),I=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(v.kind!=="constant"||I)if(v.kind==="source"||I||E){const L=re(u,x,"source");this.binders[u]=E?new F(v,_,x,L,e.id):new D(v,_,x,L),l.push(`/a_${u}`)}else{const L=re(u,x,"composite");this.binders[u]=new k(v,_,x,w,r,L),l.push(`/z_${u}`)}else this.binders[u]=E?new P(v.value,_):new A(v.value,_,x),l.push(`/u_${u}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof D||r instanceof k?r.maxValue:0}populatePaintArrays(e,r,s,l,u,f,_){for(const v in this.binders){const x=this.binders[v];(x instanceof D||x instanceof k||x instanceof F)&&x.populatePaintArray(e,r,s,l,u,f,_)}}setConstantPatternPositions(e){for(const r in this.binders){const s=this.binders[r];s instanceof P&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,r,s,l,u,f,_,v){let x=!1;const w=Object.keys(e),E=w.length!==0,I=E?w:r.uniqueIds;for(const L in this.binders){const O=this.binders[L];if((O instanceof D||O instanceof k||O instanceof F)&&(O.expression.isStateDependent===!0||O.expression.isLightConstant===!1)){const z=u.paint.get(L);O.expression=z.value;for(const V of I){const j=e[V.toString()];r.eachPosition(V,(K,ee,Q)=>{const le=l.feature(K);O.updatePaintArray(ee,Q,le,j,f,_,v)})}if(!E)for(const V of s.uniqueIds){const j=e[V.toString()];s.eachPosition(V,(K,ee,Q)=>{const le=l.feature(K);O.updatePaintArray(ee,Q,le,j,f,_,v)})}x=!0}}return x}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof A||s instanceof P)&&e.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof D||s instanceof k||s instanceof F)for(let l=0;l<s.paintVertexAttributes.length;l++)e.push(s.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof A||s instanceof P||s instanceof k)for(const l of s.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof A||l instanceof P||l instanceof k)for(const u of l.uniformNames)r.push({name:u,property:s,binding:l.getBinding(e,u)})}return r}setUniforms(e,r,s,l,u){for(const{name:f,property:_,binding:v}of s)this.binders[_].setUniform(e,v,u,l.get(_),f)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof D||r instanceof k||r instanceof F)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof D||s instanceof k||s instanceof F)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof D||r instanceof k||r instanceof F)&&r.destroy()}}}class q{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new N(l,r,s);this.needsUpload=!1,this._featureMap=new ru,this._featureMapWithoutIds=new ru,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,s,l,u,f,_,v){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,r,l,u,f,_,v);r.id!==void 0?this._featureMap.add(r.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,l,u,f){for(const _ of s)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,_,l,u,f||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const G={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function W(t,e){return G[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const U={"line-pattern":{source:ea,composite:ea},"fill-pattern":{source:ea,composite:ea},"fill-extrusion-pattern":{source:ea,composite:ea},"line-dasharray":{source:Il,composite:Il}},X={color:{source:Kc,composite:Qo},number:{source:Zc,composite:Kc}};function re(t,e,r){const s=U[t];return s&&s[r]||X[e][r]}qt(A,"ConstantBinder"),qt(P,"PatternConstantBinder"),qt(D,"SourceExpressionBinder"),qt(F,"PatternCompositeBinder"),qt(k,"CompositeExpressionBinder"),qt(N,"ProgramConfiguration",{omit:["_buffers"]}),qt(q,"ProgramConfigurationSet");const J=kt/Math.PI/2,ne=5,Y=6,se=16383,ce=64,de=[ce,32,16],ge=-J,De=J;function xe(t,e,r,s=J){return r=Ve(r),[t*Math.sin(r)*s,-e*s,t*Math.cos(r)*s]}function Ne(t,e,r){return xe(Math.cos(Ve(t)),Math.sin(Ve(t)),e,r)}const Fe=63710088e-1,tt=2*Math.PI*Fe;class be{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new be(Ft(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,l=e.lat*r,u=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((e.lng-this.lng)*r);return Fe*Math.acos(Math.min(u,1))}toBounds(e=0){const r=360*e/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new Oe({lng:this.lng-s,lat:this.lat-r},{lng:this.lng+s,lat:this.lat+r})}toEcef(e){return Ne(this.lat,this.lng,J+e*J/Fe)}static convert(e){if(e instanceof be)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new be(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new be(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Oe{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof be?new be(e.lng,e.lat):be.convert(e),this}setSouthWest(e){return this._sw=e instanceof be?new be(e.lng,e.lat):be.convert(e),this}extend(e){const r=this._sw,s=this._ne;let l,u;if(e instanceof be)l=e,u=e;else{if(!(e instanceof Oe))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Oe.convert(e)):this.extend(be.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(be.convert(e)):this;if(l=e._sw,u=e._ne,!l||!u)return this}return r||s?(r.lng=Math.min(l.lng,r.lng),r.lat=Math.min(l.lat,r.lat),s.lng=Math.max(u.lng,s.lng),s.lat=Math.max(u.lat,s.lat)):(this._sw=new be(l.lng,l.lat),this._ne=new be(u.lng,u.lat)),this}getCenter(){return new be((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new be(this.getWest(),this.getNorth())}getSouthEast(){return new be(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:s}=be.convert(e);let l=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&l}static convert(e){return!e||e instanceof Oe?e:new Oe(e)}}var me={};(function(t,e){(function(r){function s(u,f,_){var v=l(256*u,256*(f=Math.pow(2,_)-f-1),_),x=l(256*(u+1),256*(f+1),_);return v[0]+","+v[1]+","+x[0]+","+x[1]}function l(u,f,_){var v=2*Math.PI*6378137/256/Math.pow(2,_);return[u*v-2*Math.PI*6378137/2,f*v-2*Math.PI*6378137/2]}r.getURL=function(u,f,_,v,x,w){return w=w||{},u+"?"+["bbox="+s(_,v,x),"format="+(w.format||"image/png"),"service="+(w.service||"WMS"),"version="+(w.version||"1.1.1"),"request="+(w.request||"GetMap"),"srs="+(w.srs||"EPSG:3857"),"width="+(w.width||256),"height="+(w.height||256),"layers="+f].join("&")},r.getTileBBox=s,r.getMercCoords=l,Object.defineProperty(r,"__esModule",{value:!0})})(e)})(0,me);var Ae=me;class st{constructor(e,r,s){this.z=e,this.x=r,this.y=s,this.key=Dt(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const s=Ae.getTileBBox(this.x,this.y,this.z),l=function(u,f,_){let v,x="";for(let w=u;w>0;w--)v=1<<w-1,x+=(f&v?1:0)+(_&v?2:0);return x}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class xt{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Dt(e,r.z,r.z,r.x,r.y)}}class _t{constructor(e,r,s,l,u){this.overscaledZ=e,this.wrap=r,this.canonical=new st(s,+l,+u),this.key=r===0&&e===s?this.canonical.key:Dt(r,e,s,l,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new _t(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _t(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Dt(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Dt(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new _t(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new _t(r,this.wrap,r,s,l),new _t(r,this.wrap,r,s+1,l),new _t(r,this.wrap,r,s,l+1),new _t(r,this.wrap,r,s+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new _t(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new _t(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new xt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Dt(t,e,r,s,l){const u=1<<Math.min(r,22);let f=u*(l%u)+s%u;return t&&r<22&&(f+=u*u*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*f+r)+(e-r)}const Qt=[t=>{let e=t.canonical.x-1,r=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,r--),new _t(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,r=t.wrap;return e===1<<t.canonical.z&&(e=0,r++),new _t(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>new _t(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new _t(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];qt(st,"CanonicalTileID"),qt(_t,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const cr=0,sr=25.5;function ar(t){return tt*Math.cos(t*Math.PI/180)}function kr(t){return(180+t)/360}function Mr(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Cr(t,e){return t/ar(e)}function Ir(t){return 360*t-180}function nn(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Dn(t,e){return t*ar(nn(e))}const qr=85.051129;function Xn(t){return Math.cos(Ve(zt(t,-qr,qr)))}function Wr(t,e){const r=zt(e,cr,sr),s=Math.pow(2,r);return Xn(t)*tt/(512*s)}function cn(t){return 1/Math.cos(t*Math.PI/180)}function Yr(t,e=0){const r=Math.exp(Math.PI*(1-(t.y+e/kt)/(1<<t.z)*2));return 80150034*r/(r*r+1)/kt/(1<<t.z)}class ln{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=be.convert(e);return new ln(kr(s.lng),Mr(s.lat),Cr(r,s.lat))}toLngLat(){return new be(Ir(this.x),nn(this.y))}toAltitude(){return Dn(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/tt*cn(nn(this.y))}}function kn(t,e,r,s,l,u,f,_,v){const x=(e+s)/2,w=(r+l)/2,E=new Se(x,w);_(E),function(I,L,O,z,V,j){const K=O-V,ee=z-j;return Math.abs((z-L)*K-(O-I)*ee)/Math.hypot(K,ee)}(E.x,E.y,u.x,u.y,f.x,f.y)>=v?(kn(t,e,r,x,w,u,E,_,v),kn(t,x,w,s,l,E,f,_,v)):t.push(f)}function mn(t,e,r){let s=t[0],l=s.x,u=s.y;e(s);const f=[s];for(let _=1;_<t.length;_++){const v=t[_],{x,y:w}=v;e(v),kn(f,l,u,x,w,s,v,e,r),l=x,u=w,s=v}return f}function Ti(t,e,r,s){if(s(e,r)){const l=e.add(r)._mult(.5);Ti(t,e,l,s),Ti(t,l,r,s)}else t.push(r)}function $i(t,e){let r=t[0];const s=[r];for(let l=1;l<t.length;l++){const u=t[l];Ti(s,r,u,e),r=u}return s}const as=Math.pow(2,14)-1,eo=-as-1;function ls(t,e){const r=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=zt(r,eo,as),t.y=zt(s,eo,as),(r<t.x||r>t.x+1||s<t.y||s>t.y+1)&&ye("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Si(t,e,r){const s=t.loadGeometry(),l=t.extent,u=kt/l;if(e&&r&&r.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:_,x:v,y:x,projection:w}=r,E=I=>{const L=Ir((e.x+I.x/l)/f),O=nn((e.y+I.y/l)/f),z=w.project(L,O);I.x=(z.x*_-v)*l,I.y=(z.y*_-x)*l};for(let I=0;I<s.length;I++)if(t.type!==1)s[I]=mn(s[I],E,1);else{const L=[];for(const O of s[I])O.x<0||O.x>=l||O.y<0||O.y>=l||(E(O),L.push(O));s[I]=L}}for(const f of s)for(const _ of f)ls(_,u);return s}function yi(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Si(t):[]}}function Yi(t,e,r,s,l){t.emplaceBack(2*e+(s+1)/2,2*r+(l+1)/2)}function es(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class cs{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Us,this.indexArray=new wi,this.segments=new ni,this.programConfigurations=new q(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,l){const u=this.layers[0],f=[];let _=null;u.type==="circle"&&(_=u.layout.get("circle-sort-key"));for(const{feature:x,id:w,index:E,sourceLayerIndex:I}of e){const L=this.layers[0]._featureFilter.needGeometry,O=yi(x,L);if(!this.layers[0]._featureFilter.filter(new Yn(this.zoom),O,s))continue;const z=_?_.evaluate(O,{},s):void 0,V={id:w,properties:x.properties,type:x.type,sourceLayerIndex:I,index:E,geometry:L?O.geometry:Si(x,s,l),patterns:{},sortKey:z};f.push(V)}_&&f.sort((x,w)=>x.sortKey-w.sortKey);let v=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new ch,v=l.projection);for(const x of f){const{geometry:w,index:E,sourceLayerIndex:I}=x,L=e[E].feature;this.addFeature(x,w,E,r.availableImages,s,v,r.brightness),r.featureIndex.insert(L,w,E,I,this.index)}}update(e,r,s,l,u){const f=Object.keys(e).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,f?this.stateDependentLayers:this.layers,s,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,t_.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,s,l,u,f,_){for(const v of r)for(const x of v){const w=x.x,E=x.y;if(w<0||w>=kt||E<0||E>=kt)continue;if(f){const O=f.projectTilePoint(w,E,u),z=f.upVector(u,w,E),V=this.globeExtVertexArray;es(V,O,z),es(V,O,z),es(V,O,z),es(V,O,z)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),L=I.vertexLength;Yi(this.layoutVertexArray,w,E,-1,-1),Yi(this.layoutVertexArray,w,E,1,-1),Yi(this.layoutVertexArray,w,E,1,1),Yi(this.layoutVertexArray,w,E,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},l,u,_)}}function to(t,e){for(let r=0;r<t.length;r++)if(So(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(So(t,e[r]))return!0;return!!iu(t,e)}function na(t,e,r){return!!So(t,e)||!!su(e,t,r)}function Fa(t,e){if(t.length===1)return mh(e,t[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let l=0;l<s.length;l++)if(So(t,s[l]))return!0}for(let r=0;r<t.length;r++)if(mh(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(iu(t,e[r]))return!0;return!1}function nu(t,e,r){if(t.length>1){if(iu(t,e))return!0;for(let s=0;s<e.length;s++)if(su(e[s],t,r))return!0}for(let s=0;s<t.length;s++)if(su(t[s],e,r))return!0;return!1}function iu(t,e){if(t.length===0||e.length===0)return!1;for(let r=0;r<t.length-1;r++){const s=t[r],l=t[r+1];for(let u=0;u<e.length-1;u++)if(Hf(s,l,e[u],e[u+1]))return!0}return!1}function Hf(t,e,r,s){return qe(t,r,s)!==qe(e,r,s)&&qe(t,e,r)!==qe(t,e,s)}function su(t,e,r){const s=r*r;if(e.length===1)return t.distSqr(e[0])<s;for(let l=1;l<e.length;l++)if(Pl(t,e[l-1],e[l])<s)return!0;return!1}function Pl(t,e,r){const s=e.distSqr(r);if(s===0)return t.distSqr(e);const l=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/s;return t.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function mh(t,e){let r,s,l,u=!1;for(let f=0;f<t.length;f++){r=t[f];for(let _=0,v=r.length-1;_<r.length;v=_++)s=r[_],l=r[v],s.y>e.y!=l.y>e.y&&e.x<(l.x-s.x)*(e.y-s.y)/(l.y-s.y)+s.x&&(u=!u)}return u}function So(t,e){let r=!1;for(let s=0,l=t.length-1;s<t.length;l=s++){const u=t[s],f=t[l];u.y>e.y!=f.y>e.y&&e.x<(f.x-u.x)*(e.y-u.y)/(f.y-u.y)+u.x&&(r=!r)}return r}function F1(t,e,r,s,l){for(const f of t)if(e<=f.x&&r<=f.y&&s>=f.x&&l>=f.y)return!0;const u=[new Se(e,r),new Se(e,l),new Se(s,l),new Se(s,r)];if(t.length>2){for(const f of u)if(So(t,f))return!0}for(let f=0;f<t.length-1;f++)if(tD(t[f],t[f+1],u))return!0;return!1}function tD(t,e,r){const s=r[0],l=r[2];if(t.x<s.x&&e.x<s.x||t.x>l.x&&e.x>l.x||t.y<s.y&&e.y<s.y||t.y>l.y&&e.y>l.y)return!1;const u=qe(t,e,r[0]);return u!==qe(t,e,r[1])||u!==qe(t,e,r[2])||u!==qe(t,e,r[3])}function _h(t,e,r,s,l,u){let f=e.y-t.y,_=t.x-e.x;if(u=u||0){const v=f*f+_*_;if(v===0)return!0;const x=Math.sqrt(v);f/=x,_/=x}return!((r.x-t.x)*f+(r.y-t.y)*_-u<0||(s.x-t.x)*f+(s.y-t.y)*_-u<0||(l.x-t.x)*f+(l.y-t.y)*_-u<0)}function iv(t,e,r,s,l,u,f){return!(_h(t,e,s,l,u,f)||_h(e,r,s,l,u,f)||_h(r,t,s,l,u,f)||_h(s,l,t,e,r,f)||_h(l,u,t,e,r,f)||_h(u,s,t,e,r,f))}function gh(t,e,r){const s=e.paint.get(t).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(t)}function c_(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function B1(t,e,r,s,l){if(!e[0]&&!e[1])return t;const u=Se.convert(e)._mult(l);r==="viewport"&&u._rotate(-s);const f=[];for(let _=0;_<t.length;_++)f.push(t[_].sub(u));return f}function N1(t,e,r,s){const l=Se.convert(t)._mult(s);return e==="viewport"&&l._rotate(-r),l}qt(cs,"CircleBucket",{omit:["layers"]});const rD=new Zn({"circle-sort-key":new dr(Ce.layout_circle["circle-sort-key"]),visibility:new wt(Ce.layout_circle.visibility)});var nD={paint:new Zn({"circle-radius":new dr(Ce.paint_circle["circle-radius"]),"circle-color":new dr(Ce.paint_circle["circle-color"]),"circle-blur":new dr(Ce.paint_circle["circle-blur"]),"circle-opacity":new dr(Ce.paint_circle["circle-opacity"]),"circle-translate":new wt(Ce.paint_circle["circle-translate"]),"circle-translate-anchor":new wt(Ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new wt(Ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new wt(Ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new dr(Ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new dr(Ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new dr(Ce.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new wt(Ce.paint_circle["circle-emissive-strength"])}),layout:rD},Pi={},Di={};Object.defineProperty(Di,"__esModule",{value:!0}),Di.setMatrixArrayType=function(t){Di.ARRAY_TYPE=$1=t},Di.toRadian=function(t){return t*sD},Di.equals=function(t,e){return Math.abs(t-e)<=V1*Math.max(1,Math.abs(t),Math.abs(e))},Di.RANDOM=Di.ARRAY_TYPE=Di.EPSILON=void 0;var V1=1e-6;Di.EPSILON=V1;var $1=typeof Float32Array<"u"?Float32Array:Array;Di.ARRAY_TYPE=$1;var iD=Math.random;Di.RANDOM=iD;var sD=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Kn={};function sv(t){return sv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sv(t)}Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.create=function(){var t=new Dl.ARRAY_TYPE(4);return Dl.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Kn.clone=function(t){var e=new Dl.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Kn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Kn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Kn.fromValues=function(t,e,r,s){var l=new Dl.ARRAY_TYPE(4);return l[0]=t,l[1]=e,l[2]=r,l[3]=s,l},Kn.set=function(t,e,r,s,l){return t[0]=e,t[1]=r,t[2]=s,t[3]=l,t},Kn.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Kn.invert=function(t,e){var r=e[0],s=e[1],l=e[2],u=e[3],f=r*u-l*s;return f?(t[0]=u*(f=1/f),t[1]=-s*f,t[2]=-l*f,t[3]=r*f,t):null},Kn.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},Kn.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Kn.multiply=j1,Kn.rotate=function(t,e,r){var s=e[0],l=e[1],u=e[2],f=e[3],_=Math.sin(r),v=Math.cos(r);return t[0]=s*v+u*_,t[1]=l*v+f*_,t[2]=s*-_+u*v,t[3]=l*-_+f*v,t},Kn.scale=function(t,e,r){var s=e[1],l=e[2],u=e[3],f=r[0],_=r[1];return t[0]=e[0]*f,t[1]=s*f,t[2]=l*_,t[3]=u*_,t},Kn.fromRotation=function(t,e){var r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=r,t[2]=-r,t[3]=s,t},Kn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Kn.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Kn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Kn.LDU=function(t,e,r,s){return t[2]=s[2]/s[0],r[0]=s[0],r[1]=s[1],r[3]=s[3]-t[2]*r[1],[t,e,r]},Kn.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},Kn.subtract=G1,Kn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Kn.equals=function(t,e){var r=t[0],s=t[1],l=t[2],u=t[3],f=e[0],_=e[1],v=e[2],x=e[3];return Math.abs(r-f)<=Dl.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-_)<=Dl.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(l-v)<=Dl.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(u-x)<=Dl.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))},Kn.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},Kn.multiplyScalarAndAdd=function(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t[3]=e[3]+r[3]*s,t},Kn.sub=Kn.mul=void 0;var Dl=function(t,e){if(t&&t.__esModule)return t;if(t===null||sv(t)!=="object"&&typeof t!="function")return{default:t};var r=U1(void 0);if(r&&r.has(t))return r.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=l?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(s,u,f):s[u]=t[u]}return s.default=t,r&&r.set(t,s),s}(Di);function U1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(U1=function(s){return s?r:e})(t)}function j1(t,e,r){var s=e[0],l=e[1],u=e[2],f=e[3],_=r[0],v=r[1],x=r[2],w=r[3];return t[0]=s*_+u*v,t[1]=l*_+f*v,t[2]=s*x+u*w,t[3]=l*x+f*w,t}function G1(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}Kn.mul=j1,Kn.sub=G1;var ei={};function ov(t){return ov=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ov(t)}Object.defineProperty(ei,"__esModule",{value:!0}),ei.create=function(){var t=new ia.ARRAY_TYPE(6);return ia.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},ei.clone=function(t){var e=new ia.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},ei.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},ei.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},ei.fromValues=function(t,e,r,s,l,u){var f=new ia.ARRAY_TYPE(6);return f[0]=t,f[1]=e,f[2]=r,f[3]=s,f[4]=l,f[5]=u,f},ei.set=function(t,e,r,s,l,u,f){return t[0]=e,t[1]=r,t[2]=s,t[3]=l,t[4]=u,t[5]=f,t},ei.invert=function(t,e){var r=e[0],s=e[1],l=e[2],u=e[3],f=e[4],_=e[5],v=r*u-s*l;return v?(t[0]=u*(v=1/v),t[1]=-s*v,t[2]=-l*v,t[3]=r*v,t[4]=(l*_-u*f)*v,t[5]=(s*f-r*_)*v,t):null},ei.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},ei.multiply=q1,ei.rotate=function(t,e,r){var s=e[0],l=e[1],u=e[2],f=e[3],_=e[4],v=e[5],x=Math.sin(r),w=Math.cos(r);return t[0]=s*w+u*x,t[1]=l*w+f*x,t[2]=s*-x+u*w,t[3]=l*-x+f*w,t[4]=_,t[5]=v,t},ei.scale=function(t,e,r){var s=e[1],l=e[2],u=e[3],f=e[4],_=e[5],v=r[0],x=r[1];return t[0]=e[0]*v,t[1]=s*v,t[2]=l*x,t[3]=u*x,t[4]=f,t[5]=_,t},ei.translate=function(t,e,r){var s=e[0],l=e[1],u=e[2],f=e[3],_=e[4],v=e[5],x=r[0],w=r[1];return t[0]=s,t[1]=l,t[2]=u,t[3]=f,t[4]=s*x+u*w+_,t[5]=l*x+f*w+v,t},ei.fromRotation=function(t,e){var r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=r,t[2]=-r,t[3]=s,t[4]=0,t[5]=0,t},ei.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},ei.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},ei.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},ei.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},ei.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},ei.subtract=W1,ei.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},ei.multiplyScalarAndAdd=function(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t[3]=e[3]+r[3]*s,t[4]=e[4]+r[4]*s,t[5]=e[5]+r[5]*s,t},ei.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},ei.equals=function(t,e){var r=t[0],s=t[1],l=t[2],u=t[3],f=t[4],_=t[5],v=e[0],x=e[1],w=e[2],E=e[3],I=e[4],L=e[5];return Math.abs(r-v)<=ia.EPSILON*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(s-x)<=ia.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(l-w)<=ia.EPSILON*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(u-E)<=ia.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(f-I)<=ia.EPSILON*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(_-L)<=ia.EPSILON*Math.max(1,Math.abs(_),Math.abs(L))},ei.sub=ei.mul=void 0;var ia=function(t,e){if(t&&t.__esModule)return t;if(t===null||ov(t)!=="object"&&typeof t!="function")return{default:t};var r=H1(void 0);if(r&&r.has(t))return r.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=l?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(s,u,f):s[u]=t[u]}return s.default=t,r&&r.set(t,s),s}(Di);function H1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(H1=function(s){return s?r:e})(t)}function q1(t,e,r){var s=e[0],l=e[1],u=e[2],f=e[3],_=e[4],v=e[5],x=r[0],w=r[1],E=r[2],I=r[3],L=r[4],O=r[5];return t[0]=s*x+u*w,t[1]=l*x+f*w,t[2]=s*E+u*I,t[3]=l*E+f*I,t[4]=s*L+u*O+_,t[5]=l*L+f*O+v,t}function W1(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}ei.mul=q1,ei.sub=W1;var Cn={};function av(t){return av=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},av(t)}Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.create=function(){var t=new js.ARRAY_TYPE(9);return js.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Cn.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Cn.clone=function(t){var e=new js.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Cn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Cn.fromValues=function(t,e,r,s,l,u,f,_,v){var x=new js.ARRAY_TYPE(9);return x[0]=t,x[1]=e,x[2]=r,x[3]=s,x[4]=l,x[5]=u,x[6]=f,x[7]=_,x[8]=v,x},Cn.set=function(t,e,r,s,l,u,f,_,v,x){return t[0]=e,t[1]=r,t[2]=s,t[3]=l,t[4]=u,t[5]=f,t[6]=_,t[7]=v,t[8]=x,t},Cn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Cn.transpose=function(t,e){if(t===e){var r=e[1],s=e[2],l=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=s,t[7]=l}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Cn.invert=function(t,e){var r=e[0],s=e[1],l=e[2],u=e[3],f=e[4],_=e[5],v=e[6],x=e[7],w=e[8],E=w*f-_*x,I=-w*u+_*v,L=x*u-f*v,O=r*E+s*I+l*L;return O?(t[0]=E*(O=1/O),t[1]=(-w*s+l*x)*O,t[2]=(_*s-l*f)*O,t[3]=I*O,t[4]=(w*r-l*v)*O,t[5]=(-_*r+l*u)*O,t[6]=L*O,t[7]=(-x*r+s*v)*O,t[8]=(f*r-s*u)*O,t):null},Cn.adjoint=function(t,e){var r=e[0],s=e[1],l=e[2],u=e[3],f=e[4],_=e[5],v=e[6],x=e[7],w=e[8];return t[0]=f*w-_*x,t[1]=l*x-s*w,t[2]=s*_-l*f,t[3]=_*v-u*w,t[4]=r*w-l*v,t[5]=l*u-r*_,t[6]=u*x-f*v,t[7]=s*v-r*x,t[8]=r*f-s*u,t},Cn.determinant=function(t){var e=t[3],r=t[4],s=t[5],l=t[6],u=t[7],f=t[8];return t[0]*(f*r-s*u)+t[1]*(-f*e+s*l)+t[2]*(u*e-r*l)},Cn.multiply=Z1,Cn.translate=function(t,e,r){var s=e[0],l=e[1],u=e[2],f=e[3],_=e[4],v=e[5],x=e[6],w=e[7],E=e[8],I=r[0],L=r[1];return t[0]=s,t[1]=l,t[2]=u,t[3]=f,t[4]=_,t[5]=v,t[6]=I*s+L*f+x,t[7]=I*l+L*_+w,t[8]=I*u+L*v+E,t},Cn.rotate=function(t,e,r){var s=e[0],l=e[1],u=e[2],f=e[3],_=e[4],v=e[5],x=e[6],w=e[7],E=e[8],I=Math.sin(r),L=Math.cos(r);return t[0]=L*s+I*f,t[1]=L*l+I*_,t[2]=L*u+I*v,t[3]=L*f-I*s,t[4]=L*_-I*l,t[5]=L*v-I*u,t[6]=x,t[7]=w,t[8]=E,t},Cn.scale=function(t,e,r){var s=r[0],l=r[1];return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=l*e[3],t[4]=l*e[4],t[5]=l*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Cn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Cn.fromRotation=function(t,e){var r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=r,t[2]=0,t[3]=-r,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Cn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Cn.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Cn.fromQuat=function(t,e){var r=e[0],s=e[1],l=e[2],u=e[3],f=r+r,_=s+s,v=l+l,x=r*f,w=s*f,E=s*_,I=l*f,L=l*_,O=l*v,z=u*f,V=u*_,j=u*v;return t[0]=1-E-O,t[3]=w-j,t[6]=I+V,t[1]=w+j,t[4]=1-x-O,t[7]=L-z,t[2]=I-V,t[5]=L+z,t[8]=1-x-E,t},Cn.normalFromMat4=function(t,e){var r=e[0],s=e[1],l=e[2],u=e[3],f=e[4],_=e[5],v=e[6],x=e[7],w=e[8],E=e[9],I=e[10],L=e[11],O=e[12],z=e[13],V=e[14],j=e[15],K=r*_-s*f,ee=r*v-l*f,Q=r*x-u*f,le=s*v-l*_,ae=s*x-u*_,fe=l*x-u*v,ve=w*z-E*O,we=w*V-I*O,Le=w*j-L*O,Te=E*V-I*z,je=E*j-L*z,Ke=I*j-L*V,Be=K*Ke-ee*je+Q*Te+le*Le-ae*we+fe*ve;return Be?(t[0]=(_*Ke-v*je+x*Te)*(Be=1/Be),t[1]=(v*Le-f*Ke-x*we)*Be,t[2]=(f*je-_*Le+x*ve)*Be,t[3]=(l*je-s*Ke-u*Te)*Be,t[4]=(r*Ke-l*Le+u*we)*Be,t[5]=(s*Le-r*je-u*ve)*Be,t[6]=(z*fe-V*ae+j*le)*Be,t[7]=(V*Q-O*fe-j*ee)*Be,t[8]=(O*ae-z*Q+j*K)*Be,t):null},Cn.projection=function(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Cn.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Cn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Cn.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},Cn.subtract=X1,Cn.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},Cn.multiplyScalarAndAdd=function(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t[3]=e[3]+r[3]*s,t[4]=e[4]+r[4]*s,t[5]=e[5]+r[5]*s,t[6]=e[6]+r[6]*s,t[7]=e[7]+r[7]*s,t[8]=e[8]+r[8]*s,t},Cn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Cn.equals=function(t,e){var r=t[0],s=t[1],l=t[2],u=t[3],f=t[4],_=t[5],v=t[6],x=t[7],w=t[8],E=e[0],I=e[1],L=e[2],O=e[3],z=e[4],V=e[5],j=e[6],K=e[7],ee=e[8];return Math.abs(r-E)<=js.EPSILON*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(s-I)<=js.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(l-L)<=js.EPSILON*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(u-O)<=js.EPSILON*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(f-z)<=js.EPSILON*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(_-V)<=js.EPSILON*Math.max(1,Math.abs(_),Math.abs(V))&&Math.abs(v-j)<=js.EPSILON*Math.max(1,Math.abs(v),Math.abs(j))&&Math.abs(x-K)<=js.EPSILON*Math.max(1,Math.abs(x),Math.abs(K))&&Math.abs(w-ee)<=js.EPSILON*Math.max(1,Math.abs(w),Math.abs(ee))},Cn.sub=Cn.mul=void 0;var js=function(t,e){if(t&&t.__esModule)return t;if(t===null||av(t)!=="object"&&typeof t!="function")return{default:t};var r=Y1(void 0);if(r&&r.has(t))return r.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=l?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(s,u,f):s[u]=t[u]}return s.default=t,r&&r.set(t,s),s}(Di);function Y1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Y1=function(s){return s?r:e})(t)}function Z1(t,e,r){var s=e[0],l=e[1],u=e[2],f=e[3],_=e[4],v=e[5],x=e[6],w=e[7],E=e[8],I=r[0],L=r[1],O=r[2],z=r[3],V=r[4],j=r[5],K=r[6],ee=r[7],Q=r[8];return t[0]=I*s+L*f+O*x,t[1]=I*l+L*_+O*w,t[2]=I*u+L*v+O*E,t[3]=z*s+V*f+j*x,t[4]=z*l+V*_+j*w,t[5]=z*u+V*v+j*E,t[6]=K*s+ee*f+Q*x,t[7]=K*l+ee*_+Q*w,t[8]=K*u+ee*v+Q*E,t}function X1(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}Cn.mul=Z1,Cn.sub=X1;var Fr={};function lv(t){return lv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lv(t)}Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.create=function(){var t=new ai.ARRAY_TYPE(16);return ai.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Fr.clone=function(t){var e=new ai.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Fr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Fr.fromValues=function(t,e,r,s,l,u,f,_,v,x,w,E,I,L,O,z){var V=new ai.ARRAY_TYPE(16);return V[0]=t,V[1]=e,V[2]=r,V[3]=s,V[4]=l,V[5]=u,V[6]=f,V[7]=_,V[8]=v,V[9]=x,V[10]=w,V[11]=E,V[12]=I,V[13]=L,V[14]=O,V[15]=z,V},Fr.set=function(t,e,r,s,l,u,f,_,v,x,w,E,I,L,O,z,V){return t[0]=e,t[1]=r,t[2]=s,t[3]=l,t[4]=u,t[5]=f,t[6]=_,t[7]=v,t[8]=x,t[9]=w,t[10]=E,t[11]=I,t[12]=L,t[13]=O,t[14]=z,t[15]=V,t},Fr.identity=J1,Fr.transpose=function(t,e){if(t===e){var r=e[1],s=e[2],l=e[3],u=e[6],f=e[7],_=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=s,t[9]=u,t[11]=e[14],t[12]=l,t[13]=f,t[14]=_}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Fr.invert=function(t,e){var r=e[0],s=e[1],l=e[2],u=e[3],f=e[4],_=e[5],v=e[6],x=e[7],w=e[8],E=e[9],I=e[10],L=e[11],O=e[12],z=e[13],V=e[14],j=e[15],K=r*_-s*f,ee=r*v-l*f,Q=r*x-u*f,le=s*v-l*_,ae=s*x-u*_,fe=l*x-u*v,ve=w*z-E*O,we=w*V-I*O,Le=w*j-L*O,Te=E*V-I*z,je=E*j-L*z,Ke=I*j-L*V,Be=K*Ke-ee*je+Q*Te+le*Le-ae*we+fe*ve;return Be?(t[0]=(_*Ke-v*je+x*Te)*(Be=1/Be),t[1]=(l*je-s*Ke-u*Te)*Be,t[2]=(z*fe-V*ae+j*le)*Be,t[3]=(I*ae-E*fe-L*le)*Be,t[4]=(v*Le-f*Ke-x*we)*Be,t[5]=(r*Ke-l*Le+u*we)*Be,t[6]=(V*Q-O*fe-j*ee)*Be,t[7]=(w*fe-I*Q+L*ee)*Be,t[8]=(f*je-_*Le+x*ve)*Be,t[9]=(s*Le-r*je-u*ve)*Be,t[10]=(O*ae-z*Q+j*K)*Be,t[11]=(E*Q-w*ae-L*K)*Be,t[12]=(_*we-f*Te-v*ve)*Be,t[13]=(r*Te-s*we+l*ve)*Be,t[14]=(z*ee-O*le-V*K)*Be,t[15]=(w*le-E*ee+I*K)*Be,t):null},Fr.adjoint=function(t,e){var r=e[0],s=e[1],l=e[2],u=e[3],f=e[4],_=e[5],v=e[6],x=e[7],w=e[8],E=e[9],I=e[10],L=e[11],O=e[12],z=e[13],V=e[14],j=e[15];return t[0]=_*(I*j-L*V)-E*(v*j-x*V)+z*(v*L-x*I),t[1]=-(s*(I*j-L*V)-E*(l*j-u*V)+z*(l*L-u*I)),t[2]=s*(v*j-x*V)-_*(l*j-u*V)+z*(l*x-u*v),t[3]=-(s*(v*L-x*I)-_*(l*L-u*I)+E*(l*x-u*v)),t[4]=-(f*(I*j-L*V)-w*(v*j-x*V)+O*(v*L-x*I)),t[5]=r*(I*j-L*V)-w*(l*j-u*V)+O*(l*L-u*I),t[6]=-(r*(v*j-x*V)-f*(l*j-u*V)+O*(l*x-u*v)),t[7]=r*(v*L-x*I)-f*(l*L-u*I)+w*(l*x-u*v),t[8]=f*(E*j-L*z)-w*(_*j-x*z)+O*(_*L-x*E),t[9]=-(r*(E*j-L*z)-w*(s*j-u*z)+O*(s*L-u*E)),t[10]=r*(_*j-x*z)-f*(s*j-u*z)+O*(s*x-u*_),t[11]=-(r*(_*L-x*E)-f*(s*L-u*E)+w*(s*x-u*_)),t[12]=-(f*(E*V-I*z)-w*(_*V-v*z)+O*(_*I-v*E)),t[13]=r*(E*V-I*z)-w*(s*V-l*z)+O*(s*I-l*E),t[14]=-(r*(_*V-v*z)-f*(s*V-l*z)+O*(s*v-l*_)),t[15]=r*(_*I-v*E)-f*(s*I-l*E)+w*(s*v-l*_),t},Fr.determinant=function(t){var e=t[0],r=t[1],s=t[2],l=t[3],u=t[4],f=t[5],_=t[6],v=t[7],x=t[8],w=t[9],E=t[10],I=t[11],L=t[12],O=t[13],z=t[14],V=t[15];return(e*f-r*u)*(E*V-I*z)-(e*_-s*u)*(w*V-I*O)+(e*v-l*u)*(w*z-E*O)+(r*_-s*f)*(x*V-I*L)-(r*v-l*f)*(x*z-E*L)+(s*v-l*_)*(x*O-w*L)},Fr.multiply=Q1,Fr.translate=function(t,e,r){var s,l,u,f,_,v,x,w,E,I,L,O,z=r[0],V=r[1],j=r[2];return e===t?(t[12]=e[0]*z+e[4]*V+e[8]*j+e[12],t[13]=e[1]*z+e[5]*V+e[9]*j+e[13],t[14]=e[2]*z+e[6]*V+e[10]*j+e[14],t[15]=e[3]*z+e[7]*V+e[11]*j+e[15]):(l=e[1],u=e[2],f=e[3],_=e[4],v=e[5],x=e[6],w=e[7],E=e[8],I=e[9],L=e[10],O=e[11],t[0]=s=e[0],t[1]=l,t[2]=u,t[3]=f,t[4]=_,t[5]=v,t[6]=x,t[7]=w,t[8]=E,t[9]=I,t[10]=L,t[11]=O,t[12]=s*z+_*V+E*j+e[12],t[13]=l*z+v*V+I*j+e[13],t[14]=u*z+x*V+L*j+e[14],t[15]=f*z+w*V+O*j+e[15]),t},Fr.scale=function(t,e,r){var s=r[0],l=r[1],u=r[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*l,t[5]=e[5]*l,t[6]=e[6]*l,t[7]=e[7]*l,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Fr.rotate=function(t,e,r,s){var l,u,f,_,v,x,w,E,I,L,O,z,V,j,K,ee,Q,le,ae,fe,ve,we,Le,Te,je=s[0],Ke=s[1],Be=s[2],Xe=Math.hypot(je,Ke,Be);return Xe<ai.EPSILON?null:(je*=Xe=1/Xe,Ke*=Xe,Be*=Xe,l=Math.sin(r),u=Math.cos(r),v=e[1],x=e[2],w=e[3],I=e[5],L=e[6],O=e[7],V=e[9],j=e[10],K=e[11],ee=je*je*(f=1-u)+u,ae=je*Ke*f-Be*l,fe=Ke*Ke*f+u,ve=Be*Ke*f+je*l,we=je*Be*f+Ke*l,Le=Ke*Be*f-je*l,Te=Be*Be*f+u,t[0]=(_=e[0])*ee+(E=e[4])*(Q=Ke*je*f+Be*l)+(z=e[8])*(le=Be*je*f-Ke*l),t[1]=v*ee+I*Q+V*le,t[2]=x*ee+L*Q+j*le,t[3]=w*ee+O*Q+K*le,t[4]=_*ae+E*fe+z*ve,t[5]=v*ae+I*fe+V*ve,t[6]=x*ae+L*fe+j*ve,t[7]=w*ae+O*fe+K*ve,t[8]=_*we+E*Le+z*Te,t[9]=v*we+I*Le+V*Te,t[10]=x*we+L*Le+j*Te,t[11]=w*we+O*Le+K*Te,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Fr.rotateX=function(t,e,r){var s=Math.sin(r),l=Math.cos(r),u=e[4],f=e[5],_=e[6],v=e[7],x=e[8],w=e[9],E=e[10],I=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*l+x*s,t[5]=f*l+w*s,t[6]=_*l+E*s,t[7]=v*l+I*s,t[8]=x*l-u*s,t[9]=w*l-f*s,t[10]=E*l-_*s,t[11]=I*l-v*s,t},Fr.rotateY=function(t,e,r){var s=Math.sin(r),l=Math.cos(r),u=e[0],f=e[1],_=e[2],v=e[3],x=e[8],w=e[9],E=e[10],I=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*l-x*s,t[1]=f*l-w*s,t[2]=_*l-E*s,t[3]=v*l-I*s,t[8]=u*s+x*l,t[9]=f*s+w*l,t[10]=_*s+E*l,t[11]=v*s+I*l,t},Fr.rotateZ=function(t,e,r){var s=Math.sin(r),l=Math.cos(r),u=e[0],f=e[1],_=e[2],v=e[3],x=e[4],w=e[5],E=e[6],I=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*l+x*s,t[1]=f*l+w*s,t[2]=_*l+E*s,t[3]=v*l+I*s,t[4]=x*l-u*s,t[5]=w*l-f*s,t[6]=E*l-_*s,t[7]=I*l-v*s,t},Fr.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Fr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Fr.fromRotation=function(t,e,r){var s,l,u,f=r[0],_=r[1],v=r[2],x=Math.hypot(f,_,v);return x<ai.EPSILON?null:(f*=x=1/x,_*=x,v*=x,s=Math.sin(e),l=Math.cos(e),t[0]=f*f*(u=1-l)+l,t[1]=_*f*u+v*s,t[2]=v*f*u-_*s,t[3]=0,t[4]=f*_*u-v*s,t[5]=_*_*u+l,t[6]=v*_*u+f*s,t[7]=0,t[8]=f*v*u+_*s,t[9]=_*v*u-f*s,t[10]=v*v*u+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Fr.fromXRotation=function(t,e){var r=Math.sin(e),s=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Fr.fromYRotation=function(t,e){var r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Fr.fromZRotation=function(t,e){var r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Fr.fromRotationTranslation=eb,Fr.fromQuat2=function(t,e){var r=new ai.ARRAY_TYPE(3),s=-e[0],l=-e[1],u=-e[2],f=e[3],_=e[4],v=e[5],x=e[6],w=e[7],E=s*s+l*l+u*u+f*f;return E>0?(r[0]=2*(_*f+w*s+v*u-x*l)/E,r[1]=2*(v*f+w*l+x*s-_*u)/E,r[2]=2*(x*f+w*u+_*l-v*s)/E):(r[0]=2*(_*f+w*s+v*u-x*l),r[1]=2*(v*f+w*l+x*s-_*u),r[2]=2*(x*f+w*u+_*l-v*s)),eb(t,e,r),t},Fr.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Fr.getScaling=tb,Fr.getRotation=function(t,e){var r=new ai.ARRAY_TYPE(3);tb(r,e);var s=1/r[0],l=1/r[1],u=1/r[2],f=e[0]*s,_=e[1]*l,v=e[2]*u,x=e[4]*s,w=e[5]*l,E=e[6]*u,I=e[8]*s,L=e[9]*l,O=e[10]*u,z=f+w+O,V=0;return z>0?(V=2*Math.sqrt(z+1),t[3]=.25*V,t[0]=(E-L)/V,t[1]=(I-v)/V,t[2]=(_-x)/V):f>w&&f>O?(V=2*Math.sqrt(1+f-w-O),t[3]=(E-L)/V,t[0]=.25*V,t[1]=(_+x)/V,t[2]=(I+v)/V):w>O?(V=2*Math.sqrt(1+w-f-O),t[3]=(I-v)/V,t[0]=(_+x)/V,t[1]=.25*V,t[2]=(E+L)/V):(V=2*Math.sqrt(1+O-f-w),t[3]=(_-x)/V,t[0]=(I+v)/V,t[1]=(E+L)/V,t[2]=.25*V),t},Fr.fromRotationTranslationScale=function(t,e,r,s){var l=e[0],u=e[1],f=e[2],_=e[3],v=l+l,x=u+u,w=f+f,E=l*v,I=l*x,L=l*w,O=u*x,z=u*w,V=f*w,j=_*v,K=_*x,ee=_*w,Q=s[0],le=s[1],ae=s[2];return t[0]=(1-(O+V))*Q,t[1]=(I+ee)*Q,t[2]=(L-K)*Q,t[3]=0,t[4]=(I-ee)*le,t[5]=(1-(E+V))*le,t[6]=(z+j)*le,t[7]=0,t[8]=(L+K)*ae,t[9]=(z-j)*ae,t[10]=(1-(E+O))*ae,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},Fr.fromRotationTranslationScaleOrigin=function(t,e,r,s,l){var u=e[0],f=e[1],_=e[2],v=e[3],x=u+u,w=f+f,E=_+_,I=u*x,L=u*w,O=u*E,z=f*w,V=f*E,j=_*E,K=v*x,ee=v*w,Q=v*E,le=s[0],ae=s[1],fe=s[2],ve=l[0],we=l[1],Le=l[2],Te=(1-(z+j))*le,je=(L+Q)*le,Ke=(O-ee)*le,Be=(L-Q)*ae,Xe=(1-(I+j))*ae,ze=(V+K)*ae,Ze=(O+ee)*fe,St=(V-K)*fe,et=(1-(I+z))*fe;return t[0]=Te,t[1]=je,t[2]=Ke,t[3]=0,t[4]=Be,t[5]=Xe,t[6]=ze,t[7]=0,t[8]=Ze,t[9]=St,t[10]=et,t[11]=0,t[12]=r[0]+ve-(Te*ve+Be*we+Ze*Le),t[13]=r[1]+we-(je*ve+Xe*we+St*Le),t[14]=r[2]+Le-(Ke*ve+ze*we+et*Le),t[15]=1,t},Fr.fromQuat=function(t,e){var r=e[0],s=e[1],l=e[2],u=e[3],f=r+r,_=s+s,v=l+l,x=r*f,w=s*f,E=s*_,I=l*f,L=l*_,O=l*v,z=u*f,V=u*_,j=u*v;return t[0]=1-E-O,t[1]=w+j,t[2]=I-V,t[3]=0,t[4]=w-j,t[5]=1-x-O,t[6]=L+z,t[7]=0,t[8]=I+V,t[9]=L-z,t[10]=1-x-E,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Fr.frustum=function(t,e,r,s,l,u,f){var _=1/(r-e),v=1/(l-s),x=1/(u-f);return t[0]=2*u*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*u*v,t[6]=0,t[7]=0,t[8]=(r+e)*_,t[9]=(l+s)*v,t[10]=(f+u)*x,t[11]=-1,t[12]=0,t[13]=0,t[14]=f*u*2*x,t[15]=0,t},Fr.perspectiveNO=rb,Fr.perspectiveZO=function(t,e,r,s,l){var u,f=1/Math.tan(e/2);return t[0]=f/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=l*(u=1/(s-l)),t[14]=l*s*u):(t[10]=-1,t[14]=-s),t},Fr.perspectiveFromFieldOfView=function(t,e,r,s){var l=Math.tan(e.upDegrees*Math.PI/180),u=Math.tan(e.downDegrees*Math.PI/180),f=Math.tan(e.leftDegrees*Math.PI/180),_=Math.tan(e.rightDegrees*Math.PI/180),v=2/(f+_),x=2/(l+u);return t[0]=v,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=x,t[6]=0,t[7]=0,t[8]=-(f-_)*v*.5,t[9]=(l-u)*x*.5,t[10]=s/(r-s),t[11]=-1,t[12]=0,t[13]=0,t[14]=s*r/(r-s),t[15]=0,t},Fr.orthoNO=nb,Fr.orthoZO=function(t,e,r,s,l,u,f){var _=1/(e-r),v=1/(s-l),x=1/(u-f);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*v,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=x,t[11]=0,t[12]=(e+r)*_,t[13]=(l+s)*v,t[14]=u*x,t[15]=1,t},Fr.lookAt=function(t,e,r,s){var l,u,f,_,v,x,w,E,I,L,O=e[0],z=e[1],V=e[2],j=s[0],K=s[1],ee=s[2],Q=r[0],le=r[1],ae=r[2];return Math.abs(O-Q)<ai.EPSILON&&Math.abs(z-le)<ai.EPSILON&&Math.abs(V-ae)<ai.EPSILON?J1(t):(w=O-Q,E=z-le,I=V-ae,l=K*(I*=L=1/Math.hypot(w,E,I))-ee*(E*=L),u=ee*(w*=L)-j*I,f=j*E-K*w,(L=Math.hypot(l,u,f))?(l*=L=1/L,u*=L,f*=L):(l=0,u=0,f=0),_=E*f-I*u,v=I*l-w*f,x=w*u-E*l,(L=Math.hypot(_,v,x))?(_*=L=1/L,v*=L,x*=L):(_=0,v=0,x=0),t[0]=l,t[1]=_,t[2]=w,t[3]=0,t[4]=u,t[5]=v,t[6]=E,t[7]=0,t[8]=f,t[9]=x,t[10]=I,t[11]=0,t[12]=-(l*O+u*z+f*V),t[13]=-(_*O+v*z+x*V),t[14]=-(w*O+E*z+I*V),t[15]=1,t)},Fr.targetTo=function(t,e,r,s){var l=e[0],u=e[1],f=e[2],_=s[0],v=s[1],x=s[2],w=l-r[0],E=u-r[1],I=f-r[2],L=w*w+E*E+I*I;L>0&&(w*=L=1/Math.sqrt(L),E*=L,I*=L);var O=v*I-x*E,z=x*w-_*I,V=_*E-v*w;return(L=O*O+z*z+V*V)>0&&(O*=L=1/Math.sqrt(L),z*=L,V*=L),t[0]=O,t[1]=z,t[2]=V,t[3]=0,t[4]=E*V-I*z,t[5]=I*O-w*V,t[6]=w*z-E*O,t[7]=0,t[8]=w,t[9]=E,t[10]=I,t[11]=0,t[12]=l,t[13]=u,t[14]=f,t[15]=1,t},Fr.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Fr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Fr.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},Fr.subtract=ib,Fr.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},Fr.multiplyScalarAndAdd=function(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t[3]=e[3]+r[3]*s,t[4]=e[4]+r[4]*s,t[5]=e[5]+r[5]*s,t[6]=e[6]+r[6]*s,t[7]=e[7]+r[7]*s,t[8]=e[8]+r[8]*s,t[9]=e[9]+r[9]*s,t[10]=e[10]+r[10]*s,t[11]=e[11]+r[11]*s,t[12]=e[12]+r[12]*s,t[13]=e[13]+r[13]*s,t[14]=e[14]+r[14]*s,t[15]=e[15]+r[15]*s,t},Fr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Fr.equals=function(t,e){var r=t[0],s=t[1],l=t[2],u=t[3],f=t[4],_=t[5],v=t[6],x=t[7],w=t[8],E=t[9],I=t[10],L=t[11],O=t[12],z=t[13],V=t[14],j=t[15],K=e[0],ee=e[1],Q=e[2],le=e[3],ae=e[4],fe=e[5],ve=e[6],we=e[7],Le=e[8],Te=e[9],je=e[10],Ke=e[11],Be=e[12],Xe=e[13],ze=e[14],Ze=e[15];return Math.abs(r-K)<=ai.EPSILON*Math.max(1,Math.abs(r),Math.abs(K))&&Math.abs(s-ee)<=ai.EPSILON*Math.max(1,Math.abs(s),Math.abs(ee))&&Math.abs(l-Q)<=ai.EPSILON*Math.max(1,Math.abs(l),Math.abs(Q))&&Math.abs(u-le)<=ai.EPSILON*Math.max(1,Math.abs(u),Math.abs(le))&&Math.abs(f-ae)<=ai.EPSILON*Math.max(1,Math.abs(f),Math.abs(ae))&&Math.abs(_-fe)<=ai.EPSILON*Math.max(1,Math.abs(_),Math.abs(fe))&&Math.abs(v-ve)<=ai.EPSILON*Math.max(1,Math.abs(v),Math.abs(ve))&&Math.abs(x-we)<=ai.EPSILON*Math.max(1,Math.abs(x),Math.abs(we))&&Math.abs(w-Le)<=ai.EPSILON*Math.max(1,Math.abs(w),Math.abs(Le))&&Math.abs(E-Te)<=ai.EPSILON*Math.max(1,Math.abs(E),Math.abs(Te))&&Math.abs(I-je)<=ai.EPSILON*Math.max(1,Math.abs(I),Math.abs(je))&&Math.abs(L-Ke)<=ai.EPSILON*Math.max(1,Math.abs(L),Math.abs(Ke))&&Math.abs(O-Be)<=ai.EPSILON*Math.max(1,Math.abs(O),Math.abs(Be))&&Math.abs(z-Xe)<=ai.EPSILON*Math.max(1,Math.abs(z),Math.abs(Xe))&&Math.abs(V-ze)<=ai.EPSILON*Math.max(1,Math.abs(V),Math.abs(ze))&&Math.abs(j-Ze)<=ai.EPSILON*Math.max(1,Math.abs(j),Math.abs(Ze))},Fr.sub=Fr.mul=Fr.ortho=Fr.perspective=void 0;var ai=function(t,e){if(t&&t.__esModule)return t;if(t===null||lv(t)!=="object"&&typeof t!="function")return{default:t};var r=K1(void 0);if(r&&r.has(t))return r.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=l?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(s,u,f):s[u]=t[u]}return s.default=t,r&&r.set(t,s),s}(Di);function K1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(K1=function(s){return s?r:e})(t)}function J1(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Q1(t,e,r){var s=e[0],l=e[1],u=e[2],f=e[3],_=e[4],v=e[5],x=e[6],w=e[7],E=e[8],I=e[9],L=e[10],O=e[11],z=e[12],V=e[13],j=e[14],K=e[15],ee=r[0],Q=r[1],le=r[2],ae=r[3];return t[0]=ee*s+Q*_+le*E+ae*z,t[1]=ee*l+Q*v+le*I+ae*V,t[2]=ee*u+Q*x+le*L+ae*j,t[3]=ee*f+Q*w+le*O+ae*K,t[4]=(ee=r[4])*s+(Q=r[5])*_+(le=r[6])*E+(ae=r[7])*z,t[5]=ee*l+Q*v+le*I+ae*V,t[6]=ee*u+Q*x+le*L+ae*j,t[7]=ee*f+Q*w+le*O+ae*K,t[8]=(ee=r[8])*s+(Q=r[9])*_+(le=r[10])*E+(ae=r[11])*z,t[9]=ee*l+Q*v+le*I+ae*V,t[10]=ee*u+Q*x+le*L+ae*j,t[11]=ee*f+Q*w+le*O+ae*K,t[12]=(ee=r[12])*s+(Q=r[13])*_+(le=r[14])*E+(ae=r[15])*z,t[13]=ee*l+Q*v+le*I+ae*V,t[14]=ee*u+Q*x+le*L+ae*j,t[15]=ee*f+Q*w+le*O+ae*K,t}function eb(t,e,r){var s=e[0],l=e[1],u=e[2],f=e[3],_=s+s,v=l+l,x=u+u,w=s*_,E=s*v,I=s*x,L=l*v,O=l*x,z=u*x,V=f*_,j=f*v,K=f*x;return t[0]=1-(L+z),t[1]=E+K,t[2]=I-j,t[3]=0,t[4]=E-K,t[5]=1-(w+z),t[6]=O+V,t[7]=0,t[8]=I+j,t[9]=O-V,t[10]=1-(w+L),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function tb(t,e){var r=e[4],s=e[5],l=e[6],u=e[8],f=e[9],_=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(r,s,l),t[2]=Math.hypot(u,f,_),t}function rb(t,e,r,s,l){var u,f=1/Math.tan(e/2);return t[0]=f/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=(l+s)*(u=1/(s-l)),t[14]=2*l*s*u):(t[10]=-1,t[14]=-2*s),t}function nb(t,e,r,s,l,u,f){var _=1/(e-r),v=1/(s-l),x=1/(u-f);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*v,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*x,t[11]=0,t[12]=(e+r)*_,t[13]=(l+s)*v,t[14]=(f+u)*x,t[15]=1,t}function ib(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}Fr.perspective=rb,Fr.ortho=nb,Fr.mul=Q1,Fr.sub=ib;var Dr={},Or={};function cv(t){return cv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cv(t)}Object.defineProperty(Or,"__esModule",{value:!0}),Or.create=ob,Or.clone=function(t){var e=new Ba.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Or.length=ab,Or.fromValues=function(t,e,r){var s=new Ba.ARRAY_TYPE(3);return s[0]=t,s[1]=e,s[2]=r,s},Or.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Or.set=function(t,e,r,s){return t[0]=e,t[1]=r,t[2]=s,t},Or.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},Or.subtract=lb,Or.multiply=cb,Or.divide=ub,Or.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Or.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Or.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},Or.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},Or.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Or.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},Or.scaleAndAdd=function(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t},Or.distance=hb,Or.squaredDistance=db,Or.squaredLength=fb,Or.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Or.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Or.normalize=function(t,e){var r=e[0],s=e[1],l=e[2],u=r*r+s*s+l*l;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t},Or.dot=pb,Or.cross=function(t,e,r){var s=e[0],l=e[1],u=e[2],f=r[0],_=r[1],v=r[2];return t[0]=l*v-u*_,t[1]=u*f-s*v,t[2]=s*_-l*f,t},Or.lerp=function(t,e,r,s){var l=e[0],u=e[1],f=e[2];return t[0]=l+s*(r[0]-l),t[1]=u+s*(r[1]-u),t[2]=f+s*(r[2]-f),t},Or.hermite=function(t,e,r,s,l,u){var f=u*u,_=f*(2*u-3)+1,v=f*(u-2)+u,x=f*(u-1),w=f*(3-2*u);return t[0]=e[0]*_+r[0]*v+s[0]*x+l[0]*w,t[1]=e[1]*_+r[1]*v+s[1]*x+l[1]*w,t[2]=e[2]*_+r[2]*v+s[2]*x+l[2]*w,t},Or.bezier=function(t,e,r,s,l,u){var f=1-u,_=f*f,v=u*u,x=_*f,w=3*u*_,E=3*v*f,I=v*u;return t[0]=e[0]*x+r[0]*w+s[0]*E+l[0]*I,t[1]=e[1]*x+r[1]*w+s[1]*E+l[1]*I,t[2]=e[2]*x+r[2]*w+s[2]*E+l[2]*I,t},Or.random=function(t,e){e=e||1;var r=2*Ba.RANDOM()*Math.PI,s=2*Ba.RANDOM()-1,l=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(r)*l,t[1]=Math.sin(r)*l,t[2]=s*e,t},Or.transformMat4=function(t,e,r){var s=e[0],l=e[1],u=e[2],f=r[3]*s+r[7]*l+r[11]*u+r[15];return t[0]=(r[0]*s+r[4]*l+r[8]*u+r[12])/(f=f||1),t[1]=(r[1]*s+r[5]*l+r[9]*u+r[13])/f,t[2]=(r[2]*s+r[6]*l+r[10]*u+r[14])/f,t},Or.transformMat3=function(t,e,r){var s=e[0],l=e[1],u=e[2];return t[0]=s*r[0]+l*r[3]+u*r[6],t[1]=s*r[1]+l*r[4]+u*r[7],t[2]=s*r[2]+l*r[5]+u*r[8],t},Or.transformQuat=function(t,e,r){var s=r[0],l=r[1],u=r[2],f=e[0],_=e[1],v=e[2],x=l*v-u*_,w=u*f-s*v,E=s*_-l*f,I=l*E-u*w,L=u*x-s*E,O=s*w-l*x,z=2*r[3];return w*=z,E*=z,L*=2,O*=2,t[0]=f+(x*=z)+(I*=2),t[1]=_+w+L,t[2]=v+E+O,t},Or.rotateX=function(t,e,r,s){var l=[],u=[];return l[0]=e[0]-r[0],l[1]=e[1]-r[1],l[2]=e[2]-r[2],u[0]=l[0],u[1]=l[1]*Math.cos(s)-l[2]*Math.sin(s),u[2]=l[1]*Math.sin(s)+l[2]*Math.cos(s),t[0]=u[0]+r[0],t[1]=u[1]+r[1],t[2]=u[2]+r[2],t},Or.rotateY=function(t,e,r,s){var l=[],u=[];return l[0]=e[0]-r[0],l[1]=e[1]-r[1],l[2]=e[2]-r[2],u[0]=l[2]*Math.sin(s)+l[0]*Math.cos(s),u[1]=l[1],u[2]=l[2]*Math.cos(s)-l[0]*Math.sin(s),t[0]=u[0]+r[0],t[1]=u[1]+r[1],t[2]=u[2]+r[2],t},Or.rotateZ=function(t,e,r,s){var l=[],u=[];return l[0]=e[0]-r[0],l[1]=e[1]-r[1],l[2]=e[2]-r[2],u[0]=l[0]*Math.cos(s)-l[1]*Math.sin(s),u[1]=l[0]*Math.sin(s)+l[1]*Math.cos(s),u[2]=l[2],t[0]=u[0]+r[0],t[1]=u[1]+r[1],t[2]=u[2]+r[2],t},Or.angle=function(t,e){var r=t[0],s=t[1],l=t[2],u=e[0],f=e[1],_=e[2],v=Math.sqrt(r*r+s*s+l*l)*Math.sqrt(u*u+f*f+_*_),x=v&&pb(t,e)/v;return Math.acos(Math.min(Math.max(x,-1),1))},Or.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Or.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Or.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Or.equals=function(t,e){var r=t[0],s=t[1],l=t[2],u=e[0],f=e[1],_=e[2];return Math.abs(r-u)<=Ba.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(s-f)<=Ba.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(l-_)<=Ba.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))},Or.forEach=Or.sqrLen=Or.len=Or.sqrDist=Or.dist=Or.div=Or.mul=Or.sub=void 0;var Ba=function(t,e){if(t&&t.__esModule)return t;if(t===null||cv(t)!=="object"&&typeof t!="function")return{default:t};var r=sb(void 0);if(r&&r.has(t))return r.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=l?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(s,u,f):s[u]=t[u]}return s.default=t,r&&r.set(t,s),s}(Di);function sb(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(sb=function(s){return s?r:e})(t)}function ob(){var t=new Ba.ARRAY_TYPE(3);return Ba.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ab(t){return Math.hypot(t[0],t[1],t[2])}function lb(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function cb(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function ub(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function hb(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function db(t,e){var r=e[0]-t[0],s=e[1]-t[1],l=e[2]-t[2];return r*r+s*s+l*l}function fb(t){var e=t[0],r=t[1],s=t[2];return e*e+r*r+s*s}function pb(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Or.sub=lb,Or.mul=cb,Or.div=ub,Or.dist=hb,Or.sqrDist=db,Or.len=ab,Or.sqrLen=fb;var Na,oD=(Na=ob(),function(t,e,r,s,l,u){var f,_;for(e||(e=3),r||(r=0),_=s?Math.min(s*e+r,t.length):t.length,f=r;f<_;f+=e)Na[0]=t[f],Na[1]=t[f+1],Na[2]=t[f+2],l(Na,Na,u),t[f]=Na[0],t[f+1]=Na[1],t[f+2]=Na[2];return t});Or.forEach=oD;var Jr={};function uv(t){return uv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uv(t)}Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.create=_b,Jr.clone=function(t){var e=new ro.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Jr.fromValues=function(t,e,r,s){var l=new ro.ARRAY_TYPE(4);return l[0]=t,l[1]=e,l[2]=r,l[3]=s,l},Jr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Jr.set=function(t,e,r,s,l){return t[0]=e,t[1]=r,t[2]=s,t[3]=l,t},Jr.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},Jr.subtract=gb,Jr.multiply=yb,Jr.divide=vb,Jr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Jr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Jr.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},Jr.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},Jr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Jr.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},Jr.scaleAndAdd=function(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t[3]=e[3]+r[3]*s,t},Jr.distance=xb,Jr.squaredDistance=bb,Jr.length=wb,Jr.squaredLength=Tb,Jr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Jr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Jr.normalize=function(t,e){var r=e[0],s=e[1],l=e[2],u=e[3],f=r*r+s*s+l*l+u*u;return f>0&&(f=1/Math.sqrt(f)),t[0]=r*f,t[1]=s*f,t[2]=l*f,t[3]=u*f,t},Jr.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Jr.cross=function(t,e,r,s){var l=r[0]*s[1]-r[1]*s[0],u=r[0]*s[2]-r[2]*s[0],f=r[0]*s[3]-r[3]*s[0],_=r[1]*s[2]-r[2]*s[1],v=r[1]*s[3]-r[3]*s[1],x=r[2]*s[3]-r[3]*s[2],w=e[0],E=e[1],I=e[2],L=e[3];return t[0]=E*x-I*v+L*_,t[1]=-w*x+I*f-L*u,t[2]=w*v-E*f+L*l,t[3]=-w*_+E*u-I*l,t},Jr.lerp=function(t,e,r,s){var l=e[0],u=e[1],f=e[2],_=e[3];return t[0]=l+s*(r[0]-l),t[1]=u+s*(r[1]-u),t[2]=f+s*(r[2]-f),t[3]=_+s*(r[3]-_),t},Jr.random=function(t,e){var r,s,l,u,f,_;e=e||1;do f=(r=2*ro.RANDOM()-1)*r+(s=2*ro.RANDOM()-1)*s;while(f>=1);do _=(l=2*ro.RANDOM()-1)*l+(u=2*ro.RANDOM()-1)*u;while(_>=1);var v=Math.sqrt((1-f)/_);return t[0]=e*r,t[1]=e*s,t[2]=e*l*v,t[3]=e*u*v,t},Jr.transformMat4=function(t,e,r){var s=e[0],l=e[1],u=e[2],f=e[3];return t[0]=r[0]*s+r[4]*l+r[8]*u+r[12]*f,t[1]=r[1]*s+r[5]*l+r[9]*u+r[13]*f,t[2]=r[2]*s+r[6]*l+r[10]*u+r[14]*f,t[3]=r[3]*s+r[7]*l+r[11]*u+r[15]*f,t},Jr.transformQuat=function(t,e,r){var s=e[0],l=e[1],u=e[2],f=r[0],_=r[1],v=r[2],x=r[3],w=x*s+_*u-v*l,E=x*l+v*s-f*u,I=x*u+f*l-_*s,L=-f*s-_*l-v*u;return t[0]=w*x+L*-f+E*-v-I*-_,t[1]=E*x+L*-_+I*-f-w*-v,t[2]=I*x+L*-v+w*-_-E*-f,t[3]=e[3],t},Jr.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Jr.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Jr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Jr.equals=function(t,e){var r=t[0],s=t[1],l=t[2],u=t[3],f=e[0],_=e[1],v=e[2],x=e[3];return Math.abs(r-f)<=ro.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-_)<=ro.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(l-v)<=ro.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(u-x)<=ro.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))},Jr.forEach=Jr.sqrLen=Jr.len=Jr.sqrDist=Jr.dist=Jr.div=Jr.mul=Jr.sub=void 0;var ro=function(t,e){if(t&&t.__esModule)return t;if(t===null||uv(t)!=="object"&&typeof t!="function")return{default:t};var r=mb(void 0);if(r&&r.has(t))return r.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=l?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(s,u,f):s[u]=t[u]}return s.default=t,r&&r.set(t,s),s}(Di);function mb(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(mb=function(s){return s?r:e})(t)}function _b(){var t=new ro.ARRAY_TYPE(4);return ro.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function gb(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function yb(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function vb(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function xb(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function bb(t,e){var r=e[0]-t[0],s=e[1]-t[1],l=e[2]-t[2],u=e[3]-t[3];return r*r+s*s+l*l+u*u}function wb(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Tb(t){var e=t[0],r=t[1],s=t[2],l=t[3];return e*e+r*r+s*s+l*l}Jr.sub=gb,Jr.mul=yb,Jr.div=vb,Jr.dist=xb,Jr.sqrDist=bb,Jr.len=wb,Jr.sqrLen=Tb;var aD=function(){var t=_b();return function(e,r,s,l,u,f){var _,v;for(r||(r=4),s||(s=0),v=l?Math.min(l*r+s,e.length):e.length,_=s;_<v;_+=r)t[0]=e[_],t[1]=e[_+1],t[2]=e[_+2],t[3]=e[_+3],u(t,t,f),e[_]=t[0],e[_+1]=t[1],e[_+2]=t[2],e[_+3]=t[3];return e}}();function hv(t){return hv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hv(t)}Jr.forEach=aD,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.create=dv,Dr.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Dr.setAxisAngle=Mb,Dr.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),s=Math.sin(r/2);return s>ou.EPSILON?(t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s):(t[0]=1,t[1]=0,t[2]=0),r},Dr.getAngle=function(t,e){var r=Db(t,e);return Math.acos(2*r*r-1)},Dr.multiply=Eb,Dr.rotateX=function(t,e,r){r*=.5;var s=e[0],l=e[1],u=e[2],f=e[3],_=Math.sin(r),v=Math.cos(r);return t[0]=s*v+f*_,t[1]=l*v+u*_,t[2]=u*v-l*_,t[3]=f*v-s*_,t},Dr.rotateY=function(t,e,r){r*=.5;var s=e[0],l=e[1],u=e[2],f=e[3],_=Math.sin(r),v=Math.cos(r);return t[0]=s*v-u*_,t[1]=l*v+f*_,t[2]=u*v+s*_,t[3]=f*v-l*_,t},Dr.rotateZ=function(t,e,r){r*=.5;var s=e[0],l=e[1],u=e[2],f=e[3],_=Math.sin(r),v=Math.cos(r);return t[0]=s*v+l*_,t[1]=l*v-s*_,t[2]=u*v+f*_,t[3]=f*v-u*_,t},Dr.calculateW=function(t,e){var r=e[0],s=e[1],l=e[2];return t[0]=r,t[1]=s,t[2]=l,t[3]=Math.sqrt(Math.abs(1-r*r-s*s-l*l)),t},Dr.exp=Ab,Dr.ln=Ib,Dr.pow=function(t,e,r){return Ib(t,e),Pb(t,t,r),Ab(t,t),t},Dr.slerp=h_,Dr.random=function(t){var e=ou.RANDOM(),r=ou.RANDOM(),s=ou.RANDOM(),l=Math.sqrt(1-e),u=Math.sqrt(e);return t[0]=l*Math.sin(2*Math.PI*r),t[1]=l*Math.cos(2*Math.PI*r),t[2]=u*Math.sin(2*Math.PI*s),t[3]=u*Math.cos(2*Math.PI*s),t},Dr.invert=function(t,e){var r=e[0],s=e[1],l=e[2],u=e[3],f=r*r+s*s+l*l+u*u,_=f?1/f:0;return t[0]=-r*_,t[1]=-s*_,t[2]=-l*_,t[3]=u*_,t},Dr.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Dr.fromMat3=Cb,Dr.fromEuler=function(t,e,r,s){var l=.5*Math.PI/180;e*=l,r*=l,s*=l;var u=Math.sin(e),f=Math.cos(e),_=Math.sin(r),v=Math.cos(r),x=Math.sin(s),w=Math.cos(s);return t[0]=u*v*w-f*_*x,t[1]=f*_*w+u*v*x,t[2]=f*v*x-u*_*w,t[3]=f*v*w+u*_*x,t},Dr.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Dr.setAxes=Dr.sqlerp=Dr.rotationTo=Dr.equals=Dr.exactEquals=Dr.normalize=Dr.sqrLen=Dr.squaredLength=Dr.len=Dr.length=Dr.lerp=Dr.dot=Dr.scale=Dr.mul=Dr.add=Dr.set=Dr.copy=Dr.fromValues=Dr.clone=void 0;var ou=u_(Di),lD=u_(Cn),Va=u_(Or),Gs=u_(Jr);function Sb(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Sb=function(s){return s?r:e})(t)}function u_(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||hv(t)!=="object"&&typeof t!="function")return{default:t};var r=Sb(e);if(r&&r.has(t))return r.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=l?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(s,u,f):s[u]=t[u]}return s.default=t,r&&r.set(t,s),s}function dv(){var t=new ou.ARRAY_TYPE(4);return ou.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Mb(t,e,r){r*=.5;var s=Math.sin(r);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(r),t}function Eb(t,e,r){var s=e[0],l=e[1],u=e[2],f=e[3],_=r[0],v=r[1],x=r[2],w=r[3];return t[0]=s*w+f*_+l*x-u*v,t[1]=l*w+f*v+u*_-s*x,t[2]=u*w+f*x+s*v-l*_,t[3]=f*w-s*_-l*v-u*x,t}function Ab(t,e){var r=e[0],s=e[1],l=e[2],u=e[3],f=Math.sqrt(r*r+s*s+l*l),_=Math.exp(u),v=f>0?_*Math.sin(f)/f:0;return t[0]=r*v,t[1]=s*v,t[2]=l*v,t[3]=_*Math.cos(f),t}function Ib(t,e){var r=e[0],s=e[1],l=e[2],u=e[3],f=Math.sqrt(r*r+s*s+l*l),_=f>0?Math.atan2(f,u)/f:0;return t[0]=r*_,t[1]=s*_,t[2]=l*_,t[3]=.5*Math.log(r*r+s*s+l*l+u*u),t}function h_(t,e,r,s){var l,u,f,_,v,x=e[0],w=e[1],E=e[2],I=e[3],L=r[0],O=r[1],z=r[2],V=r[3];return(u=x*L+w*O+E*z+I*V)<0&&(u=-u,L=-L,O=-O,z=-z,V=-V),1-u>ou.EPSILON?(l=Math.acos(u),f=Math.sin(l),_=Math.sin((1-s)*l)/f,v=Math.sin(s*l)/f):(_=1-s,v=s),t[0]=_*x+v*L,t[1]=_*w+v*O,t[2]=_*E+v*z,t[3]=_*I+v*V,t}function Cb(t,e){var r,s=e[0]+e[4]+e[8];if(s>0)r=Math.sqrt(s+1),t[3]=.5*r,t[0]=(e[5]-e[7])*(r=.5/r),t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var l=0;e[4]>e[0]&&(l=1),e[8]>e[3*l+l]&&(l=2);var u=(l+1)%3,f=(l+2)%3;r=Math.sqrt(e[3*l+l]-e[3*u+u]-e[3*f+f]+1),t[l]=.5*r,t[3]=(e[3*u+f]-e[3*f+u])*(r=.5/r),t[u]=(e[3*u+l]+e[3*l+u])*r,t[f]=(e[3*f+l]+e[3*l+f])*r}return t}Dr.clone=Gs.clone,Dr.fromValues=Gs.fromValues,Dr.copy=Gs.copy,Dr.set=Gs.set,Dr.add=Gs.add,Dr.mul=Eb;var Pb=Gs.scale;Dr.scale=Pb;var Db=Gs.dot;Dr.dot=Db,Dr.lerp=Gs.lerp;var Lb=Gs.length;Dr.length=Lb,Dr.len=Lb;var Rb=Gs.squaredLength;Dr.squaredLength=Rb,Dr.sqrLen=Rb;var fv=Gs.normalize;Dr.normalize=fv,Dr.exactEquals=Gs.exactEquals,Dr.equals=Gs.equals;var Mo,kb,Ob,cD=(Mo=Va.create(),kb=Va.fromValues(1,0,0),Ob=Va.fromValues(0,1,0),function(t,e,r){var s=Va.dot(e,r);return s<-.999999?(Va.cross(Mo,kb,e),Va.len(Mo)<1e-6&&Va.cross(Mo,Ob,e),Va.normalize(Mo,Mo),Mb(t,Mo,Math.PI),t):s>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Va.cross(Mo,e,r),t[0]=Mo[0],t[1]=Mo[1],t[2]=Mo[2],t[3]=1+s,fv(t,t))});Dr.rotationTo=cD;var pv,mv,uD=(pv=dv(),mv=dv(),function(t,e,r,s,l,u){return h_(pv,e,l,u),h_(mv,r,s,u),h_(t,pv,mv,2*u*(1-u)),t});Dr.sqlerp=uD;var Eo,hD=(Eo=lD.create(),function(t,e,r,s){return Eo[0]=r[0],Eo[3]=r[1],Eo[6]=r[2],Eo[1]=s[0],Eo[4]=s[1],Eo[7]=s[2],Eo[2]=-e[0],Eo[5]=-e[1],Eo[8]=-e[2],fv(t,Cb(t,Eo))});Dr.setAxes=hD;var sn={};function _v(t){return _v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_v(t)}Object.defineProperty(sn,"__esModule",{value:!0}),sn.create=function(){var t=new vs.ARRAY_TYPE(8);return vs.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},sn.clone=function(t){var e=new vs.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},sn.fromValues=function(t,e,r,s,l,u,f,_){var v=new vs.ARRAY_TYPE(8);return v[0]=t,v[1]=e,v[2]=r,v[3]=s,v[4]=l,v[5]=u,v[6]=f,v[7]=_,v},sn.fromRotationTranslationValues=function(t,e,r,s,l,u,f){var _=new vs.ARRAY_TYPE(8);_[0]=t,_[1]=e,_[2]=r,_[3]=s;var v=.5*l,x=.5*u,w=.5*f;return _[4]=v*s+x*r-w*e,_[5]=x*s+w*t-v*r,_[6]=w*s+v*e-x*t,_[7]=-v*t-x*e-w*r,_},sn.fromRotationTranslation=Bb,sn.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},sn.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},sn.fromMat4=function(t,e){var r=$a.create();zb.getRotation(r,e);var s=new vs.ARRAY_TYPE(3);return zb.getTranslation(s,e),Bb(t,r,s),t},sn.copy=Nb,sn.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},sn.set=function(t,e,r,s,l,u,f,_,v){return t[0]=e,t[1]=r,t[2]=s,t[3]=l,t[4]=u,t[5]=f,t[6]=_,t[7]=v,t},sn.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},sn.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},sn.getTranslation=function(t,e){var r=e[4],s=e[5],l=e[6],u=e[7],f=-e[0],_=-e[1],v=-e[2],x=e[3];return t[0]=2*(r*x+u*f+s*v-l*_),t[1]=2*(s*x+u*_+l*f-r*v),t[2]=2*(l*x+u*v+r*_-s*f),t},sn.translate=function(t,e,r){var s=e[0],l=e[1],u=e[2],f=e[3],_=.5*r[0],v=.5*r[1],x=.5*r[2],w=e[4],E=e[5],I=e[6],L=e[7];return t[0]=s,t[1]=l,t[2]=u,t[3]=f,t[4]=f*_+l*x-u*v+w,t[5]=f*v+u*_-s*x+E,t[6]=f*x+s*v-l*_+I,t[7]=-s*_-l*v-u*x+L,t},sn.rotateX=function(t,e,r){var s=-e[0],l=-e[1],u=-e[2],f=e[3],_=e[4],v=e[5],x=e[6],w=e[7],E=_*f+w*s+v*u-x*l,I=v*f+w*l+x*s-_*u,L=x*f+w*u+_*l-v*s,O=w*f-_*s-v*l-x*u;return $a.rotateX(t,e,r),t[4]=E*(f=t[3])+O*(s=t[0])+I*(u=t[2])-L*(l=t[1]),t[5]=I*f+O*l+L*s-E*u,t[6]=L*f+O*u+E*l-I*s,t[7]=O*f-E*s-I*l-L*u,t},sn.rotateY=function(t,e,r){var s=-e[0],l=-e[1],u=-e[2],f=e[3],_=e[4],v=e[5],x=e[6],w=e[7],E=_*f+w*s+v*u-x*l,I=v*f+w*l+x*s-_*u,L=x*f+w*u+_*l-v*s,O=w*f-_*s-v*l-x*u;return $a.rotateY(t,e,r),t[4]=E*(f=t[3])+O*(s=t[0])+I*(u=t[2])-L*(l=t[1]),t[5]=I*f+O*l+L*s-E*u,t[6]=L*f+O*u+E*l-I*s,t[7]=O*f-E*s-I*l-L*u,t},sn.rotateZ=function(t,e,r){var s=-e[0],l=-e[1],u=-e[2],f=e[3],_=e[4],v=e[5],x=e[6],w=e[7],E=_*f+w*s+v*u-x*l,I=v*f+w*l+x*s-_*u,L=x*f+w*u+_*l-v*s,O=w*f-_*s-v*l-x*u;return $a.rotateZ(t,e,r),t[4]=E*(f=t[3])+O*(s=t[0])+I*(u=t[2])-L*(l=t[1]),t[5]=I*f+O*l+L*s-E*u,t[6]=L*f+O*u+E*l-I*s,t[7]=O*f-E*s-I*l-L*u,t},sn.rotateByQuatAppend=function(t,e,r){var s=r[0],l=r[1],u=r[2],f=r[3],_=e[0],v=e[1],x=e[2],w=e[3];return t[0]=_*f+w*s+v*u-x*l,t[1]=v*f+w*l+x*s-_*u,t[2]=x*f+w*u+_*l-v*s,t[3]=w*f-_*s-v*l-x*u,t[4]=(_=e[4])*f+(w=e[7])*s+(v=e[5])*u-(x=e[6])*l,t[5]=v*f+w*l+x*s-_*u,t[6]=x*f+w*u+_*l-v*s,t[7]=w*f-_*s-v*l-x*u,t},sn.rotateByQuatPrepend=function(t,e,r){var s=e[0],l=e[1],u=e[2],f=e[3],_=r[0],v=r[1],x=r[2],w=r[3];return t[0]=s*w+f*_+l*x-u*v,t[1]=l*w+f*v+u*_-s*x,t[2]=u*w+f*x+s*v-l*_,t[3]=f*w-s*_-l*v-u*x,t[4]=s*(w=r[7])+f*(_=r[4])+l*(x=r[6])-u*(v=r[5]),t[5]=l*w+f*v+u*_-s*x,t[6]=u*w+f*x+s*v-l*_,t[7]=f*w-s*_-l*v-u*x,t},sn.rotateAroundAxis=function(t,e,r,s){if(Math.abs(s)<vs.EPSILON)return Nb(t,e);var l=Math.hypot(r[0],r[1],r[2]);s*=.5;var u=Math.sin(s),f=u*r[0]/l,_=u*r[1]/l,v=u*r[2]/l,x=Math.cos(s),w=e[0],E=e[1],I=e[2],L=e[3];t[0]=w*x+L*f+E*v-I*_,t[1]=E*x+L*_+I*f-w*v,t[2]=I*x+L*v+w*_-E*f,t[3]=L*x-w*f-E*_-I*v;var O=e[4],z=e[5],V=e[6],j=e[7];return t[4]=O*x+j*f+z*v-V*_,t[5]=z*x+j*_+V*f-O*v,t[6]=V*x+j*v+O*_-z*f,t[7]=j*x-O*f-z*_-V*v,t},sn.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t},sn.multiply=Vb,sn.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t},sn.lerp=function(t,e,r,s){var l=1-s;return $b(e,r)<0&&(s=-s),t[0]=e[0]*l+r[0]*s,t[1]=e[1]*l+r[1]*s,t[2]=e[2]*l+r[2]*s,t[3]=e[3]*l+r[3]*s,t[4]=e[4]*l+r[4]*s,t[5]=e[5]*l+r[5]*s,t[6]=e[6]*l+r[6]*s,t[7]=e[7]*l+r[7]*s,t},sn.invert=function(t,e){var r=d_(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t},sn.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},sn.normalize=function(t,e){var r=d_(e);if(r>0){r=Math.sqrt(r);var s=e[0]/r,l=e[1]/r,u=e[2]/r,f=e[3]/r,_=e[4],v=e[5],x=e[6],w=e[7],E=s*_+l*v+u*x+f*w;t[0]=s,t[1]=l,t[2]=u,t[3]=f,t[4]=(_-s*E)/r,t[5]=(v-l*E)/r,t[6]=(x-u*E)/r,t[7]=(w-f*E)/r}return t},sn.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},sn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},sn.equals=function(t,e){var r=t[0],s=t[1],l=t[2],u=t[3],f=t[4],_=t[5],v=t[6],x=t[7],w=e[0],E=e[1],I=e[2],L=e[3],O=e[4],z=e[5],V=e[6],j=e[7];return Math.abs(r-w)<=vs.EPSILON*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(s-E)<=vs.EPSILON*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(l-I)<=vs.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(u-L)<=vs.EPSILON*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(f-O)<=vs.EPSILON*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(_-z)<=vs.EPSILON*Math.max(1,Math.abs(_),Math.abs(z))&&Math.abs(v-V)<=vs.EPSILON*Math.max(1,Math.abs(v),Math.abs(V))&&Math.abs(x-j)<=vs.EPSILON*Math.max(1,Math.abs(x),Math.abs(j))},sn.sqrLen=sn.squaredLength=sn.len=sn.length=sn.dot=sn.mul=sn.setReal=sn.getReal=void 0;var vs=gv(Di),$a=gv(Dr),zb=gv(Fr);function Fb(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Fb=function(s){return s?r:e})(t)}function gv(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||_v(t)!=="object"&&typeof t!="function")return{default:t};var r=Fb(e);if(r&&r.has(t))return r.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=l?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(s,u,f):s[u]=t[u]}return s.default=t,r&&r.set(t,s),s}function Bb(t,e,r){var s=.5*r[0],l=.5*r[1],u=.5*r[2],f=e[0],_=e[1],v=e[2],x=e[3];return t[0]=f,t[1]=_,t[2]=v,t[3]=x,t[4]=s*x+l*v-u*_,t[5]=l*x+u*f-s*v,t[6]=u*x+s*_-l*f,t[7]=-s*f-l*_-u*v,t}function Nb(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Vb(t,e,r){var s=e[0],l=e[1],u=e[2],f=e[3],_=r[4],v=r[5],x=r[6],w=r[7],E=e[4],I=e[5],L=e[6],O=e[7],z=r[0],V=r[1],j=r[2],K=r[3];return t[0]=s*K+f*z+l*j-u*V,t[1]=l*K+f*V+u*z-s*j,t[2]=u*K+f*j+s*V-l*z,t[3]=f*K-s*z-l*V-u*j,t[4]=s*w+f*_+l*x-u*v+E*K+O*z+I*j-L*V,t[5]=l*w+f*v+u*_-s*x+I*K+O*V+L*z-E*j,t[6]=u*w+f*x+s*v-l*_+L*K+O*j+E*V-I*z,t[7]=f*w-s*_-l*v-u*x+O*K-E*z-I*V-L*j,t}sn.getReal=$a.copy,sn.setReal=$a.copy,sn.mul=Vb;var $b=$a.dot;sn.dot=$b;var Ub=$a.length;sn.length=Ub,sn.len=Ub;var d_=$a.squaredLength;sn.squaredLength=d_,sn.sqrLen=d_;var Gr={};function yv(t){return yv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yv(t)}Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.create=Gb,Gr.clone=function(t){var e=new au.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Gr.fromValues=function(t,e){var r=new au.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},Gr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Gr.set=function(t,e,r){return t[0]=e,t[1]=r,t},Gr.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},Gr.subtract=Hb,Gr.multiply=qb,Gr.divide=Wb,Gr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Gr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Gr.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},Gr.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},Gr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Gr.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},Gr.scaleAndAdd=function(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t},Gr.distance=Yb,Gr.squaredDistance=Zb,Gr.length=Xb,Gr.squaredLength=Kb,Gr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Gr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Gr.normalize=function(t,e){var r=e[0],s=e[1],l=r*r+s*s;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t},Gr.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Gr.cross=function(t,e,r){var s=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=s,t},Gr.lerp=function(t,e,r,s){var l=e[0],u=e[1];return t[0]=l+s*(r[0]-l),t[1]=u+s*(r[1]-u),t},Gr.random=function(t,e){e=e||1;var r=2*au.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},Gr.transformMat2=function(t,e,r){var s=e[0],l=e[1];return t[0]=r[0]*s+r[2]*l,t[1]=r[1]*s+r[3]*l,t},Gr.transformMat2d=function(t,e,r){var s=e[0],l=e[1];return t[0]=r[0]*s+r[2]*l+r[4],t[1]=r[1]*s+r[3]*l+r[5],t},Gr.transformMat3=function(t,e,r){var s=e[0],l=e[1];return t[0]=r[0]*s+r[3]*l+r[6],t[1]=r[1]*s+r[4]*l+r[7],t},Gr.transformMat4=function(t,e,r){var s=e[0],l=e[1];return t[0]=r[0]*s+r[4]*l+r[12],t[1]=r[1]*s+r[5]*l+r[13],t},Gr.rotate=function(t,e,r,s){var l=e[0]-r[0],u=e[1]-r[1],f=Math.sin(s),_=Math.cos(s);return t[0]=l*_-u*f+r[0],t[1]=l*f+u*_+r[1],t},Gr.angle=function(t,e){var r=t[0],s=t[1],l=e[0],u=e[1],f=Math.sqrt(r*r+s*s)*Math.sqrt(l*l+u*u);return Math.acos(Math.min(Math.max(f&&(r*l+s*u)/f,-1),1))},Gr.zero=function(t){return t[0]=0,t[1]=0,t},Gr.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Gr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Gr.equals=function(t,e){var r=t[0],s=t[1],l=e[0],u=e[1];return Math.abs(r-l)<=au.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-u)<=au.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))},Gr.forEach=Gr.sqrLen=Gr.sqrDist=Gr.dist=Gr.div=Gr.mul=Gr.sub=Gr.len=void 0;var au=function(t,e){if(t&&t.__esModule)return t;if(t===null||yv(t)!=="object"&&typeof t!="function")return{default:t};var r=jb(void 0);if(r&&r.has(t))return r.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=l?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(s,u,f):s[u]=t[u]}return s.default=t,r&&r.set(t,s),s}(Di);function jb(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(jb=function(s){return s?r:e})(t)}function Gb(){var t=new au.ARRAY_TYPE(2);return au.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function Hb(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function qb(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function Wb(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function Yb(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Zb(t,e){var r=e[0]-t[0],s=e[1]-t[1];return r*r+s*s}function Xb(t){return Math.hypot(t[0],t[1])}function Kb(t){var e=t[0],r=t[1];return e*e+r*r}Gr.len=Xb,Gr.sub=Hb,Gr.mul=qb,Gr.div=Wb,Gr.dist=Yb,Gr.sqrDist=Zb,Gr.sqrLen=Kb;var dD=function(){var t=Gb();return function(e,r,s,l,u,f){var _,v;for(r||(r=2),s||(s=0),v=l?Math.min(l*r+s,e.length):e.length,_=s;_<v;_+=r)t[0]=e[_],t[1]=e[_+1],u(t,t,f),e[_]=t[0],e[_+1]=t[1];return e}}();function vv(t){return vv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vv(t)}Gr.forEach=dD,Object.defineProperty(Pi,"__esModule",{value:!0}),o.a7=Pi.vec4=o.N=Pi.vec3=Pi.vec2=Pi.quat2=o.bi=Pi.quat=o.a6=Pi.mat4=o.co=Pi.mat3=Pi.mat2d=o.b4=Pi.mat2=Pi.glMatrix=void 0;var fD=sa(Di);Pi.glMatrix=fD;var pD=sa(Kn);o.b4=Pi.mat2=pD;var mD=sa(ei);Pi.mat2d=mD;var _D=sa(Cn);o.co=Pi.mat3=_D;var gD=sa(Fr);o.a6=Pi.mat4=gD;var yD=sa(Dr);o.bi=Pi.quat=yD;var vD=sa(sn);Pi.quat2=vD;var xD=sa(Gr);Pi.vec2=xD;var bD=sa(Or);o.N=Pi.vec3=bD;var wD=sa(Jr);function Jb(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Jb=function(s){return s?r:e})(t)}function sa(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||vv(t)!=="object"&&typeof t!="function")return{default:t};var r=Jb(e);if(r&&r.has(t))return r.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=l?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(s,u,f):s[u]=t[u]}return s.default=t,r&&r.set(t,s),s}o.a7=Pi.vec4=wD;class xv{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,s){const l=o.N.dot(r,this.dir);if(Math.abs(l)<1e-6)return!1;const u=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/l;return s[0]=this.pos[0]+this.dir[0]*u,s[1]=this.pos[1]+this.dir[1]*u,s[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,r,s){if(o.N.equals(this.pos,e)||r===0)return s[0]=s[1]=s[2]=0,!1;const[l,u,f]=this.dir,_=this.pos[0]-e[0],v=this.pos[1]-e[1],x=this.pos[2]-e[2],w=l*l+u*u+f*f,E=2*(_*l+v*u+x*f),I=E*E-4*w*(_*_+v*v+x*x-r*r);if(I<0){const L=Math.max(-E/2,0),O=_+l*L,z=v+u*L,V=x+f*L,j=Math.hypot(O,z,V);return s[0]=O*r/j,s[1]=z*r/j,s[2]=V*r/j,!1}{const L=(-E-Math.sqrt(I))/(2*w);if(L<0){const O=Math.hypot(_,v,x);return s[0]=_*r/O,s[1]=v*r/O,s[2]=x*r/O,!1}return s[0]=_+l*L,s[1]=v+u*L,s[2]=x+f*L,!0}}}class bv{constructor(e,r,s,l,u){this.TL=e,this.TR=r,this.BR=s,this.BL=l,this.horizon=u}static fromInvProjectionMatrix(e,r,s){const l=[-1,1,1],u=[1,1,1],f=[1,-1,1],_=[-1,-1,1],v=o.N.transformMat4(l,l,e),x=o.N.transformMat4(u,u,e),w=o.N.transformMat4(f,f,e),E=o.N.transformMat4(_,_,e);return new bv(v,x,w,E,r/s)}}function qf(t,e,r){let s=1/0,l=-1/0;const u=[];for(const f of t){o.N.sub(u,f,e);const _=o.N.dot(u,r);s=Math.min(s,_),l=Math.max(l,_)}return[s,l]}function Qb(t,e){let r=!0;for(let s=0;s<t.planes.length;s++){const l=t.planes[s];let u=0;for(let f=0;f<e.length;f++)u+=o.N.dot(l,e[f])+l[3]>=0;if(u===0)return 0;u!==e.length&&(r=!1)}return r?2:1}function ew(t,e){for(const r of t.projections){const s=qf(e,t.points[0],r.axis);if(r.projection[1]<s[0]||r.projection[0]>s[1])return 0}return 1}function tw(t,e){let r=0;const s=[0,0,0,0];for(let l=0;l<t.length;l++)s[0]=t[l][0],s[1]=t[l][1],s[2]=t[l][2],s[3]=1,o.a7.dot(s,e)>=0&&r++;return r}class wv{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=ti.fromPoints(this.points),this.projections=[],this.frustumEdges=[o.N.sub([],this.points[2],this.points[3]),o.N.sub([],this.points[0],this.points[3]),o.N.sub([],this.points[4],this.points[0]),o.N.sub([],this.points[5],this.points[1]),o.N.sub([],this.points[6],this.points[2]),o.N.sub([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const l=[0,-s[2],s[1]],u=[s[2],0,-s[0]];this.projections.push({axis:l,projection:qf(this.points,this.points[0],l)}),this.projections.push({axis:u,projection:qf(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,r,s,l){const u=Math.pow(2,s),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const w=o.a7.transformMat4([],x,e),E=1/w[3]/r*u;return o.a7.mul(w,w,[E,E,l?1/w[3]:E,E])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const w=o.N.sub([],f[x[0]],f[x[1]]),E=o.N.sub([],f[x[2]],f[x[1]]),I=o.N.normalize([],o.N.cross([],w,E)),L=-o.N.dot(I,f[x[1]]);return I.concat(L)}),v=[];for(let x=0;x<f.length;x++)v.push([f[x][0],f[x][1],f[x][2]]);return new wv(v,_)}intersectsPrecise(e,r,s){for(let l=0;l<r.length;l++)if(!tw(e,r[l]))return 0;for(let l=0;l<this.planes.length;l++)if(!tw(e,this.planes[l]))return 0;for(const l of s)for(const u of this.frustumEdges){const f=o.N.cross([],l,u),_=o.N.length(f);if(_===0)continue;o.N.scale(f,f,1/_);const v=qf(this.points,this.points[0],f),x=qf(e,this.points[0],f);if(v[0]>x[1]||x[0]>v[1])return 0}return 1}}class ti{static fromPoints(e){const r=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const l of e)o.N.min(r,r,l),o.N.max(s,s,l);return new ti(r,s)}static fromTileIdAndHeight(e,r,s){const l=1<<e.canonical.z,u=e.canonical.x,f=e.canonical.y;return new ti([u/l,f/l,r],[(u+1)/l,(f+1)/l,s])}static applyTransform(e,r){const s=e.getCorners();for(let l=0;l<s.length;++l)o.N.transformMat4(s[l],s[l],r);return ti.fromPoints(s)}static projectAabbCorners(e,r){const s=e.getCorners();for(let l=0;l<s.length;++l)o.N.transformMat4(s[l],s[l],r);return s}constructor(e,r){this.min=e,this.max=r,this.center=o.N.scale([],o.N.add([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],s=o.N.clone(this.min),l=o.N.clone(this.max);for(let u=0;u<r.length;u++)s[u]=r[u]?this.min[u]:this.center[u],l[u]=r[u]?this.center[u]:this.max[u];return l[2]=this.max[2],new ti(s,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Qb(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Qb(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?ew(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?ew(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}qt(ti,"Aabb");const TD=wn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:f_}=TD,SD=wn([{name:"a_pos_3",components:3,type:"Int16"}]);var rw=wn([{name:"a_pos",type:"Int16",components:2}]);function p_(t){return t*J/Fe}const MD=[new ti([ge,ge,ge],[De,De,De]),new ti([ge,ge,ge],[0,0,De]),new ti([0,ge,ge],[De,0,De]),new ti([ge,0,ge],[0,De,De]),new ti([0,0,ge],[De,De,De])];function nw(t,e,r,s=!0){const l=o.N.scale([],t._camera.position,t.worldSize),u=[e,r,1,1];o.a7.transformMat4(u,u,t.pixelMatrixInverse),o.a7.scale(u,u,1/u[3]);const f=o.N.sub([],u,l),_=o.N.normalize([],f),v=t.globeMatrix,x=[v[12],v[13],v[14]],w=o.N.sub([],x,l),E=o.N.length(w),I=o.N.normalize([],w),L=t.worldSize/(2*Math.PI),O=o.N.dot(I,_),z=Math.asin(L/E);if(z<Math.acos(O)){if(!s)return null;const Te=[],je=[];o.N.scale(Te,_,E/O),o.N.normalize(je,o.N.sub(je,Te,w)),o.N.normalize(_,o.N.add(_,w,o.N.scale(_,je,Math.tan(z)*E)))}const V=[];new xv(l,_).closestPointOnSphere(x,L,V);const j=o.N.normalize([],te(v,0)),K=o.N.normalize([],te(v,1)),ee=o.N.normalize([],te(v,2)),Q=o.N.dot(j,V),le=o.N.dot(K,V),ae=o.N.dot(ee,V),fe=jt(Math.asin(-le/L));let ve=jt(Math.atan2(Q,ae));ve=t.center.lng+function(Te,je){const Ke=(je-Te+180)%360-180;return Ke<-180?Ke+360:Ke}(t.center.lng,ve);const we=kr(ve),Le=zt(Mr(fe),0,1);return new ln(we,Le)}class ED{constructor(e,r,s){this.a=o.N.sub([],e,s),this.b=o.N.sub([],r,s),this.center=s;const l=o.N.normalize([],this.a),u=o.N.normalize([],this.b);this.angle=Math.acos(o.N.dot(l,u))}}function Tv(t,e){if(t.angle===0)return null;let r;return r=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),r<0||r>1?null:function(s,l,u,f){const _=Math.sin(u);return s*(Math.sin((1-f)*u)/_)+l*(Math.sin(f*u)/_)}(t.a[e],t.b[e],t.angle,zt(r,0,1))+t.center[e]}function oa(t){if(t.z<=1)return MD[t.z+2*t.y+t.x];const e=Sv(m_(t));return ti.fromPoints(e)}function Ua(t,e,r){return o.N.scale(t,t,1-r),o.N.scaleAndAdd(t,t,e,r)}function iw(t,e,r){for(const s of t)o.N.transformMat4(s,s,e),o.N.scale(s,s,r)}function sw(t,e,r,s){const l=e/t.worldSize,u=t.globeMatrix;if(r.z<=1){const we=oa(r).getCorners();return iw(we,u,l),ti.fromPoints(we)}const f=m_(r,s),_=Sv(f,J+p_(t._tileCoverLift));iw(_,u,l);const v=Number.MAX_VALUE,x=[-v,-v,-v],w=[v,v,v];if(f.contains(t.center)){for(const Te of _)o.N.min(w,w,Te),o.N.max(x,x,Te);x[2]=0;const we=t.point,Le=[we.x*l,we.y*l,0];return o.N.min(w,w,Le),o.N.max(x,x,Le),new ti(w,x)}if(t._tileCoverLift>0){for(const we of _)o.N.min(w,w,we),o.N.max(x,x,we);return new ti(w,x)}const E=[u[12]*l,u[13]*l,u[14]*l],I=f.getCenter(),L=zt(t.center.lat,-qr,qr),O=zt(I.lat,-qr,qr),z=kr(t.center.lng),V=Mr(L);let j=z-kr(I.lng);const K=V-Mr(O);j>.5?j-=1:j<-.5&&(j+=1);let ee=0;if(Math.abs(j)>Math.abs(K))ee=j>=0?1:3;else{ee=K>=0?0:2;const we=[u[4]*l,u[5]*l,u[6]*l],Le=-Math.sin(Ve(K>=0?f.getSouth():f.getNorth()))*J;o.N.scaleAndAdd(E,E,we,Le)}const Q=_[ee],le=_[(ee+1)%4],ae=new ED(Q,le,E),fe=[Tv(ae,0)||Q[0],Tv(ae,1)||Q[1],Tv(ae,2)||Q[2]],ve=Ll(t.zoom);if(ve>0){const we=function({x:Te,y:je,z:Ke},Be,Xe,ze,Ze){const St=1/(1<<Ke);let et=Te*St,Jt=et+St,Vt=je*St,ot=Vt+St,vr=0;const or=(et+Jt)/2-ze;return or>.5?vr=-1:or<-.5&&(vr=1),et=((et+vr)*Be-(ze*=Be))*Xe+ze,Jt=((Jt+vr)*Be-ze)*Xe+ze,Vt=(Vt*Be-(Ze*=Be))*Xe+Ze,ot=(ot*Be-Ze)*Xe+Ze,[[et,ot,0],[Jt,ot,0],[Jt,Vt,0],[et,Vt,0]]}(r,e,t._pixelsPerMercatorPixel,z,V);for(let Te=0;Te<_.length;Te++)Ua(_[Te],we[Te],ve);const Le=o.N.add([],we[ee],we[(ee+1)%4]);o.N.scale(Le,Le,.5),Ua(fe,Le,ve)}for(const we of _)o.N.min(w,w,we),o.N.max(x,x,we);return w[2]=Math.min(Q[2],le[2]),o.N.min(w,w,fe),o.N.max(x,x,fe),new ti(w,x)}function m_({x:t,y:e,z:r},s=!1){const l=1/(1<<r),u=new be(Ir(t*l),e===(1<<r)-1&&s?-90:nn((e+1)*l)),f=new be(Ir((t+1)*l),e===0&&s?90:nn(e*l));return new Oe(u,f)}function Sv(t,e=J){const r=Ve(t.getNorth()),s=Ve(t.getSouth()),l=Math.cos(r),u=Math.cos(s),f=Math.sin(r),_=Math.sin(s),v=t.getWest(),x=t.getEast();return[xe(u,_,v,e),xe(u,_,x,e),xe(l,f,x,e),xe(l,f,v,e)]}function Wf(t,e,r,s){const l=1<<r.z,u=(t/kt+r.x)/l;return Ne(nn((e/kt+r.y)/l),Ir(u),s)}function __({min:t,max:e}){return se/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const ow=new Float64Array(16);function g_(t){const e=__(t),r=o.a6.fromScaling(ow,[e,e,e]);return o.a6.translate(r,r,o.N.negate([],t.min))}function Mv(t){const e=o.a6.fromTranslation(ow,t.min),r=1/__(t);return o.a6.scale(e,e,[r,r,r])}function Ev(t){const e=kt/(2*Math.PI);return t/(2*Math.PI)/e}function aw(t,e){return kt/(512*Math.pow(2,t))*__(oa(e))}function lw(t,e,r,s,l){const u=Ev(r),f=[t,e,-r/(2*Math.PI)],_=o.a6.identity(new Float64Array(16));return o.a6.translate(_,_,f),o.a6.scale(_,_,[u,u,u]),o.a6.rotateX(_,_,Ve(-l)),o.a6.rotateY(_,_,Ve(-s)),_}function Ll(t){return vn(ne,Y,t)}function cw(t,e){const r=Ne(e.lat,e.lng),s=function(u){const f=Ne(u._center.lat,u._center.lng),_=o.N.fromValues(0,1,0);let v=o.N.cross([],_,f);const x=o.a6.fromRotation([],-u.angle,f);v=o.N.transformMat4(v,v,x),o.a6.fromRotation(x,-u._pitch,v);const w=o.N.normalize([],f);return o.N.scale(w,w,p_(u.cameraToCenterDistance/u.pixelsPerMeter)),o.N.transformMat4(w,w,x),o.N.add([],f,w)}(t),l=o.N.subtract([],s,r);return o.N.angle(l,r)}function Av(t,e){return cw(t,e)>Math.PI/2*1.01}const uw=Ve(85),AD=Math.cos(uw),ID=Math.sin(uw),CD=o.a6.create(),hw=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function dw(t,e,r,s,l,u,f,_,v){if(u&&t.queryGeometry.isAboveHorizon)return!1;u&&(v*=t.pixelToTileUnitsFactor);const x=t.tileID.canonical,w=r.projection.upVectorScale(x,r.center.lat,r.worldSize).metersToTile;for(const E of e)for(const I of E){const L=I.add(_),O=l&&r.elevation?r.elevation.exaggeration()*l.getElevationAt(L.x,L.y,!0):0,z=r.projection.projectTilePoint(L.x,L.y,x);if(O>0){const ee=r.projection.upVector(x,L.x,L.y);z.x+=ee[0]*w*O,z.y+=ee[1]*w*O,z.z+=ee[2]*w*O}const V=u?L:PD(z.x,z.y,z.z,s),j=u?t.tilespaceRays.map(ee=>LD(ee,O)):t.queryGeometry.screenGeometry,K=o.a7.transformMat4([],[z.x,z.y,z.z,1],s);if(!f&&u?v*=K[3]/r.cameraToCenterDistance:f&&!u&&(v*=r.cameraToCenterDistance/K[3]),u){const ee=nn((I.y/kt+x.y)/(1<<x.z));v/=r.projection.pixelsPerMeter(ee,1)/Cr(1,ee)}if(na(j,V,v))return!0}return!1}function PD(t,e,r,s){const l=o.a7.transformMat4([],[t,e,r,1],s);return new Se(l[0]/l[3],l[1]/l[3])}const fw=o.N.fromValues(0,0,0),DD=o.N.fromValues(0,0,1);function LD(t,e){const r=o.N.create();return fw[2]=e,t.intersectsPlane(fw,DD,r),new Se(r[0],r[1])}class pw extends cs{}function mw(t,{width:e,height:r},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*r*s)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*r*s);return t.width=e,t.height=r,t.data=l,t}function _w(t,e,r){const{width:s,height:l}=e;s===t.width&&l===t.height||(Iv(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,s),height:Math.min(t.height,l)},r),t.width=s,t.height=l,t.data=e.data)}function Iv(t,e,r,s,l,u,f){if(l.width===0||l.height===0)return e;if(l.width>t.width||l.height>t.height||r.x>t.width-l.width||r.y>t.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||s.x>e.width-l.width||s.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const _=t.data,v=e.data,x=u===4&&f;for(let w=0;w<l.height;w++){const E=((r.y+w)*t.width+r.x)*u,I=((s.y+w)*e.width+s.x)*u;if(x)for(let L=0;L<l.width;L++){const O=E+L*u+3,z=I+L*u;v[z+0]=255,v[z+1]=255,v[z+2]=255,v[z+3]=_[O]}else for(let L=0;L<l.width*u;L++)v[I+L]=_[E+L]}return e}qt(pw,"HeatmapBucket",{omit:["layers"]});class Rl{constructor(e,r){mw(this,e,1,r)}resize(e){_w(this,new Rl(e),1)}clone(){return new Rl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,l,u){Iv(e,r,s,l,u,1)}}class Hs{constructor(e,r){mw(this,e,4,r)}resize(e){_w(this,new Hs(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Hs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,l,u,f){Iv(e,r,s,l,u,4,f)}}class gw{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}qt(Rl,"AlphaImage"),qt(Hs,"RGBAImage");const RD=new Zn({visibility:new wt(Ce.layout_heatmap.visibility)});var kD={paint:new Zn({"heatmap-radius":new dr(Ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new dr(Ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new wt(Ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Oa(Ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new wt(Ce.paint_heatmap["heatmap-opacity"])}),layout:RD};function Yf(t){const e={},r=t.resolution||256,s=t.clips?t.clips.length:1,l=t.image||new Hs({width:r,height:s}),u=(f,_,v)=>{e[t.evaluationKey]=v;const x=t.expression.evaluate(e);x&&(l.data[f+_+0]=Math.floor(255*x.r/x.a),l.data[f+_+1]=Math.floor(255*x.g/x.a),l.data[f+_+2]=Math.floor(255*x.b/x.a),l.data[f+_+3]=Math.floor(255*x.a))};if(t.clips)for(let f=0,_=0;f<s;++f,_+=4*r)for(let v=0,x=0;v<r;v++,x+=4){const w=v/(r-1),{start:E,end:I}=t.clips[f];u(_,x,E*(1-w)+I*w)}else for(let f=0,_=0;f<r;f++,_+=4)u(0,_,f/(r-1));return l}const OD=new Zn({visibility:new wt(Ce.layout_hillshade.visibility)});var zD={paint:new Zn({"hillshade-illumination-direction":new wt(Ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new wt(Ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new wt(Ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new wt(Ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new wt(Ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new wt(Ce.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new wt(Ce.paint_hillshade["hillshade-emissive-strength"])}),layout:OD};const FD=wn([{name:"a_pos",components:2,type:"Int16"}],4),{members:BD}=FD;var Cv={exports:{}};function y_(t,e,r){r=r||2;var s,l,u,f,_,v,x,w=e&&e.length,E=w?e[0]*r:t.length,I=yw(t,0,E,r,!0),L=[];if(!I||I.next===I.prev)return L;if(w&&(I=function(z,V,j,K){var ee,Q,le,ae=[];for(ee=0,Q=V.length;ee<Q;ee++)(le=yw(z,V[ee]*K,ee<Q-1?V[ee+1]*K:z.length,K,!1))===le.next&&(le.steiner=!0),ae.push(qD(le));for(ae.sort(jD),ee=0;ee<ae.length;ee++)j=GD(ae[ee],j);return j}(t,e,I,r)),t.length>80*r){s=u=t[0],l=f=t[1];for(var O=r;O<E;O+=r)(_=t[O])<s&&(s=_),(v=t[O+1])<l&&(l=v),_>u&&(u=_),v>f&&(f=v);x=(x=Math.max(u-s,f-l))!==0?32767/x:0}return Zf(I,L,r,s,l,x,0),L}function yw(t,e,r,s,l){var u,f;if(l===Lv(t,e,r,s)>0)for(u=e;u<r;u+=s)f=bw(u,t[u],t[u+1],f);else for(u=r-s;u>=e;u-=s)f=bw(u,t[u],t[u+1],f);return f&&v_(f,f.next)&&(Kf(f),f=f.next),f}function lu(t,e){if(!t)return t;e||(e=t);var r,s=t;do if(r=!1,s.steiner||!v_(s,s.next)&&vi(s.prev,s,s.next)!==0)s=s.next;else{if(Kf(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function Zf(t,e,r,s,l,u,f){if(t){!f&&u&&function(w,E,I,L){var O=w;do O.z===0&&(O.z=Pv(O.x,O.y,E,I,L)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==w);O.prevZ.nextZ=null,O.prevZ=null,function(z){var V,j,K,ee,Q,le,ae,fe,ve=1;do{for(j=z,z=null,Q=null,le=0;j;){for(le++,K=j,ae=0,V=0;V<ve&&(ae++,K=K.nextZ);V++);for(fe=ve;ae>0||fe>0&&K;)ae!==0&&(fe===0||!K||j.z<=K.z)?(ee=j,j=j.nextZ,ae--):(ee=K,K=K.nextZ,fe--),Q?Q.nextZ=ee:z=ee,ee.prevZ=Q,Q=ee;j=K}Q.nextZ=null,ve*=2}while(le>1)}(O)}(t,s,l,u);for(var _,v,x=t;t.prev!==t.next;)if(_=t.prev,v=t.next,u?VD(t,s,l,u):ND(t))e.push(_.i/r|0),e.push(t.i/r|0),e.push(v.i/r|0),Kf(t),t=v.next,x=v.next;else if((t=v)===x){f?f===1?Zf(t=$D(lu(t),e,r),e,r,s,l,u,2):f===2&&UD(t,e,r,s,l,u):Zf(lu(t),e,r,s,l,u,1);break}}}function ND(t){var e=t.prev,r=t,s=t.next;if(vi(e,r,s)>=0)return!1;for(var l=e.x,u=r.x,f=s.x,_=e.y,v=r.y,x=s.y,w=l<u?l<f?l:f:u<f?u:f,E=_<v?_<x?_:x:v<x?v:x,I=l>u?l>f?l:f:u>f?u:f,L=_>v?_>x?_:x:v>x?v:x,O=s.next;O!==e;){if(O.x>=w&&O.x<=I&&O.y>=E&&O.y<=L&&yh(l,_,u,v,f,x,O.x,O.y)&&vi(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function VD(t,e,r,s){var l=t.prev,u=t,f=t.next;if(vi(l,u,f)>=0)return!1;for(var _=l.x,v=u.x,x=f.x,w=l.y,E=u.y,I=f.y,L=_<v?_<x?_:x:v<x?v:x,O=w<E?w<I?w:I:E<I?E:I,z=_>v?_>x?_:x:v>x?v:x,V=w>E?w>I?w:I:E>I?E:I,j=Pv(L,O,e,r,s),K=Pv(z,V,e,r,s),ee=t.prevZ,Q=t.nextZ;ee&&ee.z>=j&&Q&&Q.z<=K;){if(ee.x>=L&&ee.x<=z&&ee.y>=O&&ee.y<=V&&ee!==l&&ee!==f&&yh(_,w,v,E,x,I,ee.x,ee.y)&&vi(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,Q.x>=L&&Q.x<=z&&Q.y>=O&&Q.y<=V&&Q!==l&&Q!==f&&yh(_,w,v,E,x,I,Q.x,Q.y)&&vi(Q.prev,Q,Q.next)>=0))return!1;Q=Q.nextZ}for(;ee&&ee.z>=j;){if(ee.x>=L&&ee.x<=z&&ee.y>=O&&ee.y<=V&&ee!==l&&ee!==f&&yh(_,w,v,E,x,I,ee.x,ee.y)&&vi(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;Q&&Q.z<=K;){if(Q.x>=L&&Q.x<=z&&Q.y>=O&&Q.y<=V&&Q!==l&&Q!==f&&yh(_,w,v,E,x,I,Q.x,Q.y)&&vi(Q.prev,Q,Q.next)>=0)return!1;Q=Q.nextZ}return!0}function $D(t,e,r){var s=t;do{var l=s.prev,u=s.next.next;!v_(l,u)&&vw(l,s,s.next,u)&&Xf(l,u)&&Xf(u,l)&&(e.push(l.i/r|0),e.push(s.i/r|0),e.push(u.i/r|0),Kf(s),Kf(s.next),s=t=u),s=s.next}while(s!==t);return lu(s)}function UD(t,e,r,s,l,u){var f=t;do{for(var _=f.next.next;_!==f.prev;){if(f.i!==_.i&&WD(f,_)){var v=xw(f,_);return f=lu(f,f.next),v=lu(v,v.next),Zf(f,e,r,s,l,u,0),void Zf(v,e,r,s,l,u,0)}_=_.next}f=f.next}while(f!==t)}function jD(t,e){return t.x-e.x}function GD(t,e){var r=function(l,u){var f,_=u,v=l.x,x=l.y,w=-1/0;do{if(x<=_.y&&x>=_.next.y&&_.next.y!==_.y){var E=_.x+(x-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(E<=v&&E>w&&(w=E,f=_.x<_.next.x?_:_.next,E===v))return f}_=_.next}while(_!==u);if(!f)return null;var I,L=f,O=f.x,z=f.y,V=1/0;_=f;do v>=_.x&&_.x>=O&&v!==_.x&&yh(x<z?v:w,x,O,z,x<z?w:v,x,_.x,_.y)&&(I=Math.abs(x-_.y)/(v-_.x),Xf(_,l)&&(I<V||I===V&&(_.x>f.x||_.x===f.x&&HD(f,_)))&&(f=_,V=I)),_=_.next;while(_!==L);return f}(t,e);if(!r)return e;var s=xw(r,t);return lu(s,s.next),lu(r,r.next)}function HD(t,e){return vi(t.prev,t,e.prev)<0&&vi(e.next,t,t.next)<0}function Pv(t,e,r,s,l){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function qD(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function yh(t,e,r,s,l,u,f,_){return(l-f)*(e-_)>=(t-f)*(u-_)&&(t-f)*(s-_)>=(r-f)*(e-_)&&(r-f)*(u-_)>=(l-f)*(s-_)}function WD(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(r,s){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==s.i&&l.next.i!==s.i&&vw(l,l.next,r,s))return!0;l=l.next}while(l!==r);return!1}(t,e)&&(Xf(t,e)&&Xf(e,t)&&function(r,s){var l=r,u=!1,f=(r.x+s.x)/2,_=(r.y+s.y)/2;do l.y>_!=l.next.y>_&&l.next.y!==l.y&&f<(l.next.x-l.x)*(_-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==r);return u}(t,e)&&(vi(t.prev,t,e.prev)||vi(t,e.prev,e))||v_(t,e)&&vi(t.prev,t,t.next)>0&&vi(e.prev,e,e.next)>0)}function vi(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function v_(t,e){return t.x===e.x&&t.y===e.y}function vw(t,e,r,s){var l=b_(vi(t,e,r)),u=b_(vi(t,e,s)),f=b_(vi(r,s,t)),_=b_(vi(r,s,e));return l!==u&&f!==_||!(l!==0||!x_(t,r,e))||!(u!==0||!x_(t,s,e))||!(f!==0||!x_(r,t,s))||!(_!==0||!x_(r,e,s))}function x_(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function b_(t){return t>0?1:t<0?-1:0}function Xf(t,e){return vi(t.prev,t,t.next)<0?vi(t,e,t.next)>=0&&vi(t,t.prev,e)>=0:vi(t,e,t.prev)<0||vi(t,t.next,e)<0}function xw(t,e){var r=new Dv(t.i,t.x,t.y),s=new Dv(e.i,e.x,e.y),l=t.next,u=e.prev;return t.next=e,e.prev=t,r.next=l,l.prev=r,s.next=r,r.prev=s,u.next=s,s.prev=u,s}function bw(t,e,r,s){var l=new Dv(t,e,r);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function Kf(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Dv(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Lv(t,e,r,s){for(var l=0,u=e,f=r-s;u<r;u+=s)l+=(t[f]-t[u])*(t[u+1]+t[f+1]),f=u;return l}Cv.exports=y_,Cv.exports.default=y_,y_.deviation=function(t,e,r,s){var l=e&&e.length,u=Math.abs(Lv(t,0,l?e[0]*r:t.length,r));if(l)for(var f=0,_=e.length;f<_;f++)u-=Math.abs(Lv(t,e[f]*r,f<_-1?e[f+1]*r:t.length,r));var v=0;for(f=0;f<s.length;f+=3){var x=s[f]*r,w=s[f+1]*r,E=s[f+2]*r;v+=Math.abs((t[x]-t[E])*(t[w+1]-t[x+1])-(t[x]-t[w])*(t[E+1]-t[x+1]))}return u===0&&v===0?0:Math.abs((v-u)/u)},y_.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,l=0;l<t.length;l++){for(var u=0;u<t[l].length;u++)for(var f=0;f<e;f++)r.vertices.push(t[l][u][f]);l>0&&r.holes.push(s+=t[l-1].length)}return r};var w_=gt(Cv.exports);function Rv(t,e){const r=t.length;if(r<=1)return[t];const s=[];let l,u;for(let f=0;f<r;f++){const _=ft(t[f]);_!==0&&(t[f].area=Math.abs(_),u===void 0&&(u=_<0),u===_<0?(l&&s.push(l),l=[t[f]]):l.push(t[f]))}if(l&&s.push(l),e>1)for(let f=0;f<s.length;f++)s[f].length<=e||(Oy(s[f],e,1,s[f].length-1,YD),s[f]=s[f].slice(0,e));return s}function YD(t,e){return e.area-t.area}function kv(t,e,r){const s=r.patternDependencies;let l=!1;for(const u of e){const f=u.paint.get(`${t}-pattern`);f.isConstant()||(l=!0);const _=f.constantOr(null);_&&(l=!0,s[_]=!0)}return l}function Ov(t,e,r,s,l){const u=l.patternDependencies;for(const f of e){const _=f.paint.get(`${t}-pattern`).value;if(_.kind!=="constant"){let v=_.evaluate({zoom:s},r,{},l.availableImages);v=v&&v.name?v.name:v,u[v]=!0,r.patterns[f.id]=v}}return r}class zv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Us,this.indexArray=new wi,this.indexArray2=new Qs,this.programConfigurations=new q(e.layers,e.zoom),this.segments=new ni,this.segments2=new ni,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,s,l){this.hasPattern=kv("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:_,id:v,index:x,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,I=yi(_,E);if(!this.layers[0]._featureFilter.filter(new Yn(this.zoom),I,s))continue;const L=u?u.evaluate(I,{},s,r.availableImages):void 0,O={id:v,properties:_.properties,type:_.type,sourceLayerIndex:w,index:x,geometry:E?I.geometry:Si(_,s,l),patterns:{},sortKey:L};f.push(O)}u&&f.sort((_,v)=>_.sortKey-v.sortKey);for(const _ of f){const{geometry:v,index:x,sourceLayerIndex:w}=_;if(this.hasPattern){const E=Ov("fill",this.layers,_,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(_,v,x,s,{},r.availableImages,r.brightness);r.featureIndex.insert(e[x].feature,v,x,w,this.index)}}update(e,r,s,l,u){const f=Object.keys(e).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,f?this.stateDependentLayers:this.layers,s,l,u)}addFeatures(e,r,s,l,u,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,r,s,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,BD),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,l,u,f=[],_){for(const v of Rv(r,500)){let x=0;for(const z of v)x+=z.length;const w=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),E=w.vertexLength,I=[],L=[];for(const z of v){if(z.length===0)continue;z!==v[0]&&L.push(I.length/2);const V=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),j=V.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(j+z.length-1,j),I.push(z[0].x),I.push(z[0].y);for(let K=1;K<z.length;K++)this.layoutVertexArray.emplaceBack(z[K].x,z[K].y),this.indexArray2.emplaceBack(j+K-1,j+K),I.push(z[K].x),I.push(z[K].y);V.vertexLength+=z.length,V.primitiveLength+=z.length}const O=w_(I,L);for(let z=0;z<O.length;z+=3)this.indexArray.emplaceBack(E+O[z],E+O[z+1],E+O[z+2]);w.vertexLength+=x,w.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,f,l,_)}}qt(zv,"FillBucket",{omit:["layers","patternFeatures"]});const ZD=new Zn({"fill-sort-key":new dr(Ce.layout_fill["fill-sort-key"]),visibility:new wt(Ce.layout_fill.visibility)});var XD={paint:new Zn({"fill-antialias":new wt(Ce.paint_fill["fill-antialias"]),"fill-opacity":new dr(Ce.paint_fill["fill-opacity"]),"fill-color":new dr(Ce.paint_fill["fill-color"]),"fill-outline-color":new dr(Ce.paint_fill["fill-outline-color"]),"fill-translate":new wt(Ce.paint_fill["fill-translate"]),"fill-translate-anchor":new wt(Ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new dr(Ce.paint_fill["fill-pattern"]),"fill-emissive-strength":new wt(Ce.paint_fill["fill-emissive-strength"])}),layout:ZD};const KD=wn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),JD=wn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),QD=wn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),eL=wn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),tL=wn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:rL}=KD;var T_={},nL=lt,ww=vh;function vh(t,e,r,s,l){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=l,t.readFields(iL,this,e)}function iL(t,e,r){t==1?e.id=r.readVarint():t==2?function(s,l){for(var u=s.readVarint()+s.pos;s.pos<u;){var f=l._keys[s.readVarint()],_=l._values[s.readVarint()];l.properties[f]=_}}(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function sL(t){for(var e,r,s=0,l=0,u=t.length,f=u-1;l<u;f=l++)s+=((r=t[f]).x-(e=t[l]).x)*(e.y+r.y);return s}vh.types=["Unknown","Point","LineString","Polygon"],vh.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,s=1,l=0,u=0,f=0,_=[];t.pos<r;){if(l<=0){var v=t.readVarint();s=7&v,l=v>>3}if(l--,s===1||s===2)u+=t.readSVarint(),f+=t.readSVarint(),s===1&&(e&&_.push(e),e=[]),e.push(new nL(u,f));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&_.push(e),_},vh.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,s=0,l=0,u=0,f=1/0,_=-1/0,v=1/0,x=-1/0;t.pos<e;){if(s<=0){var w=t.readVarint();r=7&w,s=w>>3}if(s--,r===1||r===2)(l+=t.readSVarint())<f&&(f=l),l>_&&(_=l),(u+=t.readSVarint())<v&&(v=u),u>x&&(x=u);else if(r!==7)throw new Error("unknown command "+r)}return[f,v,_,x]},vh.prototype.toGeoJSON=function(t,e,r){var s,l,u=this.extent*Math.pow(2,r),f=this.extent*t,_=this.extent*e,v=this.loadGeometry(),x=vh.types[this.type];function w(L){for(var O=0;O<L.length;O++){var z=L[O];L[O]=[360*(z.x+f)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(z.y+_)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(s=0;s<v.length;s++)E[s]=v[s][0];w(v=E);break;case 2:for(s=0;s<v.length;s++)w(v[s]);break;case 3:for(v=function(L){var O=L.length;if(O<=1)return[L];for(var z,V,j=[],K=0;K<O;K++){var ee=sL(L[K]);ee!==0&&(V===void 0&&(V=ee<0),V===ee<0?(z&&j.push(z),z=[L[K]]):z.push(L[K]))}return z&&j.push(z),j}(v),s=0;s<v.length;s++)for(l=0;l<v[s].length;l++)w(v[s][l])}v.length===1?v=v[0]:x="Multi"+x;var I={type:"Feature",geometry:{type:x,coordinates:v},properties:this.properties};return"id"in this&&(I.id=this.id),I};var oL=ww,Tw=Sw;function Sw(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(aL,this,e),this.length=this._features.length}function aL(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(function(s){for(var l=null,u=s.readVarint()+s.pos;s.pos<u;){var f=s.readVarint()>>3;l=f===1?s.readString():f===2?s.readFloat():f===3?s.readDouble():f===4?s.readVarint64():f===5?s.readVarint():f===6?s.readSVarint():f===7?s.readBoolean():null}return l}(r))}Sw.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new oL(this._pbf,e,this.extent,this._keys,this._values)};var lL=Tw;function cL(t,e,r){if(t===3){var s=new lL(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}var Fv=T_.VectorTile=function(t,e){this.layers=t.readFields(cL,{},e)},S_=T_.VectorTileFeature=ww;function M_(t,e,r,s){const l=[],u=s===0?(f,_,v,x,w,E)=>{f.push(new Se(E,v+(E-_)/(x-_)*(w-v)))}:(f,_,v,x,w,E)=>{f.push(new Se(_+(E-v)/(w-v)*(x-_),E))};for(const f of t){const _=[];for(const v of f){if(v.length<=2)continue;const x=[];for(let I=0;I<v.length-1;I++){const L=v[I].x,O=v[I].y,z=v[I+1].x,V=v[I+1].y,j=s===0?L:O,K=s===0?z:V;j<e?K>e&&u(x,L,O,z,V,e):j>r?K<r&&u(x,L,O,z,V,r):x.push(v[I]),K<e&&j>=e&&u(x,L,O,z,V,e),K>r&&j<=r&&u(x,L,O,z,V,r)}let w=v[v.length-1];const E=s===0?w.x:w.y;E>=e&&E<=r&&x.push(w),x.length&&(w=x[x.length-1],x[0].x===w.x&&x[0].y===w.y||x.push(x[0]),_.push(x))}_.length&&l.push(_)}return l}function E_(t,e){return t.x-e.x||t.y-e.y}function Mw(t,e){return E_(t.min,e.min)===0&&E_(t.max,e.max)===0}function Ew(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Aw(t,e,r){const s=1/kt,l=1/(1<<r.canonical.z),u=(e.x*s+r.canonical.x)*l+r.wrap,f=(e.y*s+r.canonical.y)*l;return{min:new Se((t.x*s+r.canonical.x)*l+r.wrap,(t.y*s+r.canonical.y)*l),max:new Se(u,f)}}function uL(t,e,r){const s=1<<r.canonical.z,l=((e.x-r.wrap)*s-r.canonical.x)*kt,u=(e.y*s-r.canonical.y)*kt;return{min:new Se(((t.x-r.wrap)*s-r.canonical.x)*kt,(t.y*s-r.canonical.y)*kt),max:new Se(l,u)}}function Iw(t,e,r,s,l,u,f){const _=t.indices,v=t.vertices,x=[];for(let w=s;w<s+l;w+=3){const E=e[r[w+0]+u],I=e[r[w+1]+u],L=e[r[w+2]+u],O=Math.min(E.x,I.x,L.x),z=Math.max(E.x,I.x,L.x),V=Math.min(E.y,I.y,L.y),j=Math.max(E.y,I.y,L.y);x.length=0,t.grid.query(new Se(O,V),new Se(z,j),x);for(let K=0;K<x.length;K++){const ee=x[K];if(iv(v[_[3*ee+0]],v[_[3*ee+1]],v[_[3*ee+2]],E,I,L,f))return!0}}return!1}function Cw(t,e,r,s){if(!t||!r)return!1;let l=t.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(r.vertices.length<t.vertices.length)return Cw(r,s,t,e);const u=e.canonical,f=s.canonical,_=Math.pow(2,f.z-u.z);l=t.vertices.map(v=>new Se(v.x*u.x*kt*_-f.x*kt,v.y*u.y*kt*_-f.y*kt))}return Iw(r,l,t.indices,0,t.indices.length,0,0)}T_.VectorTileLayer=Tw;class Pw{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const s=this.toIdx(e,r);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function Dw(t,e,r,s){let l=0,u=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(s[f])<1e-15){if(r[f]<t[f]||r[f]>e[f])return null}else{const _=1/s[f];let v=(t[f]-r[f])*_,x=(e[f]-r[f])*_;if(v>x){const w=v;v=x,x=w}if(v>l&&(l=v),x<u&&(u=x),l>u)return null}return l}function Lw(t,e,r,s,l,u,f,_,v,x,w){const E=s-t,I=l-e,L=u-r,O=f-t,z=_-e,V=v-r,j=w[1]*V-w[2]*z,K=w[2]*O-w[0]*V,ee=w[0]*z-w[1]*O,Q=E*j+I*K+L*ee;if(Math.abs(Q)<1e-15)return null;const le=1/Q,ae=x[0]-t,fe=x[1]-e,ve=x[2]-r,we=(ae*j+fe*K+ve*ee)*le;if(we<0||we>1)return null;const Le=fe*L-ve*I,Te=ve*E-ae*L,je=ae*I-fe*E,Ke=(w[0]*Le+w[1]*Te+w[2]*je)*le;return Ke<0||we+Ke>1?null:(O*Le+z*Te+V*je)*le}function Rw(t,e,r){return(t-e)/(r-e)}function kw(t,e,r,s,l,u,f,_,v){const x=1<<r,w=u-s,E=f-l,I=(t+1)/x*w+s,L=(e+0)/x*E+l,O=(e+1)/x*E+l;_[0]=(t+0)/x*w+s,_[1]=L,v[0]=I,v[1]=O}class Ow{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(u){const f=Math.ceil(Math.log2(u.dim/8)),_=[];let v=Math.ceil(Math.pow(2,f));const x=1/v,w=(L,O,z,V,j)=>{const K=V?1:0,ee=(L+1)*z-K,Q=O*z,le=(O+1)*z-K;j[0]=L*z,j[1]=Q,j[2]=ee,j[3]=le};let E=new Pw(v);const I=[];for(let L=0;L<v*v;L++){w(L%v,Math.floor(L/v),x,!1,I);const O=kl(I[0],I[1],u),z=kl(I[2],I[1],u),V=kl(I[2],I[3],u),j=kl(I[0],I[3],u);E.minimums.push(Math.min(O,z,V,j)),E.maximums.push(Math.max(O,z,V,j)),E.leaves.push(1)}for(_.push(E),v/=2;v>=1;v/=2){const L=_[_.length-1];E=new Pw(v);for(let O=0;O<v*v;O++){w(O%v,Math.floor(O/v),2,!0,I);const z=L.getElevation(I[0],I[1]),V=L.getElevation(I[2],I[1]),j=L.getElevation(I[2],I[3]),K=L.getElevation(I[0],I[3]),ee=L.isLeaf(I[0],I[1]),Q=L.isLeaf(I[2],I[1]),le=L.isLeaf(I[2],I[3]),ae=L.isLeaf(I[0],I[3]),fe=Math.min(z.min,V.min,j.min,K.min),ve=Math.max(z.max,V.max,j.max,K.max),we=ee&&Q&&le&&ae;E.maximums.push(ve),E.minimums.push(fe),E.leaves.push(ve-fe<=5&&we?1:0)}_.push(E)}return _}(this.dem),s=r.length-1,l=r[s];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(r,0,0,s,0)}raycastRoot(e,r,s,l,u,f,_=1){return Dw([e,r,-100],[s,l,this.maximums[0]*_],u,f)}raycast(e,r,s,l,u,f,_=1){if(!this.nodeCount)return null;const v=this.raycastRoot(e,r,s,l,u,f,_);if(v==null)return null;const x=[],w=[],E=[],I=[],L=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:O,t:z,nodex:V,nodey:j,depth:K}=L.pop();if(this.leaves[O]){kw(V,j,K,e,r,s,l,E,I);const Q=1<<K,le=(V+0)/Q,ae=(V+1)/Q,fe=(j+0)/Q,ve=(j+1)/Q,we=kl(le,fe,this.dem)*_,Le=kl(ae,fe,this.dem)*_,Te=kl(ae,ve,this.dem)*_,je=kl(le,ve,this.dem)*_,Ke=Lw(E[0],E[1],we,I[0],E[1],Le,I[0],I[1],Te,u,f),Be=Lw(I[0],I[1],Te,E[0],I[1],je,E[0],E[1],we,u,f),Xe=Math.min(Ke!==null?Ke:Number.MAX_VALUE,Be!==null?Be:Number.MAX_VALUE);if(Xe!==Number.MAX_VALUE)return Xe;{const ze=o.N.scaleAndAdd([],u,f,z);if(zw(we,Le,je,Te,Rw(ze[0],E[0],I[0]),Rw(ze[1],E[1],I[1]))>=ze[2])return z}continue}let ee=0;for(let Q=0;Q<this._siblingOffset.length;Q++){kw((V<<1)+this._siblingOffset[Q][0],(j<<1)+this._siblingOffset[Q][1],K+1,e,r,s,l,E,I),E[2]=-100,I[2]=this.maximums[this.childOffsets[O]+Q]*_;const le=Dw(E,I,u,f);if(le!=null){const ae=le;x[Q]=ae;let fe=!1;for(let ve=0;ve<ee&&!fe;ve++)ae>=x[w[ve]]&&(w.splice(ve,0,Q),fe=!0);fe||(w[ee]=Q),ee++}}for(let Q=0;Q<ee;Q++){const le=w[Q];L.push({idx:this.childOffsets[O]+le,t:x[le],nodex:(V<<1)+this._siblingOffset[le][0],nodey:(j<<1)+this._siblingOffset[le][1],depth:K+1})}}return null}_addNode(e,r,s){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,s,l,u){if(e[l].isLeaf(r,s)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const f=l-1,_=e[f];let v=0,x=0;for(let w=0;w<this._siblingOffset.length;w++){const E=2*r+this._siblingOffset[w][0],I=2*s+this._siblingOffset[w][1],L=_.getElevation(E,I),O=_.isLeaf(E,I),z=this._addNode(L.min,L.max,O);O&&(v|=1<<w),x||(x=z)}for(let w=0;w<this._siblingOffset.length;w++)v&1<<w||this._construct(e,2*r+this._siblingOffset[w][0],2*s+this._siblingOffset[w][1],f,x+w)}}function zw(t,e,r,s,l,u){return en(en(t,r,u),en(e,s,u),l)}function kl(t,e,r){const s=r.dim,l=zt(t*s-.5,0,s-1),u=zt(e*s-.5,0,s-1),f=Math.floor(l),_=Math.floor(u),v=Math.min(f+1,s-1),x=Math.min(_+1,s-1);return zw(r.get(f,_),r.get(v,_),r.get(f,x),r.get(v,x),l-f,u-_)}const hL={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function dL(t,e,r){return(256*t*256+256*e+r)/10-1e4}function fL(t,e,r){return 256*t+e+r/256-32768}class A_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,s,l=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return ye(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const u=this.dim=r.height-2,f=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=l,this._modifiedForSources={},!l){for(let v=0;v<u;v++)f[this._idx(-1,v)]=f[this._idx(0,v)],f[this._idx(u,v)]=f[this._idx(u-1,v)],f[this._idx(v,-1)]=f[this._idx(v,0)],f[this._idx(v,u)]=f[this._idx(v,u-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(u,-1)]=f[this._idx(u-1,0)],f[this._idx(-1,u)]=f[this._idx(0,u-1)],f[this._idx(u,u)]=f[this._idx(u-1,u-1)]}const _=s==="terrarium"?fL:dL;for(let v=0;v<f.length;++v){const x=4*v;this.floatView[v]=_(this.pixels[x],this.pixels[x+1],this.pixels[x+2])}this._timestamp=nt.now()}_buildQuadTree(){this._tree=new Ow(this)}get(e,r,s=!1){s&&(e=zt(e,-1,this.dim),r=zt(r,-1,this.dim));const l=this._idx(e,r);return this.floatView[l]}set(e,r,s){const l=this._idx(e,r),u=this.floatView[l];return this.floatView[l]=s,s-u}static getUnpackVector(e){return hL[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const s=[0,0,0,0],l=A_.getUnpackVector(r);let u=Math.floor((e+l[3])/l[2]);return s[2]=u%256,u=Math.floor(u/256),s[1]=u%256,u=Math.floor(u/256),s[0]=u,s}getPixels(){return new gw({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,u=r*this.dim+this.dim,f=s*this.dim,_=s*this.dim+this.dim;switch(r){case-1:l=u-1;break;case 1:u=l+1}switch(s){case-1:f=_-1;break;case 1:_=f+1}const v=-r*this.dim,x=-s*this.dim;for(let w=f;w<_;w++)for(let E=l;E<u;E++){const I=4*this._idx(E,w),L=4*this._idx(E+v,w+x);this.pixels[I+0]=e.pixels[L+0],this.pixels[I+1]=e.pixels[L+1],this.pixels[I+2]=e.pixels[L+2],this.pixels[I+3]=e.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}qt(A_,"DEMData"),qt(Ow,"DemMinMaxQuadTree",{omit:["dem"]});class xh{constructor(e,r,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=s}static create(e,r,s){const l=s||e.findDEMTileFor(r);if(!l||!l.dem)return;const u=l.dem,f=l.tileID,_=1<<r.canonical.z-f.canonical.z;return new xh(l,u.dim/kt/_,[(r.canonical.x/_-f.canonical.x)*u.dim,(r.canonical.y/_-f.canonical.y)*u.dim])}tileCoordToPixel(e,r){const s=r*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(s);return new Se(l,u)}getElevationAt(e,r,s,l){const u=e*this._scale+this._offset[0],f=r*this._scale+this._offset[1],_=Math.floor(u),v=Math.floor(f),x=this._dem;return l=!!l,s?en(en(x.get(_,v,l),x.get(_,v+1,l),f-v),en(x.get(_+1,v,l),x.get(_+1,v+1,l),f-v),u-_):x.get(_,v,l)}getElevationAtPixel(e,r,s){return this._dem.get(e,r,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Cr(1,e)*this._dem.stride}}const pL=S_.types,mL=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],_L=["fill-extrusion-flood-light-ground-radius"],gL=Math.pow(2,13),yL=Math.pow(2,15)-1,Fw=new Se(0,1),Ol=2147483648;function Jf(t,e,r,s,l,u,f,_){t.emplaceBack((e<<1)+f,(r<<1)+u,(Math.floor(s*gL)<<1)+l,Math.round(_))}function I_(t,e,r,s,l,u){t.emplaceBack(e.x,e.y,(r.x<<1)+s,(r.y<<1)+l,u)}function Qf(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Bw{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Nw{constructor(){this.centroidXY=new Se(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Se(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Se(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Se(this.max.x-this.min.x,this.max.y-this.min.y)}}class Vw{constructor(){this.acc=new Se(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,s){this.accCount++,this.acc._add(r);let l=!!this.borders;r.x<e.min.x?(e.min.x=r.x,l=!0):r.x>e.max.x&&(e.max.x=r.x,l=!0),r.y<e.min.y?(e.min.y=r.y,l=!0):r.y>e.max.y&&(e.max.y=r.y,l=!0),((r.x===0||r.x===kt)&&r.x===s.x)!=((r.y===0||r.y===kt)&&r.y===s.y)&&this.processBorderOverlap(r,s),l&&this.checkBorderIntersection(r,s)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,en(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>kt!=e.x>kt&&this.addBorderIntersection(1,en(r.y,e.y,(kt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,en(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>kt!=e.y>kt&&this.addBorderIntersection(3,en(r.x,e.x,(kt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];r<s[0]&&(s[0]=r),r>s[1]&&(s[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,r.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,r.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new Se(0,0):new Se(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function $w(t,e){const r=t.add(e)._unit(),s=zt(t.x*r.x+t.y*r.y,-1,1);var l,u,f;return l=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(l)))/4*yL*((u=t).x*(f=e).y-u.y*f.x<0?-1:1)}const vL=[t=>t.x<0,t=>t.x>kt,t=>t.y<0,t=>t.y>kt];function xL(t,e,r,s){const l=[4];if(s===0)return l;r._mult(s);const u=t.sub(r),f=e.sub(r),_=[t,e,u,f];for(let v=0;v<4;v++)for(const x of _)if(vL[v](x)){l.push(v);break}return l}class Uw{constructor(e){this.vertexArray=new Df,this.indexArray=new wi,this.programConfigurations=new q(e.layers,e.zoom,r=>_L.includes(r)),this._segments=new ni,this.hiddenByLandmarkVertexArray=new Vf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ni}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,s,l=!1){const u=e.length;if(u>2){let f=Math.max(0,this._segments.get().length-1);const _=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let v;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const x=e[0],w=e[1];v=$w(x.sub(e[u-1])._perp()._unit(),w.sub(x)._perp()._unit())}for(let x=0;x<u;x++){const w=x===u-1?0:x+1,E=e[x],I=e[w],L=e[w===u-1?0:w+1],O=I.sub(E)._perp()._unit(),z=$w(O,L.sub(I)._perp()._unit()),V=v,j=z;if(Bv(E,I,r)||l&&Hw(E,r)&&Hw(I,r)){v=z;continue}const K=_.vertexLength;I_(this.vertexArray,E,I,1,1,V),I_(this.vertexArray,E,I,1,0,V),I_(this.vertexArray,E,I,0,1,j),I_(this.vertexArray,E,I,0,0,j),_.vertexLength+=4;const ee=xL(E,I,O,s);for(const Q of ee)this._segmentToGroundQuads[f].push({id:K,region:Q}),this._segmentToRegionTriCounts[f][Q]+=2,_.primitiveLength+=2;v=z}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),r=e.length;for(let s=0;s<r;s++)this._segmentToGroundQuads[s].sort((l,u)=>l.region-u.region);for(let s=0;s<r;s++){const l=this._segmentToGroundQuads[s],u=e[s],f=this._segmentToRegionTriCounts[s];f.reduce((v,x)=>v+x,0);let _=0;for(let v=0;v<=4;v++){const x=f[v];if(x!==0){let w=this.regionSegments[v];w||(w=this.regionSegments[v]=new ni);const E={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+_,vertexLength:u.vertexLength,primitiveLength:x};w.get().push(E)}_+=x}for(let v=0;v<l.length;v++){const x=l[v].id;this.indexArray.emplaceBack(x,x+1,x+3),this.indexArray.emplaceBack(x,x+3,x+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,s,l,u,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,s,l,u,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,JD.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,s,l,u,f){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,s,l,u,f)}updateHiddenByLandmark(e){if(!this.hasData())return;const r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const s=e.flags&Ol?1:0;for(let l=e.groundVertexArrayOffset;l<r;++l)this.hiddenByLandmarkVertexArray.emplace(l,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,eL.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const r=this.regionSegments[e];r&&r.destroy()}}}}class C_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new wi,this.footprintVertices=new Us,this.footprintSegments=[],this.layoutVertexArray=new wo,this.centroidVertexArray=new eu,this.indexArray=new wi,this.programConfigurations=new q(e.layers,e.zoom,r=>mL.includes(r)),this.segments=new ni,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new Uw(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,r,s,l){this.features=[],this.hasPattern=kv("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Yr(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:u,id:f,index:_,sourceLayerIndex:v}of e){const x=this.layers[0]._featureFilter.needGeometry,w=yi(u,x);if(!this.layers[0]._featureFilter.filter(new Yn(this.zoom),w,s))continue;const E={id:f,sourceLayerIndex:v,index:_,geometry:x?w.geometry:Si(u,s,l),properties:u.properties,type:u.type,patterns:{}},I=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ov("fill-extrusion",this.layers,E,this.zoom,r)):this.addFeature(E,E.geometry,_,s,{},r.availableImages,l,r.brightness),r.featureIndex.insert(u,E.geometry,_,v,this.index,I)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,s,l,u,f){for(const _ of this.features){const{geometry:v}=_;this.addFeature(_,v,_.index,r,s,l,u,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,s,l,u){const f=Object.keys(e).length!==0;if(f&&!this.stateDependentLayers.length)return;const _=f?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,r,_,s,l,u),this.groundEffect.update(e,r,_,s,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rL),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,tL.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,QD.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,l,u,f,_,v){const x=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,w=[new Se(0,0),new Se(kt,kt)],E=_.projection,I=E.name==="globe",L=pL[e.type]==="Polygon",O=new Vw;O.centroidDataIndex=this.centroidData.length;const z=new Nw,V=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},l)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},l);z.height=j,z.vertexArrayOffset=this.layoutVertexArray.length,z.groundVertexArrayOffset=this.groundEffect.vertexArray.length,I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ch);const K=Rv(r,500);for(let ve=K.length-1;ve>=0;ve--){const we=K[ve];(we.length===0||(ee=we[0]).every(Le=>Le.x<=0)||ee.every(Le=>Le.x>=kt)||ee.every(Le=>Le.y<=0)||ee.every(Le=>Le.y>=kt))&&K.splice(ve,1)}var ee;let Q;if(I)Q=Zw(K,w,l);else{Q=[];for(const ve of K)Q.push({polygon:ve,bounds:w})}const le=L?this.edgeRadius:0,ae=le>0&&this.zoom<17,fe=(ve,we)=>{if(ve.length===0)return!1;const Le=ve[ve.length-1];return we.x===Le.x&&we.y===Le.y};for(const{polygon:ve,bounds:we}of Q){let Le=0,Te=0;for(const Xe of ve)L&&!Xe[0].equals(Xe[Xe.length-1])&&Xe.push(Xe[0]),Te+=L?Xe.length-1:Xe.length;const je=this.segments.prepareSegment((L?5:4)*Te,this.layoutVertexArray,this.indexArray);z.footprintSegIdx<0&&(z.footprintSegIdx=this.footprintSegments.length),z.polygonSegIdx<0&&(z.polygonSegIdx=this.polygonSegments.length);const Ke={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Be=new Bw;if(Be.vertexOffset=this.footprintVertices.length,Be.indexOffset=3*this.footprintIndices.length,Be.ringIndices=[],L){const Xe=[],ze=[];Le=je.vertexLength;for(let St=0;St<ve.length;St++){const et=ve[St];et.length&&St!==0&&ze.push(Xe.length/2);const Jt=[];let Vt,ot;Vt=et[1].sub(et[0])._perp()._unit(),Be.ringIndices.push(et.length-1);for(let vr=1;vr<et.length;vr++){const or=et[vr],Zt=et[vr===et.length-1?1:vr+1],at=or.clone();if(le){ot=Zt.sub(or)._perp()._unit();const fr=Vt.add(ot)._unit(),Br=le*Math.min(4,1/(Vt.x*fr.x+Vt.y*fr.y));at.x+=Br*fr.x,at.y+=Br*fr.y,at.x=Math.round(at.x),at.y=Math.round(at.y),Vt=ot}!V||le!==0&&!ae||fe(Jt,at)||Jt.push(at),Jf(this.layoutVertexArray,at.x,at.y,0,0,1,1,0),je.vertexLength++,this.footprintVertices.emplaceBack(or.x,or.y),Xe.push(or.x,or.y),I&&Qf(this.layoutVertexExtArray,E.projectTilePoint(at.x,at.y,l),E.upVector(l,at.x,at.y))}V&&(le===0||ae)&&(Jt.length!==0&&fe(Jt,Jt[0])&&Jt.pop(),this.groundEffect.addData(Jt,we,x))}const Ze=w_(Xe,ze);for(let St=0;St<Ze.length;St+=3)this.footprintIndices.emplaceBack(Be.vertexOffset+Ze[St+0],Be.vertexOffset+Ze[St+1],Be.vertexOffset+Ze[St+2]),this.indexArray.emplaceBack(Le+Ze[St],Le+Ze[St+2],Le+Ze[St+1]),je.primitiveLength++;Be.indexCount+=Ze.length,Be.vertexCount+=this.footprintVertices.length-Be.vertexOffset}for(let Xe=0;Xe<ve.length;Xe++){const ze=ve[Xe];O.startRing(z,ze[0]);let Ze=ze.length>4&&qw(ze[ze.length-2],ze[0],ze[1]),St=le?bL(ze[ze.length-2],ze[0],ze[1],le):0;const et=[];let Jt,Vt,ot;Vt=ze[1].sub(ze[0])._perp()._unit();let vr=!0;for(let or=1,Zt=0;or<ze.length;or++){let at=ze[or-1],fr=ze[or];const Br=ze[or===ze.length-1?1:or+1];if(O.appendEdge(z,fr,at),Bv(fr,at,we)){le&&(Vt=Br.sub(fr)._perp()._unit(),vr=!vr);continue}const wr=fr.sub(at)._perp(),Nr=wr.x/(Math.abs(wr.x)+Math.abs(wr.y)),Ar=wr.y>0?1:0,tn=at.dist(fr);if(Zt+tn>32768&&(Zt=0),le){ot=Br.sub(fr)._perp()._unit();let fn=Gw(at,fr,Br,jw(Vt,ot),le);isNaN(fn)&&(fn=0);const yn=fr.sub(at)._unit();at=at.add(yn.mult(St))._round(),fr=fr.add(yn.mult(-fn))._round(),St=fn,Vt=ot,V&&this.zoom>=17&&(fe(et,at)||et.push(at),fe(et,fr)||et.push(fr))}const Pr=je.vertexLength,Pn=ze.length>4&&qw(at,fr,Br);let un=Ww(Zt,Ze,vr);if(Jf(this.layoutVertexArray,at.x,at.y,Nr,Ar,0,0,un),Jf(this.layoutVertexArray,at.x,at.y,Nr,Ar,0,1,un),Zt+=tn,un=Ww(Zt,Pn,!vr),Ze=Pn,Jf(this.layoutVertexArray,fr.x,fr.y,Nr,Ar,0,0,un),Jf(this.layoutVertexArray,fr.x,fr.y,Nr,Ar,0,1,un),je.vertexLength+=4,this.indexArray.emplaceBack(Pr+0,Pr+1,Pr+2),this.indexArray.emplaceBack(Pr+1,Pr+3,Pr+2),je.primitiveLength+=2,le){const fn=Le+(or===1?ze.length-2:or-2),yn=or===1?Le:fn+1;if(this.indexArray.emplaceBack(Pr+1,fn,Pr+3),this.indexArray.emplaceBack(fn,yn,Pr+3),je.primitiveLength+=2,Jt===void 0&&(Jt=Pr),!Bv(Br,ze[or],we)){const hn=or===ze.length-1?Jt:je.vertexLength;this.indexArray.emplaceBack(Pr+2,Pr+3,hn),this.indexArray.emplaceBack(Pr+3,hn+1,hn),this.indexArray.emplaceBack(Pr+3,yn,hn+1),je.primitiveLength+=3}vr=!vr}if(I){const fn=this.layoutVertexExtArray,yn=E.projectTilePoint(at.x,at.y,l),hn=E.projectTilePoint(fr.x,fr.y,l),qn=E.upVector(l,at.x,at.y),Sn=E.upVector(l,fr.x,fr.y);Qf(fn,yn,qn),Qf(fn,yn,qn),Qf(fn,hn,Sn),Qf(fn,hn,Sn)}}L&&(Le+=ze.length-1),V&&le&&this.zoom>=17&&(et.length!==0&&fe(et,et[0])&&et.pop(),this.groundEffect.addData(et,we,x,le>0))}this.footprintSegments.push(Be),Ke.triangleCount=this.indexArray.length-Ke.triangleArrayOffset,this.polygonSegments.push(Ke),++z.footprintSegLen,++z.polygonSegLen}if(z.vertexCount=this.layoutVertexArray.length-z.vertexArrayOffset,z.groundVertexCount=this.groundEffect.vertexArray.length-z.groundVertexArrayOffset,z.vertexCount!==0){if(z.centroidXY=O.borders?Fw:this.encodeCentroid(O,z),this.centroidData.push(z),O.borders){this.featuresOnBorder.push(O);const ve=this.featuresOnBorder.length-1;for(let we=0;we<O.borders.length;we++)O.borders[we][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[we].push(ve)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,f,l,v),this.groundEffect.addPaintPropertiesData(e,s,u,f,l,v),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,s)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){const e=[];for(let _=0;_<this.centroidData.length;_++){const v=this.centroidData[_],x=+(v.min.y+v.max.y>kt),w=2*x+(+(v.min.x+v.max.x>kt)^x);for(let E=0;E<v.polygonSegLen;E++){const I=v.polygonSegIdx+E;e.push({centroidIdx:_,subtile:w,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}const r=new wi;e.sort((_,v)=>_.triangleSegmentIdx===v.triangleSegmentIdx?_.subtile-v.subtile:_.triangleSegmentIdx-v.triangleSegmentIdx);let s=0,l=0,u=0;for(const _ of e){if(_.triangleSegmentIdx!==s)break;u++}const f=e.length;for(;l!==e.length;){s=e[l].triangleSegmentIdx;let _=0,v=l,x=l;for(let w=v;w<u&&e[w].subtile===_;w++)x++;for(;v!==u;){const w=e[v];_=w.subtile;const E=this.centroidData[w.centroidIdx].min.clone(),I=this.centroidData[w.centroidIdx].max.clone(),L={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let O=v;O<x;O++){const z=e[O],V=this.polygonSegments[z.polygonSegmentIdx],j=this.centroidData[z.centroidIdx].min,K=this.centroidData[z.centroidIdx].max,ee=this.indexArray.uint16;for(let Q=V.triangleArrayOffset;Q<V.triangleArrayOffset+V.triangleCount;Q++)r.emplaceBack(ee[3*Q],ee[3*Q+1],ee[3*Q+2]);L.primitiveLength+=V.triangleCount,E.x=Math.min(E.x,j.x),E.y=Math.min(E.y,j.y),I.x=Math.max(I.x,K.x),I.y=Math.max(I.y,K.y)}L.primitiveLength>0&&this.triangleSubSegments.push({segment:L,min:E,max:I}),v=x;for(let O=v;O<u&&e[O].subtile===e[v].subtile;O++)x++}l=u;for(let w=l;w<f&&e[w].triangleSegmentIdx===e[l].triangleSegmentIdx;w++)u++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,s){let l=0,u=0;const f=1<<e.canonical.z;if(r){const z=r.getMinMaxForTile(e);z&&(l=z.min,u=z.max)}u+=this.maxHeight;const _=e.toUnwrapped();let v;const x=[_.canonical.x/f+_.wrap,_.canonical.y/f],w=[(_.canonical.x+1)/f+_.wrap,(_.canonical.y+1)/f],E=new ni,I=(z,V,j)=>[z[0]*(1-j[0])+V[0]*j[0],z[1]*(1-j[1])+V[1]*j[1]],L=[],O=[];for(const z of this.triangleSubSegments){L[0]=z.min.x/kt,L[1]=z.min.y/kt,O[0]=z.max.x/kt,O[1]=z.max.y/kt;const V=I(x,w,L),j=I(x,w,O);if(new ti([V[0],V[1],l],[j[0],j[1],u]).intersectsPrecise(s)===0){v&&(E.segments.push(v),v=void 0);continue}const K=z.segment;v&&v.vertexOffset!==K.vertexOffset&&(E.segments.push(v),v=void 0),v?(v.vertexLength+=K.vertexLength,v.primitiveLength+=K.primitiveLength):v={vertexOffset:K.vertexOffset,primitiveLength:K.primitiveLength,vertexLength:K.vertexLength,primitiveOffset:K.primitiveOffset,sortKey:void 0,vaos:{}}}return v&&E.segments.push(v),E}encodeCentroid(e,r){const s=e.centroid(),l=r.span(),u=Math.min(7,Math.round(l.x*this.tileToMeter/10)),f=Math.min(7,Math.round(l.y*this.tileToMeter/10));return new Se(zt(s.x,1,kt-1)<<3|u,zt(s.y,1,kt-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new Se(0,0);const r=e.borders,s=Number.MAX_VALUE;if(r[0][0]!==s||r[1][0]!==s){const l=r[0][0]!==s?0:1;return new Se(6|(r[0][0]!==s?0:65528),(r[l][0]+r[l][1])/2<<3|6)}{const l=r[2][0]!==s?2:3;return new Se((r[l][0]+r[l][1])/2<<3|6,6|(r[2][0]!==s?0:65528))}}showCentroid(e){const r=this.centroidData[e.centroidDataIndex];r.flags&=Ol,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const r=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,l=e.flags&Ol?Fw:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==l.y||u!==l.x){for(let f=r;f<s;++f)this.centroidVertexArray.emplace(f,l.x,l.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const s=r.getReplacementRegionsForTile(e.toUnwrapped());if(function(u,f){if(u.length!==f.length)return!1;for(let _=0;_<u.length;_++)if(u[_].sourceId!==f[_].sourceId||!Mw(u[_],f[_]))return!1;return!0}(this.activeReplacements,s))return;if(this.activeReplacements=s,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const u of this.centroidData)u.flags&=2147483647;const l=[];for(const u of this.activeReplacements){const f=Math.pow(2,u.footprintTileId.canonical.z-e.canonical.z);for(const _ of this.centroidData)if(!(_.flags&Ol||u.min.x>_.max.x||_.min.x>u.max.x||u.min.y>_.max.y||_.min.y>u.max.y))for(let v=0;v<_.footprintSegLen;v++){const x=this.footprintSegments[_.footprintSegIdx+v];if(l.length=0,wL(this.footprintVertices,x.vertexOffset,x.vertexCount,u.footprintTileId.canonical,e.canonical,l),Iw(u.footprint,l,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-f)){_.flags|=Ol;break}}}for(const u of this.centroidData)this.writeCentroidToBuffer(u);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,s){let l=!1;for(let u=0;u<s.footprintSegLen;u++){const f=this.footprintSegments[s.footprintSegIdx+u];let _=0;for(const v of f.ringIndices){for(let x=_,w=v+_-1;x<v+_;w=x++){const E=this.footprintVertices.int16[2*(x+f.vertexOffset)+0],I=this.footprintVertices.int16[2*(x+f.vertexOffset)+1],L=this.footprintVertices.int16[2*(w+f.vertexOffset)+1];I>r!=L>r&&e<(this.footprintVertices.int16[2*(w+f.vertexOffset)+0]-E)*(r-I)/(L-I)+E&&(l=!l)}_=v}}return l}getHeightAtTileCoord(e,r){let s=Number.NEGATIVE_INFINITY,l=!0;const u=4*(e+kt)*kt+(r+kt);if(this.partLookup.hasOwnProperty(u)){const f=this.partLookup[u];return f?{height:f.height,hidden:!!(f.flags&Ol)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||r>f.max.y||f.min.y>r||this.footprintContainsPoint(e,r,f)&&f&&f.height>s&&(s=f.height,this.partLookup[u]=f,l=!!(f.flags&Ol));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:l};this.partLookup[u]=void 0}}function jw(t,e){const r=t.add(e)._unit();return t.x*r.x+t.y*r.y}function bL(t,e,r,s){const l=e.sub(t)._perp()._unit(),u=r.sub(e)._perp()._unit();return Gw(t,e,r,jw(l,u),s)}function Gw(t,e,r,s,l){const u=Math.sqrt(1-s*s);return Math.min(t.dist(e)/3,e.dist(r)/3,l*u/s)}function Bv(t,e,r){return t.x<r[0].x&&e.x<r[0].x||t.x>r[1].x&&e.x>r[1].x||t.y<r[0].y&&e.y<r[0].y||t.y>r[1].y&&e.y>r[1].y}function Hw(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function qw(t,e,r){if(t.x<0||t.x>=kt||e.x<0||e.x>=kt||r.x<0||r.x>=kt)return!1;const s=r.sub(e),l=s.perp(),u=t.sub(e);return(s.x*u.x+s.y*u.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(u.x*u.x+u.y*u.y))>-.866&&l.x*u.x+l.y*u.y<0}function Ww(t,e,r){const s=e?2|t:-3&t;return r?1|s:-2&s}function Yw(){const t=Math.PI/32,e=Math.tan(t),r=Fe;return r*Math.sqrt(1+2*e*e)-r}function Zw(t,e,r){const s=1<<r.z,l=Ir(r.x/s),u=Ir((r.x+1)/s),f=nn(r.y/s),_=nn((r.y+1)/s);return function(v,x,w,E,I=0,L){const O=[];if(!v.length||!w||!E)return O;const z=(ae,fe)=>{for(const ve of ae)O.push({polygon:ve,bounds:fe})},V=Math.ceil(Math.log2(w)),j=Math.ceil(Math.log2(E)),K=V-j,ee=[];for(let ae=0;ae<Math.abs(K);ae++)ee.push(K>0?0:1);for(let ae=0;ae<Math.min(V,j);ae++)ee.push(0),ee.push(1);let Q=v;if(Q=M_(Q,x[0].y-I,x[1].y+I,1),Q=M_(Q,x[0].x-I,x[1].x+I,0),!Q.length)return O;const le=[];for(ee.length?le.push({polygons:Q,bounds:x,depth:0}):z(Q,x);le.length;){const ae=le.pop(),fe=ae.depth,ve=ee[fe],we=ae.bounds[0],Le=ae.bounds[1],Te=ve===0?we.x:we.y,je=ve===0?Le.x:Le.y,Ke=L?L(ve,Te,je):.5*(Te+je),Be=M_(ae.polygons,Te-I,Ke+I,ve),Xe=M_(ae.polygons,Ke-I,je+I,ve);if(Be.length){const ze=[we,new Se(ve===0?Ke:Le.x,ve===1?Ke:Le.y)];ee.length>fe+1?le.push({polygons:Be,bounds:ze,depth:fe+1}):z(Be,ze)}if(Xe.length){const ze=[new Se(ve===0?Ke:we.x,ve===1?Ke:we.y),Le];ee.length>fe+1?le.push({polygons:Xe,bounds:ze,depth:fe+1}):z(Xe,ze)}}return O}(t,e,Math.ceil((u-l)/11.25),Math.ceil((f-_)/11.25),1,(v,x,w)=>{if(v===0)return .5*(x+w);{const E=nn((r.y+x/kt)/s);return(Mr(.5*(nn((r.y+w/kt)/s)+E))*s-r.y)*kt}})}function wL(t,e,r,s,l,u){const f=Math.pow(2,s.z-l.z);for(let _=0;_<r;_++){let v=t.int16[2*(_+e)+0],x=t.int16[2*(_+e)+1];v=(v+l.x*kt)*f-s.x*kt,x=(x+l.y*kt)*f-s.y*kt,u.push(new Se(v,x))}}qt(C_,"FillExtrusionBucket",{omit:["layers","features"]}),qt(Nw,"PartData"),qt(Bw,"FootprintSegment"),qt(Vw,"BorderCentroidData"),qt(Uw,"GroundEffect");const TL=new Zn({visibility:new wt(Ce["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new wt(Ce["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var SL={paint:new Zn({"fill-extrusion-opacity":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new dr(Ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new dr(Ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new dr(Ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new dr(Ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new dr(Ce["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new dr(Ce["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:TL};class bh extends Se{constructor(e,r,s){super(e,r),this.z=s}}function ep(t,e){return t.x*e.x+t.y*e.y}function Xw(t,e){if(t.length===1){let r=0;const s=e[r++];let l;for(;!l||s.equals(l);)if(l=e[r++],!l)return 1/0;for(;r<e.length;r++){const u=e[r],f=t[0],_=l.sub(s),v=u.sub(s),x=f.sub(s),w=ep(_,_),E=ep(_,v),I=ep(v,v),L=ep(x,_),O=ep(x,v),z=w*I-E*E,V=(I*L-E*O)/z,j=(w*O-E*L)/z,K=s.z*(1-V-j)+l.z*V+u.z*j;if(isFinite(K))return K}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}function Kw(t,e,r,s,l,u,f,_){const v=f*l.getElevationAt(t,e,!0,!0),x=u[0]!==0,w=x?u[1]===0?f*(u[0]/7-450):f*function(E,I,L){const O=Math.floor(I[0]/8),z=Math.floor(I[1]/8),V=10*(I[0]-8*O),j=10*(I[1]-8*z),K=E.getElevationAt(O,z,!0,!0),ee=E.getMeterToDEM(L),Q=Math.floor(.5*(V*ee-1)),le=Math.floor(.5*(j*ee-1)),ae=E.tileCoordToPixel(O,z),fe=2*Q+1,ve=2*le+1,we=function(Xe,ze,Ze,St,et){return[Xe.getElevationAtPixel(ze,Ze,!0),Xe.getElevationAtPixel(ze+et,Ze,!0),Xe.getElevationAtPixel(ze,Ze+et,!0),Xe.getElevationAtPixel(ze+St,Ze+et,!0)]}(E,ae.x-Q,ae.y-le,fe,ve),Le=Math.abs(we[0]-we[1]),Te=Math.abs(we[2]-we[3]),je=Math.abs(we[0]-we[2])+Math.abs(we[1]-we[3]),Ke=Math.min(.25,.5*ee*(Le+Te)/fe),Be=Math.min(.25,.5*ee*je/ve);return K+Math.max(Ke*V,Be*j)}(l,u,_):v;return{base:v+(r===0)?-1:r,top:x?Math.max(w+s,v+r+2):v+s}}const ML=wn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:EL}=ML,AL=wn([{name:"a_packed",components:4,type:"Float32"}]),{members:IL}=AL;class Jw{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Rl({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const s=this.getKey(e,r);return this.positions[s]}trim(){const e=this.width,r=this.height=bn(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,s){const l=[];let u=e.length%2==1?-e[e.length-1]*s:0,f=e[0]*s,_=!0;l.push({left:u,right:f,isDash:_,zeroLength:e[0]===0});let v=e[0];for(let x=1;x<e.length;x++){_=!_;const w=e[x];u=v*s,v+=w,f=v*s,l.push({left:u,right:f,isDash:_,zeroLength:w===0})}return l}addRoundDash(e,r,s){const l=r/2;for(let u=-s;u<=s;u++){const f=this.width*(this.nextRow+s+u);let _=0,v=e[_];for(let x=0;x<this.width;x++){x/v.right>1&&(v=e[++_]);const w=Math.abs(x-v.left),E=Math.abs(x-v.right),I=Math.min(w,E);let L;const O=u/s*(l+1);if(v.isDash){const z=l-Math.abs(O);L=Math.sqrt(I*I+z*z)}else L=l-Math.sqrt(I*I+O*O);this.image.data[f+x]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,r){for(let v=e.length-1;v>=0;--v){const x=e[v],w=e[v+1];x.zeroLength?e.splice(v,1):w&&w.isDash===x.isDash&&(w.left=x.left,e.splice(v,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const u=this.width*this.nextRow;let f=0,_=e[f];for(let v=0;v<this.width;v++){v/_.right>1&&(_=e[++f]);const x=Math.abs(v-_.left),w=Math.abs(v-_.right),E=Math.min(x,w);this.image.data[u+v]=Math.max(0,Math.min(255,(_.isDash?E:-E)+r+128))}}addDash(e,r){const s=this.getKey(e,r);if(this.positions[s])return this.positions[s];const l=r==="round",u=l?7:0,f=2*u+1;if(this.nextRow+f>this.height)return ye("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let w=0;w<e.length;w++)e[w]<0&&(ye("Negative value is found in line dasharray, replacing values with 0"),e[w]=0),_+=e[w];if(_!==0){const w=this.width/_,E=this.getDashRanges(e,this.width,w);l?this.addRoundDash(E,w,u):this.addRegularDash(E,r==="square"?.5*w:0)}const v=this.nextRow+u;this.nextRow+=f;const x={tl:[v,u],br:[_,0]};return this.positions[s]=x,x}}qt(Jw,"LineAtlas");const CL=S_.types,PL=Math.cos(Math.PI/180*37.5);class Nv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Lf,this.layoutVertexArray2=new Qo,this.indexArray=new wi,this.programConfigurations=new q(e.layers,e.zoom),this.segments=new ni,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,l){this.hasPattern=kv("line",this.layers,r);const u=this.layers[0].layout.get("line-sort-key"),f=[];for(const{feature:w,id:E,index:I,sourceLayerIndex:L}of e){const O=this.layers[0]._featureFilter.needGeometry,z=yi(w,O);if(!this.layers[0]._featureFilter.filter(new Yn(this.zoom),z,s))continue;const V=u?u.evaluate(z,{},s):void 0,j={id:E,properties:w.properties,type:w.type,sourceLayerIndex:L,index:I,geometry:O?z.geometry:Si(w,s,l),patterns:{},sortKey:V};f.push(j)}u&&f.sort((w,E)=>w.sortKey-E.sortKey);const{lineAtlas:_,featureIndex:v}=r,x=this.addConstantDashes(_);for(const w of f){const{geometry:E,index:I,sourceLayerIndex:L}=w;if(x&&this.addFeatureDashes(w,_),this.hasPattern){const O=Ov("line",this.layers,w,this.zoom,r);this.patternFeatures.push(O)}else this.addFeature(w,E,I,s,_.positions,r.availableImages,r.brightness);v.insert(e[I].feature,E,I,L,this.index)}}addConstantDashes(e){let r=!1;for(const s of this.layers){const l=s.paint.get("line-dasharray").value,u=s.layout.get("line-cap").value;if(l.kind!=="constant"||u.kind!=="constant")r=!0;else{const f=u.value,_=l.value;if(!_)continue;e.addDash(_,f)}}return r}addFeatureDashes(e,r){const s=this.zoom;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(u.kind==="constant"&&f.kind==="constant")continue;let _,v;if(u.kind==="constant"){if(_=u.value,!_)continue}else _=u.evaluate({zoom:s},e);v=f.kind==="constant"?f.value:f.evaluate({zoom:s},e),r.addDash(_,v),e.patterns[l.id]=r.getKey(_,v)}}update(e,r,s,l,u){const f=Object.keys(e).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,f?this.stateDependentLayers:this.layers,s,l,u)}addFeatures(e,r,s,l,u,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,r,s,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,IL)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,EL),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,l,u,f,_){const v=this.layers[0].layout,x=v.get("line-join").evaluate(e,{}),w=v.get("line-cap").evaluate(e,{}),E=v.get("line-miter-limit"),I=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const L of r)this.addLine(L,e,x,w,E,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,f,l,_)}addLine(e,r,s,l,u,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let j=0;j<e.length-1;j++)this.totalDistance+=e[j].dist(e[j+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=CL[r.type]==="Polygon";let v=e.length;for(;v>=2&&e[v-1].equals(e[v-2]);)v--;let x=0;for(;x<v-1&&e[x].equals(e[x+1]);)x++;if(v<(_?3:2))return;s==="bevel"&&(u=1.05);const w=this.overscaling<=16?15*kt/(512*this.overscaling):0,E=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let I,L,O,z,V;this.e1=this.e2=-1,_&&(I=e[v-2],V=e[x].sub(I)._unit()._perp());for(let j=x;j<v;j++){if(O=j===v-1?_?e[x+1]:void 0:e[j+1],O&&e[j].equals(O))continue;V&&(z=V),I&&(L=I),I=e[j],V=O?O.sub(I)._unit()._perp():z,z=z||V;let K=z.add(V);K.x===0&&K.y===0||K._unit();const ee=z.x*V.x+z.y*V.y,Q=K.x*V.x+K.y*V.y,le=Q!==0?1/Q:1/0,ae=2*Math.sqrt(2-2*Q),fe=Q<PL&&L&&O,ve=z.x*V.y-z.y*V.x>0;if(fe&&j>x){const Te=I.dist(L);if(Te>2*w){const je=I.sub(I.sub(L)._mult(w/Te)._round());this.updateDistance(L,je),this.addCurrentVertex(je,z,0,0,E),L=je}}const we=L&&O;let Le=we?s:_?"butt":l;if(we&&Le==="round"&&(le<f?Le="miter":le<=2&&(Le="fakeround")),Le==="miter"&&le>u&&(Le="bevel"),Le==="bevel"&&(le>2&&(Le="flipbevel"),le<u&&(Le="miter")),L&&this.updateDistance(L,I),Le==="miter")K._mult(le),this.addCurrentVertex(I,K,0,0,E);else if(Le==="flipbevel"){if(le>100)K=V.mult(-1);else{const Te=le*z.add(V).mag()/z.sub(V).mag();K._perp()._mult(Te*(ve?-1:1))}this.addCurrentVertex(I,K,0,0,E),this.addCurrentVertex(I,K.mult(-1),0,0,E)}else if(Le==="bevel"||Le==="fakeround"){const Te=-Math.sqrt(le*le-1),je=ve?Te:0,Ke=ve?0:Te;if(L&&this.addCurrentVertex(I,z,je,Ke,E),Le==="fakeround"){const Be=Math.round(180*ae/Math.PI/20);for(let Xe=1;Xe<Be;Xe++){let ze=Xe/Be;if(ze!==.5){const St=ze-.5;ze+=ze*St*(ze-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*St*St+(.848013+ee*(.215638*ee-1.06021)))}const Ze=V.sub(z)._mult(ze)._add(z)._unit()._mult(ve?-1:1);this.addHalfVertex(I,Ze.x,Ze.y,!1,ve,0,E)}}O&&this.addCurrentVertex(I,V,-je,-Ke,E)}else if(Le==="butt")this.addCurrentVertex(I,K,0,0,E);else if(Le==="square"){const Te=L?1:-1;L||this.addCurrentVertex(I,K,Te,Te,E),this.addCurrentVertex(I,K,0,0,E),L&&this.addCurrentVertex(I,K,Te,Te,E)}else Le==="round"&&(L&&(this.addCurrentVertex(I,z,0,0,E),this.addCurrentVertex(I,z,1,1,E,!0)),O&&(this.addCurrentVertex(I,V,-1,-1,E,!0),this.addCurrentVertex(I,V,0,0,E)));if(fe&&j<v-1){const Te=I.dist(O);if(Te>2*w){const je=I.add(O.sub(I)._mult(w/Te)._round());this.updateDistance(I,je),this.addCurrentVertex(je,V,0,0,E),I=je}}}}addCurrentVertex(e,r,s,l,u,f=!1){const _=r.y*l-r.x,v=-r.y-r.x*l;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,f,!1,s,u),this.addHalfVertex(e,_,v,f,!0,-l,u)}addHalfVertex({x:e,y:r},s,l,u,f,_,v){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(r<<1)+(f?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const x=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),v.primitiveLength++),f?this.e2=x:this.e1=x}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}qt(Nv,"LineBucket",{omit:["layers","patternFeatures"]});const DL=new Zn({"line-cap":new dr(Ce.layout_line["line-cap"]),"line-join":new dr(Ce.layout_line["line-join"]),"line-miter-limit":new wt(Ce.layout_line["line-miter-limit"]),"line-round-limit":new wt(Ce.layout_line["line-round-limit"]),"line-sort-key":new dr(Ce.layout_line["line-sort-key"]),visibility:new wt(Ce.layout_line.visibility)});var Qw={paint:new Zn({"line-opacity":new dr(Ce.paint_line["line-opacity"]),"line-color":new dr(Ce.paint_line["line-color"]),"line-translate":new wt(Ce.paint_line["line-translate"]),"line-translate-anchor":new wt(Ce.paint_line["line-translate-anchor"]),"line-width":new dr(Ce.paint_line["line-width"]),"line-gap-width":new dr(Ce.paint_line["line-gap-width"]),"line-offset":new dr(Ce.paint_line["line-offset"]),"line-blur":new dr(Ce.paint_line["line-blur"]),"line-dasharray":new dr(Ce.paint_line["line-dasharray"]),"line-pattern":new dr(Ce.paint_line["line-pattern"]),"line-gradient":new Oa(Ce.paint_line["line-gradient"]),"line-trim-offset":new wt(Ce.paint_line["line-trim-offset"]),"line-emissive-strength":new wt(Ce.paint_line["line-emissive-strength"]),"line-border-width":new dr(Ce.paint_line["line-border-width"]),"line-border-color":new dr(Ce.paint_line["line-border-color"])}),layout:DL};function eT(t,e,r){return e*(kt/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}function tT(t,e){return 1/eT(t,1,e.tileZoom)}function rT(t,e,r,s){return t.translatePosMatrix(s||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const nT=t=>{const e=[];iT(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=t.paint.get("line-trim-offset");return r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function iT(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}const sT=new class extends dr{possiblyEvaluate(t,e){return e=new Yn(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,s){return e=nr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,s)}}(Qw.paint.properties["line-width"].specification);function oT(t,e){return e>0?e+2*t:t}sT.useIntegerZoom=!0;const LL=wn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),RL=wn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),kL=wn([{name:"a_projected_pos",components:4,type:"Float32"}],4);wn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const OL=wn([{name:"a_z_offset",components:1,type:"Float32"}],4),zL=wn([{name:"a_texb",components:2,type:"Uint16"}]),FL=wn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),BL=wn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);wn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const aT=wn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),NL=wn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);wn([{name:"triangle",components:3,type:"Uint16"}]),wn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),wn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),wn([{type:"Float32",name:"offsetX"}]),wn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Hi=24;const Ao=128;function Vv(t,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Yn(t+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=r;let u=0;for(;u<s.length&&s[u]<=t;)u++;u=Math.max(0,u-1);let f=u;for(;f<s.length&&s[f]<t+1;)f++;f=Math.min(s.length-1,f);const _=s[u],v=s[f];return r.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:v,interpolationType:l}:{kind:"camera",minZoom:_,maxZoom:v,minSize:r.evaluate(new Yn(_)),maxSize:r.evaluate(new Yn(v)),interpolationType:l}}}function P_(t,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:l}){return t.kind==="source"?s/Ao:t.kind==="composite"?en(s/Ao,l/Ao,r):e}function wh(t,e){let r=0,s=0;if(t.kind==="constant")s=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:l,minZoom:u,maxZoom:f}=t,_=l?zt(_s.interpolationFactor(l,e,u,f),0,1):0;t.kind==="camera"?s=en(t.minSize,t.maxSize,_):r=_}return{uSizeT:r,uSize:s}}var VL=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ao,evaluateSizeForFeature:P_,evaluateSizeForZoom:wh,getSizeData:Vv});function $L(t,e,r){return t.sections.forEach(s=>{s.text=function(l,u,f){const _=u.layout.get("text-transform").evaluate(f,{});return _==="uppercase"?l=l.toLocaleUpperCase():_==="lowercase"&&(l=l.toLocaleLowerCase()),gs.applyArabicShaping&&(l=gs.applyArabicShaping(l)),l}(s.text,e,r)}),t}const tp={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function UL(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}function jL(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}var GL={read:function(t,e,r,s,l){var u,f,_=8*l-s-1,v=(1<<_)-1,x=v>>1,w=-7,E=r?l-1:0,I=r?-1:1,L=t[e+E];for(E+=I,u=L&(1<<-w)-1,L>>=-w,w+=_;w>0;u=256*u+t[e+E],E+=I,w-=8);for(f=u&(1<<-w)-1,u>>=-w,w+=s;w>0;f=256*f+t[e+E],E+=I,w-=8);if(u===0)u=1-x;else{if(u===v)return f?NaN:1/0*(L?-1:1);f+=Math.pow(2,s),u-=x}return(L?-1:1)*f*Math.pow(2,u-s)},write:function(t,e,r,s,l,u){var f,_,v,x=8*u-l-1,w=(1<<x)-1,E=w>>1,I=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=s?0:u-1,O=s?1:-1,z=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,f=w):(f=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-f))<1&&(f--,v*=2),(e+=f+E>=1?I/v:I*Math.pow(2,1-E))*v>=2&&(f++,v/=2),f+E>=w?(_=0,f=w):f+E>=1?(_=(e*v-1)*Math.pow(2,l),f+=E):(_=e*Math.pow(2,E-1)*Math.pow(2,l),f=0));l>=8;t[r+L]=255&_,L+=O,_/=256,l-=8);for(f=f<<l|_,x+=l;x>0;t[r+L]=255&f,L+=O,f/=256,x-=8);t[r+L-O]|=128*z}},lT=Hn,D_=GL;function Hn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Hn.Varint=0,Hn.Fixed64=1,Hn.Bytes=2,Hn.Fixed32=5;var $v=4294967296,cT=1/$v,uT=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ja(t){return t.type===Hn.Bytes?t.readVarint()+t.pos:t.pos+1}function Th(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function hT(t,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var l=r.pos-1;l>=t;l--)r.buf[l+s]=r.buf[l]}function HL(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function qL(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function WL(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function YL(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function ZL(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function XL(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function KL(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function JL(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function QL(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function L_(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Sh(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function dT(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Hn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),l=s>>3,u=this.pos;this.type=7&s,t(l,e,this),this.pos===u&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=L_(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=dT(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=L_(this.buf,this.pos)+L_(this.buf,this.pos+4)*$v;return this.pos+=8,t},readSFixed64:function(){var t=L_(this.buf,this.pos)+dT(this.buf,this.pos+4)*$v;return this.pos+=8,t},readFloat:function(){var t=D_.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=D_.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(l,u,f){var _,v,x=f.buf;if(_=(112&(v=x[f.pos++]))>>4,v<128||(_|=(127&(v=x[f.pos++]))<<3,v<128)||(_|=(127&(v=x[f.pos++]))<<10,v<128)||(_|=(127&(v=x[f.pos++]))<<17,v<128)||(_|=(127&(v=x[f.pos++]))<<24,v<128)||(_|=(1&(v=x[f.pos++]))<<31,v<128))return Th(l,_,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&uT?function(r,s,l){return uT.decode(r.subarray(s,l))}(this.buf,e,t):function(r,s,l){for(var u="",f=s;f<l;){var _,v,x,w=r[f],E=null,I=w>239?4:w>223?3:w>191?2:1;if(f+I>l)break;I===1?w<128&&(E=w):I===2?(192&(_=r[f+1]))==128&&(E=(31&w)<<6|63&_)<=127&&(E=null):I===3?(v=r[f+2],(192&(_=r[f+1]))==128&&(192&v)==128&&((E=(15&w)<<12|(63&_)<<6|63&v)<=2047||E>=55296&&E<=57343)&&(E=null)):I===4&&(v=r[f+2],x=r[f+3],(192&(_=r[f+1]))==128&&(192&v)==128&&(192&x)==128&&((E=(15&w)<<18|(63&_)<<12|(63&v)<<6|63&x)<=65535||E>=1114112)&&(E=null)),E===null?(E=65533,I=1):E>65535&&(E-=65536,u+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),u+=String.fromCharCode(E),f+=I}return u}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Hn.Bytes)return t.push(this.readVarint(e));var r=ja(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Hn.Bytes)return t.push(this.readSVarint());var e=ja(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Hn.Bytes)return t.push(this.readBoolean());var e=ja(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Hn.Bytes)return t.push(this.readFloat());var e=ja(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Hn.Bytes)return t.push(this.readDouble());var e=ja(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Hn.Bytes)return t.push(this.readFixed32());var e=ja(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Hn.Bytes)return t.push(this.readSFixed32());var e=ja(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Hn.Bytes)return t.push(this.readFixed64());var e=ja(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Hn.Bytes)return t.push(this.readSFixed64());var e=ja(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Hn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Hn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Hn.Fixed32)this.pos+=4;else{if(e!==Hn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Sh(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Sh(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Sh(this.buf,-1&t,this.pos),Sh(this.buf,Math.floor(t*cT),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Sh(this.buf,-1&t,this.pos),Sh(this.buf,Math.floor(t*cT),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,r){var s,l;if(e>=0?(s=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(u,f,_){_.buf[_.pos++]=127&u|128,u>>>=7,_.buf[_.pos++]=127&u|128,u>>>=7,_.buf[_.pos++]=127&u|128,u>>>=7,_.buf[_.pos++]=127&u|128,_.buf[_.pos]=127&(u>>>=7)}(s,0,r),function(u,f){var _=(7&u)<<4;f.buf[f.pos++]|=_|((u>>>=3)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u)))))}(l,r)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,l,u){for(var f,_,v=0;v<l.length;v++){if((f=l.charCodeAt(v))>55295&&f<57344){if(!_){f>56319||v+1===l.length?(s[u++]=239,s[u++]=191,s[u++]=189):_=f;continue}if(f<56320){s[u++]=239,s[u++]=191,s[u++]=189,_=f;continue}f=_-55296<<10|f-56320|65536,_=null}else _&&(s[u++]=239,s[u++]=191,s[u++]=189,_=null);f<128?s[u++]=f:(f<2048?s[u++]=f>>6|192:(f<65536?s[u++]=f>>12|224:(s[u++]=f>>18|240,s[u++]=f>>12&63|128),s[u++]=f>>6&63|128),s[u++]=63&f|128)}return u}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&hT(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),D_.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),D_.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var s=this.pos-r;s>=128&&hT(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,r){this.writeTag(t,Hn.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,HL,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,qL,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,ZL,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,WL,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,YL,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,XL,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,KL,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,JL,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,QL,e)},writeBytesField:function(t,e){this.writeTag(t,Hn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Hn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Hn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Hn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Hn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Hn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Hn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Hn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Hn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Hn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Mh=gt(lT);const Uv=3;function eR(t,e,r){e.glyphs=[],t===1&&r.readMessage(tR,e)}function tR(t,e,r){if(t===3){const{id:s,bitmap:l,width:u,height:f,left:_,top:v,advance:x}=r.readMessage(rR,{});e.glyphs.push({id:s,bitmap:new Rl({width:u+2*Uv,height:f+2*Uv},l),metrics:{width:u,height:f,left:_,top:v,advance:x}})}else t===4?e.ascender=r.readSVarint():t===5&&(e.descender=r.readSVarint())}function rR(t,e,r){t===1?e.id=r.readVarint():t===2?e.bitmap=r.readBytes():t===3?e.width=r.readVarint():t===4?e.height=r.readVarint():t===5?e.left=r.readSVarint():t===6?e.top=r.readSVarint():t===7&&(e.advance=r.readVarint())}const fT=Uv,qs={horizontal:1,vertical:2,horizontalOnly:3};class rp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new rp;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new rp;return r.imageName=e,r}}class Eh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new Eh;for(let l=0;l<e.sections.length;l++){const u=e.sections[l];u.image?s.addImageSection(u):s.addTextSection(u,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,s){let l="";for(let u=0;u<r.length;u++){const f=r.charCodeAt(u+1)||null,_=r.charCodeAt(u-1)||null;l+=!s&&(f&&Nm(f)&&!tp[r[u+1]]||_&&Nm(_)&&!tp[r[u-1]])||!tp[r[u]]?r[u]:tp[r[u]]}return l}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&R_[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&R_[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new Eh;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(rp.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.namePrimary:"";if(r.length===0)return void ye("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCodePoint(s),this.sections.push(rp.forImage(r)),this.sectionIndex.push(this.sections.length-1)):ye("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function jv(t,e,r,s,l,u,f,_,v,x,w,E,I,L,O){const z=Eh.fromFeature(t,l);E===qs.vertical&&z.verticalizePunctuation(I);let V=[];const j=function(ae,fe,ve,we,Le,Te){if(!ae)return[];const je=[],Ke=function(Ze,St,et,Jt,Vt,ot){let vr=0;for(let or=0;or<Ze.length();or++){const Zt=Ze.getSection(or);vr+=pT(Ze.getCodePoint(or),Zt,Jt,Vt,St,ot)}return vr/Math.max(1,Math.ceil(vr/et))}(ae,fe,ve,we,Le,Te),Be=ae.text.indexOf("")>=0;let Xe=0;for(let Ze=0;Ze<ae.length();Ze++){const St=ae.getSection(Ze),et=ae.getCodePoint(Ze);if(R_[et]||(Xe+=pT(et,St,we,Le,fe,Te)),Ze<ae.length()-1){const Jt=!((ze=et)<11904||!(er["Bopomofo Extended"](ze)||er.Bopomofo(ze)||er["CJK Compatibility Forms"](ze)||er["CJK Compatibility Ideographs"](ze)||er["CJK Compatibility"](ze)||er["CJK Radicals Supplement"](ze)||er["CJK Strokes"](ze)||er["CJK Symbols and Punctuation"](ze)||er["CJK Unified Ideographs Extension A"](ze)||er["CJK Unified Ideographs"](ze)||er["Enclosed CJK Letters and Months"](ze)||er["Halfwidth and Fullwidth Forms"](ze)||er.Hiragana(ze)||er["Ideographic Description Characters"](ze)||er["Kangxi Radicals"](ze)||er["Katakana Phonetic Extensions"](ze)||er.Katakana(ze)||er["Vertical Forms"](ze)||er["Yi Radicals"](ze)||er["Yi Syllables"](ze)));(nR[et]||Jt||St.imageName)&&je.push(_T(Ze+1,Xe,Ke,je,iR(et,ae.getCodePoint(Ze+1),Jt&&Be),!1))}}var ze;return gT(_T(ae.length(),Xe,Ke,je,0,!0))}(z,x,u,e,s,L),{processBidirectionalText:K,processStyledBidirectionalText:ee}=gs;if(K&&z.sections.length===1){const ae=K(z.toString(),j);for(const fe of ae){const ve=new Eh;ve.text=fe,ve.sections=z.sections;for(let we=0;we<fe.length;we++)ve.sectionIndex.push(0);V.push(ve)}}else if(ee){const ae=ee(z.text,z.sectionIndex,j);for(const fe of ae){const ve=new Eh;ve.text=fe[0],ve.sectionIndex=fe[1],ve.sections=z.sections,V.push(ve)}}else V=function(ae,fe){const ve=[],we=ae.text;let Le=0;for(const Te of fe)ve.push(ae.substring(Le,Te)),Le=Te;return Le<we.length&&ve.push(ae.substring(Le,we.length)),ve}(z,j);const Q=[],le={positionedLines:Q,text:z.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ae,fe,ve,we,Le,Te,je,Ke,Be,Xe,ze,Ze){let St=0,et=0,Jt=0;const Vt=Ke==="right"?1:Ke==="left"?0:.5;let ot=!1;for(const Br of Le){const wr=Br.getSections();for(const Nr of wr){if(Nr.imageName)continue;const Ar=fe[Nr.fontStack];if(Ar&&(ot=Ar.ascender!==void 0&&Ar.descender!==void 0,!ot))break}if(!ot)break}let vr=0;for(const Br of Le){Br.trim();const wr=Br.getMaxScale(),Nr=(wr-1)*Hi,Ar={positionedGlyphs:[],lineOffset:0};ae.positionedLines[vr]=Ar;const tn=Ar.positionedGlyphs;let Pr=0;if(!Br.length()){et+=Te,++vr;continue}let Pn=0,un=0;for(let yn=0;yn<Br.length();yn++){const hn=Br.getSection(yn),qn=Br.getSectionIndex(yn),Sn=Br.getCodePoint(yn);let ii=hn.scale,xi=null,Ui=null,Un=null,Jn=Hi,Li=0;const Ri=!(Be===qs.horizontal||!ze&&!_f(Sn)||ze&&(R_[Sn]||(or=Sn,er.Arabic(or)||er["Arabic Supplement"](or)||er["Arabic Extended-A"](or)||er["Arabic Presentation Forms-A"](or)||er["Arabic Presentation Forms-B"](or))));if(hn.imageName){const ki=we[hn.imageName];if(!ki)continue;Un=hn.imageName,ae.iconsInText=ae.iconsInText||!0,Ui=ki.paddedRect;const On=ki.displaySize;ii=ii*Hi/Ze,xi={width:On[0],height:On[1],left:0,top:-fT,advance:Ri?On[1]:On[0],localGlyph:!1},Li=ot?-xi.height*ii:wr*Hi-17-On[1]*ii,Jn=xi.advance;const Cs=(Ri?On[0]:On[1])*ii-Hi*wr;Cs>0&&Cs>Pr&&(Pr=Cs)}else{const ki=ve[hn.fontStack];if(!ki)continue;ki[Sn]&&(Ui=ki[Sn]);const On=fe[hn.fontStack];if(!On)continue;const Cs=On.glyphs[Sn];if(!Cs)continue;if(xi=Cs.metrics,Jn=Sn!==8203?Hi:0,ot){const Ul=On.ascender!==void 0?Math.abs(On.ascender):0,us=On.descender!==void 0?Math.abs(On.descender):0,ts=(Ul+us)*ii;Pn<ts&&(Pn=ts,un=(Ul-us)/2*ii),Li=-Ul*ii}else Li=(wr-ii)*Hi-17}Ri?(ae.verticalizable=!0,tn.push({glyph:Sn,imageName:Un,x:St,y:et+Li,vertical:Ri,scale:ii,localGlyph:xi.localGlyph,fontStack:hn.fontStack,sectionIndex:qn,metrics:xi,rect:Ui}),St+=Jn*ii+Xe):(tn.push({glyph:Sn,imageName:Un,x:St,y:et+Li,vertical:Ri,scale:ii,localGlyph:xi.localGlyph,fontStack:hn.fontStack,sectionIndex:qn,metrics:xi,rect:Ui}),St+=xi.advance*ii+Xe)}tn.length!==0&&(Jt=Math.max(St-Xe,Jt),ot?yT(tn,Vt,Pr,un,Te*wr/2):yT(tn,Vt,Pr,0,Te/2)),St=0;const fn=Te*wr+Pr;Ar.lineOffset=Math.max(Pr,Nr),et+=fn,++vr}var or;const Zt=et,{horizontalAlign:at,verticalAlign:fr}=Gv(je);(function(Br,wr,Nr,Ar,tn,Pr){const Pn=(wr-Nr)*tn,un=-Pr*Ar;for(const fn of Br)for(const yn of fn.positionedGlyphs)yn.x+=Pn,yn.y+=un})(ae.positionedLines,Vt,at,fr,Jt,Zt),ae.top+=-fr*Zt,ae.bottom=ae.top+Zt,ae.left+=-at*Jt,ae.right=ae.left+Jt,ae.hasBaseline=ot}(le,e,r,s,V,f,_,v,E,x,I,O),!function(ae){for(const fe of ae)if(fe.positionedGlyphs.length!==0)return!1;return!0}(Q)&&le}const R_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},nR={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function pT(t,e,r,s,l,u){if(e.imageName){const f=s[e.imageName];return f?f.displaySize[0]*e.scale*Hi/u+l:0}{const f=r[e.fontStack],_=f&&f.glyphs[t];return _?_.metrics.advance*e.scale+l:0}}function mT(t,e,r,s){const l=Math.pow(t-e,2);return s?t<e?l/2:2*l:l+Math.abs(r)*r}function iR(t,e,r){let s=0;return t===10&&(s-=1e4),r&&(s+=150),t!==40&&t!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function _T(t,e,r,s,l,u){let f=null,_=mT(e,r,l,u);for(const v of s){const x=mT(e-v.x,r,l,u)+v.badness;x<=_&&(f=v,_=x)}return{index:t,x:e,priorBreak:f,badness:_}}function gT(t){return t?gT(t.priorBreak).concat(t.index):[]}function Gv(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function yT(t,e,r,s,l){if(!(e||r||s||l))return;const u=t.length-1,f=t[u],_=(f.x+f.metrics.advance*f.scale)*e;for(let v=0;v<=u;v++)t[v].x-=_,t[v].y+=r+s+l}function sR(t,e,r,s){const{horizontalAlign:l,verticalAlign:u}=Gv(s),f=r[0]-t.displaySize[0]*l,_=r[1]-t.displaySize[1]*u;return{imagePrimary:t,imageSecondary:e,top:_,bottom:_+t.displaySize[1],left:f,right:f+t.displaySize[0]}}function vT(t,e,r,s,l,u){const f=t.imagePrimary;let _;if(f.content){const V=f.content,j=f.pixelRatio||1;_=[V[0]/j,V[1]/j,f.displaySize[0]-V[2]/j,f.displaySize[1]-V[3]/j]}const v=e.left*u,x=e.right*u;let w,E,I,L;r==="width"||r==="both"?(L=l[0]+v-s[3],E=l[0]+x+s[1]):(L=l[0]+(v+x-f.displaySize[0])/2,E=L+f.displaySize[0]);const O=e.top*u,z=e.bottom*u;return r==="height"||r==="both"?(w=l[1]+O-s[0],I=l[1]+z+s[2]):(w=l[1]+(O+z-f.displaySize[1])/2,I=w+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:w,right:E,bottom:I,left:L,collisionPadding:_}}class Ga extends Se{constructor(e,r,s,l,u){super(e,r),this.angle=l,this.z=s,u!==void 0&&(this.segment=u)}clone(){return new Ga(this.x,this.y,this.z,this.angle,this.segment)}}function xT(t,e,r,s,l){if(e.segment===void 0)return!0;let u=e,f=e.segment+1,_=0;for(;_>-r/2;){if(f--,f<0)return!1;_-=t[f].dist(u),u=t[f]}_+=t[f].dist(t[f+1]),f++;const v=[];let x=0;for(;_<r/2;){const w=t[f],E=t[f+1];if(!E)return!1;let I=t[f-1].angleTo(w)-w.angleTo(E);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:_,angleDelta:I}),x+=I;_-v[0].distance>s;)x-=v.shift().angleDelta;if(x>l)return!1;f++,_+=w.dist(E)}return!0}function bT(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function wT(t,e,r){return t?.6*e*r:0}function TT(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function oR(t,e,r,s,l,u){const f=wT(r,l,u),_=TT(r,s)*u;let v=0;const x=bT(t)/2;for(let w=0;w<t.length-1;w++){const E=t[w],I=t[w+1],L=E.dist(I);if(v+L>x){const O=(x-v)/L,z=en(E.x,I.x,O),V=en(E.y,I.y,O),j=new Ga(z,V,0,I.angleTo(E),w);return!f||xT(t,j,_,f,e)?j:void 0}v+=L}}function aR(t,e,r,s,l,u,f,_,v){const x=wT(s,u,f),w=TT(s,l),E=w*f,I=t[0].x===0||t[0].x===v||t[0].y===0||t[0].y===v;return e-E<e/4&&(e=E+e/4),ST(t,I?e/2*_%e:(w/2+2*u)*f*_%e,e,x,r,E,I,!1,v)}function ST(t,e,r,s,l,u,f,_,v){const x=u/2,w=bT(t);let E=0,I=e-r,L=[];for(let O=0;O<t.length-1;O++){const z=t[O],V=t[O+1],j=z.dist(V),K=V.angleTo(z);for(;I+r<E+j;){I+=r;const ee=(I-E)/j,Q=en(z.x,V.x,ee),le=en(z.y,V.y,ee);if(Q>=0&&Q<v&&le>=0&&le<v&&I-x>=0&&I+x<=w){const ae=new Ga(Q,le,0,K,O);s&&!xT(t,ae,u,s,l)||L.push(ae)}}E+=j}return _||L.length||f||(L=ST(t,E/2,r,s,l,u,f,!0,v)),L}function MT(t,e,r,s,l){const u=[];for(let f=0;f<t.length;f++){const _=t[f];let v;for(let x=0;x<_.length-1;x++){let w=_[x],E=_[x+1];w.x<e&&E.x<e||(w.x<e?w=new Se(e,w.y+(e-w.x)/(E.x-w.x)*(E.y-w.y))._round():E.x<e&&(E=new Se(e,w.y+(e-w.x)/(E.x-w.x)*(E.y-w.y))._round()),w.y<r&&E.y<r||(w.y<r?w=new Se(w.x+(r-w.y)/(E.y-w.y)*(E.x-w.x),r)._round():E.y<r&&(E=new Se(w.x+(r-w.y)/(E.y-w.y)*(E.x-w.x),r)._round()),w.x>=s&&E.x>=s||(w.x>=s?w=new Se(s,w.y+(s-w.x)/(E.x-w.x)*(E.y-w.y))._round():E.x>=s&&(E=new Se(s,w.y+(s-w.x)/(E.x-w.x)*(E.y-w.y))._round()),w.y>=l&&E.y>=l||(w.y>=l?w=new Se(w.x+(l-w.y)/(E.y-w.y)*(E.x-w.x),l)._round():E.y>=l&&(E=new Se(w.x+(l-w.y)/(E.y-w.y)*(E.x-w.x),l)._round()),v&&w.equals(v[v.length-1])||(v=[w],u.push(v)),v.push(E)))))}}return u}function ET(t){let e=0,r=0;for(const f of t)e+=f.w*f.h,r=Math.max(r,f.w);t.sort((f,_)=>_.h-f.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let l=0,u=0;for(const f of t)for(let _=s.length-1;_>=0;_--){const v=s[_];if(!(f.w>v.w||f.h>v.h)){if(f.x=v.x,f.y=v.y,u=Math.max(u,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===v.w&&f.h===v.h){const x=s.pop();_<s.length&&(s[_]=x)}else f.h===v.h?(v.x+=f.w,v.w-=f.w):f.w===v.w?(v.y+=f.h,v.h-=f.h):(s.push({x:v.x+f.w,y:v.y,w:v.w-f.w,h:f.h}),v.y+=f.h,v.h-=f.h);break}}return{w:l,h:u,fill:e/(l*u)||0}}qt(Ga,"Anchor");const Is=1;class Hv{constructor(e,{pixelRatio:r,version:s,stretchX:l,stretchY:u,content:f}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=l,this.stretchY=u,this.content=f,this.version=s}get tl(){return[this.paddedRect.x+Is,this.paddedRect.y+Is]}get br(){return[this.paddedRect.x+this.paddedRect.w-Is,this.paddedRect.y+this.paddedRect.h-Is]}get displaySize(){return[(this.paddedRect.w-2*Is)/this.pixelRatio,(this.paddedRect.h-2*Is)/this.pixelRatio]}}class AT{constructor(e,r){const s={},l={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,s,u),this.addImages(r,l,u);const{w:f,h:_}=ET(u),v=new Hs({width:f||1,height:_||1});for(const x in e){const w=e[x],E=s[x].paddedRect;Hs.copy(w.data,v,{x:0,y:0},{x:E.x+Is,y:E.y+Is},w.data,w.sdf)}for(const x in r){const w=r[x],E=l[x].paddedRect,I=E.x+Is,L=E.y+Is,O=w.data.width,z=w.data.height;Hs.copy(w.data,v,{x:0,y:0},{x:I,y:L},w.data),Hs.copy(w.data,v,{x:0,y:z-1},{x:I,y:L-1},{width:O,height:1}),Hs.copy(w.data,v,{x:0,y:0},{x:I,y:L+z},{width:O,height:1}),Hs.copy(w.data,v,{x:O-1,y:0},{x:I-1,y:L},{width:1,height:z}),Hs.copy(w.data,v,{x:0,y:0},{x:I+O,y:L},{width:1,height:z})}this.image=v,this.iconPositions=s,this.patternPositions=l}addImages(e,r,s){for(const l in e){const u=e[l],f={x:0,y:0,w:u.data.width+2*Is,h:u.data.height+2*Is};s.push(f),r[l]=new Hv(f,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,r,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const l in e.getUpdatedImages(s))this.patchUpdatedImage(this.iconPositions[l],e.getImage(l,s),r),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l,s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[l,u]=e.tl,f=!!Object.keys(this.patternPositions).length;s.update(r.data,{useMipmap:f},{x:l,y:u})}}qt(Hv,"ImagePosition"),qt(AT,"ImageAtlas");const np=1e20;function IT(t,e,r,s,l,u,f,_,v){for(let x=e;x<e+s;x++)CT(t,r*u+x,u,l,f,_,v);for(let x=r;x<r+l;x++)CT(t,x*u+e,1,s,f,_,v)}function CT(t,e,r,s,l,u,f){u[0]=0,f[0]=-np,f[1]=np,l[0]=t[e];for(let _=1,v=0,x=0;_<s;_++){l[_]=t[e+_*r];const w=_*_;do{const E=u[v];x=(l[_]-l[E]+w-E*E)/(_-E)/2}while(x<=f[v]&&--v>-1);v++,u[v]=_,f[v]=x,f[v+1]=np}for(let _=0,v=0;_<s;_++){for(;f[v+1]<_;)v++;const x=u[v],w=_-x;t[e+_*r]=l[x]+w*w}}const Io=2,qv={none:0,ideographs:1,all:2};class Ah{constructor(e,r,s){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,s){const l=[],u=this.urls[r]||H.GLYPHS_URL;for(const f in e)for(const _ of e[f])l.push({stack:f,id:_});zr(l,({stack:f,id:_},v)=>{let x=this.entries[f];x||(x=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=x.glyphs[_];if(w!==void 0)return void v(null,{stack:f,id:_,glyph:w});if(w=this._tinySDF(x,f,_),w)return x.glyphs[_]=w,void v(null,{stack:f,id:_,glyph:w});const E=Math.floor(_/256);if(256*E>65535)return void v(new Error("glyphs > 65535 not supported"));if(x.ranges[E])return void v(null,{stack:f,id:_,glyph:w});let I=x.requests[E];I||(I=x.requests[E]=[],Ah.loadGlyphRange(f,E,u,this.requestManager,(L,O)=>{if(O){x.ascender=O.ascender,x.descender=O.descender;for(const z in O.glyphs)this._doesCharSupportLocalGlyph(+z)||(x.glyphs[+z]=O.glyphs[+z]);x.ranges[E]=!0}for(const z of I)z(L,O);delete x.requests[E]})),I.push((L,O)=>{L?v(L):O&&v(null,{stack:f,id:_,glyph:O.glyphs[_]||null})})},(f,_)=>{if(f)s(f);else if(_){const v={};for(const{stack:x,id:w,glyph:E}of _)v[x]===void 0&&(v[x]={}),v[x].glyphs===void 0&&(v[x].glyphs={}),v[x].glyphs[w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},v[x].ascender=this.entries[x].ascender,v[x].descender=this.entries[x].descender;s(null,v)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==qv.none&&(this.localGlyphMode===qv.all?!!this.localFontFamily:!!this.localFontFamily&&(er["CJK Unified Ideographs"](e)||er["Hangul Syllables"](e)||er.Hiragana(e)||er.Katakana(e)||er["CJK Symbols and Punctuation"](e)||er["CJK Unified Ideographs Extension A"](e)||er["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,r,s){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(s))return;let u=e.tinySDF;if(!u){let z="400";/bold/i.test(r)?z="900":/medium/i.test(r)?z="500":/light/i.test(r)&&(z="200"),u=e.tinySDF=new Ah.TinySDF({fontFamily:l,fontWeight:z,fontSize:24*Io,buffer:3*Io,radius:8*Io}),u.fontWeight=z}if(this.localGlyphs[u.fontWeight][s])return this.localGlyphs[u.fontWeight][s];const f=String.fromCodePoint(s),{data:_,width:v,height:x,glyphWidth:w,glyphHeight:E,glyphLeft:I,glyphTop:L,glyphAdvance:O}=u.draw(f);return this.localGlyphs[u.fontWeight][s]={id:s,bitmap:new Rl({width:v,height:x},_),metrics:{width:w/Io,height:E/Io,left:I/Io,top:L/Io-27,advance:O/Io,localGlyph:!0}}}}Ah.loadGlyphRange=function(t,e,r,s,l){const u=256*e,f=u+255,_=s.transformRequest(s.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${u}-${f}`),Ci.Glyphs);Ye(_,(v,x)=>{if(v)l(v);else if(x){const w={},E=function(I){return new Mh(I).readFields(eR,{})}(x);for(const I of E.glyphs)w[I.id]=I;l(null,{glyphs:w,ascender:E.ascender,descender:E.descender})}})},Ah.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:s=.25,fontFamily:l="sans-serif",fontWeight:u="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=r;const _=this.size=t+4*e,v=this._createCanvas(_),x=this.ctx=v.getContext("2d",{willReadFrequently:!0});x.font=`${f} ${u} ${t}px ${l}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:s,actualBoundingBoxLeft:l,actualBoundingBoxRight:u}=this.ctx.measureText(t),f=Math.ceil(r),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-l))),v=Math.min(this.size-this.buffer,f+Math.ceil(s)),x=_+2*this.buffer,w=v+2*this.buffer,E=Math.max(x*w,0),I=new Uint8ClampedArray(E),L={data:I,width:x,height:w,glyphWidth:_,glyphHeight:v,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(_===0||v===0)return L;const{ctx:O,buffer:z,gridInner:V,gridOuter:j}=this;O.clearRect(z,z,_,v),O.fillText(t,z,z+f);const K=O.getImageData(z,z,_,v);j.fill(np,0,E),V.fill(0,0,E);for(let ee=0;ee<v;ee++)for(let Q=0;Q<_;Q++){const le=K.data[4*(ee*_+Q)+3]/255;if(le===0)continue;const ae=(ee+z)*x+Q+z;if(le===1)j[ae]=0,V[ae]=np;else{const fe=.5-le;j[ae]=fe>0?fe*fe:0,V[ae]=fe<0?fe*fe:0}}IT(j,0,0,x,w,x,this.f,this.v,this.z),IT(V,z,z,_,v,x,this.f,this.v,this.z);for(let ee=0;ee<E;ee++){const Q=Math.sqrt(j[ee])-Math.sqrt(V[ee]);I[ee]=Math.round(255-255*(Q/this.radius+this.cutoff))}return L}};const zl=Is;function PT(t,e,r,s){const l=[],u=t.imagePrimary,f=u.pixelRatio,_=u.paddedRect.w-2*zl,v=u.paddedRect.h-2*zl,x=t.right-t.left,w=t.bottom-t.top,E=u.stretchX||[[0,_]],I=u.stretchY||[[0,v]],L=(Te,je)=>Te+je[1]-je[0],O=E.reduce(L,0),z=I.reduce(L,0),V=_-O,j=v-z;let K=0,ee=O,Q=0,le=z,ae=0,fe=V,ve=0,we=j;if(u.content&&s){const Te=u.content;K=k_(E,0,Te[0]),Q=k_(I,0,Te[1]),ee=k_(E,Te[0],Te[2]),le=k_(I,Te[1],Te[3]),ae=Te[0]-K,ve=Te[1]-Q,fe=Te[2]-Te[0]-ee,we=Te[3]-Te[1]-le}const Le=(Te,je,Ke,Be)=>{const Xe=O_(Te.stretch-K,ee,x,t.left),ze=z_(Te.fixed-ae,fe,Te.stretch,O),Ze=O_(je.stretch-Q,le,w,t.top),St=z_(je.fixed-ve,we,je.stretch,z),et=O_(Ke.stretch-K,ee,x,t.left),Jt=z_(Ke.fixed-ae,fe,Ke.stretch,O),Vt=O_(Be.stretch-Q,le,w,t.top),ot=z_(Be.fixed-ve,we,Be.stretch,z),vr=new Se(Xe,Ze),or=new Se(et,Ze),Zt=new Se(et,Vt),at=new Se(Xe,Vt),fr=new Se(ze/f,St/f),Br=new Se(Jt/f,ot/f),wr=e*Math.PI/180;if(wr){const un=Math.sin(wr),fn=Math.cos(wr),yn=[fn,-un,un,fn];vr._matMult(yn),or._matMult(yn),at._matMult(yn),Zt._matMult(yn)}const Nr=Te.stretch+Te.fixed,Ar=Ke.stretch+Ke.fixed,tn=je.stretch+je.fixed,Pr=Be.stretch+Be.fixed,Pn=t.imageSecondary;return{tl:vr,tr:or,bl:at,br:Zt,texPrimary:{x:u.paddedRect.x+zl+Nr,y:u.paddedRect.y+zl+tn,w:Ar-Nr,h:Pr-tn},texSecondary:Pn?{x:Pn.paddedRect.x+zl+Nr,y:Pn.paddedRect.y+zl+tn,w:Ar-Nr,h:Pr-tn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fr,pixelOffsetBR:Br,minFontScaleX:fe/f/x,minFontScaleY:we/f/w,isSDF:r}};if(s&&(u.stretchX||u.stretchY)){const Te=DT(E,V,O),je=DT(I,j,z);for(let Ke=0;Ke<Te.length-1;Ke++){const Be=Te[Ke],Xe=Te[Ke+1];for(let ze=0;ze<je.length-1;ze++)l.push(Le(Be,je[ze],Xe,je[ze+1]))}}else l.push(Le({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:v+1}));return l}function k_(t,e,r){let s=0;for(const l of t)s+=Math.max(e,Math.min(r,l[1]))-Math.max(e,Math.min(r,l[0]));return s}function DT(t,e,r){const s=[{fixed:-zl,stretch:0}];for(const[l,u]of t){const f=s[s.length-1];s.push({fixed:l-f.stretch,stretch:f.stretch}),s.push({fixed:l-f.stretch,stretch:f.stretch+(u-l)})}return s.push({fixed:e+zl,stretch:r}),s}function O_(t,e,r,s){return t/e*r+s}function z_(t,e,r,s){return t-e*r/s}function lR(t,e,r,s){const l=e+t.positionedLines[s].lineOffset;return s===0?r+l/2:r+(l+(e+t.positionedLines[s-1].lineOffset))/2}function cR(t,e=1,r=!1){let s=1/0,l=1/0,u=-1/0,f=-1/0;const _=t[0];for(let L=0;L<_.length;L++){const O=_[L];(!L||O.x<s)&&(s=O.x),(!L||O.y<l)&&(l=O.y),(!L||O.x>u)&&(u=O.x),(!L||O.y>f)&&(f=O.y)}const v=Math.min(u-s,f-l);let x=v/2;const w=new As([],uR);if(v===0)return new Se(s,l);for(let L=s;L<u;L+=v)for(let O=l;O<f;O+=v)w.push(new Ih(L+x,O+x,x,t));let E=function(L){let O=0,z=0,V=0;const j=L[0];for(let K=0,ee=j.length,Q=ee-1;K<ee;Q=K++){const le=j[K],ae=j[Q],fe=le.x*ae.y-ae.x*le.y;z+=(le.x+ae.x)*fe,V+=(le.y+ae.y)*fe,O+=3*fe}return new Ih(z/O,V/O,0,L)}(t),I=w.length;for(;w.length;){const L=w.pop();(L.d>E.d||!E.d)&&(E=L,r&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,I)),L.max-E.d<=e||(x=L.h/2,w.push(new Ih(L.p.x-x,L.p.y-x,x,t)),w.push(new Ih(L.p.x+x,L.p.y-x,x,t)),w.push(new Ih(L.p.x-x,L.p.y+x,x,t)),w.push(new Ih(L.p.x+x,L.p.y+x,x,t)),I+=4)}return r&&(console.log(`num probes: ${I}`),console.log(`best distance: ${E.d}`)),E.p}function uR(t,e){return e.max-t.max}class Ih{constructor(e,r,s,l){this.p=new Se(e,r),this.h=s,this.d=function(u,f){let _=!1,v=1/0;for(let x=0;x<f.length;x++){const w=f[x];for(let E=0,I=w.length,L=I-1;E<I;L=E++){const O=w[E],z=w[L];O.y>u.y!=z.y>u.y&&u.x<(z.x-O.x)*(u.y-O.y)/(z.y-O.y)+O.x&&(_=!_),v=Math.min(v,Pl(u,O,z))}}return(_?1:-1)*Math.sqrt(v)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const Wv=Number.POSITIVE_INFINITY,hR=Math.sqrt(2);function LT(t,[e,r]){let s=0,l=0;if(r===Wv){e<0&&(e=0);const u=e/hR;switch(t){case"top-right":case"top-left":l=u-7;break;case"bottom-right":case"bottom-left":l=7-u;break;case"bottom":l=7-e;break;case"top":l=e-7}switch(t){case"top-right":case"bottom-right":s=-u;break;case"top-left":case"bottom-left":s=u;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":l=r-7;break;case"bottom-right":case"bottom-left":case"bottom":l=7-r}switch(t){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,l]}function Yv(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dR(t,e,r,s,l,u,f,_,v,x,w,E,I,L,O){let z=u.textMaxSize.evaluate(e,{},E);z===void 0&&(z=f);const V=t.layers[0].layout,j=V.get("icon-offset").evaluate(e,{},E),K=kT(r.horizontal)||r.vertical,ee=I.name==="globe",Q=Hi,le=f/Q,ae=t.tilePixelRatio*z/Q,fe=(Xe=t.overscaling,t.zoom>18&&Xe>2&&(Xe>>=1),Math.max(kt/(512*Xe),1)*V.get("symbol-spacing")),ve=V.get("text-padding")*t.tilePixelRatio,we=V.get("icon-padding")*t.tilePixelRatio,Le=Ve(V.get("text-max-angle")),Te=V.get("text-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",je=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Ke=V.get("symbol-placement"),Be=fe/2;var Xe;const ze=V.get("icon-text-fit").evaluate(e,{},E),Ze=V.get("icon-text-fit-padding").evaluate(e,{},E),St=ze!=="none";let et;t.hasAnyIconTextFit===!1&&St&&(t.hasAnyIconTextFit=!0),s&&St&&(t.allowVerticalPlacement&&r.vertical&&(et=vT(s,r.vertical,ze,Ze,j,le)),K&&(s=vT(s,K,ze,Ze,j,le)));const Jt=(Vt,ot,vr)=>{if(ot.x<0||ot.x>=kt||ot.y<0||ot.y>=kt)return;let or=null;if(ee){const{x:Zt,y:at,z:fr}=I.projectTilePoint(ot.x,ot.y,vr);or={anchor:new Ga(Zt,at,fr,0,void 0),up:I.upVector(vr,ot.x,ot.y)}}(function(Zt,at,fr,Br,wr,Nr,Ar,tn,Pr,Pn,un,fn,yn,hn,qn,Sn,ii,xi,Ui,Un,Jn,Li,Ri,ki,On,Cs,Ul){const us=Zt.addToLineVertexArray(at,Br);let ts,Ys,vp,ng,kS,OS,zS,FS=0,BS=0,NS=0,VS=0,y0=-1,v0=-1;const aa={};let $S=jf("");const du=fr?fr.anchor:at,x0=Pr.layout.get("icon-text-fit").evaluate(Jn,{},On)!=="none";let b0=0,w0=0;if(Pr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[b0,w0]=Pr.layout.get("text-offset").evaluate(Jn,{},On).map(Ps=>Ps*Hi):(b0=Pr.layout.get("text-radial-offset").evaluate(Jn,{},On)*Hi,w0=Wv),Zt.allowVerticalPlacement&&wr.vertical){const Ps=wr.vertical;if(qn)OS=Zv(Ps),tn&&(zS=Zv(tn));else{const Ds=Pr.layout.get("text-rotate").evaluate(Jn,{},On)+90;vp=F_(Pn,du,at,un,fn,yn,Ps,hn,Ds,Sn),tn&&(ng=F_(Pn,du,at,un,fn,yn,tn,xi,Ds))}}if(Nr){const Ps=Pr.layout.get("icon-rotate").evaluate(Jn,{},On),Ds=PT(Nr,Ps,Ri,x0),zh=tn?PT(tn,Ps,Ri,x0):void 0;Ys=F_(Pn,du,at,un,fn,yn,Nr,xi,Ps),FS=4*Ds.length;const US=Zt.iconSizeData;let fu=null;US.kind==="source"?(fu=[Ao*Pr.layout.get("icon-size").evaluate(Jn,{},On)],fu[0]>Fl&&ye(`${Zt.layerIds[0]}: Value for "icon-size" is >= ${ip}. Reduce your "icon-size".`)):US.kind==="composite"&&(fu=[Ao*Li.compositeIconSizes[0].evaluate(Jn,{},On),Ao*Li.compositeIconSizes[1].evaluate(Jn,{},On)],(fu[0]>Fl||fu[1]>Fl)&&ye(`${Zt.layerIds[0]}: Value for "icon-size" is >= ${ip}. Reduce your "icon-size".`)),Zt.addSymbols(Zt.icon,Ds,fu,Un,Ui,Jn,!1,fr,at,us.lineStartIndex,us.lineLength,-1,ki,On,Cs,Ul),y0=Zt.icon.placedSymbolArray.length-1,zh&&(BS=4*zh.length,Zt.addSymbols(Zt.icon,zh,fu,Un,Ui,Jn,qs.vertical,fr,at,us.lineStartIndex,us.lineLength,-1,ki,On,Cs,Ul),v0=Zt.icon.placedSymbolArray.length-1)}for(const Ps in wr.horizontal){const Ds=wr.horizontal[Ps];ts||($S=jf(Ds.text),qn?kS=Zv(Ds):ts=F_(Pn,du,at,un,fn,yn,Ds,hn,Pr.layout.get("text-rotate").evaluate(Jn,{},On),Sn));const zh=Ds.positionedLines.length===1;if(NS+=RT(Zt,fr,at,Ds,Ar,Pr,qn,Jn,Sn,us,wr.vertical?qs.horizontal:qs.horizontalOnly,zh?Object.keys(wr.horizontal):[Ps],aa,y0,Li,ki,On,Cs),zh)break}wr.vertical&&(VS+=RT(Zt,fr,at,wr.vertical,Ar,Pr,qn,Jn,Sn,us,qs.vertical,["vertical"],aa,v0,Li,ki,On,Cs));let jl=-1;const T0=(Ps,Ds)=>Ps?Math.max(Ps,Ds):Ds;jl=T0(kS,jl),jl=T0(OS,jl),jl=T0(zS,jl);const Pk=jl>-1?1:0;Zt.glyphOffsetArray.length>=65535&&ye("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Jn.sortKey!==void 0&&Zt.addToSortKeyRanges(Zt.symbolInstances.length,Jn.sortKey),Zt.symbolInstances.emplaceBack(at.x,at.y,du.x,du.y,du.z,aa.right>=0?aa.right:-1,aa.center>=0?aa.center:-1,aa.left>=0?aa.left:-1,aa.vertical>=0?aa.vertical:-1,y0,v0,$S,ts!==void 0?ts:Zt.collisionBoxArray.length,ts!==void 0?ts+1:Zt.collisionBoxArray.length,vp!==void 0?vp:Zt.collisionBoxArray.length,vp!==void 0?vp+1:Zt.collisionBoxArray.length,Ys!==void 0?Ys:Zt.collisionBoxArray.length,Ys!==void 0?Ys+1:Zt.collisionBoxArray.length,ng||Zt.collisionBoxArray.length,ng?ng+1:Zt.collisionBoxArray.length,un,NS,VS,FS,BS,Pk,0,b0,w0,jl,0,x0?1:0)})(t,ot,or,Vt,r,s,l,et,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ve,Te,v,0,we,je,j,e,u,x,w,E,L,O)};if(Ke==="line")for(const Vt of MT(e.geometry,0,0,kt,kt)){const ot=aR(Vt,fe,Le,r.vertical||K,s,Q,ae,t.overscaling,kt);for(const vr of ot)K&&fR(t,K.text,Be,vr)||Jt(Vt,vr,E)}else if(Ke==="line-center"){for(const Vt of e.geometry)if(Vt.length>1){const ot=oR(Vt,Le,r.vertical||K,s,Q,ae);ot&&Jt(Vt,ot,E)}}else if(e.type==="Polygon")for(const Vt of Rv(e.geometry,0)){const ot=cR(Vt,16);Jt(Vt[0],new Ga(ot.x,ot.y,0,0,void 0),E)}else if(e.type==="LineString")for(const Vt of e.geometry)Jt(Vt,new Ga(Vt[0].x,Vt[0].y,0,0,void 0),E);else if(e.type==="Point")for(const Vt of e.geometry)for(const ot of Vt)Jt([ot],new Ga(ot.x,ot.y,0,0,void 0),E)}const ip=255,Fl=ip*Ao;function RT(t,e,r,s,l,u,f,_,v,x,w,E,I,L,O,z,V,j){const K=function(le,ae,fe,ve,we,Le,Te,je){const Ke=[];if(ae.positionedLines.length===0)return Ke;const Be=ve.layout.get("text-rotate").evaluate(Le,{})*Math.PI/180,Xe=function(Jt){const Vt=Jt[0],ot=Jt[1],vr=Vt*ot;return vr>0?[Vt,-ot]:vr<0?[-Vt,ot]:Vt===0?[ot,Vt]:[ot,-Vt]}(fe);let ze=Math.abs(ae.top-ae.bottom);for(const Jt of ae.positionedLines)ze-=Jt.lineOffset;const Ze=ae.positionedLines.length,St=ze/Ze;let et=ae.top-fe[1];for(let Jt=0;Jt<Ze;++Jt){const Vt=ae.positionedLines[Jt];et=lR(ae,St,et,Jt);for(const ot of Vt.positionedGlyphs){if(!ot.rect)continue;const vr=ot.rect||{};let or=fT+1,Zt=!0,at=1,fr=0;if(ot.imageName){const Un=Te[ot.imageName];if(!Un)continue;if(Un.sdf){ye("SDF images are not supported in formatted text and will be ignored.");continue}Zt=!1,at=Un.pixelRatio,or=Is/at}const Br=(we||je)&&ot.vertical,wr=ot.metrics.advance*ot.scale/2,Nr=ot.metrics,Ar=ot.rect;if(Ar===null)continue;je&&ae.verticalizable&&(fr=ot.imageName?wr-ot.metrics.width*ot.scale/2:0);const tn=we?[ot.x+wr,ot.y]:[0,0];let Pr=[0,0],Pn=[0,0],un=!1;we||(Br?(Pn=[ot.x+wr+Xe[0],ot.y+Xe[1]-fr],un=!0):Pr=[ot.x+wr+fe[0],ot.y+fe[1]-fr]);const fn=Ar.w*ot.scale/(at*(ot.localGlyph?Io:1)),yn=Ar.h*ot.scale/(at*(ot.localGlyph?Io:1));let hn,qn,Sn,ii;if(Br){const Un=ot.y-et,Jn=new Se(-wr,wr-Un),Li=-Math.PI/2,Ri=new Se(...Pn);hn=new Se(-wr+Pr[0],Pr[1]),hn._rotateAround(Li,Jn)._add(Ri),hn.x+=-Un+wr,hn.y-=(Nr.left-or)*ot.scale;const ki=ot.imageName?Nr.advance*ot.scale:Hi*ot.scale,On=String.fromCodePoint(ot.glyph);UL(On)?hn.x+=(1-or)*ot.scale:jL(On)?hn.x+=ki-Nr.height*ot.scale+(-or-1)*ot.scale:hn.x+=ot.imageName||Nr.width+2*or===Ar.w&&Nr.height+2*or===Ar.h?(ki-yn)/2:(ki-(Nr.height+2*or)*ot.scale)/2,qn=new Se(hn.x,hn.y-fn),Sn=new Se(hn.x+yn,hn.y),ii=new Se(hn.x+yn,hn.y-fn)}else{const Un=(Nr.left-or)*ot.scale-wr+Pr[0],Jn=(-Nr.top-or)*ot.scale+Pr[1],Li=Un+fn,Ri=Jn+yn;hn=new Se(Un,Jn),qn=new Se(Li,Jn),Sn=new Se(Un,Ri),ii=new Se(Li,Ri)}if(Be){let Un;Un=we?new Se(0,0):un?new Se(Xe[0],Xe[1]):new Se(fe[0],fe[1]),hn._rotateAround(Be,Un),qn._rotateAround(Be,Un),Sn._rotateAround(Be,Un),ii._rotateAround(Be,Un)}const xi=new Se(0,0),Ui=new Se(0,0);Ke.push({tl:hn,tr:qn,bl:Sn,br:ii,texPrimary:vr,texSecondary:void 0,writingMode:ae.writingMode,glyphOffset:tn,sectionIndex:ot.sectionIndex,isSDF:Zt,pixelOffsetTL:xi,pixelOffsetBR:Ui,minFontScaleX:0,minFontScaleY:0})}}return Ke}(0,s,v,u,f,_,l,t.allowVerticalPlacement),ee=t.textSizeData;let Q=null;ee.kind==="source"?(Q=[Ao*u.layout.get("text-size").evaluate(_,{},V)],Q[0]>Fl&&ye(`${t.layerIds[0]}: Value for "text-size" is >= ${ip}. Reduce your "text-size".`)):ee.kind==="composite"&&(Q=[Ao*O.compositeTextSizes[0].evaluate(_,{},V),Ao*O.compositeTextSizes[1].evaluate(_,{},V)],(Q[0]>Fl||Q[1]>Fl)&&ye(`${t.layerIds[0]}: Value for "text-size" is >= ${ip}. Reduce your "text-size".`)),t.addSymbols(t.text,K,Q,v,f,_,w,e,r,x.lineStartIndex,x.lineLength,L,z,V,j,!1);for(const le of E)I[le]=t.text.placedSymbolArray.length-1;return 4*K.length}function kT(t){for(const e in t)return t[e];return null}function F_(t,e,r,s,l,u,f,_,v,x){let w=f.top,E=f.bottom,I=f.left,L=f.right;const O=f.collisionPadding;if(O&&(I-=O[0],w-=O[1],L+=O[2],E+=O[3]),v){const z=new Se(I,w),V=new Se(L,w),j=new Se(I,E),K=new Se(L,E),ee=Ve(v);let Q=new Se(0,0);x&&(Q=new Se(x[0],x[1])),z._rotateAround(ee,Q),V._rotateAround(ee,Q),j._rotateAround(ee,Q),K._rotateAround(ee,Q),I=Math.min(z.x,V.x,j.x,K.x),L=Math.max(z.x,V.x,j.x,K.x),w=Math.min(z.y,V.y,j.y,K.y),E=Math.max(z.y,V.y,j.y,K.y)}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,I,w,L,E,_,s,l,u),t.length-1}function Zv(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function fR(t,e,r,s){const l=t.compareText;if(e in l){const u=l[e];for(let f=u.length-1;f>=0;f--)if(s.dist(u[f])<r)return!0}else l[e]=[];return l[e].push(s),!1}function OT(t,e){const r=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,l=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),u=Math.sin(r)*l/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01)),f=Math.sin(t._pitch)*u+l;return Math.min(1.01*f,l*(1/t._horizonShift))}function sp(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const r=Math.pow(2,-t.z),s=t.x*r,l=(t.x+1)*r,u=t.y*r,f=(t.y+1)*r,_=Ir(s),v=Ir(l),x=nn(u),w=nn(f),E=e.project(_,x),I=e.project(v,x),L=e.project(v,w),O=e.project(_,w);let z=Math.min(E.x,I.x,L.x,O.x),V=Math.min(E.y,I.y,L.y,O.y),j=Math.max(E.x,I.x,L.x,O.x),K=Math.max(E.y,I.y,L.y,O.y);const ee=r/16;function Q(ae,fe,ve,we,Le,Te){const je=(ve+Le)/2,Ke=(we+Te)/2,Be=e.project(Ir(je),nn(Ke)),Xe=Math.max(0,z-Be.x,V-Be.y,Be.x-j,Be.y-K);z=Math.min(z,Be.x),j=Math.max(j,Be.x),V=Math.min(V,Be.y),K=Math.max(K,Be.y),Xe>ee&&(Q(ae,Be,ve,we,je,Ke),Q(Be,fe,je,Ke,Le,Te))}Q(E,I,s,u,l,u),Q(I,L,l,u,l,f),Q(L,O,l,f,s,f),Q(O,E,s,f,s,u),z-=ee,V-=ee,j+=ee,K+=ee;const le=1/Math.max(j-z,K-V);return{scale:le,x:z*le,y:V*le,x2:j*le,y2:K*le,projection:e}}function zT(t,{x:e,y:r},s=0){return new Se(((e-s)*t.scale-t.x)*kt,(r*t.scale-t.y)*kt)}const pR=o.a6.identity(new Float32Array(16));class Bl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new be(0,0)}projectTilePoint(e,r,s){return{x:e,y:r,z:0}}locationPoint(e,r,s=!0){return e._coordinatePoint(e.locationCoordinate(r),s)}pixelsPerMeter(e,r){return Cr(1,e)*r}pixelSpaceConversion(e,r,s){return 1}farthestPixelDistance(e){return OT(e,e.pixelsPerMeter)}pointCoordinate(e,r,s,l){const u=e.horizonLineFromTop(!1),f=new Se(r,Math.max(u,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,l))}pointCoordinate3D(e,r,s){const l=new Se(r,s);if(e.elevation)return e.elevation.pointCoordinate(l);{const u=this.pointCoordinate(e,l.x,l.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const s=e.horizonLineFromTop();return r.y<s}createInversionMatrix(e,r){return pR}createTileMatrix(e,r,s){let l,u,f;const _=s.canonical,v=o.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const x=sp(_,this);l=1,u=x.x+s.wrap*x.scale,f=x.y,o.a6.scale(v,v,[l/x.scale,l/x.scale,e.pixelsPerMeter/r])}else l=r/e.zoomScale(_.z),u=(_.x+Math.pow(2,_.z)*s.wrap)*l,f=_.y*l;return o.a6.translate(v,v,[u,f,0]),o.a6.scale(v,v,[l/kt,l/kt,1]),v}upVector(e,r,s){return[0,0,1]}upVectorScale(e,r,s){return{metersToTile:1}}}class mR extends Bl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,s]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(Ve(r));this.n=(l+Math.sin(Ve(s)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:s,c:l,r0:u}=this,f=Ve(e-this.center[0]),_=Ve(r),v=Math.sqrt(l-2*s*Math.sin(_))/s;return{x:v*Math.sin(f*s),y:v*Math.cos(f*s)-u,z:0}}unproject(e,r){const{n:s,c:l,r0:u}=this,f=u+r;let _=Math.atan2(e,Math.abs(f))*Math.sign(f);f*s<0&&(_-=Math.PI*Math.sign(e)*Math.sign(f));const v=Ve(this.center[0])*s;_=Ft(_,-Math.PI-v,Math.PI-v);const x=zt(jt(_/s)+this.center[0],-180,180),w=Math.asin(zt((l-(e*e+f*f)*s*s)/(2*s),-1,1)),E=zt(jt(w),-qr,qr);return new be(x,E)}}const op=1.340264,ap=-.081106,lp=893e-6,cp=.003796,B_=Math.sqrt(3)/2;class _R extends Bl{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(B_*Math.sin(r)),l=s*s,u=l*l*l;return{x:.5*(e*Math.cos(s)/(B_*(op+3*ap*l+u*(7*lp+9*cp*l)))/Math.PI+.5),y:1-.5*(s*(op+ap*l+u*(lp+cp*l))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,l=s*s,u=l*l*l;for(let w,E,I,L=0;L<12&&(E=s*(op+ap*l+u*(lp+cp*l))-r,I=op+3*ap*l+u*(7*lp+9*cp*l),w=E/I,s=zt(s-w,-Math.PI/3,Math.PI/3),l=s*s,u=l*l*l,!(Math.abs(w)<1e-12));++L);const f=B_*e*(op+3*ap*l+u*(7*lp+9*cp*l))/Math.cos(s),_=Math.asin(Math.sin(s)/B_),v=zt(180*f/Math.PI,-180,180),x=zt(180*_/Math.PI,-qr,qr);return new be(v,x)}}class gR extends Bl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const s=360*(e-.5),l=zt(360*(.5-r),-qr,qr);return new be(s,l)}}const Ch=Math.PI/2;function N_(t){return Math.tan((Ch+t)/2)}class yR extends Bl{constructor(e){super(e),this.center=e.center||[0,30];const[r,s]=this.parallels=e.parallels||[30,30];let l=Ve(r),u=Ve(s);this.southernCenter=l+u<0,this.southernCenter&&(l=-l,u=-u);const f=Math.cos(l),_=N_(l);this.n=l===u?Math.sin(l):Math.log(f/Math.cos(u))/Math.log(N_(u)/_),this.f=f*Math.pow(N_(l),this.n)/this.n}project(e,r){r=Ve(r),this.southernCenter&&(r=-r),e=Ve(e-this.center[0]);const s=1e-6,{n:l,f:u}=this;u>0?r<-Ch+s&&(r=-Ch+s):r>Ch-s&&(r=Ch-s);const f=u/Math.pow(N_(r),l);let _=f*Math.sin(l*e),v=u-f*Math.cos(l*e);return _=.5*(_/Math.PI+.5),v=.5*(v/Math.PI+.5),{x:_,y:this.southernCenter?v:1-v,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:s,f:l}=this,u=l-r,f=Math.sign(u),_=Math.sign(s)*Math.sqrt(e*e+u*u);let v=Math.atan2(e,Math.abs(u))*f;u*s<0&&(v-=Math.PI*Math.sign(e)*f);const x=zt(jt(v/s)+this.center[0],-180,180),w=zt(jt(2*Math.atan(Math.pow(l/_,1/s))-Ch),-qr,qr);return new be(x,this.southernCenter?-w:w)}}class FT extends Bl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:kr(e),y:Mr(r),z:0}}unproject(e,r){const s=Ir(e),l=nn(r);return new be(s,l)}}const BT=Ve(qr);class vR extends Bl{project(e,r){const s=(r=Ve(r))*r,l=s*s;return{x:.5*((e=Ve(e))*(.8707-.131979*s+l*(l*(.003971*s-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+s*(.015085+l*(.028874*s-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,l=25,u=0,f=s*s;do{f=s*s;const x=f*f;u=(s*(1.007226+f*(.015085+x*(.028874*f-.044475-.005916*x)))-r)/(1.007226+f*(.045255+x*(.259866*f-.311325-.005916*11*x))),s=zt(s-u,-BT,BT)}while(Math.abs(u)>1e-6&&--l>0);f=s*s;const _=zt(jt(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),v=jt(s);return new be(_,v)}}const NT=Ve(qr);class xR extends Bl{project(e,r){r=Ve(r),e=Ve(e);const s=Math.cos(r),l=2/Math.PI,u=Math.acos(s*Math.cos(e/2)),f=Math.sin(u)/u,_=.5*(e*l+2*s*Math.sin(e/2)/f)||0,v=.5*(r+Math.sin(r)/f)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}}unproject(e,r){let s=e=(2*e-.5)*Math.PI,l=r=(2*(1-r)-1)*Math.PI,u=25;const f=1e-6;let _=0,v=0;do{const x=Math.cos(l),w=Math.sin(l),E=2*w*x,I=w*w,L=x*x,O=Math.cos(s/2),z=Math.sin(s/2),V=2*O*z,j=z*z,K=1-L*O*O,ee=K?1/K:0,Q=K?Math.acos(x*O)*Math.sqrt(1/K):0,le=.5*(2*Q*x*z+2*s/Math.PI)-e,ae=.5*(Q*w+l)-r,fe=.5*ee*(L*j+Q*x*O*I)+1/Math.PI,ve=ee*(V*E/4-Q*w*z),we=.125*ee*(E*z-Q*w*L*V),Le=.5*ee*(I*O+Q*j*x)+.5,Te=ve*we-Le*fe;_=(ae*ve-le*Le)/Te,v=(le*we-ae*fe)/Te,s=zt(s-_,-Math.PI,Math.PI),l=zt(l-v,-NT,NT)}while((Math.abs(_)>f||Math.abs(v)>f)&&--u>0);return new be(jt(s),jt(l))}}class VT extends Bl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ve(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:s,cosPhi:l}=this;return{x:Ve(e)*l*s+.5,y:-Math.sin(Ve(r))/l*s+.5,z:0}}unproject(e,r){const{scale:s,cosPhi:l}=this,u=-(r-.5)/s,f=zt(jt((e-.5)/s)/l,-180,180),_=Math.asin(zt(u*l,-1,1)),v=zt(jt(_),-qr,qr);return new be(f,v)}}class bR extends FT{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,s){const l=Wf(e,r,s),u=g_(oa(s));return o.N.transformMat4(l,l,u),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,r){const s=Ne(r.lat,r.lng),l=o.N.normalize([],s),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude,f=Cr(1,0)*kt*u;o.N.scaleAndAdd(s,s,l,f);const _=o.a6.identity(new Float64Array(16));return o.a6.multiply(_,e.pixelMatrix,e.globeMatrix),o.N.transformMat4(s,s,_),new Se(s[0],s[1])}pixelsPerMeter(e,r){return Cr(1,0)*r}pixelSpaceConversion(e,r,s){const l=Cr(1,e)*r,u=en(Cr(1,45)*r,l,s);return this.pixelsPerMeter(e,r)/u}createTileMatrix(e,r,s){const l=Mv(oa(s.canonical));return o.a6.multiply(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,r){const{center:s}=e,l=g_(oa(r));return o.a6.rotateY(l,l,Ve(s.lng)),o.a6.rotateX(l,l,Ve(s.lat)),o.a6.scale(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,r,s,l){return nw(e,r,s,!0)||new ln(0,0)}pointCoordinate3D(e,r,s){const l=this.pointCoordinate(e,r,s,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,r){return!nw(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(l,u){const f=l.cameraToCenterDistance,_=l._centerAltitude*u,v=l._camera,x=l._camera.forward(),w=o.N.add([],o.N.scale([],x,-f),[0,0,_]),E=l.worldSize/(2*Math.PI),I=[0,0,-E],L=l.width/l.height,O=Math.tan(l.fovAboveCenter),z=o.N.scale([],v.up(),O),V=o.N.scale([],v.right(),O*L),j=o.N.normalize([],o.N.add([],o.N.add([],x,z),V)),K=[];let ee;if(new xv(w,j).closestPointOnSphere(I,E,K)){const Q=o.N.add([],K,I),le=o.N.sub([],Q,w);ee=Math.cos(l.fovAboveCenter)*o.N.length(le)}else{const Q=o.N.sub([],w,I),le=o.N.sub([],I,w);o.N.normalize(le,le);const ae=o.N.length(Q)-E;ee=Math.sqrt(ae*(ae+2*E));const fe=Math.acos(ee/(E+ae))-Math.acos(o.N.dot(x,le));ee*=Math.cos(fe)}return 1.01*ee}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Ll(e.zoom);if(s>0){const l=OT(e,Cr(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return en(r,l+u*(1-Math.cos(f)),Math.pow(s,10))}return r}upVector(e,r,s){return Wf(r,s,e,1)}upVectorScale(e){return{metersToTile:p_(__(oa(e)))}}}function $T(t){const e=t.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new FT(t);case"equirectangular":return new gR(t);case"naturalEarth":return new vR(t);case"equalEarth":return new _R(t);case"winkelTripel":return new xR(t);case"albers":return r?new VT(t):new mR(t);case"lambertConformalConic":return r?new VT(t):new yR(t);case"globe":return new bR(t)}throw new Error(`Invalid projection name: ${t.name}`)}const wR=S_.types,TR=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function V_(t,e,r,s,l,u,f,_,v,x,w,E,I){const L=_?Math.min(Fl,Math.round(_[0])):0,O=_?Math.min(Fl,Math.round(_[1])):0;t.emplaceBack(e,r,Math.round(32*s),Math.round(32*l),u,f,(L<<1)+(v?1:0),O,16*x,16*w,256*E,256*I)}function $_(t,e,r){t.emplaceBack(e,r)}function U_(t,e,r,s,l,u,f){t.emplaceBack(e,r,s,l,u,f)}function j_(t,e,r,s,l){t.emplaceBack(e,r,s,l),t.emplaceBack(e,r,s,l),t.emplaceBack(e,r,s,l),t.emplaceBack(e,r,s,l)}function SR(t){for(const e of t.sections)if(gf(e.text))return!0;return!1}class Xv{constructor(e){this.layoutVertexArray=new Wc,this.indexArray=new wi,this.programConfigurations=e,this.segments=new ni,this.dynamicLayoutVertexArray=new Qo,this.opacityVertexArray=new kf,this.placedSymbolArray=new Zm,this.iconTransitioningVertexArray=new Qs,this.globeExtVertexArray=new Rf,this.zOffsetVertexArray=new Zc}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,s,l,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,LL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,kL.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,TR,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,zL.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,RL.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,OL.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}qt(Xv,"SymbolBuffers");class Kv{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new ni,this.collisionVertexArray=new zf,this.collisionVertexArrayExt=new Qo}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,FL.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,BL.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}qt(Kv,"CollisionBuffers");class G_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=o.a6.identity([]),this.placementViewportMatrix=o.a6.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vv(this.zoom,r["text-size"]),this.iconSizeData=Vv(this.zoom,r["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),u=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(f=>qs[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=s.get("symbol-z-elevate")}createArrays(){this.text=new Xv(new q(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Xv(new q(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Jm,this.lineVertexArray=new Qc,this.symbolInstances=new Km}calculateGlyphDependencies(e,r,s,l,u){for(let f=0;f<e.length;f++){const _=e.codePointAt(f);if(_===void 0)break;if(r[_]=!0,l&&u&&_<=65535){const v=tp[e.charAt(f)];v&&(r[v.charCodeAt(0)]=!0)}}}populate(e,r,s,l){const u=this.layers[0],f=u.layout,_=this.projection.name==="globe",v=f.get("text-font"),x=f.get("text-field"),w=f.get("icon-image"),E=(x.value.kind!=="constant"||x.value.value instanceof Ni&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),I=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,L=f.get("symbol-sort-key");if(this.features=[],!E&&!I)return;const O=r.iconDependencies,z=r.glyphDependencies,V=r.availableImages,j=new Yn(this.zoom);for(const{feature:K,id:ee,index:Q,sourceLayerIndex:le}of e){const ae=u._featureFilter.needGeometry,fe=yi(K,ae);if(!u._featureFilter.filter(j,fe,s))continue;if(ae||(fe.geometry=Si(K,s,l)),_&&K.type!==1&&s.z<=5){const Te=fe.geometry,je=.98078528056,Ke=(Be,Xe)=>{const ze=Wf(Be.x,Be.y,s,1),Ze=Wf(Xe.x,Xe.y,s,1);return o.N.dot(ze,Ze)<je};for(let Be=0;Be<Te.length;Be++)Te[Be]=$i(Te[Be],Ke)}let ve,we;if(E){const Te=u.getValueAndResolveTokens("text-field",fe,s,V),je=Ni.factory(Te);SR(je)&&(this.hasRTLText=!0),(!this.hasRTLText||Jo()==="unavailable"||this.hasRTLText&&gs.isParsed())&&(ve=$L(je,u,fe))}if(I){const Te=u.getValueAndResolveTokens("icon-image",fe,s,V);we=Te instanceof mr?Te:mr.fromString(Te)}if(!ve&&!we)continue;const Le=this.sortFeaturesByKey?L.evaluate(fe,{},s):void 0;if(this.features.push({id:ee,text:ve,icon:we,index:Q,sourceLayerIndex:le,geometry:fe.geometry,properties:K.properties,type:wR[K.type],sortKey:Le}),we&&(O[we.namePrimary]=!0,we.nameSecondary&&(O[we.nameSecondary]=!0)),ve){const Te=v.evaluate(fe,{},s).join(","),je=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(qs.vertical)>=0;for(const Ke of ve.sections)if(Ke.image)O[Ke.image.namePrimary]=!0;else{const Be=Xo(ve.toString()),Xe=Ke.fontStack||Te,ze=z[Xe]=z[Xe]||{};this.calculateGlyphDependencies(Ke.text,ze,je,this.allowVerticalPlacement,Be)}}}f.get("symbol-placement")==="line"&&(this.features=function(K){const ee={},Q={},le=[];let ae=0;function fe(Te){le.push(K[Te]),ae++}function ve(Te,je,Ke){const Be=Q[Te];return delete Q[Te],Q[je]=Be,le[Be].geometry[0].pop(),le[Be].geometry[0]=le[Be].geometry[0].concat(Ke[0]),Be}function we(Te,je,Ke){const Be=ee[je];return delete ee[je],ee[Te]=Be,le[Be].geometry[0].shift(),le[Be].geometry[0]=Ke[0].concat(le[Be].geometry[0]),Be}function Le(Te,je,Ke){const Be=Ke?je[0][je[0].length-1]:je[0][0];return`${Te}:${Be.x}:${Be.y}`}for(let Te=0;Te<K.length;Te++){const je=K[Te],Ke=je.geometry,Be=je.text?je.text.toString():null;if(!Be){fe(Te);continue}const Xe=Le(Be,Ke),ze=Le(Be,Ke,!0);if(Xe in Q&&ze in ee&&Q[Xe]!==ee[ze]){const Ze=we(Xe,ze,Ke),St=ve(Xe,ze,le[Ze].geometry);delete ee[Xe],delete Q[ze],Q[Le(Be,le[St].geometry,!0)]=St,le[Ze].geometry=null}else Xe in Q?ve(Xe,ze,Ke):ze in ee?we(Xe,ze,Ke):(fe(Te),ee[Xe]=ae-1,Q[ze]=ae-1)}return le.filter(Te=>Te.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,ee)=>K.sortKey-ee.sortKey)}update(e,r,s,l,u){const f=Object.keys(e).length!==0;if(f&&!this.stateDependentLayers.length)return;const _=f?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,r,_,s,l,u),this.icon.programConfigurations.updatePaintArrays(e,r,_,s,l,u)}updateZOffset(){const e=(u,f,_)=>{s+=f,s>u.length&&u.resize(s);for(let v=-f;v<0;v++)u.emplace(v+s,_)},r=(u,f,_)=>{l+=f,l>u.length&&u.resize(l);for(let v=-f;v<0;v++)u.emplace(v+l,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,l=0;for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:v,numIconVertices:x}=f,w=f.zOffset,E=x>0;if((_>0||v>0)&&(e(this.text.zOffsetVertexArray,_,w),e(this.text.zOffsetVertexArray,v,w)),E){const{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:L}=f;I>=0&&r(this.icon.zOffsetVertexArray,x,w),L>=0&&r(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,w)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=$T(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:l,y:u}of r)this.lineVertexArray.emplaceBack(l,u);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,l,u,f,_,v,x,w,E,I,L,O,z,V){const j=e.indexArray,K=e.layoutVertexArray,ee=e.globeExtVertexArray,Q=e.segments.prepareSegment(4*r.length,K,j,this.canOverlap?f.sortKey:void 0),le=this.glyphOffsetArray.length,ae=Q.vertexLength,fe=this.allowVerticalPlacement&&_===qs.vertical?Math.PI/2:0,ve=f.text&&f.text.sections;for(let Le=0;Le<r.length;Le++){const{tl:Te,tr:je,bl:Ke,br:Be,texPrimary:Xe,texSecondary:ze,pixelOffsetTL:Ze,pixelOffsetBR:St,minFontScaleX:et,minFontScaleY:Jt,glyphOffset:Vt,isSDF:ot,sectionIndex:vr}=r[Le],or=Q.vertexLength,Zt=Vt[1];if(V_(K,x.x,x.y,Te.x,Zt+Te.y,Xe.x,Xe.y,s,ot,Ze.x,Ze.y,et,Jt),V_(K,x.x,x.y,je.x,Zt+je.y,Xe.x+Xe.w,Xe.y,s,ot,St.x,Ze.y,et,Jt),V_(K,x.x,x.y,Ke.x,Zt+Ke.y,Xe.x,Xe.y+Xe.h,s,ot,Ze.x,St.y,et,Jt),V_(K,x.x,x.y,Be.x,Zt+Be.y,Xe.x+Xe.w,Xe.y+Xe.h,s,ot,St.x,St.y,et,Jt),v){const{x:at,y:fr,z:Br}=v.anchor,[wr,Nr,Ar]=v.up;U_(ee,at,fr,Br,wr,Nr,Ar),U_(ee,at,fr,Br,wr,Nr,Ar),U_(ee,at,fr,Br,wr,Nr,Ar),U_(ee,at,fr,Br,wr,Nr,Ar),j_(e.dynamicLayoutVertexArray,at,fr,Br,fe)}else j_(e.dynamicLayoutVertexArray,x.x,x.y,x.z,fe);if(V){const at=ze||Xe;$_(e.iconTransitioningVertexArray,at.x,at.y),$_(e.iconTransitioningVertexArray,at.x+at.w,at.y),$_(e.iconTransitioningVertexArray,at.x,at.y+at.h),$_(e.iconTransitioningVertexArray,at.x+at.w,at.y+at.h)}j.emplaceBack(or,or+1,or+2),j.emplaceBack(or+1,or+2,or+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Vt[0]),Le!==r.length-1&&vr===r[Le+1].sectionIndex||e.programConfigurations.populatePaintArrays(K.length,f,f.index,{},L,O,z,ve&&ve[vr])}const we=v?v.anchor:x;e.placedSymbolArray.emplaceBack(we.x,we.y,we.z,x.x,x.y,le,this.glyphOffsetArray.length-le,ae,w,E,x.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],_,0,!1,0,I,0)}_commitLayoutVertex(e,r,s,l,u,f,_){e.emplaceBack(r,s,l,u,f,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,r,s,l,u,f,_){const v=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),x=v.vertexLength,w=_.tileAnchorX,E=_.tileAnchorY;for(let L=0;L<4;L++)s.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,r,e.padding,_.zOffset),this._commitLayoutVertex(s.layoutVertexArray,l,u,f,w,E,new Se(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,l,u,f,w,E,new Se(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,l,u,f,w,E,new Se(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,l,u,f,w,E,new Se(e.x1,e.y2)),v.vertexLength+=4;const I=s.indexArray;I.emplaceBack(x,x+1),I.emplaceBack(x+1,x+2),I.emplaceBack(x+2,x+3),I.emplaceBack(x+3,x),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,s,l,u,f){for(let _=l;_<u;_++){const v=s.get(_),x=this.getSymbolInstanceTextSize(e,f,r,_);this._addCollisionDebugVertices(v,x,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,r,s,l,u,f){for(let _=l;_<u;_++){const v=s.get(_),x=this.getSymbolInstanceIconSize(e,r,f.placedIconSymbolIndex);this._addCollisionDebugVertices(v,x,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Kv(Yc,aT.members,Qs),this.iconCollisionBox=new Kv(Yc,aT.members,Qs);const s=wh(this.iconSizeData,e),l=wh(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(l,e,r,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(l,e,r,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(s,e,r,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(s,e,r,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,r,s,l){const u=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:l),f=P_(this.textSizeData,e,u)/Hi;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,r,s){const l=this.icon.placedSymbolArray.get(s),u=P_(this.iconSizeData,e,l);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,r,s,l){e.emplaceBack(r,-s,-s,l),e.emplaceBack(r,s,-s,l),e.emplaceBack(r,s,s,l),e.emplaceBack(r,-s,s,l)}_updateTextDebugCollisionBoxes(e,r,s,l,u,f){for(let _=l;_<u;_++){const v=s.get(_),x=this.getSymbolInstanceTextSize(e,f,r,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,v.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,r,s,l,u,f){for(let _=l;_<u;_++){const v=s.get(_),x=this.getSymbolInstanceIconSize(e,r,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,v.padding,f.zOffset)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=wh(this.iconSizeData,e),l=wh(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(l,e,r,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(l,e,r,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(s,e,r,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._updateIconDebugCollisionBoxes(s,e,r,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,s,l,u,f,_,v,x){const w={};if(r<s){const{x1:E,y1:I,x2:L,y2:O,padding:z,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q,featureIndex:le}=e.get(r);w.textBox={x1:E,y1:I,x2:L,y2:O,padding:z,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q},w.textFeatureIndex=le}if(l<u){const{x1:E,y1:I,x2:L,y2:O,padding:z,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q,featureIndex:le}=e.get(l);w.verticalTextBox={x1:E,y1:I,x2:L,y2:O,padding:z,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q},w.verticalTextFeatureIndex=le}if(f<_){const{x1:E,y1:I,x2:L,y2:O,padding:z,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q,featureIndex:le}=e.get(f);w.iconBox={x1:E,y1:I,x2:L,y2:O,padding:z,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q},w.iconFeatureIndex=le}if(v<x){const{x1:E,y1:I,x2:L,y2:O,padding:z,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q,featureIndex:le}=e.get(v);w.verticalIconBox={x1:E,y1:I,x2:L,y2:O,padding:z,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q},w.verticalIconFeatureIndex=le}return w}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),l=s.vertexStartIndex+4*s.numGlyphs;for(let u=s.vertexStartIndex;u<l;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),l=[],u=[],f=[];for(let _=0;_<this.symbolInstances.length;++_){f.push(_);const v=this.symbolInstances.get(_);l.push(0|Math.round(r*v.tileAnchorX+s*v.tileAnchorY)),u.push(v.featureIndex)}return f.sort((_,v)=>l[_]-l[v]||u[v]-u[_]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:v,verticalPlacedIconSymbolIndex:x}=s;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),u>=0&&u!==l&&this.addIndicesForPlacedSymbol(this.text,u),f>=0&&f!==u&&f!==l&&this.addIndicesForPlacedSymbol(this.text,f),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}qt(G_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),G_.addDynamicAttributes=j_;const MR=new Zn({"symbol-placement":new wt(Ce.layout_symbol["symbol-placement"]),"symbol-spacing":new wt(Ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new wt(Ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new dr(Ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new wt(Ce.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new wt(Ce.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new wt(Ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new wt(Ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new wt(Ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new wt(Ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new dr(Ce.layout_symbol["icon-size"]),"icon-text-fit":new dr(Ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new dr(Ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new dr(Ce.layout_symbol["icon-image"]),"icon-rotate":new dr(Ce.layout_symbol["icon-rotate"]),"icon-padding":new wt(Ce.layout_symbol["icon-padding"]),"icon-keep-upright":new wt(Ce.layout_symbol["icon-keep-upright"]),"icon-offset":new dr(Ce.layout_symbol["icon-offset"]),"icon-anchor":new dr(Ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new wt(Ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new wt(Ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new wt(Ce.layout_symbol["text-rotation-alignment"]),"text-field":new dr(Ce.layout_symbol["text-field"]),"text-font":new dr(Ce.layout_symbol["text-font"]),"text-size":new dr(Ce.layout_symbol["text-size"]),"text-max-width":new dr(Ce.layout_symbol["text-max-width"]),"text-line-height":new dr(Ce.layout_symbol["text-line-height"]),"text-letter-spacing":new dr(Ce.layout_symbol["text-letter-spacing"]),"text-justify":new dr(Ce.layout_symbol["text-justify"]),"text-radial-offset":new dr(Ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new wt(Ce.layout_symbol["text-variable-anchor"]),"text-anchor":new dr(Ce.layout_symbol["text-anchor"]),"text-max-angle":new wt(Ce.layout_symbol["text-max-angle"]),"text-writing-mode":new wt(Ce.layout_symbol["text-writing-mode"]),"text-rotate":new dr(Ce.layout_symbol["text-rotate"]),"text-padding":new wt(Ce.layout_symbol["text-padding"]),"text-keep-upright":new wt(Ce.layout_symbol["text-keep-upright"]),"text-transform":new dr(Ce.layout_symbol["text-transform"]),"text-offset":new dr(Ce.layout_symbol["text-offset"]),"text-allow-overlap":new wt(Ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new wt(Ce.layout_symbol["text-ignore-placement"]),"text-optional":new wt(Ce.layout_symbol["text-optional"]),visibility:new wt(Ce.layout_symbol.visibility)});var Jv={paint:new Zn({"icon-opacity":new dr(Ce.paint_symbol["icon-opacity"]),"icon-emissive-strength":new dr(Ce.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new dr(Ce.paint_symbol["text-emissive-strength"]),"icon-color":new dr(Ce.paint_symbol["icon-color"]),"icon-halo-color":new dr(Ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new dr(Ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new dr(Ce.paint_symbol["icon-halo-blur"]),"icon-translate":new wt(Ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new wt(Ce.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new dr(Ce.paint_symbol["icon-image-cross-fade"]),"text-opacity":new dr(Ce.paint_symbol["text-opacity"]),"text-color":new dr(Ce.paint_symbol["text-color"],{runtimeType:Ss,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new dr(Ce.paint_symbol["text-halo-color"]),"text-halo-width":new dr(Ce.paint_symbol["text-halo-width"]),"text-halo-blur":new dr(Ce.paint_symbol["text-halo-blur"]),"text-translate":new wt(Ce.paint_symbol["text-translate"]),"text-translate-anchor":new wt(Ce.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new wt(Ce.paint_symbol["icon-color-saturation"])}),layout:MR};class UT{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:al,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qt(UT,"FormatSectionOverride",{omit:["defaultValue"]});class H_ extends os{constructor(e,r,s){super(e,Jv,r,s)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const u of s)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,l){const u=this.layout.get(e).evaluate(r,{},s,l),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||kc(f.value)||!u?u:function(_,v){return v.replace(/{([^{}]+)}/g,(x,w)=>w in _?String(_[w]):"")}(r.properties,u)}createBucket(e){return new G_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Jv.paint.overridableProperties){if(!H_.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new UT(r),l=new rh(s,r.property.specification,this.scope,this.options);let u=null;u=r.value.kind==="constant"||r.value.kind==="source"?new mf("source",l):new Oc("composite",l,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new El(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&H_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),l=Jv.paint.properties[r];let u=!1;const f=_=>{for(const v of _)if(l.overrides&&l.overrides.hasOverride(v))return void(u=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Ni)f(s.value.value.sections);else if(s.value.kind==="source"){const _=x=>{u||(x instanceof _o&&_i(x.value)===cl?f(x.value.sections):x instanceof hl?f(x.sections):x.eachChild(_))},v=s.value;v._styleExpression&&_(v._styleExpression.expression)}return u}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,r=this.paint.get("text-opacity").constantOr(1)!==0,s=[];return e&&s.push("symbolIcon"),r&&s.push("symbolSDF"),s}getDefaultProgramParams(e,r){return{config:new N(this,r),overrideFog:!1}}}const ER=new Zn({visibility:new wt(Ce.layout_background.visibility)});var AR={paint:new Zn({"background-color":new wt(Ce.paint_background["background-color"]),"background-pattern":new wt(Ce.paint_background["background-pattern"]),"background-opacity":new wt(Ce.paint_background["background-opacity"]),"background-emissive-strength":new wt(Ce.paint_background["background-emissive-strength"])}),layout:ER};const IR=new Zn({visibility:new wt(Ce.layout_raster.visibility)});var CR={paint:new Zn({"raster-opacity":new wt(Ce.paint_raster["raster-opacity"]),"raster-color":new Oa(Ce.paint_raster["raster-color"]),"raster-color-mix":new wt(Ce.paint_raster["raster-color-mix"]),"raster-color-range":new wt(Ce.paint_raster["raster-color-range"]),"raster-hue-rotate":new wt(Ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new wt(Ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new wt(Ce.paint_raster["raster-brightness-max"]),"raster-saturation":new wt(Ce.paint_raster["raster-saturation"]),"raster-contrast":new wt(Ce.paint_raster["raster-contrast"]),"raster-resampling":new wt(Ce.paint_raster["raster-resampling"]),"raster-fade-duration":new wt(Ce.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new wt(Ce.paint_raster["raster-emissive-strength"]),"raster-array-band":new wt(Ce.paint_raster["raster-array-band"]),"raster-elevation":new wt(Ce.paint_raster["raster-elevation"])}),layout:IR},Qv=wn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class e0{constructor(e,r,s,l){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(r,l)}update(e,r,s){const{width:l,height:u}=e,{context:f}=this,{gl:_}=f;if(_.bindTexture(_.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!r||r.premultiply!==!1)),s||this.size&&this.size[0]===l&&this.size[1]===u){const{x:v,y:x}=s||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)_.texSubImage2D(_.TEXTURE_2D,0,v,x,_.RGBA,_.UNSIGNED_BYTE,e);else{let w=this.format,E=_.UNSIGNED_BYTE;this.format===_.R32F&&(w=_.RED,E=_.FLOAT),_.texSubImage2D(_.TEXTURE_2D,0,v,x,l,u,w,E,e.data)}}else if(this.size=[l,u],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let v=this.format;this.format===_.R8&&(v=_.RED),_.texImage2D(_.TEXTURE_2D,0,this.format,v,_.UNSIGNED_BYTE,e)}else{let v=this.format,x=this.format,w=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(v=_.DEPTH_COMPONENT16,w=_.UNSIGNED_SHORT),this.format===_.R8&&(x=_.RED),this.format===_.R32F&&(w=_.FLOAT,x=_.RED),_.texImage2D(_.TEXTURE_2D,0,v,l,u,0,x,w,e.data)}this.useMipmap=!!(r&&r.useMipmap),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,r,s=!1){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,s,l){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),r!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),this.wrapS=s),l!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrapT=l)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class q_{constructor(e,r){this.context=e,this.texture=r}bind(e,r){const{context:s}=this,{gl:l}=s;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrapS=r)}}function W_(t,e,r,s,l,u,f,_){const v=[t,e,1,r,s,1,l,u,1],x=[f,_,1],w=o.co.adjoint([],v),[E,I,L]=o.N.transformMat3(x,x,w);return o.co.multiply(v,v,[E,0,0,0,I,0,0,0,L])}function jT(t,e,r,s,l,u,f,_){const v=function(x,w,E,I,L,O,z,V){const j=W_(0,0,1,0,1,1,0,1),K=W_(x,w,E,I,L,O,z,V),ee=o.co.adjoint([],j);return o.co.multiply(K,K,ee)}(t,e,r,s,l,u,f,_);return[v[2]/v[8]/kt,v[5]/v[8]/kt]}function Y_(t){return[t[0],Math.min(Math.max(t[1],-qr),qr)]}class GT extends ol{constructor(e,r,s,l){super(),this.id=e,this.dispatcher=s,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(l),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new wa("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Rt(this.map._requestManager.transformRequest(this.url,Ci.Image),(s,l)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new yd(s)):l&&(this.image=l instanceof HTMLImageElement?nt.getImageData(l):l,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new q_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new wa("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof q_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],s=e[0][1];for(const u of e)u[1]>s&&(s=u[1]),u[1]<r&&(r=u[1]);const l=(s+r)/2;if(l>qr?this.onNorthPole=!0:l<-qr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const u=e.map(ln.fromLngLat);this.tileID=function(f){let _=1/0,v=1/0,x=-1/0,w=-1/0;for(const z of f)_=Math.min(_,z.x),v=Math.min(v,z.y),x=Math.max(x,z.x),w=Math.max(w,z.y);const E=Math.max(x-_,w-v),I=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),L=Math.pow(2,I);let O=Math.floor((_+x)/2*L);return O>1&&(O-=1),new st(I,O,Math.floor((v+w)/2*L))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new wa("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const j in this.tiles){const K=this.tiles[j];K.state!=="loaded"&&(K.state="loaded",K.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=sp(new st(0,0,0),this.map.transform.projection),s=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(j){const K=j[1].x-j[0].x,ee=j[1].y-j[0].y,Q=j[2].x-j[1].x,le=j[2].y-j[1].y,ae=j[3].x-j[2].x,fe=j[3].y-j[2].y,ve=j[0].x-j[3].x,we=j[0].y-j[3].y,Le=K*le-Q*ee,Te=Q*fe-ae*le,je=ae*we-ve*fe,Ke=ve*ee-K*we;return Le>0&&Te>0&&je>0&&Ke>0||Le<0&&Te<0&&je<0&&Ke<0}(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const l=sp(this.tileID,this.map.transform.projection),[u,f,_,v]=this.coordinates.map(j=>{const K=l.projection.project(j[0],j[1]);return zT(l,K)._round()});this.perspectiveTransform=jT(u.x,u.y,f.x,f.y,_.x,_.y,v.x,v.y);const x=this._boundsArray=new wo;x.emplaceBack(u.x,u.y,0,0),x.emplaceBack(f.x,f.y,kt,0),x.emplaceBack(v.x,v.y,0,kt),x.emplaceBack(_.x,_.y,kt,kt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(x,Qv.members),this.boundsSegments=ni.simpleSegment(0,0,4,2);const w=[],E=[Y_((I=this.coordinates)[0]),Y_(I[1]),Y_(I[2]),Y_(I[3])];var I;const[L,O,z,V]=function(j){let K=j[0][0],ee=K,Q=j[0][1],le=Q;for(let ae=1;ae<j.length;ae++)j[ae][0]<K?K=j[ae][0]:j[ae][0]>ee&&(ee=j[ae][0]),j[ae][1]<Q?Q=j[ae][1]:j[ae][1]>le&&(le=j[ae][1]);return[K,Q,ee-K,le-Q]}(E);{const j=new wo,[K,ee,Q,le]=function(Ze){let St=Ze[0].x,et=St,Jt=Ze[0].y,Vt=Jt;for(let ot=1;ot<Ze.length;ot++)Ze[ot].x<St?St=Ze[ot].x:Ze[ot].x>et&&(et=Ze[ot].x),Ze[ot].y<Jt?Jt=Ze[ot].y:Ze[ot].y>Vt&&(Vt=Ze[ot].y);return[St,Jt,et-St,Vt-Jt]}(s),ae=Ze=>[(Ze.x-K)/Q,(Ze.y-ee)/le],[fe,ve,we,Le]=s.map(ae),Te=function(Ze,St,et,Jt,Vt,ot,vr,or){const Zt=W_(0,0,1,0,1,1,0,1),at=W_(Ze,St,et,Jt,Vt,ot,vr,or),fr=o.co.adjoint([],at);return o.co.multiply(Zt,Zt,fr)}(fe[0],fe[1],ve[0],ve[1],we[0],we[1],Le[0],Le[1]);this.elevatedGlobePerspectiveTransform=jT(fe[0],fe[1],ve[0],ve[1],we[0],we[1],Le[0],Le[1]);const je=(Ze,St)=>{w.push(Ze.lng);const et=Math.round((Ze.lng-L)/z*kt),Jt=Math.round((Ze.lat-O)/V*kt),Vt=ae(St),ot=o.N.transformMat3([],[Vt[0],Vt[1],1],Te),vr=Math.round(ot[0]/ot[2]*kt),or=Math.round(ot[1]/ot[2]*kt);j.emplaceBack(et,Jt,vr,or)},Ke=s[3].x-s[0].x,Be=s[3].y-s[0].y,Xe=s[2].x-s[1].x,ze=s[2].y-s[1].y;for(let Ze=0;Ze<65;Ze++){const St=Ze/64,et=[s[0].x+St*Ke,s[0].y+St*Be],Jt=[s[1].x+St*Xe,s[1].y+St*ze],Vt=Jt[0]-et[0],ot=Jt[1]-et[1];for(let vr=0;vr<65;vr++){const or=vr/64,Zt={x:et[0]+Vt*or,y:et[1]+ot*or,z:0};je(r.projection.unproject(Zt.x,Zt.y),Zt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(j,Qv.members)}{this.maxLongitudeTriangleSize=0;let j=[],K=new wi;const ee=(Q,le,ae)=>{K.emplaceBack(Q,le,ae);const fe=w[Q],ve=w[le],we=w[ae],Le=Math.min(Math.min(fe,ve),we),Te=Math.max(Math.max(fe,ve),we)-Le;Te>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Te),j.push(Le+Te/2)};for(let Q=0;Q<64;Q++)for(let le=0;le<64;le++){const ae=65*Q+le,fe=ae+1,ve=ae+65,we=ve+1;ee(ae,ve,fe),ee(fe,ve,we)}[j,K]=function(Q,le){const ae=Array.from({length:Q.length},(we,Le)=>Le);ae.sort((we,Le)=>Q[we]-Q[Le]);const fe=[],ve=new wi;for(let we=0;we<ae.length;we++){const Le=ae[we];fe.push(Q[Le]);const Te=3*Le,je=Te+1;ve.emplaceBack(le.uint16[Te],le.uint16[je],le.uint16[je+1])}return[fe,ve]}(j,K),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(K)}this.elevatedGlobeSegments=ni.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,z/kt,0,V/kt,0,0,O,L,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const r=this.map.painter.context,s=r.gl;!this._dirty||this.texture instanceof q_||(this.texture?this.texture.update(this.image):(this.texture=new e0(r,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let l=((w,E)=>w+360*Math.round((E-w)/360))(e+180,s[0]);const u=new ni,f=(w,E)=>{u.segments.push({vertexOffset:0,primitiveOffset:w,vertexLength:r.segments[0].vertexLength,primitiveLength:E,sortKey:void 0,vaos:{}})},_=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-l)<=_){const w=ke(s,0,s.length,l+_);return w===s.length||f(w,he(s,w+1,s.length,l+360-_)-w),u}l<s[0]&&(l+=360);const v=he(s,0,s.length,l-_);if(v===s.length)return f(0,s.length),u;f(0,v-0);const x=ke(s,v+1,s.length,l+_);return x!==s.length&&f(x,s.length-x),u}}const PR=(Math.pow(256,2)-1)/16907520;class HT extends os{constructor(e,r,s){super(e,CR,r,s),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(e){return!(e&&e._source instanceof GT&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[s,l]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(l)||s===this._curRampRange[0]&&l===this._curRampRange[1]||(this.colorRamp=Yf({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:l}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,l])}}const DR=new Zn({visibility:new wt(Ce["layout_raster-particle"].visibility)});var LR={paint:new Zn({"raster-particle-array-band":new wt(Ce["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new wt(Ce["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Oa(Ce["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new wt(Ce["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new wt(Ce["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new wt(Ce["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new wt(Ce["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:DR};class qT extends os{constructor(e,r,s){super(e,LR,r,s),this._updateColorRamp(),this.onRemove=l=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&l.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=nt.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isLayerDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Yf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=nt.now()}}class RR extends os{constructor(e,r){super(e,{},r),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const kR=new Zn({visibility:new wt(Ce.layout_sky.visibility)});var OR={paint:new Zn({"sky-type":new wt(Ce.paint_sky["sky-type"]),"sky-atmosphere-sun":new wt(Ce.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new wt(Ce.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new wt(Ce.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new wt(Ce.paint_sky["sky-gradient-radius"]),"sky-gradient":new Oa(Ce.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new wt(Ce.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new wt(Ce.paint_sky["sky-atmosphere-color"]),"sky-opacity":new wt(Ce.paint_sky["sky-opacity"])}),layout:kR};function t0(t,e,r){const s=[0,0,1],l=o.bi.identity([]);return o.bi.rotateY(l,l,r?-Ve(t)+Math.PI:Ve(t)),o.bi.rotateX(l,l,-Ve(e)),o.N.transformQuat(s,s,l),o.N.normalize(s,s)}var zR={paint:new Zn({})};function WT(t,e){const r=Z_(t.projection,t.zoom,t.width,t.height),s=function(u,f,_,v,x){const w=new be(_.lng-180*Nl,_.lat),E=new be(_.lng+180*Nl,_.lat),I=u.project(w.lng,w.lat),L=u.project(E.lng,E.lat),O=-Math.atan2(L.y-I.y,L.x-I.x),z=ln.fromLngLat(_);z.y=zt(z.y,-1+Nl,1-Nl);const V=z.toLngLat(),j=u.project(V.lng,V.lat),K=ln.fromLngLat(V);K.x+=Nl;const ee=K.toLngLat(),Q=u.project(ee.lng,ee.lat),le=XT(Q.x-j.x,Q.y-j.y,O),ae=ln.fromLngLat(V);ae.y+=Nl;const fe=ae.toLngLat(),ve=u.project(fe.lng,fe.lat),we=XT(ve.x-j.x,ve.y-j.y,O),Le=Math.abs(le.x)/Math.abs(we.y),Te=o.a6.identity([]);o.a6.rotateZ(Te,Te,-O*(1-(x?0:v)));const je=o.a6.identity([]);return o.a6.scale(je,je,[1,1-(1-Le)*v,1]),je[4]=-we.x/we.y*v,o.a6.rotateZ(je,je,O),o.a6.multiply(je,Te,je),je}(t.projection,0,t.center,r,e),l=YT(t);return o.a6.scale(s,s,[l,l,1]),s}function YT(t){const e=t.projection,r=Z_(t.projection,t.zoom,t.width,t.height),s=ZT(e,t.center),l=ZT(e,be.convert(e.center));return Math.pow(2,s*r+(1-r)*l)}function Z_(t,e,r,s,l=1/0){const u=t.range;if(!u)return 0;const f=Math.min(l,Math.max(r,s)),_=Math.log(f/1024)/Math.LN2;return vn(u[0]+_,u[1]+_,e)}const Nl=1/4e4;function ZT(t,e){const r=zt(e.lat,-qr,qr),s=new be(e.lng-180*Nl,r),l=new be(e.lng+180*Nl,r),u=t.project(s.lng,r),f=t.project(l.lng,r),_=ln.fromLngLat(s),v=ln.fromLngLat(l),x=f.x-u.x,w=f.y-u.y,E=v.x-_.x,I=v.y-_.y,L=Math.sqrt((E*E+I*I)/(x*x+w*w));return Math.log(L)/Math.LN2}function XT(t,e,r){const s=Math.cos(r),l=Math.sin(r);return{x:t*s-e*l,y:t*l+e*s}}function KT(t,e,r){o.a6.identity(t),o.a6.rotateZ(t,t,Ve(e[2])),o.a6.rotateX(t,t,Ve(e[0])),o.a6.rotateY(t,t,Ve(e[1])),o.a6.scale(t,t,r),o.a6.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function X_(t,e,r,s,l,u,f,_){const v=[r[0]-e[0],r[1]-e[1],0],x=[s[0]-e[0],s[1]-e[1],0];if(o.N.length(v)<1e-12||o.N.length(x)<1e-12)return o.bi.identity(t);const w=o.N.cross([],v,x);o.N.normalize(w,w),o.N.subtract(x,s,e),v[2]=(u-l)*_,x[2]=(f-l)*_;const E=v;return o.N.cross(E,v,x),o.N.normalize(E,E),o.bi.rotationTo(t,w,E)}function r0(t,e,r=!1){const s=Ll(e.zoom),l=function(u,f,_){const v=f.worldSize,x=[u[12],u[13],u[14]],w=nn(x[1]/v),E=Ir(x[0]/v),I=o.a6.identity([]),L=Cr(1,w)*v,O=Cr(1,0)*v*Wr(w,f.zoom),z=1/Ev(v);let V=O*z;if(_){const Q=Z_(f.projection,f.zoom,f.width,f.height,1024);V=z*f.projection.pixelSpaceConversion(f.center.lat,v,Q)}const j=Ne(w,E);o.N.add(j,j,o.N.scale([],o.N.normalize([],j),L*V*x[2]));const K=function(Q){const le=[Q[0],Q[1],Q[2]];let ae=[0,1,0];const fe=o.N.cross([],ae,le);return o.N.cross(ae,le,fe),o.N.squaredLength(ae)===0&&(ae=[0,1,0],o.N.cross(fe,le,ae)),o.N.normalize(fe,fe),o.N.normalize(ae,ae),o.N.normalize(le,le),[fe[0],fe[1],fe[2],0,ae[0],ae[1],ae[2],0,le[0],le[1],le[2],0,Q[0],Q[1],Q[2],1]}(j);o.a6.scale(I,I,[V,V,V*L]),o.a6.translate(I,I,[-x[0],-x[1],-x[2]]);const ee=o.a6.multiply([],f.globeMatrix,K);return o.a6.multiply(ee,ee,I),o.a6.multiply(ee,ee,u),ee}(t,e,r);if(s>0){const u=function(f,_){const v=_.worldSize,x=Cr(1,0)*v*Wr(_.center.lat,_.zoom)/Ev(v),w=Cr(1,_.center.lat)*v,E=o.a6.identity([]);return o.a6.rotateY(E,E,Ve(_.center.lng)),o.a6.rotateX(E,E,Ve(_.center.lat)),o.a6.translate(E,E,[0,0,J]),o.a6.scale(E,E,[x,x,x*w]),o.a6.translate(E,E,[_.point.x-.5*v,_.point.y-.5*v,0]),o.a6.multiply(E,E,f),o.a6.multiply(E,_.globeMatrix,E)}(t,e);return function(f,_,v){const x=(O,z,V)=>{const j=o.N.length(O),K=o.N.length(z),ee=Ua(O,z,V);return o.N.scale(ee,ee,1/o.N.length(ee)*en(j,K,V))},w=x([f[0],f[1],f[2]],[_[0],_[1],_[2]],v),E=x([f[4],f[5],f[6]],[_[4],_[5],_[6]],v),I=x([f[8],f[9],f[10]],[_[8],_[9],_[10]],v),L=Ua([f[12],f[13],f[14]],[_[12],_[13],_[14]],v);return[w[0],w[1],w[2],0,E[0],E[1],E[2],0,I[0],I[1],I[2],0,L[0],L[1],L[2],1]}(l,u,s)}return l}function JT(t,e,r,s){const l=ti.projectAabbCorners(s,r);let u=Number.MAX_VALUE,f=-1;for(let x=0;x<l.length;++x){const w=l[x];w[0]=(.5*w[0]+.5)*e.width,w[1]=(.5-.5*w[1])*e.height,w[2]<u&&(f=x,u=w[2])}const _=x=>new Se(l[x][0],l[x][1]);let v;switch(f){case 0:case 6:v=[_(1),_(5),_(4),_(7),_(3),_(2),_(1)];break;case 1:case 7:v=[_(0),_(4),_(5),_(6),_(2),_(3),_(0)];break;case 3:case 5:v=[_(1),_(0),_(4),_(7),_(6),_(2),_(1)];break;default:v=[_(1),_(5),_(6),_(7),_(3),_(0),_(1)]}if(to(t,v))return u}const FR=wn([{name:"a_pos_3f",components:3,type:"Float32"}]),BR=wn([{name:"a_color_3f",components:3,type:"Float32"}]),NR=wn([{name:"a_color_4f",components:4,type:"Float32"}]),VR=wn([{name:"a_uv_2f",components:2,type:"Float32"}]),$R=wn([{name:"a_normal_3f",components:3,type:"Float32"}]),UR=wn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),jR=wn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class QT{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class eS{constructor(){this.instancedDataArray=new Nf,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class n0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,r,s,l){this.tileToMeter=Yr(s);const u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:_,index:v,sourceLayerIndex:x}of e){const w=yi(f,u);if(!this.layers[0]._featureFilter.filter(new Yn(this.zoom),w,s))continue;const E={id:_,sourceLayerIndex:x,index:v,geometry:u?w.geometry:Si(f,s,l),properties:f.properties,type:f.type,patterns:{}},I=this.addFeature(E,E.geometry,w);I&&r.featureIndex.insert(f,E.geometry,v,x,this.index,this.instancesPerModel[I].instancedDataArray.length,kt/32)}this.lookup=null}update(e,r,s,l){for(const u in this.instancesPerModel){const f=this.instancesPerModel[u];for(const _ in e)f.idToFeaturesIndex.hasOwnProperty(_)&&this.evaluate(f.features[f.idToFeaturesIndex[_]],e[_],f,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const r in this.instancesPerModel){const s=this.instancesPerModel[r];for(const l of s.features){const u=this.layers[0],f=l.feature,_=this.canonical,v=u.paint.get("model-rotation").evaluate(f,{},_),x=u.paint.get("model-scale").evaluate(f,{},_),w=u.paint.get("model-translation").evaluate(f,{},_);o.N.exactEquals(l.rotation,v)&&o.N.exactEquals(l.scale,x)&&o.N.exactEquals(l.translation,w)||(this.evaluate(l,l.featureStates,s,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const r in this.instancesPerModel){const s=this.instancesPerModel[r];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,UR.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const r=this.instancesPerModel[e];r.instancedDataArray.length!==0&&r.instancedDataBuffer&&r.instancedDataBuffer.destroy()}}addFeature(e,r,s){const l=this.layers[0],u=l.layout.get("model-id").evaluate(s,{},this.canonical);if(!u)return ye(`modelId is not evaluated for layer ${l.id} and it is not going to get rendered.`),u;this.instancesPerModel[u]||(this.instancesPerModel[u]=new eS);const f=this.instancesPerModel[u],_=f.instancedDataArray,v=new QT(s,_.length);for(const x of r)for(const w of x){if(w.x<0||w.x>=kt||w.y<0||w.y>=kt)continue;const E=(this.lookupDim-1)/kt,I=this.lookupDim*(w.y*E|0)+w.x*E|0;if(this.lookup){if(this.lookup[I]!==0)continue;this.lookup[I]=1}this.instanceCount++;const L=_.length;_.resize(L+1),f.instancesEvaluatedElevation.push(0),_.float32[16*L]=w.x,_.float32[16*L+1]=w.y}return v.instancedDataCount=f.instancedDataArray.length-v.instancedDataOffset,v.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(v),this.evaluate(v,{},f,!1)),u}evaluate(e,r,s,l){const u=this.layers[0],f=e.feature,_=this.canonical,v=e.rotation=u.paint.get("model-rotation").evaluate(f,r,_),x=e.scale=u.paint.get("model-scale").evaluate(f,r,_),w=e.translation=u.paint.get("model-translation").evaluate(f,r,_),E=u.paint.get("model-color").evaluate(f,r,_);E.a=u.paint.get("model-color-mix-intensity").evaluate(f,r,_);const I=[];this.maxVerticalOffset<w[2]&&(this.maxVerticalOffset=w[2]),this.maxScale=Math.max(Math.max(this.maxScale,x[0]),Math.max(x[1],x[2])),KT(I,v,x);const L=Math.round(100*E.a)+E.b/1.05;for(let O=0;O<e.instancedDataCount;++O){const z=e.instancedDataOffset+O,V=16*z,j=s.instancedDataArray.float32;let K=0;l&&(K=j[V+6]-s.instancesEvaluatedElevation[z]);const ee=0|j[V+1];j[V]=(0|j[V])+E.r/1.05,j[V+1]=ee+E.g/1.05,j[V+2]=L,j[V+3]=1/(_.z>10?this.tileToMeter:Yr(_,ee)),j[V+4]=w[0],j[V+5]=w[1],j[V+6]=w[2]+K,j[V+7]=I[0],j[V+8]=I[1],j[V+9]=I[2],j[V+10]=I[4],j[V+11]=I[5],j[V+12]=I[6],j[V+13]=I[8],j[V+14]=I[9],j[V+15]=I[10],s.instancesEvaluatedElevation[z]=w[2]}}}qt(n0,"ModelBucket",{omit:["layers"]}),qt(eS,"PerModelAttributes"),qt(QT,"ModelFeature");const GR=new Zn({visibility:new wt(Ce.layout_model.visibility),"model-id":new dr(Ce.layout_model["model-id"])});var HR={paint:new Zn({"model-opacity":new wt(Ce.paint_model["model-opacity"]),"model-rotation":new dr(Ce.paint_model["model-rotation"]),"model-scale":new dr(Ce.paint_model["model-scale"]),"model-translation":new dr(Ce.paint_model["model-translation"]),"model-color":new dr(Ce.paint_model["model-color"]),"model-color-mix-intensity":new dr(Ce.paint_model["model-color-mix-intensity"]),"model-type":new wt(Ce.paint_model["model-type"]),"model-cast-shadows":new wt(Ce.paint_model["model-cast-shadows"]),"model-receive-shadows":new wt(Ce.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new wt(Ce.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new dr(Ce.paint_model["model-emissive-strength"]),"model-roughness":new dr(Ce.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new dr(Ce.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new wt(Ce.paint_model["model-cutoff-fade-range"])}),layout:GR};const cu=64,Ph={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function tS(t,e,r,s,l,u,f,_,v,x=!1){const w=r.zoom,E=r.project(s),I=Wr(s.lat,w),L=1/I;o.a6.identity(t),o.a6.translate(t,t,[E.x+f[0]*L,E.y+f[1]*L,f[2]]);let O=1,z=1;const V=r.worldSize;if(x){if(r.projection.name==="mercator"){let Q=0;r.elevation&&(Q=r.elevation.getAtPointOrZero(new ln(E.x/V,E.y/V),0));const le=o.a7.transformMat4([],[E.x,E.y,Q,1],r.projMatrix)[3]/r.cameraToCenterDistance;O=le,z=le*Wr(r.center.lat,w)}else if(r.projection.name==="globe"){const Q=r0(t,r),le=o.a6.multiply([],r.projMatrix,Q),ae=[0,0,0,1];o.a7.transformMat4(ae,ae,le);const fe=ae[3]/r.cameraToCenterDistance,ve=Ll(w),we=r.projection.pixelsPerMeter(s.lat,V)*Wr(s.lat,w),Le=r.projection.pixelsPerMeter(r.center.lat,V)*Wr(r.center.lat,w);O=fe/en(we,Xn(r.center.lat),ve),z=fe*I/we,O*=Le,z*=Le}}else O=L;o.a6.scale(t,t,[O,O,z]);const j=[...t],K=e.orientation,ee=[];if(KT(ee,[K[0]+l[0],K[1]+l[1],K[2]+l[2]],u),o.a6.multiply(t,j,ee),_&&r.elevation){let Q=0;const le=[];if(v&&r.elevation){Q=function(ve,we,Le,Te,je){const Ke=we.elevation;if(!Ke)return 0;const Be=ti.projectAabbCorners(Le,Te),Xe=Cr(1,je.lat)*we.worldSize,ze=function(fr,Br){const wr=[0,0,1],Nr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ar of Nr){const tn=fr[Ar.corners[0]],Pr=fr[Ar.corners[1]],Pn=fr[Ar.corners[2]],un=[Pr[0]-tn[0],Pr[1]-tn[1],Br*(Pr[2]-tn[2])],fn=o.N.cross(un,un,[Pn[0]-tn[0],Pn[1]-tn[1],Br*(Pn[2]-tn[2])]);o.N.normalize(fn,fn),Ar.dotProductWithUp=o.N.dot(fn,wr)}return Nr.sort((Ar,tn)=>Ar.dotProductWithUp-tn.dotProductWithUp),Nr[0].corners}(Be,Xe),Ze=Be[ze[0]],St=Be[ze[1]],et=Be[ze[2]],Jt=Be[ze[3]],Vt=Ke.getAtPointOrZero(new ln(Ze[0]/we.worldSize,Ze[1]/we.worldSize),0),ot=Ke.getAtPointOrZero(new ln(St[0]/we.worldSize,St[1]/we.worldSize),0),vr=Ke.getAtPointOrZero(new ln(et[0]/we.worldSize,et[1]/we.worldSize),0),or=Ke.getAtPointOrZero(new ln(Jt[0]/we.worldSize,Jt[1]/we.worldSize),0),Zt=(Vt+or)/2,at=(ot+vr)/2;return Zt>at?ot<vr?X_(ve,St,Jt,Ze,ot,or,Vt,Xe):X_(ve,et,Ze,Jt,vr,Vt,or,Xe):Vt<or?X_(ve,Ze,St,et,Vt,ot,vr,Xe):X_(ve,Jt,et,St,or,vr,ot,Xe),Math.max(Zt,at)}(le,r,e.aabb,t,s);const ae=o.a6.fromQuat([],le),fe=o.a6.multiply([],ae,ee);o.a6.multiply(t,j,fe)}else Q=r.elevation.getAtPointOrZero(new ln(E.x/V,E.y/V),0);Q!==0&&(t[14]+=Q)}}function up(t,e,r=!1){t.uploaded||(t.gfxTexture=new e0(e,t.image,r?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function qR(t,e,r){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,FR.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,$R.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,VR.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?BR:NR).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,jR.members,!0)),t.segments=ni.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const s=t.material;s.pbrMetallicRoughness.baseColorTexture&&up(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&up(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&up(s.normalTexture,e),s.occlusionTexture&&up(s.occlusionTexture,e,r),s.emissionTexture&&up(s.emissionTexture,e)}function i0(t,e,r){if(t.meshes)for(const s of t.meshes)qR(s,e,r);if(t.children)for(const s of t.children)i0(s,e,r)}function K_(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)K_(e)}function s0(t){if(t.meshes)for(const r of t.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const r of t.children)s0(r)}class WR{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class YR{constructor(){this.tasks={},this.taskQueue=[],Kt(["process"],this),this.invoker=new WR(this.process),this.nextId=0}add(e,r){const s=this.nextId++,l=function({type:u,isSymbolTile:f,zoom:_}){return _=_||0,u==="message"?0:u!=="maybePrepare"||f?u!=="parseTile"||f?u==="parseTile"&&f?300-_:u==="maybePrepare"&&f?400-_:500:200-_:100-_}(r);if(l===0){Bt();try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:r,priority:l,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){Bt();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let l=0;l<this.taskQueue.length;l++){const u=this.tasks[this.taskQueue[l]];u.priority<r&&(r=u.priority,e=l)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class rS{constructor(e,r,s){this.target=e,this.parent=r,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Kt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new YR}send(e,r,s,l,u=!1,f){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=f,this.callbacks[_]=s);const v=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!s,targetMapId:l,mustQueue:u,sourceMapId:this.mapId,data:Zo(r,v)},v),{cancel:()=>{s&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(e){const r=e.data,s=r.id;if(s&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const l=this.cancelCallbacks[s];delete this.cancelCallbacks[s],l&&l.cancel()}else if(r.mustQueue||Bt()){const l=this.callbacks[s],u=this.scheduler.add(()=>this.processTask(s,r),l&&l.metadata||{type:"message"});u&&(this.cancelCallbacks[s]=u)}else this.processTask(s,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(r.error?s(Ra(r.error)):s(null,Ra(r.data)))}else{const s=new Set,l=r.hasCallback?(f,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?Zo(f):null,data:Zo(_,s)},s)}:f=>{},u=Ra(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,u,l);else if(this.parent.getWorkerSource){const f=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,f[0],u.source,u.scope)[f[1]](u,l)}else l(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Dh{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=dn();const s=this.workerPool.acquire(this.id);for(let l=0;l<s.length;l++){const u=new Dh.Actor(s[l],r,this.id);u.name=`Worker ${l}`,this.actors.push(u)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,r,s){zr(this.actors,(l,u)=>{l.send(e,r,u)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}Dh.Actor=rS;var hp={workerUrl:"",workerClass:null,workerParams:void 0};function ZR(){return hp.workerClass!=null?new hp.workerClass:new self.Worker(hp.workerUrl,hp.workerParams)}const o0="mapboxgl_preloaded_worker_pool";class dp{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<dp.workerCount;)this.workers.push(new ZR);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[o0]}numActive(){return Object.keys(this.active).length}}let fp;function J_(){return fp||(fp=new dp),fp}dp.workerCount=2;let Q_,a0,Co,Lh,l0,Rh=null;function nS(){return Bt()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:a0||H.DRACO_URL}function iS(){if(Bt()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Lh)return Lh;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Lh=WebAssembly.validate(t)?H.MESHOPT_SIMD_URL:H.MESHOPT_URL,Lh}const eg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},XR={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},pp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function sS(t,e,r){const s=r.json.bufferViews.length,l=r.buffers.length;e.bufferView=s,r.json.bufferViews[s]={buffer:l,byteLength:t.byteLength},r.buffers[l]=t}const c0="KHR_draco_mesh_compression";function KR(t,e){const r=t.extensions&&t.extensions[c0];if(!r)return;const s=new Co.Decoder,l=cS(e,r.bufferView),u=new Co.Mesh;if(!s.DecodeArrayToMesh(l,l.byteLength,u))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[t.indices],_=eg[f.componentType],v=f.count*_.BYTES_PER_ELEMENT,x=Co._malloc(v);_===Uint16Array?s.GetTrianglesUInt16Array(u,v,x):s.GetTrianglesUInt32Array(u,v,x),sS(Co.memory.buffer.slice(x,x+v),f,e),Co._free(x);for(const w of Object.keys(r.attributes)){const E=s.GetAttributeByUniqueId(u,r.attributes[w]),I=e.json.accessors[t.attributes[w]],L=XR[I.componentType],O=I.count*pp[I.type]*eg[I.componentType].BYTES_PER_ELEMENT,z=Co._malloc(O);s.GetAttributeDataArrayForAllPoints(u,E,Co[L],O,z),sS(Co.memory.buffer.slice(z,z+O),I,e),Co._free(z)}s.destroy(),u.destroy(),delete t.extensions[c0]}const tg="EXT_meshopt_compression";function JR(t,e){if(!t.extensions||!t.extensions[tg])return;const r=t.extensions[tg],s=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),l=new Uint8Array(r.count*r.byteStride);l0.decodeGltfBuffer(l,r.count,r.byteStride,s,r.mode,r.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=l.buffer,delete t.extensions[tg]}const oS=1179937895,aS=new TextDecoder("utf8");function lS(t,e){return new URL(t,e).href}function QR(t,e,r,s){return fetch(lS(t.uri,s)).then(l=>l.arrayBuffer()).then(l=>{e.buffers[r]=l})}function cS(t,e){const r=t.json.bufferViews[e];return new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function ek(t,e,r,s){if(t.uri){const l=lS(t.uri,s);return fetch(l).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[r]=u})}if(t.bufferView!==void 0){const l=cS(e,t.bufferView),u=new Blob([l],{type:t.mimeType});return createImageBitmap(u).then(f=>{e.images[r]=f})}}function uS(t,e=0,r){const s={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===oS){const w=new Uint32Array(t,e);let E=2;const I=(w[E++]>>2)-3,L=w[E++]>>2;if(E++,s.json=JSON.parse(aS.decode(w.subarray(E,E+L))),E+=L,E<I){const O=w[E++];E++;const z=e+(E<<2);s.buffers[0]=t.slice(z,z+O)}}else s.json=JSON.parse(aS.decode(new Uint8Array(t,e)));const{buffers:l,images:u,meshes:f,extensionsUsed:_,bufferViews:v}=s.json;let x=Promise.resolve();if(l){const w=[];for(let E=0;E<l.length;E++){const I=l[E];I.uri?w.push(QR(I,s,E,r)):s.buffers[E]||(s.buffers[E]=null)}x=Promise.all(w)}return x.then(()=>{const w=[],E=_&&_.includes(c0),I=_&&_.includes(tg);if(E&&w.push(function(){if(!Co)return Q_||(Q_=function(L){let O,z=null;function V(){O=new Uint8Array(z.buffer)}function j(){throw new Error("Unexpected Draco error.")}const K={a:{a:j,d:function(ee,Q,le){return O.copyWithin(ee,Q,Q+le)},c:function(ee){const Q=O.length,le=Math.max(ee>>>0,Math.ceil(1.2*Q)),ae=Math.ceil((le-Q)/65536);try{return z.grow(ae),V(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(L,K):L.then(ee=>ee.arrayBuffer()).then(ee=>WebAssembly.instantiate(ee,K))).then(ee=>{const{Rb:Q,Qb:le,P:ae,T:fe,X:ve,Ja:we,La:Le,Qa:Te,Va:je,Wa:Ke,eb:Be,jb:Xe,f:ze,e:Ze,yb:St,zb:et,Ab:Jt,Bb:Vt,Db:ot,Gb:vr}=ee.instance.exports;z=Ze;const or=(()=>{let Zt=0,at=0,fr=0,Br=0;return wr=>{fr&&(Q(Br),Q(Zt),at+=fr,fr=Zt=0),Zt||(at+=128,Zt=le(at));const Nr=wr.length+7&-8;let Ar=Zt;Nr>=at&&(fr=Nr,Ar=Br=le(Nr));for(let tn=0;tn<wr.length;tn++)O[Ar+tn]=wr[tn];return Ar}})();return V(),ze(),{memory:Ze,_free:Q,_malloc:le,Mesh:class{constructor(){this.ptr=ae()}destroy(){fe(this.ptr)}},Decoder:class{constructor(){this.ptr=we()}destroy(){Xe(this.ptr)}DecodeArrayToMesh(Zt,at,fr){const Br=or(Zt),wr=Le(this.ptr,Br,at,fr.ptr);return!!ve(wr)}GetAttributeByUniqueId(Zt,at){return{ptr:Te(this.ptr,Zt.ptr,at)}}GetTrianglesUInt16Array(Zt,at,fr){je(this.ptr,Zt.ptr,at,fr)}GetTrianglesUInt32Array(Zt,at,fr){Ke(this.ptr,Zt.ptr,at,fr)}GetAttributeDataArrayForAllPoints(Zt,at,fr,Br,wr){Be(this.ptr,Zt.ptr,at.ptr,fr,Br,wr)}},DT_INT8:St(),DT_UINT8:et(),DT_INT16:Jt(),DT_UINT16:Vt(),DT_UINT32:ot(),DT_FLOAT32:vr()}})}(fetch(nS())),Q_.then(L=>{Co=L,Q_=void 0}))}()),I&&w.push(function(){if(l0)return;const L=function(O){let z;const V=WebAssembly.instantiateStreaming(O,{}).then(ee=>{z=ee.instance,z.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},K={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:V,supported:!0,decodeGltfBuffer(ee,Q,le,ae,fe,ve){(function(we,Le,Te,je,Ke,Be,Xe){const ze=we.exports.sbrk,Ze=je+3&-4,St=ze(Ze*Ke),et=ze(Be.length),Jt=new Uint8Array(we.exports.memory.buffer);Jt.set(Be,et);const Vt=Le(St,je,Ke,et,Be.length);if(Vt===0&&Xe&&Xe(St,Ze,Ke),Te.set(Jt.subarray(St,St+je*Ke)),ze(St-ze(0)),Vt!==0)throw new Error(`Malformed buffer data: ${Vt}`)})(z,z.exports[K[fe]],ee,Q,le,ae,z.exports[j[ve]])}}}(fetch(iS()));return L.ready.then(()=>{l0=L})}()),u)for(let L=0;L<u.length;L++)w.push(ek(u[L],s,L,r));return(w.length?Promise.all(w):Promise.resolve()).then(()=>{if(E&&f)for(const{primitives:L}of f)for(const O of L)KR(O,s);if(I&&f&&v)for(const L of v)JR(L,s);return s})})}class hS{constructor(e,r,s){if(this.triangleCount=r.length/3,this.min=new Se(0,0),this.max=new Se(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||s===0)return;const l=e.map(w=>w.x),u=e.map(w=>w.y);this.min=new Se(Math.min(...l),Math.min(...u)),this.max=new Se(Math.max(...l),Math.max(...u));const f=this.max.sub(this.min);f.x=Math.max(f.x,1),f.y=Math.max(f.y,1);const _=Math.max(f.x,f.y)/s;this.cellsX=Math.max(1,Math.ceil(f.x/_)),this.cellsY=Math.max(1,Math.ceil(f.y/_)),this.xScale=1/_,this.yScale=1/_;const v=[];for(let w=0;w<this.triangleCount;w++){const E=e[r[3*w+0]].sub(this.min),I=e[r[3*w+1]].sub(this.min),L=e[r[3*w+2]].sub(this.min),O=Vl(Math.floor(Math.min(E.x,I.x,L.x)),this.xScale,this.cellsX),z=Vl(Math.floor(Math.max(E.x,I.x,L.x)),this.xScale,this.cellsX),V=Vl(Math.floor(Math.min(E.y,I.y,L.y)),this.yScale,this.cellsY),j=Vl(Math.floor(Math.max(E.y,I.y,L.y)),this.yScale,this.cellsY),K=new Se(0,0),ee=new Se(0,0),Q=new Se(0,0),le=new Se(0,0);for(let ae=V;ae<=j;++ae){K.y=ee.y=ae*_,Q.y=le.y=(ae+1)*_;for(let fe=O;fe<=z;++fe)K.x=Q.x=fe*_,ee.x=le.x=(fe+1)*_,(iv(E,I,L,K,ee,le)||iv(E,I,L,K,le,Q))&&v.push({cellIdx:ae*this.cellsX+fe,triIdx:w})}}if(v.length===0)return;v.sort((w,E)=>w.cellIdx-E.cellIdx||w.triIdx-E.triIdx);let x=0;for(;x<v.length;){const w=v[x].cellIdx,E={start:this.payload.length,len:0};for(;x<v.length&&v[x].cellIdx===w;)++E.len,this.payload.push(v[x++].triIdx);this.cells[w]=E}}query(e,r,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let v=0;v<this.lookup.length;v++)this.lookup[v]=0;const l=Vl(e.x-this.min.x,this.xScale,this.cellsX),u=Vl(r.x-this.min.x,this.xScale,this.cellsX),f=Vl(e.y-this.min.y,this.yScale,this.cellsY),_=Vl(r.y-this.min.y,this.yScale,this.cellsY);for(let v=f;v<=_;v++)for(let x=l;x<=u;x++){const w=this.cells[v*this.cellsX+x];if(w)for(let E=0;E<w.len;E++){const I=this.payload[w.start+E],L=Math.floor(I/8),O=1<<I%8;if(!(this.lookup[L]&O)&&(this.lookup[L]|=O,s.push(I),s.length===this.triangleCount))return}}}}function Vl(t,e,r){return Math.max(0,Math.min(r-1,Math.floor(t*e)))}function uu(t,e){const r=t.json.bufferViews[e.bufferView],s=eg[e.componentType];return new s(t.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==pp[e.type]*s.BYTES_PER_ELEMENT?r.byteStride/s.BYTES_PER_ELEMENT:pp[e.type]))}function u0(t,e,r,s){const l=eg[e.componentType],u=function(w){switch(w){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(l),f=t.json.bufferViews[e.bufferView],_=f.byteStride?f.byteStride/l.BYTES_PER_ELEMENT:pp[e.type],v=r.float32,x=v.length/r.capacity;for(let w=0,E=0;w<e.count*_;w+=_,E+=x)for(let I=0;I<x;I++)v[E+I]=s[w+I]*u;r._trim()}function tk(t,e,r){const s=t.indices,l=t.attributes,u={};u.indexArray=new wi;const f=e.json.accessors[s],_=f.count/3;u.indexArray.reserve(_);const v=uu(e,f);for(let I=0;I<_;I++)u.indexArray.emplaceBack(v[3*I],v[3*I+1],v[3*I+2]);u.indexArray._trim(),u.vertexArray=new za;const x=e.json.accessors[l.POSITION];u.vertexArray.reserve(x.count);const w=uu(e,x);for(let I=0;I<x.count;I++)u.vertexArray.emplaceBack(w[3*I],w[3*I+1],w[3*I+2]);if(u.vertexArray._trim(),u.aabb=new ti(x.min,x.max),u.centroid=function(I,L){const O=[0,0,0],z=I.length;if(z>0){for(let V=0;V<z;V++){const j=3*I[V];O[0]+=L[j],O[1]+=L[j+1],O[2]+=L[j+2]}O[0]/=z,O[1]/=z,O[2]/=z}return O}(v,w),l.COLOR_0!==void 0){const I=e.json.accessors[l.COLOR_0],L=pp[I.type],O=uu(e,I);u.colorArray=L===3?new za:new Qo,u.colorArray.resize(I.count),u0(e,I,u.colorArray,O)}if(l.NORMAL!==void 0){u.normalArray=new za;const I=e.json.accessors[l.NORMAL];u.normalArray.resize(I.count);const L=uu(e,I);u0(e,I,u.normalArray,L)}if(l.TEXCOORD_0!==void 0&&r.length>0){u.texcoordArray=new Kc;const I=e.json.accessors[l.TEXCOORD_0];u.texcoordArray.resize(I.count);const L=uu(e,I);u0(e,I,u.texcoordArray,L)}if(l._FEATURE_ID_RGBA4444!==void 0){const I=e.json.accessors[l._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=uu(e,I))}l._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(uu(e,e.json.accessors[l._FEATURE_RGBA4444]).buffer));const E=t.material;return u.material=function(I,L){const{emissiveFactor:O=[0,0,0],alphaMode:z="OPAQUE",alphaCutoff:V=.5,normalTexture:j,occlusionTexture:K,emissiveTexture:ee,doubleSided:Q}=I,{baseColorFactor:le=[1,1,1,1],metallicFactor:ae=1,roughnessFactor:fe=1,baseColorTexture:ve,metallicRoughnessTexture:we}=I.pbrMetallicRoughness||{},Le=K?L[K.index]:void 0;if(K&&K.extensions&&K.extensions.KHR_texture_transform&&Le){const Te=K.extensions.KHR_texture_transform;Le.offsetScale=[Te.offset[0],Te.offset[1],Te.scale[0],Te.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new hi(...le),metallicFactor:ae,roughnessFactor:fe,baseColorTexture:ve?L[ve.index]:void 0,metallicRoughnessTexture:we?L[we.index]:void 0},doubleSided:Q,emissiveFactor:O,alphaMode:z,alphaCutoff:V,normalTexture:j?L[j.index]:void 0,occlusionTexture:Le,emissionTexture:ee?L[ee.index]:void 0,defined:I.defined===void 0}}(E!==void 0?e.json.materials[E]:{defined:!1},r),u}function dS(t,e,r){const{matrix:s,rotation:l,translation:u,scale:f,mesh:_,extras:v,children:x}=t,w={};if(w.matrix=s||o.a6.fromRotationTranslationScale([],l||[0,0,0,1],u||[0,0,0],f||[1,1,1]),_!==void 0){w.meshes=r[_];const E=w.anchor=[0,0];for(const I of w.meshes){const{min:L,max:O}=I.aabb;E[0]+=L[0]+O[0],E[1]+=L[1]+O[1]}E[0]=Math.floor(E[0]/w.meshes.length/2),E[1]=Math.floor(E[1]/w.meshes.length/2)}if(v&&(v.id&&(w.id=v.id),v.lights&&(w.lights=function(E){if(!E.length)return[];const I=function(j){const K=atob(j),ee=new Uint8Array(K.length);for(let Q=0;Q<K.length;Q++)ee[Q]=K.codePointAt(Q);return ee}(E),L=[],O=I.length/24,z=new Uint16Array(I.buffer),V=new Float32Array(I.buffer);for(let j=0;j<O;j++){const K=z[2*j*6]/30,ee=z[2*j*6+1]/30,Q=z[2*j*6+10]/100,le=V[6*j+1],ae=V[6*j+2],fe=V[6*j+3],ve=V[6*j+4],we=fe-le,Le=ve-ae,Te=Math.hypot(we,Le);L.push({pos:[le+.5*we,ae+.5*Le,ee],normal:[Le/Te,-we/Te,0],width:Te,height:K,depth:Q,points:[le,ae,fe,ve]})}return L}(v.lights))),x){const E=[];for(const I of x)E.push(dS(e.json.nodes[I],e,r));w.children=E}return w}function rk(t){if(t.vertices.length===0||t.indices.length===0)return null;const[e,r]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let f=1;f<t.vertices.length;++f){const _=t.vertices[f];e.x=Math.min(e.x,_.x),e.y=Math.min(e.y,_.y),r.x=Math.max(r.x,_.x),r.y=Math.max(r.y,_.y)}const s=Math.ceil(Math.max(r.x-e.x,r.y-e.y)/256),l=Math.max(8,s),u=new hS(t.vertices,t.indices,l);return{vertices:t.vertices,indices:t.indices,grid:u,min:e,max:r}}function nk(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;const s=[];for(const f of r){if(!Array.isArray(f)||f.length!==2)continue;const _=f[0],v=f[1];typeof _=="number"&&typeof v=="number"&&s.push(new Se(_,v))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let l=0;for(let f=0;f<s.length;f++){const _=s[f],v=s[(f+1)%s.length],x=s[(f+2)%s.length];l+=(_.x-v.x)*(x.y-v.y)-(x.x-v.x)*(_.y-v.y)}l>0&&s.reverse();const u=w_(s.flatMap(f=>[f.x,f.y]),[]);return u.length===0?null:{vertices:s,indices:u}}function ik(t){const e=[],r=[];let s=0;for(const l of t){s=e.length;const u=l.vertexArray.float32,f=l.indexArray.uint16;for(let _=0;_<l.vertexArray.length;_++)e.push(new Se(u[3*_+0],u[3*_+1]));for(let _=0;_<3*l.indexArray.length;_++)r.push(f[_]+s)}if(r.length%3!=0)return null;for(let l=0;l<r.length;l+=3){const u=e[r[l+0]],f=e[r[l+1]],_=e[r[l+2]];(u.x-f.x)*(_.y-f.y)-(_.x-f.x)*(u.y-f.y)>0&&([r[l+1],r[l+2]]=[r[l+2],r[l+1]])}return{vertices:e,indices:r}}function fS(t){const e=function(v,x){const w=[],E=WebGL2RenderingContext;if(v.json.textures)for(const I of v.json.textures){const L={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};I.sampler!==void 0&&Object.assign(L,v.json.samplers[I.sampler]),w.push({image:x[I.source],sampler:L,uploaded:!1})}return w}(t,t.images),r=function(v,x){const w=[];for(const E of v.json.meshes){const I=[];for(const L of E.primitives)I.push(tk(L,v,x));w.push(I)}return w}(t,e),{scenes:s,scene:l,nodes:u}=t.json,f=s?s[l||0].nodes:u,_=[];for(const v of f)_.push(dS(u[v],t,r));return function(v,x,w){const E={},I=new Set;for(let L=0;L<v.length;L++){const O=w[x[L]];if(!O.extras)continue;const z=O.extras["mapbox:footprint:version"],V=O.extras["mapbox:footprint:id"];(z||V)&&I.add(L),z==="1.0.0"&&V&&(E[V]=L)}for(let L=0;L<v.length;L++){if(I.has(L))continue;const O=v[L],z=w[x[L]];if(!z.extras)continue;let V=null;O.id in E&&(V=ik(v[E[O.id]].meshes)),V||(V=nk(z)),V&&(O.footprint=rk(V))}if(I.size>0){const L=Array.from(I.values()).sort((O,z)=>O-z);for(let O=L.length-1;O>=0;O--)v.splice(L[O],1)}}(_,f,t.json.nodes),_}function sk(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,r=t.aabb.min[0]-1,s=t.aabb.min[1]-1,l=cu/(t.aabb.max[0]-r+2),u=cu/(t.aabb.max[1]-s+2);for(let f=0;f<e.length;f+=3){const _=e[f+2],v=(e[f+0]-r)*l|0,x=(e[f+1]-s)*u|0;_>t.heightmap[x*cu+v]&&(t.heightmap[x*cu+v]=_)}}function ok(t,e){const r={};r.indexArray=new wi,r.indexArray.reserve(4*t.length),r.vertexArray=new za,r.vertexArray.reserve(10*t.length),r.colorArray=new Qo,r.vertexArray.reserve(10*t.length);let s=0;for(const f of t){const _=Math.min(10,Math.max(4,1.3*f.height))*e,v=[-f.normal[1],f.normal[0],0],x=Math.min(.29,.1*f.width/f.depth),w=f.width-2*f.depth*e*(x+.01),E=o.N.scaleAndAdd([],f.pos,v,w/2),I=o.N.scaleAndAdd([],f.pos,v,-w/2),L=[E[0],E[1],E[2]+f.height],O=[I[0],I[1],I[2]+f.height],z=o.N.scaleAndAdd([],f.normal,v,x);o.N.scale(z,z,_);const V=o.N.scaleAndAdd([],f.normal,v,-x);o.N.scale(V,V,_),o.N.add(z,E,z),o.N.add(V,I,V),E[2]+=.1,I[2]+=.1,r.vertexArray.emplaceBack(z[0],z[1],z[2]),r.vertexArray.emplaceBack(V[0],V[1],V[2]),r.vertexArray.emplaceBack(E[0],E[1],E[2]),r.vertexArray.emplaceBack(I[0],I[1],I[2]),r.vertexArray.emplaceBack(L[0],L[1],L[2]),r.vertexArray.emplaceBack(O[0],O[1],O[2]),r.vertexArray.emplaceBack(E[0],E[1],E[2]),r.vertexArray.emplaceBack(I[0],I[1],I[2]),r.vertexArray.emplaceBack(z[0],z[1],z[2]),r.vertexArray.emplaceBack(V[0],V[1],V[2]);const j=w/_/2;r.colorArray.emplaceBack(-j-x,-1,j,.8),r.colorArray.emplaceBack(j+x,-1,j,.8),r.colorArray.emplaceBack(-j,0,j,1.3),r.colorArray.emplaceBack(j,0,j,1.3),r.colorArray.emplaceBack(j+x,-.8,j,.7),r.colorArray.emplaceBack(j+x,-.8,j,.7),r.colorArray.emplaceBack(0,0,j,1.3),r.colorArray.emplaceBack(0,0,j,1.3),r.colorArray.emplaceBack(j+x,-1.2,j,.8),r.colorArray.emplaceBack(j+x,-1.2,j,.8),r.indexArray.emplaceBack(6+s,4+s,8+s),r.indexArray.emplaceBack(7+s,9+s,5+s),r.indexArray.emplaceBack(0+s,1+s,2+s),r.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}const l={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=hi.white,l.pbrMetallicRoughness=u,r.material=l,r.aabb=new ti([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}qt(hS,"TriangleGridIndex");class pS{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const ak=["tile","layer","source","sourceLayer","state"];class mS{constructor(e,r,s,l,u){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=s,this._y=l,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of ak)this[r]!==void 0&&(e[r]=this[r]);return e}}class _S{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new xo(kt,16,0),this.featureIndexArray=new e_,this.promoteId=r,this.is3DTile=!1}insert(e,r,s,l,u,f=0,_=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,u,f);const x=this.grid;for(let w=0;w<r.length;w++){const E=r[w],I=[1/0,1/0,-1/0,-1/0];for(let L=0;L<E.length;L++){const O=E[L];I[0]=Math.min(I[0],O.x),I[1]=Math.min(I[1],O.y),I[2]=Math.max(I[2],O.x),I[3]=Math.max(I[3],O.y)}_!==0&&(I[0]-=_,I[1]-=_,I[2]+=_,I[3]+=_),I[0]<kt&&I[1]<kt&&I[2]>=0&&I[3]>=0&&x.insert(v,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Fv(new Mh(this.rawTileData)).layers,this.sourceLayerCoder=new pS(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,s,l){this.loadVTLayers();const u=e.params||{},f=ys(u.filter),_=e.tileResult,v=e.transform,x=_.bufferedTilespaceBounds,w=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(O,z,V,j)=>F1(_.bufferedTilespaceGeometry,O,z,V,j));w.sort(lk);let E=null;v.elevation&&w.length>0&&(E=xh.create(v.elevation,this.tileID));const I={};let L;for(let O=0;O<w.length;O++){const z=w[O];if(z===L)continue;L=z;const V=this.featureIndexArray.get(z);let j=null;if(this.is3DTile){const K=this.bucketLayerIDs[0][0],ee=r[K];if(ee.type!=="model")continue;const{queryFeature:Q,intersectionZ:le}=ee.queryIntersectsMatchingFeature(_,V.featureIndex,f,v);Q&&this.appendToResult(I,K,V.featureIndex,Q,le)}else this.loadMatchingFeature(I,V,f,u.layers,u.availableImages,r,s,l,(K,ee,Q,le=0)=>(j||(j=Si(K,this.tileID.canonical,e.tileTransform)),ee.queryIntersectsFeature(_,K,Q,j,this.z,e.transform,e.pixelPosMatrix,E,le)))}return I}loadMatchingFeature(e,r,s,l,u,f,_,v,x){const{featureIndex:w,bucketIndex:E,sourceLayerIndex:I,layoutVertexArrayOffset:L}=r,O=this.bucketLayerIDs[E];if(l&&!function(K,ee){for(let Q=0;Q<K.length;Q++)if(ee.indexOf(K[Q])>=0)return!0;return!1}(l,O))return;const z=this.sourceLayerCoder.decode(I),V=this.vtLayers[z].feature(w);if(s.needGeometry){const K=yi(V,!0);if(!s.filter(new Yn(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!s.filter(new Yn(this.tileID.overscaledZ),V))return;const j=this.getId(V,z);for(let K=0;K<O.length;K++){const ee=O[K];if(l&&l.indexOf(ee)<0)continue;const Q=f[ee];if(!Q)continue;let le={};j!==void 0&&v&&(le=v.getState(Q.sourceLayer||"_geojsonTileLayer",j));const ae=!x||x(V,Q,le,L);if(!ae)continue;const fe=new mS(V,this.z,this.x,this.y,j),ve=nr({},_[ee]);ve.paint=gS(ve.paint,Q.paint,V,le,u),ve.layout=gS(ve.layout,Q.layout,V,le,u),fe.layer=ve,this.appendToResult(e,ee,w,fe,ae)}}appendToResult(e,r,s,l,u){let f=e[r];f===void 0&&(f=e[r]=[]),f.push({featureIndex:s,feature:l,intersectionZ:u})}lookupSymbolFeatures(e,r,s,l,u,f,_,v){const x={};this.loadVTLayers();const w=ys(u);for(const E of e)this.loadMatchingFeature(x,{bucketIndex:s,sourceLayerIndex:l,featureIndex:E,layoutVertexArrayOffset:0},w,f,_,v,r);return x}loadFeature(e){const{featureIndex:r,sourceLayerIndex:s}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(s),u=this.vtFeatures[l];if(u[r])return u[r];const f=this.vtLayers[l].feature(r);return u[r]=f,f}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;if(this.promoteId){const l=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];l!=null&&(s=e.properties[l]),typeof s=="boolean"&&(s=Number(s))}return s}}function gS(t,e,r,s,l){return ir(t,(u,f)=>{const _=e instanceof Nc?e.get(f):null;return _&&_.evaluate?_.evaluate(r,s,l):_})}function lk(t,e){return e-t}qt(_S,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const h0=new Float32Array(262144),hu=new Uint8Array(262144);function yS(t){let e=0;if(t.meshes)for(const r of t.meshes)e=Math.max(e,r.aabb.max[2]);if(t.children)for(const r of t.children)e=Math.max(e,yS(r));return e}function vS(t,e,r){if(t.meshes)for(const s of t.meshes)s.aabb.min[0]!==1/0&&r.insert(e,s.aabb.min[0],s.aabb.min[1],s.aabb.max[0],s.aabb.max[1]);if(t.children)for(const s of t.children)vS(s,e,r)}const xS=["","wall","door","roof","window","lamp","logo"];class bS{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:yS(e)}}}getLocalBounds(){if(!this.node.meshes)return new ti([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const r=new ti([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&r.encapsulate(s.aabb),e++;this.aabb=r}return this.aabb}}class rg{constructor(e,r,s,l,u,f){this.id=r,this.modelTraits|=Ph.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,s&&(this.modelTraits|=Ph.HasMapboxMeshFeatures),l&&(this.modelTraits|=Ph.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=u,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const _ of e)this.nodesInfo.push(new bS(_)),vS(_,f.featureIndexArray.length,f.grid),f.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,f.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const s of r){const l=s.node;this.uploaded?this.updatePbrBuffer(l):i0(l,e,!0)}for(const s of r)K_(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),r=!0);return r}needsReEvaluation(e,r,s){const l=e.transform.projectionOptions,u=e.style.getBrightness(),f=this.brightness!==u;return!!(!this.uploaded||this.dirty||l.name!==this.projection.name||mp(s.paint.get("model-color").value,f)||mp(s.paint.get("model-color-mix-intensity").value,f)||mp(s.paint.get("model-roughness").value,f)||mp(s.paint.get("model-emissive-strength").value,f)||mp(s.paint.get("model-height-based-emissive-strength-multiplier").value,f))&&(this.projection=l,this.brightness=u,!0)}evaluateScale(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),l=this.id.canonical;for(const u of s){const f=u.feature;u.evaluatedScale=r.paint.get("model-scale").evaluate(f,{},l)}}evaluate(e){const r=this.getNodesInfo();for(const s of r){if(!s.node.meshes)continue;const l=s.feature,u=s.node.meshes&&s.node.meshes[0].featureData,f=s.evaluatedColor[2],_=s.evaluatedRMEA[2],v=this.id.canonical;if(s.hasTranslucentParts=!1,u){for(let x=0;x<xS.length;x++){const w=xS[x];w.length&&(l.properties.part=w);const E=e.paint.get("model-color").evaluate(l,{},v),I=e.paint.get("model-color-mix-intensity").evaluate(l,{},v);s.evaluatedColor[x]=[E.r,E.g,E.b,I],s.evaluatedRMEA[x][0]=e.paint.get("model-roughness").evaluate(l,{},v),s.evaluatedRMEA[x][2]=e.paint.get("model-emissive-strength").evaluate(l,{},v),s.evaluatedRMEA[x][3]=E.a,s.emissionHeightBasedParams[x]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,{},v),!s.hasTranslucentParts&&E.a<1&&(s.hasTranslucentParts=!0)}delete l.properties.part,uk(s,f!==s.evaluatedColor[2]||_!==s.evaluatedRMEA[2],this.modelTraits)}else s.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(l,{},v);s.evaluatedScale=e.paint.get("model-scale").evaluate(l,{},v),this.updatePbrBuffer(s.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,s,l){const u=e.findDEMTileFor(s);if(u&&(u.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;const f=xh.create(e,s,u);if(!f)return;this.modelTraits&Ph.HasMapboxMeshFeatures&&this.updateDEM(e,f,s,l);for(const _ of this.getNodesInfo()){const v=_.node;if(!v.footprint||!v.footprint.vertices||!v.footprint.vertices.length)continue;const x=v.footprint.vertices;let w=f.getElevationAt(x[0].x,x[0].y,!0,!0);for(let E=1;E<x.length;E++)w=Math.min(w,f.getElevationAt(x[E].x,x[E].y,!0,!0));v.elevation=w}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,s,l){let u=r._dem._modifiedForSources[l];if(u===void 0&&(r._dem._modifiedForSources[l]=[],u=r._dem._modifiedForSources[l]),u.includes(s.canonical))return;const f=r._dem.dim;u.push(s.canonical);let _=!1;for(const v of this.getNodesInfo()){const x=v.node;if(!x.footprint||!x.footprint.grid)continue;const w=x.footprint.grid,E=r.tileCoordToPixel(w.min.x,w.min.y),I=r.tileCoordToPixel(w.max.x,w.max.y),L=Math.min(Math.min(f-I.y,E.x),Math.min(E.y,f-I.x));if(L<0)continue;const O=zt(L,2,5);let z=Math.max(0,E.x-O),V=Math.max(0,E.y-O),j=Math.min(I.x+O,f-1),K=Math.min(I.y+O,f-1);for(let ae=V;ae<=K;++ae)for(let fe=z;fe<=j;++fe)hu[ae*f+fe]=255;let ee=0,Q=0;for(let ae=0;ae<w.cellsY;++ae)for(let fe=0;fe<w.cellsX;++fe){if(!w.cells[ae*w.cellsX+fe])continue;const ve=r.tileCoordToPixel(w.min.x+fe/w.xScale,w.min.y+ae/w.yScale),we=r.tileCoordToPixel(w.min.x+(fe+1)/w.xScale,w.min.y+(ae+1)/w.yScale);for(let Le=ve.y;Le<=Math.min(we.y+1,f-1);++Le)for(let Te=ve.x;Te<=Math.min(we.x+1,f-1);++Te)hu[Le*f+Te]===255&&(hu[Le*f+Te]=0,ee+=r.getElevationAtPixel(Te,Le),Q++)}const le=ee/Q;z=Math.max(1,E.x-O),V=Math.max(1,E.y-O),j=Math.min(I.x+O,f-2),K=Math.min(I.y+O,f-2),_=!0;for(let ae=V;ae<=K;++ae)for(let fe=z;fe<=j;++fe)hu[ae*f+fe]===0&&(h0[ae*f+fe]=r._dem.set(fe,ae,le));for(let ae=1;ae<O;++ae){z=Math.max(1,E.x-ae),V=Math.max(1,E.y-ae),j=Math.min(I.x+ae,f-2),K=Math.min(I.y+ae,f-2);for(let fe=V;fe<=K;++fe)for(let ve=z;ve<=j;++ve){const we=fe*f+ve;if(hu[we]===255){let Le=0,Te=0,je=-1,Ke=-1;for(let Be=-1;Be<=1;++Be)for(let Xe=-1;Xe<=1;++Xe){const ze=(fe+Be)*f+ve+Xe;if(hu[ze]>=ae)continue;const Ze=h0[ze],St=Math.abs(Ze);St>Te&&(Le=Ze,Te=St,je=Xe,Ke=Be)}if(Te>.1){const Be=1-(ae+.5*Math.abs(je*Ke))/O;let Xe=r._dem.get(ve,fe)+Le*Be;const ze=r._dem.get(ve+je,fe+Ke),Ze=r._dem.get(ve-je,fe-Ke,!0);(Xe-ze)*(Xe-Ze)>0&&(Xe=(ze+Ze)/2),h0[we]=r._dem.set(ve,fe,Xe),hu[we]=ae}}}}}_&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=nt.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const r of e)K_(r.node),s0(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const s=r.getReplacementRegionsForTile(e.toUnwrapped()),l=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){const f=l[u].node;l[u].hiddenByReplacement=!!f.footprint&&!s.find(_=>_.footprint===f.footprint)}}getHeightAtTileCoord(e,r){const s=this.getNodesInfo(),l=[];for(let u=0;u<this.nodesInfo.length;u++){const f=s[u],_=f.node.meshes[0];if(e<_.aabb.min[0]||r<_.aabb.min[1]||e>_.aabb.max[0]||r>_.aabb.max[1])continue;const v=(e-_.aabb.min[0])/(_.aabb.max[0]-_.aabb.min[0])*cu|0,x=Math.min(63,(r-_.aabb.min[1])/(_.aabb.max[1]-_.aabb.min[1])*cu|0)*cu+Math.min(63,v);if(!(_.heightmap[x]<0&&f.node.footprint))return f.hiddenByReplacement?void 0:{height:_.heightmap[x],maxHeight:f.feature.properties.height,hidden:!1,verticalScale:f.evaluatedScale[2]};if(f.node.footprint.grid.query(new Se(e,r),new Se(e,r),l),l.length>0)return{height:void 0,maxHeight:f.feature.properties.height,hidden:f.hiddenByReplacement,verticalScale:f.evaluatedScale[2]}}}}function mp(t,e){return!t.isLightConstant&&e}function ck(t,e,r,s,l,u,f,_){let v=(61440&e|(61440&e)>>4)>>8,x=(3840&e|(3840&e)>>4)>>4,w=240&e|(240&e)>>4;r[3]>0&&(v=en(v,255*r[0],r[3]),x=en(x,255*r[1],r[3]),w=en(w,255*r[2],r[3]));const E=v<<8|x,I=w<<8|Math.floor(255*s[3]),L=function(ae){const fe=zt(ae,0,2);return Math.min(Math.round(.5*fe*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],O=zt(l[0],0,1),z=zt(l[1],0,1),V=zt(l[2],0,1),j=zt(l[3],0,1);let K,ee,Q,le;if(O!==z&&f!==u&&z!==O){const ae=f-u;ee=1/(ae*(z-O)),Q=-(u+ae*O)/(ae*(z-O));const fe=zt(l[4],-1,1);le=Math.pow(10,fe),K=255*V<<8|255*j}else K=65535,ee=0,Q=1,le=1;if(t.emplaceBack(E,I,L,K,ee,Q,le),_){const ae=_.length;_.clear();for(let fe=0;fe<ae;fe++)_.emplaceBack(E,I,L,K,ee,Q,le)}}function uk(t,e,r){const s=t.node;let l=0;const u=r&Ph.HasMeshoptCompression;for(const f of s.meshes){if(s.lights&&s.lightMeshIndex===l||!f.featureData)continue;f.featureArray=new Jc,f.featureArray.reserve(f.featureData.length);let _=e;for(const v of f.featureData){const x=u?65535&v:v>>16&65535,w=u?v>>16&65535:65535&v,E=(15&w)<8?15&w:0,I=t.evaluatedRMEA[E],L=t.evaluatedColor[E],O=t.emissionHeightBasedParams[E];let z;if(_&&E===2&&s.lights&&(z=new Jc,z.resize(10*s.lights.length)),ck(f.featureArray,x,L,I,O,f.aabb.min[2],f.aabb.max[2],z),z&&_){_=!1;const V=s.meshes[s.lightMeshIndex];V.featureArray=z,V.featureArray._trim()}}f.featureArray._trim(),l++}}function wS(t,e,r,s){const l=1<<t.z;e.lat=nn((s/kt+t.y)/l),e.lng=Ir((r/kt+t.x)/l)}qt(rg,"Tiled3dModelBucket",{omit:["layers"]}),qt(bS,"Tiled3dModelFeature");const hk={circle:class extends os{constructor(t,e,r){super(t,nD,e,r)}createBucket(t){return new cs(t)}queryRadius(t){const e=t;return gh("circle-radius",this,e)+gh("circle-stroke-width",this,e)+c_(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,s,l,u,f,_){const v=N1(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return dw(t,s,u,f,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,x)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const r=hw(this);return{config:new N(this,e),defines:r,overrideFog:!1}}},heatmap:class extends os{createBucket(t){return new pw(t)}constructor(t,e,r){super(t,kD,e,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Yf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return gh("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,s,l,u,f,_){const v=this.paint.get("heatmap-radius").evaluate(e,r);return dw(t,s,u,f,_,!0,!0,new Se(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new N(this,e),overrideFog:!1}:{}}},hillshade:class extends os{constructor(t,e,r){super(t,zD,e,r)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends os{constructor(t,e,r){super(t,XD,e,r)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(t,e){return{config:new N(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new zv(t)}queryRadius(){return c_(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,s,l,u){return!t.queryGeometry.isAboveHorizon&&Fa(B1(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends os{constructor(t,e,r){super(t,SL,e,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new C_(t)}queryRadius(){return c_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,r,s,l,u,f,_,v){const x=N1(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),w=this.paint.get("fill-extrusion-height").evaluate(e,r),E=this.paint.get("fill-extrusion-base").evaluate(e,r),I=[0,0],L=_&&u.elevation,O=u.elevation?u.elevation.exaggeration():1,z=t.tile.getBucket(this);if(L&&z instanceof C_){const Q=z.centroidVertexArray,le=v+1;le<Q.length&&(I[0]=Q.geta_centroid_pos0(le),I[1]=Q.geta_centroid_pos1(le))}if(I[0]===0&&I[1]===1)return!1;u.projection.name==="globe"&&(s=Zw([s],[new Se(0,0),new Se(kt,kt)],t.tileID.canonical).map(Q=>Q.polygon).flat());const V=L?_:null,[j,K]=function(Q,le,ae,fe,ve,we,Le,Te,je,Ke,Be){return Q.projection.name==="globe"?function(Xe,ze,Ze,St,et,Jt,Vt,ot,vr,or,Zt){const at=[],fr=[],Br=Xe.projection.upVectorScale(Zt,Xe.center.lat,Xe.worldSize).metersToTile,wr=[0,0,0,1],Nr=[0,0,0,1],Ar=(Pr,Pn,un,fn)=>{Pr[0]=Pn,Pr[1]=un,Pr[2]=fn,Pr[3]=1},tn=Yw();Ze>0&&(Ze+=tn),St+=tn;for(const Pr of ze){const Pn=[],un=[];for(const fn of Pr){const yn=fn.x+et.x,hn=fn.y+et.y,qn=Xe.projection.projectTilePoint(yn,hn,Zt),Sn=Xe.projection.upVector(Zt,fn.x,fn.y);let ii=Ze,xi=St;if(Vt){const Ui=Kw(yn,hn,Ze,St,Vt,ot,vr,or);ii+=Ui.base,xi+=Ui.top}Ze!==0?Ar(wr,qn.x+Sn[0]*Br*ii,qn.y+Sn[1]*Br*ii,qn.z+Sn[2]*Br*ii):Ar(wr,qn.x,qn.y,qn.z),Ar(Nr,qn.x+Sn[0]*Br*xi,qn.y+Sn[1]*Br*xi,qn.z+Sn[2]*Br*xi),o.N.transformMat4(wr,wr,Jt),o.N.transformMat4(Nr,Nr,Jt),Pn.push(new bh(wr[0],wr[1],wr[2])),un.push(new bh(Nr[0],Nr[1],Nr[2]))}at.push(Pn),fr.push(un)}return[at,fr]}(Q,le,ae,fe,ve,we,Le,Te,je,Ke,Be):Le?function(Xe,ze,Ze,St,et,Jt,Vt,ot,vr){const or=[],Zt=[],at=[0,0,0,1];for(const fr of Xe){const Br=[],wr=[];for(const Nr of fr){const Ar=Nr.x+St.x,tn=Nr.y+St.y,Pr=Kw(Ar,tn,ze,Ze,Jt,Vt,ot,vr);at[0]=Ar,at[1]=tn,at[2]=Pr.base,at[3]=1,o.a7.transformMat4(at,at,et),at[3]=Math.max(at[3],1e-5);const Pn=new bh(at[0]/at[3],at[1]/at[3],at[2]/at[3]);at[0]=Ar,at[1]=tn,at[2]=Pr.top,at[3]=1,o.a7.transformMat4(at,at,et),at[3]=Math.max(at[3],1e-5);const un=new bh(at[0]/at[3],at[1]/at[3],at[2]/at[3]);Br.push(Pn),wr.push(un)}or.push(Br),Zt.push(wr)}return[or,Zt]}(le,ae,fe,ve,we,Le,Te,je,Ke):function(Xe,ze,Ze,St,et){const Jt=[],Vt=[],ot=et[8]*ze,vr=et[9]*ze,or=et[10]*ze,Zt=et[11]*ze,at=et[8]*Ze,fr=et[9]*Ze,Br=et[10]*Ze,wr=et[11]*Ze;for(const Nr of Xe){const Ar=[],tn=[];for(const Pr of Nr){const Pn=Pr.x+St.x,un=Pr.y+St.y,fn=et[0]*Pn+et[4]*un+et[12],yn=et[1]*Pn+et[5]*un+et[13],hn=et[2]*Pn+et[6]*un+et[14],qn=et[3]*Pn+et[7]*un+et[15],Sn=fn+ot,ii=yn+vr,xi=hn+or,Ui=Math.max(qn+Zt,1e-5),Un=fn+at,Jn=yn+fr,Li=hn+Br,Ri=Math.max(qn+wr,1e-5);Ar.push(new bh(Sn/Ui,ii/Ui,xi/Ui)),tn.push(new bh(Un/Ri,Jn/Ri,Li/Ri))}Jt.push(Ar),Vt.push(tn)}return[Jt,Vt]}(le,ae,fe,ve,we)}(u,s,E,w,x,f,V,I,O,u.center.lat,t.tileID.canonical),ee=t.queryGeometry;return function(Q,le,ae){let fe=1/0;Fa(ae,le)&&(fe=Xw(ae,le[0]));for(let ve=0;ve<le.length;ve++){const we=le[ve],Le=Q[ve];for(let Te=0;Te<we.length-1;Te++){const je=we[Te],Ke=[je,we[Te+1],Le[Te+1],Le[Te],je];to(ae,Ke)&&(fe=Math.min(fe,Xw(ae,Ke)))}}return fe!==1/0&&fe}(j,K,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends os{constructor(t,e,r){super(t,Qw,e,r),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Pc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=sT.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Nv(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const r=nT(this);return{config:new N(this,e),defines:r,overrideFog:!1}}queryRadius(t){const e=t,r=oT(gh("line-width",this,e),gh("line-gap-width",this,e)),s=gh("line-offset",this,e);return r/2+Math.abs(s)+c_(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,s,l,u){if(t.queryGeometry.isAboveHorizon)return!1;const f=B1(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),_=t.pixelToTileUnitsFactor/2*oT(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),v=this.paint.get("line-offset").evaluate(e,r);return v&&(s=function(x,w){const E=[],I=new Se(0,0);for(let L=0;L<x.length;L++){const O=x[L],z=[];for(let V=0;V<O.length;V++){const j=O[V],K=O[V+1],ee=V===0?I:j.sub(O[V-1])._unit()._perp(),Q=V===O.length-1?I:K.sub(j)._unit()._perp(),le=ee._add(Q)._unit();le._mult(1/(le.x*Q.x+le.y*Q.y)),z.push(le._mult(w)._add(j))}E.push(z)}return E}(s,v*t.pixelToTileUnitsFactor)),function(x,w,E){for(let I=0;I<w.length;I++){const L=w[I];if(x.length>=3){for(let O=0;O<L.length;O++)if(So(x,L[O]))return!0}if(nu(x,L,E))return!0}return!1}(f,s,_)}isTileClipped(){return!0}},symbol:H_,background:class extends os{constructor(t,e,r){super(t,AR,e,r)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:HT,"raster-particle":qT,sky:class extends os{constructor(t,e,r){super(t,OR,e,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Yf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),l=!s,u=t.style.light,f=u.properties.get("position");return l&&u.properties.get("anchor")==="viewport"&&ye("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?t0(f.azimuthal,90-f.polar,e):t0(s[0],90-s[1],e)}const r=this.paint.get("sky-gradient-center");return t0(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends os{constructor(t,e,r){super(t,zR,e)}},model:class extends os{constructor(t,e,r){super(t,HR,e,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new n0(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof rg?kt-1:0}queryIntersectsFeature(t,e,r,s,l,u){if(!this.modelManager)return!1;const f=this.modelManager,_=t.tile.getBucket(this);if(!(_&&_ instanceof n0))return!1;const v=_;for(const x in v.instancesPerModel){const w=v.instancesPerModel[x];if(w.idToFeaturesIndex.hasOwnProperty(e.id)){const E=w.features[w.idToFeaturesIndex[e.id]],I=f.getModel(x,this.scope);if(!I)return!1;let L=o.a6.create();const O=new be(0,0),z=v.canonical;let V=Number.MAX_VALUE;for(let j=0;j<E.instancedDataCount;++j){const K=16*(E.instancedDataOffset+j),ee=w.instancedDataArray.float32,Q=[ee[K+4],ee[K+5],ee[K+6]];wS(z,O,ee[K],0|ee[K+1]),tS(L,I,u,O,E.rotation,E.scale,Q,!1,!1,!1),u.projection.name==="globe"&&(L=r0(L,u));const le=o.a6.multiply([],u.projMatrix,L),ae=t.queryGeometry,fe=JT(ae.isPointQuery()?ae.screenBounds:ae.screenGeometry,u,le,I.aabb);fe!=null&&(V=Math.min(fe,V))}return V!==Number.MAX_VALUE&&V}}return!1}_handleOverridablePaintPropertyUpdate(t,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Oc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,r,s){const l=t.tile,u=l.getBucket(this);let f=null,_=Number.MAX_VALUE;if(!(u&&u instanceof rg))return{queryFeature:f,intersectionZ:_};const v=u.getNodesInfo()[e];if(v.hiddenByReplacement||!v.node.meshes||!r.filter(new Yn(l.tileID.overscaledZ),v.feature,l.tileID.canonical))return{queryFeature:f,intersectionZ:_};const x=v.node,w=s.calculatePosMatrix(l.tileID.toUnwrapped(),s.worldSize),E=v.evaluatedScale;let I=0;s.elevation&&x.elevation&&(I=x.elevation*s.elevation.exaggeration()),o.a6.translate(w,w,[(x.anchor?x.anchor[0]:0)*(E[0]-1),(x.anchor?x.anchor[1]:0)*(E[1]-1),I]),o.a6.scale(w,w,E),o.a6.multiply(w,w,x.matrix);const L=t.queryGeometry,O=L.isPointQuery()?L.screenBounds:L.screenGeometry,z=function(j){const K=o.a6.multiply([],w,j.matrix),ee=o.a6.multiply(K,s.expandedFarZProjMatrix,K);for(let Q=0;Q<j.meshes.length;++Q){const le=j.meshes[Q];if(Q===j.lightMeshIndex)continue;const ae=JT(O,s,ee,le.aabb);ae!=null&&(_=Math.min(ae,_))}if(j.children)for(const Q of j.children)z(Q)};if(z(x),_===Number.MAX_VALUE)return{queryFeature:f,intersectionZ:_};const V=new be(0,0);return wS(l.tileID.canonical,V,v.node.anchor[0],v.node.anchor[1]),f={type:"Feature",geometry:{type:"Point",coordinates:[V.lng,V.lat]},properties:v.feature.properties,id:v.feature.id,state:{},layer:this.serialize()},{queryFeature:f,intersectionZ:_}}}},Lr={read:function(t,e){return t.readFields(Lr._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,r){t===1?e.header_length=r.readFixed32():t===2?e.x=r.readVarint():t===3?e.y=r.readVarint():t===4?e.z=r.readVarint():t===5&&e.layers.push(Lr.Layer.read(r,r.readVarint()+r.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Lr.Filter.read=function(t,e){return t.readFields(Lr.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},Lr.Filter._readField=function(t,e,r){t===1?(e.delta_filter=Lr.Filter.Delta.read(r,r.readVarint()+r.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=Lr.Filter.Zigzag.read(r,r.readVarint()+r.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=Lr.Filter.BitShuffle.read(r,r.readVarint()+r.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=Lr.Filter.ByteShuffle.read(r,r.readVarint()+r.pos),e.filter="byteshuffle_filter")},Lr.Filter.Delta={},Lr.Filter.Delta.read=function(t,e){return t.readFields(Lr.Filter.Delta._readField,{block_size:0},e)},Lr.Filter.Delta._readField=function(t,e,r){t===1&&(e.block_size=r.readVarint())},Lr.Filter.Zigzag={},Lr.Filter.Zigzag.read=function(t,e){return t.readFields(Lr.Filter.Zigzag._readField,{},e)},Lr.Filter.Zigzag._readField=function(t,e,r){},Lr.Filter.BitShuffle={},Lr.Filter.BitShuffle.read=function(t,e){return t.readFields(Lr.Filter.BitShuffle._readField,{},e)},Lr.Filter.BitShuffle._readField=function(t,e,r){},Lr.Filter.ByteShuffle={},Lr.Filter.ByteShuffle.read=function(t,e){return t.readFields(Lr.Filter.ByteShuffle._readField,{},e)},Lr.Filter.ByteShuffle._readField=function(t,e,r){},Lr.Codec={},Lr.Codec.read=function(t,e){return t.readFields(Lr.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},Lr.Codec._readField=function(t,e,r){t===1?(e.gzip_data=Lr.Codec.GzipData.read(r,r.readVarint()+r.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=Lr.Codec.JpegImage.read(r,r.readVarint()+r.pos),e.codec="jpeg_image"):t===3?(e.webp_image=Lr.Codec.WebpImage.read(r,r.readVarint()+r.pos),e.codec="webp_image"):t===4&&(e.png_image=Lr.Codec.PngImage.read(r,r.readVarint()+r.pos),e.codec="png_image")},Lr.Codec.GzipData={},Lr.Codec.GzipData.read=function(t,e){return t.readFields(Lr.Codec.GzipData._readField,{},e)},Lr.Codec.GzipData._readField=function(t,e,r){},Lr.Codec.JpegImage={},Lr.Codec.JpegImage.read=function(t,e){return t.readFields(Lr.Codec.JpegImage._readField,{},e)},Lr.Codec.JpegImage._readField=function(t,e,r){},Lr.Codec.WebpImage={},Lr.Codec.WebpImage.read=function(t,e){return t.readFields(Lr.Codec.WebpImage._readField,{},e)},Lr.Codec.WebpImage._readField=function(t,e,r){},Lr.Codec.PngImage={},Lr.Codec.PngImage.read=function(t,e){return t.readFields(Lr.Codec.PngImage._readField,{},e)},Lr.Codec.PngImage._readField=function(t,e,r){},Lr.DataIndexEntry={},Lr.DataIndexEntry.read=function(t,e){return t.readFields(Lr.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},Lr.DataIndexEntry._readField=function(t,e,r){t===1?e.first_byte=r.readFixed64():t===2?e.last_byte=r.readFixed64():t===3?e.filters.push(Lr.Filter.read(r,r.readVarint()+r.pos)):t===4?e.codec=Lr.Codec.read(r,r.readVarint()+r.pos):t===5?e.offset=r.readFloat():t===6?e.scale=r.readFloat():t===7&&e.bands.push(r.readString())},Lr.Layer={},Lr.Layer.read=function(t,e){return t.readFields(Lr.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},Lr.Layer._readField=function(t,e,r){t===1?e.version=r.readVarint():t===2?e.name=r.readString():t===3?e.units=r.readString():t===4?e.tilesize=r.readVarint():t===5?e.buffer=r.readVarint():t===6?e.pixel_format=r.readVarint():t===7&&e.data_index.push(Lr.DataIndexEntry.read(r,r.readVarint()+r.pos))};const Po={read:function(t,e){return t.readFields(Po._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,r){t===2?(e.uint32_values=Po.Uint32Values.read(r,r.readVarint()+r.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=Po.Fixed32Values.read(r,r.readVarint()+r.pos),e.values="fixed32_values")},Uint32Values:{}};Po.Uint32Values.read=function(t,e){return t.readFields(Po.Uint32Values._readField,{values:[]},e)},Po.Uint32Values._readField=function(t,e,r){t===1&&(e.readValuesInto=function(s){if(s.type!==2)throw new Error(`Unsupported pbf type "${s.type}"`);const l=function(f){return f.type===2?f.readVarint()+f.pos:f.pos+1}(s),u=s.pos;return s.pos=l,function(f){s.pos=u;let _=0;for(;s.pos<l;){const v=s.readVarint();f[_++]=v}return f}}(r))},Po.Fixed32Values={},Po.Fixed32Values.read=function(t,e){return t.readFields(Po.Fixed32Values._readField,{values:[]},e)},Po.Fixed32Values._readField=function(t,e,r){throw new Error("Not implemented")};/**
 * tiny-lru
 *
 * @copyright 2023 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.2.5
 */class dk{constructor(e=0,r=0,s=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=s,this.size=0,this.ttl=r}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const r=this.items[e];delete this.items[e],this.size--,r.prev!==null&&(r.prev.next=r.next),r.next!==null&&(r.next.prev=r.prev),this.first===r&&(this.first=r.next),this.last===r&&(this.last=r.prev)}return this}entries(e=this.keys()){return e.map(r=>[r,this.get(r)])}evict(e=!1){if(e||this.size>0){const r=this.first;delete this.items[r.key],--this.size==0?(this.first=null,this.last=null):(this.first=r.next,this.first.prev=null)}return this}expiresAt(e){let r;return this.has(e)&&(r=this.items[e].expiry),r}get(e){let r;if(this.has(e)){const s=this.items[e];this.ttl>0&&s.expiry<=Date.now()?this.delete(e):(r=s.value,this.set(e,r,!0))}return r}has(e){return e in this.items}keys(){const e=[];let r=this.first;for(;r!==null;)e.push(r.key),r=r.next;return e}set(e,r,s=!1,l=this.resetTtl){let u;if(s||this.has(e)){if(u=this.items[e],u.value=r,s===!1&&l&&(u.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==u){const f=this.last,_=u.next,v=u.prev;this.first===u&&(this.first=u.next),u.next=null,u.prev=this.last,f.next=u,v!==null&&(v.next=_),_!==null&&(_.prev=v)}}else this.max>0&&this.size===this.max&&this.evict(!0),u=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:r},++this.size==1?this.first=u:this.last.next=u;return this.last=u,this}values(e=this.keys()){return e.map(r=>this.get(r))}}function fk(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let s=2;s>=1;s--){const l=s===1?1:0,u=s===2?1:0;for(let f=0;f<e[0];f++){const _=e[1]*f;for(let v=l;v<e[1];v++){const x=e[2]*(v+_);for(let w=u;w<e[2];w++){const E=e[3]*(w+x);for(let I=0;I<e[3];I++){const L=E+I;t[L]+=t[L-r]}}}}r*=e[s]}return t}function pk(t){for(let e=0,r=t.length;e<r;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function mk(t,e){switch(e){case"uint32":return t;case"uint16":for(let r=0;r<t.length;r+=2){const s=t[r],l=t[r+1];t[r]=(240&s)>>4|(61440&s)>>8|(240&l)<<4|61440&l,t[r+1]=15&s|(3840&s)>>4|(15&l)<<8|(3840&l)<<4}return t;case"uint8":for(let r=0;r<t.length;r+=4){const s=t[r],l=t[r+1],u=t[r+2],f=t[r+3];t[r+0]=(192&s)>>6|(192&l)>>4|(192&u)>>2|192&f,t[r+1]=(48&s)>>4|(48&l)>>2|48&u|(48&f)<<2,t[r+2]=(12&s)>>2|12&l|(12&u)<<2|(12&f)<<4,t[r+3]=3&s|(3&l)<<2|(3&u)<<4|(3&f)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class $l extends Error{constructor(e){super(e),this.name="MRTError"}}var Ws=Uint8Array,kh=Uint16Array,_k=Int32Array,TS=new Ws([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),SS=new Ws([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gk=new Ws([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),MS=function(t,e){for(var r=new kh(31),s=0;s<31;++s)r[s]=e+=1<<t[s-1];var l=new _k(r[30]);for(s=1;s<30;++s)for(var u=r[s];u<r[s+1];++u)l[u]=u-r[s]<<5|s;return{b:r,r:l}},ES=MS(TS,2),AS=ES.b,yk=ES.r;AS[28]=258,yk[258]=28;for(var vk=MS(SS,0).b,d0=new kh(32768),di=0;di<32768;++di){var Oh=(43690&di)>>1|(21845&di)<<1;d0[di]=((65280&(Oh=(61680&(Oh=(52428&Oh)>>2|(13107&Oh)<<2))>>4|(3855&Oh)<<4))>>8|(255&Oh)<<8)>>1}var _p=function(t,e,r){for(var s=t.length,l=0,u=new kh(e);l<s;++l)t[l]&&++u[t[l]-1];var f,_=new kh(e);for(l=1;l<e;++l)_[l]=_[l-1]+u[l-1]<<1;if(r){f=new kh(1<<e);var v=15-e;for(l=0;l<s;++l)if(t[l])for(var x=l<<4|t[l],w=e-t[l],E=_[t[l]-1]++<<w,I=E|(1<<w)-1;E<=I;++E)f[d0[E]>>v]=x}else for(f=new kh(s),l=0;l<s;++l)t[l]&&(f[l]=d0[_[t[l]-1]++]>>15-t[l]);return f},gp=new Ws(288);for(di=0;di<144;++di)gp[di]=8;for(di=144;di<256;++di)gp[di]=9;for(di=256;di<280;++di)gp[di]=7;for(di=280;di<288;++di)gp[di]=8;var IS=new Ws(32);for(di=0;di<32;++di)IS[di]=5;var xk=_p(gp,9,1),bk=_p(IS,5,1),f0=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},Do=function(t,e,r){var s=e/8|0;return(t[s]|t[s+1]<<8)>>(7&e)&r},p0=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(7&e)},wk=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Lo=function(t,e,r){var s=new Error(e||wk[t]);if(s.code=t,Error.captureStackTrace&&Error.captureStackTrace(s,Lo),!r)throw s;return s},Tk=new Ws(0),Sk=typeof TextDecoder<"u"&&new TextDecoder;try{Sk.decode(Tk,{stream:!0})}catch{}const Mk={gzip_data:"gzip"},Ek={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Ak={uint32:1,uint16:2,uint8:4},Ik={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class CS{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const r=new Uint8Array(e),s=new DataView(e);if(r[0]!==13)throw new $l("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const r=new Uint8Array(e),s=this.getHeaderLength(e);if(r.length<s)throw new $l(`Expected header with length >= ${s} but got buffer of length ${r.length}`);const l=new Mh(r.subarray(0,s)),u=Lr.read(l);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new $l(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const f of u.layers)this.layers[f.name]=new Ck(f,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const r=[],s=this.getLayer(e.layerName);for(let l=0;l<s.dataIndex.length;l++){const u=s.dataIndex[l],f=u.first_byte-e.firstByte,_=u.last_byte+1-e.firstByte;if(l<e.firstBlock||l>e.lastBlock||s._blocksInProgress.has(l))continue;const v={layerName:s.name,firstByte:f,lastByte:_,pixelFormat:s.pixelFormat,blockIndex:l,blockShape:[u.bands.length].concat(s.bandShape),buffer:s.buffer,codec:u.codec.codec,filters:u.filters.map(x=>x.filter)};s._blocksInProgress.add(l),r.push(v)}return new PS(r,()=>{r.forEach(l=>s._blocksInProgress.delete(l.blockIndex))},(l,u)=>{if(r.forEach(f=>s._blocksInProgress.delete(f.blockIndex)),l)throw l;u.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class Ck{constructor({version:e,name:r,units:s,tilesize:l,pixel_format:u,buffer:f,data_index:_},v){if(this.version=e,this.version!==1)throw new $l(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=s,this.tileSize=l,this.buffer=f,this.pixelFormat=Ek[u],this.dataIndex=_,this.bandShape=[l+2*f,l+2*f,Ak[this.pixelFormat]],this._decodedBlocks=function(x=1e3,w=0,E=!1){if(isNaN(x)||x<0)throw new TypeError("Invalid max value");if(isNaN(w)||w<0)throw new TypeError("Invalid ttl value");if(typeof E!="boolean")throw new TypeError("Invalid resetTtl value");return new dk(x,w,E)}(v?v.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.set(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(const[s,l]of this.dataIndex.entries()){for(const[u,f]of l.bands.entries())if(f===e)return{bandIndex:r+u,blockIndex:s,blockBandIndex:u};r+=l.bands.length}break;case"number":for(const[s,l]of this.dataIndex.entries()){if(e>=r&&e<r+l.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-r};r+=l.bands.length}break;default:throw new $l(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new $l(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let r=1/0,s=-1/0,l=1/0,u=-1/0;for(const f of e){const{blockIndex:_}=this.getBlockForBand(f);if(_<0)throw new $l(`Invalid band: ${JSON.stringify(f)}`);const v=this.dataIndex[_];l=Math.min(l,_),u=Math.max(u,_),r=Math.min(r,v.first_byte),s=Math.max(s,v.last_byte)}return{layerName:this.name,firstByte:r,lastByte:s,firstBlock:l,lastBlock:u}}hasBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){const{blockIndex:r,blockBandIndex:s}=this.getBlockForBand(e),l=this._decodedBlocks.get(r.toString());if(!l)throw new $l(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const u=this.dataIndex[r],f=this.bandShape.reduce((x,w)=>x*w,1),_=s*f,v=l.subarray(_,_+f);return{data:v,bytes:new Uint8Array(v.buffer).subarray(v.byteOffset,v.byteOffset+v.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:u.offset,scale:u.scale}}}class PS{constructor(e,r,s){this.tasks=e,this._onCancel=r,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}CS.performDecoding=function(t,e){return Promise.all(e.tasks.map(r=>{const{layerName:s,firstByte:l,lastByte:u,pixelFormat:f,blockShape:_,blockIndex:v,filters:x,codec:w}=r,E=new Uint8Array(t).subarray(l,u+1),I=new Uint32Array(_[0]*_[1]*_[2]);let L;if(w!=="gzip_data")throw new Error(`Unhandled codec: ${w}`);return L=function(O,z){if(!globalThis.DecompressionStream&&z==="gzip_data")return Promise.resolve(((ee=function(ae){ae[0]==31&&ae[1]==139&&ae[2]==8||Lo(6,"invalid gzip data");var fe=ae[3],ve=10;4&fe&&(ve+=2+(ae[10]|ae[11]<<8));for(var we=(fe>>3&1)+(fe>>4&1);we>0;we-=!ae[ve++]);return ve+(2&fe)}(K=O))+8>K.length&&Lo(6,"invalid gzip data"),function(ae,fe,ve,we){var Le=ae.length;if(!Le||fe.f&&!fe.l)return ve||new Ws(0);var Te=!ve,je=Te||fe.i!=2,Ke=fe.i;Te&&(ve=new Ws(3*Le));var Be=function(us){var ts=ve.length;if(us>ts){var Ys=new Ws(Math.max(2*ts,us));Ys.set(ve),ve=Ys}},Xe=fe.f||0,ze=fe.p||0,Ze=fe.b||0,St=fe.l,et=fe.d,Jt=fe.m,Vt=fe.n,ot=8*Le;do{if(!St){Xe=Do(ae,ze,1);var vr=Do(ae,ze+1,3);if(ze+=3,!vr){var or=ae[(un=4+((ze+7)/8|0))-4]|ae[un-3]<<8,Zt=un+or;if(Zt>Le){Ke&&Lo(0);break}je&&Be(Ze+or),ve.set(ae.subarray(un,Zt),Ze),fe.b=Ze+=or,fe.p=ze=8*Zt,fe.f=Xe;continue}if(vr==1)St=xk,et=bk,Jt=9,Vt=5;else if(vr==2){var at=Do(ae,ze,31)+257,fr=Do(ae,ze+10,15)+4,Br=at+Do(ae,ze+5,31)+1;ze+=14;for(var wr=new Ws(Br),Nr=new Ws(19),Ar=0;Ar<fr;++Ar)Nr[gk[Ar]]=Do(ae,ze+3*Ar,7);ze+=3*fr;var tn=f0(Nr),Pr=(1<<tn)-1,Pn=_p(Nr,tn,1);for(Ar=0;Ar<Br;){var un,fn=Pn[Do(ae,ze,Pr)];if(ze+=15&fn,(un=fn>>4)<16)wr[Ar++]=un;else{var yn=0,hn=0;for(un==16?(hn=3+Do(ae,ze,3),ze+=2,yn=wr[Ar-1]):un==17?(hn=3+Do(ae,ze,7),ze+=3):un==18&&(hn=11+Do(ae,ze,127),ze+=7);hn--;)wr[Ar++]=yn}}var qn=wr.subarray(0,at),Sn=wr.subarray(at);Jt=f0(qn),Vt=f0(Sn),St=_p(qn,Jt,1),et=_p(Sn,Vt,1)}else Lo(1);if(ze>ot){Ke&&Lo(0);break}}je&&Be(Ze+131072);for(var ii=(1<<Jt)-1,xi=(1<<Vt)-1,Ui=ze;;Ui=ze){var Un=(yn=St[p0(ae,ze)&ii])>>4;if((ze+=15&yn)>ot){Ke&&Lo(0);break}if(yn||Lo(2),Un<256)ve[Ze++]=Un;else{if(Un==256){Ui=ze,St=null;break}var Jn=Un-254;Un>264&&(Jn=Do(ae,ze,(1<<(ki=TS[Ar=Un-257]))-1)+AS[Ar],ze+=ki);var Li=et[p0(ae,ze)&xi],Ri=Li>>4;if(Li||Lo(3),ze+=15&Li,Sn=vk[Ri],Ri>3){var ki=SS[Ri];Sn+=p0(ae,ze)&(1<<ki)-1,ze+=ki}if(ze>ot){Ke&&Lo(0);break}je&&Be(Ze+131072);var On=Ze+Jn;if(Ze<Sn){var Cs=0-Sn,Ul=Math.min(Sn,On);for(Cs+Ze<0&&Lo(3);Ze<Ul;++Ze)ve[Ze]=we[Cs+Ze]}for(;Ze<On;++Ze)ve[Ze]=ve[Ze-Sn]}}fe.l=St,fe.p=Ui,fe.b=Ze,fe.f=Xe,St&&(Xe=1,fe.m=Jt,fe.d=et,fe.n=Vt)}while(!Xe);return Ze!=ve.length&&Te?function(us,ts,Ys){return(ts==null||ts<0)&&(ts=0),(Ys==null||Ys>us.length)&&(Ys=us.length),new Ws(us.subarray(ts,Ys))}(ve,0,Ze):ve.subarray(0,Ze)}(K.subarray(ee,-8),{i:2},new Ws(((V=K)[(j=V.length)-4]|V[j-3]<<8|V[j-2]<<16|V[j-1]<<24)>>>0),void 0)));var V,j,K,ee;const Q=Mk[z];if(!Q)throw new Error(`Unhandled codec: ${z}`);const le=new globalThis.DecompressionStream(Q);return new Response(new Blob([O]).stream().pipeThrough(le)).arrayBuffer().then(ae=>new Uint8Array(ae))}(E,w).then(O=>{const z=Po.read(new Mh(O));if(z.values==="uint32_values")return z.uint32_values.readValuesInto(I),new Ik[f](I.buffer);throw new Error(`Unhandled numeric data "${z.values}"`)}),L.then(O=>{for(let z=x.length-1;z>=0;z--)switch(x[z]){case"delta_filter":fk(O,_);break;case"zigzag_filter":pk(O);break;case"bitshuffle_filter":mk(O,f);break;default:throw new Error(`Unhandled filter "${x[z]}"`)}return{layerName:s,blockIndex:v,data:O}}).catch(O=>{throw O})}))},qt(PS,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const DS=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class m0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const u=DS[15&s];if(!u)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new m0(_,f,u,e)}constructor(e,r=64,s=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const u=DS.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-_%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+v,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+_+v),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+v,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=r,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return _0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:_}=this,v=[0,u.length-1,0],x=[];for(;v.length;){const w=v.pop()||0,E=v.pop()||0,I=v.pop()||0;if(E-I<=_){for(let V=I;V<=E;V++){const j=f[2*V],K=f[2*V+1];j>=e&&j<=s&&K>=r&&K<=l&&x.push(u[V])}continue}const L=I+E>>1,O=f[2*L],z=f[2*L+1];O>=e&&O<=s&&z>=r&&z<=l&&x.push(u[L]),(w===0?e<=O:r<=z)&&(v.push(I),v.push(L-1),v.push(1-w)),(w===0?s>=O:l>=z)&&(v.push(L+1),v.push(E),v.push(1-w))}return x}within(e,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:u,nodeSize:f}=this,_=[0,l.length-1,0],v=[],x=s*s;for(;_.length;){const w=_.pop()||0,E=_.pop()||0,I=_.pop()||0;if(E-I<=f){for(let V=I;V<=E;V++)RS(u[2*V],u[2*V+1],e,r)<=x&&v.push(l[V]);continue}const L=I+E>>1,O=u[2*L],z=u[2*L+1];RS(O,z,e,r)<=x&&v.push(l[L]),(w===0?e-s<=O:r-s<=z)&&(_.push(I),_.push(L-1),_.push(1-w)),(w===0?e+s>=O:r+s>=z)&&(_.push(L+1),_.push(E),_.push(1-w))}return v}}function _0(t,e,r,s,l,u){if(l-s<=r)return;const f=s+l>>1;LS(t,e,f,s,l,u),_0(t,e,r,s,f-1,1-u),_0(t,e,r,f+1,l,1-u)}function LS(t,e,r,s,l,u){for(;l>s;){if(l-s>600){const x=l-s+1,w=r-s+1,E=Math.log(x),I=.5*Math.exp(2*E/3),L=.5*Math.sqrt(E*I*(x-I)/x)*(w-x/2<0?-1:1);LS(t,e,r,Math.max(s,Math.floor(r-w*I/x+L)),Math.min(l,Math.floor(r+(x-w)*I/x+L)),u)}const f=e[2*r+u];let _=s,v=l;for(yp(t,e,s,r),e[2*l+u]>f&&yp(t,e,s,l);_<v;){for(yp(t,e,_,v),_++,v--;e[2*_+u]<f;)_++;for(;e[2*v+u]>f;)v--}e[2*s+u]===f?yp(t,e,s,v):(v++,yp(t,e,v,l)),v<=r&&(s=v+1),r<=v&&(l=v-1)}}function yp(t,e,r,s){g0(t,r,s),g0(e,2*r,2*s),g0(e,2*r+1,2*s+1)}function g0(t,e,r){const s=t[e];t[e]=t[r],t[r]=s}function RS(t,e,r,s){const l=t-r,u=e-s;return l*l+u*u}o.$=zT,o.A=th,o.B=df,o.C=rn,o.D=Ce,o.E=ol,o.F=Zn,o.G=wt,o.H=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return ct(t.expression.evaluate(e))}interpolate(t,e,r){return{x:en(t.x,e.x,r),y:en(t.y,e.y,r),z:en(t.z,e.z,r),azimuthal:en(t.azimuthal,e.azimuthal,r),polar:en(t.polar,e.polar,r)}}},o.I=Hv,o.J=bo,o.K=Yn,o.L=ln,o.M=class{constructor(t,e,r,s){this.id=t,this.position=e!=null?new be(e[0],e[1]):new be(0,0),this.orientation=r??[0,0,0],this.nodes=s,this.uploaded=!1,this.aabb=new ti([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(o.a6.multiply(t.matrix,e,t.matrix),t.meshes)for(const r of t.meshes){const s=ti.applyTransform(r.aabb,t.matrix);this.aabb.encapsulate(s)}if(t.children)for(const r of t.children)this._applyTransformations(r,t.matrix)}computeBoundsAndApplyParent(){const t=o.a6.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,r,s,l,u,f=!1){tS(this.matrix,this,t.transform,this.position,e,r,s,l,u,f)}upload(t){if(!this.uploaded){for(const e of this.nodes)i0(e,t);for(const e of this.nodes)K_(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)s0(t)}},o.O=vn,o.P=Se,o.Q=Nc,o.R=Ci,o.S=Ll,o.T=e0,o.U=en,o.V=kt,o.W=fm,o.X=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([r,s]){const l=ct([1,r,s]);return{x:l.x,y:l.y,z:l.z}}(t.expression.evaluate(e))}interpolate(t,e,r){return{x:en(t.x,e.x,r),y:en(t.y,e.y,r),z:en(t.z,e.z,r)}}},o.Y=function(t,e,r=0,s=!0){const l=new Se(r,r),u=t.sub(l),f=e.add(l),_=[u,new Se(f.x,u.y),f,new Se(u.x,f.y)];return s&&_.push(u.clone()),_},o.Z=Oc,o._=function(t,e){const r=[];for(let s=0;s<t.length;s++){const l=Ft(s-1,-1,t.length-1),u=Ft(s+1,-1,t.length-1),f=t[s],_=t[u],v=t[l].sub(f).unit(),x=_.sub(f).unit(),w=x.angleWithSep(v.x,v.y),E=v.add(x).unit().mult(-1*e/Math.sin(w/2));r.push(f.add(E))}return r},o.a=yd,o.a$=function(t){const e=[];for(const r in t)e.push(t[r]);return e},o.a0=F1,o.a1=function(t,e,r=0){return o.N.fromValues(((e.x-r)*t.scale-t.x)*kt,(e.y*t.scale-t.y)*kt,Dn(e.z,e.y))},o.a2=xv,o.a3=eT,o.a4=function(t){let e=1/0,r=1/0,s=-1/0,l=-1/0;for(const u of t)e=Math.min(e,u.x),r=Math.min(r,u.y),s=Math.max(s,u.x),l=Math.max(l,u.y);return{min:new Se(e,r),max:new Se(s,l)}},o.a5=kr,o.a8=So,o.a9=mn,o.aA=Dm,o.aB=ni,o.aC=dn,o.aD=Wm,o.aE=G_,o.aF=function(){gs.isLoading()||gs.isLoaded()||Jo()!=="deferred"||Sf()},o.aG=ys,o.aH=yi,o.aI=mS,o.aJ=tr,o.aK=Nv,o.aL=zv,o.aM=Si,o.aN=Us,o.aO=Bf,o.aP=rw,o.aQ=w_,o.aR=Qv,o.aS=function(t,e){const r=Ll(e.zoom);if(r===0)return oa(t);const s=m_(t),l=Sv(s),u=kr(s.getWest())*e.worldSize,f=kr(s.getEast())*e.worldSize,_=Mr(s.getNorth())*e.worldSize,v=Mr(s.getSouth())*e.worldSize,x=[u,_,0],w=[f,_,0],E=[u,v,0],I=[f,v,0],L=o.a6.invert([],e.globeMatrix);return o.N.transformMat4(x,x,L),o.N.transformMat4(w,w,L),o.N.transformMat4(E,E,L),o.N.transformMat4(I,I,L),l[0]=Ua(l[0],E,r),l[1]=Ua(l[1],I,r),l[2]=Ua(l[2],w,r),l[3]=Ua(l[3],x,r),ti.fromPoints(l)},o.aT=g_,o.aU=Wf,o.aV=Ua,o.aW=Qi,o.aX=SD,o.aY=Kt,o.aZ=CS,o.a_=Ye,o.aa=zt,o.ab=J,o.ac=function(t,e){const r={};for(let s=0;s<e.length;s++){const l=e[s];l in t&&(r[l]=t[l])}return r},o.ad=Oe,o.ae=Mr,o.af=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,r,s){const l=this.entries[t]=this.entries[t]||{callbacks:[]};if(l.result){const[u,f]=l.result;return this.scheduler?this.scheduler.add(()=>{s(u,f)},e):s(u,f),()=>{}}return l.callbacks.push(s),l.cancel||(l.cancel=r((u,f)=>{l.result=[u,f];for(const _ of l.callbacks)this.scheduler?this.scheduler.add(()=>{_(u,f)},e):_(u,f);setTimeout(()=>delete this.entries[t],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(u=>u!==s),l.callbacks.length||(l.cancel(),delete this.entries[t]))}}},o.ag=Pf,o.ah=function(t,e,r){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},l=>{const u=Ye(t.request,(f,_,v,x)=>{f?l(f):_&&l(null,{vectorTile:r?void 0:new Fv(new Mh(_)),rawData:_,cacheControl:v,expires:x})});return()=>{u.cancel(),l()}},e)},o.ai=function(t){Sr++,Sr>Ht&&(t.getActor().send("enforceCacheSizeLimit",Ge),Sr=0)},o.aj=mi,o.ak=We,o.al=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.am=_t,o.an=HT,o.ao=qT,o.ap=GT,o.aq=function(t,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<t.length;s++){const l=document.createElement("source");pt(t[s])||(r.crossOrigin="Anonymous"),l.src=t[s],r.appendChild(l)}return{cancel:()=>{}}},o.ar=q_,o.as=sp,o.at=Ir,o.au=nn,o.av=wo,o.aw=wi,o.ax=hi,o.ay=wn,o.az=za,o.b=wa,o.b$=Um,o.b0=function(t,e){const r=[];for(const s in t)s in e||r.push(s);return r},o.b1=zr,o.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.b3=function(t,e){const{x:r,y:s}=t.point,l=lw(r,s,t.worldSize/t._pixelsPerMercatorPixel,0,0);return o.a6.multiply(l,l,Mv(oa(e)))},o.b5=wh,o.b6=qs,o.b7=P_,o.b8=function(t,e,r,s,l){const u=5*e+2;t.float32[u+0]=r,t.float32[u+1]=s,t.float32[u+2]=l},o.b9=j_,o.bA=Z_,o.bB=WT,o.bC=function(t){const e=WT(t,!0);return o.b4.invert([],[e[0],e[1],e[4],e[5]])},o.bD=bv,o.bE=function(t){const{x:e,y:r}=t.point,{lng:s,lat:l}=t._center;return lw(e,r,t.worldSize,s,l)},o.bF=jt,o.bG=ne,o.bH=function(t){const e=Math.round((t+45+360)%360/90)%4;return Ur[e]},o.bI=45,o.bJ=ar,o.bK=d,o.bL=ra,o.bM=l_,o.bN=Wi,o.bO=ph,o.bP=h,o.bQ=function(t,e,r){const s=Math.sqrt(t*t+e*e+r*r),l=s>0?Math.acos(r/s)*xr:0;let u=t!==0||e!==0?Math.atan2(-e,-t)*xr+90:0;return u<0&&(u+=360),[s,u,l]},o.bR=Yr,o.bS=ti,o.bT=ct,o.bU=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},o.bV=function(t){return t({pluginStatus:ss,pluginURL:Ko}),Tf.on("pluginStateChange",t),t},o.bW=Dh,o.bX=J_,o.bY=Ah,o.bZ=qv,o.b_=jn,o.ba=MT,o.bb=to,o.bc=Hi,o.bd=LT,o.be=Yv,o.bf=Gv,o.bg=m0,o.bh=Ft,o.bj=Ve,o.bk=te,o.bl=Cr,o.bm=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},o.bn=be,o.bo=$T,o.bp=xt,o.bq=wv,o.br=YT,o.bs=st,o.bt=sw,o.bu=function(t,e,r,s,l,u,f,_,v){if(v.name==="globe")return sw(t,e,new st(r,s,l),!1);const x=sp({z:r,x:s,y:l},v);return new ti([(u+x.x/x.scale)*e,e*(x.y/x.scale),f],[(u+x.x2/x.scale)*e,e*(x.y2/x.scale),_])},o.bv=function(t,e,r){let s=0;for(let l=0;l<2;++l){const u=r?r[l]:0;t[l]>u&&(s+=(t[l]-u)*(t[l]-u)),e[l]<u&&(s+=(u-e[l])*(u-e[l]))}return s},o.bw=qr,o.bx=Y,o.by=function(t){const e=o.a6.identity(new Float64Array(16));o.a6.multiply(e,t.pixelMatrix,t.globeMatrix);const r=[0,ge,0],s=[0,De,0];return o.N.transformMat4(r,r,e),o.N.transformMat4(s,s,e),[r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!Av(t,new be(t.center.lat,90)),s[0]>0&&s[0]<=t.width&&s[1]>0&&s[1]<=t.height&&!Av(t,new be(t.center.lat,-90))]},o.bz=function(t,e){const{scale:r}=t.tileTransform,s=r*kt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return o.b4.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},o.c=fS,o.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.c0=oe,o.c1=Kr,o.c2=function(t,e,r){return t.type==="custom"?new RR(t,e):new hk[t.type](t,e,r)},o.c3=function(t){const e=t.indexOf(ah);return e>=0?t.slice(0,e):t},o.c4=function(t){return t.indexOf(ah)>=0},o.c5=function(t){const e=t.indexOf(ah);return e>=0?t.slice(e+1):""},o.c6=function(t){const e=[],r=t.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},o.c7=Vr,o.c8=Tf,o.c9=He,o.cA=nT,o.cB=(t,e,r,s,l,u)=>{const f=t.transform;return{u_matrix:rT(t,e,r,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:f.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:l,u_image:0,u_tile_units_to_pixels:tT(e,f),u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:u}},o.cC=(t,e,r,s,l,u,f)=>{const _=t.transform,v=_.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:rT(t,e,r,s),u_pixels_to_tile_units:v,u_device_pixel_ratio:u,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:l,u_texsize:iT(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:tT(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:f,u_emissive_strength:r.paint.get("line-emissive-strength")}},o.cD=bn,o.cE=Yf,o.cF=Yw,o.cG=Qt,o.cH=C_,o.cI=Ol,o.cJ=450,o.cK=7,o.cL=PR,o.cM=256,o.cN=Mv,o.cO=ta,o.cP=Ff,o.cQ=function(t,e,r,s,l){return zt((t-e)/(r-e)*(l-s)+s,s,l)},o.cR=Wr,o.cS=r0,o.cT=[1,1,1],o.cU=xh,o.cV=Ph,o.cW=Qs,o.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const e=Aw(new Se(0,0),new Se(kt,kt),t),r=[];for(const s of this._activeRegions){if(s.hiddenByOverlap||!Ew(e,s))continue;const l=uL(s.min,s.max,t);r.push({min:l.min,max:l.max,sourceId:this._sourceIds[s.priority],footprint:s.footprint,footprintTileId:s.tileId})}return r}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const r=[];for(const s of e.cache.getVisibleCoordinates()){const l=e.cache.getTile(s).buckets[e.layer];if(l)for(const u of l.getNodesInfo()){const f=u.node;f.footprint&&r.push({footprint:f.footprint,id:s.toUnwrapped()})}}return r}})))}_addSource(t){const e=t.getFootprints();if(e.length!==0){for(const r of e){if(!r.footprint)continue;const s=Aw(r.footprint.min,r.footprint.max,r.id);this._activeRegions.push({min:s.min,max:s.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:r.id,footprint:r.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||E_(e.min,r.min)||E_(e.max,r.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,r=0;for(;!t&&e!==this._activeRegions.length;){const s=this._activeRegions[e],l=this._prevRegions[r];t=s.priority!==l.priority||!Mw(s,l),++e,++r}}if(t){++this._updateTime;const e=r=>{const s=this._activeRegions;if(r>=s.length)return r;const l=s[r].priority;for(;r<s.length&&s[r].priority===l;)++r;return r};if(this._sourceIds.length>1){let r=0,s=e(r);for(;r!==s;){let l=r;const u=r;for(;l!==s;){const f=this._activeRegions[l];f.hiddenByOverlap=!1;for(let _=0;_<u;_++){const v=this._activeRegions[_];if(!v.hiddenByOverlap&&Ew(f,v)&&(f.hiddenByOverlap=Cw(f.footprint,f.tileId,v.footprint,v.tileId),f.hiddenByOverlap))break}++l}r=s,s=e(r)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},o.cY=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const r=new Us,s=new wi,l=[],u=t+1+2,f=e[0]+1,_=e[0]+1+(1+e.length),v=(x,w,E)=>{let I=x===u-1?x-2:x===0?x:x-1;return I+=E?24575:0,[I,w]};for(let x=0;x<u;++x)r.emplaceBack(...v(x,0,!0));for(let x=0;x<f;++x)for(let w=0;w<u;++w)r.emplaceBack(...v(w,x,(w===0||w===u-1)&&!0));for(let x=0;x<e.length;++x){const w=e[x];for(let E=0;E<u;++E)r.emplaceBack(...v(E,w,!0))}for(let x=0;x<e.length;++x){const w=s.length,E=e[x]+1+2,I=new wi;for(let z=0;z<E-1;z++){const V=z===E-2,j=V?u*(_-e.length+x-z):u;for(let K=0;K<u-1;K++){const ee=z*u+K;z===0||V||K===0||K===u-2?(I.emplaceBack(ee+1,ee,ee+j),I.emplaceBack(ee+j,ee+j+1,ee+1)):(s.emplaceBack(ee+1,ee,ee+j),s.emplaceBack(ee+j,ee+j+1,ee+1))}}const L=ni.simpleSegment(0,w,r.length,s.length-w);for(let z=0;z<I.uint16.length;z+=3)s.emplaceBack(I.uint16[z],I.uint16[z+1],I.uint16[z+2]);const O=ni.simpleSegment(0,w,r.length,s.length-w);l.push({withoutSkirts:L,withSkirts:O})}return{vertices:r,indices:s,segments:l}}_createGrid(t){const e=this._fillGridMeshWithLods(ce,de);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,rw.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new wi;for(let f=0;f<=ce;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const r=new ta,s=new ta,l=new ta,u=new ta;this._poleSegments=[];for(let f=0,_=0;f<ne;f++){const v=360/(1<<f);r.emplaceBack(0,-J,0,.5,0),s.emplaceBack(0,-J,0,.5,1),l.emplaceBack(0,-J,0,.5,.5),u.emplaceBack(0,-J,0,.5,.5);for(let x=0;x<=ce;x++){let w=x/ce,E=0;const I=en(0,v,w),[L,O,z]=xe(AD,ID,I,J);r.emplaceBack(L,O,z,w,E),s.emplaceBack(L,O,z,w,1-E);const V=Ve(I);w=.5+.5*Math.sin(V),E=.5+.5*Math.cos(V),l.emplaceBack(L,O,z,w,E),u.emplaceBack(L,O,z,w,1-E)}this._poleSegments.push(ni.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(r,f_,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(s,f_,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(l,f_,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(u,f_,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},o.cZ=function(t){return Bo.has(t)},o.c_=ur,o.ca=n,o.cb=class extends To{constructor(t){super(t),this.current=m}set(t,e,r){if(this.fetchUniformLocation(t,e)){for(let s=0;s<9;s++)if(r[s]!==this.current[s]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},o.cc=$e,o.cd=function(t,e,r){const s=Ll(r.zoom),l=t.style.map._antialias,u=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return s===0&&!l&&!u},o.ce=function(t){const e=t.pixelsPerMeter,r=e/Cr(1,t.center.lat),s=o.a6.identity(new Float64Array(16));return o.a6.translate(s,s,[t.point.x,t.point.y,0]),o.a6.scale(s,s,[r,r,e]),Float32Array.from(s)},o.cf=m_,o.cg=function(t){const e=qr-5;t=zt(t,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(Ve(t))),3);return Math.round(r*(de.length-1))},o.ch=function(t,e,r,s){const l=e.getNorth(),u=e.getSouth(),f=e.getWest(),_=e.getEast(),v=1<<t.z,x=_-f,w=l-u,E=x/ce,I=-w/de[r],L=[0,E,0,I,0,0,l,f,0];if(t.z>0){const O=180/s;o.co.multiply(L,L,[O/x+1,0,0,0,O/w+1,0,-.5*O/E,.5*O/I,1])}return L[2]=v,L[5]=t.x,L[8]=t.y,L},o.ci=oa,o.cj=function(t,e,r){const s=o.a6.identity(new Float64Array(16)),l=(e/(1<<t)-.5)*Math.PI*2;return o.a6.rotateY(s,r.globeMatrix,l),Float32Array.from(s)},o.ck=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const r=e.getSource().maxzoom,s=1<<r,l=Math.floor(t.x),u=Math.floor((t.x-l)*s),f=Math.floor(t.y*s),_=this.findDEMTileFor(new _t(r,l,r,u,f));return!(!_||!_.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const l=s.getSource().maxzoom,u=1<<l,f=Math.floor(t.x),_=t.x-f,v=new _t(l,f,l,Math.floor(_*u),Math.floor(t.y*u)),x=this.findDEMTileFor(v);if(!x||!x.dem)return e;const w=x.dem,E=1<<x.tileID.canonical.z,I=(_*E-x.tileID.canonical.x)*w.dim,L=(t.y*E-x.tileID.canonical.y)*w.dim,O=Math.floor(I),z=Math.floor(L);return(r?this.exaggeration():1)*en(en(w.get(O,z),w.get(O,z+1),L-z),en(w.get(O+1,z),w.get(O+1,z+1),L-z),I-O)}getAtTileOffset(t,e,r){const s=1<<t.canonical.z;return this.getAtPointOrZero(new ln(t.wrap+(t.canonical.x+e/kt)/s,(t.canonical.y+r/kt)/s))}getAtTileOffsetFunc(t,e,r,s){return l=>{const u=this.getAtTileOffset(t,l.x,l.y),f=s.upVector(t.canonical,l.x,l.y),_=s.upVectorScale(t.canonical,e,r).metersToTile;return o.N.scale(f,f,u*_),f}}getForTilePoints(t,e,r,s){if(this.isUsingMockSource())return!1;const l=xh.create(this,t,s);return!!l&&(e.forEach(u=>{u[2]=this.exaggeration()*l.getElevationAt(u[0],u[1],r)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const r=e.dem.tree,s=e.tileID,l=1<<t.canonical.z-s.canonical.z;let u=t.canonical.x/l-s.canonical.x,f=t.canonical.y/l-s.canonical.y,_=0;for(let v=0;v<t.canonical.z-s.canonical.z&&!r.leaves[_];v++){u*=2,f*=2;const x=2*Math.floor(f)+Math.floor(u);_=r.childOffsets[_]+x,u%=1,f%=1}return{min:this.exaggeration()*r.minimums[_],max:this.exaggeration()*r.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,r=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const l of t){const u=this.getMinMaxForTile(l.tileID);u&&(r=Math.min(r,u.min),s=Math.max(s,u.max),e=!0)}return e?{min:r,max:s}:null}},o.cl=p_,o.cm=gw,o.cn=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},o.cp=aw,o.cq=256,o.cr=function(t,e){const r=[0,0,0],s=g_(oa(e.canonical));return o.N.transformMat4(r,r,s),o.N.transformMat4(r,r,t),r},o.cs=t=>({u_camera_to_center_distance:new Wi(t),u_extrude_scale:new b(t),u_device_pixel_ratio:new Wi(t),u_matrix:new d(t),u_inv_rot_matrix:new d(t),u_merc_center:new ra(t),u_tile_id:new l_(t),u_zoom_transition:new Wi(t),u_up_dir:new l_(t),u_emissive_strength:new Wi(t)}),o.ct=t=>({u_matrix:new d(t),u_pixels_to_tile_units:new b(t),u_device_pixel_ratio:new Wi(t),u_units_to_pixels:new ra(t),u_dash_image:new ph(t),u_gradient_image:new ph(t),u_image_height:new Wi(t),u_texsize:new ra(t),u_tile_units_to_pixels:new Wi(t),u_alpha_discard_threshold:new Wi(t),u_trim_offset:new ra(t),u_emissive_strength:new Wi(t)}),o.cu=t=>({u_matrix:new d(t),u_texsize:new ra(t),u_pixels_to_tile_units:new b(t),u_device_pixel_ratio:new Wi(t),u_image:new ph(t),u_units_to_pixels:new ra(t),u_tile_units_to_pixels:new Wi(t),u_alpha_discard_threshold:new Wi(t),u_trim_offset:new ra(t)}),o.cv=uh,o.cw=NL,o.cx=VL,o.cy=hw,o.cz=(t,e,r,s,l,u)=>{const f=t.transform,_=f.projection.name==="globe";let v;if(u.paint.get("circle-pitch-alignment")==="map")if(_){const w=aw(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;v=Float32Array.from([w,0,0,w])}else v=f.calculatePixelsToTileUnitsMatrix(r);else v=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const x={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(f.projection),u_matrix:t.translatePosMatrix(e.projMatrix,r,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:nt.devicePixelRatio,u_extrude_scale:v,u_inv_rot_matrix:CD,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(_){x.u_inv_rot_matrix=s,x.u_merc_center=l,x.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],x.u_zoom_transition=Ll(f.zoom);const w=l[0]*kt,E=l[1]*kt;x.u_up_dir=f.projection.upVector(new st(0,0,0),w,E)}return x},o.d=Rt,o.d0=gr,o.d1=cn,o.d2=Ne,o.d3=function([t,e,r]){const s=Math.hypot(t,e,r),l=Math.atan2(t,r),u=.5*Math.PI-Math.acos(-e/s);return new be(jt(l),jt(u))},o.d4=Fe,o.d5=H,o.d6=Av,o.d7=cw,o.d8=function(t){const e=[0,0,0],r=o.a6.identity(new Float64Array(16));return o.a6.multiply(r,t.pixelMatrix,t.globeMatrix),o.N.transformMat4(e,e,r),new Se(e[0],e[1])},o.d9=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(r){if(Ie==null){const s=r.navigator?r.navigator.userAgent:null;Ie=!!r.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Ie}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.dA=Io,o.dB=pS,o.dC=_S,o.dD=Jw,o.dE=ir,o.dF=AT,o.dG=function(t,e,r,s,l,u,f,_,v,x,w){t.createArrays(),t.tilePixelRatio=kt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const E=t.layers[0].layout,I=t.layers[0]._unevaluatedLayout._values,L={};if(t.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:K}=t.textSizeData;L.compositeTextSizes=[I["text-size"].possiblyEvaluate(new Yn(j),_),I["text-size"].possiblyEvaluate(new Yn(K),_)]}if(t.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:K}=t.iconSizeData;L.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new Yn(j),_),I["icon-size"].possiblyEvaluate(new Yn(K),_)]}L.layoutTextSize=I["text-size"].possiblyEvaluate(new Yn(v+1),_),L.layoutIconSize=I["icon-size"].possiblyEvaluate(new Yn(v+1),_),L.textMaxSize=I["text-size"].possiblyEvaluate(new Yn(18),_);const O=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",z=E.get("text-size");let V=!1;for(const j of t.features)if(j.icon&&j.icon.nameSecondary){V=!0;break}for(const j of t.features){const K=E.get("text-font").evaluate(j,{},_).join(","),ee=z.evaluate(j,{},_),Q=L.layoutTextSize.evaluate(j,{},_),le=(L.layoutIconSize.evaluate(j,{},_),{horizontal:{},vertical:void 0}),ae=j.text;let fe,ve=[0,0];if(ae){const Te=ae.toString(),je=E.get("text-letter-spacing").evaluate(j,{},_)*Hi,Ke=E.get("text-line-height").evaluate(j,{},_)*Hi,Be=Ky(Te)?je:0,Xe=E.get("text-anchor").evaluate(j,{},_),ze=E.get("text-variable-anchor");if(!ze){const Vt=E.get("text-radial-offset").evaluate(j,{},_);ve=Vt?LT(Xe,[Vt*Hi,Wv]):E.get("text-offset").evaluate(j,{},_).map(ot=>ot*Hi)}let Ze=O?"center":E.get("text-justify").evaluate(j,{},_);const St=E.get("symbol-placement")==="point",et=St?E.get("text-max-width").evaluate(j,{},_)*Hi:1/0,Jt=Vt=>{t.allowVerticalPlacement&&Xo(Te)&&(le.vertical=jv(ae,e,r,l,K,et,Ke,Xe,Vt,Be,ve,qs.vertical,!0,Q,ee))};if(!O&&ze){const Vt=Ze==="auto"?ze.map(vr=>Yv(vr)):[Ze];let ot=!1;for(let vr=0;vr<Vt.length;vr++){const or=Vt[vr];if(!le.horizontal[or])if(ot)le.horizontal[or]=le.horizontal[0];else{const Zt=jv(ae,e,r,l,K,et,Ke,"center",or,Be,ve,qs.horizontal,!1,Q,ee);Zt&&(le.horizontal[or]=Zt,ot=Zt.positionedLines.length===1)}}Jt("left")}else{if(Ze==="auto"&&(Ze=Yv(Xe)),St||E.get("text-writing-mode").indexOf("horizontal")>=0||!Xo(Te)){const Vt=jv(ae,e,r,l,K,et,Ke,Xe,Ze,Be,ve,qs.horizontal,!1,Q,ee);Vt&&(le.horizontal[Ze]=Vt)}Jt(St?"left":Ze)}}let we=!1;if(j.icon&&j.icon.namePrimary){const Te=s[j.icon.namePrimary];Te&&(fe=sR(l[j.icon.namePrimary],j.icon.nameSecondary?l[j.icon.nameSecondary]:void 0,E.get("icon-offset").evaluate(j,{},_),E.get("icon-anchor").evaluate(j,{},_)),we=Te.sdf,t.sdfIcons===void 0?t.sdfIcons=Te.sdf:t.sdfIcons!==Te.sdf&&ye("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Te.pixelRatio!==t.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Le=kT(le.horizontal)||le.vertical;t.iconsInText||(t.iconsInText=!!Le&&Le.iconsInText),(Le||fe)&&dR(t,j,le,fe,s,L,Q,0,ve,we,f,_,x,w,V)}u&&t.generateCollisionDebugBuffers(v,t.collisionBoxArray)},o.dH=Fv,o.dI=Mh,o.dJ=A_,o.dK=gt,o.dL=S_,o.dM=T_,o.dN=lt,o.dO=lT,o.dP=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==oS){const r=new Uint32Array(t,0,7),[,,s,l,u,f]=r;e=r.byteLength+l+u+f+u,(s!==t.byteLength||e>=t.byteLength)&&ye("Invalid b3dm header information.")}return uS(t,e)},o.dQ=function(t,e){const r=fS(t);for(const s of r){for(const l of s.meshes)sk(l);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(ok(s.lights,e)))}return r},o.dR=rg,o.dS=rS,o.dT=gs,o.dU=function(t){Je(),Et&&Et.then(e=>{e.keys().then(r=>{for(let s=0;s<r.length-t;s++)e.delete(r[s])})})},o.da=class{constructor(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Tt,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!oe(t))return t;const r=Tr(t);return r.params.push(`sdk=js-${B}`),r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!oe(t))return t;const r=Tr(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeModelURL(t,e){if(!oe(t))return t;const r=Tr(t);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(t,e,r,s){if(!oe(t))return t;const l=Tr(t);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),r&&l.params.push(`language=${r}`),s&&l.params.push(`worldview=${s}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(t,e,r,s){const l=Tr(t);return oe(t)?(l.path=`/styles/v1${l.path}/sprite${e}${r}`,this._makeAPIURL(l,this._customAccessToken||s)):(l.path+=`${e}${r}`,Qr(l))}normalizeTileURL(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!oe(t))return t;const s=Tr(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&s.authority!=="raster"&&r===512?"@2x":""}${Rr.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${H.RASTER_URL_PREFIX}${s.path}`:s.authority==="rasterarrays"?s.path=`/${H.RASTERARRAYS_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${H.TILE_URL_VERSION}${s.path}`);const l=this._customAccessToken||function(u){for(const f of u){const _=f.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(s.params)||H.ACCESS_TOKEN;return H.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,l)}canonicalizeTileURL(t,e){const r=Tr(t);if(!r.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let s="mapbox://";r.path.match(/^\/raster\/v1\//)?s+=`raster/${r.path.replace(`/${H.RASTER_URL_PREFIX}/`,"")}`:r.path.match(/^\/rasterarrays\/v1\//)?s+=`rasterarrays/${r.path.replace(`/${H.RASTERARRAYS_URL_PREFIX}/`,"")}`:s+=`tiles/${r.path.replace(`/${H.TILE_URL_VERSION}/`,"")}`;let l=r.params;return e&&(l=l.filter(u=>!u.match(/^access_token=/))),l.length&&(s+=`?${l.join("&")}`),s}canonicalizeTileset(t,e){const r=!!e&&oe(e),s=[];for(const l of t.tiles||[])ie(l)?s.push(this.canonicalizeTileURL(l,r)):s.push(l);return s}_makeAPIURL(t,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=Tr(H.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,t.protocol==="http"){const l=t.params.indexOf("secure");l>=0&&t.params.splice(l,1)}if(s.path!=="/"&&(t.path=`${s.path}${t.path}`),!H.REQUIRE_ACCESS_TOKEN)return Qr(t);if(e=e||H.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter(l=>l.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Qr(t)}},o.db=function(t,e){e?Bo.add(t):Bo.delete(t)},o.dc=Rr,o.dd=zs,o.de=yc,o.df=Nt,o.dg=pn,o.dh=function(t){Bo.delete(t)},o.di=Bi,o.dj=Fi,o.dk=B,o.dl=function(t,e){Ge=t,Ht=e},o.dm=function(t,e,r=!1){if(ss===yf||ss===vf||ss===xf)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ko=nt.resolveURL(t),ss=yf,bf=e,wf(),r||Sf()},o.dn=Jo,o.dp=function(){J_().acquire(o0)},o.dq=function(){const t=fp;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(o0),fp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.dr=dp,o.ds=function(t){const e=ue();if(!e)return;const r=e.delete(Ut);t&&r.catch(t).then(()=>t())},o.dt=hp,o.du=nS,o.dv=function(t){a0=nt.resolveURL(t),Rh||(Rh=new Dh(J_(),new ol)),Rh.broadcast("setDracoUrl",a0)},o.dw=iS,o.dx=function(t){Lh=nt.resolveURL(t),Rh||(Rh=new Dh(J_(),new ol)),Rh.broadcast("setMeshoptUrl",Lh)},o.dy=qt,o.dz=Rl,o.e=nr,o.f=nt,o.g=function(t,e){return He(nr(t,{type:"json"}),e)},o.h=Hs,o.i=dl,o.j=bd,o.k=eh,o.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>uS(e,0,t))},o.m=km,o.n=kc,o.o=$c,o.p=ET,o.q=ih,o.r=nh,o.s=ff,o.t=Ic,o.u=Vc,o.v=Vi,o.w=ye,o.x=gl,o.z=Af}),C(["./shared"],function(o){function B(Ie){const Z=Ie?Ie.url.toString():void 0;return Z?performance.getEntriesByName(Z):[]}function $(Ie){if(typeof Ie=="number"||typeof Ie=="boolean"||typeof Ie=="string"||Ie==null)return JSON.stringify(Ie);if(Array.isArray(Ie)){let te="[";for(const he of Ie)te+=`${$(he)},`;return`${te}]`}let Z="{";for(const te of Object.keys(Ie).sort())Z+=`${te}:${$(Ie[te])},`;return`${Z}}`}function H(Ie){let Z="";for(const te of o.b2)Z+=`/${$(Ie[te])}`;return Z}class ie{constructor(Z){this.keyCache={},this._layers={},this._layerConfigs={},Z&&this.replace(Z)}replace(Z,te){this._layerConfigs={},this._layers={},this.update(Z,[],te)}update(Z,te,he){this._options=he;for(const We of Z)this._layerConfigs[We.id]=We,(this._layers[We.id]=o.c2(We,this.scope,this._options)).compileFilter(),this.keyCache[We.id]&&delete this.keyCache[We.id];for(const We of te)delete this.keyCache[We],delete this._layerConfigs[We],delete this._layers[We];this.familiesBySource={};const ke=function(We,nt){const Ut={};for(let Ht=0;Ht<We.length;Ht++){const Et=nt&&nt[We[Ht].id]||H(We[Ht]);nt&&(nt[We[Ht].id]=Et);let Pe=Ut[Et];Pe||(Pe=Ut[Et]=[]),Pe.push(We[Ht])}const Ge=[];for(const Ht in Ut)Ge.push(Ut[Ht]);return Ge}(o.a$(this._layerConfigs),this.keyCache);for(const We of ke){const nt=We.map(ue=>this._layers[ue.id]),Ut=nt[0];if(Ut.visibility==="none")continue;const Ge=Ut.source||"";let Ht=this.familiesBySource[Ge];Ht||(Ht=this.familiesBySource[Ge]={});const Et=Ut.sourceLayer||"_geojsonTileLayer";let Pe=Ht[Et];Pe||(Pe=Ht[Et]=[]),Pe.push(nt)}}}const oe=1*o.dA;class _e{constructor(Z){const te={},he=[];for(const Ut in Z){const Ge=Z[Ut],Ht=te[Ut]={};for(const Et in Ge.glyphs){const Pe=Ge.glyphs[+Et];if(!Pe||Pe.bitmap.width===0||Pe.bitmap.height===0)continue;const ue=Pe.metrics.localGlyph?oe:1,Je={x:0,y:0,w:Pe.bitmap.width+2*ue,h:Pe.bitmap.height+2*ue};he.push(Je),Ht[Et]=Je}}const{w:ke,h:We}=o.p(he),nt=new o.dz({width:ke||1,height:We||1});for(const Ut in Z){const Ge=Z[Ut];for(const Ht in Ge.glyphs){const Et=Ge.glyphs[+Ht];if(!Et||Et.bitmap.width===0||Et.bitmap.height===0)continue;const Pe=te[Ut][Ht],ue=Et.metrics.localGlyph?oe:1;o.dz.copy(Et.bitmap,nt,{x:0,y:0},{x:Pe.x+ue,y:Pe.y+ue},Et.bitmap)}}this.image=nt,this.positions=te}}o.dy(_e,"GlyphAtlas");class Me{constructor(Z){this.tileID=new o.am(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.scope=Z.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.promoteId=Z.promoteId,this.isSymbolTile=Z.isSymbolTile,this.tileTransform=o.as(Z.tileID.canonical,Z.projection),this.projection=Z.projection,this.brightness=Z.brightness,this.extraShadowCaster=!!Z.extraShadowCaster}parse(Z,te,he,ke,We){this.status="parsing",this.data=Z,this.collisionBoxArray=new o.aD;const nt=new o.dB(Object.keys(Z.layers).sort()),Ut=new o.dC(this.tileID,this.promoteId);Ut.bucketLayerIDs=[];const Ge={},Ht=new o.dD(256,256),Et={featureIndex:Ut,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ht,availableImages:he,brightness:this.brightness},Pe=te.familiesBySource[this.source];for(const Hr in Pe){const Tn=Z.layers[Hr];if(!Tn)continue;let Qn=!1,An=!1,Vn=!1;for(const Wn of Pe[Hr])Wn[0].type==="symbol"?Qn=!0:An=!0,Wn[0].is3D()&&Wn[0].type!=="model"&&(Vn=!0);if(this.extraShadowCaster&&!Vn||this.isSymbolTile===!0&&!Qn||this.isSymbolTile===!1&&!An)continue;Tn.version===1&&o.w(`Vector tile source "${this.source}" layer "${Hr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const bi=nt.encode(Hr),Ci=[];for(let Wn=0;Wn<Tn.length;Wn++){const jn=Tn.feature(Wn),He=Ut.getId(jn,Hr);Ci.push({feature:jn,id:He,index:Wn,sourceLayerIndex:bi})}for(const Wn of Pe[Hr]){const jn=Wn[0];(!this.extraShadowCaster||jn.is3D()&&jn.type!=="model")&&(this.isSymbolTile!==void 0&&jn.type==="symbol"!==this.isSymbolTile||jn.minzoom&&this.zoom<Math.floor(jn.minzoom)||jn.maxzoom&&this.zoom>=jn.maxzoom||jn.visibility!=="none"&&(Re(Wn,this.zoom,Et.brightness,he),(Ge[jn.id]=jn.createBucket({index:Ut.bucketLayerIDs.length,layers:Wn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:bi,sourceID:this.source,projection:this.projection.spec})).populate(Ci,Et,this.tileID.canonical,this.tileTransform),Ut.bucketLayerIDs.push(Wn.map(He=>He.id))))}}let ue,Je,Ot,hr;Ht.trim();const Sr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Rr=()=>{if(ue)return this.status="done",We(ue);if(this.extraShadowCaster)this.status="done",We(null,{buckets:o.a$(Ge).filter(Hr=>!Hr.isEmpty()),featureIndex:Ut,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Et.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Je&&Ot&&hr){const Hr=new _e(Je),Tn=new o.dF(Ot,hr);for(const Qn in Ge){const An=Ge[Qn];An instanceof o.aE?(Re(An.layers,this.zoom,Et.brightness,he),o.dG(An,Je,Hr.positions,Ot,Tn.iconPositions,this.showCollisionBoxes,he,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):An.hasPattern&&(An instanceof o.aK||An instanceof o.aL||An instanceof o.cH)&&(Re(An.layers,this.zoom,Et.brightness,he),An.addFeatures(Et,this.tileID.canonical,Tn.patternPositions,he,this.tileTransform,this.brightness))}this.status="done",We(null,{buckets:o.a$(Ge).filter(Qn=>!Qn.isEmpty()),featureIndex:Ut,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Hr.image,lineAtlas:Ht,imageAtlas:Tn,brightness:Et.brightness})}};if(!this.extraShadowCaster){const Hr=o.dE(Et.glyphDependencies,An=>Object.keys(An).map(Number));Object.keys(Hr).length?ke.send("getGlyphs",{uid:this.uid,stacks:Hr,scope:this.scope},(An,Vn)=>{ue||(ue=An,Je=Vn,Rr())},void 0,!1,Sr):Je={};const Tn=Object.keys(Et.iconDependencies);Tn.length?ke.send("getImages",{icons:Tn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(An,Vn)=>{ue||(ue=An,Ot=Vn,Rr())},void 0,!1,Sr):Ot={};const Qn=Object.keys(Et.patternDependencies);Qn.length?ke.send("getImages",{icons:Qn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(An,Vn)=>{ue||(ue=An,hr=Vn,Rr())},void 0,!1,Sr):hr={}}Rr()}}function Re(Ie,Z,te,he){const ke=new o.K(Z,{brightness:te});for(const We of Ie)We.recalculate(ke,he)}class Ee extends o.E{constructor(Z,te,he,ke,We,nt){super(),this.actor=Z,this.layerIndex=te,this.availableImages=he,this.loadVectorData=We||o.ah,this.loading={},this.loaded={},this.deduped=new o.af(Z.scheduler),this.isSpriteLoaded=ke,this.scheduler=Z.scheduler,this.brightness=nt}loadTile(Z,te){const he=Z.uid,ke=Z&&Z.request,We=ke&&ke.collectResourceTiming,nt=this.loading[he]=new Me(Z);nt.abort=this.loadVectorData(Z,(Ut,Ge)=>{const Ht=!this.loading[he];if(delete this.loading[he],Ht||Ut||!Ge)return nt.status="done",Ht||(this.loaded[he]=nt),te(Ut);const Et=Ge.rawData,Pe={};Ge.expires&&(Pe.expires=Ge.expires),Ge.cacheControl&&(Pe.cacheControl=Ge.cacheControl),nt.vectorTile=Ge.vectorTile||new o.dH(new o.dI(Et));const ue=()=>{nt.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.actor,(Je,Ot)=>{if(Je||!Ot)return te(Je);const hr={};if(We){const Sr=B(ke);Sr.length>0&&(hr.resourceTiming=JSON.parse(JSON.stringify(Sr)))}te(null,o.e({rawTileData:Et.slice(0)},Ot,Pe,hr))})};this.isSpriteLoaded?ue():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ue,{type:"parseTile",isSymbolTile:Z.isSymbolTile,zoom:Z.tileZoom}):ue()}),this.loaded=this.loaded||{},this.loaded[he]=nt})}reloadTile(Z,te){const he=this.loaded,ke=Z.uid,We=this;if(he&&he[ke]){const nt=he[ke];nt.showCollisionBoxes=Z.showCollisionBoxes,nt.projection=Z.projection,nt.brightness=Z.brightness,nt.tileTransform=o.as(Z.tileID.canonical,Z.projection),nt.extraShadowCaster=Z.extraShadowCaster;const Ut=(Ge,Ht)=>{const Et=nt.reloadCallback;Et&&(delete nt.reloadCallback,nt.parse(nt.vectorTile,We.layerIndex,this.availableImages,We.actor,Et)),te(Ge,Ht)};nt.status==="parsing"?nt.reloadCallback=Ut:nt.status==="done"&&(nt.vectorTile?nt.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.actor,Ut):Ut())}else te(null,void 0)}abortTile(Z,te){const he=Z.uid,ke=this.loading[he];ke&&(ke.abort&&ke.abort(),delete this.loading[he]),te()}removeTile(Z,te){const he=this.loaded,ke=Z.uid;he&&he[ke]&&delete he[ke],te()}}class mt{loadTile(Z,te){const{uid:he,encoding:ke,rawImageData:We,padding:nt}=Z,Ut=ImageBitmap&&We instanceof ImageBitmap?this.getImageData(We,nt):We;te(null,new o.dJ(he,Ut,ke,nt<1))}getImageData(Z,te){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const he=this.offscreenCanvasContext.getImageData(-te,-te,Z.width+2*te,Z.height+2*te);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),he}}class gt{decodeRasterArray({task:Z,buffer:te},he){o.aZ.performDecoding(te,Z).then(ke=>{he(null,ke)},ke=>{he(ke)})}}function dt(Ie,Z){if(Ie.length!==0){ut(Ie[0],Z);for(var te=1;te<Ie.length;te++)ut(Ie[te],!Z)}}function ut(Ie,Z){for(var te=0,he=0,ke=0,We=Ie.length,nt=We-1;ke<We;nt=ke++){var Ut=(Ie[ke][0]-Ie[nt][0])*(Ie[nt][1]+Ie[ke][1]),Ge=te+Ut;he+=Math.abs(te)>=Math.abs(Ut)?te-Ge+Ut:Ut-Ge+te,te=Ge}te+he>=0!=!!Z&&Ie.reverse()}var ht=o.dK(function Ie(Z,te){var he,ke=Z&&Z.type;if(ke==="FeatureCollection")for(he=0;he<Z.features.length;he++)Ie(Z.features[he],te);else if(ke==="GeometryCollection")for(he=0;he<Z.geometries.length;he++)Ie(Z.geometries[he],te);else if(ke==="Feature")Ie(Z.geometry,te);else if(ke==="Polygon")dt(Z.coordinates,te);else if(ke==="MultiPolygon")for(he=0;he<Z.coordinates.length;he++)dt(Z.coordinates[he],te);return Z});const lt=o.dL.prototype.toGeoJSON;let Qe=class{constructor(Ie){this._feature=Ie,this.extent=o.V,this.type=Ie.type,this.properties=Ie.tags,"id"in Ie&&!isNaN(Ie.id)&&(this.id=parseInt(Ie.id,10))}loadGeometry(){if(this._feature.type===1){const Ie=[];for(const Z of this._feature.geometry)Ie.push([new o.P(Z[0],Z[1])]);return Ie}{const Ie=[];for(const Z of this._feature.geometry){const te=[];for(const he of Z)te.push(new o.P(he[0],he[1]));Ie.push(te)}return Ie}}toGeoJSON(Ie,Z,te){return lt.call(this,Ie,Z,te)}},Se=class{constructor(Ie){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.V,this.length=Ie.length,this._features=Ie}feature(Ie){return new Qe(this._features[Ie])}};var Xt={exports:{}},xr=o.dN,Ve=o.dM.VectorTileFeature,jt=Ur;function Ur(Ie,Z){this.options=Z||{},this.features=Ie,this.length=Ie.length}function $e(Ie,Z){this.id=typeof Ie.id=="number"?Ie.id:void 0,this.type=Ie.type,this.rawGeometry=Ie.type===1?[Ie.geometry]:Ie.geometry,this.properties=Ie.tags,this.extent=Z||4096}Ur.prototype.feature=function(Ie){return new $e(this.features[Ie],this.options.extent)},$e.prototype.loadGeometry=function(){var Ie=this.rawGeometry;this.geometry=[];for(var Z=0;Z<Ie.length;Z++){for(var te=Ie[Z],he=[],ke=0;ke<te.length;ke++)he.push(new xr(te[ke][0],te[ke][1]));this.geometry.push(he)}return this.geometry},$e.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ie=this.geometry,Z=1/0,te=-1/0,he=1/0,ke=-1/0,We=0;We<Ie.length;We++)for(var nt=Ie[We],Ut=0;Ut<nt.length;Ut++){var Ge=nt[Ut];Z=Math.min(Z,Ge.x),te=Math.max(te,Ge.x),he=Math.min(he,Ge.y),ke=Math.max(ke,Ge.y)}return[Z,he,te,ke]},$e.prototype.toGeoJSON=Ve.prototype.toGeoJSON;var ur=o.dO,gr=jt;function zt(Ie){var Z=new ur;return function(te,he){for(var ke in te.layers)he.writeMessage(3,vn,te.layers[ke])}(Ie,Z),Z.finish()}function vn(Ie,Z){var te;Z.writeVarintField(15,Ie.version||1),Z.writeStringField(1,Ie.name||""),Z.writeVarintField(5,Ie.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(te=0;te<Ie.length;te++)he.feature=Ie.feature(te),Z.writeMessage(2,Ft,he);var ke=he.keys;for(te=0;te<ke.length;te++)Z.writeStringField(3,ke[te]);var We=he.values;for(te=0;te<We.length;te++)Z.writeMessage(4,Bn,We[te])}function Ft(Ie,Z){var te=Ie.feature;te.id!==void 0&&Z.writeVarintField(1,te.id),Z.writeMessage(2,zr,Ie),Z.writeVarintField(3,te.type),Z.writeMessage(4,dn,te)}function zr(Ie,Z){var te=Ie.feature,he=Ie.keys,ke=Ie.values,We=Ie.keycache,nt=Ie.valuecache;for(var Ut in te.properties){var Ge=te.properties[Ut],Ht=We[Ut];if(Ge!==null){Ht===void 0&&(he.push(Ut),We[Ut]=Ht=he.length-1),Z.writeVarint(Ht);var Et=typeof Ge;Et!=="string"&&Et!=="boolean"&&Et!=="number"&&(Ge=JSON.stringify(Ge));var Pe=Et+":"+Ge,ue=nt[Pe];ue===void 0&&(ke.push(Ge),nt[Pe]=ue=ke.length-1),Z.writeVarint(ue)}}}function nr(Ie,Z){return(Z<<3)+(7&Ie)}function En(Ie){return Ie<<1^Ie>>31}function dn(Ie,Z){for(var te=Ie.loadGeometry(),he=Ie.type,ke=0,We=0,nt=te.length,Ut=0;Ut<nt;Ut++){var Ge=te[Ut],Ht=1;he===1&&(Ht=Ge.length),Z.writeVarint(nr(1,Ht));for(var Et=he===3?Ge.length-1:Ge.length,Pe=0;Pe<Et;Pe++){Pe===1&&he!==1&&Z.writeVarint(nr(2,Et-1));var ue=Ge[Pe].x-ke,Je=Ge[Pe].y-We;Z.writeVarint(En(ue)),Z.writeVarint(En(Je)),ke+=ue,We+=Je}he===3&&Z.writeVarint(nr(7,1))}}function Bn(Ie,Z){var te=typeof Ie;te==="string"?Z.writeStringField(1,Ie):te==="boolean"?Z.writeBooleanField(7,Ie):te==="number"&&(Ie%1!=0?Z.writeDoubleField(3,Ie):Ie<0?Z.writeSVarintField(6,Ie):Z.writeVarintField(5,Ie))}Xt.exports=zt,Xt.exports.fromVectorTileJs=zt,Xt.exports.fromGeojsonVt=function(Ie,Z){Z=Z||{};var te={};for(var he in Ie)te[he]=new gr(Ie[he].features,Z),te[he].name=he,te[he].version=Z.version,te[he].extent=Z.extent;return zt({layers:te})},Xt.exports.GeoJSONWrapper=gr;var bn=o.dK(Xt.exports);const it={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ie=>Ie},Kt=Math.fround||(Gt=new Float32Array(1),Ie=>(Gt[0]=+Ie,Gt[0]));var Gt;const ir=3,Vr=5,Kr=6;class pe{constructor(Z){this.options=Object.assign(Object.create(it),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:te,minZoom:he,maxZoom:ke}=this.options;te&&console.time("total time");const We=`prepare ${Z.length} points`;te&&console.time(We),this.points=Z;const nt=[];for(let Ge=0;Ge<Z.length;Ge++){const Ht=Z[Ge];if(!Ht.geometry)continue;const[Et,Pe]=Ht.geometry.coordinates,ue=Kt(ft(Et)),Je=Kt(ct(Pe));nt.push(ue,Je,1/0,Ge,-1,1),this.options.reduce&&nt.push(0)}let Ut=this.trees[ke+1]=this._createTree(nt);te&&console.timeEnd(We);for(let Ge=ke;Ge>=he;Ge--){const Ht=+Date.now();Ut=this.trees[Ge]=this._createTree(this._cluster(Ut,Ge)),te&&console.log("z%d: %d clusters in %dms",Ge,Ut.numItems,+Date.now()-Ht)}return te&&console.timeEnd("total time"),this}getClusters(Z,te){let he=((Z[0]+180)%360+360)%360-180;const ke=Math.max(-90,Math.min(90,Z[1]));let We=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const nt=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)he=-180,We=180;else if(he>We){const Pe=this.getClusters([he,ke,180,nt],te),ue=this.getClusters([-180,ke,We,nt],te);return Pe.concat(ue)}const Ut=this.trees[this._limitZoom(te)],Ge=Ut.range(ft(he),ct(nt),ft(We),ct(ke)),Ht=Ut.data,Et=[];for(const Pe of Ge){const ue=this.stride*Pe;Et.push(Ht[ue+Vr]>1?ye(Ht,ue,this.clusterProps):this.points[Ht[ue+ir]])}return Et}getChildren(Z){const te=this._getOriginId(Z),he=this._getOriginZoom(Z),ke="No cluster with the specified id.",We=this.trees[he];if(!We)throw new Error(ke);const nt=We.data;if(te*this.stride>=nt.length)throw new Error(ke);const Ut=this.options.radius/(this.options.extent*Math.pow(2,he-1)),Ge=We.within(nt[te*this.stride],nt[te*this.stride+1],Ut),Ht=[];for(const Et of Ge){const Pe=Et*this.stride;nt[Pe+4]===Z&&Ht.push(nt[Pe+Vr]>1?ye(nt,Pe,this.clusterProps):this.points[nt[Pe+ir]])}if(Ht.length===0)throw new Error(ke);return Ht}getLeaves(Z,te,he){const ke=[];return this._appendLeaves(ke,Z,te=te||10,he=he||0,0),ke}getTile(Z,te,he){const ke=this.trees[this._limitZoom(Z)],We=Math.pow(2,Z),{extent:nt,radius:Ut}=this.options,Ge=Ut/nt,Ht=(he-Ge)/We,Et=(he+1+Ge)/We,Pe={features:[]};return this._addTileFeatures(ke.range((te-Ge)/We,Ht,(te+1+Ge)/We,Et),ke.data,te,he,We,Pe),te===0&&this._addTileFeatures(ke.range(1-Ge/We,Ht,1,Et),ke.data,We,he,We,Pe),te===We-1&&this._addTileFeatures(ke.range(0,Ht,Ge/We,Et),ke.data,-1,he,We,Pe),Pe.features.length?Pe:null}getClusterExpansionZoom(Z){let te=this._getOriginZoom(Z)-1;for(;te<=this.options.maxZoom;){const he=this.getChildren(Z);if(te++,he.length!==1)break;Z=he[0].properties.cluster_id}return te}_appendLeaves(Z,te,he,ke,We){const nt=this.getChildren(te);for(const Ut of nt){const Ge=Ut.properties;if(Ge&&Ge.cluster?We+Ge.point_count<=ke?We+=Ge.point_count:We=this._appendLeaves(Z,Ge.cluster_id,he,ke,We):We<ke?We++:Z.push(Ut),Z.length===he)break}return We}_createTree(Z){const te=new o.bg(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let he=0;he<Z.length;he+=this.stride)te.add(Z[he],Z[he+1]);return te.finish(),te.data=Z,te}_addTileFeatures(Z,te,he,ke,We,nt){for(const Ut of Z){const Ge=Ut*this.stride,Ht=te[Ge+Vr]>1;let Et,Pe,ue;if(Ht)Et=qe(te,Ge,this.clusterProps),Pe=te[Ge],ue=te[Ge+1];else{const hr=this.points[te[Ge+ir]];Et=hr.properties;const[Sr,Rr]=hr.geometry.coordinates;Pe=ft(Sr),ue=ct(Rr)}const Je={type:1,geometry:[[Math.round(this.options.extent*(Pe*We-he)),Math.round(this.options.extent*(ue*We-ke))]],tags:Et};let Ot;Ot=Ht||this.options.generateId?te[Ge+ir]:this.points[te[Ge+ir]].id,Ot!==void 0&&(Je.id=Ot),nt.features.push(Je)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,te){const{radius:he,extent:ke,reduce:We,minPoints:nt}=this.options,Ut=he/(ke*Math.pow(2,te)),Ge=Z.data,Ht=[],Et=this.stride;for(let Pe=0;Pe<Ge.length;Pe+=Et){if(Ge[Pe+2]<=te)continue;Ge[Pe+2]=te;const ue=Ge[Pe],Je=Ge[Pe+1],Ot=Z.within(Ge[Pe],Ge[Pe+1],Ut),hr=Ge[Pe+Vr];let Sr=hr;for(const Rr of Ot){const Hr=Rr*Et;Ge[Hr+2]>te&&(Sr+=Ge[Hr+Vr])}if(Sr>hr&&Sr>=nt){let Rr,Hr=ue*hr,Tn=Je*hr,Qn=-1;const An=(Pe/Et<<5)+(te+1)+this.points.length;for(const Vn of Ot){const bi=Vn*Et;if(Ge[bi+2]<=te)continue;Ge[bi+2]=te;const Ci=Ge[bi+Vr];Hr+=Ge[bi]*Ci,Tn+=Ge[bi+1]*Ci,Ge[bi+4]=An,We&&(Rr||(Rr=this._map(Ge,Pe,!0),Qn=this.clusterProps.length,this.clusterProps.push(Rr)),We(Rr,this._map(Ge,bi)))}Ge[Pe+4]=An,Ht.push(Hr/Sr,Tn/Sr,1/0,An,-1,Sr),We&&Ht.push(Qn)}else{for(let Rr=0;Rr<Et;Rr++)Ht.push(Ge[Pe+Rr]);if(Sr>1)for(const Rr of Ot){const Hr=Rr*Et;if(!(Ge[Hr+2]<=te)){Ge[Hr+2]=te;for(let Tn=0;Tn<Et;Tn++)Ht.push(Ge[Hr+Tn])}}}}return Ht}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,te,he){if(Z[te+Vr]>1){const nt=this.clusterProps[Z[te+Kr]];return he?Object.assign({},nt):nt}const ke=this.points[Z[te+ir]].properties,We=this.options.map(ke);return he&&We===ke?Object.assign({},We):We}}function ye(Ie,Z,te){return{type:"Feature",id:Ie[Z+ir],properties:qe(Ie,Z,te),geometry:{type:"Point",coordinates:[(he=Ie[Z],360*(he-.5)),Bt(Ie[Z+1])]}};var he}function qe(Ie,Z,te){const he=Ie[Z+Vr],ke=he>=1e4?`${Math.round(he/1e3)}k`:he>=1e3?Math.round(he/100)/10+"k":he,We=Ie[Z+Kr],nt=We===-1?{}:Object.assign({},te[We]);return Object.assign(nt,{cluster:!0,cluster_id:Ie[Z+ir],point_count:he,point_count_abbreviated:ke})}function ft(Ie){return Ie/360+.5}function ct(Ie){const Z=Math.sin(Ie*Math.PI/180),te=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return te<0?0:te>1?1:te}function Bt(Ie){const Z=(180-360*Ie)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}var tr={exports:{}};tr.exports=function(){function Ie(He,Ye,pt,Mt){for(var bt,Lt=Mt,Rt=pt-Ye>>1,Tt=pt-Ye,Nt=He[Ye],At=He[Ye+1],Tr=He[pt],Qr=He[pt+1],lr=Ye+3;lr<pt;lr+=3){var In=Z(He[lr],He[lr+1],Nt,At,Tr,Qr);if(In>Lt)bt=lr,Lt=In;else if(In===Lt){var Gn=Math.abs(lr-Rt);Gn<Tt&&(bt=lr,Tt=Gn)}}Lt>Mt&&(bt-Ye>3&&Ie(He,Ye,bt,Mt),He[bt+2]=Lt,pt-bt>3&&Ie(He,bt,pt,Mt))}function Z(He,Ye,pt,Mt,bt,Lt){var Rt=bt-pt,Tt=Lt-Mt;if(Rt!==0||Tt!==0){var Nt=((He-pt)*Rt+(Ye-Mt)*Tt)/(Rt*Rt+Tt*Tt);Nt>1?(pt=bt,Mt=Lt):Nt>0&&(pt+=Rt*Nt,Mt+=Tt*Nt)}return(Rt=He-pt)*Rt+(Tt=Ye-Mt)*Tt}function te(He,Ye,pt,Mt){var bt={id:He===void 0?null:He,type:Ye,geometry:pt,tags:Mt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Lt){var Rt=Lt.geometry,Tt=Lt.type;if(Tt==="Point"||Tt==="MultiPoint"||Tt==="LineString")he(Lt,Rt);else if(Tt==="Polygon"||Tt==="MultiLineString")for(var Nt=0;Nt<Rt.length;Nt++)he(Lt,Rt[Nt]);else if(Tt==="MultiPolygon")for(Nt=0;Nt<Rt.length;Nt++)for(var At=0;At<Rt[Nt].length;At++)he(Lt,Rt[Nt][At])}(bt),bt}function he(He,Ye){for(var pt=0;pt<Ye.length;pt+=3)He.minX=Math.min(He.minX,Ye[pt]),He.minY=Math.min(He.minY,Ye[pt+1]),He.maxX=Math.max(He.maxX,Ye[pt]),He.maxY=Math.max(He.maxY,Ye[pt+1])}function ke(He,Ye,pt,Mt){if(Ye.geometry){var bt=Ye.geometry.coordinates,Lt=Ye.geometry.type,Rt=Math.pow(pt.tolerance/((1<<pt.maxZoom)*pt.extent),2),Tt=[],Nt=Ye.id;if(pt.promoteId?Nt=Ye.properties[pt.promoteId]:pt.generateId&&(Nt=Mt||0),Lt==="Point")We(bt,Tt);else if(Lt==="MultiPoint")for(var At=0;At<bt.length;At++)We(bt[At],Tt);else if(Lt==="LineString")nt(bt,Tt,Rt,!1);else if(Lt==="MultiLineString"){if(pt.lineMetrics){for(At=0;At<bt.length;At++)nt(bt[At],Tt=[],Rt,!1),He.push(te(Nt,"LineString",Tt,Ye.properties));return}Ut(bt,Tt,Rt,!1)}else if(Lt==="Polygon")Ut(bt,Tt,Rt,!0);else{if(Lt!=="MultiPolygon"){if(Lt==="GeometryCollection"){for(At=0;At<Ye.geometry.geometries.length;At++)ke(He,{id:Nt,geometry:Ye.geometry.geometries[At],properties:Ye.properties},pt,Mt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(At=0;At<bt.length;At++){var Tr=[];Ut(bt[At],Tr,Rt,!0),Tt.push(Tr)}}He.push(te(Nt,Lt,Tt,Ye.properties))}}function We(He,Ye){Ye.push(Ge(He[0])),Ye.push(Ht(He[1])),Ye.push(0)}function nt(He,Ye,pt,Mt){for(var bt,Lt,Rt=0,Tt=0;Tt<He.length;Tt++){var Nt=Ge(He[Tt][0]),At=Ht(He[Tt][1]);Ye.push(Nt),Ye.push(At),Ye.push(0),Tt>0&&(Rt+=Mt?(bt*At-Nt*Lt)/2:Math.sqrt(Math.pow(Nt-bt,2)+Math.pow(At-Lt,2))),bt=Nt,Lt=At}var Tr=Ye.length-3;Ye[2]=1,Ie(Ye,0,Tr,pt),Ye[Tr+2]=1,Ye.size=Math.abs(Rt),Ye.start=0,Ye.end=Ye.size}function Ut(He,Ye,pt,Mt){for(var bt=0;bt<He.length;bt++){var Lt=[];nt(He[bt],Lt,pt,Mt),Ye.push(Lt)}}function Ge(He){return He/360+.5}function Ht(He){var Ye=Math.sin(He*Math.PI/180),pt=.5-.25*Math.log((1+Ye)/(1-Ye))/Math.PI;return pt<0?0:pt>1?1:pt}function Et(He,Ye,pt,Mt,bt,Lt,Rt,Tt){if(Mt/=Ye,Lt>=(pt/=Ye)&&Rt<Mt)return He;if(Rt<pt||Lt>=Mt)return null;for(var Nt=[],At=0;At<He.length;At++){var Tr=He[At],Qr=Tr.geometry,lr=Tr.type,In=bt===0?Tr.minX:Tr.minY,Gn=bt===0?Tr.maxX:Tr.maxY;if(In>=pt&&Gn<Mt)Nt.push(Tr);else if(!(Gn<pt||In>=Mt)){var Ln=[];if(lr==="Point"||lr==="MultiPoint")Pe(Qr,Ln,pt,Mt,bt);else if(lr==="LineString")ue(Qr,Ln,pt,Mt,bt,!1,Tt.lineMetrics);else if(lr==="MultiLineString")Ot(Qr,Ln,pt,Mt,bt,!1);else if(lr==="Polygon")Ot(Qr,Ln,pt,Mt,bt,!0);else if(lr==="MultiPolygon")for(var mi=0;mi<Qr.length;mi++){var Fi=[];Ot(Qr[mi],Fi,pt,Mt,bt,!0),Fi.length&&Ln.push(Fi)}if(Ln.length){if(Tt.lineMetrics&&lr==="LineString"){for(mi=0;mi<Ln.length;mi++)Nt.push(te(Tr.id,lr,Ln[mi],Tr.tags));continue}lr!=="LineString"&&lr!=="MultiLineString"||(Ln.length===1?(lr="LineString",Ln=Ln[0]):lr="MultiLineString"),lr!=="Point"&&lr!=="MultiPoint"||(lr=Ln.length===3?"Point":"MultiPoint"),Nt.push(te(Tr.id,lr,Ln,Tr.tags))}}}return Nt.length?Nt:null}function Pe(He,Ye,pt,Mt,bt){for(var Lt=0;Lt<He.length;Lt+=3){var Rt=He[Lt+bt];Rt>=pt&&Rt<=Mt&&(Ye.push(He[Lt]),Ye.push(He[Lt+1]),Ye.push(He[Lt+2]))}}function ue(He,Ye,pt,Mt,bt,Lt,Rt){for(var Tt,Nt,At=Je(He),Tr=bt===0?Sr:Rr,Qr=He.start,lr=0;lr<He.length-3;lr+=3){var In=He[lr],Gn=He[lr+1],Ln=He[lr+2],mi=He[lr+3],Fi=He[lr+4],pn=bt===0?In:Gn,ms=bt===0?mi:Fi,zs=!1;Rt&&(Tt=Math.sqrt(Math.pow(In-mi,2)+Math.pow(Gn-Fi,2))),pn<pt?ms>pt&&(Nt=Tr(At,In,Gn,mi,Fi,pt),Rt&&(At.start=Qr+Tt*Nt)):pn>Mt?ms<Mt&&(Nt=Tr(At,In,Gn,mi,Fi,Mt),Rt&&(At.start=Qr+Tt*Nt)):hr(At,In,Gn,Ln),ms<pt&&pn>=pt&&(Nt=Tr(At,In,Gn,mi,Fi,pt),zs=!0),ms>Mt&&pn<=Mt&&(Nt=Tr(At,In,Gn,mi,Fi,Mt),zs=!0),!Lt&&zs&&(Rt&&(At.end=Qr+Tt*Nt),Ye.push(At),At=Je(He)),Rt&&(Qr+=Tt)}var Bi=He.length-3;In=He[Bi],Gn=He[Bi+1],Ln=He[Bi+2],(pn=bt===0?In:Gn)>=pt&&pn<=Mt&&hr(At,In,Gn,Ln),Bi=At.length-3,Lt&&Bi>=3&&(At[Bi]!==At[0]||At[Bi+1]!==At[1])&&hr(At,At[0],At[1],At[2]),At.length&&Ye.push(At)}function Je(He){var Ye=[];return Ye.size=He.size,Ye.start=He.start,Ye.end=He.end,Ye}function Ot(He,Ye,pt,Mt,bt,Lt){for(var Rt=0;Rt<He.length;Rt++)ue(He[Rt],Ye,pt,Mt,bt,Lt,!1)}function hr(He,Ye,pt,Mt){He.push(Ye),He.push(pt),He.push(Mt)}function Sr(He,Ye,pt,Mt,bt,Lt){var Rt=(Lt-Ye)/(Mt-Ye);return He.push(Lt),He.push(pt+(bt-pt)*Rt),He.push(1),Rt}function Rr(He,Ye,pt,Mt,bt,Lt){var Rt=(Lt-pt)/(bt-pt);return He.push(Ye+(Mt-Ye)*Rt),He.push(Lt),He.push(1),Rt}function Hr(He,Ye){for(var pt=[],Mt=0;Mt<He.length;Mt++){var bt,Lt=He[Mt],Rt=Lt.type;if(Rt==="Point"||Rt==="MultiPoint"||Rt==="LineString")bt=Tn(Lt.geometry,Ye);else if(Rt==="MultiLineString"||Rt==="Polygon"){bt=[];for(var Tt=0;Tt<Lt.geometry.length;Tt++)bt.push(Tn(Lt.geometry[Tt],Ye))}else if(Rt==="MultiPolygon")for(bt=[],Tt=0;Tt<Lt.geometry.length;Tt++){for(var Nt=[],At=0;At<Lt.geometry[Tt].length;At++)Nt.push(Tn(Lt.geometry[Tt][At],Ye));bt.push(Nt)}pt.push(te(Lt.id,Rt,bt,Lt.tags))}return pt}function Tn(He,Ye){var pt=[];pt.size=He.size,He.start!==void 0&&(pt.start=He.start,pt.end=He.end);for(var Mt=0;Mt<He.length;Mt+=3)pt.push(He[Mt]+Ye,He[Mt+1],He[Mt+2]);return pt}function Qn(He,Ye){if(He.transformed)return He;var pt,Mt,bt,Lt=1<<He.z,Rt=He.x,Tt=He.y;for(pt=0;pt<He.features.length;pt++){var Nt=He.features[pt],At=Nt.geometry,Tr=Nt.type;if(Nt.geometry=[],Tr===1)for(Mt=0;Mt<At.length;Mt+=2)Nt.geometry.push(An(At[Mt],At[Mt+1],Ye,Lt,Rt,Tt));else for(Mt=0;Mt<At.length;Mt++){var Qr=[];for(bt=0;bt<At[Mt].length;bt+=2)Qr.push(An(At[Mt][bt],At[Mt][bt+1],Ye,Lt,Rt,Tt));Nt.geometry.push(Qr)}}return He.transformed=!0,He}function An(He,Ye,pt,Mt,bt,Lt){return[Math.round(pt*(He*Mt-bt)),Math.round(pt*(Ye*Mt-Lt))]}function Vn(He,Ye,pt,Mt,bt){for(var Lt=Ye===bt.maxZoom?0:bt.tolerance/((1<<Ye)*bt.extent),Rt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:pt,y:Mt,z:Ye,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Tt=0;Tt<He.length;Tt++){Rt.numFeatures++,bi(Rt,He[Tt],Lt,bt);var Nt=He[Tt].minX,At=He[Tt].minY,Tr=He[Tt].maxX,Qr=He[Tt].maxY;Nt<Rt.minX&&(Rt.minX=Nt),At<Rt.minY&&(Rt.minY=At),Tr>Rt.maxX&&(Rt.maxX=Tr),Qr>Rt.maxY&&(Rt.maxY=Qr)}return Rt}function bi(He,Ye,pt,Mt){var bt=Ye.geometry,Lt=Ye.type,Rt=[];if(Lt==="Point"||Lt==="MultiPoint")for(var Tt=0;Tt<bt.length;Tt+=3)Rt.push(bt[Tt]),Rt.push(bt[Tt+1]),He.numPoints++,He.numSimplified++;else if(Lt==="LineString")Ci(Rt,bt,He,pt,!1,!1);else if(Lt==="MultiLineString"||Lt==="Polygon")for(Tt=0;Tt<bt.length;Tt++)Ci(Rt,bt[Tt],He,pt,Lt==="Polygon",Tt===0);else if(Lt==="MultiPolygon")for(var Nt=0;Nt<bt.length;Nt++){var At=bt[Nt];for(Tt=0;Tt<At.length;Tt++)Ci(Rt,At[Tt],He,pt,!0,Tt===0)}if(Rt.length){var Tr=Ye.tags||null;if(Lt==="LineString"&&Mt.lineMetrics){for(var Qr in Tr={},Ye.tags)Tr[Qr]=Ye.tags[Qr];Tr.mapbox_clip_start=bt.start/bt.size,Tr.mapbox_clip_end=bt.end/bt.size}var lr={geometry:Rt,type:Lt==="Polygon"||Lt==="MultiPolygon"?3:Lt==="LineString"||Lt==="MultiLineString"?2:1,tags:Tr};Ye.id!==null&&(lr.id=Ye.id),He.features.push(lr)}}function Ci(He,Ye,pt,Mt,bt,Lt){var Rt=Mt*Mt;if(Mt>0&&Ye.size<(bt?Rt:Mt))pt.numPoints+=Ye.length/3;else{for(var Tt=[],Nt=0;Nt<Ye.length;Nt+=3)(Mt===0||Ye[Nt+2]>Rt)&&(pt.numSimplified++,Tt.push(Ye[Nt]),Tt.push(Ye[Nt+1])),pt.numPoints++;bt&&function(At,Tr){for(var Qr=0,lr=0,In=At.length,Gn=In-2;lr<In;Gn=lr,lr+=2)Qr+=(At[lr]-At[Gn])*(At[lr+1]+At[Gn+1]);if(Qr>0===Tr)for(lr=0,In=At.length;lr<In/2;lr+=2){var Ln=At[lr],mi=At[lr+1];At[lr]=At[In-2-lr],At[lr+1]=At[In-1-lr],At[In-2-lr]=Ln,At[In-1-lr]=mi}}(Tt,Lt),He.push(Tt)}}function Wn(He,Ye){var pt=(Ye=this.options=function(bt,Lt){for(var Rt in Lt)bt[Rt]=Lt[Rt];return bt}(Object.create(this.options),Ye)).debug;if(pt&&console.time("preprocess data"),Ye.maxZoom<0||Ye.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ye.promoteId&&Ye.generateId)throw new Error("promoteId and generateId cannot be used together.");var Mt=function(bt,Lt){var Rt=[];if(bt.type==="FeatureCollection")for(var Tt=0;Tt<bt.features.length;Tt++)ke(Rt,bt.features[Tt],Lt,Tt);else ke(Rt,bt.type==="Feature"?bt:{geometry:bt},Lt);return Rt}(He,Ye);this.tiles={},this.tileCoords=[],pt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ye.indexMaxZoom,Ye.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Mt=function(bt,Lt){var Rt=Lt.buffer/Lt.extent,Tt=bt,Nt=Et(bt,1,-1-Rt,Rt,0,-1,2,Lt),At=Et(bt,1,1-Rt,2+Rt,0,-1,2,Lt);return(Nt||At)&&(Tt=Et(bt,1,-Rt,1+Rt,0,-1,2,Lt)||[],Nt&&(Tt=Hr(Nt,1).concat(Tt)),At&&(Tt=Tt.concat(Hr(At,-1)))),Tt}(Mt,Ye)).length&&this.splitTile(Mt,0,0,0),pt&&(Mt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function jn(He,Ye,pt){return 32*((1<<He)*pt+Ye)+He}return Wn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Wn.prototype.splitTile=function(He,Ye,pt,Mt,bt,Lt,Rt){for(var Tt=[He,Ye,pt,Mt],Nt=this.options,At=Nt.debug;Tt.length;){Mt=Tt.pop(),pt=Tt.pop(),Ye=Tt.pop(),He=Tt.pop();var Tr=1<<Ye,Qr=jn(Ye,pt,Mt),lr=this.tiles[Qr];if(!lr&&(At>1&&console.time("creation"),lr=this.tiles[Qr]=Vn(He,Ye,pt,Mt,Nt),this.tileCoords.push({z:Ye,x:pt,y:Mt}),At)){At>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ye,pt,Mt,lr.numFeatures,lr.numPoints,lr.numSimplified),console.timeEnd("creation"));var In="z"+Ye;this.stats[In]=(this.stats[In]||0)+1,this.total++}if(lr.source=He,bt){if(Ye===Nt.maxZoom||Ye===bt)continue;var Gn=1<<bt-Ye;if(pt!==Math.floor(Lt/Gn)||Mt!==Math.floor(Rt/Gn))continue}else if(Ye===Nt.indexMaxZoom||lr.numPoints<=Nt.indexMaxPoints)continue;if(lr.source=null,He.length!==0){At>1&&console.time("clipping");var Ln,mi,Fi,pn,ms,zs,Bi=.5*Nt.buffer/Nt.extent,yc=.5-Bi,Bo=.5+Bi,sl=1+Bi;Ln=mi=Fi=pn=null,ms=Et(He,Tr,pt-Bi,pt+Bo,0,lr.minX,lr.maxX,Nt),zs=Et(He,Tr,pt+yc,pt+sl,0,lr.minX,lr.maxX,Nt),He=null,ms&&(Ln=Et(ms,Tr,Mt-Bi,Mt+Bo,1,lr.minY,lr.maxY,Nt),mi=Et(ms,Tr,Mt+yc,Mt+sl,1,lr.minY,lr.maxY,Nt),ms=null),zs&&(Fi=Et(zs,Tr,Mt-Bi,Mt+Bo,1,lr.minY,lr.maxY,Nt),pn=Et(zs,Tr,Mt+yc,Mt+sl,1,lr.minY,lr.maxY,Nt),zs=null),At>1&&console.timeEnd("clipping"),Tt.push(Ln||[],Ye+1,2*pt,2*Mt),Tt.push(mi||[],Ye+1,2*pt,2*Mt+1),Tt.push(Fi||[],Ye+1,2*pt+1,2*Mt),Tt.push(pn||[],Ye+1,2*pt+1,2*Mt+1)}}},Wn.prototype.getTile=function(He,Ye,pt){var Mt=this.options,bt=Mt.extent,Lt=Mt.debug;if(He<0||He>24)return null;var Rt=1<<He,Tt=jn(He,Ye=(Ye%Rt+Rt)%Rt,pt);if(this.tiles[Tt])return Qn(this.tiles[Tt],bt);Lt>1&&console.log("drilling down to z%d-%d-%d",He,Ye,pt);for(var Nt,At=He,Tr=Ye,Qr=pt;!Nt&&At>0;)At--,Tr=Math.floor(Tr/2),Qr=Math.floor(Qr/2),Nt=this.tiles[jn(At,Tr,Qr)];return Nt&&Nt.source?(Lt>1&&console.log("found parent tile z%d-%d-%d",At,Tr,Qr),Lt>1&&console.time("drilling down"),this.splitTile(Nt.source,At,Tr,Qr,He,Ye,pt),Lt>1&&console.timeEnd("drilling down"),this.tiles[Tt]?Qn(this.tiles[Tt],bt):null):null},function(He,Ye){return new Wn(He,Ye)}}();var vt=o.dK(tr.exports);function Yt(Ie,Z){const te=Ie.tileID.canonical;if(!this._geoJSONIndex)return Z(null,null);const he=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!he)return Z(null,null);const ke=new Se(he.features);let We=bn(ke);We.byteOffset===0&&We.byteLength===We.buffer.byteLength||(We=new Uint8Array(We)),Z(null,{vectorTile:ke,rawData:We.buffer})}class Pt extends Ee{constructor(Z,te,he,ke,We,nt){super(Z,te,he,ke,Yt,nt),We&&(this.loadGeoJSON=We)}loadData(Z,te){const he=Z&&Z.request,ke=he&&he.collectResourceTiming;this.loadGeoJSON(Z,(We,nt)=>{if(We||!nt)return te(We);if(typeof nt!="object")return te(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{ht(nt,!0);try{if(Z.filter){const Ge=o.r(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ge.result==="error")throw new Error(Ge.value.map(Et=>`${Et.key}: ${Et.message}`).join(", "));nt={type:"FeatureCollection",features:nt.features.filter(Et=>Ge.value.evaluate({zoom:0},Et))}}this._geoJSONIndex=Z.cluster?new pe(function({superclusterOptions:Ge,clusterProperties:Ht}){if(!Ht||!Ge)return Ge;const Et={},Pe={},ue={accumulated:null,zoom:0},Je={properties:null},Ot=Object.keys(Ht);for(const hr of Ot){const[Sr,Rr]=Ht[hr],Hr=o.r(Rr),Tn=o.r(typeof Sr=="string"?[Sr,["accumulated"],["get",hr]]:Sr);Et[hr]=Hr.value,Pe[hr]=Tn.value}return Ge.map=hr=>{Je.properties=hr;const Sr={};for(const Rr of Ot)Sr[Rr]=Et[Rr].evaluate(ue,Je);return Sr},Ge.reduce=(hr,Sr)=>{Je.properties=Sr;for(const Rr of Ot)ue.accumulated=hr[Rr],hr[Rr]=Pe[Rr].evaluate(ue,Je)},Ge}(Z)).load(nt.features):vt(nt,Z.geojsonVtOptions)}catch(Ge){return te(Ge)}this.loaded={};const Ut={};if(ke){const Ge=B(he);Ge&&(Ut.resourceTiming={},Ut.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Ge)))}te(null,Ut)}})}reloadTile(Z,te){const he=this.loaded;return he&&he[Z.uid]?super.reloadTile(Z,te):this.loadTile(Z,te)}loadGeoJSON(Z,te){if(Z.request)o.g(Z.request,te);else{if(typeof Z.data!="string")return te(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));try{return te(null,JSON.parse(Z.data))}catch{return te(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Z,te){try{te(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(he){te(he)}}getClusterChildren(Z,te){try{te(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(he){te(he)}}getClusterLeaves(Z,te){try{te(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(he){te(he)}}}class rr{constructor(Z,te){this.tileID=new o.am(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Z.projection,this.brightness=te}parse(Z,te,he,ke){this.status="parsing";const We=new o.am(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),nt={},Ut=te.familiesBySource[he.source],Ge=new o.dC(We,he.promoteId);return Ge.bucketLayerIDs=[],Ge.is3DTile=!0,o.dP(Z).then(Ht=>{if(!Ht)return ke(new Error("Could not parse tile"));const Et=o.dQ(Ht,1/o.bR(he.tileID.canonical)),Pe=Ht.json.extensionsUsed&&Ht.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ht.json.asset.extras&&Ht.json.asset.extras.MAPBOX_mesh_features,ue=Ht.json.extensionsUsed&&Ht.json.extensionsUsed.includes("EXT_meshopt_compression"),Je=new o.K(this.zoom,{brightness:this.brightness});for(const Ot in Ut)for(const hr of Ut[Ot]){const Sr=hr[0];Ge.bucketLayerIDs.push(hr.map(Hr=>Hr.id)),Sr.recalculate(Je,[]);const Rr=new o.dR(Et,We,Pe,ue,this.brightness,Ge);Pe||(Rr.needsUpload=!0),nt[Sr.fqid]=Rr,Rr.evaluate(Sr)}this.status="done",ke(null,{buckets:nt,featureIndex:Ge})}).catch(Ht=>ke(new Error(Ht.message)))}}class br{constructor(Z,te,he,ke,We,nt){this.actor=Z,this.layerIndex=te,this.brightness=nt,this.loading={},this.loaded={}}loadTile(Z,te){const he=Z.uid,ke=this.loading[he]=new rr(Z,this.brightness);o.a_(Z.request,(We,nt)=>{const Ut=!this.loading[he];return delete this.loading[he],Ut||We?(ke.status="done",Ut||(this.loaded[he]=ke),te(We)):nt&&nt.byteLength!==0?void ke.parse(nt,this.layerIndex,Z,(Ge,Ht)=>{ke.status="done",this.loaded=this.loaded||{},this.loaded[he]=ke,Ge||!Ht?te(Ge):te(null,Ht)}):(ke.status="done",this.loaded[he]=ke,te())})}reloadTile(Z,te){const he=this.loaded,ke=Z.uid;if(he&&he[ke]){const We=he[ke];We.projection=Z.projection,We.brightness=Z.brightness;const nt=(Ut,Ge)=>{We.reloadCallback&&(delete We.reloadCallback,this.loadTile(Z,te)),te(Ut,Ge)};We.status==="parsing"?We.reloadCallback=nt:We.status==="done"&&this.loadTile(Z,te)}}abortTile(Z,te){const he=Z.uid;this.loading[he]&&delete this.loading[he],te()}removeTile(Z,te){const he=this.loaded,ke=Z.uid;he&&he[ke]&&delete he[ke],te()}}class yr{constructor(Z){this.self=Z,this.actor=new o.dS(Z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.bo({name:"mercator"}),this.workerSourceTypes={vector:Ee,geojson:Pt,"batched-model":br},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(te,he)=>{if(this.workerSourceTypes[te])throw new Error(`Worker source with name "${te}" already registered.`);this.workerSourceTypes[te]=he},this.self.registerRTLTextPlugin=te=>{if(o.dT.isParsed())throw new Error("RTL text plugin already registered.");o.dT.applyArabicShaping=te.applyArabicShaping,o.dT.processBidirectionalText=te.processBidirectionalText,o.dT.processStyledBidirectionalText=te.processStyledBidirectionalText}}clearCaches(Z,te,he){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z],delete this.rasterArrayWorkerSource,he()}checkIfReady(Z,te,he){he()}setReferrer(Z,te){this.referrer=te}spriteLoaded(Z,{scope:te,isLoaded:he}){if(this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={}),this.isSpriteLoaded[Z][te]=he,this.workerSources[Z]&&this.workerSources[Z][te])for(const ke in this.workerSources[Z][te]){const We=this.workerSources[Z][te][ke];for(const nt in We)We[nt]instanceof Ee&&(We[nt].isSpriteLoaded=he,We[nt].fire(new o.b("isSpriteLoaded")))}}setImages(Z,{scope:te,images:he},ke){if(this.availableImages[Z]||(this.availableImages[Z]={}),this.availableImages[Z][te]=he,this.workerSources[Z]&&this.workerSources[Z][te]){for(const We in this.workerSources[Z][te]){const nt=this.workerSources[Z][te][We];for(const Ut in nt)nt[Ut].availableImages=he}ke()}else ke()}setProjection(Z,te){this.projections[Z]=o.bo(te)}setBrightness(Z,te,he){this.brightness=te,he()}setLayers(Z,te,he){this.getLayerIndex(Z,te.scope).replace(te.layers,te.options),he()}updateLayers(Z,te,he){this.getLayerIndex(Z,te.scope).update(te.layers,te.removedIds,te.options),he()}loadTile(Z,te,he){te.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,te.type,te.source,te.scope).loadTile(te,he)}loadDEMTile(Z,te,he){this.getDEMWorkerSource(Z,te.source,te.scope).loadTile(te,he)}decodeRasterArray(Z,te,he){this.getRasterArrayWorkerSource().decodeRasterArray(te,he)}reloadTile(Z,te,he){te.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,te.type,te.source,te.scope).reloadTile(te,he)}abortTile(Z,te,he){this.getWorkerSource(Z,te.type,te.source,te.scope).abortTile(te,he)}removeTile(Z,te,he){this.getWorkerSource(Z,te.type,te.source,te.scope).removeTile(te,he)}removeSource(Z,te,he){if(!(this.workerSources[Z]&&this.workerSources[Z][te.scope]&&this.workerSources[Z][te.scope][te.type]&&this.workerSources[Z][te.scope][te.type][te.source]))return;const ke=this.workerSources[Z][te.scope][te.type][te.source];delete this.workerSources[Z][te.scope][te.type][te.source],ke.removeSource!==void 0?ke.removeSource(te,he):he()}loadWorkerSource(Z,te,he){try{this.self.importScripts(te.url),he()}catch(ke){he(ke.toString())}}syncRTLPluginState(Z,te,he){try{o.dT.setState(te);const ke=o.dT.getPluginURL();if(o.dT.isLoaded()&&!o.dT.isParsed()&&ke!=null){this.self.importScripts(ke);const We=o.dT.isParsed();he(We?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ke}`),We)}}catch(ke){he(ke.toString())}}setDracoUrl(Z,te){this.dracoUrl=te}getAvailableImages(Z,te){this.availableImages[Z]||(this.availableImages[Z]={});let he=this.availableImages[Z][te];return he||(he=[]),he}getLayerIndex(Z,te){this.layerIndexes[Z]||(this.layerIndexes[Z]={});let he=this.layerIndexes[Z][te];return he||(he=this.layerIndexes[Z][te]=new ie,he.scope=te),he}getWorkerSource(Z,te,he,ke){if(this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][ke]||(this.workerSources[Z][ke]={}),this.workerSources[Z][ke][te]||(this.workerSources[Z][ke][te]={}),this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={}),!this.workerSources[Z][ke][te][he]){const We={send:(nt,Ut,Ge,Ht,Et,Pe)=>{this.actor.send(nt,Ut,Ge,Z,Et,Pe)},scheduler:this.actor.scheduler};this.workerSources[Z][ke][te][he]=new this.workerSourceTypes[te](We,this.getLayerIndex(Z,ke),this.getAvailableImages(Z,ke),this.isSpriteLoaded[Z][ke],void 0,this.brightness)}return this.workerSources[Z][ke][te][he]}getDEMWorkerSource(Z,te,he){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][he]||(this.demWorkerSources[Z][he]={}),this.demWorkerSources[Z][he][te]||(this.demWorkerSources[Z][he][te]=new mt),this.demWorkerSources[Z][he][te]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new gt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(Z,te){o.dU(te)}getWorkerPerformanceMetrics(Z,te,he){he(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new yr(self)),yr}),C(["./shared"],function(o){function B(h,n){if(Array.isArray(h)){if(!Array.isArray(n)||h.length!==n.length)return!1;for(let a=0;a<h.length;a++)if(!B(h[a],n[a]))return!1;return!0}if(typeof h=="object"&&h!==null&&n!==null){if(typeof n!="object"||Object.keys(h).length!==Object.keys(n).length)return!1;for(const a in h)if(!B(h[a],n[a]))return!1;return!0}return h===n}var $=H;function H(h){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,m,g=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(g);try{m=new Worker(b),d=!0}catch{d=!1}return m&&m.terminate(),URL.revokeObjectURL(b),d}()?function(){var d=document.createElement("canvas");d.width=d.height=1;var m=d.getContext("2d");if(!m)return!1;var g=m.getImageData(0,0,1,1);return g&&g.width===d.width}()?(ie[a=n&&n.failIfMajorPerformanceCaveat]===void 0&&(ie[a]=function(d){var m,g=function(b){var S=document.createElement("canvas"),A=Object.create(H.webGLContextAttributes);return A.failIfMajorPerformanceCaveat=b,S.getContext("webgl2",A)}(d);if(!g)return!1;try{m=g.createShader(g.VERTEX_SHADER)}catch{return!1}return!(!m||g.isContextLost())&&(g.shaderSource(m,"void main() {}"),g.compileShader(m),g.getShaderParameter(m,g.COMPILE_STATUS)===!0)}(a)),ie[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var a}(h)}var ie={};function oe(h,n,a){const d=document.createElement(h);return n!=null&&(d.className=n),a&&a.appendChild(d),d}function _e(h,n,a){const d=document.createElementNS("http://www.w3.org/2000/svg",h);for(const m of Object.keys(n))d.setAttributeNS(null,m,String(n[m]));return a&&a.appendChild(d),d}H.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Me=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Re=Me&&Me.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ee;function mt(){Me&&Re&&(Ee=Me[Re],Me[Re]="none")}function gt(){Me&&Re&&(Me[Re]=Ee)}function dt(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",dt,!0)}function ut(){window.addEventListener("click",dt,!0),window.setTimeout(()=>{window.removeEventListener("click",dt,!0)},0)}function ht(h,n){const a=h.getBoundingClientRect();return Se(h,a,n)}function lt(h,n){const a=h.getBoundingClientRect(),d=[];for(let m=0;m<n.length;m++)d.push(Se(h,a,n[m]));return d}function Qe(h){return window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Se(h,n,a){const d=h.offsetWidth===n.width?1:h.offsetWidth/n.width;return new o.P((a.clientX-n.left)*d,(a.clientY-n.top)*d)}class Xt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,a){this._updatedSourceCaches[n]=a,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const a=n.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(n.id),this.setDirty()}removeLayer(n){const a=n.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][n.id]=n,this._updatedLayers[a].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const a in this._updatedLayers)n[a]=n[a]||{},n[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)n[a]=n[a]||{},n[a].removedIds=Object.keys(this._removedLayers[a]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(n){this._updatedImages.add(n),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class xr extends o.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.numModelsLoading={}}loadModel(n,a){return o.l(this.requestManager.transformRequest(a,o.R.Model).url).then(d=>{if(!d)return;const m=o.c(d),g=new o.M(n,void 0,void 0,m);return g.computeBoundsAndApplyParent(),g}).catch(d=>{this.fire(new o.a(new Error(`Could not load model ${n} from ${a}: ${d.message}`)))})}load(n,a){this.models[a]||(this.models[a]={});const d=Object.keys(n);this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+d.length;const m=[];for(const g of d)m.push(this.loadModel(g,n[g]));Promise.allSettled(m).then(g=>{for(let b=0;b<g.length;b++){const{status:S,value:A}=g[b];S==="fulfilled"&&A&&(this.models[a][d[b]]=A)}this.numModelsLoading[a]-=d.length,this.fire(new o.b("data",{dataType:"style"}))}).catch(g=>{this.fire(new o.a(new Error(`Could not load models: ${g.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,a){return!!this.getModel(n,a)}getModel(n,a){return this.models[a]||(this.models[a]={}),this.models[a][n]}addModel(n,a,d){this.models[d]||(this.models[d]={}),this.hasModel(n,d)&&this.removeModel(n,d),this.load({[n]:this.requestManager.normalizeModelURL(a)},d)}addModels(n,a){const d={};for(const m in n)d[m]=this.requestManager.normalizeModelURL(n[m]);this.load(d,a)}removeModel(n,a){this.models[a]||(this.models[a]={});const d=this.models[a][n];delete this.models[a][n],d.destroy()}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,a){this.models[a]||(this.models[a]={});for(const d in this.models[a])this.models[a][d].upload(n.context)}}class Ve{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,a,d){const m=String(a);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][m]=this.stateChanges[n][m]||{},o.e(this.stateChanges[n][m],d),this.deletedStates[n]===null){this.deletedStates[n]={};for(const g in this.state[n])g!==m&&(this.deletedStates[n][g]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][m]===null){this.deletedStates[n][m]={};for(const g in this.state[n][m])d[g]||(this.deletedStates[n][m][g]=null)}else for(const g in d)this.deletedStates[n]&&this.deletedStates[n][m]&&this.deletedStates[n][m][g]===null&&delete this.deletedStates[n][m][g]}removeFeatureState(n,a,d){if(this.deletedStates[n]===null)return;const m=String(a);if(this.deletedStates[n]=this.deletedStates[n]||{},d&&a!==void 0)this.deletedStates[n][m]!==null&&(this.deletedStates[n][m]=this.deletedStates[n][m]||{},this.deletedStates[n][m][d]=null);else if(a!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][m])for(d in this.deletedStates[n][m]={},this.stateChanges[n][m])this.deletedStates[n][m][d]=null;else this.deletedStates[n][m]=null;else this.deletedStates[n]=null}getState(n,a){const d=String(a),m=o.e({},(this.state[n]||{})[d],(this.stateChanges[n]||{})[d]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const g=this.deletedStates[n][a];if(g===null)return{};for(const b in g)delete m[b]}return m}initializeTileState(n,a){n.setFeatureState(this.state,a)}coalesceChanges(n,a){const d={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const g={};for(const b in this.stateChanges[m])this.state[m][b]||(this.state[m][b]={}),o.e(this.state[m][b],this.stateChanges[m][b]),g[b]=this.state[m][b];d[m]=g}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const g={};if(this.deletedStates[m]===null)for(const b in this.state[m])g[b]={},this.state[m][b]={};else for(const b in this.deletedStates[m]){if(this.deletedStates[m][b]===null)this.state[m][b]={};else if(this.state[m][b])for(const S of Object.keys(this.deletedStates[m][b]))delete this.state[m][b][S];g[b]=this.state[m][b]}d[m]=d[m]||{},o.e(d[m],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const m in n)n[m].setFeatureState(d,a)}}function jt(h){const{userImage:n}=h;return!!(n&&n.render&&n.render())&&(h.data.replace(new Uint8Array(n.data.buffer)),!0)}class Ur extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(n){this.images[n]={},this.loaded[n]=!1,this.updatedImages[n]={},this.patterns[n]={},this.callbackDispatchedThisFrame[n]={},this.atlasImage[n]=new o.h({width:1,height:1})}isLoaded(){for(const n in this.loaded)if(!this.loaded[n])return!1;return!0}setLoaded(n,a){if(this.loaded[a]!==n&&(this.loaded[a]=n,n)){for(const{ids:d,callback:m}of this.requestors)this._notify(d,a,m);this.requestors=[]}}hasImage(n,a){return!!this.getImage(n,a)}getImage(n,a){return this.images[a][n]}addImage(n,a,d){this._validate(n,d)&&(this.images[a][n]=d)}_validate(n,a){let d=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new o.a(new Error(`Image "${n}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new o.a(new Error(`Image "${n}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new o.a(new Error(`Image "${n}" has invalid "content" value`))),d=!1),d}_validateStretch(n,a){if(!n)return!0;let d=0;for(const m of n){if(m[0]<d||m[1]<m[0]||a<m[1])return!1;d=m[1]}return!0}_validateContent(n,a){return!(n&&(n.length!==4||n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,a,d){d.version=this.images[a][n].version+1,this.images[a][n]=d,this.updatedImages[a][n]=!0}removeImage(n,a){const d=this.images[a][n];delete this.images[a][n],delete this.patterns[a][n],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(n){return Object.keys(this.images[n])}getImages(n,a,d){let m=!0;const g=!!this.loaded[a];if(!g)for(const b of n)this.images[a][b]||(m=!1);g||m?this._notify(n,a,d):this.requestors.push({ids:n,scope:a,callback:d})}getUpdatedImages(n){return this.updatedImages[n]}_notify(n,a,d){const m={};for(const g of n){this.images[a][g]||this.fire(new o.b("styleimagemissing",{id:g}));const b=this.images[a][g];b?m[g]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:o.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,m)}getPixelSize(n){const{width:a,height:d}=this.atlasImage[n];return{width:a,height:d}}getPattern(n,a){const d=this.patterns[a][n],m=this.getImage(n,a);if(!m)return null;if(d&&d.position.version===m.version)return d.position;if(d)d.position.version=m.version;else{const g={w:m.data.width+2,h:m.data.height+2,x:0,y:0},b=new o.I(g,m);this.patterns[a][n]={bin:g,position:b}}return this._updatePatternAtlas(a),this.patterns[a][n].position}bind(n,a){const d=n.gl;let m=this.atlasTexture[a];m?this.dirty&&(m.update(this.atlasImage[a]),this.dirty=!1):(m=new o.T(n,this.atlasImage[a],d.RGBA),this.atlasTexture[a]=m),m.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(n){const a=[];for(const b in this.patterns[n])a.push(this.patterns[n][b].bin);const{w:d,h:m}=o.p(a),g=this.atlasImage[n];g.resize({width:d||1,height:m||1});for(const b in this.patterns[n]){const{bin:S}=this.patterns[n][b],A=S.x+1,P=S.y+1,D=this.images[n][b].data,k=D.width,F=D.height;o.h.copy(D,g,{x:0,y:0},{x:A,y:P},{width:k,height:F}),o.h.copy(D,g,{x:0,y:F-1},{x:A,y:P-1},{width:k,height:1}),o.h.copy(D,g,{x:0,y:0},{x:A,y:P+F},{width:k,height:1}),o.h.copy(D,g,{x:k-1,y:0},{x:A-1,y:P},{width:1,height:F}),o.h.copy(D,g,{x:0,y:0},{x:A+k,y:P},{width:1,height:F})}this.dirty=!0}beginFrame(){for(const n in this.images)this.callbackDispatchedThisFrame[n]={}}dispatchRenderCallbacks(n,a){for(const d of n){if(this.callbackDispatchedThisFrame[a][d])continue;this.callbackDispatchedThisFrame[a][d]=!0;const m=this.images[a][d];jt(m)&&this.updateImage(d,a,m)}}}class $e{constructor(n,a,d,m){this.message=(n?`${n}: `:"")+d,m&&(this.identifier=m),a!=null&&a.__line__&&(this.line=a.__line__)}}class ur extends $e{}function gr(h){const n=h.key,a=h.value,d=h.valueSpec||{},m=h.objectElementValidators||{},g=h.style,b=h.styleSpec;let S=[];const A=o.i(a);if(A!=="object")return[new $e(n,a,`object expected, ${A} found`)];for(const P in a){const D=P.split(".")[0];let k;m[D]?k=m[D]:d[D]?k=vt:m["*"]?k=m["*"]:d["*"]&&(k=vt),k?S=S.concat(k({key:(n&&`${n}.`)+P,value:a[P],valueSpec:d[D]||d["*"],style:g,styleSpec:b,object:a,objectKey:P},a)):S.push(new ur(n,a[P],`unknown property "${P}"`))}for(const P in d)m[P]||d[P].required&&d[P].default===void 0&&a[P]===void 0&&S.push(new $e(n,a,`missing required property "${P}"`));return S}function zt(h){const n=h.value,a=h.valueSpec,d=h.style,m=h.styleSpec,g=h.key,b=h.arrayElementValidator||vt;if(o.i(n)!=="array")return[new $e(g,n,`array expected, ${o.i(n)} found`)];if(a.length&&n.length!==a.length)return[new $e(g,n,`array length ${a.length} expected, length ${n.length} found`)];if(a["min-length"]&&n.length<a["min-length"])return[new $e(g,n,`array length at least ${a["min-length"]} expected, length ${n.length} found`)];let S={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};m.$version<7&&(S.function=a.function),o.i(a.value)==="object"&&(S=a.value);let A=[];for(let P=0;P<n.length;P++)A=A.concat(b({array:n,arrayIndex:P,value:n[P],valueSpec:S,style:d,styleSpec:m,key:`${g}[${P}]`},!0));return A}function vn(h){const n=h.key,a=h.value,d=h.valueSpec;let m=o.i(a);if(m==="number"&&a!=a&&(m="NaN"),m!=="number")return[new $e(n,a,`number expected, ${m} found`)];if("minimum"in d){let g=d.minimum;if(o.i(d.minimum)==="array"&&(g=d.minimum[h.arrayIndex]),a<g)return[new $e(n,a,`${a} is less than the minimum value ${g}`)]}if("maximum"in d){let g=d.maximum;if(o.i(d.maximum)==="array"&&(g=d.maximum[h.arrayIndex]),a>g)return[new $e(n,a,`${a} is greater than the maximum value ${g}`)]}return[]}function Ft(h){const n=h.valueSpec,a=o.u(h.value.type);let d,m,g,b={};const S=a!=="categorical"&&h.value.property===void 0,A=!S,P=o.i(h.value.stops)==="array"&&o.i(h.value.stops[0])==="array"&&o.i(h.value.stops[0][0])==="object",D=gr({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(N){if(a==="identity")return[new $e(N.key,N.value,'identity function may not have a "stops" property')];let q=[];const G=N.value;return q=q.concat(zt({key:N.key,value:G,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:k})),o.i(G)==="array"&&G.length===0&&q.push(new $e(N.key,G,"array must have at least one stop")),q},default:function(N){return vt({key:N.key,value:N.value,valueSpec:n,style:N.style,styleSpec:N.styleSpec})}}});return a==="identity"&&S&&D.push(new $e(h.key,h.value,'missing required property "property"')),a==="identity"||h.value.stops||D.push(new $e(h.key,h.value,'missing required property "stops"')),a==="exponential"&&h.valueSpec.expression&&!o.s(h.valueSpec)&&D.push(new $e(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(A&&!o.k(h.valueSpec)?D.push(new $e(h.key,h.value,"property functions not supported")):S&&!o.m(h.valueSpec)&&D.push(new $e(h.key,h.value,"zoom functions not supported"))),a!=="categorical"&&!P||h.value.property!==void 0||D.push(new $e(h.key,h.value,'"property" property is required')),D;function k(N){let q=[];const G=N.value,W=N.key;if(o.i(G)!=="array")return[new $e(W,G,`array expected, ${o.i(G)} found`)];if(G.length!==2)return[new $e(W,G,`array length 2 expected, length ${G.length} found`)];if(P){if(o.i(G[0])!=="object")return[new $e(W,G,`object expected, ${o.i(G[0])} found`)];if(G[0].zoom===void 0)return[new $e(W,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new $e(W,G,"object stop key must have value")];const U=o.u(G[0].zoom);if(typeof U!="number")return[new $e(W,G[0].zoom,"stop zoom values must be numbers")];if(g&&g>U)return[new $e(W,G[0].zoom,"stop zoom values must appear in ascending order")];U!==g&&(g=U,m=void 0,b={}),q=q.concat(gr({key:`${W}[0]`,value:G[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:vn,value:F}}))}else q=q.concat(F({key:`${W}[0]`,value:G[0],valueSpec:{},style:N.style,styleSpec:N.styleSpec},G));return o.n(o.o(G[1]))?q.concat([new $e(`${W}[1]`,G[1],"expressions are not allowed in function stops.")]):q.concat(vt({key:`${W}[1]`,value:G[1],valueSpec:n,style:N.style,styleSpec:N.styleSpec}))}function F(N,q){const G=o.i(N.value),W=o.u(N.value),U=N.value!==null?N.value:q;if(d){if(G!==d)return[new $e(N.key,U,`${G} stop domain type must match previous stop domain type ${d}`)]}else d=G;if(G!=="number"&&G!=="string"&&G!=="boolean"&&typeof W!="number"&&typeof W!="string"&&typeof W!="boolean")return[new $e(N.key,U,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&a!=="categorical"){let X=`number expected, ${G} found`;return o.k(n)&&a===void 0&&(X+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $e(N.key,U,X)]}return a!=="categorical"||G!=="number"||typeof W=="number"&&isFinite(W)&&Math.floor(W)===W?a!=="categorical"&&G==="number"&&typeof W=="number"&&typeof m=="number"&&m!==void 0&&W<m?[new $e(N.key,U,"stop domain values must appear in ascending order")]:(m=W,a==="categorical"&&W in b?[new $e(N.key,U,"stop domain values must be unique")]:(b[W]=!0,[])):[new $e(N.key,U,`integer expected, found ${String(W)}`)]}}function zr(h){const n=(h.expressionContext==="property"?o.q:o.r)(o.o(h.value),h.valueSpec);if(n.result==="error")return n.value.map(d=>new $e(`${h.key}${d.key}`,h.value,d.message));const a=n.value.expression||n.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!a.outputDefined())return[new $e(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!o.t(a))return[new $e(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return nr(a,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!o.v(a,["zoom","feature-state"]))return[new $e(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!o.x(a))return[new $e(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function nr(h,n){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const m of n.valueSpec.expression.parameters)a.delete(m);if(a.size===0)return[];const d=[];return h instanceof o.C&&a.has(h.name)?[new $e(n.key,n.value,`["${h.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(h.eachChild(m=>{d.push(...nr(m,n))}),d)}function En(h){const n=h.key,a=h.value,d=h.valueSpec,m=[];return Array.isArray(d.values)?d.values.indexOf(o.u(a))===-1&&m.push(new $e(n,a,`expected one of [${d.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(d.values).indexOf(o.u(a))===-1&&m.push(new $e(n,a,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(a)} found`)),m}function dn(h){return o.z(o.o(h.value))?zr(o.j({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):Bn(h)}function Bn(h){const n=h.value,a=h.key;if(o.i(n)!=="array")return[new $e(a,n,`array expected, ${o.i(n)} found`)];const d=h.styleSpec;let m,g=[];if(n.length<1)return[new $e(a,n,"filter array must have at least 1 element")];switch(g=g.concat(En({key:`${a}[0]`,value:n[0],valueSpec:d.filter_operator,style:h.style,styleSpec:h.styleSpec})),o.u(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&o.u(n[1])==="$type"&&g.push(new $e(a,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&g.push(new $e(a,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(m=o.i(n[1]),m!=="string"&&g.push(new $e(`${a}[1]`,n[1],`string expected, ${m} found`)));for(let b=2;b<n.length;b++)m=o.i(n[b]),o.u(n[1])==="$type"?g=g.concat(En({key:`${a}[${b}]`,value:n[b],valueSpec:d.geometry_type,style:h.style,styleSpec:h.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&g.push(new $e(`${a}[${b}]`,n[b],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let b=1;b<n.length;b++)g=g.concat(Bn({key:`${a}[${b}]`,value:n[b],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":m=o.i(n[1]),n.length!==2?g.push(new $e(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):m!=="string"&&g.push(new $e(`${a}[1]`,n[1],`string expected, ${m} found`))}return g}function bn(h,n){const a=h.key,d=h.style,m=h.layer,g=h.styleSpec,b=h.value,S=h.objectKey,A=g[`${n}_${h.layerType}`];if(!A)return[];const P=S.match(/^(.*)-transition$/);if(n==="paint"&&P&&A[P[1]]&&A[P[1]].transition)return vt({key:a,value:b,valueSpec:g.transition,style:d,styleSpec:g});const D=h.valueSpec||A[S];if(!D)return[new ur(a,b,`unknown property "${S}"`)];let k;if(o.i(b)==="string"&&o.k(D)&&!D.tokens&&(k=/^{([^}]+)}$/.exec(b))){const N=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new $e(a,b,`"${S}" does not support interpolation syntax
Use an identity property function instead: ${N}.`)]}const F=[];if(h.layerType==="symbol")S!=="text-field"||!d||d.glyphs||d.imports||F.push(new $e(a,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&o.A(o.o(b))&&o.u(b.type)==="identity"&&F.push(new $e(a,b,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&n==="paint"&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&o.k(D)&&(o.B(D)||o.m(D))){const N=o.q(o.o(b),D),q=N.value.expression||N.value._styleExpression.expression;q&&!o.v(q,["measure-light"])&&(S==="model-emissive-strength"&&o.x(q)&&o.t(q)||F.push(new $e(a,b,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return F.concat(vt({key:h.key,value:b,valueSpec:D,style:d,styleSpec:g,expressionContext:"property",propertyType:n,propertyKey:S}))}function it(h){return bn(h,"paint")}function Kt(h){return bn(h,"layout")}function Gt(h){let n=[];const a=h.value,d=h.key,m=h.style,g=h.styleSpec;a.type||a.ref||n.push(new $e(d,a,'either "type" or "ref" is required'));let b=o.u(a.type);const S=o.u(a.ref);if(a.id){const A=o.u(a.id);for(let P=0;P<h.arrayIndex;P++){const D=m.layers[P];o.u(D.id)===A&&n.push(new $e(d,a.id,`duplicate layer id "${a.id}", previously used at line ${D.id.__line__}`))}}if("ref"in a){let A;["type","source","source-layer","filter","layout"].forEach(P=>{P in a&&n.push(new $e(d,a[P],`"${P}" is prohibited for ref layers`))}),m.layers.forEach(P=>{o.u(P.id)===S&&(A=P)}),A?A.ref?n.push(new $e(d,a.ref,"ref cannot reference another ref layer")):b=o.u(A.type):typeof S=="string"&&n.push(new $e(d,a.ref,`ref layer "${S}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(a.source){const A=m.sources&&m.sources[a.source],P=A&&o.u(A.type);A?P==="vector"&&b==="raster"?n.push(new $e(d,a.source,`layer "${a.id}" requires a raster source`)):P==="raster"&&b!=="raster"?n.push(new $e(d,a.source,`layer "${a.id}" requires a vector source`)):P!=="vector"||a["source-layer"]?P==="raster-dem"&&b!=="hillshade"?n.push(new $e(d,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="raster-array"||["raster","raster-particle"].includes(b)?b!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||P==="geojson"&&A.lineMetrics?b==="raster-particle"&&P!=="raster-array"&&n.push(new $e(d,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):n.push(new $e(d,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new $e(d,a.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new $e(d,a,`layer "${a.id}" must specify a "source-layer"`)):n.push(new $e(d,a.source,`source "${a.source}" not found`))}else n.push(new $e(d,a,'missing required property "source"'));return n=n.concat(gr({key:d,value:a,valueSpec:g.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>vt({key:`${d}.type`,value:a.type,valueSpec:g.layer.type,style:h.style,styleSpec:h.styleSpec,object:a,objectKey:"type"}),filter:A=>dn(o.j({layerType:b},A)),layout:A=>gr({layer:a,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":P=>Kt(o.j({layerType:b},P))}}),paint:A=>gr({layer:a,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":P=>it(o.j({layerType:b,layer:a},P))}})}})),n}function ir(h){const n=h.value,a=h.key,d=o.i(n);return d!=="string"?[new $e(a,n,`string expected, ${d} found`)]:[]}const Vr={promoteId:function({key:h,value:n}){if(o.i(n)==="string")return ir({key:h,value:n});{const a=[];for(const d in n)a.push(...ir({key:`${h}.${d}`,value:n[d]}));return a}}};function Kr(h){const n=h.value,a=h.key,d=h.styleSpec,m=h.style;if(!n.type)return[new $e(a,n,'"type" is required')];const g=o.u(n.type);let b=[];switch(["vector","raster","raster-dem","raster-array"].includes(g)&&(n.url||n.tiles||b.push(new ur(a,n,'Either "url" or "tiles" is required.'))),g){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(gr({key:a,value:n,valueSpec:d[`source_${g.replace("-","_")}`],style:h.style,styleSpec:d,objectElementValidators:Vr})),b;case"geojson":if(b=gr({key:a,value:n,valueSpec:d.source_geojson,style:m,styleSpec:d,objectElementValidators:Vr}),n.cluster)for(const S in n.clusterProperties){const[A,P]=n.clusterProperties[S],D=typeof A=="string"?[A,["accumulated"],["get",S]]:A;b.push(...zr({key:`${a}.${S}.map`,value:P,expressionContext:"cluster-map"})),b.push(...zr({key:`${a}.${S}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return b;case"video":return gr({key:a,value:n,valueSpec:d.source_video,style:m,styleSpec:d});case"image":return gr({key:a,value:n,valueSpec:d.source_image,style:m,styleSpec:d});case"canvas":return[new $e(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return En({key:`${a}.type`,value:n.type,valueSpec:{values:pe(d)},style:m,styleSpec:d})}}function pe(h){return h.source.reduce((n,a)=>{const d=h[a];return d.type.type==="enum"&&(n=n.concat(Object.keys(d.type.values))),n},[])}function ye(h){const n=h.value;let a=[];if(!n)return a;const d=o.i(n);return d!=="string"?(a=a.concat([new $e(h.key,n,`string expected, "${d}" found`)]),a):(function(m){const g=m.indexOf("://")===-1;try{return new URL(m,g?"http://example.com":void 0),!0}catch{return!1}}(n)||(a=a.concat([new $e(h.key,n,`invalid url "${n}"`)])),a)}function qe(h){const n=h.value,a=h.styleSpec,d=a.light,m=h.style;let g=[];const b=o.i(n);if(n===void 0)return g;if(b!=="object")return g=g.concat([new $e("light",n,`object expected, ${b} found`)]),g;for(const S in n){const A=S.match(/^(.*)-transition$/);g=g.concat(A&&d[A[1]]&&d[A[1]].transition?vt({key:S,value:n[S],valueSpec:a.transition,style:m,styleSpec:a}):d[S]?vt({key:S,value:n[S],valueSpec:d[S],style:m,styleSpec:a}):[new $e(S,n[S],`unknown property "${S}"`)])}return g}function ft(h){const n=h.value;let a=[];if(!n)return a;const d=o.i(n);if(d!=="object")return a=a.concat([new $e("light-3d",n,`object expected, ${d} found`)]),a;const m=h.styleSpec,g=m["light-3d"],b=h.key,S=h.style,A=h.style.lights;for(const k of["type","id"])if(!(k in n))return a=a.concat([new $e("light-3d",n,`missing property ${k} on light`)]),a;if(n.type&&A)for(let k=0;k<h.arrayIndex;k++){const F=o.u(n.type),N=A[k];o.u(N.type)===F&&a.push(new $e(b,n.id,`duplicate light type "${n.type}", previously defined at line ${N.id.__line__}`))}const P=`properties_light_${n.type}`;if(!(P in m))return a=a.concat([new $e("light-3d",n,`Invalid light type ${n.type}`)]),a;const D=m[P];for(const k in n)if(k==="properties"){const F=n[k],N=o.i(F);if(N!=="object")return a=a.concat([new $e("properties",F,`object expected, ${N} found`)]),a;for(const q in F)a=a.concat(D[q]?vt({key:q,value:F[q],valueSpec:D[q],style:S,styleSpec:m}):[new ur(h.key,F[q],`unknown property "${q}"`)])}else{const F=k.match(/^(.*)-transition$/);a=a.concat(F&&g[F[1]]&&g[F[1]].transition?vt({key:k,value:n[k],valueSpec:m.transition,style:S,styleSpec:m}):g[k]?vt({key:k,value:n[k],valueSpec:g[k],style:S,styleSpec:m}):[new ur(k,n[k],`unknown property "${k}"`)])}return a}function ct(h){const n=h.value,a=h.key,d=h.style,m=h.styleSpec,g=m.terrain;let b=[];const S=o.i(n);if(n===void 0||S==="null")return b;if(S!=="object")return b=b.concat([new $e("terrain",n,`object expected, ${S} found`)]),b;for(const A in n){const P=A.match(/^(.*)-transition$/);b=b.concat(P&&g[P[1]]&&g[P[1]].transition?vt({key:A,value:n[A],valueSpec:m.transition,style:d,styleSpec:m}):g[A]?vt({key:A,value:n[A],valueSpec:g[A],style:d,styleSpec:m}):[new ur(A,n[A],`unknown property "${A}"`)])}if(n.source){const A=d.sources&&d.sources[n.source],P=A&&o.u(A.type);A?P!=="raster-dem"&&b.push(new $e(a,n.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):b.push(new $e(a,n.source,`source "${n.source}" not found`))}else b.push(new $e(a,n,'terrain is missing required property "source"'));return b}function Bt(h){const n=h.value,a=h.style,d=h.styleSpec,m=d.fog;let g=[];const b=o.i(n);if(n===void 0)return g;if(b!=="object")return g=g.concat([new $e("fog",n,`object expected, ${b} found`)]),g;for(const S in n){const A=S.match(/^(.*)-transition$/);g=g.concat(A&&m[A[1]]&&m[A[1]].transition?vt({key:S,value:n[S],valueSpec:d.transition,style:a,styleSpec:d}):m[S]?vt({key:S,value:n[S],valueSpec:m[S],style:a,styleSpec:d}):[new ur(S,n[S],`unknown property "${S}"`)])}return g}const tr={"*":()=>[],array:zt,boolean:function(h){const n=h.value,a=h.key,d=o.i(n);return d!=="boolean"?[new $e(a,n,`boolean expected, ${d} found`)]:[]},number:vn,color:function(h){const n=h.key,a=h.value,d=o.i(a);return d!=="string"?[new $e(n,a,`color expected, ${d} found`)]:o.y(a)===null?[new $e(n,a,`color expected, "${a}" found`)]:[]},enum:En,filter:dn,function:Ft,layer:Gt,object:gr,source:Kr,model:ye,light:qe,"light-3d":ft,terrain:ct,fog:Bt,string:ir,formatted:function(h){return ir(h).length===0?[]:zr(h)},resolvedImage:function(h){return ir(h).length===0?[]:zr(h)},projection:function(h){const n=h.value,a=h.styleSpec,d=a.projection,m=h.style;let g=[];const b=o.i(n);if(b==="object")for(const S in n)g=g.concat(vt({key:S,value:n[S],valueSpec:d[S],style:m,styleSpec:a}));else b!=="string"&&(g=g.concat([new $e("projection",n,`object or string expected, ${b} found`)]));return g},import:function(h){const{value:n,styleSpec:a}=h,{data:d,...m}=n;Object.defineProperty(m,"__line__",{value:n.__line__,enumerable:!1});let g=gr(o.j({},h,{value:m,valueSpec:a.import}));return o.u(m.id)===""&&g.push(new $e(`${h.key}.id`,m,"import id can't be an empty string")),d&&(g=g.concat(Pt(d,a,{key:`${h.key}.data`}))),g}};function vt(h,n=!1){const a=h.value,d=h.valueSpec,m=h.styleSpec;if(d.expression&&o.A(o.u(a)))return Ft(h);if(d.expression&&o.n(o.o(a)))return zr(h);if(d.type&&tr[d.type]){const g=tr[d.type](h);return n===!0&&g.length>0&&o.i(h.value)==="array"?zr(h):g}return gr(o.j({},h,{valueSpec:d.type?m[d.type]:d}))}function Yt(h){const n=h.value,a=h.key,d=ir(h);return d.length||(n.indexOf("{fontstack}")===-1&&d.push(new $e(a,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&d.push(new $e(a,n,'"glyphs" url must include a "{range}" token'))),d}function Pt(h,n=o.D,a={}){return vt({key:a.key||"",value:h,valueSpec:n.$root,styleSpec:n,style:h,objectElementValidators:{glyphs:Yt,"*":()=>[]}})}function rr(h,n=o.D){return Ge(Pt(h,n))}const br=h=>Ge(Kr(h)),yr=h=>Ge(qe(h)),Ie=h=>Ge(ft(h)),Z=h=>Ge(ct(h)),te=h=>Ge(Bt(h)),he=h=>Ge(Gt(h)),ke=h=>Ge(dn(h)),We=h=>Ge(it(h)),nt=h=>Ge(Kt(h)),Ut=h=>Ge(ye(h));function Ge(h){return h.slice().sort((n,a)=>n.line&&a.line?n.line-a.line:0)}function Ht(h,n){let a=!1;if(n&&n.length)for(const d of n)d instanceof ur?o.w(d.message):(h.fire(new o.a(new Error(d.message))),a=!0);return a}const Et=new o.F({anchor:new o.G(o.D.light.anchor),position:new o.H(o.D.light.position),color:new o.G(o.D.light.color),intensity:new o.G(o.D.light.intensity)});class Pe extends o.E{constructor(n,a="flat"){super(),this._transitionable=new o.J(Et),this.setLight(n,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a,d={}){this._validate(yr,n,d)||(this._transitionable.setTransitionOrValue(n),this.id=a)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,d){return(!d||d.validate!==!1)&&Ht(this,n.call(rr,o.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.D})))}}const ue=new o.F({source:new o.G(o.D.terrain.source),exaggeration:new o.G(o.D.terrain.exaggeration)});let Je=class extends o.E{constructor(h,n,a,d){super(),this.scope=a,this._transitionable=new o.J(ue,a,d),this._transitionable.setTransitionOrValue(h,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(h,n){this._transitionable.setTransitionOrValue(h,n)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new o.K(h)).get("exaggeration")}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof o.Z}};const Ot=45,hr=65,Sr=.05;function Rr(h,n,a,d){const m=o.O(Ot,hr,a),[g,b]=Hr(h,d);let S=1-Math.min(1,Math.exp((n-g)/(b-g)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*m*h.alpha}function Hr(h,n){const a=.5/Math.tan(.5*n);return[h.range[0]+a,h.range[1]+a]}function Tn(h,n,a,d,m){const g=o.N.transformMat4([],[n,a,d],m.mercatorFogMatrix);return Rr(h,o.N.length(g),m.pitch,m._fov)}function Qn(h,n,a,d,m,g,b){const S=[[a,d,0],[m,d,0],[m,g,0],[a,g,0]];let A=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(const D of S){const k=o.N.transformMat4([],D,n),F=o.N.length(k);A=Math.min(A,F),P=Math.max(P,F)}return[Rr(h,A,b.pitch,b._fov),Rr(h,P,b.pitch,b._fov)]}const An=new o.F({range:new o.G(o.D.fog.range),color:new o.G(o.D.fog.color),"high-color":new o.G(o.D.fog["high-color"]),"space-color":new o.G(o.D.fog["space-color"]),"horizon-blend":new o.G(o.D.fog["horizon-blend"]),"star-intensity":new o.G(o.D.fog["star-intensity"]),"vertical-range":new o.G(o.D.fog["vertical-range"])});class Vn extends o.E{constructor(n,a,d,m){super(),this._transitionable=new o.J(An,d,new Map(m)),this.set(n,m),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new o.Q(An)}get state(){const n=this._transform,a=n.projection.name==="globe",d=o.S(n.zoom),m=this.properties.get("range"),g=[.5,3];return{range:a?[o.U(g[0],m[0],d),o.U(g[1],m[1],d)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a,d={}){if(this._validate(te,n,d))return;const m=o.e({},n);for(const g of Object.keys(o.D.fog))m[g]===void 0&&(m[g]=o.D.fog[g].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.O(Ot,hr,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?function(d,m,g){const b=o.L.fromLngLat(m),S=g.elevation?g.elevation.getAtPointOrZero(b):0;return Tn(d,b.x,b.y,S,g)}(this.state,n,a):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Qn(this.state,a,0,0,o.V,o.V,this._transform)}getOpacityForBounds(n,a,d,m,g){return this._transform.projection.supportsFog?Qn(this.state,n,a,d,m,g,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Hr(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const d of a){const m=n.points[d];let g;if(m[2]>=0)g=m;else{const b=n.points[d-4];g=o.W(b,m,b[2]/(b[2]-m[2]))}if(Tn(this.state,g[0],g[1],0,this._transform)>=Sr)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,d){return(!d||d.validate!==!1)&&Ht(this,n.call(rr,o.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.D})))}}class bi extends o.E{constructor(n,a,d,m){super(),this.scope=d,this._options=n,this.properties=new o.Q(a),this._transitionable=new o.J(a,d,new Map(m)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,a){this._options=n,this._transitionable.setTransitionOrValue(n.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const Ci=new o.F({color:new o.G(o.D.properties_light_ambient.color),intensity:new o.G(o.D.properties_light_ambient.intensity)}),Wn=new o.F({direction:new o.X(o.D.properties_light_directional.direction),color:new o.G(o.D.properties_light_directional.color),intensity:new o.G(o.D.properties_light_directional.intensity),"cast-shadows":new o.G(o.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new o.G(o.D.properties_light_directional["shadow-intensity"])});class jn{constructor(n,a,d,m){this.screenBounds=n,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(n,a){let d,m;if(n instanceof o.P||typeof n[0]=="number"){const g=o.P.convert(n);d=[g],m=a.isPointAboveHorizon(g)}else{const g=o.P.convert(n[0]),b=o.P.convert(n[1]);d=[g,b],m=o.Y(g,b).every(S=>a.isPointAboveHorizon(S))}return new jn(d,a.getCameraPoint(),m,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return o.Y(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],m=o.Y(a,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<d.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?m[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(m[3]=this.cameraPoint)),o._(m,n)}bufferedCameraGeometryGlobe(n){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],m=o.Y(a,d,n),g=this.cameraPoint.clone();switch(3*((g.y>a.y)+(g.y>d.y))+((g.x>a.x)+(g.x>d.x))){case 0:m[0]=g,m[4]=g.clone();break;case 1:m.splice(1,0,g);break;case 2:m[1]=g;break;case 3:m.splice(4,0,g);break;case 5:m.splice(2,0,g);break;case 6:m[3]=g;break;case 7:m.splice(3,0,g);break;case 8:m[2]=g}return m}containsTile(n,a,d,m=0){const g=n.queryPadding/a._pixelsPerMercatorPixel+1,b=d?this._bufferedCameraMercator(g,a):this._bufferedScreenMercator(g,a);let S=n.tileID.wrap+(b.unwrapped?m:0);const A=b.polygon.map(W=>o.$(n.tileTransform,W,S));if(!o.a0(A,0,0,o.V,o.V))return;S=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const P=this.screenGeometryMercator.polygon.map(W=>o.a1(n.tileTransform,W,S)),D=P.map(W=>new o.P(W[0],W[1])),k=a.getFreeCameraOptions().position||new o.L(0,0,0),F=o.a1(n.tileTransform,k,S),N=P.map(W=>{const U=o.N.sub(W,W,F);return o.N.normalize(U,U),new o.a2(F,U)}),q=o.a3(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:N,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(G=o.a4(A),G.min.x=o.aa(G.min.x,0,o.V),G.min.y=o.aa(G.min.y,0,o.V),G.max.x=o.aa(G.max.x,0,o.V),G.max.y=o.aa(G.max.y,0,o.V),G),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:q};var G}_bufferedScreenMercator(n,a){const d=pt(n);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let m;return m=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map(g=>a.pointCoordinate3D(g)),unwrapped:!0},this._screenRaycastCache[d]=m,m}}_bufferedCameraMercator(n,a){const d=pt(n);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let m;return m=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map(g=>a.pointCoordinate3D(g)),unwrapped:!0},this._cameraRaycastCache[d]=m,m}}_projectAndResample(n,a){const d=function(g,b){const S=o.a6.multiply([],b.pixelMatrix,b.globeMatrix),A=[0,-o.ab,0,1],P=[0,o.ab,0,1],D=[0,0,0,1];o.a7.transformMat4(A,A,S),o.a7.transformMat4(P,P,S),o.a7.transformMat4(D,D,S);const k=new o.P(A[0]/A[3],A[1]/A[3]),F=new o.P(P[0]/P[3],P[1]/P[3]),N=o.a8(g,k)&&A[3]<D[3],q=o.a8(g,F)&&P[3]<D[3];if(!N&&!q)return null;const G=function(se,ce,de){for(let ge=1;ge<se.length;ge++){const De=Ye(ce.pointCoordinate3D(se[ge-1]).x),xe=Ye(ce.pointCoordinate3D(se[ge]).x);if(de<0){if(De<xe)return{idx:ge,t:-De/(xe-1-De)}}else if(xe<De)return{idx:ge,t:(1-De)/(xe+1-De)}}return null}(g,b,N?-1:1);if(!G)return null;const{idx:W,t:U}=G;let X=W>1?He(g.slice(0,W),b):[],re=W<g.length?He(g.slice(W),b):[];X=X.map(se=>new o.P(Ye(se.x),se.y)),re=re.map(se=>new o.P(Ye(se.x),se.y));const J=[...X];J.length===0&&J.push(re[re.length-1]);const ne=o.U(J[J.length-1].y,(re.length===0?X[0]:re[0]).y,U);let Y;return Y=N?[new o.P(0,ne),new o.P(0,0),new o.P(1,0),new o.P(1,ne)]:[new o.P(1,ne),new o.P(1,1),new o.P(0,1),new o.P(0,ne)],J.push(...Y),re.length===0?J.push(X[0]):J.push(...re),{polygon:J.map(se=>new o.L(se.x,se.y)),unwrapped:!1}}(n,a);if(d)return d;const m=function(g,b){let S=!1,A=-1/0,P=0;for(let k=0;k<g.length-1;k++)g[k].x>A&&(A=g[k].x,P=k);for(let k=0;k<g.length-1;k++){const F=(P+k)%(g.length-1),N=g[F],q=g[F+1];Math.abs(N.x-q.x)>.5&&(N.x<q.x?(N.x+=1,F===0&&(g[g.length-1].x+=1)):(q.x+=1,F+1===g.length-1&&(g[0].x+=1)),S=!0)}const D=o.a5(b.center.lng);return S&&D<Math.abs(D-1)&&g.forEach(k=>{k.x-=1}),{polygon:g,unwrapped:S}}(He(n,a).map(g=>new o.P(Ye(g.x),g.y)),a);return{polygon:m.polygon.map(g=>new o.L(g.x,g.y)),unwrapped:m.unwrapped}}}function He(h,n){return o.a9(h,a=>{const d=n.pointCoordinate3D(a);a.x=d.x,a.y=d.y},1/256)}function Ye(h){return h<0?1+h%1:h%1}function pt(h){return 100*h|0}function Mt(h,n,a,d,m){const g=function(b,S){if(b)return m(b);if(S){h.url&&S.tiles&&h.tiles&&delete h.tiles;const A=o.ac(o.e(S,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(A.vectorLayers=S.vector_layers,A.vectorLayerIds=A.vectorLayers.map(P=>P.id)),S.raster_layers&&(A.rasterLayers=S.raster_layers,A.rasterLayerIds=A.rasterLayers.map(P=>P.id)),A.tiles=n.canonicalizeTileset(A,h.url),m(null,A)}};return h.url?o.g(n.transformRequest(n.normalizeSourceURL(h.url,null,a,d),o.R.Source),g):o.f.frame(()=>g(null,h))}class bt{constructor(n,a,d){this.bounds=o.ad.convert(this.validateBounds(n)),this.minzoom=a||0,this.maxzoom=d||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const a=Math.pow(2,n.z),d=Math.floor(o.a5(this.bounds.getWest())*a),m=Math.floor(o.ae(this.bounds.getNorth())*a),g=Math.ceil(o.a5(this.bounds.getEast())*a),b=Math.ceil(o.ae(this.bounds.getSouth())*a);return n.x>=d&&n.x<g&&n.y>=m&&n.y<b}}class Lt extends o.E{constructor(n,a,d,m){if(super(),this.id=n,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.ac(a,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new o.af}load(n){this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map._worldview;this._tileJSONRequest=Mt(this._options,this.map._requestManager,a,d,(m,g)=>{this._tileJSONRequest=null,this._loaded=!0,m?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),d&&d.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new o.a(m))):g&&(o.e(this,g),g.bounds&&(this.tileBounds=new bt(g.bounds,this.minzoom,this.maxzoom)),o.aj(g.tiles,this.map._requestManager._customAccessToken),this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))),n&&n(m)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=o.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.e({},this._options)}loadTile(n,a){const d=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(d,o.R.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster};if(m.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=a:n.request=n.actor.send("reloadTile",m,g.bind(this));else if(n.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",m,g.bind(this),void 0,!0);else{const b=o.ah.call({deduped:this._deduped},m,(S,A)=>{S||!A?g.call(this,S):(m.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},n.actor&&n.actor.send("loadTile",m,g.bind(this),void 0,!0))},!0);n.request={cancel:b}}function g(b,S){return delete n.request,n.aborted?a(null):b&&b.status!==404?a(b):(S&&S.resourceTiming&&(n.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&n.setExpiryData(S),n.loadVectorData(S,this.map.painter),o.ai(this.dispatcher),a(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Rt extends o.E{constructor(n,a,d,m){super(),this.id=n,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},a),o.e(this,o.ac(a,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"})),this._tileJSONRequest=Mt(this._options,this.map._requestManager,null,null,(a,d)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new o.a(a)):d&&(o.e(this,d),d.bounds&&(this.tileBounds=new bt(d.bounds,this.minzoom,this.maxzoom)),o.aj(d.tiles),this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))),n&&n(a)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=o.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){const d=o.f.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);n.request=o.d(this.map._requestManager.transformRequest(m,o.R.Tile),(g,b,S,A)=>(delete n.request,n.aborted?(n.state="unloaded",a(null)):g?(n.state="errored",a(g)):b?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:S,expires:A}),n.setTexture(b,this.map.painter),n.state="loaded",o.ai(this.dispatcher),void a(null)):a(null)))}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a()}unloadTile(n,a){n.texture&&n.texture instanceof o.T?(n.destroy(!0),n.texture&&n.texture instanceof o.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Tt extends Rt{constructor(n,a,d,m){super(n,a,d,m),this.type="raster-array",this.maxzoom=22,this._options=o.e({type:"raster-array"},a)}triggerRepaint(n){const a=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);a&&a.enabled&&d&&a._clearRenderCacheForTile(d.id,n.tileID),this.map.triggerRepaint()}loadTile(n,a){const d=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(d,o.R.Tile);n.requestParams=m,n.actor||(n.actor=this.dispatcher.getActor()),n.request=n.fetchHeader(void 0,(g,b,S,A)=>{if(delete n.request,n.aborted)return n.state="unloaded",a(null);if(g)return g.code===20?void 0:(n.state="errored",a(g));this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:S,expires:A}),n.state="empty",a(null)})}unloadTile(n){const a=n.texture;a&&a instanceof o.T?(n.destroy(!0),this.map.painter.saveTileTexture(a)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,a,d){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(a,d,(m,g)=>{if(m)return n.state="errored",this.fire(new o.a(m)),void this.triggerRepaint(n);g&&(n.setTexture(g,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find(({id:g})=>g===n),d=a&&a.fields,m=d&&d.bands&&d.bands;return m?m[0]:0}getTextureDescriptor(n,a,d){if(!n)return;const m=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let g=null;a instanceof o.an?g=a.paint.get("raster-array-band"):a instanceof o.ao&&(g=a.paint.get("raster-particle-array-band"));const b=g||this.getInitialBand(m);if(b!=null)if(n.textureDescriptor){if(!n.updateNeeded(m,b)||d)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,m,b)}}const Nt=32,At=33,Tr=new Uint16Array(8184);for(let h=0;h<2046;h++){let n=h+2,a=0,d=0,m=0,g=0,b=0,S=0;for(1&n?m=g=b=Nt:a=d=S=Nt;(n>>=1)>1;){const P=a+m>>1,D=d+g>>1;1&n?(m=a,g=d,a=b,d=S):(a=m,d=g,m=b,g=S),b=P,S=D}const A=4*h;Tr[A+0]=a,Tr[A+1]=d,Tr[A+2]=m,Tr[A+3]=g}const Qr=new Uint16Array(2178),lr=new Uint8Array(1089),In=new Uint16Array(1089);function Gn(h){return h===0?-.03125:h===32?.03125:0}class Ln{constructor(n,a,d,m){this.id=Ln.uniqueIdxCounter,Ln.uniqueIdxCounter++,this.context=n;const g=n.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||m||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=Ln.uniqueIdxCounter,Ln.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ln.uniqueIdxCounter=0;const mi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fi{constructor(n,a,d,m,g,b){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=m,this.instanceCount=b,this.context=n;const S=n.gl;this.buffer=S.createBuffer(),n.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||g||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let d=0;d<this.attributes.length;d++){const m=a.attributes[this.attributes[d].name];m!==void 0&&n.enableVertexAttribArray(m)}}setVertexAttribPointers(n,a,d){for(let m=0;m<this.attributes.length;m++){const g=this.attributes[m],b=a.attributes[g.name];b!==void 0&&n.vertexAttribPointer(b,g.components,n[mi[g.type]],!1,this.itemSize,g.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(n,a,d){for(let m=0;m<this.attributes.length;m++){const g=a.attributes[this.attributes[m].name];g!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(g,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class pn{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ms extends pn{getDefault(){return o.ax.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class zs extends pn{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Bi extends pn{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class yc extends pn{getDefault(){return[!0,!0,!0,!0]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Bo extends pn{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class sl extends pn{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class gd extends pn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class wa extends pn{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class yd extends pn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class ol extends pn{getDefault(){return[0,1]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class dm extends pn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class ku extends pn{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class vd extends pn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class Ou extends pn{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class xd extends pn{getDefault(){return o.ax.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class ns extends pn{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class hi extends pn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class en extends pn{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class fm extends pn{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let zu=class extends pn{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class bd extends pn{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Ry extends pn{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Js extends pn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class wd extends pn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class ky extends pn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class al extends pn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class $t extends pn{getDefault(){return null}set(n){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class _n extends pn{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class gn extends pn{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Ss extends pn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class ll extends pn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class on extends pn{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class Fu extends on{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class cl extends on{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class vc extends on{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class is extends cl{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ci{constructor(n,a,d,m,g){this.context=n,this.width=a,this.height=d;const b=this.framebuffer=n.gl.createFramebuffer();m&&(this.colorAttachment=new Fu(n,b)),g&&(this.depthAttachmentType=g,this.depthAttachment=g==="renderbuffer"?new cl(n,b):new vc(n,b))}destroy(){const n=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&n.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&n.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&n.deleteTexture(a)}n.deleteFramebuffer(this.framebuffer)}}class pr{constructor(n,a,d){this.func=n,this.mask=a,this.range=d}}pr.ReadOnly=!1,pr.ReadWrite=!0,pr.disabled=new pr(519,pr.ReadOnly,[0,1]);const Ta=7680;class Er{constructor(n,a,d,m,g,b){this.test=n,this.ref=a,this.mask=d,this.fail=m,this.depthFail=g,this.pass=b}}Er.disabled=new Er({func:519,mask:0},0,0,Ta,Ta,Ta);const No=771;class jr{constructor(n,a,d,m){this.blendFunction=n,this.blendColor=a,this.mask=d,this.blendEquation=m}}jr.Replace=[1,0,1,0],jr.disabled=new jr(jr.Replace,o.ax.transparent,[!1,!1,!1,!1]),jr.unblended=new jr(jr.Replace,o.ax.transparent,[!0,!0,!0,!0]),jr.alphaBlended=new jr([1,No,1,No],o.ax.transparent,[!0,!0,!0,!0]),jr.multiply=new jr([774,0,774,0],o.ax.transparent,[!0,!0,!0,!0]);const ul=1029,Ni=2305;class mr{constructor(n,a,d){this.enable=n,this.mode=a,this.frontFace=d}}mr.disabled=new mr(!1,ul,Ni),mr.backCCW=new mr(!0,ul,Ni),mr.backCW=new mr(!0,ul,2304),mr.frontCW=new mr(!0,1028,2304),mr.frontCCW=new mr(!0,1028,Ni);class pm{constructor(n,a){this.gl=n,this.clearColor=new ms(this),this.clearDepth=new zs(this),this.clearStencil=new Bi(this),this.colorMask=new yc(this),this.depthMask=new Bo(this),this.stencilMask=new sl(this),this.stencilFunc=new gd(this),this.stencilOp=new wa(this),this.stencilTest=new yd(this),this.depthRange=new ol(this),this.depthTest=new dm(this),this.depthFunc=new ku(this),this.blend=new vd(this),this.blendFunc=new Ou(this),this.blendColor=new xd(this),this.blendEquation=new ns(this),this.cullFace=new hi(this),this.cullFaceSide=new en(this),this.frontFace=new fm(this),this.program=new zu(this),this.activeTexture=new bd(this),this.viewport=new Ry(this),this.bindFramebuffer=new Js(this),this.bindRenderbuffer=new wd(this),this.bindTexture=new ky(this),this.bindVertexBuffer=new al(this),this.bindElementBuffer=new $t(this),this.bindVertexArrayOES=new _n(this),this.pixelStoreUnpack=new gn(this),this.pixelStoreUnpackPremultiplyAlpha=new Ss(this),this.pixelStoreUnpackFlipY=new ll(this),this.options=a?{...a}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a,d){return new Ln(this,n,a,d)}createVertexBuffer(n,a,d,m,g){return new Fi(this,n,a,d,m,g)}createRenderbuffer(n,a,d){const m=this.gl,g=m.createRenderbuffer();return this.bindRenderbuffer.set(g),m.renderbufferStorage(m.RENDERBUFFER,n,a,d),this.bindRenderbuffer.set(null),g}createFramebuffer(n,a,d,m){return new ci(this,n,a,d,m)}clear({color:n,depth:a,stencil:d,colorMask:m}){const g=this.gl;let b=0;n&&(b|=g.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set(m||[!0,!0,!0,!0])),a!==void 0&&(b|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(b|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),g.clear(b)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){B(n.blendFunction,jr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var Sa=o.ay([{name:"a_pos",type:"Float32",components:3}]);class _i{constructor(n,a,d,m){const g={width:d[0],height:d[1],data:null},b=n.gl;this.targetColorTexture=new o.T(n,g,b.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new o.T(n,g,b.RGBA,{useMipmap:!1}),this.context=n,this.setNumParticles(a,m),this.lastInvalidatedAt=0}setNumParticles(n,a){if(this.numParticles===a)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());const d=new o.az;d.reserve(Math.round(a));const m=o.aA(n.key);for(let g=0;g<a;g++)d.emplaceBack(m(),m(),m());this.particleVertices0=this.context.createVertexBuffer(d,Sa.members,!0),this.particleVertices1=this.context.createVertexBuffer(d,Sa.members,!0),this.particleSegment=o.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=a}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=o.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}const Ms={type:2,extent:o.V,loadGeometry:()=>[[new o.P(0,0),new o.P(o.V+1,0),new o.P(o.V+1,o.V+1),new o.P(0,o.V+1),new o.P(0,0)]]};class Vo{constructor(n,a,d,m,g){this.tileID=n,this.uid=o.aC(),this.uses=0,this.tileSize=a,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(n){const a=n+this.timeAdded;a<o.f.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,a,d){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(m,g){const b={};if(!g)return b;for(const S of m){const A=S.layerIds.map(P=>g.getLayer(P)).filter(Boolean);if(A.length!==0){S.layers=A,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(P=>A.filter(D=>D.id===P)[0]));for(const P of A)b[P.fqid]=S}}return b}(n.buckets,a.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const g=this.buckets[m];if(g instanceof o.aE){if(this.hasSymbolBuckets=!0,!d)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const g=this.buckets[m];if(g instanceof o.aE&&g.hasRTLText){this.hasRTLText=!0,o.aF();break}}this.queryPadding=0;for(const m in this.buckets){const g=this.buckets[m],b=a.style.getOwnLayer(m);if(!b)continue;const S=b.queryRadius(g);this.queryPadding=Math.max(this.queryPadding,S)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new o.aD}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const m in this.buckets){const g=this.buckets[m];g.uploadPending()&&g.upload(n)}const a=n.gl,d=this.imageAtlas;if(d&&!d.uploaded){const m=!!Object.keys(d.patternPositions).length;this.imageAtlasTexture=new o.T(n,d.image,a.RGBA,{useMipmap:m}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(n,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(n,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(n,a,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,d),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const m=a.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this._lastUpdatedBrightness=m,this.updateBuckets(void 0,a)))}queryRenderedFeatures(n,a,d,m,g,b,S,A){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:m,pixelPosMatrix:S,transform:b,params:g,tileTransform:this.tileTransform},n,a,d):{}}querySourceFeatures(n,a){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const m=d.loadVTLayers(),g=a?a.sourceLayer:"",b=m._geojsonTileLayer||m[g];if(!b)return;const S=o.aG(a&&a.filter),{z:A,x:P,y:D}=this.tileID.canonical,k={z:A,x:P,y:D};for(let F=0;F<b.length;F++){const N=b.feature(F);if(S.needGeometry){const W=o.aH(N,!0);if(!S.filter(new o.K(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!S.filter(new o.K(this.tileID.overscaledZ),N))continue;const q=d.getId(N,g),G=new o.aI(N,A,P,D,q);G.tile=k,n.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const n in this.buckets)if(this.buckets[n].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const a=this.expirationTime;if(n.cacheControl){const d=o.aJ(n.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const d=Date.now();let m=!1;if(this.expirationTime>d)m=!1;else if(a)if(this.expirationTime<a)m=!0;else{const g=this.expirationTime-a;g?this.expirationTime=d+Math.max(g,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,a){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0&&a&&this.updateBuckets(n,a)}updateBuckets(n,a){if(!this.latestFeatureIndex)return;const d=this.latestFeatureIndex.loadVTLayers(),m=a.style.listImages(),g=a.style.getBrightness();for(const b in this.buckets){if(!a.style.hasLayer(b))continue;const S=this.buckets[b],A=S.layers[0].sourceLayer||"_geojsonTileLayer",P=d[A];let D={};if(n&&(D=n[A],!P||!D||Object.keys(D).length===0))continue;if(S.update(D,P,m,this.imageAtlas&&this.imageAtlas.patternPositions||{},g),S instanceof o.aK||S instanceof o.aL){const F=a.style.getOwnSourceCache(S.layers[0].source);a._terrain&&a._terrain.enabled&&F&&S.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(F.id,this.tileID)}const k=a&&a.style&&a.style.getOwnLayer(b);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=o.f.now()+n}setTexture(n,a){const d=a.context,m=d.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture&&this.texture instanceof o.T?this.texture.update(n,{useMipmap:!0}):(this.texture=new o.T(d,n,m.RGBA,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(n,a){const d={};for(const m of a)d[m]=!0;this.dependencies[n]=d}hasDependency(n,a){for(const d of n){const m=this.dependencies[d];if(m){for(const g of a)if(m[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const d=o.aM(Ms,this.tileID.canonical,this.tileTransform)[0],m=new o.aN,g=new o.aO;for(let b=0;b<d.length;b++){const{x:S,y:A}=d[b];m.emplaceBack(S,A),g.emplaceBack(b)}g.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(g),this._tileDebugBuffer=n.createVertexBuffer(m,o.aP.members),this._tileDebugSegments=o.aB.simpleSegment(0,0,m.length,g.length)}_makeTileBoundsBuffers(n,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const d=o.aM(Ms,this.tileID.canonical,this.tileTransform)[0];let m,g;if(this.isRaster){const b=function(S,A){const P=o.as(S,A),D=Math.pow(2,S.z);for(let W=0;W<At;W++)for(let U=0;U<At;U++){const X=o.at((S.x+(U+Gn(U))/Nt)/D),re=o.au((S.y+(W+Gn(W))/Nt)/D),J=A.project(X,re),ne=W*At+U;Qr[2*ne+0]=Math.round((J.x*P.scale-P.x)*o.V),Qr[2*ne+1]=Math.round((J.y*P.scale-P.y)*o.V)}lr.fill(0),In.fill(0);for(let W=2045;W>=0;W--){const U=4*W,X=Tr[U+0],re=Tr[U+1],J=Tr[U+2],ne=Tr[U+3],Y=X+J>>1,se=re+ne>>1,ce=Y+se-re,de=se+X-Y,ge=re*At+X,De=ne*At+J,xe=se*At+Y,Ne=Math.hypot((Qr[2*ge+0]+Qr[2*De+0])/2-Qr[2*xe+0],(Qr[2*ge+1]+Qr[2*De+1])/2-Qr[2*xe+1])>=16;lr[xe]=lr[xe]||(Ne?1:0),W<1022&&(lr[xe]=lr[xe]||lr[(re+de>>1)*At+(X+ce>>1)]||lr[(ne+de>>1)*At+(J+ce>>1)])}const k=new o.av,F=new o.aw;let N=0;function q(W,U){const X=U*At+W;return In[X]===0&&(k.emplaceBack(Qr[2*X+0],Qr[2*X+1],W*o.V/Nt,U*o.V/Nt),In[X]=++N),In[X]-1}function G(W,U,X,re,J,ne){const Y=W+X>>1,se=U+re>>1;if(Math.abs(W-J)+Math.abs(U-ne)>1&&lr[se*At+Y])G(J,ne,W,U,Y,se),G(X,re,J,ne,Y,se);else{const ce=q(W,U),de=q(X,re),ge=q(J,ne);F.emplaceBack(ce,de,ge)}}return G(0,0,Nt,Nt,Nt,0),G(Nt,Nt,0,0,0,Nt),{vertices:k,indices:F}}(this.tileID.canonical,a);m=b.vertices,g=b.indices}else{m=new o.av,g=new o.aw;for(const{x:S,y:A}of d)m.emplaceBack(S,A,0,0);const b=o.aQ(m.int16,void 0,4);for(let S=0;S<b.length;S+=3)g.emplaceBack(b[S],b[S+1],b[S+2])}this._tileBoundsBuffer=n.createVertexBuffer(m,o.aR.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(g),this._tileBoundsSegments=o.aB.simpleSegment(0,0,m.length,g.length)}_makeGlobeTileDebugBuffers(n,a){const d=a.projection;if(!d||d.name!=="globe"||a.freezeTileCoverage)return;const m=this.tileID.canonical,g=o.aS(m,a),b=o.aT(g),S=o.S(a.zoom);let A;S>0&&(A=o.a6.invert(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,m,a,b,A,S),this._makeGlobeTileDebugTextBuffer(n,m,a,b,A,S)}_globePoint(n,a,d,m,g,b,S){let A=o.aU(n,a,d);if(b){const P=1<<d.z,D=o.a5(m.center.lng),k=o.ae(m.center.lat),F=(d.x+.5)/P-D;let N=0;F>.5?N=-1:F<-.5&&(N=1);let q=(n/o.V+d.x)/P+N,G=(a/o.V+d.y)/P;q=(q-D)*m._pixelsPerMercatorPixel+D,G=(G-k)*m._pixelsPerMercatorPixel+k;const W=[q*m.worldSize,G*m.worldSize,0];o.N.transformMat4(W,W,b),A=o.aV(A,W,S)}return o.N.transformMat4(A,A,g)}_makeGlobeTileDebugBorderBuffer(n,a,d,m,g,b){const S=new o.aN,A=new o.aO,P=new o.aW,D=(F,N,q,G,W)=>{const U=(q-F)/(W-1),X=(G-N)/(W-1),re=S.length;for(let J=0;J<W;J++){const ne=F+J*U,Y=N+J*X;S.emplaceBack(ne,Y);const se=this._globePoint(ne,Y,a,d,m,g,b);P.emplaceBack(se[0],se[1],se[2]),A.emplaceBack(re+J)}},k=o.V;D(0,0,k,0,16),D(k,0,k,k,16),D(k,k,0,k,16),D(0,k,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(A),this._tileDebugBuffer=n.createVertexBuffer(S,o.aP.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(P,o.aX.members),this._tileDebugSegments=o.aB.simpleSegment(0,0,S.length,A.length)}_makeGlobeTileDebugTextBuffer(n,a,d,m,g,b){const S=o.V/4,A=new o.aN,P=new o.aw,D=new o.aW,k=25;P.reserve(32),A.reserve(k),D.reserve(k);const F=(N,q)=>k*N+q;for(let N=0;N<k;N++){const q=N*S;for(let G=0;G<k;G++){const W=G*S;A.emplaceBack(W,q);const U=this._globePoint(W,q,a,d,m,g,b);D.emplaceBack(U[0],U[1],U[2])}}for(let N=0;N<4;N++)for(let q=0;q<4;q++){const G=F(N,q),W=F(N,q+1),U=F(N+1,q),X=F(N+1,q+1);P.emplaceBack(G,W,U),P.emplaceBack(U,W,X)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(P),this._tileDebugTextBuffer=n.createVertexBuffer(A,o.aP.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(D,o.aX.members),this._tileDebugTextSegments=o.aB.simpleSegment(0,0,k,32)}destroy(n=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const _o={vector:Lt,raster:Rt,"raster-dem":class extends Rt{constructor(h,n,a,d){super(h,n,a,d),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(h,n){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(m,g){m&&(h.state="errored",n(m)),g&&(h.dem=g,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",n(null))}h.request=o.d(this.map._requestManager.transformRequest(a,o.R.Tile),(function(m,g,b,S){if(delete h.request,h.aborted)h.state="unloaded",n(null);else if(m)h.state="errored",n(m);else if(g){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:b,expires:S});const A=ImageBitmap&&g instanceof ImageBitmap&&o.ak(),P=1-(g.width-o.al(g.width))/2;P<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const D=A?g:o.f.getImageData(g,P),k={uid:h.uid,coord:h.tileID,source:this.id,scope:this.scope,rawImageData:D,encoding:this.encoding,padding:P};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",k,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const n=h.canonical,a=Math.pow(2,n.z),d=(n.x-1+a)%a,m=n.x===0?h.wrap-1:h.wrap,g=(n.x+1+a)%a,b=n.x+1===a?h.wrap+1:h.wrap,S={};return S[new o.am(h.overscaledZ,m,n.z,d,n.y).key]={backfilled:!1},S[new o.am(h.overscaledZ,b,n.z,g,n.y).key]={backfilled:!1},n.y>0&&(S[new o.am(h.overscaledZ,m,n.z,d,n.y-1).key]={backfilled:!1},S[new o.am(h.overscaledZ,h.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},S[new o.am(h.overscaledZ,b,n.z,g,n.y-1).key]={backfilled:!1}),n.y+1<a&&(S[new o.am(h.overscaledZ,m,n.z,d,n.y+1).key]={backfilled:!1},S[new o.am(h.overscaledZ,h.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},S[new o.am(h.overscaledZ,b,n.z,g,n.y+1).key]={backfilled:!1}),S}},"raster-array":Tt,geojson:class extends o.E{constructor(h,n,a,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(d),this._data=n.data,this._options=o.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const m=o.V/this.tileSize;this.workerOptions=o.e({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*m,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*m,extent:o.V,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.V,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*m,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},n),this}getClusterChildren(h,n){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},n),this}getClusterLeaves(h,n,a,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:n,offset:a},d),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.b("dataloading",{dataType:"source"})),this._loaded=!1;const h=o.e({},this.workerOptions);h.scope=this.scope;const n=this._data;typeof n=="string"?(h.request=this.map._requestManager.transformRequest(o.f.resolveURL(n),o.R.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(a,d)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new o.a(a));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(m.resourceTiming=d.resourceTiming[this.id]),this.fire(new o.b("data",m)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,n){const a=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const d={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:o.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};h.request=this.actor.send(a,d,(m,g)=>(delete h.request,h.destroy(),h.aborted?n(null):m?n(m):(h.loadVectorData(g,this.map.painter,a==="reloadTile"),n(null))),void 0,a==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.ap{constructor(h,n,a,d){super(h,n,a,d),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const n of h.urls)this.urls.push(this.map._requestManager.transformRequest(n,o.R.Source).url);o.aq(this.urls,(n,a)=>{this._loaded=!0,n?this.fire(new o.a(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const n=this.video.seekable;h<n.start(0)||h>n.end(0)?this.fire(new o.a(new $e(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,n=h.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(h,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.ap,model:class extends o.E{constructor(h,n,a,d){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const h=[];for(const n in this._options.models){const a=this._options.models[n],d=o.l(this.map._requestManager.transformRequest(a.uri,o.R.Model).url).then(m=>{if(!m)return;const g=o.c(m),b=new o.M(n,a.position,a.orientation,g);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(m=>{this.fire(new o.a(new Error(`Could not load model ${n} from ${a.uri}: ${m.message}`)))});h.push(d)}return Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this.fire(new o.a(new Error(`Could not load models: ${n.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,n){}serialize(){return{type:"model"}}},"batched-model":class extends o.E{constructor(h,n,a,d){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(h){this.map=h,this.load()}load(h){this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map._worldview;this._tileJSONRequest=Mt(this._options,this.map._requestManager,n,a,(d,m)=>{this._tileJSONRequest=null,this._loaded=!0,d?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new o.a(d))):m&&(o.e(this,m),m.bounds&&(this.tileBounds=new bt(m.bounds,this.minzoom,this.maxzoom)),o.aj(m.tiles,this.map._requestManager._customAccessToken),this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))),h&&h(d)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,n){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(a,o.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=n;else{if(h.buckets){const g=Object.values(h.buckets);for(const b of g)b.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",d,m.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",d,m.bind(this),void 0,!0);function m(g,b){return h.aborted?n(null):g&&g.status!==404?n(g):(b&&(b.resourceTiming&&(h.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&h.setExpiryData(b),h.buckets={...h.buckets,...b.buckets},b.featureIndex&&(h.latestFeatureIndex=b.featureIndex)),h.state="loaded",void n(null))}}serialize(){return o.e({},this._options)}},canvas:class extends o.ap{constructor(h,n,a,d){super(h,n,a,d),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(g=>typeof g!="number"))||this.fire(new o.a(new $e(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.a(new $e(`sources.${h}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.a(new $e(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new o.a(new $e(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.a(new $e(`sources.${h}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof o.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends o.E{constructor(h,n,a,d){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new bt(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),o.e(this,o.ac(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:n,y:a,z:d}=h.canonical;return this._implementation.hasTile({x:n,y:a,z:d})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,n){const{x:a,y:d,z:m}=h.tileID.canonical,g=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:a,y:d,z:m},{signal:g.signal})).then((function(b){return delete h.request,h.aborted?(h.state="unloaded",n(null)):b===void 0?(h.state="errored",n(null)):b===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",n(null)):function(S){return S instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement}(b)?(this.loadTileData(h,b),h.state="loaded",void n(null)):(h.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(b=>{b.code!==20&&(h.state="errored",n(b))}),h.request.cancel=()=>g.abort()}loadTileData(h,n){h.setTexture(n,this._map.painter)}unloadTile(h,n){if(h.texture&&h.texture instanceof o.T?(h.destroy(!0),h.texture&&h.texture instanceof o.T&&this._map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:a,y:d,z:m}=h.tileID.canonical;this._implementation.unloadTile({x:a,y:d,z:m})}n()}abortTile(h,n){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){const h=o.ag(this.id,this.scope);this._map.style.clearSource(h)}_update(){this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))}}},gi=function(h,n,a,d){const m=new _o[n.type](h,n,a,d);if(m.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${m.id}`);return o.aY(["load","abort","unload","serialize","prepare"],m),m};function Td(h,n){const a=o.a6.identity([]);return o.a6.scale(a,a,[.5*h.width,.5*-h.height,1]),o.a6.translate(a,a,[1,-1,0]),o.a6.multiply(a,a,h.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(a)}function Sd(h,n,a,d,m,g,b,S=!1){const A=h.tilesIn(d,b,S);A.sort(hl);const P=[];for(const k of A)P.push({wrappedTileID:k.tile.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(n,a,h._state,k,m,g,Td(h.transform,k.tile.tileID),S)});const D=function(k){const F={},N={};for(const q of k){const G=q.queryResults,W=q.wrappedTileID,U=N[W]=N[W]||{};for(const X in G){const re=G[X],J=U[X]=U[X]||{},ne=F[X]=F[X]||[];for(const Y of re)J[Y.featureIndex]||(J[Y.featureIndex]=!0,ne.push(Y))}}return F}(P);for(const k in D)D[k].forEach(F=>{const N=F.feature,q=N.layer;q&&q.type!=="background"&&q.type!=="sky"&&q.type!=="slot"&&(N.source=q.source,q["source-layer"]&&(N.sourceLayer=q["source-layer"]),N.state=N.id!==void 0?h.getFeatureState(q["source-layer"],N.id):{})});return D}function go(h,n){const a=h.getRenderableIds().map(g=>h.getTileByID(g)),d=[],m={};for(let g=0;g<a.length;g++){const b=a[g],S=b.tileID.canonical.key;m[S]||(m[S]=!0,b.querySourceFeatures(d,n))}return d}function hl(h,n){const a=h.tileID,d=n.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}class Ma extends Vo{constructor(n,a,d,m,g){super(n,a,d,m,g),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,a){const d=a.context,m=d.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture&&this.texture instanceof o.T?this.texture.update(n,{useMipmap:!1,premultiply:!1}):this.texture=new o.T(d,n,m.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,a){const d=this._mrt=new o.aZ(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=o.a_(m,(g,b,S,A)=>{if(g)a(g);else try{const P=d.getHeaderLength(b);if(P>n)return void(this.request=this.fetchHeader(P,a));d.parseHeader(b),this._isHeaderLoaded=!0;let D=0;for(const k of Object.values(d.layers))D=Math.max(D,k.dataIndex[k.dataIndex.length-1].last_byte);b.byteLength>=D&&(this.entireBuffer=b),a(null,this.entireBuffer||b,S,A)}catch(P){a(P)}}),this.request}fetchBand(n,a,d){const m=this._mrt;if(!this._isHeaderLoaded||!m)return void d(new Error("Tile header is not ready"));const g=this.actor;if(!g)return void d(new Error("Can't fetch tile band without an actor"));let b;const S=(k,F)=>{b.complete(k,F),k?d(k):(this.updateTextureDescriptor(n,a),d(null,this.textureDescriptor&&this.textureDescriptor.img))},A=(k,F)=>{if(k)return d(k);const N=g.send("decodeRasterArray",{buffer:F,task:b},S,void 0,!0);this._workQueue.push(()=>{N&&N.cancel(),b.cancel()})},P=m.getLayer(n);if(!P)return void d(new Error(`Unknown sourceLayer "${n}"`));if(P.hasDataForBand(a))return this.updateTextureDescriptor(n,a),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);const D=P.getDataRange([a]);if(b=m.createDecodingTask(D),!b||b.tasks.length)if(this.flushQueues(),this.entireBuffer)A(null,this.entireBuffer.slice(D.firstByte,D.lastByte+1));else{const k=Object.assign({},this.requestParams,{headers:{Range:`bytes=${D.firstByte}-${D.lastByte}`}}),F=o.a_(k,A);this._fetchQueue.push(()=>{F.cancel(),b.cancel()})}else d(null)}updateNeeded(n,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,a){if(!this._mrt)return;const d=this._mrt.getLayer(n);if(!d||!d.hasBand(a)||!d.hasDataForBand(a))return;const{bytes:m,tileSize:g,buffer:b,offset:S,scale:A}=d.getBandView(a),P=g+2*b,D={data:m,width:P,height:P},k=this.texture;k&&k instanceof o.T&&k.update(D,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:n,band:a,img:D,buffer:b,offset:S,tileSize:g,format:d.pixelFormat,mix:[A,256*A,65536*A,16777216*A]}}}class dl{constructor(n,a){this.max=n,this.onRemove=a,this.reset()}reset(){for(const n in this.data)for(const a of this.data[n])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(n,a,d){const m=n.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const g={value:a,timeout:void 0};if(d!==void 0&&(g.timeout=setTimeout(()=>{this.remove(n,g)},d)),this.data[m].push(g),this.order.push(m),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const a=this.data[n].shift();return a.timeout&&clearTimeout(a.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),a.value}getByKey(n){const a=this.data[n];return a?a[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,a){if(!this.has(n))return this;const d=n.wrapped().key,m=a===void 0?0:this.data[d].indexOf(a),g=this.data[d][m];return this.data[d].splice(m,1),g.timeout&&clearTimeout(g.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(g.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(n){const a=[];for(const d in this.data)for(const m of this.data[d])n(m.value)||a.push(m);for(const d of a)this.remove(d.value.tileID,d)}}class Fs extends o.E{constructor(n,a,d){super(),this.id=n,this._onlySymbols=d,a.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new dl(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ve,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const a=this._tiles[n];if(a.state!=="errored"&&(a.state!=="loaded"||!a.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,a){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,a)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,()=>{})}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const d=this._tiles[a];d.upload(n),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return o.a$(this._tiles).map(n=>n.tileID).sort(Bu).map(n=>n.key)}getRenderableIds(n,a){const d=[];for(const m in this._tiles)this._isIdRenderable(+m,n,a)&&d.push(this._tiles[m]);return n?d.sort((m,g)=>{const b=m.tileID,S=g.tileID,A=new o.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),P=new o.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-S.overscaledZ||P.y-A.y||P.x-A.x}).map(m=>m.tileID.key):d.map(m=>m.tileID).sort(Bu).map(m=>m.key)}hasRenderableParent(n){const a=this.findLoadedParent(n,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(n,a,d){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(a||!this._tiles[n].holdingForFade())&&(d||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,a){const d=this._tiles[n];d&&(d.state!=="loading"&&(d.state=a),this._loadTile(d,this._tileLoaded.bind(this,d,n,a)))}_tileLoaded(n,a,d,m){if(m)if(n.state="errored",m.status!==404)this._source.fire(new o.a(m,{tile:n}));else{if(!(n.tileID.key in this._loadedParentTiles))return void this._source.fire(new o.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=o.f.now(),d==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(a,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new o.b("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const a=this.getRenderableIds();for(let m=0;m<a.length;m++){const g=a[m];if(n.neighboringTiles&&n.neighboringTiles[g]){const b=this.getTileByID(g);d(n,b),d(b,n)}}function d(m,g){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let b=g.tileID.canonical.x-m.tileID.canonical.x;const S=g.tileID.canonical.y-m.tileID.canonical.y,A=Math.pow(2,m.tileID.canonical.z),P=g.tileID.key;b===0&&S===0||Math.abs(S)>1||(Math.abs(b)>1&&(Math.abs(b+A)===1?b+=A:Math.abs(b-A)===1&&(b-=A)),g.dem&&m.dem&&(m.dem.backfillBorder(g.dem,b,S),m.neighboringTiles&&m.neighboringTiles[P]&&(m.neighboringTiles[P].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,a,d,m){for(const g in this._tiles){let b=this._tiles[g];if(m[g]||!b.hasData()||b.tileID.overscaledZ<=a||b.tileID.overscaledZ>d)continue;let S=b.tileID;for(;b&&b.tileID.overscaledZ>a+1;){const P=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[P.key],b&&b.hasData()&&(S=P)}let A=S;for(;A.overscaledZ>a;)if(A=A.scaledTo(A.overscaledZ-1),n[A.key]){m[S.key]=S;break}}}findLoadedParent(n,a){if(n.key in this._loadedParentTiles){const d=this._loadedParentTiles[n.key];return d&&d.tileID.overscaledZ>=a?d:null}for(let d=n.overscaledZ-1;d>=a;d--){const m=n.scaledTo(d),g=this._getLoadedTile(m);if(g)return g}}_getLoadedTile(n){const a=this._tiles[n.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,a){a=a||this._source.tileSize;const d=Math.ceil(n.width/a)+1,m=Math.ceil(n.height/a)+1,g=Math.floor(d*m*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(S)}handleWrapJump(n){const a=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,a){const d={};for(const m in this._tiles){const g=this._tiles[m];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+a),d[g.tileID.key]=g}this._tiles=d;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(n,a,d,m){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;let g;if(this.updateCacheSize(n,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)g=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new o.am(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y));else if(this.tileCoverLift!==0){const A=n.clone();A.tileCoverLift=this.tileCoverLift,g=A.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&n.projection.name==="globe"&&(g.push(new o.am(1,0,1,0,0)),g.push(new o.am(1,0,1,1,0)),g.push(new o.am(1,0,1,0,1)),g.push(new o.am(1,0,1,1,1)))}else g=n.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(g=g.filter(A=>this._source.hasTile(A)));else g=[];if(g.length>0&&this.castsShadows&&m&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!yo(this._source.type)){const A=n.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),P=Math.min(A,this._source.maxzoom),D=n.extendTileCoverForShadows(g,m,P);for(const k of D)this._shadowCasterTiles[k.key]=!0,g.push(k)}const b=this._updateRetainedTiles(g);if(yo(this._source.type)&&g.length!==0){const A={},P={},D=Object.keys(b);for(const F of D){const N=b[F],q=this._tiles[F];if(!q||q.fadeEndTime&&q.fadeEndTime<=o.f.now())continue;const G=this.findLoadedParent(N,Math.max(N.overscaledZ-Fs.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),A[G.tileID.key]=G.tileID),P[F]=N}const k=g[g.length-1].overscaledZ;for(const F in this._tiles){const N=this._tiles[F];if(b[F]||!N.hasData())continue;let q=N.tileID;for(;q.overscaledZ>k;){q=q.scaledTo(q.overscaledZ-1);const G=this._tiles[q.key];if(G&&G.hasData()&&P[q.key]){b[F]=N.tileID;break}}}for(const F in A)b[F]||(this._coveredTiles[F]=!0,b[F]=A[F])}for(const A in b)this._tiles[A].clearFadeHold();const S=o.b0(this._tiles,b);for(const A of S){const P=this._tiles[A];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(+A)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const a={};if(n.length===0)return a;const d={},m=n.reduce((P,D)=>Math.min(P,D.overscaledZ),1/0),g=n[0].overscaledZ,b=Math.max(g-Fs.maxOverzooming,this._source.minzoom),S=Math.max(g+Fs.maxUnderzooming,this._source.minzoom),A={};for(const P of n){const D=this._addTile(P);a[P.key]=P,D.hasData()||m<this._source.maxzoom&&(A[P.key]=P)}this._retainLoadedChildren(A,m,S,a);for(const P of n){let D=this._tiles[P.key];if(D.hasData())continue;if(P.canonical.z>=this._source.maxzoom){const F=P.children(this._source.maxzoom)[0],N=this.getTile(F);if(N&&N.hasData()){a[F.key]=F;continue}}else{const F=P.children(this._source.maxzoom);if(a[F[0].key]&&a[F[1].key]&&a[F[2].key]&&a[F[3].key])continue}let k=D.wasRequested();for(let F=P.overscaledZ-1;F>=b;--F){const N=P.scaledTo(F);if(d[N.key]||(d[N.key]=!0,D=this.getTile(N),!D&&k&&(D=this._addTile(N)),D&&(a[N.key]=N,k=D.wasRequested(),D.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const a=[];let d,m=this._tiles[n].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){d=this._loadedParentTiles[m.key];break}a.push(m.key);const g=m.scaledTo(m.overscaledZ-1);if(d=this._getLoadedTile(g),d)break;m=g}for(const g of a)this._loadedParentTiles[g]=d}}_addTile(n){let a=this._tiles[n.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),a;a=this._cache.getAndRemove(n),a&&(this._setTileReloadTimer(n.key,a),a.tileID=n,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,a)));const d=!!a;if(!d){const m=this.map?this.map.painter:null,g=this._source.tileSize*n.overscaleFactor();a=this._source.type==="raster-array"?new Ma(n,g,this.transform.tileZoom,m,this._isRaster):new Vo(n,g,this.transform.tileZoom,m,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,n.key,a.state))}return a?(a.uses++,this._tiles[n.key]=a,d||this._source.fire(new o.b("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(n,a){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const d=a.getExpiryTimeout();d&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},d))}_removeTile(n){const a=this._tiles[n];a&&(a.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,a,d){const m=[],g=this.transform;if(!g)return m;const b=g.projection.name==="globe",S=o.a5(g.center.lng);for(const A in this._tiles){const P=this._tiles[A];if(d&&P.clearQueryDebugViz(),P.holdingForFade())continue;let D;if(b){const k=P.tileID.canonical;if(k.z===0){const F=[Math.abs(o.aa(S,...xc(k,-1))-S),Math.abs(o.aa(S,...xc(k,1))-S)];D=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(o.aa(S,...xc(k,-1))-S),Math.abs(o.aa(S,...xc(k,0))-S),Math.abs(o.aa(S,...xc(k,1))-S)];D=[F.indexOf(Math.min(...F))-1]}}else D=[0];for(const k of D){const F=n.containsTile(P,g,a,k);F&&m.push(F)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,a){const d=this.getRenderableIds(n,a).map(g=>this._tiles[g].tileID),m=this.transform.projection.name==="globe";for(const g of d)g.projMatrix=this.transform.calculateProjMatrix(g.toUnwrapped()),g.expandedProjMatrix=m?this.transform.calculateProjMatrix(g.toUnwrapped(),!1,!0):g.projMatrix;return d}sortCoordinatesByDistance(n){const a=n.slice(),d=this.transform._camera.position,m=this.transform._camera.forward(),g={};for(const b of a){const S=1/(1<<b.canonical.z);g[b.key]=((b.canonical.x+.5)*S+b.wrap-d[0])*m[0]+((b.canonical.y+.5)*S-d[1])*m[1]-d[2]*m[2]}return a.sort((b,S)=>g[b.key]-g[S.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(yo(this._source.type))for(const n in this._tiles){const a=this._tiles[n];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=o.f.now())return!0}return!1}setFeatureState(n,a,d){this._state.updateState(n=n||"_geojsonTileLayer",a,d)}removeFeatureState(n,a,d){this._state.removeFeatureState(n=n||"_geojsonTileLayer",a,d)}getFeatureState(n,a){return this._state.getState(n=n||"_geojsonTileLayer",a)}setDependencies(n,a,d){const m=this._tiles[n];m&&m.setDependencies(a,d)}reloadTilesForDependencies(n,a){for(const d in this._tiles)this._tiles[d].hasDependency(n,a)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(n,a))}_preloadTiles(n,a){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(n,a))};return void this._source.on("data",A)}const d=new Map,m=Array.isArray(n)?n:[n],g=this.map.painter.terrain,b=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const A of m){const P=A.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of P)d.set(D.key,D);this.usedForTerrain&&A.updateElevation(!1)}const S=Array.from(d.values());o.b1(S,(A,P)=>{const D=new Vo(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,k=>{this._source.type==="raster-dem"&&D.dem&&this._backfillDEM(D),P(k,D)})},a)}}function Bu(h,n){const a=Math.abs(2*h.wrap)-+(h.wrap<0),d=Math.abs(2*n.wrap)-+(n.wrap<0);return h.overscaledZ-n.overscaledZ||d-a||n.canonical.y-h.canonical.y||n.canonical.x-h.canonical.x}function yo(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function xc(h,n){const a=1<<h.z;return[h.x/a+n,(h.x+1)/a+n]}Fs.maxOverzooming=10,Fs.maxUnderzooming=3;class mm{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,a=!1;for(const d in this.style._mergedLayers){const m=this.style._mergedLayers[d];if(m.type==="fill-extrusion")this.layers.push({layer:m,visible:n,visibilityChanged:a});else if(m.type==="model"){const g=this.style.getLayerSource(m);g&&g.type==="batched-model"&&this.layers.push({layer:m,visible:n,visibilityChanged:a})}}}onNewFrame(n){this.layersGotHidden=!1;for(const a of this.layers){const d=a.layer;let m=!1;d.type==="fill-extrusion"?m=!d.isHidden(n)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="model"&&(m=!d.isHidden(n)&&d.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!m&&a.visible,a.visible=m}}updateZOffset(n,a){this.currentBuildingBuckets=[];for(const m of this.layers){const g=m.layer,b=this.style.getLayerSourceCache(g);let S=1;g.type==="fill-extrusion"&&(S=m.visible?g.paint.get("fill-extrusion-vertical-scale"):0);let A=b?b.getTile(a):null;if(!A&&b&&a.canonical.z>b.getSource().minzoom){let P=a.scaledTo(Math.min(b.getSource().maxzoom,a.overscaledZ-1));for(;P.overscaledZ>=b.getSource().minzoom&&(A=b.getTile(P),!A&&P.overscaledZ!==0);)P=P.scaledTo(P.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:A?A.getBucket(g):null,tileID:A?A.tileID:a,verticalScale:S})}n.hasAnyZOffset=!1;let d=!1;for(let m=0;m<n.symbolInstances.length;m++){const g=n.symbolInstances.get(m),b=g.zOffset,S=this._getHeightAtTileOffset(a,g.tileAnchorX,g.tileAnchorY);g.zOffset=S!==Number.NEGATIVE_INFINITY?S:b,d||b===g.zOffset||(d=!0),n.hasAnyZOffset||g.zOffset===0||(n.hasAnyZOffset=!0)}d&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,a,d,m){let g=a,b=d;if(n.canonical.z!==m.canonical.z){const S=m.canonical,A=1/(1<<n.canonical.z-S.z);g=(a+n.canonical.x*o.V)*A-S.x*o.V|0,b=(d+n.canonical.y*o.V)*A-S.y*o.V|0}return{tileX:g,tileY:b}}_getHeightAtTileOffset(n,a,d){let m,g;for(let b=0;b<this.layers.length;++b){if(this.layers[b].layer.type!=="fill-extrusion")continue;const{bucket:S,tileID:A,verticalScale:P}=this.currentBuildingBuckets[b];if(!S)continue;const{tileX:D,tileY:k}=this._mapCoordToOverlappingTile(n,a,d,A),F=S.getHeightAtTileCoord(D,k);F&&F.height!==void 0&&(F.hidden?m=F.height:g=Math.max(F.height*P,g||0))}if(g!==void 0)return g;for(let b=0;b<this.layers.length;++b){const S=this.layers[b];if(S.layer.type!=="model"||!S.visible)continue;const{bucket:A,tileID:P}=this.currentBuildingBuckets[b];if(!A)continue;const{tileX:D,tileY:k}=this._mapCoordToOverlappingTile(n,a,d,P),F=A.getHeightAtTileCoord(D,k);if(F&&!F.hidden)return F.height===void 0&&m!==void 0?Math.min(F.maxHeight,m)*F.verticalScale:(F.height||0)*F.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Ea(h,n){const a={};for(const d in h)d!=="ref"&&(a[d]=h[d]);return o.b2.forEach(d=>{d in n&&(a[d]=n[d])}),a}function _m(h){h=h.slice();const n=Object.create(null);for(let a=0;a<h.length;a++)n[h[a].id]=h[a];for(let a=0;a<h.length;a++)"ref"in h[a]&&(h[a]=Ea(h[a],n[h[a].ref]));return h}const rn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function bc(h,n,a){a.push({command:rn.addSource,args:[h,n[h]]})}function Md(h,n,a){n.push({command:rn.removeSource,args:[h]}),a[h]=!0}function Oy(h,n,a,d){Md(h,a,d),bc(h,n,a)}function zy(h,n,a){let d;for(d in h[a])if(h[a].hasOwnProperty(d)&&d!=="data"&&!B(h[a][d],n[a][d]))return!1;for(d in n[a])if(n[a].hasOwnProperty(d)&&d!=="data"&&!B(h[a][d],n[a][d]))return!1;return!0}function $o(h,n,a,d,m,g){let b;for(b in n=n||{},h=h||{})h.hasOwnProperty(b)&&(B(h[b],n[b])||a.push({command:g,args:[d,b,n[b],m]}));for(b in n)n.hasOwnProperty(b)&&!h.hasOwnProperty(b)&&(B(h[b],n[b])||a.push({command:g,args:[d,b,n[b],m]}))}function Uo(h){return h.id}function Nu(h,n){return h[n.id]=n,h}class fl{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=o.aa(n,0,1);let a=1,d=this._distances[a];const m=n*this.paddedLength+this.padding;for(;d<m&&a<this._distances.length;)d=this._distances[++a];const g=a-1,b=this._distances[g],S=d-b,A=S>0?(m-b)/S:0;return this.points[g].mult(1-A).add(this.points[a].mult(A))}}class Ed{constructor(n,a,d){const m=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(n/d),this.yCellCount=Math.ceil(a/d);for(let b=0;b<this.xCellCount*this.yCellCount;b++)m.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,d,m,g){this._forEachCell(a,d,m,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(g)}insertCircle(n,a,d,m){this._forEachCell(a-m,d-m,a+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(d),this.circles.push(m)}_insertBoxCell(n,a,d,m,g,b){this.boxCells[g].push(b)}_insertCircleCell(n,a,d,m,g,b){this.circleCells[g].push(b)}_query(n,a,d,m,g,b){if(d<0||n>this.width||m<0||a>this.height)return!g&&[];const S=[];if(n<=0&&a<=0&&this.width<=d&&this.height<=m){if(g)return!0;for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const P=this.circles[3*A],D=this.circles[3*A+1],k=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:P-k,y1:D-k,x2:P+k,y2:D+k})}return b?S.filter(b):S}return this._forEachCell(n,a,d,m,this._queryCell,S,{hitTest:g,seenUids:{box:{},circle:{}}},b),g?S.length>0:S}_queryCircle(n,a,d,m,g){const b=n-d,S=n+d,A=a-d,P=a+d;if(S<0||b>this.width||P<0||A>this.height)return!m&&[];const D=[];return this._forEachCell(b,A,S,P,this._queryCellCircle,D,{hitTest:m,circle:{x:n,y:a,radius:d},seenUids:{box:{},circle:{}}},g),m?D.length>0:D}query(n,a,d,m,g){return this._query(n,a,d,m,!1,g)}hitTest(n,a,d,m,g){return this._query(n,a,d,m,!0,g)}hitTestCircle(n,a,d,m){return this._queryCircle(n,a,d,!0,m)}_queryCell(n,a,d,m,g,b,S,A){const P=S.seenUids,D=this.boxCells[g];if(D!==null){const F=this.bboxes;for(const N of D)if(!P.box[N]){P.box[N]=!0;const q=4*N;if(n<=F[q+2]&&a<=F[q+3]&&d>=F[q+0]&&m>=F[q+1]&&(!A||A(this.boxKeys[N]))){if(S.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[N],x1:F[q],y1:F[q+1],x2:F[q+2],y2:F[q+3]})}}}const k=this.circleCells[g];if(k!==null){const F=this.circles;for(const N of k)if(!P.circle[N]){P.circle[N]=!0;const q=3*N;if(this._circleAndRectCollide(F[q],F[q+1],F[q+2],n,a,d,m)&&(!A||A(this.circleKeys[N]))){if(S.hitTest)return b.push(!0),!0;{const G=F[q],W=F[q+1],U=F[q+2];b.push({key:this.circleKeys[N],x1:G-U,y1:W-U,x2:G+U,y2:W+U})}}}}}_queryCellCircle(n,a,d,m,g,b,S,A){const P=S.circle,D=S.seenUids,k=this.boxCells[g];if(k!==null){const N=this.bboxes;for(const q of k)if(!D.box[q]){D.box[q]=!0;const G=4*q;if(this._circleAndRectCollide(P.x,P.y,P.radius,N[G+0],N[G+1],N[G+2],N[G+3])&&(!A||A(this.boxKeys[q])))return b.push(!0),!0}}const F=this.circleCells[g];if(F!==null){const N=this.circles;for(const q of F)if(!D.circle[q]){D.circle[q]=!0;const G=3*q;if(this._circlesCollide(N[G],N[G+1],N[G+2],P.x,P.y,P.radius)&&(!A||A(this.circleKeys[q])))return b.push(!0),!0}}}_forEachCell(n,a,d,m,g,b,S,A){const P=this._convertToXCellCoord(n),D=this._convertToYCellCoord(a),k=this._convertToXCellCoord(d),F=this._convertToYCellCoord(m);for(let N=P;N<=k;N++)for(let q=D;q<=F;q++)if(g.call(this,n,a,d,m,this.xCellCount*q+N,b,S,A))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,d,m,g,b){const S=m-n,A=g-a,P=d+b;return P*P>S*S+A*A}_circleAndRectCollide(n,a,d,m,g,b,S){const A=(b-m)/2,P=Math.abs(n-(m+A));if(P>A+d)return!1;const D=(S-g)/2,k=Math.abs(a-(g+D));if(k>D+d)return!1;if(P<=A||k<=D)return!0;const F=P-A,N=k-D;return F*F+N*N<=d*d}}const vo={unknown:0,flipRequired:1,flipNotRequired:2},jo=Math.tan(85*Math.PI/180);function wc(h,n,a,d,m,g,b){const S=o.a6.create();if(a)if(g.name==="globe"){const A=o.b3(m,n);o.a6.multiply(S,S,A)}else{const A=o.b4.invert([],b);S[0]=A[0],S[1]=A[1],S[4]=A[2],S[5]=A[3],d||o.a6.rotateZ(S,S,m.angle)}else o.a6.multiply(S,m.labelPlaneMatrix,h);return S}function Ad(h,n,a,d,m,g,b){const S=wc(h,n,a,d,m,g,b);return g.name==="globe"&&a||(S[2]=S[6]=S[10]=S[14]=0),S}function Id(h,n,a,d,m,g,b){if(a){if(g.name==="globe"){const S=wc(h,n,a,d,m,g,b);return o.a6.invert(S,S),o.a6.multiply(S,h,S),S}{const S=o.a6.clone(h),A=o.a6.identity([]);return A[0]=b[0],A[1]=b[1],A[4]=b[2],A[5]=b[3],o.a6.multiply(S,S,A),d||o.a6.rotateZ(S,S,-m.angle),S}}return m.glCoordMatrix}function Es(h,n,a,d){const m=[h,n,a,1];a?o.a7.transformMat4(m,m,d):kd(m,m,d);const g=m[3];return m[0]/=g,m[1]/=g,m[2]/=g,m}function gm(h,n){return Math.min(.5+h/n*.5,1.5)}function Cd(h,n){const a=h[0]/h[3],d=h[1]/h[3];return a>=-n[0]&&a<=n[0]&&d>=-n[1]&&d<=n[1]}function Pd(h,n,a,d,m,g,b,S,A,P){const D=a.transform,k=d?h.textSizeData:h.iconSizeData,F=o.b5(k,a.transform.zoom),N=D.projection.name==="globe",q=[256/a.width*2+1,256/a.height*2+1],G=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;G.clear();let W=null;N&&(W=d?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const U=h.lineVertexArray,X=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,re=a.transform.width/a.transform.height;let J,ne=!1;for(let Y=0;Y<X.length;Y++){const se=X.get(Y),{numGlyphs:ce,writingMode:de}=se;if(de!==o.b6.vertical||ne||J===o.b6.horizontal||(ne=!0),J=de,(se.hidden||de===o.b6.vertical)&&!ne){Go(ce,G);continue}ne=!1;const ge=new o.P(se.tileAnchorX,se.tileAnchorY);let{x:De,y:xe,z:Ne}=D.projection.projectTilePoint(ge.x,ge.y,P.canonical);if(A){const[Dt,Qt,cr]=A(ge);De+=Dt,xe+=Qt,Ne+=cr}const Fe=[De,xe,Ne,1];if(o.a7.transformMat4(Fe,Fe,n),!Cd(Fe,q)){Go(ce,G);continue}const tt=Fe[3],be=gm(a.transform.getCameraToCenterDistance(D.projection),tt),Oe=o.b7(k,F,se),me=b?Oe/be:Oe*be,Ae=Es(De,xe,Ne,m);if(Ae[3]<=0){Go(ce,G);continue}let st={};const xt=b?null:A,_t=Rd(se,me,!1,S,n,m,g,h.glyphOffsetArray,U,G,W,Ae,ge,st,re,xt,D.projection,P,b);ne=_t.useVertical,xt&&_t.needsFlipping&&(st={}),(_t.notEnoughRoom||ne||_t.needsFlipping&&Rd(se,me,!0,S,n,m,g,h.glyphOffsetArray,U,G,W,Ae,ge,st,re,xt,D.projection,P,b).notEnoughRoom)&&Go(ce,G)}d?(h.text.dynamicLayoutVertexBuffer.updateData(G),W&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(W)):(h.icon.dynamicLayoutVertexBuffer.updateData(G),W&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(W))}function Dd(h,n,a,d,m,g,b,S,A,P,D,k,F,N,q,G){const{lineStartIndex:W,glyphStartIndex:U,segment:X}=S,re=U+S.numGlyphs,J=W+S.lineLength,ne=n.getoffsetX(U),Y=n.getoffsetX(re-1),se=Tc(h*ne,a,d,m,g,b,X,W,J,A,P,D,k,F,!0,N,q,G);if(!se)return null;const ce=Tc(h*Y,a,d,m,g,b,X,W,J,A,P,D,k,F,!0,N,q,G);return ce?{first:se,last:ce}:null}function Ld(h,n,a,d){return h===o.b6.horizontal&&Math.abs(d)>Math.abs(a)?{useVertical:!0}:h===o.b6.vertical?d>0?{needsFlipping:!0}:null:n!==vo.unknown&&function(m,g){return m===0||Math.abs(g/m)>jo}(a,d)?n===vo.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Rd(h,n,a,d,m,g,b,S,A,P,D,k,F,N,q,G,W,U,X){const re=n/24,J=h.lineOffsetX*re,ne=h.lineOffsetY*re,{lineStartIndex:Y,glyphStartIndex:se,numGlyphs:ce,segment:de,writingMode:ge,flipState:De}=h,xe=Y+h.lineLength,Ne=Fe=>{if(D){const[me,Ae,st]=Fe.up,xt=P.length;o.b8(D,xt+0,me,Ae,st),o.b8(D,xt+1,me,Ae,st),o.b8(D,xt+2,me,Ae,st),o.b8(D,xt+3,me,Ae,st)}const[tt,be,Oe]=Fe.point;o.b9(P,tt,be,Oe,Fe.angle)};if(ce>1){const Fe=Dd(re,S,J,ne,a,k,F,h,A,g,N,G,!1,W,U,X);if(!Fe)return{notEnoughRoom:!0};if(d&&!a){let[tt,be,Oe]=Fe.first.point,[me,Ae,st]=Fe.last.point;[tt,be]=Es(tt,be,Oe,b),[me,Ae]=Es(me,Ae,st,b);const xt=Ld(ge,De,(me-tt)*q,Ae-be);if(h.flipState=xt&&xt.needsFlipping?vo.flipRequired:vo.flipNotRequired,xt)return xt}Ne(Fe.first);for(let tt=se+1;tt<se+ce-1;tt++){const be=Tc(re*S.getoffsetX(tt),J,ne,a,k,F,de,Y,xe,A,g,N,G,!1,!1,W,U,X);if(!be)return P.length-=4*(tt-se),{notEnoughRoom:!0};Ne(be)}Ne(Fe.last)}else{if(d&&!a){const tt=Es(F.x,F.y,0,m),be=Y+de+1,Oe=new o.P(A.getx(be),A.gety(be)),me=Es(Oe.x,Oe.y,0,m),Ae=me[3]>0?me:Vu(F,Oe,tt,1,m,void 0,W,U.canonical),st=Ld(ge,De,(Ae[0]-tt[0])*q,Ae[1]-tt[1]);if(h.flipState=st&&st.needsFlipping?vo.flipRequired:vo.flipNotRequired,st)return st}const Fe=Tc(re*S.getoffsetX(se),J,ne,a,k,F,de,Y,xe,A,g,N,G,!1,!1,W,U,X);if(!Fe)return{notEnoughRoom:!0};Ne(Fe)}return{}}function pl(h,n,a,d,m){const{x:g,y:b,z:S}=d.projectTilePoint(h.x,h.y,n);if(!m)return Es(g,b,S,a);const[A,P,D]=m(h);return Es(g+A,b+P,S+D,a)}function Vu(h,n,a,d,m,g,b,S){const A=pl(h.sub(n)._unit()._add(h),S,m,b,g);return o.N.sub(A,a,A),o.N.normalize(A,A),o.N.scaleAndAdd(A,a,A,d)}function Tc(h,n,a,d,m,g,b,S,A,P,D,k,F,N,q,G,W,U){const X=d?h-n:h+n;let re=X>0?1:-1,J=0;d&&(re*=-1,J=Math.PI),re<0&&(J+=Math.PI);let ne=S+b+(re>0?0:1)|0,Y=m,se=m,ce=0,de=0;const ge=Math.abs(X),De=[],xe=[];let Ne=g,Fe=Ne;const tt=()=>Vu(Fe,Ne,se,ge-ce+1,D,F,G,W.canonical);for(;ce+de<=ge;){if(ne+=re,ne<S||ne>=A)return null;if(se=Y,Fe=Ne,De.push(se),N&&xe.push(Fe),Ne=new o.P(P.getx(ne),P.gety(ne)),Y=k[ne],!Y){const Qt=pl(Ne,W.canonical,D,G,F);Y=Qt[3]>0?k[ne]=Qt:tt()}ce+=de,de=o.N.distance(se,Y)}q&&F&&(k[ne]&&(Y=tt(),de=o.N.distance(se,Y)),k[ne]=Y);const be=(ge-ce)/de,Oe=Ne.sub(Fe)._mult(be)._add(Fe),me=o.N.sub([],Y,se),Ae=o.N.scaleAndAdd([],se,me,be);let st=[0,0,1],xt=me[0],_t=me[1];if(U&&(st=G.upVector(W.canonical,Oe.x,Oe.y),st[0]!==0||st[1]!==0||st[2]!==1)){const Qt=[st[2],0,-st[0]],cr=o.N.cross([],st,Qt);o.N.normalize(Qt,Qt),o.N.normalize(cr,cr),xt=o.N.dot(me,Qt),_t=o.N.dot(me,cr)}if(a){const Qt=o.N.cross([],st,me);o.N.normalize(Qt,Qt),o.N.scaleAndAdd(Ae,Ae,Qt,a*re)}const Dt=J+Math.atan2(_t,xt);return De.push(Ae),N&&xe.push(Oe),{point:Ae,angle:Dt,path:De,tilePath:xe,up:st}}function Go(h,n){const a=n.length,d=a+4*h;n.resize(d),n.float32.fill(-1/0,4*a,4*d)}function kd(h,n,a){const d=n[0],m=n[1];return h[0]=a[0]*d+a[4]*m+a[12],h[1]=a[1]*d+a[5]*m+a[13],h[3]=a[3]*d+a[7]*m+a[15],h}const As=100;class kt{constructor(n,a,d=new Ed(n.width+200,n.height+200,25),m=new Ed(n.width+200,n.height+200,25)){this.transform=n,this.grid=d,this.ignoredGrid=m,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+As,this.screenBottomBoundary=n.height+As,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,d,m,g,b,S,A){let P=d.projectedAnchorX,D=d.projectedAnchorY,k=d.projectedAnchorZ;const F=d.elevation,N=d.tileID,q=n.getProjection();if(F&&N){const[Y,se,ce]=q.upVector(N.canonical,d.tileAnchorX,d.tileAnchorY),de=q.upVectorScale(N.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=Y*F*de,D+=se*F*de,k+=ce*F*de}const G=this.projectAndGetPerspectiveRatio(S,P,D,k,d.tileID,q.name==="globe"||!!F||this.transform.pitch>0,q),W=b*G.perspectiveRatio,U=(d.x1*a+m.x-d.padding)*W+G.point.x,X=(d.y1*a+m.y-d.padding)*W+G.point.y,re=(d.x2*a+m.x+d.padding)*W+G.point.x,J=(d.y2*a+m.y+d.padding)*W+G.point.y,ne=G.perspectiveRatio<=.55||G.occluded;return!this.isInsideGrid(U,X,re,J)||!g&&this.grid.hitTest(U,X,re,J,A)||ne?{box:[],offscreen:!1,occluded:G.occluded}:{box:[U,X,re,J],offscreen:this.isOffscreen(U,X,re,J),occluded:!1}}placeCollisionCircles(n,a,d,m,g,b,S,A,P,D,k,F,N,q,G){const W=[],U=this.transform.elevation,X=n.getProjection(),re=U?U.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,X):null,J=new o.P(d.tileAnchorX,d.tileAnchorY);let{x:ne,y:Y,z:se}=X.projectTilePoint(J.x,J.y,G.canonical);if(re){const[Oe,me,Ae]=re(J);ne+=Oe,Y+=me,se+=Ae}const ce=X.name==="globe",de=this.projectAndGetPerspectiveRatio(S,ne,Y,se,G,ce||!!U||this.transform.pitch>0,X),{perspectiveRatio:ge}=de,De=(k?b/ge:b*ge)/o.bc,xe=Es(ne,Y,se,A),Ne=de.signedDistanceFromCamera>0?Dd(De,g,d.lineOffsetX*De,d.lineOffsetY*De,!1,xe,J,d,m,A,{},U&&!k?re:null,k&&!!U,X,G,k):null;let Fe=!1,tt=!1,be=!0;if(Ne&&!de.occluded){const Oe=.5*N*ge+q,me=new o.P(-100,-100),Ae=new o.P(this.screenRightBoundary,this.screenBottomBoundary),st=new fl,{first:xt,last:_t}=Ne,Dt=xt.path.length;let Qt=[];for(let ar=Dt-1;ar>=1;ar--)Qt.push(xt.path[ar]);for(let ar=1;ar<_t.path.length;ar++)Qt.push(_t.path[ar]);const cr=2.5*Oe;P&&(Qt=Qt.map(([ar,kr,Mr],Cr)=>(re&&!ce&&(Mr=re(Cr<Dt-1?xt.tilePath[Dt-1-Cr]:_t.tilePath[Cr-Dt+2])[2]),Es(ar,kr,Mr,P))),Qt.some(ar=>ar[3]<=0)&&(Qt=[]));let sr=[];if(Qt.length>0){let ar=1/0,kr=-1/0,Mr=1/0,Cr=-1/0;for(const Ir of Qt)ar=Math.min(ar,Ir[0]),Mr=Math.min(Mr,Ir[1]),kr=Math.max(kr,Ir[0]),Cr=Math.max(Cr,Ir[1]);kr>=me.x&&ar<=Ae.x&&Cr>=me.y&&Mr<=Ae.y&&(sr=[Qt.map(Ir=>new o.P(Ir[0],Ir[1]))],(ar<me.x||kr>Ae.x||Mr<me.y||Cr>Ae.y)&&(sr=o.ba(sr,me.x,me.y,Ae.x,Ae.y)))}for(const ar of sr){st.reset(ar,.25*Oe);let kr=0;kr=st.length<=.5*Oe?1:Math.ceil(st.paddedLength/cr)+1;for(let Mr=0;Mr<kr;Mr++){const Cr=Mr/Math.max(kr-1,1),Ir=st.lerp(Cr),nn=Ir.x+As,Dn=Ir.y+As;W.push(nn,Dn,Oe,0);const qr=nn-Oe,Xn=Dn-Oe,Wr=nn+Oe,cn=Dn+Oe;if(be=be&&this.isOffscreen(qr,Xn,Wr,cn),tt=tt||this.isInsideGrid(qr,Xn,Wr,cn),!a&&this.grid.hitTestCircle(nn,Dn,Oe,F)&&(Fe=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Fe,occluded:!1}}}}return{circles:!D&&Fe||!tt?[]:W,offscreen:be,collisionDetected:Fe,occluded:de.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let d=1/0,m=1/0,g=-1/0,b=-1/0;for(const D of n){const k=new o.P(D.x+As,D.y+As);d=Math.min(d,k.x),m=Math.min(m,k.y),g=Math.max(g,k.x),b=Math.max(b,k.y),a.push(k)}const S=this.grid.query(d,m,g,b).concat(this.ignoredGrid.query(d,m,g,b)),A={},P={};for(const D of S){const k=D.key;if(A[k.bucketInstanceId]===void 0&&(A[k.bucketInstanceId]={}),A[k.bucketInstanceId][k.featureIndex])continue;const F=[new o.P(D.x1,D.y1),new o.P(D.x2,D.y1),new o.P(D.x2,D.y2),new o.P(D.x1,D.y2)];o.bb(a,F)&&(A[k.bucketInstanceId][k.featureIndex]=!0,P[k.bucketInstanceId]===void 0&&(P[k.bucketInstanceId]=[]),P[k.bucketInstanceId].push(k.featureIndex))}return P}insertCollisionBox(n,a,d,m,g){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:m,collisionGroupID:g},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,d,m,g){const b=a?this.ignoredGrid:this.grid,S={bucketInstanceId:d,featureIndex:m,collisionGroupID:g};for(let A=0;A<n.length;A+=4)b.insertCircle(S,n[A],n[A+1],n[A+2])}projectAndGetPerspectiveRatio(n,a,d,m,g,b,S){const A=[a,d,m,1];let P=!1;m||this.transform.pitch>0?(o.a7.transformMat4(A,A,n),this.fogState&&g&&S.name!=="globe"&&(P=function(F,N,q,G,W,U){const X=U.calculateFogTileMatrix(W),re=[N,q,G];return o.N.transformMat4(re,re,X),Rr(F,o.N.length(re),U.pitch,U._fov)}(this.fogState,a,d,m,g.toUnwrapped(),this.transform)>.9)):kd(A,A,n);const D=A[3];return{point:new o.P((A[0]/D+1)/2*this.transform.width+As,(-A[1]/D+1)/2*this.transform.height+As),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/D*.5,1.5),signedDistanceFromCamera:D,occluded:b&&A[2]>D||P}}isOffscreen(n,a,d,m){return d<As||n>=this.screenRightBoundary||m<As||a>this.screenBottomBoundary}isInsideGrid(n,a,d,m){return d>=0&&n<this.gridRightBoundary&&m>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const n=o.a6.identity([]);return o.a6.translate(n,n,[-100,-100,0]),n}}function $u(h,n,a){const d=n.createTileMatrix(h,h.worldSize,a.toUnwrapped());return o.a6.multiply(new Float32Array(16),h.projMatrix,d)}function Od(h,n,a){if(n.projection.name===a.projection.name)return h.projMatrix;const d=a.clone();return d.setProjection(n.projection),$u(d,n.getProjection(),h)}function Sc(h,n,a){return n.name===a.projection.name?h.projMatrix:$u(a,n,h)}class zd{constructor(n,a,d,m){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):m&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Ho{constructor(n,a,d,m,g,b=!1){this.text=new zd(n?n.text:null,a,d,g),this.icon=new zd(n?n.icon:null,a,m,g),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Bs{constructor(n,a,d,m=!1){this.text=n,this.icon=a,this.skipFade=d,this.clipped=m}}class Fd{constructor(){this.invProjMatrix=o.a6.create(),this.viewportMatrix=o.a6.create(),this.circles=[]}}class Aa{constructor(n,a,d,m,g){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=g}}class Uu{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[n]}}function Ia(h,n,a,d,m){const{horizontalAlign:g,verticalAlign:b}=o.bf(h),S=-(g-.5)*n,A=-(b-.5)*a,P=o.bd(h,d);return new o.P(S+P[0]*m,A+P[1]*m)}function Bd(h,n,a,d,m){const g=new o.P(h,n);return a&&g._rotate(d?m:-m),g}class Fy{constructor(n,a,d,m,g,b){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new kt(this.transform,g),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Uu(d),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,d,m){const g=d.getBucket(a),b=d.latestFeatureIndex;if(!g||!b||a.fqid!==g.layerIds[0])return;const S=g.layers[0].layout,A=d.collisionBoxArray,P=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),D=d.tileSize/o.V,k=d.tileID.toUnwrapped();this.transform.setProjection(g.projection);const F=(N=d.tileID,q=g.getProjection(),G=this.transform,q.name===this.projection?G.calculateProjMatrix(N.toUnwrapped()):$u(G,q,N));var N,q,G;const W=S.get("text-pitch-alignment")==="map",U=S.get("text-rotation-alignment")==="map";a.compileFilter();const X=a.dynamicFilter(),re=a.dynamicFilterNeedsFeature(),J=this.transform.calculatePixelsToTileUnitsMatrix(d),ne=Ad(F,d.tileID.canonical,W,U,this.transform,g.getProjection(),J);let Y=null;if(W){const de=Id(F,d.tileID.canonical,W,U,this.transform,g.getProjection(),J);Y=o.a6.multiply([],this.transform.labelPlaneMatrix,de)}let se=null;X&&d.latestFeatureIndex&&(se={unwrappedTileID:k,dynamicFilter:X,dynamicFilterNeedsFeature:re,featureIndex:d.latestFeatureIndex}),this.retainedQueryData[g.bucketInstanceId]=new Aa(g.bucketInstanceId,b,g.sourceLayerIndex,g.index,d.tileID);const ce={bucket:g,layout:S,posMatrix:F,textLabelPlaneMatrix:ne,labelToScreenMatrix:Y,clippingData:se,scale:P,textPixelRatio:D,holdingForFade:d.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:o.b5(g.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.b5(g.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(m)for(const de of g.sortKeyRanges){const{sortKey:ge,symbolInstanceStart:De,symbolInstanceEnd:xe}=de;n.push({sortKey:ge,symbolInstanceStart:De,symbolInstanceEnd:xe,parameters:ce})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:ce})}attemptAnchorPlacement(n,a,d,m,g,b,S,A,P,D,k,F,N,q,G,W,U,X){const{textOffset0:re,textOffset1:J,crossTileID:ne}=F,Y=[re,J],se=Ia(n,d,m,Y,g),ce=this.collisionIndex.placeCollisionBox(q,g,a,Bd(se.x,se.y,b,S,this.transform.angle),k,A,P,D.predicate);if(W){const de=q.getSymbolInstanceIconSize(X,this.transform.zoom,F.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(q,de,W,Bd(se.x,se.y,b,S,this.transform.angle),k,A,P,D.predicate).box.length===0)return}if(ce.box.length>0){let de;return this.prevPlacement&&this.prevPlacement.variableOffsets[ne]&&this.prevPlacement.placements[ne]&&this.prevPlacement.placements[ne].text&&(de=this.prevPlacement.variableOffsets[ne].anchor),this.variableOffsets[ne]={textOffset:Y,width:d,height:m,anchor:n,textScale:g,prevAnchor:de},this.markUsedJustification(q,n,F,G),q.allowVerticalPlacement&&(this.markUsedOrientation(q,G,F),this.placedOrientations[ne]=G),{shift:se,placedGlyphBoxes:ce}}}placeLayerBucketPart(n,a,d,m){const{bucket:g,layout:b,posMatrix:S,textLabelPlaneMatrix:A,labelToScreenMatrix:P,clippingData:D,textPixelRatio:k,holdingForFade:F,collisionBoxArray:N,partiallyEvaluatedTextSize:q,partiallyEvaluatedIconSize:G,collisionGroup:W}=n.parameters,U=b.get("text-optional"),X=b.get("icon-optional"),re=b.get("text-allow-overlap"),J=b.get("icon-allow-overlap"),ne=b.get("text-rotation-alignment")==="map",Y=b.get("text-pitch-alignment")==="map",se=b.get("symbol-z-order")==="viewport-y",ce=b.get("symbol-z-elevate");this.transform.setProjection(g.projection);let de=re&&(J||!g.hasIconData()||X),ge=J&&(re||!g.hasTextData()||U);!g.collisionArrays&&N&&g.deserializeCollisionBoxes(N),d&&m&&g.updateCollisionDebugBuffers(this.transform.zoom,N);const De=(xe,Ne,Fe)=>{const{crossTileID:tt,numVerticalGlyphVertices:be}=xe;if(D){const Wr={zoom:this.transform.zoom,pitch:this.transform.pitch};let cn=null;if(D.dynamicFilterNeedsFeature){const Yr=this.retainedQueryData[g.bucketInstanceId];cn=D.featureIndex.loadFeature({featureIndex:xe.featureIndex,bucketIndex:Yr.bucketIndex,sourceLayerIndex:Yr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,D.dynamicFilter)(Wr,cn,this.retainedQueryData[g.bucketInstanceId].tileID.canonical,new o.P(xe.tileAnchorX,xe.tileAnchorY),this.transform.calculateDistanceTileData(D.unwrappedTileID)))return this.placements[tt]=new Bs(!1,!1,!1,!0),void a.add(tt)}if(a.has(tt))return;if(F)return void(this.placements[tt]=new Bs(!1,!1,!1));let Oe=!1,me=!1,Ae=!0,st=!1,xt=!1,_t=null,Dt={box:null,offscreen:null,occluded:null},Qt={box:null,offscreen:null,occluded:null},cr=null,sr=null,ar=null,kr=0,Mr=0,Cr=0;Fe.textFeatureIndex?kr=Fe.textFeatureIndex:xe.useRuntimeCollisionCircles&&(kr=xe.featureIndex),Fe.verticalTextFeatureIndex&&(Mr=Fe.verticalTextFeatureIndex);const Ir=Wr=>{Wr.tileID=this.retainedQueryData[g.bucketInstanceId].tileID;const cn=this.transform.elevation;Wr.elevation=xe.zOffset+(cn?cn.getAtTileOffset(Wr.tileID,Wr.tileAnchorX,Wr.tileAnchorY):0)},nn=Fe.textBox;if(nn){Ir(nn);const Wr=Yr=>{let ln=o.b6.horizontal;if(g.allowVerticalPlacement&&!Yr&&this.prevPlacement){const kn=this.prevPlacement.placedOrientations[tt];kn&&(this.placedOrientations[tt]=kn,ln=kn,this.markUsedOrientation(g,ln,xe))}return ln},cn=(Yr,ln)=>{if(g.allowVerticalPlacement&&be>0&&Fe.verticalTextBox){for(const kn of g.writingModes)if(kn===o.b6.vertical?(Dt=ln(),Qt=Dt):Dt=Yr(),Dt&&Dt.box&&Dt.box.length)break}else Dt=Yr()};if(b.get("text-variable-anchor")){let Yr=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[tt]){const mn=this.prevPlacement.variableOffsets[tt];Yr.indexOf(mn.anchor)>0&&(Yr=Yr.filter(Ti=>Ti!==mn.anchor),Yr.unshift(mn.anchor))}const ln=(mn,Ti,$i)=>{const as=g.getSymbolInstanceTextSize(q,xe,this.transform.zoom,Ne),eo=(mn.x2-mn.x1)*as+2*mn.padding,ls=(mn.y2-mn.y1)*as+2*mn.padding,Si=xe.hasIconTextFit&&!J?Ti:null;Si&&Ir(Si);let yi={box:[],offscreen:!1,occluded:!1};const Yi=re?2*Yr.length:Yr.length;for(let es=0;es<Yi;++es){const cs=this.attemptAnchorPlacement(Yr[es%Yr.length],mn,eo,ls,as,ne,Y,k,S,W,es>=Yr.length,xe,Ne,g,$i,Si,q,G);if(cs&&(yi=cs.placedGlyphBoxes,yi&&yi.box&&yi.box.length)){Oe=!0,_t=cs.shift;break}}return yi};cn(()=>ln(nn,Fe.iconBox,o.b6.horizontal),()=>{const mn=Fe.verticalTextBox;return mn&&Ir(mn),g.allowVerticalPlacement&&!(Dt&&Dt.box&&Dt.box.length)&&be>0&&mn?ln(mn,Fe.verticalIconBox,o.b6.vertical):{box:null,offscreen:null,occluded:null}}),Dt&&(Oe=Dt.box,Ae=Dt.offscreen,st=Dt.occluded);const kn=Wr(!(!Dt||!Dt.box));if(!Oe&&this.prevPlacement){const mn=this.prevPlacement.variableOffsets[tt];mn&&(this.variableOffsets[tt]=mn,this.markUsedJustification(g,mn.anchor,xe,kn))}}else{const Yr=(ln,kn)=>{const mn=g.getSymbolInstanceTextSize(q,xe,this.transform.zoom,Ne),Ti=this.collisionIndex.placeCollisionBox(g,mn,ln,new o.P(0,0),re,k,S,W.predicate);return Ti&&Ti.box&&Ti.box.length&&(this.markUsedOrientation(g,kn,xe),this.placedOrientations[tt]=kn),Ti};cn(()=>Yr(nn,o.b6.horizontal),()=>{const ln=Fe.verticalTextBox;return g.allowVerticalPlacement&&be>0&&ln?(Ir(ln),Yr(ln,o.b6.vertical)):{box:null,offscreen:null,occluded:null}}),Wr(!!(Dt&&Dt.box&&Dt.box.length))}}if(cr=Dt,Oe=cr&&cr.box&&cr.box.length>0,Ae=cr&&cr.offscreen,st=cr&&cr.occluded,xe.useRuntimeCollisionCircles){const Wr=g.text.placedSymbolArray.get(xe.centerJustifiedTextSymbolIndex>=0?xe.centerJustifiedTextSymbolIndex:xe.verticalPlacedTextSymbolIndex),cn=o.b7(g.textSizeData,q,Wr),Yr=b.get("text-padding");sr=this.collisionIndex.placeCollisionCircles(g,re,Wr,g.lineVertexArray,g.glyphOffsetArray,cn,S,A,P,d,Y,W.predicate,xe.collisionCircleDiameter*cn/o.bc,Yr,this.retainedQueryData[g.bucketInstanceId].tileID),Oe=re||sr.circles.length>0&&!sr.collisionDetected,Ae=Ae&&sr.offscreen,st=sr.occluded}if(Fe.iconFeatureIndex&&(Cr=Fe.iconFeatureIndex),Fe.iconBox){const Wr=cn=>{Ir(cn);const Yr=xe.hasIconTextFit&&_t?Bd(_t.x,_t.y,ne,Y,this.transform.angle):new o.P(0,0),ln=g.getSymbolInstanceIconSize(G,this.transform.zoom,xe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(g,ln,cn,Yr,J,k,S,W.predicate)};Qt&&Qt.box&&Qt.box.length&&Fe.verticalIconBox?(ar=Wr(Fe.verticalIconBox),me=ar.box.length>0):(ar=Wr(Fe.iconBox),me=ar.box.length>0),Ae=Ae&&ar.offscreen,xt=ar.occluded}const Dn=U||xe.numHorizontalGlyphVertices===0&&be===0,qr=X||xe.numIconVertices===0;if(Dn||qr?qr?Dn||(me=me&&Oe):Oe=me&&Oe:me=Oe=me&&Oe,Oe&&cr&&cr.box&&this.collisionIndex.insertCollisionBox(cr.box,b.get("text-ignore-placement"),g.bucketInstanceId,Qt&&Qt.box&&Mr?Mr:kr,W.ID),me&&ar&&this.collisionIndex.insertCollisionBox(ar.box,b.get("icon-ignore-placement"),g.bucketInstanceId,Cr,W.ID),sr&&(Oe&&this.collisionIndex.insertCollisionCircles(sr.circles,b.get("text-ignore-placement"),g.bucketInstanceId,kr,W.ID),d)){const Wr=g.bucketInstanceId;let cn=this.collisionCircleArrays[Wr];cn===void 0&&(cn=this.collisionCircleArrays[Wr]=new Fd);for(let Yr=0;Yr<sr.circles.length;Yr+=4)cn.circles.push(sr.circles[Yr+0]),cn.circles.push(sr.circles[Yr+1]),cn.circles.push(sr.circles[Yr+2]),cn.circles.push(sr.collisionDetected?1:0)}const Xn=g.projection.name!=="globe";de=de&&(Xn||!st),ge=ge&&(Xn||!xt),this.placements[tt]=new Bs(Oe||de,me||ge,Ae||g.justReloaded),a.add(tt)};if(ce&&this.buildingIndex&&(this.buildingIndex.updateZOffset(g,this.retainedQueryData[g.bucketInstanceId].tileID),g.updateZOffset()),se){const xe=g.getSortedSymbolIndexes(this.transform.angle);for(let Ne=xe.length-1;Ne>=0;--Ne){const Fe=xe[Ne];De(g.symbolInstances.get(Fe),Fe,g.collisionArrays[Fe])}g.hasAnyZOffset&&o.w(`${g.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(g.hasAnyZOffset){const xe=g.getSortedIndexesByZOffset();for(let Ne=0;Ne<xe.length;++Ne){const Fe=xe[Ne];De(g.symbolInstances.get(Fe),Fe,g.collisionArrays[Fe])}}else for(let xe=n.symbolInstanceStart;xe<n.symbolInstanceEnd;xe++)De(g.symbolInstances.get(xe),xe,g.collisionArrays[xe]);if(d&&g.bucketInstanceId in this.collisionCircleArrays){const xe=this.collisionCircleArrays[g.bucketInstanceId];o.a6.invert(xe.invProjMatrix,S),xe.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(n,a,d,m){const{leftJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:A,crossTileID:P}=d,D=o.be(a),k=m===o.b6.vertical?A:D==="left"?g:D==="center"?b:D==="right"?S:-1;g>=0&&(n.text.placedSymbolArray.get(g).crossTileID=k>=0&&g!==k?0:P),b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=k>=0&&b!==k?0:P),S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=k>=0&&S!==k?0:P),A>=0&&(n.text.placedSymbolArray.get(A).crossTileID=k>=0&&A!==k?0:P)}markUsedOrientation(n,a,d){const m=a===o.b6.horizontal||a===o.b6.horizontalOnly?a:0,g=a===o.b6.vertical?a:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:P}=d,D=n.text.placedSymbolArray;b>=0&&(D.get(b).placedOrientation=m),S>=0&&(D.get(S).placedOrientation=m),A>=0&&(D.get(A).placedOrientation=m),P>=0&&(D.get(P).placedOrientation=g)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const m=a?a.symbolFadeChange(n):1,g=a?a.opacities:{},b=a?a.variableOffsets:{},S=a?a.placedOrientations:{};for(const A in this.placements){const P=this.placements[A],D=g[A];D?(this.opacities[A]=new Ho(D,m,P.text,P.icon,null,P.clipped),d=d||P.text!==D.text.placed||P.icon!==D.icon.placed):(this.opacities[A]=new Ho(null,m,P.text,P.icon,P.skipFade,P.clipped),d=d||P.text||P.icon)}for(const A in g){const P=g[A];if(!this.opacities[A]){const D=new Ho(P,m,!1,!1);D.isHidden()||(this.opacities[A]=D,d=d||P.text.placed||P.icon.placed)}}for(const A in b)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=b[A]);for(const A in S)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=S[A]);d?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a){const d=new Set;for(const m of a){const g=m.getBucket(n);g&&m.latestFeatureIndex&&n.fqid===g.layerIds[0]&&(this.updateBucketOpacities(g,d,m.collisionBoxArray),g.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(g,m.tileID),g.updateZOffset()))}}updateBucketOpacities(n,a,d){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const m=n.layers[0].layout,g=!!n.layers[0].dynamicFilter(),b=new Ho(null,0,!1,!1,!0),S=m.get("text-allow-overlap"),A=m.get("icon-allow-overlap"),P=m.get("text-variable-anchor"),D=m.get("text-rotation-alignment")==="map",k=m.get("text-pitch-alignment")==="map",F=new Ho(null,0,S&&(A||!n.hasIconData()||m.get("icon-optional")),A&&(S||!n.hasTextData()||m.get("text-optional")),!0);!n.collisionArrays&&d&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(d);const N=(G,W,U)=>{for(let X=0;X<W/4;X++)G.opacityVertexArray.emplaceBack(U)};let q=0;for(let G=0;G<n.symbolInstances.length;G++){const W=n.symbolInstances.get(G),{numHorizontalGlyphVertices:U,numVerticalGlyphVertices:X,crossTileID:re,numIconVertices:J}=W,ne=a.has(re);let Y=this.opacities[re];ne?Y=b:Y||(Y=F,this.opacities[re]=Y),a.add(re);const se=U>0||X>0,ce=J>0,de=this.placedOrientations[re],ge=de===o.b6.vertical,De=de===o.b6.horizontal||de===o.b6.horizontalOnly;if(!se&&!ce||Y.isHidden()||q++,se){const xe=xm(Y.text);N(n.text,U,ge?Mc:xe),N(n.text,X,De?Mc:xe);const Ne=Y.text.isHidden(),{leftJustifiedTextSymbolIndex:Fe,centerJustifiedTextSymbolIndex:tt,rightJustifiedTextSymbolIndex:be,verticalPlacedTextSymbolIndex:Oe}=W,me=n.text.placedSymbolArray,Ae=Ne||ge?1:0;Fe>=0&&(me.get(Fe).hidden=Ae),tt>=0&&(me.get(tt).hidden=Ae),be>=0&&(me.get(be).hidden=Ae),Oe>=0&&(me.get(Oe).hidden=Ne||De?1:0);const st=this.variableOffsets[re];st&&this.markUsedJustification(n,st.anchor,W,de);const xt=this.placedOrientations[re];xt&&(this.markUsedJustification(n,"left",W,xt),this.markUsedOrientation(n,xt,W))}if(ce){const xe=xm(Y.icon),{placedIconSymbolIndex:Ne,verticalPlacedIconSymbolIndex:Fe}=W,tt=n.icon.placedSymbolArray,be=Y.icon.isHidden()?1:0;Ne>=0&&(N(n.icon,J,ge?Mc:xe),tt.get(Ne).hidden=be),Fe>=0&&(N(n.icon,W.numVerticalIconVertices,De?Mc:xe),tt.get(Fe).hidden=be)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const xe=n.collisionArrays[G];if(xe){let Ne=new o.P(0,0),Fe=!0;if(xe.textBox||xe.verticalTextBox){if(P){const be=this.variableOffsets[re];be?(Ne=Ia(be.anchor,be.width,be.height,be.textOffset,be.textScale),D&&Ne._rotate(k?this.transform.angle:-this.transform.angle)):Fe=!1}g&&(Fe=!Y.clipped),xe.textBox&&ml(n.textCollisionBox.collisionVertexArray,Y.text.placed,!Fe||ge,Ne.x,Ne.y),xe.verticalTextBox&&ml(n.textCollisionBox.collisionVertexArray,Y.text.placed,!Fe||De,Ne.x,Ne.y)}const tt=Fe&&!!(!De&&xe.verticalIconBox);xe.iconBox&&ml(n.iconCollisionBox.collisionVertexArray,Y.icon.placed,tt,W.hasIconTextFit?Ne.x:0,W.hasIconTextFit?Ne.y:0),xe.verticalIconBox&&ml(n.iconCollisionBox.collisionVertexArray,Y.icon.placed,!tt,W.hasIconTextFit?Ne.x:0,W.hasIconTextFit?Ne.y:0)}}}if(n.fullyClipped=q===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const G=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=G.invProjMatrix,n.placementViewportMatrix=G.viewportMatrix,n.collisionCircleArray=G.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){const d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>n}setStale(){this.stale=!0}}function ml(h,n,a,d,m){h.emplaceBack(n?1:0,a?1:0,d||0,m||0),h.emplaceBack(n?1:0,a?1:0,d||0,m||0),h.emplaceBack(n?1:0,a?1:0,d||0,m||0),h.emplaceBack(n?1:0,a?1:0,d||0,m||0)}const By=Math.pow(2,25),ym=Math.pow(2,24),vm=Math.pow(2,17),Nd=Math.pow(2,16),Ny=Math.pow(2,9),Vy=Math.pow(2,8),$y=Math.pow(2,1);function xm(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const n=h.placed?1:0,a=Math.floor(127*h.opacity);return a*By+n*ym+a*vm+n*Nd+a*Ny+n*Vy+a*$y+n}const Mc=0;class Uy{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,a,d,m,g){const b=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(b,m,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((S,A)=>S.sortKey-A.sortKey));this._currentPartIndex<b.length;){const S=b[this._currentPartIndex];if(a.placeLayerBucketPart(S,this._seenCrossTileIDs,d,S.symbolInstanceStart===0),this._currentPartIndex++,g())return!0}return!1}}class ju{constructor(n,a,d,m,g,b,S,A,P){this.placement=new Fy(n,g,b,S,A,P),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(n,a,d,m){const g=o.f.now(),b=()=>{const S=o.f.now()-g;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=a[n[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=A)&&(!S.maxzoom||S.maxzoom>A)){const P=S,D=P.layout.get("symbol-z-elevate"),k=this._inProgressLayer=this._inProgressLayer||new Uy(P),F=o.ag(S.source,S.scope);if(k.continuePlacement(D?m[F]:d[F],this.placement,this._showCollisionBoxes,S,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Vd=512/o.V/2;class bm{constructor(n,a,d){this.tileID=n,this.bucketInstanceId=d,this.index=new o.bg(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const m=n.canonical.x*o.V,g=n.canonical.y*o.V;for(let b=0;b<a.length;b++){const{key:S,crossTileID:A,tileAnchorX:P,tileAnchorY:D}=a.get(b),k=Math.floor((m+P)*Vd),F=Math.floor((g+D)*Vd);this.index.add(k,F),this.keys.push(S),this.crossTileIDs.push(A)}this.index.finish()}findMatches(n,a,d){const m=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),g=Vd/Math.pow(2,a.canonical.z-this.tileID.canonical.z),b=a.canonical.x*o.V,S=a.canonical.y*o.V;for(let A=0;A<n.length;A++){const P=n.get(A);if(P.crossTileID)continue;const{key:D,tileAnchorX:k,tileAnchorY:F}=P,N=Math.floor((b+k)*g),q=Math.floor((S+F)*g),G=this.index.range(N-m,q-m,N+m,q+m);for(const W of G){const U=this.crossTileIDs[W];if(this.keys[W]===D&&!d.has(U)){d.add(U),P.crossTileID=U;break}}}}}class $d{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const a=Math.round((n-this.lng)/360);if(a!==0)for(const d in this.indexes){const m=this.indexes[d],g={};for(const b in m){const S=m[b];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+a),g[S.tileID.key]=S}this.indexes[d]=g}this.lng=n}addBucket(n,a,d){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let g=0;g<a.symbolInstances.length;g++)a.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const m=this.usedCrossTileIDs[n.overscaledZ];for(const g in this.indexes){const b=this.indexes[g];if(Number(g)>n.overscaledZ)for(const S in b){const A=b[S];A.tileID.isChildOf(n)&&A.findMatches(a.symbolInstances,n,m)}else{const S=b[n.scaledTo(Number(g)).key];S&&S.findMatches(a.symbolInstances,n,m)}}for(let g=0;g<a.symbolInstances.length;g++){const b=a.symbolInstances.get(g);b.crossTileID||(b.crossTileID=d.generate(),m.add(b.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new bm(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(const d of a.crossTileIDs)this.usedCrossTileIDs[n].delete(d)}removeStaleBuckets(n){let a=!1;for(const d in this.indexes){const m=this.indexes[d];for(const g in m)n[m[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[g]),delete m[g],a=!0)}return a}}class Ud{constructor(){this.layerIndexes={},this.crossTileIDs=new $d,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,d,m){let g=this.layerIndexes[n.fqid];g===void 0&&(g=this.layerIndexes[n.fqid]=new Gu);let b=!1;const S={};m.name!=="globe"&&g.handleWrapJump(d);for(const A of a){const P=A.getBucket(n);P&&n.fqid===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(A.tileID,P,this.crossTileIDs)&&(b=!0),S[P.bucketInstanceId]=!0)}return g.removeStaleBuckets(S)&&(b=!0),b}pruneUnusedLayers(n){const a={};n.forEach(d=>{a[d]=!0});for(const d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}class Ca{constructor(n=0,a=0,d=0,m=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=d,this.right=m}interpolate(n,a,d){return a.top!=null&&n.top!=null&&(this.top=o.U(n.top,a.top,d)),a.bottom!=null&&n.bottom!=null&&(this.bottom=o.U(n.bottom,a.bottom,d)),a.left!=null&&n.left!=null&&(this.left=o.U(n.left,a.left,d)),a.right!=null&&n.right!=null&&(this.right=o.U(n.right,a.right,d)),this}getCenter(n,a){const d=o.aa((this.left+n-this.right)/2,0,n),m=o.aa((this.top+a-this.bottom)/2,0,a);return new o.P(d,m)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Hu(h,n){const a=o.bk(h,3);o.a6.fromQuat(h,n),o.bm(h,3,a)}function Ec(h,n){const a=o.bi.identity([]);return o.bi.rotateZ(a,a,-n),o.bi.rotateX(a,a,-h),a}function jd(h,n){const a=[h[0],h[1],0],d=[n[0],n[1],0];if(o.N.length(a)>=1e-15){const b=o.N.normalize([],a);o.N.scale(d,b,o.N.dot(d,b)),n[0]=d[0],n[1]=d[1]}const m=o.N.cross([],n,h);if(o.N.len(m)<1e-15)return null;const g=Math.atan2(-m[1],m[0]);return Ec(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),g)}class Ac{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){const a=n instanceof o.L?n:new o.L(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=o.bh(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a){if(this.orientation=null,!this.position)return;const d=this.position,m=this._elevation?this._elevation.getAtPointOrZero(o.L.fromLngLat(n)):0,g=o.L.fromLngLat(n,m),b=[g.x-d.x,g.y-d.y,g.z-d.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=jd(b,a)}setPitchBearing(n,a){this.orientation=Ec(o.bj(n),o.bj(-a))}}class _l{constructor(n,a){this._transform=o.a6.identity([]),this.orientation=a,this.position=n}get mercatorPosition(){const n=this.position;return new o.L(n[0],n[1],n[2])}get position(){const n=o.bk(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&o.bm(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||o.bi.identity([]),n&&Hu(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=Ec(n,a),Hu(this._transform,this._orientation)}forward(){const n=o.bk(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=o.bk(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=o.bk(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){const d=new Float64Array(16);return o.a6.invert(d,this.getWorldToCamera(n,a)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,a,d){const m=this.position;o.N.scale(m,m,-n);const g=new Float64Array(16);return o.a6.fromScaling(g,[d,d,d]),o.a6.translate(g,g,m),g[10]*=a,g}getWorldToCamera(n,a){const d=new Float64Array(16),m=new Float64Array(4),g=this.position;return o.bi.conjugate(m,this._orientation),o.N.scale(g,g,-n),o.a6.fromQuat(d,m),o.a6.translate(d,d,g),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=a,d[9]*=a,d[10]*=a,d[11]*=a,d}getCameraToClipPerspective(n,a,d,m){const g=new Float64Array(16);return o.a6.perspective(g,n,a,d,m),g}getCameraToClipOrthographic(n,a,d,m,g,b){const S=new Float64Array(16);return o.a6.ortho(S,n,a,d,m,g,b),S}getDistanceToElevation(n,a=!1){const d=n===0?0:o.bl(n,a?o.au(this.position[1]):this.position[1]),m=this.forward();return(d-this.position[2])/m[2]}clone(){return new _l([...this.position],[...this.orientation])}}const gl=(h,n,a)=>(1-a)*h+a*n,Ic=h=>h*h*h*h*h;class Cc{constructor(n,a,d,m,g,b,S){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=d??0,this._maxPitch=m??60,this.setProjection(b),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new o.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ca,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new _l,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const n=new Cc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,a=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(n||d)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return o.ac(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=o.bo(this.projectionOptions);const d=!B(a,this.getProjection());return d&&this._calcMatrices(),this.mercatorFromTransition=!1,d}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.bo({name:"mercator"});const a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bh(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const a=-n*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=o.b4.create(),o.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const a=o.aa(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=o.bj(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let m=0,g=0;for(let b=0;b<a.length;b++){const S=new o.P(a[b][0]*this.width,d+a[b][1]*(this.height-d)),A=n.pointCoordinate(S);if(!A)continue;const P=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);m+=A[3]*P,g+=P}return g===0?NaN:m/g}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*a,m=this._mercatorZfromZoom(n),g=this._mercatorZfromZoom(this._maxZoom),b=Math.max(m-d,g);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let d;d=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];const m=o.N.length(o.N.sub([],this._camera.position,d));return o.aa(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!o.bi.exactEquals(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){const d=[n.position.x,n.position.y,n.position.z];o.N.exactEquals(d,this._camera.position)||(this._setCameraPosition(d),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,a=new Ac;return a.position=new o.L(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!o.bi.length(n))return!1;o.bi.normalize(n,n);const a=o.N.transformQuat([],[0,0,-1],n),d=o.N.transformQuat([],[0,-1,0],n);if(d[2]<0)return!1;const m=jd(a,d);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(n){const a=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;n[2]=o.aa(n[2],m/d,m/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,d){this._unmodified=!1,this._edgeInsets.interpolate(n,a,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){const a=[new o.bp(0,n)];if(this.renderWorldCopies){const d=this.pointCoordinate(new o.P(0,0)),m=this.pointCoordinate(new o.P(this.width,0)),g=this.pointCoordinate(new o.P(this.width,this.height)),b=this.pointCoordinate(new o.P(0,this.height)),S=Math.floor(Math.min(d.x,m.x,g.x,b.x)),A=Math.floor(Math.max(d.x,m.x,g.x,b.x)),P=1;for(let D=S-P;D<=A+P;D++)D!==0&&a.push(new o.bp(D,n))}return a}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(n,a,d){let m=[];if(a[0]===0&&a[1]===0)return m;for(const b of n){const S=b.canonical,A=b.overscaledZ,P=b.wrap,D=1<<S.z,k=S.x+1<D,F=S.x>0,N=S.y+1<D,q=S.y>0,G=b.wrap-(F?0:1),W=b.wrap+(k?0:1),U=F?S.x-1:D-1,X=k?S.x+1:0;a[0]<0?(m.push(new o.am(A,W,S.z,X,S.y)),a[1]<0&&N&&(m.push(new o.am(A,P,S.z,S.x,S.y+1)),m.push(new o.am(A,W,S.z,X,S.y+1))),a[1]>0&&q&&(m.push(new o.am(A,P,S.z,S.x,S.y-1)),m.push(new o.am(A,W,S.z,X,S.y-1)))):a[0]>0?(m.push(new o.am(A,G,S.z,U,S.y)),a[1]<0&&N&&(m.push(new o.am(A,P,S.z,S.x,S.y+1)),m.push(new o.am(A,G,S.z,U,S.y+1))),a[1]>0&&q&&(m.push(new o.am(A,P,S.z,S.x,S.y-1)),m.push(new o.am(A,G,S.z,U,S.y-1)))):a[1]<0&&N?m.push(new o.am(A,P,S.z,S.x,S.y+1)):q&&m.push(new o.am(A,P,S.z,S.x,S.y-1))}if(m.length>1){m.sort((A,P)=>A.overscaledZ-P.overscaledZ||A.wrap-P.wrap||A.canonical.z-P.canonical.z||A.canonical.x-P.canonical.x||A.canonical.y-P.canonical.y);let b=0,S=0;for(;S<m.length;)m[S].equals(m[b])?++S:m[++b]=m[S++];m.length=b+1}const g=[];for(const b of m)m.some(S=>b.isChildOf(S))||g.push(b);return m=g.filter(b=>!n.some(S=>!!(b.overscaledZ<d&&S.isChildOf(b))||b.equals(S)||b.isChildOf(S))),m}coveringTiles(n){let a=this.coveringZoomLevel(n);const d=a,m=this.elevation&&this.elevation.exaggeration(),g=m&&!n.isTerrainDEM,b=this.projection.name==="mercator";if(n.minzoom!==void 0&&a<n.minzoom)return[];n.maxzoom!==void 0&&a>n.maxzoom&&(a=n.maxzoom);const S=this.locationCoordinate(this.center),A=this.center.lat,P=1<<a,D=[P*S.x,P*S.y,0],k=this.projection.name==="globe",F=!k,N=o.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,F),q=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=P*o.bl(1,this.center.lat),W=this._camera.position[2]/o.bl(1,this.center.lat),U=[P*q.x,P*q.y,W*(F?1:G)],X=k||m,re=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),J=this.isLODDisabled(!0)?a:0;let ne;if(this._elevation&&n.isTerrainDEM)ne=1e4*this._elevation.exaggeration();else if(this._elevation){const me=this._elevation.getMinMaxForVisibleTiles();ne=me?me.max:this._centerAltitude}else ne=this._centerAltitude;const Y=n.isTerrainDEM?-ne:this._elevation?this._elevation.getMinElevationBelowMSL():0,se=this.projection.isReprojectedInTileSpace?o.br(this):1,ce=me=>{const st=new o.L(me.x+25e-6,me.y,me.z),xt=new o.L(me.x,me.y+25e-6,me.z),_t=me.toLngLat(),Dt=st.toLngLat(),Qt=xt.toLngLat(),cr=this.locationCoordinate(_t),sr=this.locationCoordinate(Dt),ar=this.locationCoordinate(Qt),kr=Math.hypot(sr.x-cr.x,sr.y-cr.y),Mr=Math.hypot(ar.x-cr.x,ar.y-cr.y);return Math.sqrt(kr*Mr)*se/25e-6},de=me=>{const Ae=ne,st=Y;return{aabb:o.bu(this,P,0,0,0,me,st,Ae,this.projection),zoom:0,x:0,y:0,minZ:st,maxZ:Ae,wrap:me,fullyVisible:!1}},ge=[];let De=[];const xe=a,Ne=n.reparseOverscaled?d:a,Fe=me=>me*me,tt=Fe((W-this._centerAltitude)*G),be=me=>{if(!this._elevation||!me.tileID||!b)return;const Ae=this._elevation.getMinMaxForTile(me.tileID),st=me.aabb;Ae?(st.min[2]=Ae.min,st.max[2]=Ae.max,st.center[2]=(st.min[2]+st.max[2])/2):(me.shouldSplit=Oe(me),me.shouldSplit||(st.min[2]=st.max[2]=st.center[2]=this._centerAltitude))},Oe=me=>{if(me.zoom<J)return!0;if(me.zoom===xe)return!1;if(me.shouldSplit!=null)return me.shouldSplit;const Ae=me.aabb.distanceX(U),st=me.aabb.distanceY(U);let xt=tt,_t=1;if(k){xt=Fe(me.aabb.distanceZ(U));const cr=Math.pow(2,me.zoom),sr=o.au((me.y+1)/cr),ar=o.au(me.y/cr),kr=Math.min(Math.max(A,sr),ar),Mr=o.bJ(kr)/o.bJ(A);if(_t=kr===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Mr/this._mercatorScaleRatio),this.zoom<=o.bG&&me.zoom===xe-1&&Mr>=.9)return!0}else if(g&&(xt=Fe(me.aabb.distanceZ(U)*G)),this.projection.isReprojectedInTileSpace&&d<=5){const cr=Math.pow(2,me.zoom),sr=ce(new o.L((me.x+.5)/cr,(me.y+.5)/cr));_t=sr>.85?1:sr}const Dt=Ae*Ae+st*st+xt,Qt=Fe((1<<xe-me.zoom)*re*_t*((cr,sr)=>{if(sr*Fe(.707)<cr)return 1;const ar=Math.sqrt(sr/cr);return ar/(1.4144271570014144+(Math.pow(1.1,ar-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(xt,tt),Dt));return Dt<Qt};if(this.renderWorldCopies)for(let me=1;me<=3;me++)ge.push(de(-me)),ge.push(de(me));for(ge.push(de(0));ge.length>0;){const me=ge.pop(),Ae=me.x,st=me.y;let xt=me.fullyVisible;const _t=()=>this.projection.name==="globe"&&(me.y===0||me.y===(1<<me.zoom)-1);if(!xt){let Dt=X?me.aabb.intersects(N):me.aabb.intersectsFlat(N);if(Dt===0&&_t()){const Qt=new o.bs(me.zoom,Ae,st);Dt=o.bt(this,P,Qt,!0).intersects(N)}if(Dt===0)continue;xt=Dt===2}if(me.zoom!==xe&&Oe(me))for(let Dt=0;Dt<4;Dt++){const Qt=(Ae<<1)+Dt%2,cr=(st<<1)+(Dt>>1),sr={aabb:b?me.aabb.quadrant(Dt):o.bu(this,P,me.zoom+1,Qt,cr,me.wrap,me.minZ,me.maxZ,this.projection),zoom:me.zoom+1,x:Qt,y:cr,wrap:me.wrap,fullyVisible:xt,tileID:void 0,shouldSplit:void 0,minZ:me.minZ,maxZ:me.maxZ};g&&!k&&(sr.tileID=new o.am(me.zoom+1===xe?Ne:me.zoom+1,me.wrap,me.zoom+1,Qt,cr),be(sr)),ge.push(sr)}else{const Dt=me.zoom===xe?Ne:me.zoom;if(n.minzoom&&n.minzoom>Dt)continue;if(!xt){let ar=X?me.aabb.intersectsPrecise(N):me.aabb.intersectsPreciseFlat(N);if(ar===0&&_t()){const kr=new o.bs(me.zoom,Ae,st);ar=o.bt(this,P,kr,!0).intersectsPrecise(N)}if(ar===0)continue}const Qt=D[0]-(.5+Ae+(me.wrap<<me.zoom))*(1<<a-me.zoom),cr=D[1]-.5-st,sr=me.tileID?me.tileID:new o.am(Dt,me.wrap,me.zoom,Ae,st);De.push({tileID:sr,distanceSq:Qt*Qt+cr*cr})}}if(this.fogCullDistSq){const me=this.fogCullDistSq,Ae=this.horizonLineFromTop();De=De.filter(st=>{const xt=[0,0,0,1],_t=[o.V,o.V,0,1],Dt=this.calculateFogTileMatrix(st.tileID.toUnwrapped());o.a7.transformMat4(xt,xt,Dt),o.a7.transformMat4(_t,_t,Dt);const Qt=o.a7.min([],xt,_t),cr=o.a7.max([],xt,_t),sr=o.bv(Qt,cr);if(sr===0)return!0;let ar=!1;const kr=this._elevation;if(kr&&sr>me&&Ae!==0){const Mr=this.calculateProjMatrix(st.tileID.toUnwrapped());let Cr;n.isTerrainDEM||(Cr=kr.getMinMaxForTile(st.tileID)),Cr||(Cr={min:Y,max:ne});const Ir=o.bH(this.rotation),nn=[Ir[0]*o.V,Ir[1]*o.V,Cr.max];o.N.transformMat4(nn,nn,Mr),ar=(1-nn[1])*this.height*.5<Ae}return sr<me||ar})}return De.sort((me,Ae)=>me.distanceSq-Ae.distanceSq).map(me=>me.tileID)}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const a=o.aa(n.lat,-o.bw,o.bw),d=this.projection.project(n.lng,a);return new o.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,a){let d,m;const g=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;d=(a.x-g.x)/S,m=(a.y-g.y)/S}else{const S=this.pointCoordinate(a),A=this.pointCoordinate(g);d=S.x-A.x,m=S.y-A.y}const b=this.locationCoordinate(n);this.setLocation(new o.L(b.x-d,b.y-m))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,a){const d=a?o.bl(a,n.lat):void 0,m=this.projection.project(n.lng,n.lat);return new o.L(m.x,m.y,d)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){const d=a??this._centerAltitude,m=[n.x,n.y,0,1],g=[n.x,n.y,1,1];o.a7.transformMat4(m,m,this.pixelMatrixInverse),o.a7.transformMat4(g,g,this.pixelMatrixInverse);const b=g[3];o.a7.scale(m,m,1/m[3]),o.a7.scale(g,g,1/b);const S=m[2],A=g[2];return{p0:m,p1:g,t:S===A?0:(d-S)/(A-S)}}screenPointToMercatorRay(n){const a=[n.x,n.y,0,1],d=[n.x,n.y,1,1];return o.a7.transformMat4(a,a,this.pixelMatrixInverse),o.a7.transformMat4(d,d,this.pixelMatrixInverse),o.a7.scale(a,a,1/a[3]),o.a7.scale(d,d,1/d[3]),a[2]=o.bl(a[2],this._center.lat)*this.worldSize,d[2]=o.bl(d[2],this._center.lat)*this.worldSize,o.a7.scale(a,a,1/this.worldSize),o.a7.scale(d,d,1/this.worldSize),new o.a2([a[0],a[1],a[2]],o.N.normalize([],o.N.sub([],d,a)))}rayIntersectionCoordinate(n){const{p0:a,p1:d,t:m}=n,g=o.bl(a[2],this._center.lat),b=o.bl(d[2],this._center.lat);return new o.L(o.U(a[0],d[0],m)/this.worldSize,o.U(a[1],d[1],m)/this.worldSize,o.U(g,b,m))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let a=this.projection.pointCoordinate3D(this,n.x,n.y);if(a)return new o.L(a[0],a[1],a[2]);let d=0,m=this.horizonLineFromTop();if(n.y>m)return this.pointCoordinate(n);const g=.02*m,b=n.clone();for(let S=0;S<10&&m-d>g;S++){b.y=o.U(d,m,.66);const A=this.projection.pointCoordinate3D(this,b.x,b.y);A?(m=b.y,a=A):d=b.y}return a?new o.L(a[0],a[1],a[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=o.bx)return!this.isPointAboveHorizon(n);const a=this.pointCoordinate(n);return a.y>=0&&a.y<=1}_coordinatePoint(n,a){const d=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,m=[n.x*this.worldSize,n.y*this.worldSize,d+n.toAltitude(),1];return o.a7.transformMat4(m,m,this.pixelMatrix),m[3]>0?new o.P(m[0]/m[3],m[1]/m[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:a}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,g=this.pointLocation3D(new o.P(a,n)),b=this.pointLocation3D(new o.P(m,n)),S=this.pointLocation3D(new o.P(m,d)),A=this.pointLocation3D(new o.P(a,d));let P=Math.min(g.lng,b.lng,S.lng,A.lng),D=Math.max(g.lng,b.lng,S.lng,A.lng),k=Math.min(g.lat,b.lat,S.lat,A.lat),F=Math.max(g.lat,b.lat,S.lat,A.lat);const N=Math.pow(2,-this.zoom)/16*270,q=this.projection.name==="globe"?1:4,G=(W,U,X,re,J)=>{const ne=(W+X)/2,Y=(U+re)/2,se=new o.P(ne,Y),{lng:ce,lat:de}=this.pointLocation3D(se),ge=Math.max(0,P-ce,k-de,ce-D,de-F);P=Math.min(P,ce),D=Math.max(D,ce),k=Math.min(k,de),F=Math.max(F,de),(J<q||ge>N)&&(G(W,U,ne,Y,J+1),G(ne,Y,X,re,J+1))};if(G(a,n,m,n,1),G(m,n,m,d,1),G(m,d,a,d,1),G(a,d,a,n,1),this.projection.name==="globe"){const[W,U]=o.by(this);W?(F=90,D=180,P=-180):U&&(k=-90,D=180,P=-180)}return new o.ad(new o.bn(P,k),new o.bn(D,F))}_getBoundsRectangular(n,a){const{top:d,left:m}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,S=new o.P(m,d),A=new o.P(b,d),P=new o.P(b,g),D=new o.P(m,g);let k=this.pointCoordinate(S,n),F=this.pointCoordinate(A,n);const N=this.pointCoordinate(P,a),q=this.pointCoordinate(D,a),G=(W,U)=>(U.y-W.y)/(U.x-W.x);return k.y>1&&F.y>=0?k=new o.L((1-q.y)/G(q,k)+q.x,1):k.y<0&&F.y<=1&&(k=new o.L(-q.y/G(q,k)+q.x,0)),F.y>1&&k.y>=0?F=new o.L((1-N.y)/G(N,F)+N.x,1):F.y<0&&k.y<=1&&(F=new o.L(-N.y/G(N,F)+N.x,0)),new o.ad().extend(this.coordinateLocation(k)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(N))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=n.visibleDemTiles.reduce((d,m)=>{if(m.dem){const g=m.dem.tree;d.min=Math.min(d.min,g.minimums[0]),d.max=Math.max(d.max,g.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-o.bw,this.maxLat=o.bw,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.a5(this.minLng)*this.tileSize,this.worldMaxX=o.a5(this.maxLng)*this.tileSize,this.worldMinY=o.ae(this.maxLat)*this.tileSize,this.worldMaxY=o.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){const a=n.key,d=this._distanceTileDataCache;if(d[a])return d[a];const m=n.canonical,g=1/this.height,b=this.cameraWorldSize,S=b/this.zoomScale(m.z),A=(m.x+Math.pow(2,m.z)*n.wrap)*S,P=m.y*S,D=this.point;D.x*=b/this.worldSize,D.y*=b/this.worldSize;const k=this.angle,F=Math.sin(-k),N=-Math.cos(-k);return d[a]={bearing:[F,N],center:[(D.x-A)*g,(D.y-P)*g],scale:S/o.V*g},d[a]}calculateFogTileMatrix(n){const a=n.key,d=this._fogTileMatrixCache;if(d[a])return d[a];const m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return o.a6.multiply(m,this.worldToFogMatrix,m),d[a]=new Float32Array(m),d[a]}calculateProjMatrix(n,a=!1,d=!1){const m=n.key;let g;if(g=d?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,g[m])return g[m];const b=this.calculatePosMatrix(n,this.worldSize);let S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,o.a6.multiply(b,S,b),g[m]=new Float32Array(b),g[m]}calculatePixelsToTileUnitsMatrix(n){const a=n.tileID.key,d=this._pixelsToTileUnitsCache;if(d[a])return d[a];const m=o.bz(n,this);return d[a]=m,d[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,a=o.a6.fromScaling([],[n,n,n]);return o.a6.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const a=o.bl(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),m=this._camera.forward(),g=o.bl(1,this._center.lat);d[2]/=g,m[2]/=g,o.N.normalize(m,m);const b=n.raycast(d,m,n.exaggeration());if(b){const S=o.N.scaleAndAdd([],d,m,b),A=new o.L(S[0],S[1],o.bl(S[2],o.au(S[1]))),P=(A.z+o.N.length([A.x-d[0],A.y-d[1],A.z-d[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const a=this._elevation,d=o.bl(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(d),g=a.getAtPointOrZero(new o.L(...m)),b=this.pixelsPerMeter/this.worldSize*g,S=this._minimumHeightOverTerrain(),A=m[2]-b;if(A<=S)if(A<0||n){const P=this.locationCoordinate(this._center,this._centerAltitude),D=[m[0],m[1],P.z-m[2]],k=o.N.length(D);D[2]-=(S-A)/this._pixelsPerMercatorPixel;const F=o.N.length(D);if(F===0)return;o.N.scale(D,D,k/F*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],P.z*this._pixelsPerMercatorPixel-D[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const F=this.center;return F.lat=o.aa(F.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(F.lng=o.aa(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}const a=this._unmodified,{x:d,y:m}=this.point;let g=0,b=d,S=m;const A=this.width/2,P=this.height/2,D=this.worldMinY*this.scale,k=this.worldMaxY*this.scale;if(m-P<D&&(S=D+P),m+P>k&&(S=k-P),k-D<this.height&&(g=Math.max(g,this.height/(k-D)),S=(k+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const F=this.worldMinX*this.scale,N=this.worldMaxX*this.scale,q=this.worldSize/2-(F+N)/2;b=(d+q+this.worldSize)%this.worldSize-q,b-A<F&&(b=F+A),b+A>N&&(b=N-A),N-F<this.width&&(g=Math.max(g,this.width/(N-F)),b=(N+F)/2)}b===d&&S===m||(this.center=this.unproject(new o.P(b,S))),g&&(this.zoom+=this.scaleZoom(g)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,a=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.bl(1,this.center.lat)/o.bl(1,o.bI));const m=o.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this.projection.zAxisUnit==="meters"?d:1,b=this._camera.getWorldToCamera(this.worldSize,g);let S;const A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-n.x/this.width,A[9]=2*n.y/this.height,this.isOrthographic){let de=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ge=de*this.aspect,De=-ge,xe=-de;ge-=n.x,De-=n.x,de+=n.y,xe+=n.y,S=this._camera.getCameraToClipOrthographic(De,ge,xe,de,this._nearZ,this._farZ),((Ne,Fe,tt,be)=>{for(let Oe=0;Oe<16;Oe++)Ne[Oe]=gl(Fe[Oe],tt[Oe],be)})(S,S,A,Ic(this.pitch>=15?1:this.pitch/15))}else S=A;const P=o.a6.mul([],A,b);let D=o.a6.mul([],S,b);if(this.projection.isReprojectedInTileSpace){const de=this.locationCoordinate(this.center),ge=o.a6.identity([]);o.a6.translate(ge,ge,[de.x*this.worldSize,de.y*this.worldSize,0]),o.a6.multiply(ge,ge,o.bB(this)),o.a6.translate(ge,ge,[-de.x*this.worldSize,-de.y*this.worldSize,0]),o.a6.multiply(D,D,ge),o.a6.multiply(P,P,ge),this.inverseAdjustmentMatrix=o.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.a6.scale([],D,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=D,this.invProjMatrix=o.a6.invert(new Float64Array(16),this.projMatrix),a){const de=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);de[8]=2*-n.x/this.width,de[9]=2*n.y/this.height,this.expandedFarZProjMatrix=o.a6.mul([],de,b)}else this.expandedFarZProjMatrix=this.projMatrix;const k=o.a6.invert([],S);this.frustumCorners=o.bD.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const F=new Float32Array(16);o.a6.identity(F),o.a6.scale(F,F,[1,-1,1]),o.a6.rotateX(F,F,this._pitch),o.a6.rotateZ(F,F,this.angle);const N=o.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.a6.clone(N);const q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;N[8]=2*-n.x/this.width,N[9]=2*(n.y+q)/this.height,this.skyboxMatrix=o.a6.multiply(F,N,F);const G=this.point,W=G.x,U=G.y,X=this.width%2/2,re=this.height%2/2,J=Math.cos(this.angle),ne=Math.sin(this.angle),Y=W-Math.round(W)+J*X+ne*re,se=U-Math.round(U)+J*re+ne*X,ce=new Float64Array(D);if(o.a6.translate(ce,ce,[Y>.5?Y-1:Y,se>.5?se-1:se,0]),this.alignedProjMatrix=ce,D=o.a6.create(),o.a6.scale(D,D,[this.width/2,-this.height/2,1]),o.a6.translate(D,D,[1,-1,0]),this.labelPlaneMatrix=D,D=o.a6.create(),o.a6.scale(D,D,[1,-1,1]),o.a6.translate(D,D,[-1,-1,0]),o.a6.scale(D,D,[2/this.width,2/this.height,1]),this.glCoordMatrix=D,this.pixelMatrix=o.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,P),this._calcFogMatrices(),this._distanceTileDataCache={},D=o.a6.invert(new Float64Array(16),this.pixelMatrix),!D)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=D,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.bE(this);const de=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.N.transformMat4(de,de,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=D;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,d=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,g=[n,n,a];o.N.scale(g,g,m),o.N.scale(d,d,-1),o.N.multiply(d,d,g);const b=o.a6.create();o.a6.translate(b,b,d),o.a6.scale(b,b,g),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,m)}_computeCameraPosition(n){const a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),m=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-d[0]*g,m.y/this.worldSize-d[1]*g,n/this.worldSize*this._centerAltitude-d[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],m=n[2];let g=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(g=Math.min((a-d)/m,1)),this._camera.position=o.N.scaleAndAdd([],this._camera.position,n,g),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,a=this._camera.forward(),{pitch:d,bearing:m}=this._camera.getPitchBearing(),g=o.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.bj(this._maxPitch)),S=Math.max((n[2]-g)/Math.cos(d),b),A=this._zoomFromMercatorZ(S);o.N.scaleAndAdd(n,n,a,S),this._pitch=o.aa(d,o.bj(this.minPitch),o.bj(this.maxPitch)),this.angle=o.bh(m,-Math.PI,Math.PI),this._setZoom(o.aa(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.L(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let a=0,d=o.bx,m=0,g=1/0;for(;d-a>1e-6&&d>a;){const b=a+.5*(d-a),S=this.tileSize*Math.pow(2,b),A=this.getCameraToCenterDistance(this.projection,b,S),P=this.scaleZoom(A/(n*this.tileSize)),D=Math.abs(b-P);D<g&&(g=D,m=b),b<P?a=b:d=b}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){const d=Math.min(n.x,a.x),m=Math.max(n.x,a.x),g=Math.min(n.y,a.y),b=Math.max(n.y,a.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new o.P(d,g),new o.P(m,b),new o.P(d,b),new o.P(m,g)],A=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const D of S){const k=this.pointRayIntersection(D);if(k.t<0)return!0;const F=this.rayIntersectionCoordinate(k);if(F.x<A||F.y<0||F.x>P||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(n,a){const d=o.N.length(o.N.sub([],this._camera.position,n)),m=this._zoomFromMercatorZ(d)+a;return d-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([a,d,m],g){const b=[a,d,m,1];o.a7.transformMat4(b,b,g);const S=b[3]=Math.max(b[3],1e-6);return b[0]/=S,b[1]/=S,b[2]/=S,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,n))}}getCameraToCenterDistance(n,a=this.zoom,d=this.worldSize){const m=o.bA(n,a,this.width,this.height,1024),g=n.pixelSpaceConversion(this.center.lat,d,m);let b=.5/Math.tan(.5*this._fov)*this.height*g;return this.isOrthographic&&(b=gl(1,b,Ic(this.pitch>=15?1:this.pitch/15))),b}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.a6.multiply(n,n,this.globeMatrix),n}getFrustum(n){return o.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const Vi={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},qo=(h,n)=>{if(n>0&&h.terrain&&o.w("Cutoff is currently disabled on terrain"),n<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=h.transform,d=Math.max(Math.abs(a._zoom-(h.minCutoffZoom-1)),1),m=a.isLODDisabled(!1)?o.O(60,45,a.pitch):o.O(30,15,a.pitch),g=a._farZ-a._nearZ,b=n*a.height,S=((1-(A=m))*a.cameraToCenterDistance+A*(a._farZ+b))*d;var A;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(S-a._nearZ)/g,(S-b-a._nearZ)/g]}}},Ji={cascadeCount:2,shadowMapResolution:2048};class Gd{constructor(n,a){this.aabb=n,this.lastCascade=a}}class wm{add(n,a){const d=this.receivers[n.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],a.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],a.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],a.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],a.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],a.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],a.max[2])):this.receivers[n.key]=new Gd(a,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,a,d){const m=o.bS.fromPoints(n.points);let g=0;for(const b in this.receivers){const S=this.receivers[b];if(!S||!m.intersectsAabb(S.aabb))continue;S.aabb.min=m.closestPoint(S.aabb.min),S.aabb.max=m.closestPoint(S.aabb.max);const A=S.aabb.getCorners();for(let P=0;P<d.length;P++){let D=!0;for(const k of A){const F=[k[0]*a,k[1]*a,k[2]];if(o.N.transformMat4(F,F,d[P].matrix),F[0]<-1||F[0]>1||F[1]<-1||F[1]>1){D=!1;break}}if(S.lastCascade=P,g=Math.max(g,P),D)break}}return g+1}}class Hd{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new wm,this._depthMode=new pr(n.context.gl.LEQUAL,pr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,n.tp.registerParameter(Ji,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(Ji,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,a){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const m=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||m<=0||(this._shadowLayerCount=d.style.order.reduce((q,G)=>{const W=d.style._mergedLayers[G];return q+(W.hasShadowPass()&&!W.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const g=d.context,b=Ji.shadowMapResolution,S=Ji.shadowMapResolution;if(this._cascades.length===0||Ji.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let q=0;q<Ji.cascadeCount;++q){const G=d._shadowMapDebug,W=g.gl,U=g.createFramebuffer(b,S,G,"texture"),X=new o.T(g,{width:b,height:S,data:null},W.DEPTH_COMPONENT);if(U.depthAttachment.set(X.texture),G){const re=new o.T(g,{width:b,height:S,data:null},W.RGBA);U.colorAttachment.set(re.texture)}this._cascades.push({framebuffer:U,texture:X,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.bq,scale:0})}}this.shadowDirection=qu(a);let A=0;if(n.elevation){const q=n.elevation,G=[1e4,-1e4];q.visibleDemTiles.filter(W=>W.dem).forEach(W=>{const U=W.dem.tree;G[0]=Math.min(G[0],U.minimums[0]),G[1]=Math.max(G[1],U.maximums[0])}),G[0]!==1e4&&(A=(G[1]-G[0])*q.exaggeration())}const P=1.5*n.cameraToCenterDistance,D=3*P,k=new Float64Array(16);for(let q=0;q<this._cascades.length;++q){const G=this._cascades[q];let W=n.height/50,U=1;Ji.cascadeCount===1?U=D:q===0?U=P:(W=P,U=D);const[X,re]=Tm(n,this.shadowDirection,W,U,Ji.shadowMapResolution,A);G.scale=n.scale,G.matrix=X,G.boundingSphereRadius=re,o.a6.invert(k,G.matrix),G.frustum=o.bq.fromInvProjectionMatrix(k,1,0,!0),G.far=U}const F=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[F].far,this._cascades[F].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ji.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ji.shadowMapResolution,this._uniformValues.u_shadowmap_0=Vi.ShadowMap0,this._uniformValues.u_shadowmap_1=Vi.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const N=d.transform.elevation;for(const q of this._groundShadowTiles){let G={min:0,max:0};if(N){const W=N.getMinMaxForTile(q);W&&(G=W)}this.addShadowReceiver(q.toUnwrapped(),G.min,G.max)}}get enabled(){return this._enabled}set enabled(n){this._enabled=n}drawShadowPass(n,a){if(!this._enabled)return;const d=this.painter,m=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),m.viewport.set([0,0,Ji.shadowMapResolution,Ji.shadowMapResolution]);for(let g=0;g<this._numCascadesToRender;++g){d.currentShadowCascade=g,m.bindFramebuffer.set(this._cascades[g].framebuffer.framebuffer),m.clear({color:o.ax.white,depth:1});for(const b of n.order){const S=n._mergedLayers[b];if(!S.hasShadowPass()||S.isHidden(d.transform.zoom))continue;const A=n.getLayerSourceCache(S),P=A?a[A.id]:void 0;(S.type==="model"||P&&P.length)&&d.renderLayer(d,A,S,P)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const n=this.painter,a=n.style,d=n.context,m=a.directionalLight,g=a.ambientLight;if(!m||!g)return;const b=[],S=qo(n,n.longestCutoffRange);S.shouldRenderCutoff&&b.push("RENDER_CUTOFF");const A=Pc(m,g),P=new pr(d.gl.LEQUAL,pr.ReadOnly,n.depthRangeFor3D);for(const D of this._groundShadowTiles){const k=D.toUnwrapped(),F=n.isTileAffectedByFog(D),N=n.getOrCreateProgram("groundShadow",{defines:b,overrideFog:F});this.setupShadows(k,N),n.uploadCommonUniforms(d,N,k,null,S);const q={u_matrix:n.transform.calculateProjMatrix(k),u_ground_shadow_factor:A};N.draw(n,d.gl.TRIANGLES,P,Er.disabled,jr.multiply,mr.disabled,q,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,{},n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?jr.unblended:jr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const a=this.painter.transform,d=a.calculatePosMatrix(n,a.worldSize);return o.a6.multiply(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(n){return o.a6.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,a,d,m=0){if(!this._enabled)return;const g=this.painter.transform,b=this.painter.context,S=b.gl,A=this._uniformValues,P=new Float64Array(16),D=g.calculatePosMatrix(n,g.worldSize);for(let k=0;k<this._cascades.length;k++)o.a6.multiply(P,this._cascades[k].matrix,D),A[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),b.activeTexture.set(S.TEXTURE0+Vi.ShadowMap0+k),this._cascades[k].texture.bind(S.NEAREST,S.CLAMP_TO_EDGE);if(this.useNormalOffset=!!d,this.useNormalOffset){const k=o.bR(n.canonical),F=2/g.tileSize*o.V/Ji.shadowMapResolution,N=F*this._cascades[0].boundingSphereRadius,q=F*this._cascades[this._cascades.length-1].boundingSphereRadius,G=(d==="vector-tile"?1:3)/Math.pow(2,m-n.canonical.z-(1-g.zoom+Math.floor(g.zoom)));A.u_shadow_normal_offset=[k,N*G,q*G],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(b,A)}setupShadowsFromMatrix(n,a,d=!1){if(!this._enabled)return;const m=this.painter.context,g=m.gl,b=this._uniformValues,S=new Float64Array(16);for(let A=0;A<Ji.cascadeCount;A++)o.a6.multiply(S,this._cascades[A].matrix,n),b[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),m.activeTexture.set(g.TEXTURE0+Vi.ShadowMap0+A),this._cascades[A].texture.bind(g.NEAREST,g.CLAMP_TO_EDGE);this.useNormalOffset=d,d?(b.u_shadow_normal_offset=[1,5,5],b.u_shadow_bias=[6e-5,.0012,.012]):b.u_shadow_bias=[36e-5,.0012,.012],a.setShadowUniformValues(m,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,a,d,m){if(m[2]>=0)return{};const g=function(A,P,D){const k=D/(1<<A.canonical.z);return new o.bS([A.canonical.x*k+A.wrap*D,A.canonical.y*k+A.wrap*D,0],[(A.canonical.x+1)*k+A.wrap*D,(A.canonical.y+1)*k+A.wrap*D,P])}(n,a,d).getCorners(),b=a/-m[2];m[0]<0?(o.N.add(g[0],g[0],[m[0]*b,0,0]),o.N.add(g[3],g[3],[m[0]*b,0,0])):m[0]>0&&(o.N.add(g[1],g[1],[m[0]*b,0,0]),o.N.add(g[2],g[2],[m[0]*b,0,0])),m[1]<0?(o.N.add(g[0],g[0],[0,m[1]*b,0]),o.N.add(g[1],g[1],[0,m[1]*b,0])):m[1]>0&&(o.N.add(g[2],g[2],[0,m[1]*b,0]),o.N.add(g[3],g[3],[0,m[1]*b,0]));const S={};return S.vertices=g,S.planes=[Pa(g[1],g[0],g[4]),Pa(g[2],g[1],g[5]),Pa(g[3],g[2],g[6]),Pa(g[0],g[3],g[7])],S}addShadowReceiver(n,a,d){this._receivers.add(n,o.bS.fromTileIdAndHeight(n,a,d))}getMaxCascadeForTile(n){const a=this._receivers.get(n);return a&&a.lastCascade?a.lastCascade:0}}function Pa(h,n,a){const d=o.N.sub([],a,n),m=o.N.sub([],h,n),g=o.N.cross([],d,m),b=o.N.length(g);return b===0?[0,0,1,0]:(o.N.scale(g,g,1/b),[g[0],g[1],g[2],-o.N.dot(g,n)])}function qu(h){const n=h.properties.get("direction"),a=o.bQ(n.x,n.y,n.z);a[2]=o.aa(a[2],0,75);const d=o.bT([a[0],a[1],a[2]]);return o.N.fromValues(d.x,d.y,d.z)}function Pc(h,n){const a=h.properties.get("color"),d=h.properties.get("intensity"),m=h.properties.get("direction"),g=[m.x,m.y,m.z],b=n.properties.get("color"),S=n.properties.get("intensity"),A=Math.max(o.N.dot([0,0,1],g),0),P=[0,0,0];o.N.scale(P,b.toArray01Linear().slice(0,3),S);const D=[0,0,0];return o.N.scale(D,a.toArray01Linear().slice(0,3),A*d),o.bU([P[0]>0?P[0]/(P[0]+D[0]):0,P[1]>0?P[1]/(P[1]+D[1]):0,P[2]>0?P[2]/(P[2]+D[2]):0])}function Tm(h,n,a,d,m,g){const b=h.zoom,S=h.scale,A=h.worldSize,P=1/A,D=h.aspect,k=Math.sqrt(1+D*D)*Math.tan(.5*h.fovX),F=k*k,N=d-a,q=d+a;let G,W;F>N/q?(G=d,W=d*k):(G=.5*q*(1+F),W=.5*Math.sqrt(N*N+2*(d*d+a*a)*F+q*q*F*F));const U=h.projection.pixelsPerMeter(h.center.lat,A),X=h._camera.getCameraToWorldMercator(),re=[0,0,-G*P];o.N.transformMat4(re,re,X);let J=W*P;const ne=h._edgeInsets;if(!(ne.left===0&&ne.top===0&&ne.right===0&&ne.bottom===0||ne.left===ne.right&&ne.top===ne.bottom)){const xt=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?U:1),_t=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,a,d);_t[8]=2*-h.centerOffset.x/h.width,_t[9]=2*h.centerOffset.y/h.height;const Dt=new Float64Array(16);o.a6.mul(Dt,_t,xt);const Qt=new Float64Array(16);o.a6.invert(Qt,Dt);const cr=o.bq.fromInvProjectionMatrix(Qt,A,b,!0);for(const sr of cr.points){const ar=((Y=sr)[0]/=S,Y[1]/=S,Y[2]=o.bl(Y[2],h._center.lat),Y);J=Math.max(J,o.N.len(o.N.subtract([],re,ar)))}}var Y;J*=m/(m-1);const se=Math.acos(n[2]),ce=Math.atan2(-n[0],-n[1]),de=new _l;de.position=re,de.setPitchBearing(se,ce);const ge=de.getWorldToCamera(A,U),De=J*A,xe=Math.min(h._mercatorZfromZoom(17)*A*-2,-2*De),Ne=de.getCameraToClipOrthographic(-De,De,-De,De,xe,(De+g*U)/n[2]),Fe=new Float64Array(16);o.a6.multiply(Fe,Ne,ge);const tt=o.N.fromValues(Math.floor(1e6*re[0])/1e6*A,Math.floor(1e6*re[1])/1e6*A,0),be=.5*m,Oe=[0,0,0];o.N.transformMat4(Oe,tt,Fe),o.N.scale(Oe,Oe,be);const me=[Math.floor(Oe[0]),Math.floor(Oe[1]),Math.floor(Oe[2])],Ae=[0,0,0];o.N.sub(Ae,Oe,me),o.N.scale(Ae,Ae,-1/be);const st=new Float64Array(16);return o.a6.identity(st),o.a6.translate(st,st,Ae),o.a6.multiply(Fe,st,Fe),[Fe,De]}const Wo=(h,n)=>Ht(h,n&&n.filter(a=>a.identifier!=="source.canvas")),Sm=o.ac(rn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),yl=o.ac(rn,["setCenter","setZoom","setBearing","setPitch"]),qd={version:8,layers:[],sources:{}},Mm={duration:300,delay:0},jy=new Set(["fill","line","background","hillshade","raster"]);class Ns extends o.E{constructor(n,a={}){super(),this.map=n,this.scope=a.scope||"",this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=o.e({},Mm),this._buildingIndex=new mm(this),this.crossTileSymbolIndex=new Ud,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new Xt,this.dispatcher=a.dispatcher?a.dispatcher:new o.bW(o.bX(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new Ur,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new o.bY(n._requestManager,a.localFontFamily?o.bZ.all:a.localIdeographFontFamily?o.bZ.ideographs:o.bZ.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new xr(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this.dispatcher.broadcast("setReferrer",o.b_());const d=this;this._rtlTextPluginCallback=Ns.registerForPluginStateChange(m=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(g,b)=>{if(o.b$(g),b&&b.every(S=>S))for(const S in d._sourceCaches){const A=d._sourceCaches[S],P=A.getSource().type;P!=="vector"&&P!=="geojson"||A.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const g=this.getOwnSource(m.sourceId);if(g&&g.vectorLayerIds)for(const b in this._layers){const S=this._layers[b];S.source===g.id&&this._validateLayer(S)}})}loadURL(n,a={}){this.fire(new o.b("dataloading",{dataType:"style"}));const d=typeof a.validate=="boolean"?a.validate:!o.c0(n);n=this.map._requestManager.normalizeStyleURL(n,a.accessToken),this.resolvedImports.add(n);const m=this.importsCache.get(n);if(m)return this._load(m,d);const g=this.map._requestManager.transformRequest(n,o.R.Style);this._request=o.g(g,(b,S)=>{if(this._request=null,b)this.fire(new o.a(b));else if(S)return this.importsCache.set(n,S),this._load(S,d)})}loadJSON(n,a={}){this.fire(new o.b("dataloading",{dataType:"style"})),this._request=o.f.frame(()=>{this._request=null,this._load(n,a.validate!==!1)})}loadEmpty(){this.fire(new o.b("dataloading",{dataType:"style"})),this._load(qd,!1)}_loadImports(n,a,d){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const m=[];for(const g of n){const b=this._createFragmentStyle(g),S=new Promise(D=>{b.once("style.import.load",D),b.once("error",D)}).then(()=>this.mergeAll());if(m.push(S),this.resolvedImports.has(g.url)){b.loadEmpty();continue}const A=g.data||this.importsCache.get(g.url);A?b.loadJSON(A,{validate:a}):g.url?b.loadURL(g.url,{validate:a}):b.loadEmpty();const P={style:b,id:g.id,config:g.config};if(d){const D=this.fragments.findIndex(({id:k})=>k===d);this.fragments=this.fragments.slice(0,D).concat(P).concat(this.fragments.slice(D))}else this.fragments.push(P)}return Promise.allSettled(m)}_createFragmentStyle(n){const a=this.scope?o.ag(n.id,this.scope):n.id,d=new Ns(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:n.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return d.setEventedParent(this.map,{style:d}),d}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const n=this.isRootStyle();this._shouldPrecompile=n,this.fire(new o.b(n?"style.load":"style.import.load"))}_load(n,a){const d=n.schema;if(this.isRootStyle()&&(n.fragment||d&&n.fragment!==!1)){const b=o.e({},qd,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(b,a)}if(this.setConfig(this._config,d),a&&Wo(this,rr(n)))return;this._loaded=!0,this.stylesheet=o.c1(n);for(const b in n.sources)this.addSource(b,n.sources[b],{validate:!1,isInitialLoad:!0});n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(n.glyphs,this.scope);const m=_m(this.stylesheet.layers);if(this._order=m.map(b=>b.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const b=this.stylesheet.lights[0];this.light=new Pe(b.properties,b.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Pe(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const b of m){const S=o.c2(b,this.scope,this.options);S.isConfigDependent&&this._configDependentLayers.add(S.fqid),S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize();const A=this.getOwnLayerSourceCache(S),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&S.canCastShadows()&&P&&(A.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const g=this.stylesheet.terrain;g&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(g,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.b("data",{dataType:"style"})),n.imports?this._loadImports(n.imports,a).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,a,d,m,g,b,S,A;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(P=>{if(P.stylesheet){if(P.light!=null&&(n=P.light),P.stylesheet.lights)for(const D of P.stylesheet.lights)D.type==="ambient"&&P.ambientLight!=null&&(a=P.ambientLight),D.type==="directional"&&P.directionalLight!=null&&(d=P.directionalLight);m=this._prioritizeTerrain(m,P.terrain,P.stylesheet.terrain),P.stylesheet.fog&&P.fog!=null&&(g=P.fog),P.stylesheet.camera!=null&&(A=P.stylesheet.camera),P.stylesheet.projection!=null&&(b=P.stylesheet.projection),P.stylesheet.transition!=null&&(S=P.stylesheet.transition)}}),this.light=n,this.ambientLight=a,this.directionalLight=d,this.fog=g,m===null?delete this.terrain:this.terrain=m,this.camera=A||{"camera-projection":"perspective"},this.projection=b||{name:"mercator"},this.transition=o.e({},Mm,S),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const a=d=>{for(const m of d.fragments)a(m.style);n(d)};a(this)}_prioritizeTerrain(n,a,d){const m=n&&n.drapeRenderMode===0;return d===null?a&&a.drapeRenderMode===0?a:m?n:null:a!=null&&(!n||m||a&&a.drapeRenderMode===1)?a:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{n=this._prioritizeTerrain(n,a.terrain,a.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(n=a.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},a={},d={};this.forEachFragmentStyle(m=>{for(const g in m._sourceCaches){const b=o.ag(g,m.scope);n[b]=m._sourceCaches[g]}for(const g in m._otherSourceCaches){const b=o.ag(g,m.scope);a[b]=m._otherSourceCaches[g]}for(const g in m._symbolSourceCaches){const b=o.ag(g,m.scope);d[b]=m._symbolSourceCaches[g]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=d}mergeLayers(){const n={},a=[],d={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(g=>{for(const b of g._order){const S=g._layers[b];if(S.type==="slot"){const A=o.c3(b);if(n[A])continue;n[A]=[]}S.slot&&n[S.slot]?n[S.slot].push(S):a.push(S)}}),this._mergedOrder=[];const m=(g=[])=>{for(const b of g)if(b.type==="slot"){const S=o.c3(b.id);n[S]&&m(n[S])}else{const S=o.ag(b.id,b.scope);this._mergedOrder.push(S),d[S]=b,b.is3D()&&(this._has3DLayers=!0),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0)}};m(a),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=o.e({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(a,d,m){let g,b,S;const A=o.f.devicePixelRatio>1?"@2x":"";let P=o.g(d.transformRequest(d.normalizeSpriteURL(a,A,".json"),o.R.SpriteJSON),(F,N)=>{P=null,S||(S=F,g=N,k())}),D=o.d(d.transformRequest(d.normalizeSpriteURL(a,A,".png"),o.R.SpriteImage),(F,N)=>{D=null,S||(S=F,b=N,k())});function k(){if(S)m(S);else if(g&&b){const F=o.f.getImageData(b),N={};for(const q in g){const{width:G,height:W,x:U,y:X,sdf:re,pixelRatio:J,stretchX:ne,stretchY:Y,content:se}=g[q],ce=new o.h({width:G,height:W});o.h.copy(F,ce,{x:U,y:X},{x:0,y:0},{width:G,height:W}),N[q]={data:ce,pixelRatio:J,sdf:re,stretchX:ne,stretchY:Y,content:se}}m(null,N)}}return{cancel(){P&&(P.cancel(),P=null),D&&(D.cancel(),D=null)}}}(n,this.map._requestManager,(a,d)=>{if(this._spriteRequest=null,a)this.fire(new o.a(a));else if(d)for(const m in d)this.imageManager.addImage(m,this.scope,d[m]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.b("data",{dataType:"style"}))})}_validateLayer(n){const a=this.getOwnSource(n.source);if(!a)return;const d=n.sourceLayer;d&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(d)===-1)&&this.fire(new o.a(new Error(`Source layer "${d}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,a)=>{const d=this.fragments[a];return d&&d.style&&(n.data=d.style.serialize()),n})}_serializeSources(){const n={};for(const a in this._sourceCaches){const d=this._sourceCaches[a].getSource();n[d.id]||(n[d.id]=d.serialize())}return n}_serializeLayers(n){const a=[];for(const d of n){const m=this._layers[d];m&&m.type!=="custom"&&a.push(m.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&(typeof n.isLayerDraped=="function"?n.isLayerDraped(this.getLayerSourceCache(n)):jy.has(n.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const a=this.getOwnLayer(n);if(a)return a;this.fire(new o.a(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const a=this.getOwnSource(n);if(a)return a;this.fire(new o.a(new Error(`The source '${n}' does not exist in the map's style.`)))}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const a=this.calculateLightsBrightness();n.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a));const d=this._changes.isDirty();if(this._changes.isDirty()){const g=this._changes.getLayerUpdatesByScope();for(const b in g){const{updatedIds:S,removedIds:A}=g[b];(S||A)&&this._updateWorkerLayers(b,S,A)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._changes.reset()}const m={};for(const g in this._mergedSourceCaches){const b=this._mergedSourceCaches[g];m[g]=b.used,b.used=!1,b.tileCoverLift=0}for(const g of this._mergedOrder){const b=this._mergedLayers[g];if(b.recalculate(n,this._availableImages),!b.isHidden(n.zoom)){const S=this.getLayerSourceCache(b);S&&(S.used=!0,S.tileCoverLift=Math.max(S.tileCoverLift,b.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let S=b.minzoom||0;S<(b.maxzoom||25.5);S++){const A=this.map.painter;if(A){const P=b.getProgramIds();if(!P)continue;for(const D of P){const k=b.getDefaultProgramParams(D,n.zoom);k&&(A.style=this,this.fog&&(A._fogVisible=!0,k.overrideFog=!0,A.getOrCreateProgram(D,k)),A._fogVisible=!1,k.overrideFog=!1,A.getOrCreateProgram(D,k),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(k.overrideRtt=!0,A.getOrCreateProgram(D,k)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const g in m){const b=this._mergedSourceCaches[g];m[g]!==b.used&&b.getSource().fire(new o.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new o.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=this._changes.getUpdatedImages();if(n.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n);this._changes.resetUpdatedImages()}}_updateWorkerLayers(n,a,d){const m=this.getFragmentStyle(n);m&&this.dispatcher.broadcast("updateLayers",{layers:a?m._serializeLayers(a):[],scope:n,removedIds:d||[],options:m.options})}setState(n){if(this._checkLoaded(),Wo(this,rr(n)))return!1;(n=o.c1(n)).layers=_m(n.layers);const a=function(m,g){if(!m)return[{command:rn.setStyle,args:[g]}];let b=[];try{if(!B(m.version,g.version))return[{command:rn.setStyle,args:[g]}];B(m.center,g.center)||b.push({command:rn.setCenter,args:[g.center]}),B(m.zoom,g.zoom)||b.push({command:rn.setZoom,args:[g.zoom]}),B(m.bearing,g.bearing)||b.push({command:rn.setBearing,args:[g.bearing]}),B(m.pitch,g.pitch)||b.push({command:rn.setPitch,args:[g.pitch]}),B(m.sprite,g.sprite)||b.push({command:rn.setSprite,args:[g.sprite]}),B(m.glyphs,g.glyphs)||b.push({command:rn.setGlyphs,args:[g.glyphs]}),B(m.imports,g.imports)||function(k=[],F=[],N){F=F||[];const q=(k=k||[]).map(Uo),G=F.map(Uo),W=k.reduce(Nu,{}),U=F.reduce(Nu,{}),X=q.slice();let re,J,ne,Y;for(re=0,J=0;re<q.length;re++)ne=q[re],U.hasOwnProperty(ne)?J++:(N.push({command:rn.removeImport,args:[ne]}),X.splice(X.indexOf(ne,J),1));for(re=0,J=0;re<G.length;re++)ne=G[G.length-1-re],X[X.length-1-re]!==ne&&(W.hasOwnProperty(ne)?(N.push({command:rn.removeImport,args:[ne]}),X.splice(X.lastIndexOf(ne,X.length-J),1)):J++,Y=X[X.length-re],N.push({command:rn.addImport,args:[U[ne],Y]}),X.splice(X.length-re,0,ne));for(const se of F){const ce=W[se.id];ce&&!B(ce,se)&&N.push({command:rn.updateImport,args:[se.id,se]})}}(m.imports,g.imports,b),B(m.transition,g.transition)||b.push({command:rn.setTransition,args:[g.transition]}),B(m.light,g.light)||b.push({command:rn.setLight,args:[g.light]}),B(m.fog,g.fog)||b.push({command:rn.setFog,args:[g.fog]}),B(m.projection,g.projection)||b.push({command:rn.setProjection,args:[g.projection]}),B(m.lights,g.lights)||b.push({command:rn.setLights,args:[g.lights]}),B(m.camera,g.camera)||b.push({command:rn.setCamera,args:[g.camera]});const S={},A=[];(function(k,F,N,q){let G;for(G in F=F||{},k=k||{})k.hasOwnProperty(G)&&(F.hasOwnProperty(G)||Md(G,N,q));for(G in F){if(!F.hasOwnProperty(G))continue;const W=F[G];k.hasOwnProperty(G)?B(k[G],W)||(k[G].type==="geojson"&&W.type==="geojson"&&zy(k,F,G)?N.push({command:rn.setGeoJSONSourceData,args:[G,W.data]}):Oy(G,F,N,q)):bc(G,F,N)}})(m.sources,g.sources,A,S);const P=[];m.layers&&m.layers.forEach(k=>{k.source&&S[k.source]?b.push({command:rn.removeLayer,args:[k.id]}):P.push(k)});let D=m.terrain;D&&S[D.source]&&(b.push({command:rn.setTerrain,args:[void 0]}),D=void 0),b=b.concat(A),B(D,g.terrain)||b.push({command:rn.setTerrain,args:[g.terrain]}),function(k,F,N){F=F||[];const q=(k=k||[]).map(Uo),G=F.map(Uo),W=k.reduce(Nu,{}),U=F.reduce(Nu,{}),X=q.slice(),re=Object.create(null);let J,ne,Y,se,ce,de,ge;for(J=0,ne=0;J<q.length;J++)Y=q[J],U.hasOwnProperty(Y)?ne++:(N.push({command:rn.removeLayer,args:[Y]}),X.splice(X.indexOf(Y,ne),1));for(J=0,ne=0;J<G.length;J++)Y=G[G.length-1-J],X[X.length-1-J]!==Y&&(W.hasOwnProperty(Y)?(N.push({command:rn.removeLayer,args:[Y]}),X.splice(X.lastIndexOf(Y,X.length-ne),1)):ne++,de=X[X.length-J],N.push({command:rn.addLayer,args:[U[Y],de]}),X.splice(X.length-J,0,Y),re[Y]=!0);for(J=0;J<G.length;J++)if(Y=G[J],se=W[Y],ce=U[Y],!re[Y]&&!B(se,ce))if(B(se.source,ce.source)&&B(se["source-layer"],ce["source-layer"])&&B(se.type,ce.type)){for(ge in $o(se.layout,ce.layout,N,Y,null,rn.setLayoutProperty),$o(se.paint,ce.paint,N,Y,null,rn.setPaintProperty),B(se.slot,ce.slot)||N.push({command:rn.setSlot,args:[Y,ce.slot]}),B(se.filter,ce.filter)||N.push({command:rn.setFilter,args:[Y,ce.filter]}),B(se.minzoom,ce.minzoom)&&B(se.maxzoom,ce.maxzoom)||N.push({command:rn.setLayerZoomRange,args:[Y,ce.minzoom,ce.maxzoom]}),se)se.hasOwnProperty(ge)&&ge!=="layout"&&ge!=="paint"&&ge!=="filter"&&ge!=="metadata"&&ge!=="minzoom"&&ge!=="maxzoom"&&ge!=="slot"&&(ge.indexOf("paint.")===0?$o(se[ge],ce[ge],N,Y,ge.slice(6),rn.setPaintProperty):B(se[ge],ce[ge])||N.push({command:rn.setLayerProperty,args:[Y,ge,ce[ge]]}));for(ge in ce)ce.hasOwnProperty(ge)&&!se.hasOwnProperty(ge)&&ge!=="layout"&&ge!=="paint"&&ge!=="filter"&&ge!=="metadata"&&ge!=="minzoom"&&ge!=="maxzoom"&&ge!=="slot"&&(ge.indexOf("paint.")===0?$o(se[ge],ce[ge],N,Y,ge.slice(6),rn.setPaintProperty):B(se[ge],ce[ge])||N.push({command:rn.setLayerProperty,args:[Y,ge,ce[ge]]}))}else N.push({command:rn.removeLayer,args:[Y]}),de=X[X.lastIndexOf(Y)+1],N.push({command:rn.addLayer,args:[ce,de]})}(P,g.layers,b)}catch(S){console.warn("Unable to compute style diff:",S),b=[{command:rn.setStyle,args:[g]}]}return b}(this.serialize(),n).filter(m=>!(m.command in yl));if(a.length===0)return!1;const d=a.filter(m=>!(m.command in Sm));if(d.length>0)throw new Error(`Unimplemented: ${d.map(m=>m.command).join(", ")}.`);return a.forEach(m=>{this[m.command].apply(this,m.args)}),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(n,a){return this.getImage(n)?this.fire(new o.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,this.scope,a),this._afterImageUpdated(n),this)}updateImage(n,a){this.imageManager.updateImage(n,this.scope,a)}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._afterImageUpdated(n),this):this.fire(new o.a(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(n),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new o.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(n,a,d={}){return this._checkLoaded(),this._validate(Ut,`models.${n}`,a,null,d)||(this.modelManager.addModel(n,a,this.scope),this._changes.setDirty()),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this):this.fire(new o.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,a,d={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(br,`sources.${n}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const m=gi(n,a,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id}));const g=b=>{const S=(b?"symbol:":"other:")+m.id,A=o.ag(S,this.scope),P=this._sourceCaches[S]=new Fs(A,m,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=P,P.onAdd(this.map)};g(!1),a.type!=="vector"&&a.type!=="geojson"||g(!0),m.onAdd&&m.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const a=this.getOwnSource(n);if(!a)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===n)return this.fire(new o.a(new Error(`Source "${n}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new o.a(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const d=this.getOwnSourceCaches(n);for(const m of d){const g=o.c3(m.id);delete this._sourceCaches[g],this._changes.discardSourceCacheUpdate(m.id),m.fire(new o.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getOwnSource(n).setData(a),this._changes.setDirty()}getOwnSource(n){const a=this.getOwnSourceCache(n);return a&&a.getSource()}getOwnSources(){const n=[];for(const a in this._otherSourceCaches){const d=this.getOwnSourceCache(a);d&&n.push(d.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const a in n){const d=n[a]._tiles;for(const m in d){const g=d[m];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const m of n){if(this._validate(Ie,"lights",m))return;switch(m.type){case"ambient":if(this.ambientLight){const g=this.ambientLight;g.set(m),g.updateTransitions(a)}else this.ambientLight=new bi(m,Ci,this.scope,this.options);break;case"directional":if(this.directionalLight){const g=this.directionalLight;g.set(m),g.updateTransitions(a)}else this.directionalLight=new bi(m,Wn,this.scope,this.options)}}const d=new o.K(this.z||0,a);this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,a=this.ambientLight;if(!n||!a)return;const d=k=>.2126*(k[0]<=.03928?k[0]/12.92:Math.pow((k[0]+.055)/1.055,2.4))+.7152*(k[1]<=.03928?k[1]/12.92:Math.pow((k[1]+.055)/1.055,2.4))+.0722*(k[2]<=.03928?k[2]/12.92:Math.pow((k[2]+.055)/1.055,2.4)),m=n.properties.get("color").toArray01(),g=n.properties.get("intensity"),b=n.properties.get("direction"),S=1-o.bQ(b.x,b.y,b.z)[2]/90,A=d(m)*g*S,P=a.properties.get("color").toArray01(),D=a.properties.get("intensity");return(A+d(P)*D)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(!n)return this;if(o.c4(n)){const a=o.c5(n),d=this.fragments.find(({id:g})=>g===a);if(!d)throw new Error(`Style import not found: ${n}`);const m=o.c3(n);return d.style.getFragmentStyle(m)}{const a=this.fragments.find(({id:d})=>d===n);if(!a)throw new Error(`Style import not found: ${n}`);return a.style}}getConfigProperty(n,a){const d=this.getFragmentStyle(n);if(!d)return null;const m=o.ag(a,d.scope),g=d.options.get(m),b=g?g.value||g.default:null;return b?b.serialize():null}setConfigProperty(n,a,d){const m=o.r(d);if(m.result!=="success")return void Wo(this,m.value);const g=m.value.expression,b=this.getFragmentStyle(n);if(!b)return;const S=o.ag(a,b.scope),A=b.options.get(S);A&&(this.options.set(S,{...A,value:g}),this.updateConfigDependencies())}setConfig(n,a){if(this._config=n,n||a)if(a)for(const d in a){let m,g;const b=o.r(a[d].default);if(b.result==="success"&&(m=b.value.expression),n&&n[d]!==void 0){const F=o.r(n[d]);F.result==="success"&&(g=F.value.expression)}const{minValue:S,maxValue:A,stepValue:P,type:D,values:k}=a[d];if(m){const F=o.ag(d,this.scope);this.options.set(F,{default:m,value:g,minValue:S,maxValue:A,stepValue:P,type:D,values:k})}else this.fire(new o.a(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new o.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const n of this._configDependentLayers){const a=this.getLayer(n);a&&(a.possiblyEvaluateVisibility(),this._updateLayer(a))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(n,a,d={}){this._checkLoaded();const m=n.id;if(this._layers[m])return void this.fire(new o.a(new Error(`Layer with id "${m}" already exists on this map`)));let g;if(n.type==="custom"){if(Wo(this,o.c6(n)))return;g=o.c2(n,this.scope,this.options)}else{if(typeof n.source=="object"&&(this.addSource(m,n.source),n=o.c1(n),n=o.e(n,{source:m})),this._validate(he,`layers.${m}`,n,{arrayIndex:-1},d))return;g=o.c2(n,this.scope,this.options),this._validateLayer(g),g.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[g.id]=g.serialize()}g.isConfigDependent&&this._configDependentLayers.add(g.fqid);let b=this._order.length;if(a){const D=this._order.indexOf(a);if(D===-1)return void this.fire(new o.a(new Error(`Layer with id "${a}" does not exist on this map.`)));g.slot===this._layers[a].slot?b=D:o.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,m),this._layerOrderChanged=!0,this._layers[m]=g;const S=this.getOwnLayerSourceCache(g),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&g.canCastShadows()&&A&&(S.castsShadows=!0);const P=this._changes.getRemovedLayer(g);if(P&&g.source&&S&&g.type!=="custom"){this._changes.discardLayerRemoval(g);const D=o.ag(g.source,g.scope);P.type!==g.type?this._changes.updateSourceCache(D,"clear"):(this._changes.updateSourceCache(D,"reload"),S.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),g.scope=this.scope,this.mergeLayers()}moveLayer(n,a){this._checkLoaded();const d=this._checkLayer(n);if(!d||n===a)return;const m=this._order.indexOf(n);this._order.splice(m,1);let g=this._order.length;if(a){const b=this._order.indexOf(a);if(b===-1)return void this.fire(new o.a(new Error(`Layer with id "${a}" does not exist on this map.`)));d.slot===this._layers[a].slot?g=b:o.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(g,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const a=this._checkLayer(n);if(!a)return;a.setEventedParent(null);const d=this._order.indexOf(n);this._order.splice(d,1),delete this._layers[n],delete this._serializedLayers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const m=this.getOwnLayerSourceCache(a);if(m&&m.castsShadows){let g=!1;for(const b in this._layers)if(this._layers[b].source===a.source&&this._layers[b].canCastShadows()){g=!0;break}m.castsShadows=g}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,d){this._checkLoaded();const m=this._checkLayer(n);m&&(m.minzoom===a&&m.maxzoom===d||(a!=null&&(m.minzoom=a),d!=null&&(m.maxzoom=d),this._updateLayer(m)))}setSlot(n,a){this._checkLoaded();const d=this._checkLayer(n);d&&d.slot!==a&&(d.slot=a,this._updateLayer(d))}setFilter(n,a,d={}){this._checkLoaded();const m=this._checkLayer(n);if(m&&!B(m.filter,a))return a==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(ke,`layers.${m.id}.filter`,a,{layerType:m.type},d)||(m.filter=o.c1(a),this._updateLayer(m)))}getFilter(n){const a=this._checkLayer(n);if(a)return o.c1(a.filter)}setLayoutProperty(n,a,d,m={}){this._checkLoaded();const g=this._checkLayer(n);if(g&&!B(g.getLayoutProperty(a),d)){if(d!=null&&(!m||m.validate!==!1)&&Wo(g,nt.call(rr,{key:`layers.${n}.layout.${a}`,layerType:g.type,objectKey:a,value:d,styleSpec:o.D,style:{glyphs:!0,sprite:!0}})))return;g.setLayoutProperty(a,d),g.isConfigDependent&&this._configDependentLayers.add(g.fqid),this._updateLayer(g)}}getLayoutProperty(n,a){const d=this._checkLayer(n);if(d)return d.getLayoutProperty(a)}setPaintProperty(n,a,d,m={}){this._checkLoaded();const g=this._checkLayer(n);if(!g||B(g.getPaintProperty(a),d)||d!=null&&(!m||m.validate!==!1)&&Wo(g,We.call(rr,{key:`layers.${n}.paint.${a}`,layerType:g.type,objectKey:a,value:d,styleSpec:o.D})))return;const b=g.setPaintProperty(a,d);g.isConfigDependent&&this._configDependentLayers.add(g.fqid),b&&this._updateLayer(g),this._changes.updatePaintProperties(g)}getPaintProperty(n,a){const d=this._checkLayer(n);if(d)return d.getPaintProperty(a)}setFeatureState(n,a){this._checkLoaded();const d=n.source,m=n.sourceLayer,g=this._checkSource(d);if(!g)return;const b=g.type;if(b==="geojson"&&m)return void this.fire(new o.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!m)return void this.fire(new o.a(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new o.a(new Error("The feature id parameter must be provided.")));const S=this.getOwnSourceCaches(d);for(const A of S)A.setFeatureState(m,n.id,a)}removeFeatureState(n,a){this._checkLoaded();const d=n.source,m=this._checkSource(d);if(!m)return;const g=m.type,b=g==="vector"?n.sourceLayer:void 0;if(g==="vector"&&!b)return void this.fire(new o.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new o.a(new Error("A feature id is required to remove its specific state property.")));const S=this.getOwnSourceCaches(d);for(const A of S)A.removeFeatureState(b,n.id,a)}getFeatureState(n){this._checkLoaded();const a=n.source,d=n.sourceLayer,m=this._checkSource(a);if(m){if(m.type!=="vector"||d)return n.id===void 0&&this.fire(new o.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(d,n.id);this.fire(new o.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=o.e({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return o.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),a=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return o.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateLayer(n){this._changes.updateLayer(n);const a=this.getLayerSourceCache(n),d=o.ag(n.source,n.scope),m=this._changes.getUpdatedSourceCaches();n.source&&!m[d]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),a.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const a=S=>this._mergedLayers[S].type==="fill-extrusion"||this._mergedLayers[S].type==="model",d=this.order,m={},g=[];for(let S=d.length-1;S>=0;S--){const A=d[S];if(a(A)){m[A]=S;for(const P of n){const D=P[A];if(D)for(const k of D)g.push(k)}}}g.sort((S,A)=>A.intersectionZ-S.intersectionZ);const b=[];for(let S=d.length-1;S>=0;S--){const A=d[S];if(a(A))for(let P=g.length-1;P>=0;P--){const D=g[P].feature;if(m[D.layer.id]<S)break;b.push(D),g.pop()}else for(const P of n){const D=P[A];if(D)for(const k of D)b.push(k.feature)}}return b}queryRenderedFeatures(n,a,d){a&&a.filter&&this._validate(ke,"queryRenderedFeatures.filter",a.filter,null,a),a.scope=this.scope,a.availableImages=this._availableImages,a.serializedLayers=this._serializedLayers;const m={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new o.a(new Error("parameters.layers must be an Array."))),[];for(const P of a.layers){const D=this._mergedLayers[P];if(!D)return this.fire(new o.a(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];m[D.source]=!0}}const g=[],b=a.serializedLayers||{},S=a&&a.layers?a.layers.some(P=>{const D=this.getLayer(P);return D&&D.is3D()}):this.has3DLayers(),A=jn.createFromScreenPoints(n,d);for(const P in this._mergedSourceCaches){const D=this._mergedSourceCaches[P].getSource();if(!D||D.scope!==a.scope)continue;const k=this._mergedSourceCaches[P].getSource().id;a.layers&&!m[k]||g.push(Sd(this._mergedSourceCaches[P],this._mergedLayers,b,A,a,d,S,!!this.map._showQueryGeometry))}return this.placement&&g.push(function(P,D,k,F,N,q,G){const W={},U=q.queryRenderedSymbols(F),X=[];for(const re of Object.keys(U).map(Number))X.push(G[re]);X.sort(hl);for(const re of X){const J=re.featureIndex.lookupSymbolFeatures(U[re.bucketInstanceId],D,re.bucketIndex,re.sourceLayerIndex,N.filter,N.layers,N.availableImages,P);for(const ne in J){const Y=W[ne]=W[ne]||[],se=J[ne];se.sort((ce,de)=>{const ge=re.featureSortOrder;if(ge){const De=ge.indexOf(ce.featureIndex);return ge.indexOf(de.featureIndex)-De}return de.featureIndex-ce.featureIndex});for(const ce of se)Y.push(ce)}}for(const re in W)W[re].forEach(J=>{const ne=J.feature,Y=k(P[re]);if(!Y)return;const se=Y.getFeatureState(ne.layer["source-layer"],ne.id);ne.source=ne.layer.source,ne.layer["source-layer"]&&(ne.sourceLayer=ne.layer["source-layer"]),ne.state=se});return W}(this._mergedLayers,b,this.getLayerSourceCache.bind(this),A.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(n,a){a&&a.filter&&this._validate(ke,"querySourceFeatures.filter",a.filter,null,a);const d=this.getOwnSourceCaches(n);let m=[];for(const g of d)m=m.concat(go(g,a));return m}addSourceType(n,a,d){return Ns.getSourceType(n)?d(new Error(`A source type called "${n}" already exists.`)):(Ns.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,a,d={}){this._checkLoaded();const m=this.light.getLight();let g=!1;for(const S in n)if(!B(n[S],m[S])){g=!0;break}if(!g)return;const b=this._getTransitionParameters();this.light.setLight(n,a,d),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,a=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()&&a!==0||delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let d=n;const m=n.source==null;if(a===1){if(typeof d.source=="object"){const S="terrain-dem-src";this.addSource(S,d.source),d=o.c1(d),d=o.e(d,{source:S})}const g=o.e({},d),b={};if(this.terrain&&m){g.source=this.terrain.get().source;const S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(b.style=S.serialize())}if(this._validate(Z,"terrain",g,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&a!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,a),this.fire(new o.b("data",{dataType:"style"}))}else{const g=this.terrain,b=g.get();for(const S of Object.keys(o.D.terrain))!d.hasOwnProperty(S)&&o.D.terrain[S].default&&(d[S]=o.D.terrain[S].default);for(const S in n)if(!B(n[S],b[S])){g.set(n,this.options),this.stylesheet.terrain=n;const A=this._getTransitionParameters({duration:0});g.updateTransitions(A),this.fire(new o.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const a=this.fog=new Vn(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!B(a.get(),n)){a.set(n,this.options),this.stylesheet.fog=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}}else this._createFog(n);this._markersNeedUpdate=!0}_getTransitionParameters(n){return{now:o.f.now(),transition:o.e(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],a=[];for(const d in this._mergedLayers)this.isLayerDraped(this._mergedLayers[d])?n.push(d):a.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){const d=this.terrain=new Je(n,a,this.scope,this.options);a===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const m=this._getTransitionParameters({duration:0});d.updateTransitions(m)}_force3DLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="symbol"&&this._updateLayer(a)}}_validate(n,a,d,m,g={}){if(g&&g.validate===!1)return!1;const b=o.e({},this.serialize());return Wo(this,n.call(rr,o.e({key:a,style:b,value:d,styleSpec:o.D},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(n){const a=this.getSourceCaches(n);for(const d of a)d.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){const a=this.getSourceCaches(n);for(const d of a)d.resume(),d.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}updateSources(n){let a;this.directionalLight&&(a=qu(this.directionalLight));for(const d in this._mergedSourceCaches)this._mergedSourceCaches[d].update(n,void 0,void 0,a)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,d,m,g=!1){let b=!1,S=!1;const A={},P={};for(const D of this._mergedOrder){const k=this._mergedLayers[D];if(k.type!=="symbol")continue;const F=o.ag(k.source,k.scope);let N=A[F];if(!N){const G=this.getLayerSourceCache(k);if(!G)continue;const W=G.getRenderableIds(!0).map(U=>G.getTileByID(U));P[F]=W.slice(),N=A[F]=W.sort((U,X)=>X.tileID.overscaledZ-U.tileID.overscaledZ||(U.tileID.isLessThan(X.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(k,N,n.center.lng,n.projection);b=b||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),g=g||this._layerOrderChanged||d===0,this._layerOrderChanged&&this.fire(new o.b("neworder")),(g||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.f.now(),n.zoom))&&(this.pauseablePlacement=new ju(n,this._mergedOrder,g,a,d,m,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,A,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.f.now()),S=!0),b&&this.pauseablePlacement.placement.setStale()),S||b){this._buildingIndex.onNewFrame(n.zoom);for(const D of this._mergedOrder){const k=this._mergedLayers[D];k.type==="symbol"&&this.placement.updateLayerOpacities(k,A[o.ag(k.source,k.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.f.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,a){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:g})=>g===n.id)!==-1)return this.fire(new o.a(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!a)return d.push(n),this._loadImports([n],!0),this;const m=d.findIndex(({id:g})=>g===a);return m===-1?this.fire(new o.a(new Error(`Import with id "${a}" does not exist on this map.`))):(this.stylesheet.imports=d.slice(0,m).concat(n).concat(d.slice(m)),this._loadImports([n],!0,a),this)}updateImport(n,a){this._checkLoaded();const d=this.stylesheet.imports||[],m=this.getImportIndex(n);return m===-1?this:typeof a=="string"?(this.setImportUrl(n,a),this):(a.url&&a.url!==d[m].url&&this.setImportUrl(n,a.url),B(a.config,d[m].config)||this.setImportConfig(n,a.config),B(a.data,d[m].data)||this.setImportData(n,a.data),this)}moveImport(n,a){this._checkLoaded();let d=this.stylesheet.imports||[];const m=this.getImportIndex(n);if(m===-1)return this;const g=this.getImportIndex(a);if(g===-1)return this;const b=d[m],S=this.fragments[m];return d=d.filter(({id:A})=>A!==n),this.fragments=this.fragments.filter(({id:A})=>A!==n),this.stylesheet.imports=d.slice(0,g).concat(b).concat(d.slice(g)),this.fragments=this.fragments.slice(0,g).concat(S).concat(this.fragments.slice(g)),this.mergeLayers(),this}setImportUrl(n,a){this._checkLoaded();const d=this.stylesheet.imports||[],m=this.getImportIndex(n);if(m===-1)return this;d[m].url=a;const g=this.fragments[m];return g.style=this._createFragmentStyle(d[m]),g.style.on("style.import.load",()=>this.mergeAll()),g.style.loadURL(a),this}setImportData(n,a){this._checkLoaded();const d=this.getImportIndex(n),m=this.stylesheet.imports||[];return d===-1?this:a?(this.fragments[d].style.setState(a),this._reloadImports(),this):(delete m[d].data,this.setImportUrl(n,m[d].url))}setImportConfig(n,a){this._checkLoaded();const d=this.getImportIndex(n),m=this.stylesheet.imports||[];if(d===-1)return this;a?m[d].config=a:delete m[d].config;const g=this.fragments[d],b=g.style.stylesheet&&g.style.stylesheet.schema;return g.config=a,g.style.setConfig(a,b),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const a=this.stylesheet.imports||[],d=this.getImportIndex(n);return d===-1||(a.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports()),this}getImportIndex(n){const a=(this.stylesheet.imports||[]).findIndex(d=>d.id===n);return a===-1&&this.fire(new o.a(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),a}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const a in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[a];d&&n.push(d.getSource())}return n}getSource(n,a){const d=this.getSourceCache(n,a);return d&&d.getSource()}getLayerSource(n){const a=this.getLayerSourceCache(n);return a&&a.getSource()}getSourceCache(n,a){const d=o.ag(n,a);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(n){const a=o.ag(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(n){const a=[];return this._mergedOtherSourceCaches[n]&&a.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&a.push(this._mergedSymbolSourceCaches[n]),a}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const a in n){const d=n[a];d==="reload"?this.reloadSource(a):d==="clear"&&this.clearSource(a)}}updateLayers(n){const a=this._changes.getUpdatedPaintProperties();for(const d of a){const m=this.getLayer(d);m&&m.updateTransitions(n)}}getImages(n,a,d){this.imageManager.getImages(a.icons,a.scope,d),this._updateTilesForChangedImages();const m=g=>{g&&g.setDependencies(a.tileID.key,a.type,a.icons)};m(this._otherSourceCaches[a.source]),m(this._symbolSourceCaches[a.source])}getGlyphs(n,a,d){this.glyphManager.getGlyphs(a.stacks,a.scope,d)}getResource(n,a,d){return o.c9(a,d)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){const a=this.getOwnSourceCaches(n);return a.length===0?(this.fire(new o.a(new Error(`There is no source with ID '${n}'`))),!1):a.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ns.getSourceType=function(h){return _o[h]},Ns.setSourceType=function(h,n){_o[h]=n},Ns.registerForPluginStateChange=o.bV;var Wu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Yu=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,Zu=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Xu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Wd=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Yd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Em=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,vl=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,xl=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);
#ifdef DATA_FORMAT_UINT32
vec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;
#else
vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));
#endif
return velocity/max(u_max_speed,length(velocity));}
#endif`,Zd=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Dc=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const bl=[];Yo(Wu,bl),Yo(Zu,bl),Yo(Yu,bl);const _s={"_prelude_fog.vertex.glsl":Yd,"_prelude_terrain.vertex.glsl":Wd,"_prelude_shadow.vertex.glsl":Zd,"_prelude_fog.fragment.glsl":Em,"_prelude_shadow.fragment.glsl":Dc,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":vl,"_prelude_raster_particle.glsl":xl},wl={};an("",Wd),an(Em,Yd),an(Dc,Zd),an(vl,""),an(xl,"");const Xd=an(Yu,Zu),Ku=Wu;var Kd={background:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:an("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:an(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:an(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:an("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:an("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:an("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:an(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:an(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:an(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:an(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
vec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:an("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`precision highp float;
#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}`),rasterParticleTexture:an("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:an("void main() {}",`#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);
#ifdef DATA_FORMAT_UINT32
vec2 dp=vec2(0);
#else
vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;
#endif
vec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(
vec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)
);}`),symbolIcon:an(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:an(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:an(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:an("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:an(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Xu),skyboxGradient:an(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Xu),skyboxCapture:an(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:an(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:an(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:an(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Yo(h,n){const a=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of a)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=d.split(" ");for(const g of m)n.includes(g)||n.push(g)}}function an(h,n){const a=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let m=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);m&&(m=m.map(P=>{const D=P.split(" ");return D[D.length-1]}),m=[...new Set(m)]);const g={},b=[],S=[];if(h=h.replace(a,(P,D)=>(S.push(D),"")),(n=n.replace(a,(P,D)=>(b.push(D),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...bl];Yo(h,A),Yo(n,A);for(const P of[...b,...S])_s[P]||console.error(`Undefined include: ${P}`),wl[P]||(wl[P]=[],Yo(_s[P],wl[P])),A=[...A,...wl[P]];return{fragmentSource:h=h.replace(d,(P,D,k,F,N)=>(g[N]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${k} ${F} ${N};
#else
uniform ${k} ${F} u_${N};
#endif
`:D==="initialize"?`
#ifdef HAS_UNIFORM_u_${N}
    ${k} ${F} ${N} = u_${N};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${k} ${F} ${N};
#endif
`:D==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(d,(P,D,k,F,N)=>{const q=F==="float"?"vec2":F,G=N.match(/color/)?"color":q;return D==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${N}
in ${k} ${F} a_${N};
#endif
`:g[N]?D==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${k} ${q} a_${N};
out ${k} ${F} ${N};
#else
uniform ${k} ${F} u_${N};
#endif
`:D==="initialize"?G==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${k} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${G}(a_${N}, u_${N}_t);
#else
    ${k} ${F} ${N} = u_${N};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${k} ${F} a_${N};
    out ${k} ${F} ${N};
#endif
`:D==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${N} = a_${N};
#endif
`:void 0:D==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${k} ${q} a_${N};
#else
uniform ${k} ${F} u_${N};
#endif
`:D==="define-instanced"?G==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${N}0;
in vec4 a_${N}1;
in vec4 a_${N}2;
in vec4 a_${N}3;
#else
uniform ${k} ${F} u_${N};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${q} a_${N};
#else
uniform ${k} ${F} u_${N};
#endif
`:D==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${k} ${F} ${N} = a_${N};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${k} ${F} ${N} = a_${N};
#else
    ${k} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${k} ${F} ${N} = unpack_mix_${G}(a_${N}, u_${N}_t);
#else
    ${k} ${F} ${N} = u_${N};
#endif
`}),staticAttributes:m,usedDefines:A,vertexIncludes:b,fragmentIncludes:S}}class Jd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,d,m,g,b,S,A){this.context=n;let P=this.boundPaintVertexBuffers.length!==m.length;for(let k=0;!P&&k<m.length;k++)this.boundPaintVertexBuffers[k]!==m[k]&&(P=!0);let D=this.boundDynamicVertexBuffers.length!==S.length;for(let k=0;!D&&k<S.length;k++)this.boundDynamicVertexBuffers[k]!==S[k]&&(D=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==d||P||D||this.boundIndexBuffer!==g||this.boundVertexOffset!==b)this.freshBind(a,d,m,g,b,S,A);else{n.bindVertexArrayOES.set(this.vao);for(const k of S)k&&(k.bind(),A&&k.instanceCount&&k.setVertexAttribDivisor(n.gl,a,A));g&&g.dynamicDraw&&g.bind()}}freshBind(n,a,d,m,g,b,S){const A=n.numAttributes,P=this.context,D=P.gl;this.vao&&this.destroy(),this.vao=P.gl.createVertexArray(),P.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=b,a.enableAttributes(D,n),a.bind(),a.setVertexAttribPointers(D,n,g);for(const k of d)k.enableAttributes(D,n),k.bind(),k.setVertexAttribPointers(D,n,g);for(const k of b)k&&(k.enableAttributes(D,n),k.bind(),k.setVertexAttribPointers(D,n,g),S&&k.instanceCount&&k.setVertexAttribDivisor(D,n,S));m&&m.bind(),P.currentNumAttributes=A}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Gy(h,n){const a=Math.pow(2,n.canonical.z),d=n.canonical.y;return[new o.L(0,d/a).toLngLat().lat,new o.L(0,(d+1)/a).toLngLat().lat]}function Ju(h,n,a,d,m,g,b){const S=h.context,A=S.gl,P=a.hillshadeFBO;if(!P)return;h.prepareDrawTile();const D=h.isTileAffectedByFog(n),k=h.getOrCreateProgram("hillshade",{overrideFog:D});S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,P.colorAttachment.get());const F=((W,U,X,re)=>{const J=X.paint.get("hillshade-shadow-color"),ne=X.paint.get("hillshade-highlight-color"),Y=X.paint.get("hillshade-accent-color"),se=X.paint.get("hillshade-emissive-strength");let ce=o.bj(X.paint.get("hillshade-illumination-direction"));if(X.paint.get("hillshade-illumination-anchor")==="viewport")ce-=W.transform.angle;else if(W.style&&W.style.enable3dLights()&&W.style.directionalLight){const ge=W.style.directionalLight.properties.get("direction"),De=o.bQ(ge.x,ge.y,ge.z);ce=o.bj(De[1])}const de=!W.options.moving;return{u_matrix:re||W.transform.calculateProjMatrix(U.tileID.toUnwrapped(),de),u_image:0,u_latrange:Gy(0,U.tileID),u_light:[X.paint.get("hillshade-exaggeration"),ce],u_shadow:J,u_highlight:ne,u_emissive_strength:se,u_accent:Y}})(h,a,d,h.terrain?n.projMatrix:null);h.uploadCommonUniforms(S,k,n.toUnwrapped());const{tileBoundsBuffer:N,tileBoundsIndexBuffer:q,tileBoundsSegments:G}=h.getTileBoundsBuffers(a);k.draw(h,A.TRIANGLES,m,g,b,mr.disabled,F,d.id,N,q,G)}function Am(h,n,a){if(!n.needsDEMTextureUpload)return;const d=h.context,m=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||h.getTileTexture(a.stride);const g=a.getPixels();n.demTexture?n.demTexture.update(g,{premultiply:!1}):n.demTexture=new o.T(d,g,m.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Qd(h,n,a){const d=h.context,m=d.gl;if(!n.dem)return;const g=n.dem;if(d.activeTexture.set(m.TEXTURE1),Am(h,n,g),!n.demTexture)return;n.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);const b=g.dim;d.activeTexture.set(m.TEXTURE0);let S=n.hillshadeFBO;if(!S){const F=new o.T(d,{width:b,height:b,data:null},m.RGBA);F.bind(m.LINEAR,m.CLAMP_TO_EDGE),S=n.hillshadeFBO=d.createFramebuffer(b,b,!0,"renderbuffer"),S.colorAttachment.set(F.texture)}d.bindFramebuffer.set(S.framebuffer),d.viewport.set([0,0,b,b]);const{tileBoundsBuffer:A,tileBoundsIndexBuffer:P,tileBoundsSegments:D}=h.getMercatorTileBoundsBuffers(),k=[];h.linearFloatFilteringSupported()&&k.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:k}).draw(h,m.TRIANGLES,pr.disabled,Er.disabled,jr.unblended,mr.disabled,((F,N)=>{const q=N.stride,G=o.a6.create();return o.a6.ortho(G,0,o.V,-o.V,0,0,1),o.a6.translate(G,G,[0,-o.V,0]),{u_matrix:G,u_image:1,u_dimension:[q,q],u_zoom:F.overscaledZ}})(n.tileID,g),a.id,A,P,D),n.needsHillshadePrepare=!1}const Im=h=>({u_matrix:new o.bK(h),u_image0:new o.bO(h),u_skirt_height:new o.bN(h),u_ground_shadow_factor:new o.bM(h)}),Qu=(h,n,a)=>({u_matrix:h,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:a}),Cm=(h,n,a,d,m,g,b,S,A,P,D,k,F,N,q,G)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:a,u_zoom_transition:m,u_merc_center:g,u_image0:0,u_frustum_tl:b,u_frustum_tr:S,u_frustum_br:A,u_frustum_bl:P,u_globe_pos:D,u_globe_radius:k,u_viewport:F,u_grid_matrix:G?Float32Array.from(G):new Float32Array(9),u_skirt_height:N,u_far_z_cutoff:q});function Lc(h,n){return h!=null&&n!=null&&!(!h.hasData()||!n.hasData())&&h.demTexture!=null&&n.demTexture!=null&&h.tileID.key!==n.tileID.key}const Tl=new class{constructor(){this.operations={}}newMorphing(h,n,a,d,m){if(h in this.operations){const g=this.operations[h];g.to.tileID.key!==a.tileID.key&&(g.queued=a)}else this.operations[h]={startTime:d,phase:0,duration:m,from:n,to:a,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const n=this.operations[h];return{from:n.from,to:n.to,phase:n.phase}}update(h){for(const n in this.operations){const a=this.operations[n];for(a.phase=(h-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,h)){delete this.operations[n];break}}}_nextOp(h,n){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=n,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},ef={0:null,1:"TERRAIN_VERTEX_MORPHING"};function tf(h,n,a){if(n===0)return 0;const d=n<1&&a===514?.25/n:1;return 6*Math.pow(1.5,22-h)*Math.max(n,1)*d}function Sl(h,n){const a=1<<h.z;return!n&&(h.x===0||h.x===a-1)||h.y===0||h.y===a-1}const rf=h=>({u_matrix:h});function nf(h,n,a,d,m){if(m>0){const g=o.f.now(),b=(g-h.timeAdded)/m,S=n?(g-n.timeAdded)/m:-1,A=a.getSource(),P=d.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),D=!n||Math.abs(n.tileID.overscaledZ-P)>Math.abs(h.tileID.overscaledZ-P),k=D&&h.refreshedUponExpiration?1:o.aa(D?b:1-S,0,1);return h.refreshedUponExpiration&&b>=1&&(h.refreshedUponExpiration=!1),n?{opacity:1,mix:1-k}:{opacity:k,mix:0}}return{opacity:1,mix:0}}class Hy extends Fs{constructor(n){const a={type:"raster-dem",maxzoom:n.transform.maxZoom},d=new o.bW(o.bX(),null),m=gi("mock-dem",a,d,n.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class qy extends Fs{constructor(n){const a=gi("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new o.bW(o.bX(),null),n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,d){if(n.freezeTileCoverage)return;this.transform=n;const m=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,b)=>{if(g[b.key]="",!this._tiles[b.key]){const S=new Vo(b,this._source.tileSize*b.overscaleFactor(),n.tileZoom);S.state="loaded",this._tiles[b.key]=S}return g},{});for(const g in this._tiles)g in m||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(n){const a=this.proxyCachedFBO[n];if(a!==void 0){const d=Object.values(a);this.renderCachePool.push(...d),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Pm extends o.am{constructor(n,a,d){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=d}}class Wy extends o.ck{constructor(n,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,m,g]=function(A){const P=new o.aN,D=new o.aw,k=131;P.reserve(17161),D.reserve(33800);const F=o.V/128,N=o.V+F/2,q=N+F;for(let W=-F;W<q;W+=F)for(let U=-F;U<q;U+=F){const X=U<0||U>N||W<0||W>N?24575:0,re=o.aa(Math.round(U),0,o.V),J=o.aa(Math.round(W),0,o.V);P.emplaceBack(re+X,J)}const G=(W,U)=>{const X=U*k+W;D.emplaceBack(X+1,X,X+k),D.emplaceBack(X+k,X+k+1,X+1)};for(let W=1;W<129;W++)for(let U=1;U<129;U++)G(U,W);return[0,129].forEach(W=>{for(let U=0;U<130;U++)G(U,W),G(W,U)}),[P,D,32768]}(),b=n.context;this.gridBuffer=b.createVertexBuffer(d,o.aP.members),this.gridIndexBuffer=b.createIndexBuffer(m),this.gridSegments=o.aB.simpleSegment(0,0,d.length,m.length),this.gridNoSkirtSegments=o.aB.simpleSegment(0,0,d.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new qy(a.map),this.orthoMatrix=o.a6.create(),o.a6.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.V,0,o.V,0,1);const S=b.gl;this._overlapStencilMode=new Er({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Hy(a.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,a,d){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const m=n.terrain.properties,g=n.terrain.drapeRenderMode===0,b=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.f.now();const S=n.terrain&&n.terrain.scope,A=m.get("source"),P=g?this._mockSourceCache:n.getSourceCache(A,S);if(!P)return void o.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=P,this._exaggeration=b?this.calculateExaggeration(a):m.get("exaggeration"),!a.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;const D=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const k=this.getScaledDemTileSize();this.sourceCache.update(a,k,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),a.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(n){const a=this._previousCameraAltitude,d=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=d;const m=a!=null?d-a:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;const g=n.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(g);let S=g-this._previousZoom;const A=this._previousUpdateTimestamp;let P=g;this._evaluationZoom!=null&&(P=this._evaluationZoom,Math.abs(g-P)>.5&&(S=.5*(g-P+S)),S*m<0&&(P+=S)),this._evaluationZoom=P;const D=b.getExaggeration(P),k=D===b.getExaggeration(Math.max(0,P-.1));if(k&&Math.abs(D-this._exaggeration)<.01)return D;let F=Math.min(.1,.00375*(this._updateTimestamp-A));return(k||D<.1||Math.abs(S)<1e-4)&&(F=Math.min(.2,4*F)),o.U(this._exaggeration,D,F)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(o.L.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=a.getIds().map(A=>{const P=a.getTileByID(A).tileID;return P.projMatrix=d.calculateProjMatrix(P.toUnwrapped()),P});(function(A,P){const D=P.transform.pointCoordinate(P.transform.getCameraPoint()),k=new o.P(D.x,D.y);A.sort((F,N)=>{if(N.overscaledZ-F.overscaledZ)return N.overscaledZ-F.overscaledZ;const q=new o.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),G=new o.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),W=k.mult(1<<F.canonical.z);return W.x-=.5,W.y-=.5,W.distSqr(q)-W.distSqr(G)})})(m,this.painter);const g=this.proxyToSource||{};this.proxyToSource={},m.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const b=this._style._mergedSourceCaches;for(const A in b){const P=b[A];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,n[A],g),P.usedForTerrain))continue;const D=n[A];P.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[a.id]=m.map(A=>new Pm(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1;const S={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const P=this.terrainTileForTile[A.key];if(!P)continue;const D=P.tileID.key;D in S||(this._visibleDemTiles.push(P),S[D]=D)}}_assignTerrainTiles(n){this._initializing||n.forEach(a=>{if(this.terrainTileForTile[a.key])return;const d=this._findTileCoveringTileID(a,this.sourceCache);d&&(this.terrainTileForTile[a.key]=d)})}_prepareDEMTextures(){const n=this.painter.context,a=n.gl;for(const d in this.terrainTileForTile){const m=this.terrainTileForTile[d],g=m.dem;!g||m.demTexture&&!m.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),Am(this.painter,m,g))}}_prepareDemTileUniforms(n,a,d,m){if(!a||a.demTexture==null)return!1;const g=n.tileID.canonical,b=Math.pow(2,a.tileID.canonical.z-g.z),S=m||"";return d[`u_dem_tl${S}`]=[g.x*b%1,g.y*b%1],d[`u_dem_scale${S}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,a=n.gl;if(!this._emptyDepthBufferTexture){const d=new o.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.T(n,d,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const a=this._visibleDemTiles.reduce((d,m)=>{if(!m.dem)return d;const g=m.dem.tree.minimums[0];return g>0&&n++,d+g},0);return n?a/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);const d=this._getLoadedAreaMinimum(),[m,g]=(()=>{const S=new o.cm({width:1,height:1},new Float32Array([d]));return[a.R32F,S]})();this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(g,{premultiply:!1}):b=this._emptyDEMTexture=new o.T(n,g,m,{premultiply:!1}),b}setupElevationDraw(n,a,d){const m=this.painter.context,g=m.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};b.u_exaggeration=this.exaggeration();let S=null,A=null,P=1;if(d&&d.morphing&&this._useVertexMorphing){const F=d.morphing.srcDemTile,N=d.morphing.dstDemTile;P=d.morphing.phase,F&&N&&(this._prepareDemTileUniforms(n,F,b,"_prev")&&(A=F),this._prepareDemTileUniforms(n,N,b)&&(S=N))}const D=F=>F&&F.demTexture&&this.painter.linearFloatFilteringSupported()?g.LINEAR:g.NEAREST,k=F=>{b.u_dem_size=F.size[0]===1?1:F.size[0]-2};if(A&&S)m.activeTexture.set(g.TEXTURE2),S.demTexture.bind(D(S),g.CLAMP_TO_EDGE),m.activeTexture.set(g.TEXTURE4),A.demTexture.bind(D(A),g.CLAMP_TO_EDGE),S.demTexture&&k(S.demTexture),b.u_dem_lerp=P;else{S=this.terrainTileForTile[n.tileID.key],m.activeTexture.set(g.TEXTURE2);const F=this._prepareDemTileUniforms(n,S,b)?S.demTexture:this.emptyDEMTexture;F.bind(D(S),g.CLAMP_TO_EDGE),k(F)}if(m.activeTexture.set(g.TEXTURE3),d&&d.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),this._depthFBO&&(b.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),b.u_depth_size_inv=[1,1]),d&&d.useMeterToDem&&S){const F=(1<<S.tileID.canonical.z)*o.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=F}if(d&&d.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),a.setTerrainUniformValues(m,b),this.painter.transform.projection.name==="globe"){const F=this.globeUniformValues(this.painter.transform,n.tileID.canonical,d&&d.useDenormalizedUpVectorScale);a.setGlobeUniformValues(m,F)}}globeUniformValues(n,a,d){const m=n.projection;return{u_tile_tl_up:m.upVector(a,0,0),u_tile_tr_up:m.upVector(a,o.V,0),u_tile_br_up:m.upVector(a,o.V,o.V),u_tile_bl_up:m.upVector(a,0,o.V),u_tile_up_scale:d?o.cl(1):m.upVectorScale(a,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const a=this.painter,d=this.painter.context;n.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,g,b,S,A){if(m.transform.projection.name==="globe")(function(P,D,k,F,N){const q=P.context,G=q.gl;let W,U;const X=P.transform,re=o.cd(P,q,X),J=(Ne,Fe)=>{if(U===Fe)return;const tt=[ef[Fe],"PROJECTION_GLOBE_VIEW"];re&&tt.push("CUSTOM_ANTIALIASING");const be=P.isTileAffectedByFog(Ne);W=P.getOrCreateProgram("globeRaster",{defines:tt,overrideFog:be}),U=Fe},ne=P.colorModeForRenderPass(),Y=new pr(G.LEQUAL,pr.ReadWrite,P.depthRangeFor3D);Tl.update(N);const se=o.ce(X),ce=[o.a5(X.center.lng),o.ae(X.center.lat)],de=P.globeSharedBuffers,ge=[X.width*o.f.devicePixelRatio,X.height*o.f.devicePixelRatio],De=Float32Array.from(X.globeMatrix),xe={useDenormalizedUpVectorScale:!0};{const Ne=P.transform,Fe=tf(Ne.zoom,D.exaggeration(),D.sourceCache._source.tileSize);U=-1;const tt=G.TRIANGLES;for(const be of F){const Oe=k.getTile(be),me=Er.disabled,Ae=D.prevTerrainTileForTile[be.key],st=D.terrainTileForTile[be.key];Lc(Ae,st)&&Tl.newMorphing(be.key,Ae,st,N,250),q.activeTexture.set(G.TEXTURE0),Oe.texture&&Oe.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const xt=Tl.getMorphValuesForProxy(be.key),_t=xt?1:0;xt&&o.j(xe,{morphing:{srcDemTile:xt.from,dstDemTile:xt.to,phase:o.cc(xt.phase)}});const Dt=o.cf(be.canonical),Qt=o.cg(Dt.getCenter().lat),cr=o.ch(be.canonical,Dt,Qt,Ne.worldSize/Ne._pixelsPerMercatorPixel),sr=o.aT(o.ci(be.canonical)),ar=Cm(Ne.expandedFarZProjMatrix,De,se,sr,o.S(Ne.zoom),ce,Ne.frustumCorners.TL,Ne.frustumCorners.TR,Ne.frustumCorners.BR,Ne.frustumCorners.BL,Ne.globeCenterInViewSpace,Ne.globeRadius,ge,Fe,Ne._farZ,cr);if(J(be,_t),W&&(D.setupElevationDraw(Oe,W,xe),P.uploadCommonUniforms(q,W,be.toUnwrapped()),de)){const[kr,Mr,Cr]=de.getGridBuffers(Qt,Fe!==0);W.draw(P,tt,Y,me,ne,mr.backCCW,ar,"globe_raster",kr,Mr,Cr)}}}if(de&&(P.renderDefaultNorthPole||P.renderDefaultSouthPole)){const Ne=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&Ne.push("CUSTOM_ANTIALIASING"),W=P.getOrCreateProgram("globeRaster",{defines:Ne});for(const Fe of F){const{x:tt,y:be,z:Oe}=Fe.canonical,me=be===0,Ae=be===(1<<Oe)-1,[st,xt,_t,Dt]=de.getPoleBuffers(Oe,!1);if(Dt&&(me||Ae)){const Qt=k.getTile(Fe);q.activeTexture.set(G.TEXTURE0),Qt.texture&&Qt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let cr=o.cj(Oe,tt,X);const sr=o.aT(o.ci(Fe.canonical)),ar=(kr,Mr)=>kr.draw(P,G.TRIANGLES,Y,Er.disabled,ne,mr.disabled,Cm(X.expandedFarZProjMatrix,cr,cr,sr,0,ce,X.frustumCorners.TL,X.frustumCorners.TR,X.frustumCorners.BR,X.frustumCorners.BL,X.globeCenterInViewSpace,X.globeRadius,ge,0,X._farZ),"globe_pole_raster",Mr,_t,Dt);D.setupElevationDraw(Qt,W,xe),P.uploadCommonUniforms(q,W,Fe.toUnwrapped()),me&&P.renderDefaultNorthPole&&ar(W,st),Ae&&P.renderDefaultSouthPole&&(cr=o.a6.scale(o.a6.create(),cr,[1,-1,1]),ar(W,xt))}}}})(m,g,b,S,A);else{const P=m.context,D=P.gl;let k,F;const N=m.shadowRenderer,q=qo(m,m.longestCutoffRange),G=ne=>{if(F===ne)return;const Y=[];Y.push(ef[ne]),q.shouldRenderCutoff&&Y.push("RENDER_CUTOFF"),k=m.getOrCreateProgram("terrainRaster",{defines:Y}),F=ne},W=m.colorModeForRenderPass(),U=new pr(D.LEQUAL,pr.ReadWrite,m.depthRangeFor3D);Tl.update(A);const X=m.transform,re=tf(X.zoom,g.exaggeration(),g.sourceCache._source.tileSize);let J=[0,0,0];if(N){const ne=m.style.directionalLight,Y=m.style.ambientLight;ne&&Y&&(J=Pc(ne,Y))}{F=-1;const ne=D.TRIANGLES,[Y,se]=[g.gridIndexBuffer,g.gridSegments];for(const ce of S){const de=b.getTile(ce),ge=Er.disabled,De=g.prevTerrainTileForTile[ce.key],xe=g.terrainTileForTile[ce.key];Lc(De,xe)&&Tl.newMorphing(ce.key,De,xe,A,250),P.activeTexture.set(D.TEXTURE0),de.texture&&de.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const Ne=Tl.getMorphValuesForProxy(ce.key),Fe=Ne?1:0;let tt;Ne&&(tt={morphing:{srcDemTile:Ne.from,dstDemTile:Ne.to,phase:o.cc(Ne.phase)}});const be=Qu(ce.projMatrix,Sl(ce.canonical,X.renderWorldCopies)?re/10:re,J);if(G(Fe),!k)continue;g.setupElevationDraw(de,k,tt);const Oe=ce.toUnwrapped();N&&N.setupShadows(Oe,k),m.uploadCommonUniforms(P,k,Oe,null,q),k.draw(m,ne,U,ge,W,mr.backCCW,be,"terrain_raster",g.gridBuffer,Y,se)}}}}(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const a=this.painter,d=this.painter.context,m=this.proxySourceCache,g=this.proxiedCoords[m.id],b=this._drapedRenderBatches.shift(),S=a.style.order,A=[];let P=0;for(const D of g){const k=m.getTileByID(D.proxyTileKey),F=m.proxyCachedFBO[D.key]?m.proxyCachedFBO[D.key][n]:void 0,N=F!==void 0?m.renderCache[F]:this.pool[P++],q=F!==void 0;if(k.texture=N.tex,q&&!N.dirty){A.push(k.tileID);continue}let G;d.bindFramebuffer.set(N.fb.framebuffer),this.renderedToTile=!1,N.dirty&&(d.clear({color:o.ax.transparent,stencil:0}),N.dirty=!1);for(let W=b.start;W<=b.end;++W){const U=a.style._mergedLayers[S[W]];if(U.isHidden(a.transform.zoom))continue;const X=a.style.getLayerSourceCache(U),re=X?this.proxyToSource[D.key][X.id]:[D];if(!re)continue;const J=re;d.viewport.set([0,0,N.fb.width,N.fb.height]),G!==(X?X.id:null)&&(this._setupStencil(N,re,U,X),G=X?X.id:null),a.renderLayer(a,X,U,J)}if(this._drapedRenderBatches.length===0)for(const W of this._pendingGroundEffectLayers){const U=a.style._mergedLayers[S[W]];if(U.isHidden(a.transform.zoom))continue;const X=a.style.getLayerSourceCache(U),re=X?this.proxyToSource[D.key][X.id]:[D];if(!re)continue;const J=re;d.viewport.set([0,0,N.fb.width,N.fb.height]),G!==(X?X.id:null)&&(this._setupStencil(N,re,U,X),G=X?X.id:null),a.renderLayer(a,X,U,J)}this.renderedToTile?(N.dirty=!0,A.push(k.tileID)):q||--P,P===5&&(P=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),b.end+1}postRender(){}isLayerOrderingCorrect(n){const a=n.order.length;let d=-1,m=a;for(let g=0;g<a;++g)this._style.isLayerDraped(n._mergedLayers[n.order[g]])?d=Math.max(d,g):m=Math.min(m,g);return m>d}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{n=Math.min(n,a.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,a,d){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(g=>g.dem).map(g=>{const b=g.tileID,S=1<<b.overscaledZ,{x:A,y:P}=b.canonical,D=A/S,k=(A+1)/S,F=P/S,N=(P+1)/S;return{minx:D,miny:F,maxx:k,maxy:N,t:g.dem.tree.raycastRoot(D,F,k,N,n,a,d),tile:g}});m.sort((g,b)=>(g.t!==null?g.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const g of m){if(g.t==null)return null;const b=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,n,a,d);if(b!=null)return b}return null}_createFBO(){const n=this.painter.context,a=n.gl,d=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);const m=new o.T(n,{width:d[0],height:d[1],data:null},a.RGBA);m.bind(a.LINEAR,a.CLAMP_TO_EDGE);const g=n.createFramebuffer(d[0],d[1],!0,null);return g.colorAttachment.set(m.texture),g.depthAttachment=new is(n,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:g,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const a=this._style._mergedLayers[n],d=a.isHidden(this.painter.transform.zoom);return a.type==="custom"?!d&&a.shouldRedrape():!d&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const d of this._style.getSources())if(d instanceof Lt){n=!0;break}if(!n)return;const a={};for(let d=0;d<this._style.order.length;++d){const m=this._style._mergedLayers[this._style.order[d]],g=this._style.getLayerSourceCache(m);if(g&&!a[g.id]&&!m.isHidden(this.painter.transform.zoom)&&m.type==="line"&&m.widthExpression()instanceof o.Z){a[g.id]=!0;for(const b of this.proxyCoords){const S=this.proxyToSource[b.key][g.id];if(S)for(const A of S)this._clearRenderCacheForTile(g.id,A)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof Rt){n=!0;break}if(!n)return;const a={};for(let d=0;d<this._style.order.length;++d){const m=this._style._mergedLayers[this._style.order[d]],g=this._style.getLayerSourceCache(m);if(!g||a[g.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="raster")continue;const b=m.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const A=this.proxyToSource[S.key][g.id];if(A)for(const P of A){const D=nf(g.getTile(P),g.findLoadedParent(P,0),g,this.painter.transform,b);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(g.id,P)}}}}_setupDrapedRenderBatches(){const n=this._style.order,a=n.length;if(a===0)return;const d=[];this._pendingGroundEffectLayers=[];let m,g=0,b=this._style._mergedLayers[n[g]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++g<a;)b=this._style._mergedLayers[n[g]];for(;g<a;++g){const S=this._style._mergedLayers[n[g]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?m===void 0&&(m=g):(S.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(g),m!==void 0&&(d.push({start:m,end:g-1}),m=void 0)))}if(m!==void 0&&d.push({start:m,end:g-1}),d.length!==0){const S=d[d.length-1];this._pendingGroundEffectLayers.every(A=>A>S.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(n){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const b=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let S=0;S<b.length;++S){const A=Object.values(b[S]);a.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,m=this._tilesDirty;for(let b=d.length-1;b>=0;b--){const S=d[b];if(a.getTileByID(S.key),a.proxyCachedFBO[S.key]!==void 0){const A=n[S.key],P=this.proxyToSource[S.key];let D=0;for(const k in P){const F=P[k],N=A[k];if(!N||N.length!==F.length||F.some((q,G)=>q!==N[G]||m[k]&&m[k].hasOwnProperty(q.key))){D=-1;break}++D}for(const k in a.proxyCachedFBO[S.key])a.renderCache[a.proxyCachedFBO[S.key][k]].dirty=D<0||D!==Object.values(A).length}}const g=[...this._drapedRenderBatches];g.sort((b,S)=>S.end-S.start-(b.end-b.start));for(const b of g)for(const S of d){if(a.proxyCachedFBO[S.key])continue;let A=a.renderCachePool.pop();A===void 0&&a.renderCache.length<50&&(A=a.renderCache.length,a.renderCache.push(this._createFBO())),A!==void 0&&(a.proxyCachedFBO[S.key]={},a.proxyCachedFBO[S.key][b.start]=A,a.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,d,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,b=g.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let S;if(d.isTileClipped())S=a.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):Er.disabled}_renderTileClippingMasks(n,a){const d=this.painter,m=this.painter.context,g=m.gl;d._tileClippingMaskIDs={},m.setColorMode(jr.disabled),m.setDepthMode(pr.disabled);const b=d.getOrCreateProgram("clippingMask");for(const S of n){const A=d._tileClippingMaskIDs[S.key]=--a;b.draw(d,g.TRIANGLES,pr.disabled,new Er({func:g.ALWAYS,mask:0},A,255,g.KEEP,g.KEEP,g.REPLACE),jr.disabled,mr.disabled,rf(S.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(n){const a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;const d=[n.x,n.y,1,1];o.a7.transformMat4(d,d,a.pixelMatrixInverse),o.a7.scale(d,d,1/d[3]),d[0]/=a.worldSize,d[1]/=a.worldSize;const m=a._camera.position,g=o.bl(1,a.center.lat),b=[m[0],m[1],m[2]/g,0],S=o.N.subtract([],d.slice(0,3),b);o.N.normalize(S,S);const A=this.raycast(b,S,this._exaggeration);return A!==null&&A?(o.N.scaleAndAdd(b,b,S,A),b[3]=b[2],b[2]*=g,b):null}drawDepth(){const n=this.painter,a=n.context,d=this.proxySourceCache,m=Math.ceil(n.width),g=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===g||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const b=a.gl,S=a.createFramebuffer(m,g,!0,"renderbuffer");a.activeTexture.set(b.TEXTURE0);const A=new o.T(a,{width:m,height:g,data:null},b.RGBA);A.bind(b.NEAREST,b.CLAMP_TO_EDGE),S.colorAttachment.set(A.texture);const P=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,m,g);S.depthAttachment.set(P),this._depthFBO=S,this._depthTexture=A}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,m,g]),function(b,S,A,P){if(b.transform.projection.name==="globe")return;const D=b.context,k=D.gl;D.clear({depth:1});const F=b.getOrCreateProgram("terrainDepth"),N=new pr(k.LESS,pr.ReadWrite,b.depthRangeFor3D);for(const q of P){const G=A.getTile(q),W=Qu(q.projMatrix,0,[0,0,0]);S.setupElevationDraw(G,F),F.draw(b,k.TRIANGLES,N,Er.disabled,jr.unblended,mr.backCCW,W,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(n,this,d,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,a,d){if(n.getSource()instanceof o.ap)return this._setupProxiedCoordsForImageSource(n,a,d);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const m=this.proxiedCoords[n.id]=[],g=this.proxyCoords;for(let A=0;A<g.length;A++){const P=g[A],D=this._findTileCoveringTileID(P,n);if(D){const k=this._createProxiedId(P,D,d[P.key]&&d[P.key][n.id]);m.push(k),this.proxyToSource[P.key][n.id]=[k]}}let b=!1;const S=new Set;for(let A=0;A<a.length;A++){const P=n.getTile(a[A]);if(!P||!P.hasData())continue;const D=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==P.tileID.canonical.z){const k=this.proxyToSource[D.tileID.key][n.id],F=this._createProxiedId(D.tileID,P,d[D.tileID.key]&&d[D.tileID.key][n.id]);k?k.splice(k.length-1,0,F):this.proxyToSource[D.tileID.key][n.id]=[F];const N=this.proxyToSource[D.tileID.key][n.id];S.has(N)||S.add(N),m.push(F),b=!0}}if(this._sourceTilesOverlap[n.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(const A of S)A.sort((P,D)=>D.overscaledZ-P.overscaledZ)}_setupProxiedCoordsForImageSource(n,a,d){if(!n.getSource().loaded())return;const m=this.proxiedCoords[n.id]=[],g=this.proxyCoords,b=n.getSource(),S=b.tileID;if(!S)return;const A=new o.P(S.x,S.y)._div(1<<S.z),P=b.coordinates.map(o.L.fromLngLat).reduce((k,F)=>(k.min.x=Math.min(k.min.x,F.x-A.x),k.min.y=Math.min(k.min.y,F.y-A.y),k.max.x=Math.max(k.max.x,F.x-A.x),k.max.y=Math.max(k.max.y,F.y-A.y),k),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(k,F)=>{const N=k.wrap+k.canonical.x/(1<<k.canonical.z),q=k.canonical.y/(1<<k.canonical.z),G=o.V/(1<<k.canonical.z),W=F.wrap+F.canonical.x/(1<<F.canonical.z),U=F.canonical.y/(1<<F.canonical.z);return N+G<W+P.min.x||N>W+P.max.x||q+G<U+P.min.y||q>U+P.max.y};for(let k=0;k<g.length;k++){const F=g[k];for(let N=0;N<a.length;N++){const q=n.getTile(a[N]);if(!q||!q.hasData()||D(F,q.tileID))continue;const G=this._createProxiedId(F,q,d[F.key]&&d[F.key][n.id]),W=this.proxyToSource[F.key][n.id];W?W.push(G):this.proxyToSource[F.key][n.id]=[G],m.push(G)}}}_createProxiedId(n,a,d){let m=this.orthoMatrix;if(d){const g=d.find(b=>b.key===a.tileID.key);if(g)return g}if(a.tileID.key!==n.key){const g=n.canonical.z-a.tileID.canonical.z;let b,S,A;m=o.a6.create();const P=a.tileID.wrap-n.wrap<<n.overscaledZ;g>0?(b=o.V>>g,S=b*((a.tileID.canonical.x<<g)-n.canonical.x+P),A=b*((a.tileID.canonical.y<<g)-n.canonical.y)):(b=o.V<<-g,S=o.V*(a.tileID.canonical.x-(n.canonical.x+P<<-g)),A=o.V*(a.tileID.canonical.y-(n.canonical.y<<-g))),o.a6.ortho(m,0,b,0,b,0,1),o.a6.translate(m,m,[S,A,0])}return new Pm(a.tileID,n.key,m)}_findTileCoveringTileID(n,a){let d=a.getTile(n);if(d&&d.hasData())return d;const m=this._findCoveringTileCache[a.id],g=m[n.key];if(d=g?a.getTileByID(g):null,d&&d.hasData()||g===null)return d;let b=d?d.tileID:n,S=b.overscaledZ;const A=a.getSource().minzoom,P=[];if(!g){const k=a.getSource().maxzoom;if(n.canonical.z>=k){const F=n.canonical.z-k;a.getSource().reparseOverscaled?(S=Math.max(n.canonical.z+2,a.transform.tileZoom),b=new o.am(S,n.wrap,k,n.canonical.x>>F,n.canonical.y>>F)):F!==0&&(S=k,b=new o.am(S,n.wrap,k,n.canonical.x>>F,n.canonical.y>>F))}b.key!==n.key&&(P.push(b.key),d=a.getTile(b))}const D=k=>{P.forEach(F=>{m[F]=k}),P.length=0};for(S-=1;S>=A&&(!d||!d.hasData());S--){d&&D(d.tileID.key);const k=b.calculateScaledKey(S);if(d=a.getTileByID(k),d&&d.hasData())break;const F=m[k];if(F===null)break;F===void 0?P.push(k):d=a.getTileByID(F)}return D(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let d=this._tilesDirty[n];d||(d=this._tilesDirty[n]={}),d[a.key]=!0}}function sf(h,n,a){const d=function(S,A,P){const D=o.N.dot(A,S),k=o.N.dot(P,[.2126,.7152,.0722]),F=(q,G,W)=>(1-W)*q+W*G,N=F(1-.3*Math.min(k,1),1,Math.min(D+1,1));return F(.92,1,Math.asin(o.aa(A[2],-1,1))/Math.PI+.5)*N}(h,[0,0,1],n),m=[0,0,0];o.N.scale(m,a.slice(0,3),d);const g=[0,0,0];o.N.scale(g,n.slice(0,3),h[2]);const b=[0,0,0];return o.N.add(b,m,g),o.bU(b)}const of=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Dm=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class af{static cacheKey(n,a,d,m){let g=`${a}${m?m.cacheKey:""}`;for(const b of d)n.usedDefines.includes(b)&&(g+=`/${b}`);return g}constructor(n,a,d,m,g,b,S){const A=n.gl;this.program=A.createProgram(),this.configuration=m,this.name=a,this.fixedDefines=[...b];const P=m?m.getBinderAttributes():[],D=(d.staticAttributes||[]).concat(P);let k=m?m.defines():[];k=k.concat(b.map(U=>`#define ${U}`));const F=`#version 300 es
`;let N=F+k.concat("precision mediump float;",Ku,Xd.fragmentSource).join(`
`);for(const U of d.fragmentIncludes)N+=`
${_s[U]}`;N+=`
${d.fragmentSource}`;let q=F+k.concat("precision highp float;",Ku,Xd.vertexSource).join(`
`);for(const U of d.vertexIncludes)q+=`
${_s[U]}`;q+=`
${d.vertexSource}`;const G=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(G,N),A.compileShader(G),A.attachShader(this.program,G);const W=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(W,q),A.compileShader(W),A.attachShader(this.program,W),this.attributes={},this.numAttributes=D.length;for(let U=0;U<this.numAttributes;U++)if(D[U]){const X=D[U].startsWith("a_")?D[U]:`a_${D[U]}`;A.bindAttribLocation(this.program,U,X),this.attributes[X]=U}S&&S.shaderVaryings.length>0&&A.transformFeedbackVaryings(this.program,S.shaderVaryings,S.bufferMode),A.linkProgram(this.program),A.deleteShader(W),A.deleteShader(G),this.fixedUniforms=g(n),this.binderUniforms=m?m.getUniforms(n):[],b.includes("TERRAIN")&&(this.terrainUniforms=(U=>({u_dem:new o.bO(U),u_dem_prev:new o.bO(U),u_dem_tl:new o.bL(U),u_dem_scale:new o.bN(U),u_dem_tl_prev:new o.bL(U),u_dem_scale_prev:new o.bN(U),u_dem_size:new o.bN(U),u_dem_lerp:new o.bN(U),u_exaggeration:new o.bN(U),u_depth:new o.bO(U),u_depth_size_inv:new o.bL(U),u_meter_to_dem:new o.bN(U),u_label_plane_matrix_inv:new o.bK(U)}))(n)),b.includes("GLOBE")&&(this.globeUniforms=(U=>({u_tile_tl_up:new o.bM(U),u_tile_tr_up:new o.bM(U),u_tile_br_up:new o.bM(U),u_tile_bl_up:new o.bM(U),u_tile_up_scale:new o.bN(U)}))(n)),b.includes("FOG")&&(this.fogUniforms=(U=>({u_fog_matrix:new o.bK(U),u_fog_range:new o.bL(U),u_fog_color:new o.bP(U),u_fog_horizon_blend:new o.bN(U),u_fog_vertical_limit:new o.bL(U),u_fog_temporal_offset:new o.bN(U),u_frustum_tl:new o.bM(U),u_frustum_tr:new o.bM(U),u_frustum_br:new o.bM(U),u_frustum_bl:new o.bM(U),u_globe_pos:new o.bM(U),u_globe_radius:new o.bN(U),u_globe_transition:new o.bN(U),u_is_globe:new o.bO(U),u_viewport:new o.bL(U)}))(n)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(U=>({u_cutoff_params:new o.bP(U)}))(n)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(U=>({u_lighting_ambient_color:new o.bM(U),u_lighting_directional_dir:new o.bM(U),u_lighting_directional_color:new o.bM(U),u_ground_radiance:new o.bM(U)}))(n)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(U=>({u_light_matrix_0:new o.bK(U),u_light_matrix_1:new o.bK(U),u_fade_range:new o.bL(U),u_shadow_normal_offset:new o.bM(U),u_shadow_intensity:new o.bN(U),u_shadow_texel_size:new o.bN(U),u_shadow_map_resolution:new o.bN(U),u_shadow_direction:new o.bM(U),u_shadow_bias:new o.bM(U),u_shadowmap_0:new o.bO(U),u_shadowmap_1:new o.bO(U)}))(n))}}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const m in a)d[m]&&d[m].set(this.program,m,a[m])}}setGlobeUniformValues(n,a){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const m in a)d[m]&&d[m].set(this.program,m,a[m])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const m in a)d[m].set(this.program,m,a[m])}}setCutoffUniformValues(n,a){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const m in a)d[m].set(this.program,m,a[m])}}setLightsUniformValues(n,a){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const m in a)d[m].set(this.program,m,a[m])}}setShadowUniformValues(n,a){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;n.program.set(this.program);for(const m in a)d[m].set(this.program,m,a[m])}_drawDebugWireframe(n,a,d,m,g,b,S,A,P,D){const k=n.options.wireframe;if(k.terrain===!1&&k.layers2D===!1&&k.layers3D===!1)return;const F=n.context;if(!(!(!k.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!k.layers2D||n._terrain&&n._terrain.renderingToTexture||!of.includes(this.name))||!(!k.layers3D||!Dm.includes(this.name))))return;const N=F.gl,q=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,g,F);if(!q)return;const G=[...this.fixedDefines];G.push("DEBUG_WIREFRAME");const W=n.getOrCreateProgram(this.name,{config:this.configuration,defines:G});F.program.set(W.program);const U=(J,ne,Y)=>{if(ne[J]&&Y[J])for(const se in ne[J])Y[J][se]&&Y[J][se].set(Y.program,se,ne[J][se].current)};P&&P.setUniforms(W.program,F,W.binderUniforms,S,{zoom:A}),U("fixedUniforms",this,W),U("terrainUniforms",this,W),U("globeUniforms",this,W),U("fogUniforms",this,W),U("lightsUniforms",this,W),U("shadowUniforms",this,W),q.bind(),F.setColorMode(new jr([N.ONE,N.ONE_MINUS_SRC_ALPHA,N.ZERO,N.ONE],o.ax.transparent,[!0,!0,!0,!1])),F.setDepthMode(new pr(a.func===N.LESS?N.LEQUAL:a.func,pr.ReadOnly,a.range)),F.setStencilMode(Er.disabled);const X=3*b.primitiveLength*2,re=3*b.primitiveOffset*2*2;D&&D>1?N.drawElementsInstanced(N.LINES,X,N.UNSIGNED_SHORT,re,D):N.drawElements(N.LINES,X,N.UNSIGNED_SHORT,re),g.bind(),F.program.set(this.program),F.setDepthMode(a),F.setStencilMode(d),F.setColorMode(m)}draw(n,a,d,m,g,b,S,A,P,D,k,F,N,q,G,W,U){const X=n.context,re=X.gl;if(this.failedToCreate)return;X.program.set(this.program),X.setDepthMode(d),X.setStencilMode(m),X.setColorMode(g),X.setCullFace(b);for(const se of Object.keys(this.fixedUniforms))this.fixedUniforms[se].set(this.program,se,S[se]);q&&q.setUniforms(this.program,X,this.binderUniforms,F,{zoom:N});const J={[re.POINTS]:1,[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[a],ne=U&&U.length>0;if(ne){for(const se of U)re.bindBufferBase(re.TRANSFORM_FEEDBACK_BUFFER,se.targetIndex,se.buffer.buffer);re.beginTransformFeedback(a)}const Y=W&&W>0?1:void 0;for(const se of k.get()){const ce=se.vaos||(se.vaos={});(ce[A]||(ce[A]=new Jd)).bind(X,this,P,q?q.getPaintVertexBuffers():[],D,se.vertexOffset,G||[],Y),W&&W>1?re.drawElementsInstanced(a,se.primitiveLength*J,re.UNSIGNED_SHORT,se.primitiveOffset*J*2,W):D?re.drawElements(a,se.primitiveLength*J,re.UNSIGNED_SHORT,se.primitiveOffset*J*2):re.drawArrays(a,se.vertexOffset,se.vertexLength),a===re.TRIANGLES&&D&&this._drawDebugWireframe(n,d,m,g,D,se,F,N,q,W)}ne&&re.endTransformFeedback()}}function lf(h,n){const a=Math.pow(2,n.tileID.overscaledZ),d=n.tileSize*Math.pow(2,h.transform.tileZoom)/a,m=d*(n.tileID.canonical.x+n.tileID.wrap*a),g=d*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.a3(n,1,h.transform.tileZoom),u_pixel_coord_upper:[m>>16,g>>16],u_pixel_coord_lower:[65535&m,65535&g]}}const Lm=o.a6.create(),cf=(h,n,a,d,m,g,b,S,A,P,D,k,F,N,q,G)=>{const W=n.style.light,U=W.properties.get("position"),X=[U.x,U.y,U.z],re=o.co.create();W.properties.get("anchor")==="viewport"&&(o.co.fromRotation(re,-n.transform.angle),o.N.transformMat3(X,X,re));const J=W.properties.get("color"),ne=n.transform,Y={u_matrix:h,u_lightpos:X,u_lightintensity:W.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_vertical_gradient:+a,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Lm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:m,u_edge_radius:g,u_flood_light_color:k,u_vertical_scale:F,u_flood_light_intensity:N,u_ground_shadow_factor:q,u_emissive_strength:G};return ne.projection.name==="globe"&&(Y.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],Y.u_zoom_transition=A,Y.u_inv_rot_matrix=D,Y.u_merc_center=P,Y.u_up_dir=ne.projection.upVector(new o.bs(0,0,0),P[0]*o.V,P[1]*o.V),Y.u_height_lift=S),Y},uf=(h,n,a)=>({u_matrix:h,u_edge_radius:n,u_vertical_scale:a}),Da=(h,n,a,d,m,g,b,S,A,P,D,k,F,N)=>{const q=cf(h,n,a,d,m,g,b,A,P,D,k,F,N,1,[0,0,0],0),G={u_height_factor:-Math.pow(2,b.overscaledZ)/S.tileSize/8};return o.e(q,lf(n,S),G)},Ml=(h,n)=>({u_matrix:h,u_emissive_strength:n}),hf=(h,n,a,d)=>o.e(Ml(h,n),lf(a,d)),La=(h,n,a)=>({u_matrix:h,u_world:a,u_emissive_strength:n}),Rm=(h,n,a,d,m)=>o.e(hf(h,n,a,d),{u_world:m}),eh=(h,n,a,d)=>{const m=o.V/a.tileSize;return{u_matrix:h,u_camera_to_center_distance:n.getCameraToCenterDistance(d),u_extrude_scale:[n.pixelsToGLUnits[0]/m,n.pixelsToGLUnits[1]/m]}},df=(h,n,a=1)=>({u_matrix:h,u_color:n,u_overlay:0,u_overlay_scale:a}),km=o.a6.create(),ff=(h,n,a,d,m,g,b)=>{const S=h.transform,A=S.projection.name==="globe",P=A?o.cp(S.zoom,n.canonical)*S._pixelsPerMercatorPixel:o.a3(a,1,g),D={u_matrix:n.projMatrix,u_extrude_scale:P,u_intensity:b,u_inv_rot_matrix:km,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){D.u_inv_rot_matrix=d,D.u_merc_center=m,D.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],D.u_zoom_transition=o.S(S.zoom);const k=m[0]*o.V,F=m[1]*o.V;D.u_up_dir=S.projection.upVector(new o.bs(0,0,0),k,F)}return D};function th(h,[n,a,d,m],[g,b]){if(g===b)return[0,0,0,0];const S=255*(h-1)/(h*(b-g));return[n*S,a*S,d*S,m*S]}function Om(h,n,[a,d]){return a===d?0:.5/h+(n-a)*(h-1)/(h*(d-a))}const pf=(h,n,a,d,m,g,b,S,A,P,D,k,F,N,q,G,W,U,X,re,J)=>{return{u_matrix:h,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:d,u_grid_matrix:m,u_tl_parent:g,u_scale_parent:P,u_fade_t:D.mix,u_opacity:D.opacity*k.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:k.paint.get("raster-brightness-min"),u_brightness_high:k.paint.get("raster-brightness-max"),u_saturation_factor:(Y=k.paint.get("raster-saturation"),Y>0?1-1/(1.001-Y):-Y),u_contrast_factor:(ne=k.paint.get("raster-contrast"),ne>0?1/(1-ne):1+ne),u_spin_weights:Rc(k.paint.get("raster-hue-rotate")),u_perspective_transform:F,u_raster_elevation:N,u_zoom_transition:b,u_merc_center:S,u_cutoff_params:A,u_colorization_mix:th(o.cq,G,U),u_colorization_offset:Om(o.cq,W,U),u_color_ramp:q,u_texture_offset:[re/(X+2*re),X/(X+2*re)],u_texture_res:[X+2*re,X+2*re],u_emissive_strength:J};var ne,Y};function Rc(h){h*=Math.PI/180;const n=Math.sin(h),a=Math.cos(h);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}const Yy=(h,n,a,d,m,g,b,S,A,P,D,k)=>({u_matrix:h,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:d,u_grid_matrix:m,u_tl_parent:g,u_scale_parent:P,u_fade_t:D.mix,u_opacity:D.opacity,u_image0:0,u_image1:1,u_raster_elevation:k,u_zoom_transition:b,u_merc_center:S,u_cutoff_params:A}),Zy=(h,n,a,d,m,g,b,S)=>({u_tile_offset:h,u_velocity:n,u_color_ramp:d,u_velocity_res:a,u_max_speed:m,u_texture_offset:g,u_data_scale:b,u_data_offset:S}),zm=(h,n,a,d,m,g,b,S)=>({u_velocity:h,u_velocity_res:n,u_max_speed:a,u_speed_factor:d,u_lifetime_delta:m,u_rand_seed:Math.random(),u_texture_offset:g,u_data_scale:b,u_data_offset:S}),Fm=o.a6.create(),rh=(h,n,a,d,m,g,b,S,A,P,D,k,F,N,q,G,W,U)=>{const X=m.transform,re={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:X.getCameraToCenterDistance(G),u_rotate_symbol:+a,u_aspect_ratio:X.width/X.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:b,u_coord_matrix:S,u_is_text:+A,u_pitch_with_map:+d,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Fm,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Fm,u_up_vector:[0,-1,0],u_icon_transition:U||0,u_icon_saturation:W};return G.name==="globe"&&(re.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],re.u_zoom_transition=k,re.u_inv_rot_matrix=N,re.u_merc_center=F,re.u_camera_forward=X._camera.forward(),re.u_ecef_origin=o.cr(X.globeMatrix,D.toUnwrapped()),re.u_tile_matrix=Float32Array.from(X.globeMatrix),re.u_up_vector=q),re},kc=(h,n,a,d,m,g,b,S,A,P,D,k,F,N,q,G,W)=>o.e(rh(h,n,a,d,m,g,b,S,A,P,k,F,N,q,G,W,1),{u_gamma_scale:d?m.transform.getCameraToCenterDistance(W)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:o.f.devicePixelRatio,u_is_halo:+D,undefined:void 0}),nh=(h,n,a,d,m,g,b,S,A,P,D,k,F,N,q,G)=>o.e(kc(h,n,a,d,m,g,b,S,!0,A,!0,D,k,F,N,q,G),{u_texsize_icon:P,u_texture_icon:1}),mf=(h,n,a,d)=>({u_matrix:h,u_emissive_strength:n,u_opacity:a,u_color:d}),Oc=(h,n,a,d,m,g,b)=>o.e(function(S,A,P,D){const k=P.imageManager.getPattern(S.toString(),A),{width:F,height:N}=P.imageManager.getPixelSize(A),q=Math.pow(2,D.tileID.overscaledZ),G=D.tileSize*Math.pow(2,P.transform.tileZoom)/q,W=G*(D.tileID.canonical.x+D.tileID.wrap*q),U=G*D.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[F,N],u_pattern_size:k.displaySize,u_tile_units_to_pixels:1/o.a3(D,1,P.transform.tileZoom),u_pixel_coord_upper:[W>>16,U>>16],u_pixel_coord_lower:[65535&W,65535&U]}}(m,g,d,b),{u_matrix:h,u_emissive_strength:n,u_opacity:a}),ih=(h,n,a,d,m,g,b,S,A,P,D,k,F=[0,0,0],N)=>{const q=d.style.light,G=q.properties.get("position"),W=[-G.x,-G.y,G.z],U=o.co.create();q.properties.get("anchor")==="viewport"&&(o.co.fromRotation(U,-d.transform.angle),o.N.transformMat3(W,W,U));const X=P.alphaMode==="MASK",re=q.properties.get("color"),J=k.paint.get("model-ambient-occlusion-intensity"),ne=k.paint.get("model-color").constantOr(o.ax.white),Y=k.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:h,u_lighting_matrix:n,u_normal_matrix:a,u_lightpos:W,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[re.r,re.g,re.b],u_camera_pos:F,u_opacity:m,u_baseTextureIsAlpha:0,u_alphaMask:+X,u_alphaCutoff:P.alphaCutoff,u_baseColorFactor:[g.r,g.g,g.b,g.a],u_emissiveFactor:[b[0],b[1],b[2],1],u_metallicFactor:S,u_roughnessFactor:A,u_baseColorTexture:Vi.BaseColor,u_metallicRoughnessTexture:Vi.MetallicRoughness,u_normalTexture:Vi.Normal,u_occlusionTexture:Vi.Occlusion,u_emissionTexture:Vi.Emission,u_color_mix:[ne.r,ne.g,ne.b,Y],u_aoIntensity:J,u_emissive_strength:D,u_occlusionTextureTransform:N||[0,0,0,0]}},zc=new Float32Array(16),Fc=(h,n=zc,a=zc)=>({u_matrix:h,u_instance:n,u_node_matrix:a}),Xy={fillExtrusion:h=>({u_matrix:new o.bK(h),u_lightpos:new o.bM(h),u_lightintensity:new o.bN(h),u_lightcolor:new o.bM(h),u_vertical_gradient:new o.bN(h),u_opacity:new o.bN(h),u_edge_radius:new o.bN(h),u_ao:new o.bL(h),u_tile_id:new o.bM(h),u_zoom_transition:new o.bN(h),u_inv_rot_matrix:new o.bK(h),u_merc_center:new o.bL(h),u_up_dir:new o.bM(h),u_height_lift:new o.bN(h),u_flood_light_color:new o.bM(h),u_vertical_scale:new o.bN(h),u_flood_light_intensity:new o.bN(h),u_ground_shadow_factor:new o.bM(h),u_emissive_strength:new o.bN(h)}),fillExtrusionDepth:h=>({u_matrix:new o.bK(h),u_edge_radius:new o.bN(h),u_vertical_scale:new o.bN(h)}),fillExtrusionPattern:h=>({u_matrix:new o.bK(h),u_lightpos:new o.bM(h),u_lightintensity:new o.bN(h),u_lightcolor:new o.bM(h),u_vertical_gradient:new o.bN(h),u_height_factor:new o.bN(h),u_edge_radius:new o.bN(h),u_ao:new o.bL(h),u_tile_id:new o.bM(h),u_zoom_transition:new o.bN(h),u_inv_rot_matrix:new o.bK(h),u_merc_center:new o.bL(h),u_up_dir:new o.bM(h),u_height_lift:new o.bN(h),u_image:new o.bO(h),u_texsize:new o.bL(h),u_pixel_coord_upper:new o.bL(h),u_pixel_coord_lower:new o.bL(h),u_tile_units_to_pixels:new o.bN(h),u_opacity:new o.bN(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new o.bK(h),u_opacity:new o.bN(h),u_ao_pass:new o.bN(h),u_meter_to_tile:new o.bN(h),u_ao:new o.bL(h),u_flood_light_intensity:new o.bN(h),u_flood_light_color:new o.bM(h),u_attenuation:new o.bN(h),u_edge_radius:new o.bN(h),u_fb:new o.bO(h),u_fb_size:new o.bN(h)}),fill:h=>({u_matrix:new o.bK(h),u_emissive_strength:new o.bN(h)}),fillPattern:h=>({u_matrix:new o.bK(h),u_emissive_strength:new o.bN(h),u_image:new o.bO(h),u_texsize:new o.bL(h),u_pixel_coord_upper:new o.bL(h),u_pixel_coord_lower:new o.bL(h),u_tile_units_to_pixels:new o.bN(h)}),fillOutline:h=>({u_matrix:new o.bK(h),u_emissive_strength:new o.bN(h),u_world:new o.bL(h)}),fillOutlinePattern:h=>({u_matrix:new o.bK(h),u_emissive_strength:new o.bN(h),u_world:new o.bL(h),u_image:new o.bO(h),u_texsize:new o.bL(h),u_pixel_coord_upper:new o.bL(h),u_pixel_coord_lower:new o.bL(h),u_tile_units_to_pixels:new o.bN(h)}),circle:o.cs,collisionBox:h=>({u_matrix:new o.bK(h),u_camera_to_center_distance:new o.bN(h),u_extrude_scale:new o.bL(h)}),collisionCircle:h=>({u_matrix:new o.bK(h),u_inv_matrix:new o.bK(h),u_camera_to_center_distance:new o.bN(h),u_viewport_size:new o.bL(h)}),debug:h=>({u_color:new o.ca(h),u_matrix:new o.bK(h),u_overlay:new o.bO(h),u_overlay_scale:new o.bN(h)}),clippingMask:h=>({u_matrix:new o.bK(h)}),heatmap:h=>({u_extrude_scale:new o.bN(h),u_intensity:new o.bN(h),u_matrix:new o.bK(h),u_inv_rot_matrix:new o.bK(h),u_merc_center:new o.bL(h),u_tile_id:new o.bM(h),u_zoom_transition:new o.bN(h),u_up_dir:new o.bM(h)}),heatmapTexture:h=>({u_image:new o.bO(h),u_color_ramp:new o.bO(h),u_opacity:new o.bN(h)}),hillshade:h=>({u_matrix:new o.bK(h),u_image:new o.bO(h),u_latrange:new o.bL(h),u_light:new o.bL(h),u_shadow:new o.ca(h),u_highlight:new o.ca(h),u_emissive_strength:new o.bN(h),u_accent:new o.ca(h)}),hillshadePrepare:h=>({u_matrix:new o.bK(h),u_image:new o.bO(h),u_dimension:new o.bL(h),u_zoom:new o.bN(h)}),line:o.ct,linePattern:o.cu,raster:h=>({u_matrix:new o.bK(h),u_normalize_matrix:new o.bK(h),u_globe_matrix:new o.bK(h),u_merc_matrix:new o.bK(h),u_grid_matrix:new o.cb(h),u_tl_parent:new o.bL(h),u_scale_parent:new o.bN(h),u_fade_t:new o.bN(h),u_opacity:new o.bN(h),u_image0:new o.bO(h),u_image1:new o.bO(h),u_brightness_low:new o.bN(h),u_brightness_high:new o.bN(h),u_saturation_factor:new o.bN(h),u_contrast_factor:new o.bN(h),u_spin_weights:new o.bM(h),u_perspective_transform:new o.bL(h),u_raster_elevation:new o.bN(h),u_zoom_transition:new o.bN(h),u_merc_center:new o.bL(h),u_cutoff_params:new o.bP(h),u_colorization_mix:new o.bP(h),u_colorization_offset:new o.bN(h),u_color_ramp:new o.bO(h),u_texture_offset:new o.bL(h),u_texture_res:new o.bL(h),u_emissive_strength:new o.bN(h)}),rasterParticle:h=>({u_matrix:new o.bK(h),u_normalize_matrix:new o.bK(h),u_globe_matrix:new o.bK(h),u_merc_matrix:new o.bK(h),u_grid_matrix:new o.cb(h),u_tl_parent:new o.bL(h),u_scale_parent:new o.bN(h),u_fade_t:new o.bN(h),u_opacity:new o.bN(h),u_image0:new o.bO(h),u_image1:new o.bO(h),u_raster_elevation:new o.bN(h),u_zoom_transition:new o.bN(h),u_merc_center:new o.bL(h),u_cutoff_params:new o.bP(h)}),rasterParticleTexture:h=>({u_texture:new o.bO(h),u_opacity:new o.bN(h)}),rasterParticleDraw:h=>({u_tile_offset:new o.bL(h),u_velocity:new o.bO(h),u_color_ramp:new o.bO(h),u_velocity_res:new o.bL(h),u_max_speed:new o.bN(h),u_texture_offset:new o.bL(h),u_data_scale:new o.bP(h),u_data_offset:new o.bN(h)}),rasterParticleUpdate:h=>({u_velocity:new o.bO(h),u_velocity_res:new o.bL(h),u_max_speed:new o.bN(h),u_speed_factor:new o.bN(h),u_lifetime_delta:new o.bN(h),u_rand_seed:new o.bN(h),u_texture_offset:new o.bL(h),u_data_scale:new o.bP(h),u_data_offset:new o.bN(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new o.bO(h),u_is_size_feature_constant:new o.bO(h),u_size_t:new o.bN(h),u_size:new o.bN(h),u_camera_to_center_distance:new o.bN(h),u_rotate_symbol:new o.bO(h),u_aspect_ratio:new o.bN(h),u_fade_change:new o.bN(h),u_matrix:new o.bK(h),u_label_plane_matrix:new o.bK(h),u_coord_matrix:new o.bK(h),u_is_text:new o.bO(h),u_pitch_with_map:new o.bO(h),u_texsize:new o.bL(h),u_tile_id:new o.bM(h),u_zoom_transition:new o.bN(h),u_inv_rot_matrix:new o.bK(h),u_merc_center:new o.bL(h),u_camera_forward:new o.bM(h),u_tile_matrix:new o.bK(h),u_up_vector:new o.bM(h),u_ecef_origin:new o.bM(h),u_texture:new o.bO(h),u_icon_transition:new o.bN(h),u_icon_saturation:new o.bN(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new o.bO(h),u_is_size_feature_constant:new o.bO(h),u_size_t:new o.bN(h),u_size:new o.bN(h),u_camera_to_center_distance:new o.bN(h),u_rotate_symbol:new o.bO(h),u_aspect_ratio:new o.bN(h),u_fade_change:new o.bN(h),u_matrix:new o.bK(h),u_label_plane_matrix:new o.bK(h),u_coord_matrix:new o.bK(h),u_is_text:new o.bO(h),u_pitch_with_map:new o.bO(h),u_texsize:new o.bL(h),u_texture:new o.bO(h),u_gamma_scale:new o.bN(h),u_device_pixel_ratio:new o.bN(h),u_tile_id:new o.bM(h),u_zoom_transition:new o.bN(h),u_inv_rot_matrix:new o.bK(h),u_merc_center:new o.bL(h),u_camera_forward:new o.bM(h),u_tile_matrix:new o.bK(h),u_up_vector:new o.bM(h),u_ecef_origin:new o.bM(h),u_is_halo:new o.bO(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new o.bO(h),u_is_size_feature_constant:new o.bO(h),u_size_t:new o.bN(h),u_size:new o.bN(h),u_camera_to_center_distance:new o.bN(h),u_rotate_symbol:new o.bO(h),u_aspect_ratio:new o.bN(h),u_fade_change:new o.bN(h),u_matrix:new o.bK(h),u_label_plane_matrix:new o.bK(h),u_coord_matrix:new o.bK(h),u_is_text:new o.bO(h),u_pitch_with_map:new o.bO(h),u_texsize:new o.bL(h),u_texsize_icon:new o.bL(h),u_texture:new o.bO(h),u_texture_icon:new o.bO(h),u_gamma_scale:new o.bN(h),u_device_pixel_ratio:new o.bN(h),u_is_halo:new o.bO(h)}),background:h=>({u_matrix:new o.bK(h),u_emissive_strength:new o.bN(h),u_opacity:new o.bN(h),u_color:new o.ca(h)}),backgroundPattern:h=>({u_matrix:new o.bK(h),u_emissive_strength:new o.bN(h),u_opacity:new o.bN(h),u_image:new o.bO(h),u_pattern_tl:new o.bL(h),u_pattern_br:new o.bL(h),u_texsize:new o.bL(h),u_pattern_size:new o.bL(h),u_pixel_coord_upper:new o.bL(h),u_pixel_coord_lower:new o.bL(h),u_tile_units_to_pixels:new o.bN(h)}),terrainRaster:Im,terrainDepth:Im,skybox:h=>({u_matrix:new o.bK(h),u_sun_direction:new o.bM(h),u_cubemap:new o.bO(h),u_opacity:new o.bN(h),u_temporal_offset:new o.bN(h)}),skyboxGradient:h=>({u_matrix:new o.bK(h),u_color_ramp:new o.bO(h),u_center_direction:new o.bM(h),u_radius:new o.bN(h),u_opacity:new o.bN(h),u_temporal_offset:new o.bN(h)}),skyboxCapture:h=>({u_matrix_3f:new o.cb(h),u_sun_direction:new o.bM(h),u_sun_intensity:new o.bN(h),u_color_tint_r:new o.bP(h),u_color_tint_m:new o.bP(h),u_luminance:new o.bN(h)}),globeRaster:h=>({u_proj_matrix:new o.bK(h),u_globe_matrix:new o.bK(h),u_normalize_matrix:new o.bK(h),u_merc_matrix:new o.bK(h),u_zoom_transition:new o.bN(h),u_merc_center:new o.bL(h),u_image0:new o.bO(h),u_grid_matrix:new o.cb(h),u_skirt_height:new o.bN(h),u_far_z_cutoff:new o.bN(h),u_frustum_tl:new o.bM(h),u_frustum_tr:new o.bM(h),u_frustum_br:new o.bM(h),u_frustum_bl:new o.bM(h),u_globe_pos:new o.bM(h),u_globe_radius:new o.bN(h),u_viewport:new o.bL(h)}),globeAtmosphere:h=>({u_frustum_tl:new o.bM(h),u_frustum_tr:new o.bM(h),u_frustum_br:new o.bM(h),u_frustum_bl:new o.bM(h),u_horizon:new o.bN(h),u_transition:new o.bN(h),u_fadeout_range:new o.bN(h),u_color:new o.bP(h),u_high_color:new o.bP(h),u_space_color:new o.bP(h),u_temporal_offset:new o.bN(h),u_horizon_angle:new o.bN(h)}),model:h=>({u_matrix:new o.bK(h),u_lighting_matrix:new o.bK(h),u_normal_matrix:new o.bK(h),u_lightpos:new o.bM(h),u_lightintensity:new o.bN(h),u_lightcolor:new o.bM(h),u_camera_pos:new o.bM(h),u_opacity:new o.bN(h),u_baseColorFactor:new o.bP(h),u_emissiveFactor:new o.bP(h),u_metallicFactor:new o.bN(h),u_roughnessFactor:new o.bN(h),u_baseTextureIsAlpha:new o.bO(h),u_alphaMask:new o.bO(h),u_alphaCutoff:new o.bN(h),u_baseColorTexture:new o.bO(h),u_metallicRoughnessTexture:new o.bO(h),u_normalTexture:new o.bO(h),u_occlusionTexture:new o.bO(h),u_emissionTexture:new o.bO(h),u_color_mix:new o.bP(h),u_aoIntensity:new o.bN(h),u_emissive_strength:new o.bN(h),u_occlusionTextureTransform:new o.bP(h)}),modelDepth:h=>({u_matrix:new o.bK(h),u_instance:new o.bK(h),u_node_matrix:new o.bK(h)}),groundShadow:h=>({u_matrix:new o.bK(h),u_ground_shadow_factor:new o.bM(h)}),stars:h=>({u_matrix:new o.bK(h),u_up:new o.bM(h),u_right:new o.bM(h),u_intensity_multiplier:new o.bN(h)})};let Vs;function $s(h,n,a,d,m,g,b){const S=h.context,A=S.gl,P=h.transform,D=h.getOrCreateProgram("collisionBox"),k=[];let F=0,N=0;for(let J=0;J<d.length;J++){const ne=d[J],Y=n.getTile(ne),se=Y.getBucket(a);if(!se)continue;const ce=Od(ne,se,P);let de=ce;m[0]===0&&m[1]===0||(de=h.translatePosMatrix(ce,Y,m,g));const ge=b?se.textCollisionBox:se.iconCollisionBox,De=se.collisionCircleArray;if(De.length>0){const xe=o.a6.create(),Ne=de;o.a6.mul(xe,se.placementInvProjMatrix,P.glCoordMatrix),o.a6.mul(xe,xe,se.placementViewportMatrix),k.push({circleArray:De,circleOffset:N,transform:Ne,invTransform:xe,projection:se.getProjection()}),F+=De.length/4,N=F}ge&&(h.terrain&&h.terrain.setupElevationDraw(Y,D),D.draw(h,A.LINES,pr.disabled,Er.disabled,h.colorModeForRenderPass(),mr.disabled,eh(de,P,Y,se.getProjection()),a.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,P.zoom,null,[ge.collisionVertexBuffer,ge.collisionVertexBufferExt]))}if(!b||!k.length)return;const q=h.getOrCreateProgram("collisionCircle"),G=new o.cv;G.resize(4*F),G._trim();let W=0;for(const J of k)for(let ne=0;ne<J.circleArray.length/4;ne++){const Y=4*ne,se=J.circleArray[Y+0],ce=J.circleArray[Y+1],de=J.circleArray[Y+2],ge=J.circleArray[Y+3];G.emplace(W++,se,ce,de,ge,0),G.emplace(W++,se,ce,de,ge,1),G.emplace(W++,se,ce,de,ge,2),G.emplace(W++,se,ce,de,ge,3)}(!Vs||Vs.length<2*F)&&(Vs=function(J){const ne=2*J,Y=new o.aw;Y.resize(ne),Y._trim();for(let se=0;se<ne;se++){const ce=6*se;Y.uint16[ce+0]=4*se+0,Y.uint16[ce+1]=4*se+1,Y.uint16[ce+2]=4*se+2,Y.uint16[ce+3]=4*se+2,Y.uint16[ce+4]=4*se+3,Y.uint16[ce+5]=4*se+0}return Y}(F));const U=S.createIndexBuffer(Vs,!0),X=S.createVertexBuffer(G,o.cw.members,!0);for(const J of k){const ne={u_matrix:J.transform,u_inv_matrix:J.invTransform,u_camera_to_center_distance:(re=P).getCameraToCenterDistance(J.projection),u_viewport_size:[re.width,re.height]};q.draw(h,A.TRIANGLES,pr.disabled,Er.disabled,h.colorModeForRenderPass(),mr.disabled,ne,a.id,X,U,o.aB.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,P.zoom)}var re;X.destroy(),U.destroy()}const xo=o.a6.create();function Bc(h){const n=h._camera.getWorldToCamera(h.worldSize,1),a=o.a6.multiply([],n,h.globeMatrix);o.a6.invert(a,a);const d=[0,0,0],m=[0,1,0,0];return o.a7.transformMat4(m,m,a),d[0]=m[0],d[1]=m[1],d[2]=m[2],o.N.normalize(d,d),d}function qt({width:h,height:n,anchor:a,textOffset:d,textScale:m},g){const{horizontalAlign:b,verticalAlign:S}=o.bf(a),A=-(b-.5)*h,P=-(S-.5)*n,D=o.bd(a,d);return new o.P((A/m+D[0])*g,(P/m+D[1])*g)}function Bm(h,n,a,d,m,g,b,S,A,P,D){const k=h.text.placedSymbolArray,F=h.text.dynamicLayoutVertexArray,N=h.icon.dynamicLayoutVertexArray,q={},G=h.getProjection(),W=Sc(S,G,g),U=g.elevation,X=G.upVectorScale(S.canonical,g.center.lat,g.worldSize).metersToTile;F.clear();for(let re=0;re<k.length;re++){const J=k.get(re),{tileAnchorX:ne,tileAnchorY:Y,numGlyphs:se}=J,ce=J.hidden||!J.crossTileID||h.allowVerticalPlacement&&!J.placedOrientation?null:d[J.crossTileID];if(ce){let de=0,ge=0,De=0;if(U){const st=U?U.getAtTileOffset(S,ne,Y):0,[xt,_t,Dt]=G.upVector(S.canonical,ne,Y);de=st*xt*X,ge=st*_t*X,De=st*Dt*X}let[xe,Ne,Fe,tt]=Es(J.projectedAnchorX+de,J.projectedAnchorY+ge,J.projectedAnchorZ+De,a?W:b);const be=gm(g.getCameraToCenterDistance(G),tt);let Oe=m.evaluateSizeForFeature(h.textSizeData,P,J)*be/o.bc;a&&(Oe*=h.tilePixelRatio/A);const me=qt(ce,Oe);a?({x:xe,y:Ne,z:Fe}=G.projectTilePoint(ne+me.x,Y+me.y,S.canonical),[xe,Ne,Fe]=Es(xe+de,Ne+ge,Fe+De,b)):(n&&me._rotate(-g.angle),xe+=me.x,Ne+=me.y,Fe=0);const Ae=h.allowVerticalPlacement&&J.placedOrientation===o.b6.vertical?Math.PI/2:0;for(let st=0;st<se;st++)o.b9(F,xe,Ne,Fe,Ae);D&&J.associatedIconIndex>=0&&(q[J.associatedIconIndex]={x:xe,y:Ne,z:Fe,angle:Ae})}else Go(se,F)}if(D){N.clear();const re=h.icon.placedSymbolArray;for(let J=0;J<re.length;J++){const ne=re.get(J),{numGlyphs:Y}=ne,se=q[J];if(ne.hidden||!se)Go(Y,N);else{const{x:ce,y:de,z:ge,angle:De}=se;for(let xe=0;xe<Y;xe++)o.b9(N,ce,de,ge,De)}}h.icon.dynamicLayoutVertexBuffer.updateData(N)}h.text.dynamicLayoutVertexBuffer.updateData(F)}function sh(h,n,a,d,m,g,b={}){const S=a.paint.get("icon-translate"),A=a.paint.get("text-translate"),P=a.paint.get("icon-translate-anchor"),D=a.paint.get("text-translate-anchor"),k=a.layout.get("icon-rotation-alignment"),F=a.layout.get("text-rotation-alignment"),N=a.layout.get("icon-pitch-alignment"),q=a.layout.get("text-pitch-alignment"),G=a.layout.get("icon-keep-upright"),W=a.layout.get("text-keep-upright"),U=a.paint.get("icon-color-saturation"),X=h.context,re=X.gl,J=h.transform,ne=k==="map",Y=F==="map",se=N==="map",ce=q==="map",de=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ge=!1;const De=h.depthModeForSublayer(0,pr.ReadOnly),xe=[o.a5(J.center.lng),o.ae(J.center.lat)],Ne=a.layout.get("text-variable-anchor"),Fe=J.projection.name==="globe",tt=[],be=[0,-1,0];for(const Oe of d){const me=n.getTile(Oe),Ae=me.getBucket(a);if(!Ae||Ae.projection.name==="mercator"&&Fe||Ae.fullyClipped)continue;const st=Ae.projection.name==="globe",xt=st?o.S(J.zoom):0,_t=Sc(Oe,Ae.getProjection(),J),Dt=J.calculatePixelsToTileUnitsMatrix(me),Qt=Ne&&Ae.hasTextData(),cr=Ae.hasIconTextFit()&&Qt&&Ae.hasIconData(),sr=Ae.getProjection().createInversionMatrix(J,Oe.canonical),ar=()=>{const Xn=ne&&a.layout.get("symbol-placement")!=="point",Wr=[],cn=Xn||cr,Yr=a.paint.get("icon-image-cross-fade").constantOr(0);h.terrainRenderModeElevated()&&se&&Wr.push("PITCH_WITH_MAP_TERRAIN"),st&&(Wr.push("PROJECTION_GLOBE_VIEW"),cn&&Wr.push("PROJECTED_POS_ON_VIEWPORT")),Yr>0&&Wr.push("ICON_TRANSITION"),Ae.icon.zOffsetVertexBuffer&&Wr.push("Z_OFFSET"),U<1&&Wr.push("SATURATION");const ln=Ae.icon.programConfigurations.get(a.id),kn=h.getOrCreateProgram(Ae.sdfIcons?"symbolSDF":"symbolIcon",{config:ln,defines:Wr});let mn;const Ti=me.imageAtlasTexture?me.imageAtlasTexture.size:[0,0],$i=Ae.iconSizeData,as=o.b5($i,J.zoom),eo=se||J.pitch!==0,ls=wc(_t,me.tileID.canonical,se,ne,J,Ae.getProjection(),Dt),Si=Id(_t,me.tileID.canonical,se,ne,J,Ae.getProjection(),Dt),yi=h.translatePosMatrix(Si,me,S,P,!0),Yi=h.translatePosMatrix(_t,me,S,P),es=cn?xo:ls,cs=ne&&!se&&!Xn;let to=be;!Fe&&!J.mercatorFromTransition||ne||(to=Bc(J));const na=st?to:be;mn=Ae.sdfIcons&&!Ae.iconsInText?kc($i.kind,as,cs,se,h,Yi,es,yi,!1,Ti,!0,Oe,xt,xe,sr,na,Ae.getProjection()):rh($i.kind,as,cs,se,h,Yi,es,yi,!1,Ti,Oe,xt,xe,sr,na,Ae.getProjection(),U,Yr);const Fa=me.imageAtlasTexture?me.imageAtlasTexture:null,nu=a.layout.get("icon-size").constantOr(0)!==1||Ae.iconsNeedLinear,iu=Ae.sdfIcons||h.options.rotating||h.options.zooming||nu||eo?re.LINEAR:re.NEAREST,Hf=Ae.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,su=h.terrain&&se&&Xn?o.a6.invert(o.a6.create(),ls):xo;if(Xn&&Ae.icon){const Pl=J.elevation,mh=Pl?Pl.getAtTileOffsetFunc(Oe,J.center.lat,J.worldSize,Ae.getProjection()):null,So=Ad(_t,me.tileID.canonical,se,ne,J,Ae.getProjection(),Dt);Pd(Ae,_t,h,!1,So,Si,se,G,mh,Oe)}return{program:kn,buffers:Ae.icon,uniformValues:mn,atlasTexture:Fa,atlasTextureIcon:null,atlasInterpolation:iu,atlasInterpolationIcon:null,isSDF:Ae.sdfIcons,hasHalo:Hf,tile:me,labelPlaneMatrixInv:su}},kr=()=>{const Xn=Y&&a.layout.get("symbol-placement")!=="point",Wr=[],cn=Xn||Ne||cr;h.terrainRenderModeElevated()&&ce&&Wr.push("PITCH_WITH_MAP_TERRAIN"),st&&(Wr.push("PROJECTION_GLOBE_VIEW"),cn&&Wr.push("PROJECTED_POS_ON_VIEWPORT")),Ae.text.zOffsetVertexBuffer&&Wr.push("Z_OFFSET");const Yr=Ae.text.programConfigurations.get(a.id),ln=h.getOrCreateProgram(Ae.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Yr,defines:Wr});let kn,mn=[0,0],Ti=null;const $i=Ae.textSizeData;Ae.iconsInText&&(mn=me.imageAtlasTexture?me.imageAtlasTexture.size:[0,0],Ti=me.imageAtlasTexture?me.imageAtlasTexture:null,kn=ce||J.pitch!==0||h.options.rotating||h.options.zooming||$i.kind==="composite"||$i.kind==="camera"?re.LINEAR:re.NEAREST);const as=me.glyphAtlasTexture?me.glyphAtlasTexture.size:[0,0],eo=o.b5($i,J.zoom),ls=wc(_t,me.tileID.canonical,ce,Y,J,Ae.getProjection(),Dt),Si=Id(_t,me.tileID.canonical,ce,Y,J,Ae.getProjection(),Dt),yi=h.translatePosMatrix(Si,me,A,D,!0),Yi=h.translatePosMatrix(_t,me,A,D),es=cn?xo:ls,cs=Y&&!ce&&!Xn;let to=be;!Fe&&!J.mercatorFromTransition||Y||(to=Bc(J));const na=st?to:be;let Fa;Fa=Ae.iconsInText?nh($i.kind,eo,cs,ce,h,Yi,es,yi,as,mn,Oe,xt,xe,sr,na,Ae.getProjection()):kc($i.kind,eo,cs,ce,h,Yi,es,yi,!0,as,!0,Oe,xt,xe,sr,na,Ae.getProjection());const nu=me.glyphAtlasTexture?me.glyphAtlasTexture:null,iu=re.LINEAR,Hf=a.paint.get("text-halo-width").constantOr(1)!==0,su=h.terrain&&ce&&Xn?o.a6.invert(o.a6.create(),ls):xo;if(Xn&&Ae.text){const Pl=J.elevation,mh=Pl?Pl.getAtTileOffsetFunc(Oe,J.center.lat,J.worldSize,Ae.getProjection()):null,So=Ad(_t,me.tileID.canonical,ce,Y,J,Ae.getProjection(),Dt);Pd(Ae,_t,h,!0,So,Si,ce,W,mh,Oe)}return{program:ln,buffers:Ae.text,uniformValues:Fa,atlasTexture:nu,atlasTextureIcon:Ti,atlasInterpolation:iu,atlasInterpolationIcon:kn,isSDF:!0,hasHalo:Hf,tile:me,labelPlaneMatrixInv:su}},Mr=Ae.icon.segments.get().length,Cr=Ae.text.segments.get().length,Ir=Mr&&!b.onlyText?ar():null,nn=Cr&&!b.onlyIcons?kr():null,Dn=a.paint.get("icon-opacity").constantOr(1),qr=a.paint.get("text-opacity").constantOr(1);if(de&&Ae.canOverlap){ge=!0;const Xn=Dn&&!b.onlyText?Ae.icon.segments.get():[],Wr=qr&&!b.onlyIcons?Ae.text.segments.get():[];for(const cn of Xn)tt.push({segments:new o.aB([cn]),sortKey:cn.sortKey,state:Ir});for(const cn of Wr)tt.push({segments:new o.aB([cn]),sortKey:cn.sortKey,state:nn})}else b.onlyText||tt.push({segments:Dn?Ae.icon.segments:new o.aB([]),sortKey:0,state:Ir}),b.onlyIcons||tt.push({segments:qr?Ae.text.segments:new o.aB([]),sortKey:0,state:nn})}ge&&tt.sort((Oe,me)=>Oe.sortKey-me.sortKey);for(const Oe of tt){const me=Oe.state;if(me)if(h.terrain&&h.terrain.setupElevationDraw(me.tile,me.program,{useDepthForOcclusion:J.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:me.labelPlaneMatrixInv}),X.activeTexture.set(re.TEXTURE0),me.atlasTexture&&me.atlasTexture.bind(me.atlasInterpolation,re.CLAMP_TO_EDGE,!0),me.atlasTextureIcon&&(X.activeTexture.set(re.TEXTURE1),me.atlasTextureIcon&&me.atlasTextureIcon.bind(me.atlasInterpolationIcon,re.CLAMP_TO_EDGE,!0)),h.uploadCommonLightUniforms(h.context,me.program),me.hasHalo){const Ae=me.uniformValues;Ae.u_is_halo=1,Zo(me.buffers,Oe.segments,a,h,me.program,De,m,g,Ae,2),Ae.u_is_halo=0}else{if(me.isSDF){const Ae=me.uniformValues;me.hasHalo&&(Ae.u_is_halo=1,Zo(me.buffers,Oe.segments,a,h,me.program,De,m,g,Ae,1)),Ae.u_is_halo=0}Zo(me.buffers,Oe.segments,a,h,me.program,De,m,g,me.uniformValues,1)}}}function Zo(h,n,a,d,m,g,b,S,A,P){const D=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer];m.draw(d,d.context.gl.TRIANGLES,g,b,S,mr.disabled,A,a.id,h.layoutVertexBuffer,h.indexBuffer,n,a.paint,d.transform.zoom,h.programConfigurations.get(a.id),D,P)}function Ra(h,n,a,d,m,g,b){const S=h.context.gl,A=a.paint.get("fill-pattern"),P=A&&A.constantOr(1);let D,k,F,N,q;b?(k=P&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=S.LINES):(k=P?"fillPattern":"fill",D=S.TRIANGLES);for(const G of d){const W=n.getTile(G);if(P&&!W.patternsLoaded())continue;const U=W.getBucket(a);if(!U)continue;h.prepareDrawTile();const X=U.programConfigurations.get(a.id),re=h.isTileAffectedByFog(G),J=h.getOrCreateProgram(k,{config:X,overrideFog:re});P&&(h.context.activeTexture.set(S.TEXTURE0),W.imageAtlasTexture&&W.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),X.updatePaintBuffers());const ne=A.constantOr(null);if(ne&&W.imageAtlas){const ce=W.imageAtlas.patternPositions[ne.toString()];ce&&X.setConstantPatternPositions(ce)}const Y=h.translatePosMatrix(G.projMatrix,W,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),se=a.paint.get("fill-emissive-strength");if(b){N=U.indexBuffer2,q=U.segments2;const ce=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];F=k==="fillOutlinePattern"&&P?Rm(Y,se,h,W,ce):La(Y,se,ce)}else N=U.indexBuffer,q=U.segments,F=P?hf(Y,se,h,W):Ml(Y,se);h.uploadCommonUniforms(h.context,J,G.toUnwrapped()),J.draw(h,D,m,h.stencilModeForClipping(G),g,mr.disabled,F,a.id,U.layoutVertexBuffer,N,q,a.paint,h.transform.zoom,X,void 0)}}function er(h,n,a,d,m,g,b,S){a.resetLayerRenderingStats(h);const A=h.context,P=A.gl,D=h.transform,k=a.paint.get("fill-extrusion-pattern"),F=k.constantOr(1),N=a.paint.get("fill-extrusion-opacity"),q=h.style.enable3dLights(),G=a.paint.get(q&&!F?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),W=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),G],U=a.layout.get("fill-extrusion-edge-radius"),X=U>0&&!a.paint.get("fill-extrusion-rounded-roof"),re=X?0:U,J=D.projection.name==="globe"?o.cF():0,ne=D.projection.name==="globe",Y=ne?o.S(D.zoom):0,se=[o.a5(D.center.lng),o.ae(D.center.lat)],ce=a.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),de=a.paint.get("fill-extrusion-flood-light-intensity"),ge=a.paint.get("fill-extrusion-vertical-scale"),De=qo(h,a.paint.get("fill-extrusion-cutoff-fade-range")),xe=a.paint.get("fill-extrusion-emissive-strength"),Ne=[];let Fe;ne&&Ne.push("PROJECTION_GLOBE_VIEW"),W[0]>0&&Ne.push("FAUX_AO"),X&&Ne.push("ZERO_ROOF_RADIUS"),S&&Ne.push("HAS_CENTROID"),de>0&&Ne.push("FLOOD_LIGHT"),De.shouldRenderCutoff&&Ne.push("RENDER_CUTOFF");const tt=h.renderPass==="shadow",be=h.shadowRenderer,Oe=tt&&!!be;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let me=[0,0,0];if(be){const xt=h.style.directionalLight,_t=h.style.ambientLight;xt&&_t&&(me=Pc(xt,_t)),Fe=Ne.concat(["SHADOWS_SINGLE_CASCADE"])}const Ae=Oe?"fillExtrusionDepth":F?"fillExtrusionPattern":"fillExtrusion",st=a.getLayerRenderingStats();for(const xt of d){const _t=n.getTile(xt),Dt=_t.getBucket(a);if(!Dt||Dt.projection.name!==D.projection.name)continue;let Qt=!1;be&&(Qt=be.getMaxCascadeForTile(xt.toUnwrapped())===0);const cr=h.isTileAffectedByFog(xt),sr=Dt.programConfigurations.get(a.id),ar=h.getOrCreateProgram(Ae,{config:sr,defines:Qt?Fe:Ne,overrideFog:cr});if(h.terrain&&h.terrain.setupElevationDraw(_t,ar,{useMeterToDem:!0}),!Dt.centroidVertexBuffer){const Dn=ar.attributes.a_centroid_pos;Dn!==void 0&&P.vertexAttrib2f(Dn,0,0)}!tt&&be&&be.setupShadows(_t.tileID.toUnwrapped(),ar,"vector-tile",_t.tileID.overscaledZ),F&&(h.context.activeTexture.set(P.TEXTURE0),_t.imageAtlasTexture&&_t.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),sr.updatePaintBuffers());const kr=k.constantOr(null);if(kr&&_t.imageAtlas){const Dn=_t.imageAtlas.patternPositions[kr.toString()];Dn&&sr.setConstantPatternPositions(Dn)}const Mr=a.paint.get("fill-extrusion-vertical-gradient");let Cr;if(tt&&be){if(Vm(_t.tileID,Dt,h))continue;const Dn=be.calculateShadowPassMatrixFromTile(_t.tileID.toUnwrapped());Cr=uf(Dn,re,ge)}else{const Dn=h.translatePosMatrix(xt.expandedProjMatrix,_t,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),qr=D.projection.createInversionMatrix(D,xt.canonical);Cr=F?Da(Dn,h,Mr,N,W,re,xt,_t,J,Y,se,qr,ce,ge):cf(Dn,h,Mr,N,W,re,xt,J,Y,se,qr,ce,ge,de,me,xe)}h.uploadCommonUniforms(A,ar,xt.toUnwrapped(),null,De);let Ir=Dt.segments;if(D.projection.name==="mercator"&&!tt&&(Ir=Dt.getVisibleSegments(_t.tileID,h.terrain,h.transform.getFrustum(0)),!Ir.get().length))continue;if(st)if(tt)for(const Dn of Ir.get())st.numRenderedVerticesInShadowPass+=Dn.primitiveLength;else for(const Dn of Ir.get())st.numRenderedVerticesInTransparentPass+=Dn.primitiveLength;const nn=[];(h.terrain||S)&&nn.push(Dt.centroidVertexBuffer),ne&&nn.push(Dt.layoutVertexExtBuffer),ar.draw(h,A.gl.TRIANGLES,m,g,b,mr.backCCW,Cr,a.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Ir,a.paint,h.transform.zoom,sr,nn)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function Xo(h,n,a,d,m,g,b,S,A,P,D,k,F,N,q,G,W,U,X){const re=h.context,J=re.gl,ne=h.transform,Y=h.transform.zoom,se=[],ce=qo(h,a.paint.get("fill-extrusion-cutoff-fade-range"));P==="clear"?(se.push("CLEAR_SUBPASS"),X&&(se.push("CLEAR_FROM_TEXTURE"),re.activeTexture.set(J.TEXTURE0),X.bind(J.LINEAR,J.CLAMP_TO_EDGE))):P==="sdf"&&se.push("SDF_SUBPASS"),W&&se.push("HAS_CENTROID"),ce.shouldRenderCutoff&&se.push("RENDER_CUTOFF");const de=a.layout.get("fill-extrusion-edge-radius"),ge=(De,xe,Ne,Fe,tt)=>{const be=xe.programConfigurations.get(a.id),Oe=h.isTileAffectedByFog(De),me=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:be,defines:se,overrideFog:Oe}),Ae=((xt,_t,Dt,Qt,cr,sr,ar,kr,Mr,Cr,Ir)=>({u_matrix:_t,u_opacity:Dt,u_ao_pass:Qt?1:0,u_meter_to_tile:cr,u_ao:sr,u_flood_light_intensity:ar,u_flood_light_color:kr,u_attenuation:Mr,u_edge_radius:Cr,u_fb:0,u_fb_size:Ir}))(0,Fe,D,A,tt,[k,F*tt],N,q,G,Y>=17?0:de*tt,X?X.size[0]:0),st=[];W&&st.push(xe.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(re,me,De.toUnwrapped(),null,ce),me.draw(h,re.gl.TRIANGLES,m,g,b,S,Ae,a.id,xe.vertexBuffer,xe.indexBuffer,Ne,a.paint,Y,be,st)};for(const De of d){const xe=n.getTile(De),Ne=xe.getBucket(a);if(!Ne||Ne.projection.name!==ne.projection.name||!Ne.groundEffect||Ne.groundEffect&&!Ne.groundEffect.hasData())continue;const Fe=Ne.groundEffect,tt=1/Ne.tileToMeter;{const be=h.translatePosMatrix(De.projMatrix,xe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Oe=Fe.getDefaultSegment();ge(De,Fe,Oe,be,tt)}if(U)for(let be=0;be<4;be++){const Oe=o.cG[be](De),me=n.getTile(Oe);if(!me)continue;const Ae=me.getBucket(a);if(!Ae||Ae.projection.name!==ne.projection.name||!Ae.groundEffect||Ae.groundEffect&&!Ae.groundEffect.hasData())continue;const st=Ae.groundEffect;let xt,_t;be===0?(xt=[-o.V,0,0],_t=1):be===1?(xt=[o.V,0,0],_t=0):be===2?(xt=[0,-o.V,0],_t=3):(xt=[0,o.V,0],_t=2);const Dt=st.regionSegments[_t];if(!Dt)continue;const Qt=new Float32Array(16);o.a6.translate(Qt,De.projMatrix,xt),ge(De,st,Dt,h.translatePosMatrix(Qt,xe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),tt)}}}function Ky(h,n,a,d,m,g,b){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const S=g?g.findDEMTileFor(a):null;if(!(S&&S.dem||b))return;const A=U=>new o.P(Math.ceil((U+o.cJ)*o.cK),0),P=U=>{const X=n.getSource().minzoom,re=ne=>{const Y=n.getTileByID(ne);if(Y&&Y.hasData())return Y.getBucket(m)},J=[0,-1,1];for(const ne of J){if(U.overscaledZ+ne<X)continue;const Y=re(U.calculateScaledKey(U.overscaledZ+ne));if(Y)return Y}},D=[0,0,0],k=(U,X)=>(D[0]=Math.min(U.min.y,X.min.y),D[1]=Math.max(U.max.y,X.max.y),D[2]=o.V-X.min.x>U.max.x?X.min.x-o.V:U.max.x,D),F=(U,X)=>(D[0]=Math.min(U.min.x,X.min.x),D[1]=Math.max(U.max.x,X.max.x),D[2]=o.V-X.min.y>U.max.y?X.min.y-o.V:U.max.y,D),N=[(U,X)=>k(U,X),(U,X)=>k(X,U),(U,X)=>F(U,X),(U,X)=>F(X,U)],q=(U,X,re,J,ne,Y,se)=>{if(!g)return 0;const ce=[[Y?re:U,Y?U:re,0],[Y?re:X,Y?X:re,0]],de=se<0?o.V+se:se,ge=[Y?de:(U+X)/2,Y?(U+X)/2:de,0];return re===0&&se<0||re!==0&&se>0?g.getForTilePoints(ne,[ge],!0,J):ce.push(ge),g.getForTilePoints(a,ce,!0,S),Math.max(ce[0][2],ce[1][2],ge[2])/g.exaggeration()};for(let U=0;U<4;U++){const X=d.borderFeatureIndices[U];if(X.length===0)continue;const re=o.cG[U](a),J=P(re);if(!(J&&J instanceof o.cH)||d.borderDoneWithNeighborZ[U]===J.canonical.z)continue;J.centroidVertexArray.length===0&&J.createCentroidsBuffer();const ne=g?g.findDEMTileFor(re):null;if(!(ne&&ne.dem||b))continue;const Y=(U<2?1:5)-U,se=J.borderDoneWithNeighborZ[Y]!==d.canonical.z,ce=J.borderFeatureIndices[Y];let de=0;if(d.canonical.z!==J.canonical.z){for(const ge of X)d.showCentroid(d.featuresOnBorder[ge]);if(se)for(const ge of ce)J.showCentroid(J.featuresOnBorder[ge]);d.borderDoneWithNeighborZ[U]=J.canonical.z,J.borderDoneWithNeighborZ[Y]=d.canonical.z}for(const ge of X){const De=d.featuresOnBorder[ge],xe=d.centroidData[De.centroidDataIndex],Ne=De.borders[U];let Fe;for(;de<ce.length;){Fe=J.featuresOnBorder[ce[de]];const tt=Fe.borders[Y];if(tt[1]>Ne[0]+3||tt[0]>Ne[0]-3)break;J.showCentroid(Fe),de++}if(Fe&&de<ce.length){const tt=de;let be=0;for(;!(Fe.borders[Y][0]>Ne[1]-3)&&(be++,++de!==ce.length);)Fe=J.featuresOnBorder[ce[de]];if(Fe=J.featuresOnBorder[ce[tt]],be>1){const Ae=Fe.borders[Y];Math.abs(Ne[0]-Ae[0])<3&&Math.abs(Ne[1]-Ae[1])<3&&(be=1,de=tt+1)}else if(be===0){d.showCentroid(De);continue}const Oe=J.centroidData[Fe.centroidDataIndex];b&&be===1&&(((G=xe).flags|(W=Oe).flags)&o.cI?(G.flags|=o.cI,W.flags|=o.cI):(G.flags&=~o.cI,W.flags&=~o.cI));const me=De.intersectsCount()>1||Fe.intersectsCount()>1;if(be>1)de=tt,xe.centroidXY=Oe.centroidXY=new o.P(0,0);else if(ne&&ne.dem&&!me){const Ae=N[U](xe,Oe),st=U%2?o.V-1:0,xt=q(Ae[0],Math.min(o.V-1,Ae[1]),st,ne,re,U<2,Ae[2]);xe.centroidXY=Oe.centroidXY=A(xt)}else me?xe.centroidXY=Oe.centroidXY=new o.P(0,0):(xe.centroidXY=d.encodeBorderCentroid(De),Oe.centroidXY=J.encodeBorderCentroid(Fe));d.writeCentroidToBuffer(xe),J.writeCentroidToBuffer(Oe)}else d.showCentroid(De)}d.borderDoneWithNeighborZ[U]=J.canonical.z,J.borderDoneWithNeighborZ[Y]=d.canonical.z}var G,W;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(h)}const Jy=[1,0,0],_f=[0,1,0],Nm=[0,0,1];function Vm(h,n,a){const d=a.transform,m=a.shadowRenderer;if(!m)return!0;const g=h.toUnwrapped(),b=d.tileSize*m._cascades[a.currentShadowCascade].scale;let S=n.maxHeight;if(d.elevation){const G=d.elevation.getMinMaxForTile(h);G&&(S+=G.max)}const A=[...m.shadowDirection];A[2]=-A[2];const P=m.computeSimplifiedTileShadowVolume(g,S,b,A);if(!P)return!1;const D=[Jy,_f,Nm,A,[A[0],0,A[2]],[0,A[1],A[2]]],k=d.projection.name==="globe",F=d.scaleZoom(b),N=o.bq.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,F,!k),q=m.getCurrentCascadeFrustum();return N.intersectsPrecise(P.vertices,P.planes,D)===0||q.intersectsPrecise(P.vertices,P.planes,D)===0}function $m(h){return[h[0]*o.cL,h[1]*o.cL,h[2]*o.cL,0]}function gf(h,n,a,d,m,g,b,S,A){const P=d.getSource(),D=a.globeSharedBuffers;if(!D)return;let k,F,N;if(n&&(k=d.getTile(n)),P instanceof o.ap?(F=P.texture,N=o.cj(0,0,a.transform)):k&&n&&(F=k.texture,N=o.cj(n.canonical.z,n.canonical.x,a.transform)),!F||!N)return;h||(N=o.a6.scale(o.a6.create(),N,[1,-1,1]));const q=a.context,G=q.gl,W=m.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR,U=a.colorModeForDrapableLayerRenderPass(g),X=b.defines;X.push("GLOBE_POLES");const re=new pr(G.LEQUAL,pr.ReadWrite,a.depthRangeFor3D),J=Float32Array.from(a.transform.expandedFarZProjMatrix),ne=Float32Array.from(o.aT(o.ci(new o.bs(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),q.activeTexture.set(G.TEXTURE0),F.bind(W,G.CLAMP_TO_EDGE),q.activeTexture.set(G.TEXTURE1),F.bind(W,G.CLAMP_TO_EDGE),F.useMipmap&&q.extTextureFilterAnisotropic&&a.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const[Y,se,ce,de]=n?D.getPoleBuffers(n.canonical.z,!1):D.getPoleBuffers(0,!0),ge=m.paint.get("raster-elevation");let De;h?(De=Y,a.renderDefaultNorthPole=ge!==0):(De=se,a.renderDefaultSouthPole=ge!==0);const xe=$m(b.mix),Ne=((tt,be,Oe,me,Ae,st,xt,_t,Dt,Qt,cr,sr,ar)=>pf(tt,be,Oe,new Float32Array(16),new Float32Array(9),[0,0],me,[0,0],[0,0,0,0],1,{opacity:1,mix:0},st,[0,0],_t,2,Qt,cr,sr,1,0,ar))(J,ne,N,o.S(a.transform.zoom),0,m,0,ge,0,xe,b.offset,b.range,g),Fe=a.getOrCreateProgram("raster",{defines:X});a.uploadCommonUniforms(q,Fe,null),Fe.draw(a,G.TRIANGLES,re,A,U,S,Ne,m.id,De,ce,de)}function yf(h){const n=h._nearZ,a=h.projection.farthestPixelDistance(h),d=a-n,m=.2*h.height,g=n+m;return[n,a,(g-m-n)/d,(g-n)/d]}function vf(h,n,a,d){if(h)return n instanceof Tt&&h instanceof Ma?n.getTextureDescriptor(h,a,!0):{texture:h.texture,mix:$m(d.mix),offset:d.offset,buffer:0,tileSize:1}}function xf(h,n,a){if(!h)return null;const d=n.getTextureDescriptor(h,a,!0);if(!d)return null;let{texture:m,mix:g,offset:b,tileSize:S,buffer:A,format:P}=d;if(!m||!P)return null;let D=!1;return P==="uint32"&&(D=!0,g[3]=0,g=th(o.cM,g,[0,a.paint.get("raster-particle-max-speed")]),b=Om(o.cM,b,[0,a.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[A/(S+2*A),S/(S+2*A)],tileSize:S,scalarData:D,scale:g,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[P]]}}function bf(h){const n=h._nearZ,a=h.projection.farthestPixelDistance(h),d=a-n,m=.2*h.height,g=n+m;return[n,a,(g-m-n)/d,(g-n)/d]}const ss=new o.ax(1,0,0,1),Ko=new o.ax(0,1,0,1),Um=new o.ax(0,0,1,1),wf=new o.ax(1,0,1,1),Tf=new o.ax(0,1,1,1);function Jo(h,n,a,d,m,g,b){const S=h.context,A=h.transform,P=S.gl,D=A.projection.name==="globe",k=D?["PROJECTION_GLOBE_VIEW"]:[];let F=o.a6.clone(a.projMatrix);if(D&&o.S(A.zoom)>0){const xe=o.aS(a.canonical,A),Ne=o.cN(xe);F=o.a6.multiply(new Float32Array(16),A.globeMatrix,Ne),o.a6.multiply(F,A.projMatrix,F)}const N=o.a6.create();N[12]+=2*m/(o.f.devicePixelRatio*A.width),N[13]+=2*g/(o.f.devicePixelRatio*A.height),o.a6.multiply(F,N,F);const q=h.getOrCreateProgram("debug",{defines:k}),G=n.getTileByID(a.key);h.terrain&&h.terrain.setupElevationDraw(G,q);const W=pr.disabled,U=Er.disabled,X=h.colorModeForRenderPass(),re="$debug";S.activeTexture.set(P.TEXTURE0),h.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),D?G._makeGlobeTileDebugBuffers(h.context,A):G._makeDebugTileBoundsBuffers(h.context,A.projection);const J=G._tileDebugBuffer||h.debugBuffer,ne=G._tileDebugIndexBuffer||h.debugIndexBuffer,Y=G._tileDebugSegments||h.debugSegments;if(q.draw(h,P.LINE_STRIP,W,U,X,mr.disabled,df(F,d),re,J,ne,Y,null,null,null,[G._globeTileDebugBorderBuffer]),b){const xe=G.latestRawTileData,Ne=Math.floor((xe&&xe.byteLength||0)/1024);let Fe=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Fe+=` => ${a.overscaledZ}`),Fe+=` ${G.state}`,Fe+=` ${Ne}kb`,function(tt,be){tt.initDebugOverlayCanvas();const Oe=tt.debugOverlayCanvas,me=tt.context.gl,Ae=tt.debugOverlayCanvas.getContext("2d");Ae.clearRect(0,0,Oe.width,Oe.height),Ae.shadowColor="white",Ae.shadowBlur=2,Ae.lineWidth=1.5,Ae.strokeStyle="white",Ae.textBaseline="top",Ae.font="bold 36px Open Sans, sans-serif",Ae.fillText(be,5,5),Ae.strokeText(be,5,5),tt.debugOverlayTexture.update(Oe),tt.debugOverlayTexture.bind(me.LINEAR,me.CLAMP_TO_EDGE)}(h,Fe)}const se=n.getTile(a).tileSize,ce=512/Math.min(se,512)*(a.overscaledZ/A.zoom)*.5,de=G._tileDebugTextBuffer||h.debugBuffer,ge=G._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,De=G._tileDebugTextSegments||h.debugSegments;q.draw(h,P.TRIANGLES,W,U,jr.alphaBlended,mr.disabled,df(F,o.ax.transparent,ce),re,de,ge,De,null,null,null,[G._globeTileDebugTextBuffer])}function Sf(h,n,a,d){Yn(h,0,n+a/2,h.transform.width,a,d)}function gs(h,n,a,d){Yn(h,n-a/2,0,a,h.transform.height,d)}function Yn(h,n,a,d,m,g){const b=h.context,S=b.gl;S.enable(S.SCISSOR_TEST),S.scissor(n*o.f.devicePixelRatio,a*o.f.devicePixelRatio,d*o.f.devicePixelRatio,m*o.f.devicePixelRatio),b.clear({color:g}),S.disable(S.SCISSOR_TEST)}const oh=o.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Mf}=oh;function bo(h,n,a,d){h.emplaceBack(n,a,d)}class Ef{constructor(n){this.vertexArray=new o.az,this.indices=new o.aw,bo(this.vertexArray,-1,-1,1),bo(this.vertexArray,1,-1,1),bo(this.vertexArray,-1,1,1),bo(this.vertexArray,1,1,1),bo(this.vertexArray,-1,-1,-1),bo(this.vertexArray,1,-1,-1),bo(this.vertexArray,-1,1,-1),bo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Mf),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=o.aB.simpleSegment(0,0,36,12)}}function ka(h,n,a,d,m,g){const b=h.context.gl,S=n.paint.get("sky-atmosphere-color"),A=n.paint.get("sky-atmosphere-halo-color"),P=n.paint.get("sky-atmosphere-sun-intensity"),D=((k,F,N,q,G)=>({u_matrix_3f:k,u_sun_direction:F,u_sun_intensity:N,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(o.co.fromMat4(o.co.create(),d),m,P,S,A);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+g,n.skyboxTexture,0),a.draw(h,b.TRIANGLES,pr.disabled,Er.disabled,jr.unblended,mr.frontCW,D,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Qy=o.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class El{constructor(n){const a=new o.cO;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const d=new o.aw;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,Qy.members),this.indexBuffer=n.createIndexBuffer(d),this.segments=o.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Nc=o.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class wt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class dr{constructor(n){this.colorModeAlphaBlendedWriteRGB=new jr([1,No,1,No],o.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new jr([1,0,1,0],o.ax.transparent,[!1,!1,!1,!0]),this.params=new wt,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const a=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new El(a);const d=this.params.sizeRange,m=this.params.intensityRange,g=function(D){const k=o.aA(30),F=[];for(let N=0;N<D;++N){const q=2*Math.PI*k(),G=Math.acos(1-2*k())-.5*Math.PI;F.push(o.N.fromValues(Math.cos(G)*Math.cos(q),Math.cos(G)*Math.sin(q),Math.sin(G)))}return F}(this.params.starsCount),b=o.aA(300),S=new o.cP,A=new o.aw;let P=0;for(let D=0;D<g.length;++D){const k=o.N.scale([],g[D],200),F=Math.max(0,1+.01*d*(1*b()-.5)),N=Math.max(0,1+.01*m*(1*b()-.5));S.emplaceBack(k[0],k[1],k[2],-1,-1,F,N),S.emplaceBack(k[0],k[1],k[2],1,-1,F,N),S.emplaceBack(k[0],k[1],k[2],1,1,F,N),S.emplaceBack(k[0],k[1],k[2],-1,1,F,N),A.emplaceBack(P+0,P+1,P+2),A.emplaceBack(P+0,P+2,P+3),P+=4}this.starsVx=a.createVertexBuffer(S,Nc.members),this.starsIdx=a.createIndexBuffer(A),this.starsSegments=o.aB.simpleSegment(0,0,S.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,a){const d=n.context,m=d.gl,g=n.transform,b=new pr(m.LEQUAL,pr.ReadOnly,[0,1]),S=o.S(g.zoom),A=a.properties.get("color").toArray01(),P=a.properties.get("high-color").toArray01(),D=a.properties.get("space-color").toArray01PremultipliedAlpha(),k=5e-4,F=o.cQ(a.properties.get("horizon-blend"),0,1,k,.25),N=o.cd(n,d,g)&&F===k?g.worldSize/(2*Math.PI*1.025)-1:g.globeRadius,q=n.frameCounter/1e3%1,G=o.N.length(g.globeCenterInViewSpace),W=Math.sqrt(Math.pow(G,2)-Math.pow(N,2)),U=Math.acos(W/G),X=re=>{const J=g.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];re&&J.push("ALPHA_PASS");const ne=n.getOrCreateProgram("globeAtmosphere",{defines:J}),Y=((ce,de,ge,De,xe,Ne,Fe,tt,be,Oe,me,Ae)=>({u_frustum_tl:ce,u_frustum_tr:de,u_frustum_br:ge,u_frustum_bl:De,u_horizon:xe,u_transition:Ne,u_fadeout_range:Fe,u_color:tt,u_high_color:be,u_space_color:Oe,u_temporal_offset:me,u_horizon_angle:Ae}))(g.frustumCorners.TL,g.frustumCorners.TR,g.frustumCorners.BR,g.frustumCorners.BL,g.frustumCorners.horizon,S,F,A,P,D,q,U);n.uploadCommonUniforms(d,ne);const se=this.atmosphereBuffer;se&&ne.draw(n,m.TRIANGLES,b,Er.disabled,re?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,mr.backCW,Y,re?"atmosphere_glow_alpha":"atmosphere_glow",se.vertexBuffer,se.indexBuffer,se.segments)};X(!1),X(!0)}drawStars(n,a){const d=o.aa(a.properties.get("star-intensity"),0,1);if(d===0)return;const m=n.context,g=m.gl,b=n.transform,S=n.getOrCreateProgram("stars"),A=o.bi.identity([]);o.bi.rotateX(A,A,-b._pitch),o.bi.rotateZ(A,A,-b.angle),o.bi.rotateX(A,A,o.bj(b._center.lat)),o.bi.rotateY(A,A,-o.bj(b._center.lng));const P=o.a6.fromQuat(new Float32Array(16),A),D=o.a6.multiply([],b.starsProjMatrix,P),k=o.co.fromMat4([],P),F=o.co.invert([],k),N=[0,1,0];o.N.transformMat3(N,N,F),o.N.scale(N,N,this.params.sizeMultiplier);const q=[1,0,0];o.N.transformMat3(q,q,F),o.N.scale(q,q,this.params.sizeMultiplier);const G=(W=N,U=q,X=d,{u_matrix:Float32Array.from(D),u_up:W,u_right:U,u_intensity_multiplier:X});var W,U,X;n.uploadCommonUniforms(m,S),this.starsVx&&this.starsIdx&&S.draw(n,g.TRIANGLES,pr.disabled,Er.disabled,this.colorModeAlphaBlendedWriteRGB,mr.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Oa(h,n){const a=[...h],d=n.cameraWorldSizeForFog/n.worldSize,m=o.a6.identity([]);return o.a6.scale(m,m,[d,d,1]),o.a6.multiply(a,m,a),o.a6.multiply(a,n.worldToFogMatrix,a),a}function Zn(h,n,a,d){const m=a.material,g=d.context,{baseColorTexture:b,metallicRoughnessTexture:S}=m.pbrMetallicRoughness,{normalTexture:A,occlusionTexture:P,emissionTexture:D}=m;function k(F,N,q){if(F&&(h.push(N),g.activeTexture.set(g.gl.TEXTURE0+q),F.gfxTexture)){const{minFilter:G,magFilter:W,wrapS:U,wrapT:X}=F.sampler;F.gfxTexture.bindExtraParam(G,W,U,X)}}k(b,"HAS_TEXTURE_u_baseColorTexture",Vi.BaseColor),k(S,"HAS_TEXTURE_u_metallicRoughnessTexture",Vi.MetallicRoughness),k(A,"HAS_TEXTURE_u_normalTexture",Vi.Normal),k(P,"HAS_TEXTURE_u_occlusionTexture",Vi.Occlusion),k(D,"HAS_TEXTURE_u_emissionTexture",Vi.Emission),a.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(a.texcoordBuffer)),a.colorBuffer&&(h.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(a.colorBuffer)),a.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(a.normalBuffer)),a.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(a.pbrBuffer)),m.alphaMode!=="OPAQUE"&&m.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),m.defined||h.push("DIFFUSE_SHADED"),h.push("USE_STANDARD_DERIVATIVES")}function Vc(h,n,a,d,m,g){const b=a.paint.get("model-opacity"),S=n.context,A=new pr(n.context.gl.LEQUAL,pr.ReadWrite,n.depthRangeFor3D),P=n.transform,D=h.mesh,k=D.material,F=k.pbrMetallicRoughness,N=n.style.fog;let q;q=n.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:o.a6.multiply([],d.zScaleMatrix,h.nodeModelMatrix),o.a6.multiply(q,d.negCameraPosMatrix,q);const G=o.a6.invert([],q);o.a6.transpose(G,G);const W=a.paint.get("model-emissive-strength").constantOr(0),U=ih(new Float32Array(h.worldViewProjection),new Float32Array(q),new Float32Array(G),n,b,F.baseColorFactor,k.emissiveFactor,F.metallicFactor,F.roughnessFactor,k,W,a),X={defines:[]},re=[];Zn(X.defines,re,D,n);const J=n.shadowRenderer;J&&(J.useNormalOffset=!1);let ne=null;if(N){const ce=Oa(h.nodeModelMatrix,n.transform);if(ne=new Float32Array(ce),P.projection.name!=="globe"){const de=D.aabb.min,ge=D.aabb.max,[De,xe]=N.getOpacityForBounds(ce,de[0],de[1],ge[0],ge[1]);X.overrideFog=De>=Sr||xe>=Sr}}const Y=qo(n,a.paint.get("model-cutoff-fade-range"));Y.shouldRenderCutoff&&X.defines.push("RENDER_CUTOFF");const se=n.getOrCreateProgram("model",X);n.uploadCommonUniforms(S,se,null,ne,Y),n.renderPass!=="shadow"&&J&&J.setupShadowsFromMatrix(h.nodeModelMatrix,se),se.draw(n,S.gl.TRIANGLES,A,m,g,D.material.doubleSided?mr.disabled:mr.backCCW,U,a.id,D.vertexBuffer,D.indexBuffer,D.segments,a.paint,n.transform.zoom,void 0,re)}function $c(h,n,a,d,m,g,b){let S;S=h.projection.name==="globe"?o.cS(a,h):[...a],o.a6.multiply(S,S,n.matrix);const A=o.a6.multiply([],d,S);if(n.meshes)for(const P of n.meshes){if(P.material.alphaMode!=="BLEND"){b.push({mesh:P,depth:0,modelIndex:m,worldViewProjection:A,nodeModelMatrix:S});continue}const D=o.N.transformMat4([],P.centroid,A);D[2]>0&&g.push({mesh:P,depth:D[2],modelIndex:m,worldViewProjection:A,nodeModelMatrix:S})}if(n.children)for(const P of n.children)$c(h,P,a,d,m,g,b)}function Ce(h,n,a,d){const m=a.shadowRenderer;if(!m)return;const g=m.getShadowPassDepthMode(),b=m.getShadowPassColorMode(),S=m.calculateShadowPassMatrixFromMatrix(n),A=Fc(S);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,g,Er.disabled,b,mr.backCCW,A,d.id,h.vertexBuffer,h.indexBuffer,h.segments,d.paint,a.transform.zoom,void 0,void 0)}function Af(h,n,a){const d=n.updateZoomBasedPaintProperties(),m=function(g,b,S){let A,P,D,k=g.terrain?g.terrain.exaggeration():0;if(g.terrain&&k>0){const F=g.terrain,N=F.findDEMTileFor(S);N&&N.dem?A=o.cU.create(F,S,N):k=0}if(k===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),k===b.validForExaggeration&&(k===0||A&&A._demTile&&A._demTile.tileID===b.validForDEMTile.id&&A._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(const F in b.instancesPerModel){const N=b.instancesPerModel[F];for(let q=0;q<N.instancedDataArray.length;++q){const G=(A?k*A.getElevationAt(0|N.instancedDataArray.float32[16*q],0|N.instancedDataArray.float32[16*q+1],!0,!0):0)+N.instancesEvaluatedElevation[q];N.instancedDataArray.float32[16*q+6]=G,P=P?Math.min(b.terrainElevationMin,G):G,D=D?Math.max(b.terrainElevationMax,G):G}}return b.terrainElevationMin=P||0,b.terrainElevationMax=D||0,b.validForExaggeration=k,b.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,n,a);(d||m)&&(n.uploaded=!1,n.upload(h.context))}const ys={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.bS([0,0,0],[o.V,o.V,0])};function jm(h,n){const a=1<<h.canonical.z,d=n.getFreeCameraOptions().position,m=n.elevation,g=h.canonical.x/a,b=(h.canonical.x+1)/a,S=h.canonical.y/a,A=(h.canonical.y+1)/a;let P=n._centerAltitude;if(m){const N=m.getMinMaxForTile(h);N&&N.max>P&&(P=N.max)}const D=o.aa(d.x,g,b)-d.x,k=o.aa(d.y,S,A)-d.y,F=o.bl(P,n.center.lat)-d.z;return n._zoomFromMercatorZ(Math.sqrt(D*D+k*k+F*F))}function If(h,n,a,d,m,g,b){const S=h.context,A=h.renderPass==="shadow",P=h.shadowRenderer,D=A&&P?P.getShadowPassDepthMode():new pr(S.gl.LEQUAL,pr.ReadWrite,h.depthRangeFor3D),k=h.isTileAffectedByFog(g);if(a.meshes)for(const F of a.meshes){const N=["MODEL_POSITION_ON_GPU"],q=[];let G,W,U;d.instancedDataArray.length>20&&N.push("INSTANCED_ARRAYS");const X=qo(h,n.paint.get("model-cutoff-fade-range"));if(X.shouldRenderCutoff&&N.push("RENDER_CUTOFF"),A&&P)G=h.getOrCreateProgram("modelDepth",{defines:N}),W=Fc(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(a.matrix)),U=P.getShadowPassColorMode();else{Zn(N,q,F,h),G=h.getOrCreateProgram("model",{defines:N,overrideFog:k});const J=F.material,ne=J.pbrMetallicRoughness,Y=n.paint.get("model-opacity"),se=n.paint.get("model-emissive-strength").constantOr(0);W=ih(g.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),h,Y,ne.baseColorFactor,J.emissiveFactor,ne.metallicFactor,ne.roughnessFactor,J,se,n,m),P&&(b.shadowUniformsInitialized?G.setShadowUniformValues(S,P.getShadowUniformValues()):(P.setupShadows(g.toUnwrapped(),G,"model-tile",g.overscaledZ),b.shadowUniformsInitialized=!0)),U=X.shouldRenderCutoff||Y<1||J.alphaMode!=="OPAQUE"?jr.alphaBlended:jr.unblended}h.uploadCommonUniforms(S,G,g.toUnwrapped(),null,X);const re=F.material.doubleSided?mr.disabled:mr.backCCW;if(d.instancedDataArray.length>20)q.push(d.instancedDataBuffer),G.draw(h,S.gl.TRIANGLES,D,Er.disabled,U,re,W,n.id,F.vertexBuffer,F.indexBuffer,F.segments,n.paint,h.transform.zoom,void 0,q,d.instancedDataArray.length);else{const J=A?"u_instance":"u_normal_matrix";for(let ne=0;ne<d.instancedDataArray.length;++ne)W[J]=new Float32Array(d.instancedDataArray.arrayBuffer,64*ne,16),G.draw(h,S.gl.TRIANGLES,D,Er.disabled,U,re,W,n.id,F.vertexBuffer,F.indexBuffer,F.segments,n.paint,h.transform.zoom,void 0,q)}}if(a.children)for(const F of a.children)If(h,n,F,d,m,g,b)}const Al=[1,-1,1];function ev(h,n,a,d){if(!a.modelManager)return!0;const m=a.modelManager;if(!a.shadowRenderer)return!0;const g=a.shadowRenderer,b=n.aabb;let S=!0,A=h.maxHeight;if(A===0){let D=0;for(const k in h.instancesPerModel){const F=m.getModel(k,d);F?D=Math.max(D,Math.max(Math.max(F.aabb.max[0],F.aabb.max[1]),F.aabb.max[2])):S=!1}A=h.maxScale*D*1.41+h.maxVerticalOffset,S&&(h.maxHeight=A)}b.max[2]=A,b.min[2]+=h.terrainElevationMin,b.max[2]+=h.terrainElevationMax,o.N.transformMat4(b.min,b.min,n.tileMatrix),o.N.transformMat4(b.max,b.max,n.tileMatrix);const P=b.intersects(g.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=P===2),P===0}class tv{}class Gm{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,a,d){{const k=this._storage.get(a.id);if(k)return k.lastUsedFrameIdx=n,k.buf}const m=d.gl,g=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),b=new ArrayBuffer(g),S=new Int16Array(b);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));const A=new o.cW;for(let k=0;k<g/2;k+=3){const F=S[k],N=S[k+1],q=S[k+2];A.emplaceBack(F,N),A.emplaceBack(N,q),A.emplaceBack(q,F)}const P=d.bindVertexArrayOES.current,D=new tv;return D.buf=new Ln(d,A),D.lastUsedFrameIdx=n,this._storage.set(a.id,D),d.bindVertexArrayOES.set(P),D.buf}update(n){for(const[a,d]of this._storage)n-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(a))}destroy(){for(const[n,a]of this._storage)a.buf.destroy(),this._storage.delete(n)}}class Uc{registerParameter(n,a,d,m,g){}registerButton(n,a,d){}}const jc={symbol:function(h,n,a,d,m){if(h.renderPass!=="translucent")return;const g=Er.disabled,b=h.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(P,D,k,F,N,q,G){const W=D.transform,U=N==="map",X=q==="map";for(const re of P){const J=F.getTile(re),ne=J.getBucket(k);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const Y=o.b5(ne.textSizeData,W.zoom),se=Sc(re,ne.getProjection(),W),ce=W.calculatePixelsToTileUnitsMatrix(J),de=wc(se,J.tileID.canonical,X,U,W,ne.getProjection(),ce),ge=ne.hasIconTextFit()&&ne.hasIconData();if(Y){const De=Math.pow(2,W.zoom-J.tileID.overscaledZ);Bm(ne,U,X,G,o.cx,W,de,re,De,Y,ge)}}}(d,h,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),m);const S=a.paint.get("icon-opacity").constantOr(1)!==0,A=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(S||A)?sh(h,n,a,d,g,b):(S&&sh(h,n,a,d,g,b,{onlyIcons:!0}),A&&sh(h,n,a,d,g,b,{onlyText:!0})),n.map.showCollisionBoxes&&($s(h,n,a,d,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),$s(h,n,a,d,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(h,n,a,d){if(h.renderPass!=="translucent")return;const m=a.paint.get("circle-opacity"),g=a.paint.get("circle-stroke-width"),b=a.paint.get("circle-stroke-opacity"),S=a.layout.get("circle-sort-key").constantOr(1)!==void 0,A=a.paint.get("circle-emissive-strength");if(m.constantOr(1)===0&&(g.constantOr(1)===0||b.constantOr(1)===0))return;const P=h.context,D=P.gl,k=h.transform,F=h.depthModeForSublayer(0,pr.ReadOnly),N=Er.disabled,q=h.colorModeForDrapableLayerRenderPass(A),G=k.projection.name==="globe",W=[o.a5(k.center.lng),o.ae(k.center.lat)],U=[];for(let re=0;re<d.length;re++){const J=d[re],ne=n.getTile(J),Y=ne.getBucket(a);if(!Y||Y.projection.name!==k.projection.name)continue;const se=Y.programConfigurations.get(a.id),ce=o.cy(a),de=h.isTileAffectedByFog(J);G&&ce.push("PROJECTION_GLOBE_VIEW");const ge=h.getOrCreateProgram("circle",{config:se,defines:ce,overrideFog:de}),De=Y.layoutVertexBuffer,xe=Y.globeExtVertexBuffer,Ne=Y.indexBuffer,Fe=k.projection.createInversionMatrix(k,J.canonical),tt={programConfiguration:se,program:ge,layoutVertexBuffer:De,globeExtVertexBuffer:xe,indexBuffer:Ne,uniformValues:o.cz(h,J,ne,Fe,W,a),tile:ne};if(S){const be=Y.segments.get();for(const Oe of be)U.push({segments:new o.aB([Oe]),sortKey:Oe.sortKey,state:tt})}else U.push({segments:Y.segments,sortKey:0,state:tt})}S&&U.sort((re,J)=>re.sortKey-J.sortKey);const X={useDepthForOcclusion:k.depthOcclusionForSymbolsAndCircles};for(const re of U){const{programConfiguration:J,program:ne,layoutVertexBuffer:Y,globeExtVertexBuffer:se,indexBuffer:ce,uniformValues:de,tile:ge}=re.state,De=re.segments;h.terrain&&h.terrain.setupElevationDraw(ge,ne,X),h.uploadCommonUniforms(P,ne,ge.tileID.toUnwrapped()),ne.draw(h,D.TRIANGLES,F,N,q,mr.disabled,de,a.id,Y,ce,De,a.paint,k.zoom,J,[se])}},heatmap:function(h,n,a,d){if(a.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const m=h.context,g=m.gl,b=Er.disabled,S=new jr([g.ONE,g.ONE,g.ONE,g.ONE],o.ax.transparent,[!0,!0,!0,!0]);(function(N,q,G,W){const U=N.gl,X=q.width*W,re=q.height*W;N.activeTexture.set(U.TEXTURE1),N.viewport.set([0,0,X,re]);let J=G.heatmapFbo;if(!J||J&&(J.width!==X||J.height!==re)){J&&J.destroy();const ne=U.createTexture();U.bindTexture(U.TEXTURE_2D,ne),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),J=G.heatmapFbo=N.createFramebuffer(X,re,!0,null),function(Y,se,ce,de,ge,De){const xe=Y.gl;xe.texImage2D(xe.TEXTURE_2D,0,Y.extRenderToTextureHalfFloat?xe.RGBA16F:xe.RGBA,ge,De,0,xe.RGBA,Y.extRenderToTextureHalfFloat?xe.HALF_FLOAT:xe.UNSIGNED_BYTE,null),de.colorAttachment.set(ce)}(N,0,ne,J,X,re)}else U.bindTexture(U.TEXTURE_2D,J.colorAttachment.get()),N.bindFramebuffer.set(J.framebuffer)})(m,h,a,h.transform.projection.name==="globe"?.5:.25),m.clear({color:o.ax.transparent});const A=h.transform,P=A.projection.name==="globe",D=P?["PROJECTION_GLOBE_VIEW"]:[],k=P?mr.frontCCW:mr.disabled,F=[o.a5(A.center.lng),o.ae(A.center.lat)];for(let N=0;N<d.length;N++){const q=d[N];if(n.hasRenderableParent(q))continue;const G=n.getTile(q),W=G.getBucket(a);if(!W||W.projection.name!==A.projection.name)continue;const U=h.isTileAffectedByFog(q),X=W.programConfigurations.get(a.id),re=h.getOrCreateProgram("heatmap",{config:X,defines:D,overrideFog:U}),{zoom:J}=h.transform;h.terrain&&h.terrain.setupElevationDraw(G,re),h.uploadCommonUniforms(m,re,q.toUnwrapped());const ne=A.projection.createInversionMatrix(A,q.canonical);re.draw(h,g.TRIANGLES,pr.disabled,b,S,k,ff(h,q,G,ne,F,J,a.paint.get("heatmap-intensity")),a.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,a.paint,h.transform.zoom,X,P?[W.globeExtVertexBuffer]:null)}m.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(m,g){const b=m.context,S=b.gl,A=g.heatmapFbo;if(!A)return;b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,A.colorAttachment.get()),b.activeTexture.set(S.TEXTURE1);let P=g.colorRampTexture;P||(P=g.colorRampTexture=new o.T(b,g.colorRamp,S.RGBA)),P.bind(S.LINEAR,S.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,S.TRIANGLES,pr.disabled,Er.disabled,m.colorModeForRenderPass(),mr.disabled,((D,k,F,N)=>({u_image:0,u_color_ramp:1,u_opacity:k.paint.get("heatmap-opacity")}))(0,g),g.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,g.paint,m.transform.zoom)}(h,a))},line:function(h,n,a,d){if(h.renderPass!=="translucent")return;const m=a.paint.get("line-opacity"),g=a.paint.get("line-width");if(m.constantOr(1)===0||g.constantOr(1)===0)return;const b=a.paint.get("line-emissive-strength"),S=h.depthModeForSublayer(0,pr.ReadOnly),A=h.colorModeForDrapableLayerRenderPass(b),P=h.terrain&&h.terrain.renderingToTexture?1:o.f.devicePixelRatio,D=a.paint.get("line-dasharray"),k=D.constantOr(1),F=a.layout.get("line-cap"),N=a.paint.get("line-pattern"),q=N.constantOr(1),G=a.paint.get("line-pattern").constantOr(1),W=a.paint.get("line-opacity").constantOr(1)!==1;let U=!G&&W;const X=a.paint.get("line-gradient"),re=q?"linePattern":"line",J=h.context,ne=J.gl,Y=o.cA(a);h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(U=!1);for(const se of d){const ce=n.getTile(se);if(q&&!ce.patternsLoaded())continue;const de=ce.getBucket(a);if(!de)continue;h.prepareDrawTile();const ge=de.programConfigurations.get(a.id),De=h.isTileAffectedByFog(se),xe=h.getOrCreateProgram(re,{config:ge,defines:Y,overrideFog:De}),Ne=N.constantOr(null);if(Ne&&ce.imageAtlas){const xt=ce.imageAtlas.patternPositions[Ne.toString()];xt&&ge.setConstantPatternPositions(xt)}const Fe=D.constantOr(null),tt=F.constantOr(null);if(!q&&Fe&&tt&&ce.lineAtlas){const xt=ce.lineAtlas.getDash(Fe,tt);xt&&ge.setConstantPatternPositions(xt)}let[be,Oe]=a.paint.get("line-trim-offset");(tt==="round"||tt==="square")&&be!==Oe&&(be===0&&(be-=1),Oe===1&&(Oe+=1));const me=h.terrain?se.projMatrix:null,Ae=q?o.cB(h,ce,a,me,P,[be,Oe]):o.cC(h,ce,a,me,de.lineClipsArray.length,P,[be,Oe]);if(X){const xt=de.gradients[a.id];let _t=xt.texture;if(a.gradientVersion!==xt.version){let Dt=256;if(a.stepInterpolant){const Qt=n.getSource().maxzoom,cr=se.canonical.z===Qt?Math.ceil(1<<h.transform.maxZoom-se.canonical.z):1;Dt=o.aa(o.cD(de.maxLineLength/o.V*1024*cr),256,J.maxTextureSize)}xt.gradient=o.cE({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Dt,image:xt.gradient||void 0,clips:de.lineClipsArray}),xt.texture?xt.texture.update(xt.gradient):xt.texture=new o.T(J,xt.gradient,ne.RGBA),xt.version=a.gradientVersion,_t=xt.texture}J.activeTexture.set(ne.TEXTURE1),_t.bind(a.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}k&&(J.activeTexture.set(ne.TEXTURE0),ce.lineAtlasTexture&&ce.lineAtlasTexture.bind(ne.LINEAR,ne.REPEAT),ge.updatePaintBuffers()),q&&(J.activeTexture.set(ne.TEXTURE0),ce.imageAtlasTexture&&ce.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),ge.updatePaintBuffers()),h.uploadCommonUniforms(J,xe,se.toUnwrapped());const st=xt=>{xe.draw(h,ne.TRIANGLES,S,xt,A,mr.disabled,Ae,a.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,a.paint,h.transform.zoom,ge,[de.layoutVertexBuffer2])};if(U){const xt=h.stencilModeForClipping(se).ref;xt===0&&h.terrain&&J.clear({stencil:0});const _t={func:ne.EQUAL,mask:255};Ae.u_alpha_discard_threshold=.8,st(new Er(_t,xt,255,ne.KEEP,ne.KEEP,ne.INVERT)),Ae.u_alpha_discard_threshold=0,st(new Er(_t,xt,255,ne.KEEP,ne.KEEP,ne.KEEP))}else st(h.stencilModeForClipping(se))}U&&(h.resetStencilClippingMasks(),h.terrain&&J.clear({stencil:0}))},fill:function(h,n,a,d){const m=a.paint.get("fill-color"),g=a.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const b=a.paint.get("fill-emissive-strength"),S=h.colorModeForDrapableLayerRenderPass(b),A=a.paint.get("fill-pattern"),P=h.opaquePassEnabledForLayer()&&!A.constantOr(1)&&m.constantOr(o.ax.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===P){const D=h.depthModeForSublayer(1,h.renderPass==="opaque"?pr.ReadWrite:pr.ReadOnly);Ra(h,n,a,d,D,S,!1)}if(h.renderPass==="translucent"&&a.paint.get("fill-antialias")){const D=h.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,pr.ReadOnly);Ra(h,n,a,d,D,S,!0)}},"fill-extrusion":function(h,n,a,d){const m=a.paint.get("fill-extrusion-opacity"),g=h.context,b=g.gl,S=h.terrain,A=S&&S.renderingToTexture;if(m===0)return;const P=h.conflationActive&&h.layerUsedInConflation(a,n.getSource());if(P&&function(D,k,F,N){for(const q of N){const G=k.getTile(q).getBucket(F);G&&(G.updateReplacement(q,D.replacementSource),G.uploadCentroid(D.context))}}(h,n,a,d),S||P)for(const D of d){const k=n.getTile(D).getBucket(a);k&&Ky(h.context,n,D,k,a,S,P)}if(h.renderPass==="shadow"&&h.shadowRenderer){const D=h.shadowRenderer;if(S&&m<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.Z)return;const k=D.getShadowPassDepthMode(),F=D.getShadowPassColorMode();er(h,n,a,d,k,Er.disabled,F,P)}else if(h.renderPass==="translucent"){const D=!a.paint.get("fill-extrusion-pattern").constantOr(1),k=a.paint.get("fill-extrusion-color").constantOr(o.ax.white);if(!A&&k.a!==0){const F=new pr(h.context.gl.LEQUAL,pr.ReadWrite,h.depthRangeFor3D);m===1&&D?er(h,n,a,d,F,Er.disabled,jr.unblended,P):(er(h,n,a,d,F,Er.disabled,jr.disabled,P),er(h,n,a,d,F,h.stencilModeFor3D(),h.colorModeForRenderPass(),P),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&D&&(!S&&h.transform.projection.name!=="globe"||A)){const F=a.paint.get("fill-extrusion-opacity"),N=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),q=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),G=a.paint.get("fill-extrusion-flood-light-intensity"),W=a.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),U=N>0&&q>0,X=G>0,re=(ne,Y,se)=>(1-se)*ne+se*Y,J=ne=>{const Y=h.depthModeForSublayer(1,pr.ReadOnly,b.LEQUAL,!0),se=a.paint.get(ne?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ce=re(.1,3,se),de=h._showOverdrawInspector;if(!de){const ge=new Er({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),De=new jr([b.ONE,b.ONE,b.ONE,b.ONE],o.ax.transparent,[!1,!1,!1,!0],b.MIN);Xo(h,n,a,d,Y,ge,De,mr.disabled,ne,"sdf",F,N,q,G,W,ce,P,!1)}{const ge=de?Er.disabled:new Er({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),De=de?h.colorModeForRenderPass():new jr([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],o.ax.transparent,[!0,!0,!0,!0]);Xo(h,n,a,d,Y,ge,De,mr.disabled,ne,"color",F,N,q,G,W,ce,P,!1)}};if(A){const ne=(Y,se,ce)=>{const de=h.depthModeForSublayer(1,pr.ReadOnly,b.LEQUAL,!1),ge=a.paint.get(Y?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),De=re(.1,3,ge);{const xe=new jr([b.ONE,b.ONE,b.ONE,b.ONE],o.ax.transparent,[!1,!1,!1,!0]);Xo(h,n,a,d,de,Er.disabled,xe,mr.disabled,Y,"clear",F,N,q,G,W,De,P,se)}{const xe=new Er({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Ne=new jr([b.ONE,b.ONE,b.ONE,b.ONE],o.ax.transparent,[!1,!1,!1,!0],b.MIN);Xo(h,n,a,d,de,xe,Ne,mr.disabled,Y,"sdf",F,N,q,G,W,De,P,se)}{const xe=Y?b.ZERO:b.ONE_MINUS_DST_ALPHA,Ne=new Er({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Fe=new jr([xe,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],o.ax.transparent,[!0,!0,!0,!0]);Xo(h,n,a,d,de,Ne,Fe,mr.disabled,Y,"color",F,N,q,G,W,De,P,se)}{const xe=new jr([b.ONE,b.ONE,b.ONE,Y?b.ZERO:b.ONE],o.ax.transparent,[!1,!1,!1,!0],Y?b.FUNC_ADD:b.MAX);Xo(h,n,a,d,de,Er.disabled,xe,mr.disabled,Y,"clear",F,N,q,G,W,De,P,se,ce)}};if(U||X){let Y;if(h.prepareDrawTile(),S){const se=S.drapeBufferSize[0],ce=S.drapeBufferSize[1];Y=S.framebufferCopyTexture,Y&&(!Y||Y.size[0]===se&&Y.size[1]===ce)||(Y&&Y.destroy(),Y=S.framebufferCopyTexture=new o.T(g,new o.h({width:se,height:ce}),b.RGBA)),Y.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGBA,0,0,se,ce,0)}U&&ne(!0,!1,Y),X&&ne(!1,!0,Y)}}else U&&J(!0),X&&J(!1)}}},hillshade:function(h,n,a,d){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const m=h.context,g=h.terrain&&h.terrain.renderingToTexture,[b,S]=h.renderPass!=="translucent"||g?[{},d]:h.stencilConfigForOverlap(d);for(const A of S){const P=n.getTile(A);if(P.needsHillshadePrepare&&h.renderPass==="offscreen")Qd(h,P,a);else if(h.renderPass==="translucent"){const D=h.depthModeForSublayer(0,pr.ReadOnly),k=a.paint.get("hillshade-emissive-strength"),F=h.colorModeForDrapableLayerRenderPass(k),N=g&&h.terrain?h.terrain.stencilModeForRTTOverlap(A):b[A.overscaledZ];Ju(h,A,P,a,D,N,F)}}m.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,n,a,d,m,g){if(h.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const b=h.transform.projection.name==="globe",S=a.paint.get("raster-elevation")!==0,A=S&&b;if(h.renderElevatedRasterBackface&&!A)return;const P=h.context,D=P.gl,k=n.getSource(),F=function(Y,se,ce,de){const ge=se.paint.get("raster-color"),De=Y.type==="raster-array",xe=[],Ne=se.paint.get("raster-resampling"),Fe=se.paint.get("raster-color-mix");let tt=se.paint.get("raster-color-range");const be=[Fe[0],Fe[1],Fe[2],0],Oe=Fe[3];let me=Ne==="nearest"?de.NEAREST:de.LINEAR;if(De&&(xe.push("RASTER_ARRAY"),ge||xe.push("RASTER_COLOR"),Ne==="linear"&&xe.push("RASTER_ARRAY_LINEAR"),me=de.NEAREST,!tt&&Y.rasterLayers)){const Ae=Y.rasterLayers.find(({id:st})=>st===se.sourceLayer);Ae&&Ae.fields&&Ae.fields.range&&(tt=Ae.fields.range)}if(tt=tt||[0,1],ge){xe.push("RASTER_COLOR"),ce.activeTexture.set(de.TEXTURE2),se.updateColorRamp(tt);let Ae=se.colorRampTexture;Ae||(Ae=se.colorRampTexture=new o.T(ce,se.colorRamp,de.RGBA)),Ae.bind(de.LINEAR,de.CLAMP_TO_EDGE)}return{mix:be,range:tt,offset:Oe,defines:xe,resampling:me}}(k,a,P,D);if(k instanceof o.ap&&!d.length&&!b)return;const N=a.paint.get("raster-emissive-strength"),q=h.colorModeForDrapableLayerRenderPass(N),G=h.terrain&&h.terrain.renderingToTexture,W=!h.options.moving,U=a.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;if(k instanceof o.ap&&!d.length&&(k.onNorthPole||k.onSouthPole)){const Y=S?h.stencilModeFor3D():Er.disabled;return void gf(!!k.onNorthPole,null,h,n,a,N,F,mr.disabled,Y)}if(!d.length)return;const[X,re]=k instanceof o.ap||G?[{},d]:h.stencilConfigForOverlap(d),J=re[re.length-1].overscaledZ;A&&F.defines.push("PROJECTION_GLOBE_VIEW"),S&&F.defines.push("RENDER_CUTOFF");const ne=(Y,se,ce)=>{for(const de of Y){const ge=de.toUnwrapped(),De=n.getTile(de);if(G&&(!De||!De.hasData()))continue;P.activeTexture.set(D.TEXTURE0);const xe=vf(De,k,a,F);if(!xe||!xe.texture)continue;const{texture:Ne,mix:Fe,offset:tt,tileSize:be,buffer:Oe}=xe;let me,Ae;G?(me=pr.disabled,Ae=de.projMatrix):S?(me=new pr(D.LEQUAL,pr.ReadWrite,h.depthRangeFor3D),Ae=b?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(ge,W)):(me=h.depthModeForSublayer(de.overscaledZ-J,a.paint.get("raster-opacity")===1?pr.ReadWrite:pr.ReadOnly,D.LESS),Ae=h.transform.calculateProjMatrix(ge,W));const st=h.terrain&&G?h.terrain.stencilModeForRTTOverlap(de):X[de.overscaledZ],xt=g?0:a.paint.get("raster-fade-duration");De.registerFadeDuration(xt);const _t=n.findLoadedParent(de,0),Dt=nf(De,_t,n,h.transform,xt);let Qt,cr;h.terrain&&h.terrain.prepareDrawTile(),P.activeTexture.set(D.TEXTURE0),Ne.bind(U,D.CLAMP_TO_EDGE),P.activeTexture.set(D.TEXTURE1),_t?(_t.texture&&_t.texture.bind(U,D.CLAMP_TO_EDGE),Qt=Math.pow(2,_t.tileID.overscaledZ-De.tileID.overscaledZ),cr=[De.tileID.canonical.x*Qt%1,De.tileID.canonical.y*Qt%1]):Ne.bind(U,D.CLAMP_TO_EDGE),Ne.useMipmap&&P.extTextureFilterAnisotropic&&h.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const sr=h.transform;let ar;const kr=S?yf(sr):[0,0,0,0];let Mr,Cr,Ir,nn,Dn,qr=0;if(A&&k instanceof o.ap&&k.coordinates.length>3)Mr=Float32Array.from(o.aT(o.ci(new o.bs(0,0,0)))),Cr=Float32Array.from(sr.globeMatrix),Ir=Float32Array.from(o.ce(sr)),nn=[o.a5(sr.center.lng),o.ae(sr.center.lat)],ar=k.elevatedGlobePerspectiveTransform,Dn=k.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){const Yr=o.cf(de.canonical);qr=o.cg(Yr.getCenter().lat),Mr=Float32Array.from(o.aT(o.ci(de.canonical))),Cr=Float32Array.from(sr.globeMatrix),Ir=Float32Array.from(o.ce(sr)),nn=[o.a5(sr.center.lng),o.ae(sr.center.lat)],ar=[0,0],Dn=Float32Array.from(o.ch(de.canonical,Yr,qr,sr.worldSize/sr._pixelsPerMercatorPixel))}else ar=k instanceof o.ap?k.perspectiveTransform:[0,0],Mr=new Float32Array(16),Cr=new Float32Array(9),Ir=new Float32Array(16),nn=[0,0],Dn=new Float32Array(9);const Xn=pf(Ae,Mr,Cr,Ir,Dn,cr||[0,0],o.S(h.transform.zoom),nn,kr,Qt||1,Dt,a,ar,S?a.paint.get("raster-elevation"):0,2,Fe,tt,F.range,be,Oe,N),Wr=h.isTileAffectedByFog(de),cn=h.getOrCreateProgram("raster",{defines:F.defines,overrideFog:Wr});if(h.uploadCommonUniforms(P,cn,ge),k instanceof o.ap){const Yr=k.elevatedGlobeVertexBuffer,ln=k.elevatedGlobeIndexBuffer;if(G||!b)k.boundsBuffer&&k.boundsSegments&&cn.draw(h,D.TRIANGLES,me,Er.disabled,q,mr.disabled,Xn,a.id,k.boundsBuffer,h.quadTriangleIndexBuffer,k.boundsSegments);else if(Yr&&ln){const kn=sr.zoom<=o.bG?k.elevatedGlobeSegments:k.getSegmentsForLongitude(sr.center.lng);kn&&cn.draw(h,D.TRIANGLES,me,Er.disabled,q,se,Xn,a.id,Yr,ln,kn)}}else if(A){me=new pr(D.LEQUAL,pr.ReadOnly,h.depthRangeFor3D);const Yr=h.globeSharedBuffers;if(Yr){const[ln,kn,mn]=Yr.getGridBuffers(qr,!1);cn.draw(h,D.TRIANGLES,me,ce||st,h.colorModeForRenderPass(),se,Xn,a.id,ln,kn,mn)}}else{const{tileBoundsBuffer:Yr,tileBoundsIndexBuffer:ln,tileBoundsSegments:kn}=h.getTileBoundsBuffers(De);cn.draw(h,D.TRIANGLES,me,st,q,mr.disabled,Xn,a.id,Yr,ln,kn)}}if(!(k instanceof o.ap)&&A)for(const de of Y){const ge=de.canonical.y===(1<<de.canonical.z)-1;de.canonical.y===0&&gf(!0,de,h,n,a,N,F,se,ce||Er.disabled),ge&&gf(!1,de,h,n,a,N,F,se===mr.frontCW?mr.backCW:mr.frontCW,ce||Er.disabled)}};A?ne(re,h.renderElevatedRasterBackface?mr.backCW:mr.frontCW,h.stencilModeFor3D()):ne(re,mr.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,n,a,d,m,g){h.renderPass==="offscreen"&&function(b,S,A,P){if(!P.length)return;const D=b.context,k=D.gl,F=S.getSource();if(!(F instanceof Tt))return;const N=[];for(const W of P){const U=S.getTile(W);if(!(U instanceof Ma))continue;const X=xf(U,F,A);if(!X)continue;const re=[X.tileSize,X.tileSize];let J=A.tileFramebuffer;J||(J=A.tileFramebuffer=D.createFramebuffer(re[0],re[1],!0,null));let ne=U.rasterParticleState;const Y=A.paint.get("raster-particle-count");ne||(ne=U.rasterParticleState=new _i(D,W,re,Y));const se=ne.update(A.lastInvalidatedAt);ne.numParticles!==Y&&ne.setNumParticles(W,Y);const ce=ne.targetColorTexture;ne.targetColorTexture=ne.backgroundColorTexture,ne.backgroundColorTexture=ce;const de=ne.particleVertices0;ne.particleVertices0=ne.particleVertices1,ne.particleVertices1=de,N.push([W,X,ne,se])}if(N.length===0)return;const q=o.f.now(),G=A.previousDrawTimestamp?.001*(q-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=q,A.hasColorMap()){D.activeTexture.set(k.TEXTURE0+2);let W=A.colorRampTexture;W||(W=A.colorRampTexture=new o.T(D,A.colorRamp,k.RGBA)),W.bind(k.LINEAR,k.CLAMP_TO_EDGE)}D.bindFramebuffer.set(A.tileFramebuffer.framebuffer),D.activeTexture.set(k.TEXTURE0),function(W,U,X){const re=W.context,J=re.gl,ne=U.tileFramebuffer;re.activeTexture.set(J.TEXTURE0);const Y={u_texture:0,u_opacity:1.05*(ce=U.paint.get("raster-particle-fade-opacity-factor"))/(ce+.05)},se=W.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ce;for(const de of X){const[,,ge,De]=de;ne.colorAttachment.set(ge.targetColorTexture.texture),re.viewport.set([0,0,ne.width,ne.height]),re.clear({color:o.ax.transparent}),De&&(ge.backgroundColorTexture.bind(J.NEAREST,J.CLAMP_TO_EDGE),se.draw(W,J.TRIANGLES,pr.disabled,Er.disabled,jr.alphaBlended,mr.disabled,Y,U.id,W.viewportBuffer,W.quadTriangleIndexBuffer,W.viewportSegments))}}(b,A,N),function(W,U,X,re){const J=W.context.gl,ne=X.tileFramebuffer,Y=W.transform.projection.name==="globe",se=X.paint.get("raster-particle-max-speed");for(const ce of re){const[de,ge,De]=ce;ge.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE),ne.colorAttachment.set(De.targetColorTexture.texture);const xe=W.getOrCreateProgram("rasterParticleDraw",{defines:ge.defines,overrideFog:!1}),Ne=ge.scalarData?[]:[0,1,2,3].map(be=>o.cG[be](de));Ne.push(de);const Fe=de.canonical.x,tt=de.canonical.y;for(const be of Ne){const Oe=U.getTile(Y?be.wrapped():be);if(!Oe)continue;const me=Oe.rasterParticleState;if(!me)continue;const Ae=Zy([be.canonical.x+(1<<be.canonical.z)*(be.wrap-de.wrap)-Fe,be.canonical.y-tt],0,ge.texture.size,2,se,ge.textureOffset,ge.scale,ge.offset);xe.draw(W,J.POINTS,pr.disabled,Er.disabled,jr.alphaBlended,mr.disabled,Ae,X.id,me.particleVertices0,void 0,me.particleSegment)}}}(b,S,A,N),function(W,U,X,re){const J=W.context.gl;let ne=U.transformFeedbackObject;ne||(ne=U.transformFeedbackObject=J.createTransformFeedback()),J.bindTransformFeedback(J.TRANSFORM_FEEDBACK,U.transformFeedbackObject);const Y=U.paint.get("raster-particle-max-speed"),se=re*U.paint.get("raster-particle-speed-factor")*.3,ce=(de=U.paint.get("raster-particle-reset-rate-factor"),Math.pow(de,6));var de;for(const ge of X){const[,De,xe]=ge;De.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const Ne=zm(0,De.texture.size,Y,se,ce,De.textureOffset,De.scale,De.offset);W.getOrCreateProgram("rasterParticleUpdate",{defines:De.defines,transformFeedback:{bufferMode:J.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(W,J.POINTS,pr.disabled,Er.disabled,jr.disabled,mr.disabled,Ne,U.id,xe.particleVertices0,void 0,xe.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:xe.particleVertices1,targetIndex:0}])}J.bindTransformFeedback(J.TRANSFORM_FEEDBACK,null)}(b,A,N,G)}(h,n,a,d),h.renderPass==="translucent"&&(function(b,S,A,P,D){const k=b.context,F=k.gl,N=!b.options.moving,q=b.transform.projection.name==="globe";if(!P.length)return;const[G,W]=b.stencilConfigForOverlap(P),U=[];q&&U.push("PROJECTION_GLOBE_VIEW");for(const X of W){const re=X.toUnwrapped(),J=S.getTile(X);if(!J.rasterParticleState)continue;const ne=J.rasterParticleState,Y=100;J.registerFadeDuration(Y);const se=S.findLoadedParent(X,0),ce=nf(J,se,S,b.transform,Y);let de,ge;b.terrain&&b.terrain.prepareDrawTile(),k.activeTexture.set(F.TEXTURE0),ne.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),k.activeTexture.set(F.TEXTURE1),se&&se.rasterParticleState?(se.rasterParticleState.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),de=Math.pow(2,se.tileID.overscaledZ-J.tileID.overscaledZ),ge=[J.tileID.canonical.x*de%1,J.tileID.canonical.y*de%1]):ne.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const De=q?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(re,N),xe=b.transform,Ne=bf(xe),Fe=o.cf(X.canonical),tt=o.cg(Fe.getCenter().lat);let be,Oe,me,Ae,st;q?(be=Float32Array.from(o.aT(o.ci(X.canonical))),Oe=Float32Array.from(xe.globeMatrix),me=Float32Array.from(o.ce(xe)),Ae=[o.a5(xe.center.lng),o.ae(xe.center.lat)],st=Float32Array.from(o.ch(X.canonical,Fe,tt,xe.worldSize/xe._pixelsPerMercatorPixel))):(be=new Float32Array(16),Oe=new Float32Array(9),me=new Float32Array(16),Ae=[0,0],st=new Float32Array(9));const xt=Yy(De,be,Oe,me,st,ge||[0,0],o.S(b.transform.zoom),Ae,Ne,de||1,ce,250),_t=b.isTileAffectedByFog(X),Dt=b.getOrCreateProgram("rasterParticle",{defines:U,overrideFog:_t});if(b.uploadCommonUniforms(k,Dt,re),q){const Qt=new pr(F.LEQUAL,pr.ReadWrite,b.depthRangeFor3D),cr=0,sr=b.globeSharedBuffers;if(sr){const[ar,kr,Mr]=sr.getGridBuffers(tt,cr!==0);Dt.draw(b,F.TRIANGLES,Qt,Er.disabled,jr.alphaBlended,mr.backCCW,xt,A.id,ar,kr,Mr)}}else{const Qt=b.depthModeForSublayer(0,pr.ReadOnly),cr=G[X.overscaledZ],{tileBoundsBuffer:sr,tileBoundsIndexBuffer:ar,tileBoundsSegments:kr}=b.getTileBoundsBuffers(J);Dt.draw(b,F.TRIANGLES,Qt,cr,jr.alphaBlended,mr.disabled,xt,A.id,sr,ar,kr)}}b.resetStencilClippingMasks()}(h,n,a,d),h.style.map.triggerRepaint())},background:function(h,n,a,d){const m=a.paint.get("background-color"),g=a.paint.get("background-opacity"),b=a.paint.get("background-emissive-strength");if(g===0)return;const S=h.context,A=S.gl,P=h.transform,D=P.tileSize,k=a.paint.get("background-pattern");if(h.isPatternMissing(k,a.scope))return;const F=!k&&m.a===1&&g===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==F)return;const N=Er.disabled,q=h.depthModeForSublayer(0,F==="opaque"?pr.ReadWrite:pr.ReadOnly),G=h.colorModeForDrapableLayerRenderPass(b),W=k?"backgroundPattern":"background";let U,X=d;X||(U=h.getBackgroundTiles(),X=Object.values(U).map(re=>re.tileID)),k&&(S.activeTexture.set(A.TEXTURE0),h.imageManager.bind(h.context,a.scope));for(const re of X){const J=h.isTileAffectedByFog(re),ne=h.getOrCreateProgram(W,{overrideFog:J}),Y=re.toUnwrapped(),se=d?re.projMatrix:h.transform.calculateProjMatrix(Y);h.prepareDrawTile();const ce=n?n.getTile(re):U?U[re.key]:new Vo(re,D,P.zoom,h),de=k?Oc(se,b,g,h,k,a.scope,{tileID:re,tileSize:D}):mf(se,b,g,m);h.uploadCommonUniforms(S,ne,Y);const{tileBoundsBuffer:ge,tileBoundsIndexBuffer:De,tileBoundsSegments:xe}=h.getTileBoundsBuffers(ce);ne.draw(h,A.TRIANGLES,q,N,G,mr.disabled,de,a.id,ge,De,xe)}},sky:function(h,n,a){const d=h._atmosphere?o.S(h.transform.zoom):1,m=a.paint.get("sky-opacity")*d;if(m===0)return;const g=h.context,b=a.paint.get("sky-type"),S=new pr(g.gl.LEQUAL,pr.ReadOnly,[0,1]),A=h.frameCounter/1e3%1;b==="atmosphere"?h.renderPass==="offscreen"?a.needsSkyboxCapture(h)&&(function(P,D,k,F){const N=P.context,q=N.gl;let G=D.skyboxFbo;if(!G){G=D.skyboxFbo=N.createFramebuffer(32,32,!0,null),D.skyboxGeometry=new Ef(N),D.skyboxTexture=N.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,D.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let re=0;re<6;++re)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}N.bindFramebuffer.set(G.framebuffer),N.viewport.set([0,0,32,32]);const W=D.getCenter(P,!0),U=P.getOrCreateProgram("skyboxCapture"),X=new Float64Array(16);o.a6.identity(X),o.a6.rotateY(X,X,.5*-Math.PI),ka(P,D,U,X,W,0),o.a6.identity(X),o.a6.rotateY(X,X,.5*Math.PI),ka(P,D,U,X,W,1),o.a6.identity(X),o.a6.rotateX(X,X,.5*-Math.PI),ka(P,D,U,X,W,2),o.a6.identity(X),o.a6.rotateX(X,X,.5*Math.PI),ka(P,D,U,X,W,3),o.a6.identity(X),ka(P,D,U,X,W,4),o.a6.identity(X),o.a6.rotateY(X,X,Math.PI),ka(P,D,U,X,W,5),N.viewport.set([0,0,P.width,P.height])}(h,a),a.markSkyboxValid(h)):h.renderPass==="sky"&&function(P,D,k,F,N){const q=P.context,G=q.gl,W=P.transform,U=P.getOrCreateProgram("skybox");q.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,D.skyboxTexture);const X=((re,J,ne,Y,se)=>({u_matrix:re,u_sun_direction:J,u_cubemap:0,u_opacity:Y,u_temporal_offset:se}))(W.skyboxMatrix,D.getCenter(P,!1),0,F,N);P.uploadCommonUniforms(q,U),U.draw(P,G.TRIANGLES,k,Er.disabled,P.colorModeForRenderPass(),mr.backCW,X,"skybox",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(h,a,S,m,A):b==="gradient"&&h.renderPass==="sky"&&function(P,D,k,F,N){const q=P.context,G=q.gl,W=P.transform,U=P.getOrCreateProgram("skyboxGradient");D.skyboxGeometry||(D.skyboxGeometry=new Ef(q)),q.activeTexture.set(G.TEXTURE0);let X=D.colorRampTexture;X||(X=D.colorRampTexture=new o.T(q,D.colorRamp,G.RGBA)),X.bind(G.LINEAR,G.CLAMP_TO_EDGE);const re=((J,ne,Y,se,ce)=>({u_matrix:J,u_color_ramp:0,u_center_direction:ne,u_radius:o.bj(Y),u_opacity:se,u_temporal_offset:ce}))(W.skyboxMatrix,D.getCenter(P,!1),D.paint.get("sky-gradient-radius"),F,N);P.uploadCommonUniforms(q,U),U.draw(P,G.TRIANGLES,k,Er.disabled,P.colorModeForRenderPass(),mr.backCW,re,"skyboxGradient",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(h,a,S,m,A)},debug:function(h,n,a,d,m,g){for(let b=0;b<a.length;b++)if(m){const P=new o.ax(d.r*.8,d.g*.8,d.b*.8,1);Jo(h,n,a[b],d,-1,-1,g),Jo(h,n,a[b],d,-1,1,g),Jo(h,n,a[b],d,1,1,g),Jo(h,n,a[b],d,1,-1,g),Jo(h,n,a[b],P,0,0,g)}else Jo(h,n,a[b],d,0,0,g)},custom:function(h,n,a,d){const m=h.context,g=a.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&a.isLayerDraped(n)){if(h.renderPass==="offscreen"){const b=g.prerender;if(b){if(h.setCustomLayerDefaults(),m.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const S=h.transform.pointMerc;b.call(g,m.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),o.S(h.transform.zoom),[S.x,S.y],h.transform.pixelsPerMeterRatio)}else b.call(g,m.gl,h.transform.customLayerMatrix());m.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const S=g.renderToTile;if(S){const A=d[0].canonical,P=new o.L(A.x+d[0].wrap*(1<<A.z),A.y,A.z);m.setDepthMode(pr.disabled),m.setStencilMode(Er.disabled),m.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),S.call(g,m.gl,P),m.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),m.setColorMode(h.colorModeForRenderPass()),m.setStencilMode(Er.disabled);const b=g.renderingMode==="3d"?new pr(h.context.gl.LEQUAL,pr.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,pr.ReadOnly);if(m.setDepthMode(b),h.transform.projection.name==="globe"){const S=h.transform.pointMerc;g.render(m.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),o.S(h.transform.zoom),[S.x,S.y],h.transform.pixelsPerMeterRatio)}else g.render(m.gl,h.transform.customLayerMatrix());m.setDirty(),h.setBaseState(),m.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,n,a,d){if(h.renderPass==="opaque")return;const m=a.paint.get("model-opacity");if(m===0)return;const g=a.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!g||h.terrain&&m<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof o.Z))return;const b=h.shadowRenderer,S=a.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,S||(b.enabled=!1));const A=()=>{b&&(b.useNormalOffset=!0,S||(b.enabled=!0))},P=n.getSource();if(h.renderPass==="light-beam"&&P.type!=="batched-model")return;if(P.type==="vector"||P.type==="geojson")return function(U,X,re,J){const ne=U.transform;if(ne.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${ne.projection.name} projection is not yet implemented`);const Y=ne.getFreeCameraOptions().position;if(!U.modelManager)return;const se=U.modelManager;re.modelManager=se;const ce=U.shadowRenderer;if(!re._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const de=re._unevaluatedLayout._values["model-id"],ge={...re.layout.get("model-id").parameters};for(const De of J){const xe=X.getTile(De).getBucket(re);if(!xe||xe.projection.name!==ne.projection.name)continue;const Ne=jm(De,ne);ge.zoom=Ne;const Fe=de.possiblyEvaluate(ge);if(Af(U,xe,De),ys.shadowUniformsInitialized=!1,ys.useSingleShadowCascade=!!ce&&ce.getMaxCascadeForTile(De.toUnwrapped())===0,U.renderPass==="shadow"&&ce){if(U.currentShadowCascade===1&&xe.isInsideFirstShadowMapFrustum)continue;const Oe=ne.calculatePosMatrix(De.toUnwrapped(),ne.worldSize);if(ys.tileMatrix.set(Oe),ys.shadowTileMatrix=Float32Array.from(ce.calculateShadowPassMatrixFromMatrix(Oe)),ys.aabb.min.fill(0),ys.aabb.max[0]=ys.aabb.max[1]=o.V,ys.aabb.max[2]=0,ev(xe,ys,U,re.scope))continue}const tt=1<<De.canonical.z,be=[((Y.x-De.wrap)*tt-De.canonical.x)*o.V,(Y.y*tt-De.canonical.y)*o.V,Y.z*tt*o.V];for(let Oe in xe.instancesPerModel){const me=xe.instancesPerModel[Oe];me.features.length>0&&(Oe=Fe.evaluate(me.features[0].feature,{}));const Ae=se.getModel(Oe,re.scope);if(Ae&&Ae.uploaded)for(const st of Ae.nodes)If(U,re,st,me,be,De,ys)}}}(h,n,a,d),void A();if(!P.loaded())return;if(P.type==="batched-model")return function(U,X,re,J){re.resetLayerRenderingStats(U);const ne=U.context,Y=U.transform,se=U.style.fog,ce=U.shadowRenderer;if(Y.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${Y.projection.name} projection is not yet implemented`);const de=U.transform.getFreeCameraOptions().position,ge=o.N.scale([],[de.x,de.y,de.z],U.transform.worldSize);o.N.negate(ge,ge);const De=o.a6.identity([]),xe=o.cR(Y.center.lat,Y.zoom),Ne=o.a6.fromScaling([],[1,1,1/xe]);o.a6.translate(De,De,ge);const Fe=re.paint.get("model-opacity"),tt=new pr(ne.gl.LEQUAL,pr.ReadWrite,U.depthRangeFor3D),be=new pr(ne.gl.LEQUAL,pr.ReadOnly,U.depthRangeFor3D),Oe=new o.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),me=U.renderPass==="shadow",Ae=me&&ce?ce.getCurrentCascadeFrustum():Y.getFrustum(Y.scaleZoom(Y.worldSize)),st=re.getLayerRenderingStats(),xt=function(_t,Dt){for(const Qt of J){const cr=X.getTile(Qt).getBucket(re);if(!cr||!cr.uploaded)continue;let sr=!1;ce&&(sr=ce.getMaxCascadeForTile(Qt.toUnwrapped())===0);const ar=Y.calculatePosMatrix(Qt.toUnwrapped(),Y.worldSize),kr=cr.modelTraits;for(const Mr of cr.getNodesInfo()){if(Mr.hiddenByReplacement||!Mr.node.meshes)continue;const Cr=Mr.evaluatedScale,Ir=Mr.node;let nn=0;if(U.terrain&&Ir.elevation&&(nn=Ir.elevation*U.terrain.exaggeration()),Cr[0]<=1&&Cr[1]<=1&&Cr[2]<=1&&(()=>{const kn=Mr.getLocalBounds();return Oe.min=[...kn.min],Oe.max=[...kn.max],Oe.min[2]+=nn,Oe.max[2]+=nn,o.N.transformMat4(Oe.min,Oe.min,ar),o.N.transformMat4(Oe.max,Oe.max,ar),Oe})().intersects(Ae)===0)continue;const Dn=U.renderPass==="light-beam",qr=[...ar];o.a6.translate(qr,qr,[(Ir.anchor?Ir.anchor[0]:0)*(Cr[0]-1),(Ir.anchor?Ir.anchor[1]:0)*(Cr[1]-1),nn]),o.N.exactEquals(Cr,o.cT)||o.a6.scale(qr,qr,Cr),o.a6.multiply(qr,qr,Ir.matrix);const Xn=o.a6.multiply([],Ne,qr);o.a6.multiply(Xn,De,Xn);const Wr=o.a6.invert([],Xn);o.a6.transpose(Wr,Wr),o.a6.scale(Wr,Wr,Al);const cn=o.a6.multiply([],Y.expandedFarZProjMatrix,qr),Yr=kr&o.cV.HasMapboxMeshFeatures,ln=Yr?0:Mr.evaluatedRMEA[0][2];for(let kn=0;kn<Ir.meshes.length;++kn){const mn=Ir.meshes[kn],Ti=kn===Ir.lightMeshIndex;if(Ti){if(!Dn&&!U.terrain&&U.shadowRenderer){U.currentLayer<U.firstLightBeamLayer&&(U.firstLightBeamLayer=U.currentLayer);continue}}else if(Dn)continue;const $i={defines:[]},as=[];if(Zn($i.defines,as,mn,U),Yr||$i.defines.push("DIFFUSE_SHADED"),sr&&$i.defines.push("SHADOWS_SINGLE_CASCADE"),st&&(me?st.numRenderedVerticesInShadowPass+=mn.vertexArray.length:st.numRenderedVerticesInTransparentPass+=mn.vertexArray.length),me){Ce(mn,qr,U,re);continue}let eo=null;if(se){const cs=Oa(qr,U.transform);if(eo=new Float32Array(cs),Y.projection.name!=="globe"){const to=mn.aabb.min,na=mn.aabb.max,[Fa,nu]=se.getOpacityForBounds(cs,to[0],to[1],na[0],na[1]);$i.overrideFog=Fa>=Sr||nu>=Sr}}const ls=mn.material;let Si;ls.occlusionTexture&&ls.occlusionTexture.offsetScale&&(Si=ls.occlusionTexture.offsetScale,$i.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!me&&ce&&(ce.useNormalOffset=!!mn.normalBuffer);const yi=U.getOrCreateProgram("model",$i);!me&&ce&&ce.setupShadowsFromMatrix(qr,yi,ce.useNormalOffset),U.uploadCommonUniforms(ne,yi,Qt.toUnwrapped(),eo);const Yi=ls.pbrMetallicRoughness;Yi.metallicFactor=.9,Yi.roughnessFactor=.5;const es=ih(new Float32Array(cn),new Float32Array(Xn),new Float32Array(Wr),U,Fe,Yi.baseColorFactor,ls.emissiveFactor,Yi.metallicFactor,Yi.roughnessFactor,ls,ln,re,[0,0,0],Si);yi.draw(U,ne.gl.TRIANGLES,Dt&&!Ti?tt:be,Er.disabled,_t?Ti||Fe<1||Mr.hasTranslucentParts?jr.alphaBlended:jr.unblended:jr.disabled,mr.backCCW,es,re.id,mn.vertexBuffer,mn.indexBuffer,mn.segments,re.paint,U.transform.zoom,void 0,as)}}}};(function(_t,Dt,Qt,cr){const sr=_t.terrain?_t.terrain.exaggeration():0,ar=_t.transform.zoom;for(const kr of cr){const Mr=Dt.getTile(kr).getBucket(Qt);Mr&&(_t.conflationActive&&Mr.updateReplacement(kr,_t.replacementSource),Mr.evaluateScale(_t,Qt),_t.terrain&&sr>0&&Mr.elevationUpdate(_t.terrain,sr,kr,Qt.source),Mr.needsReEvaluation(_t,ar,Qt)&&Mr.evaluate(Qt))}})(U,X,re,J),Fe===1?xt(!0,!0):(xt(!1,!0),xt(!0,!1))}(h,n,a,d),void A();const D=P.getModels(),k=[],F=h.transform.getFreeCameraOptions().position,N=o.N.scale([],[F.x,F.y,F.z],h.transform.worldSize);o.N.negate(N,N);const q=[],G=[];let W=0;for(const U of D){const X=a.paint.get("model-rotation").constantOr(null),re=a.paint.get("model-scale").constantOr(null),J=a.paint.get("model-translation").constantOr(null);U.computeModelMatrix(h,X,re,J,!0,!0,!1);const ne=o.a6.identity([]),Y=o.cR(U.position.lat,h.transform.zoom),se=o.a6.fromScaling([],[1,1,1/Y]);o.a6.translate(ne,ne,N),k.push({zScaleMatrix:se,negCameraPosMatrix:ne});for(const ce of U.nodes)$c(h.transform,ce,U.matrix,h.transform.expandedFarZProjMatrix,W,q,G);W++}if(q.sort((U,X)=>X.depth-U.depth),h.renderPass!=="shadow"){if(m===1)for(const U of G)Vc(U,h,a,k[U.modelIndex],Er.disabled,h.colorModeForRenderPass());else{for(const U of G)Vc(U,h,a,k[U.modelIndex],Er.disabled,jr.disabled);for(const U of G)Vc(U,h,a,k[U.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(const U of q)Vc(U,h,a,k[U.modelIndex],Er.disabled,h.colorModeForRenderPass());A()}else{for(const U of G)Ce(U.mesh,U.nodeModelMatrix,h,a);for(const U of q)Ce(U.mesh,U.nodeModelMatrix,h,a);A()}}},Cf={model:function(h,n,a){const d=h.scope,m=n.getSource();if(!m.loaded())return;if(m.type==="vector"||m.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,d));if(m.type==="batched-model")return;const g=m.getModels();for(const b of g)b.upload(a.context)},raster:function(h,n,a){const d=n.getSource();if(!(d instanceof Tt&&d.loaded()))return;const m=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!m)return;const g=h.paint.get("raster-array-band")||d.getInitialBand(m);if(g==null)return;const b=n.getIds().map(S=>n.getTileByID(S));for(const S of b)S.updateNeeded(m,g)&&d.prepareTile(S,m,g)},"raster-particle":function(h,n,a){const d=n.getSource();if(!(d instanceof Tt&&d.loaded()))return;const m=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!m)return;const g=h.paint.get("raster-particle-array-band")||d.getInitialBand(m);if(g==null)return;const b=n.getIds().map(S=>n.getTileByID(S));for(const S of b)S.updateNeeded(m,g)&&d.prepareTile(S,m,g)}};class Hm{constructor(n,a,d,m){this.context=new pm(n,a),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=m,this._debugParams={showTerrainProxyTiles:!1},m.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=Fs.maxUnderzooming+Fs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Hd(this),this._wireframeDebugCache=new Gm,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(n,a){const d=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Wy(this,n));const m=this._terrain;this.transform.elevation=d?m:null,m.update(n,this.transform,a),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(n){const a=n.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,m]=a.getFovAdjustedRange(this.transform._fov);if(d>m)return void(this.transform.fogCullDistSq=null);const g=d+.78*(m-d);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,a){if(this.width=n*o.f.devicePixelRatio,this.height=a*o.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const n=this.context,a=new o.aN;a.emplaceBack(0,0),a.emplaceBack(o.V,0),a.emplaceBack(0,o.V),a.emplaceBack(o.V,o.V),this.tileExtentBuffer=n.createVertexBuffer(a,o.aP.members),this.tileExtentSegments=o.aB.simpleSegment(0,0,4,2);const d=new o.aN;d.emplaceBack(0,0),d.emplaceBack(o.V,0),d.emplaceBack(0,o.V),d.emplaceBack(o.V,o.V),this.debugBuffer=n.createVertexBuffer(d,o.aP.members),this.debugSegments=o.aB.simpleSegment(0,0,4,5);const m=new o.aN;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(m,o.aP.members),this.viewportSegments=o.aB.simpleSegment(0,0,4,2);const g=new o.av;g.emplaceBack(0,0,0,0),g.emplaceBack(o.V,0,o.V,0),g.emplaceBack(0,o.V,0,o.V),g.emplaceBack(o.V,o.V,o.V,o.V),this.mercatorBoundsBuffer=n.createVertexBuffer(g,o.aR.members),this.mercatorBoundsSegments=o.aB.simpleSegment(0,0,4,2);const b=new o.aw;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(b);const S=new o.aO;for(const P of[0,1,3,2,0])S.emplaceBack(P);this.debugIndexBuffer=n.createIndexBuffer(S),this.emptyTexture=new o.T(n,new o.h({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=o.a6.create();const A=this.context.gl;this.stencilClearMode=new Er({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,pr.disabled,this.stencilClearMode,jr.disabled,mr.disabled,rf(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,d){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const A of d)if(this._tileClippingMaskIDs[A.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=a.id;const m=this.context,g=m.gl;this.nextStencilID+d.length>256&&this.clearStencil(),m.setColorMode(jr.disabled),m.setDepthMode(pr.disabled);const b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of d){const A=a.getTile(S),P=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:k,tileBoundsSegments:F}=this.getTileBoundsBuffers(A);b.draw(this,g.TRIANGLES,pr.disabled,new Er({func:g.ALWAYS,mask:0},P,255,g.KEEP,g.KEEP,g.REPLACE),jr.disabled,mr.disabled,rf(S.projMatrix),"$clipping",D,k,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,a=this.context.gl;return new Er({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const a=this.context.gl;return new Er({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){const a=this.context.gl,d=n.sort((b,S)=>S.overscaledZ-b.overscaledZ),m=d[d.length-1].overscaledZ,g=d[0].overscaledZ-m+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const b={};for(let S=0;S<g;S++)b[S+m]=new Er({func:a.GEQUAL,mask:255},S+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=g,[b,d]}return[{[m]:Er.disabled},d]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new jr([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new o.ax(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?jr.unblended:jr.alphaBlended}colorModeForDrapableLayerRenderPass(n){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new jr([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new o.ax(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,a,d,m=!1){if(!this.opaquePassEnabledForLayer()&&!m)return pr.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new pr(d||this.context.gl.LEQUAL,a,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,a){this._wireframeDebugCache.update(this.frameCounter),this.style=n,this.options=a;const d=this.style._mergedLayers,m=this.style.order,g=m.map(Y=>d[Y]),b=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(o.f.now()),this.imageManager.beginFrame();let S=0,A=!1;for(const Y in b){const se=b[Y];se.used&&(se.prepare(this.context),se.getSource().usedInConflation&&++S)}for(const Y of g)Y.isHidden(this.transform.zoom)||this.prepareLayer(Y);const P={},D={},k={},F={},N={};for(const Y in b){const se=b[Y];P[Y]=se.getVisibleCoordinates(),D[Y]=P[Y].slice().reverse(),k[Y]=se.getVisibleCoordinates(!0).reverse(),F[Y]=se.getShadowCasterCoordinates(),N[Y]=se.sortCoordinatesByDistance(P[Y])}const q=Y=>{const se=this.style.getLayerSourceCache(Y);return se&&se.used?se.getSource():null};if(S){const Y=[];for(const se of g)this.layerUsedInConflation(se,q(se))&&Y.push(se);if(Y&&Y.length>1){const se=[];for(const ce of Y){const de=this.style.getLayerSourceCache(ce);de&&de.used&&de.getSource().usedInConflation&&se.push({layer:ce.fqid,cache:de})}this.replacementSource.setSources(se),A=!0}}A||this.replacementSource.clear(),this.conflationActive=A,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const Y of g){const se=Y.cutoffRange();if(this.longestCutoffRange=Math.max(se,this.longestCutoffRange),se>0){const ce=q(Y);ce&&(this.minCutoffZoom=Math.max(ce.minzoom,this.minCutoffZoom)),Y.minzoom&&(this.minCutoffZoom=Math.max(Y.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let Y=0;Y<g.length;Y++)if(g[Y].is3D()){this.opaquePassCutoff=Y;break}const G=this.style&&this.style.fog;G?(this._fogVisible=G.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=G.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(k),this.opaquePassCutoff=0);const W=this._shadowRenderer;if(W){W.updateShadowParameters(this.transform,this.style.directionalLight);for(const Y in b)for(const se of P[Y]){let ce={min:0,max:0};this.terrain&&(ce=this.terrain.getMinMaxForTile(se)||ce),W.addShadowReceiver(se.toUnwrapped(),ce.min,ce.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new dr(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!o.cZ(this.context.gl))return;this.renderPass="offscreen";for(const Y of g){const se=n.getLayerSourceCache(Y);if(!Y.hasOffscreenPass()||Y.isHidden(this.transform.zoom))continue;const ce=se?D[se.id]:void 0;(Y.type==="custom"||Y.type==="raster"||Y.type==="raster-particle"||Y.isSky()||ce&&ce.length)&&this.renderLayer(this,se,Y,ce)}this.depthRangeFor3D=[0,1-(g.length+2)*this.numSublayers*this.depthEpsilon];const U=this.terrain;U&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&U.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,F)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const X=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),re=(()=>{if(a.showOverdrawInspector)return o.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!X){const Y=this.style.fog.properties.get("color").toArray01();return new o.ax(...Y)}if(this.style.fog&&this.transform.projection.supportsFog&&X){const Y=this.style.fog.properties.get("space-color").toArray01();return new o.ax(...Y)}return o.ax.transparent})();if(this.context.clear({color:re,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&X&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const Y=g[this.currentLayer],se=n.getLayerSourceCache(Y);if(Y.isSky())continue;const ce=se?(Y.is3D()?N:D)[se.id]:void 0;this._renderTileClippingMasks(Y,se,ce),this.renderLayer(this,se,Y,ce)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&X&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.S(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const Y=g[this.currentLayer],se=n.getLayerSourceCache(Y);Y.isSky()&&this.renderLayer(this,se,Y,se?D[se.id]:void 0)}function J(Y,se){let ce;return se&&(ce=(Y.type==="symbol"?k:Y.is3D()?N:D)[se.id]),ce}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<m.length;){const Y=g[this.currentLayer];if(Y.type==="raster"){const se=n.getLayerSourceCache(Y);this.renderLayer(this,se,Y,J(Y,se))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ne=0;for(W&&(ne=W.getShadowCastingLayerCount());this.currentLayer<m.length;){const Y=g[this.currentLayer],se=n.getLayerSourceCache(Y);if(Y.isSky())++this.currentLayer;else if(U&&this.style.isLayerDraped(Y)){if(Y.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=U.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(Y,se,se?P[se.id]:void 0),this.renderLayer(this,se,Y,J(Y,se)),!U&&W&&ne>0&&Y.hasShadowPass()&&--ne==0&&(W.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ce=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ce;this.currentLayer++){const de=g[this.currentLayer];if(!de.hasLightBeamPass())continue;const ge=n.getLayerSourceCache(de);this.renderLayer(this,ge,de,ge?D[ge.id]:void 0)}this.currentLayer=ce,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Y=null;g.forEach(se=>{const ce=n.getLayerSourceCache(se);ce&&!se.isHidden(this.transform.zoom)&&ce.getVisibleCoordinates().length&&(!Y||Y.getSource().maxzoom<ce.getSource().maxzoom)&&(Y=ce)}),Y&&this.options.showTileBoundaries&&jc.debug(this,Y,Y.getVisibleCoordinates(),o.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&jc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Y){const se=Y.transform.padding;Sf(Y,Y.transform.height-(se.top||0),3,ss),Sf(Y,se.bottom||0,3,Ko),gs(Y,se.left||0,3,Um),gs(Y,Y.transform.width-(se.right||0),3,wf);const ce=Y.transform.centerPoint;(function(de,ge,De,xe){Yn(de,ge-1,De-10,2,20,xe),Yn(de,ge-10,De-1,20,2,xe)})(Y,ce.x,Y.transform.height-ce.y,Tf)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),A||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:a}=this.transform.projection,d=!a||!a.includes(n.type);if(Cf[n.type]&&(d||this.terrain&&n.type==="custom")){const m=this.style.getLayerSourceCache(n);Cf[n.type](n,m,this)}this.gpuTimingEnd()}renderLayer(n,a,d,m){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||m&&m.length)&&(this.id=d.id,this.gpuTimingStart(d),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(d.type)||n.terrain&&d.type==="custom")&&jc[d.type](n,a,d,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,d=this.context.gl;let m=this.gpuTimers[n.id];m||(m=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:d.createQuery()}),m.calls++,d.beginQuery(a.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,a=this.context.gl,d=a.createQuery();this.deferredRenderGpuTimeQueries.push(d),a.beginQuery(n.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const a={};for(const d in n){const m=n[d],g=this.context.extTimerQuery,b=g.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;g.deleteQueryEXT(m.query),a[d]=b}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.extTimerQuery,d=this.context.gl;let m=0;for(const g of n)m+=a.getQueryParameter(g,d.QUERY_RESULT)/1e6,a.deleteQueryEXT(g);return m}translatePosMatrix(n,a,d,m,g){if(!d[0]&&!d[1])return n;const b=g?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(b){const P=Math.sin(b),D=Math.cos(b);d=[d[0]*D-d[1]*P,d[0]*P+d[1]*D]}const S=[g?d[0]:o.a3(a,d[0],this.transform.zoom),g?d[1]:o.a3(a,d[1],this.transform.zoom),0],A=new Float32Array(16);return o.a6.translate(A,n,S),A}saveTileTexture(n){const a=n.size[0],d=this._tileTextures[a];d?d.push(n):this._tileTextures[a]=[n]}getTileTexture(n){const a=this._tileTextures[n];return a&&a.length>0?a.pop():null}isPatternMissing(n,a){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString(),a)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,a,d){const m=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,g=this.terrain&&this.terrain.exaggeration()===0,b=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||b.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?b.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):b.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT"),g&&b.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||m||a!==void 0&&!a||b.push("FOG","FOG_DITHERING"),m&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(n,a){this.cache=this.cache||{};const d=a&&a.defines||[],m=a&&a.config,g=a&&a.transformFeedback,b=this.currentGlobalDefines(n,a&&a.overrideFog,a&&a.overrideRtt).concat(d),S=af.cacheKey(Kd[n],n,b,m);return this.cache[S]||(this.cache[S]=new af(this.context,n,Kd[n],m,Xy[n],b,g)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,a){if(this.style.enable3dLights()){const d=this.style.directionalLight,m=this.style.ambientLight;if(d&&m){const g=((b,S)=>{const A=b.properties.get("direction"),P=b.properties.get("color").toArray01(),D=b.properties.get("intensity"),k=S.properties.get("color").toArray01(),F=S.properties.get("intensity"),N=[A.x,A.y,A.z],q=o.cn(k,F),G=o.cn(P,D);return{u_lighting_ambient_color:q,u_lighting_directional_dir:N,u_lighting_directional_color:G,u_ground_radiance:sf(N,G,q)}})(d,m);a.setLightsUniformValues(n,g)}}}uploadCommonUniforms(n,a,d,m,g){if(this.uploadCommonLightUniforms(n,a),this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const S=b.getOpacity(this.transform.pitch),A=((P,D,k,F,N,q,G,W,U,X,re,J)=>{const ne=P.transform,Y=D.properties.get("color").toArray01();Y[3]=F;const se=P.frameCounter/1e3%1,[ce,de]=D.properties.get("vertical-range");return{u_fog_matrix:k?ne.calculateFogTileMatrix(k):J||P.identityMat,u_fog_range:D.getFovAdjustedRange(ne._fov),u_fog_color:Y,u_fog_horizon_blend:D.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ce,de),de],u_fog_temporal_offset:se,u_frustum_tl:N,u_frustum_tr:q,u_frustum_br:G,u_frustum_bl:W,u_globe_pos:U,u_globe_radius:X,u_viewport:re,u_globe_transition:o.S(ne.zoom),u_is_globe:+(ne.projection.name==="globe")}})(this,b,d,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.f.devicePixelRatio,this.transform.height*o.f.devicePixelRatio],m);a.setFogUniformValues(n,A)}g&&a.setCutoffUniformValues(n,g.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,a=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const m of d)a[m.key]=n[m.key]||new Vo(m,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(n,a){return!(!n.is3D()||n.minzoom&&n.minzoom>this.transform.zoom||n.sourceLayer!=="building"&&(!a||a.type!=="batched-model"))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[n.key];return a||(this._cachedTileFogOpacities[n.key]=a=this.style.fog.getOpacityForTile(n)),a[0]>=Sr||a[1]>=Sr}}function Gc(h,n){let a=!1,d=null;const m=()=>{d=null,a&&(h(),d=setTimeout(m,n),a=!1)};return()=>(a=!0,d||m(),d)}class ah{constructor(n){this._hashName=n&&encodeURIComponent(n),o.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Gc(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const a=Pf(n);if(this._hashName){const d=this._hashName;let m=!1;const g=location.hash.slice(1).split("&").map(b=>{const S=b.split("=")[0];return S===d?(m=!0,`${S}=${a}`):b}).filter(b=>b);return m||g.push(`${d}=${a}`),`#${g.join("&")}`}return`#${a}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(a=d)}),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(d=>isNaN(d))){const d=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Pf(h,n){const a=h.getCenter(),d=Math.round(100*h.getZoom())/100,m=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,m),b=Math.round(a.lng*g)/g,S=Math.round(a.lat*g)/g,A=h.getBearing(),P=h.getPitch();let D=n?`/${b}/${S}/${d}`:`${d}/${S}/${b}`;return(A||P)&&(D+="/"+Math.round(10*A)/10),P&&(D+=`/${Math.round(P)}`),D}const Hc={linearity:.3,easing:o.c_(0,0,.3,1)},os=o.e({deceleration:2500,maxSpeed:1400},Hc),rv=o.e({deceleration:20,maxSpeed:1400},Hc),lh=o.e({deceleration:1e3,maxSpeed:360},Hc),$n=o.e({deceleration:1e3,maxSpeed:90},Hc);class wn{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.f.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,a=o.f.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)a.zoom+=g.zoomDelta||0,a.bearing+=g.bearingDelta||0,a.pitch+=g.pitchDelta||0,g.panDelta&&a.pan._add(g.panDelta),g.around&&(a.around=g.around),g.pinchAround&&(a.pinchAround=g.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(a.pan.mag()){const g=Us(a.pan.mag(),d,o.e({},os,n||{}));m.offset=a.pan.mult(g.amount/a.pan.mag()),m.center=this._map.transform.center,qc(m,g)}if(a.zoom){const g=Us(a.zoom,d,rv);m.zoom=this._map.transform.zoom+g.amount,qc(m,g)}if(a.bearing){const g=Us(a.bearing,d,lh);m.bearing=this._map.transform.bearing+o.aa(g.amount,-179,179),qc(m,g)}if(a.pitch){const g=Us(a.pitch,d,$n);m.pitch=this._map.transform.pitch+g.amount,qc(m,g)}if(m.zoom||m.bearing){const g=a.pinchAround===void 0?a.around:a.pinchAround;m.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function qc(h,n){(!h.duration||h.duration<n.duration)&&(h.duration=n.duration,h.easing=n.easing)}function Us(h,n,a){const{maxSpeed:d,linearity:m,deceleration:g}=a,b=o.aa(h*m/(n/1e3),-d,d),S=Math.abs(b)/(g*m);return{easing:a.easing,duration:1e3*S,amount:b*(S/2)}}class Qi extends o.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d,m={}){const g=ht(a.getCanvasContainer(),d),b=a.unproject(g);super(n,o.e({point:g,lngLat:b,originalEvent:d},m)),this._defaultPrevented=!1,this.target=a}}class wo extends o.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d){const m=n==="touchend"?d.changedTouches:d.touches,g=lt(a.getCanvasContainer(),m),b=g.map(A=>a.unproject(A)),S=g.reduce((A,P,D,k)=>A.add(P.div(k.length)),new o.P(0,0));super(n,{points:g,point:S,lngLats:b,lngLat:a.unproject(S),originalEvent:d}),this._defaultPrevented=!1}}class Df extends o.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d){super(n,{originalEvent:d}),this._defaultPrevented=!1}}class Lf{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Df(n.type,this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new Qi(n.type,this._map,n))}mouseup(n){this._map.fire(new Qi(n.type,this._map,n))}preclick(n){const a=o.e({},n);a.type="preclick",this._map.fire(new Qi(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Qi(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Qi(n.type,this._map,n))}mouseover(n){this._map.fire(new Qi(n.type,this._map,n))}mouseout(n){this._map.fire(new Qi(n.type,this._map,n))}touchstart(n){return this._firePreventable(new wo(n.type,this._map,n))}touchmove(n){this._map.fire(new wo(n.type,this._map,n))}touchend(n){this._map.fire(new wo(n.type,this._map,n))}touchcancel(n){this._map.fire(new wo(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qo{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Qi(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Qi(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ea{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&n.button===0&&(mt(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;const d=a,m=this._startPos,g=this._lastPos;if(!m||!g||g.equals(d)||!this._box&&d.dist(m)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=oe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const b=Math.min(m.x,d.x),S=Math.max(m.x,d.x),A=Math.min(m.y,d.y),P=Math.max(m.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${A}px)`,this._box.style.width=S-b+"px",this._box.style.height=P-A+"px")})}mouseupWindow(n,a){if(!this._active)return;const d=this._startPos,m=a;if(d&&n.button===0){if(this.reset(),ut(),d.x!==m.x||d.y!==m.y)return this._map.fire(new o.b("boxzoomend",{originalEvent:n})),{cameraAnimation:g=>g.fitScreenCoordinates(d,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),gt(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new o.b(n,{originalEvent:a}))}}function Il(h,n){const a={};for(let d=0;d<h.length;d++)a[h[d].identifier]=n[d];return a}class ch{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){const g=new o.P(0,0);for(const b of m)g._add(b);return g.div(m.length)}(a),this.touches=Il(d,a)))}touchmove(n,a,d){if(this.aborted||!this.centroid)return;const m=Il(d,a);for(const g in this.touches){const b=m[g];(!b||b.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(n,a,d){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Wc{constructor(n){this.singleTap=new ch(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,d){this.singleTap.touchstart(n,a,d)}touchmove(n,a,d){this.singleTap.touchmove(n,a,d)}touchend(n,a,d){const m=this.singleTap.touchend(n,a,d);if(m){const g=n.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(m)<30;if(g&&b||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Rf{constructor(){this._zoomIn=new Wc({numTouches:1,numTaps:2}),this._zoomOut=new Wc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,d){this._zoomIn.touchstart(n,a,d),this._zoomOut.touchstart(n,a,d)}touchmove(n,a,d){this._zoomIn.touchmove(n,a,d),this._zoomOut.touchmove(n,a,d)}touchend(n,a,d){const m=this._zoomIn.touchend(n,a,d),g=this._zoomOut.touchend(n,a,d);return m?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(m)},{originalEvent:n})}):g?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(g)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const kf={0:1,2:2};class Qs{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;const d=Qe(n);this._correctButton(n,d)&&(this._lastPoint=a,this._eventButton=d)}mousemoveWindow(n,a){const d=this._lastPoint;if(d){if(n.preventDefault(),this._eventButton!=null&&function(m,g){const b=kf[g];return m.buttons===void 0||(m.buttons&b)!==b}(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(d,a)}}mouseupWindow(n){this._lastPoint&&Qe(n)===this._eventButton&&(this._moved&&ut(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Of extends Qs{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return a===0&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class Yc extends Qs{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){const d=.8*(a.x-n.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(n){n.preventDefault()}}class uh extends Qs{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){const d=-.5*(a.y-n.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(n){n.preventDefault()}}class zf{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),o.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(n,a,d){return this._calculateTransform(n,a,d)}touchmove(n,a,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!o.c$())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,d)}}touchend(n,a,d){this._calculateTransform(n,a,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,d){d.length>0&&(this._active=!0);const m=Il(d,a),g=new o.P(0,0),b=new o.P(0,0);let S=0;for(const P in m){const D=m[P],k=this._touches[P];k&&(g._add(D),b._add(D.sub(k)),S++,m[P]=D)}if(this._touches=m,S<this._minTouches||!b.mag())return;const A=b.div(S);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(S),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=oe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class wi{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,d){return{}}touchstart(n,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,d){const m=this._firstTwoTouches;if(!m)return;n.preventDefault();const[g,b]=m,S=Cl(d,a,g),A=Cl(d,a,b);if(!S||!A)return;const P=this._aroundCenter?null:S.add(A).div(2);return this._move([S,A],P,n)}touchend(n,a,d){if(!this._firstTwoTouches)return;const[m,g]=this._firstTwoTouches,b=Cl(d,a,m),S=Cl(d,a,g);b&&S||(this._active&&ut(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Cl(h,n,a){for(let d=0;d<h.length;d++)if(h[d].identifier===a)return n[d]}function hh(h,n){return Math.log(h/n)/Math.LN2}class Zc extends wi{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){const d=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(hh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:hh(this._distance,d),pinchAround:a}}}function ta(h,n){return 180*h.angleWith(n)/Math.PI}class Ff extends wi{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){const d=this._vector;if(this._vector=n[0].sub(n[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ta(this._vector,d),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const a=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const m=ta(n,d);return Math.abs(m)<a}}function Xc(h){return Math.abs(h.y)>Math.abs(h.x)}class Bf extends wi{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Xc(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,d){const m=this._lastPoints;if(!m)return;const g=n[0].sub(m[0]),b=n[1].sub(m[1]);return this._map._cooperativeGestures&&!o.c$()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(g,b,d.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(g.y+b.y)/2*-.5})}gestureBeginsVertically(n,a,d){if(this._valid!==void 0)return this._valid;const m=n.mag()>=2,g=a.mag()>=2;if(!m&&!g)return;if(!m||!g)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const b=n.y>0==a.y>0;return Xc(n)&&Xc(a)&&b}}const za={panStep:100,bearingStep:15,pitchStep:10};class Kc{constructor(){const n=za;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,d=0,m=0,g=0,b=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?d=-1:(n.preventDefault(),g=-1);break;case 39:n.shiftKey?d=1:(n.preventDefault(),g=1);break;case 38:n.shiftKey?m=1:(n.preventDefault(),b=-1);break;case 40:n.shiftKey?m=-1:(n.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:S=>{const A=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Nf,zoom:a?Math.round(A)+a*(n.shiftKey?2:1):A,bearing:S.getBearing()+d*this._bearingStep,pitch:S.getPitch()+m*this._pitchStep,offset:[-g*this._panStep,-b*this._panStep],center:S.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Nf(h){return h*(2-h)}const Jc=4.000244140625,Vf=1/450;class qm{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Vf,o.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||o.c$()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const d=o.f.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%Jc==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(m*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=ht(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>Jc?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&D!==0&&(D=1/D);const k=a(),F=Math.pow(2,k),N=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(N*D))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a(),m=this._startZoom,g=this._easing;let b,S=!1;if(this._type==="wheel"&&m&&g){const P=Math.min((o.f.now()-this._lastWheelEventTime)/200,1),D=g(P);b=o.U(m,d,D),P<1?this._frameId||(this._frameId=!0):S=!0}else b=d,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=b-a();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=o.d0;if(this._prevEase){const d=this._prevEase,m=(o.f.now()-d.start)/d.duration,g=d.easing(m+.01)-d.easing(m),b=.27/Math.sqrt(g*g+1e-4)*.01,S=Math.sqrt(.0729-b*b);a=o.c_(b,S,.25,1)}return this._prevEase={start:o.f.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=oe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Wm{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ym{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(n.shiftKey?-1:1),around:d.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zm{constructor(){this._tap=new Wc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,d){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=a[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(n,a,d))}touchmove(n,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const m=a[0],g=m.y-this._swipePoint.y;return this._swipePoint=m,n.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(n,a,d)}touchend(n,a,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(n,a,d)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xm{constructor(n,a,d){this._el=n,this._mousePan=a,this._touchPan=d}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Km{constructor(n,a,d){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Jm{constructor(n,a,d,m){this._el=n,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Qc=h=>h.zoom||h.drag||h.pitch||h.rotate;class Qm extends o.b{}class e_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){const d=o.N.sub([],a,n);this.radius=o.N.length(d[2]<0?o.N.div([],d,this.constants):[d[0],d[1],0])}projectRay(n){o.N.div(n,n,this.constants),o.N.normalize(n,n),o.N.mul(n,n,this.constants);const a=o.N.scale([],n,this.radius);if(a[2]>0){const d=o.N.scale([],[0,0,1],o.N.dot(a,[0,0,1])),m=o.N.scale([],o.N.normalize([],[a[0],a[1],0]),this.radius),g=o.N.add([],a,o.N.scale([],o.N.sub([],o.N.add([],m,d),a),2));a[0]=g[0],a[1]=g[1]}return a}}function eu(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class nv{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wn(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new e_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),o.aY(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,g,b]of this._listeners){const S=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(g,S,b)}}destroy(){for(const[n,a,d]of this._listeners){const m=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(a,m,d)}}_addDefaultHandlers(n){const a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new Lf(a,n));const m=a.boxZoom=new ea(a,n);this._add("boxZoom",m);const g=new Rf,b=new Ym;a.doubleClickZoom=new Wm(b,g),this._add("tapZoom",g),this._add("clickZoom",b);const S=new Zm;this._add("tapDragZoom",S);const A=a.touchPitch=new Bf(a);this._add("touchPitch",A);const P=new Yc(n),D=new uh(n);a.dragRotate=new Km(n,P,D),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const k=new Of(n),F=new zf(a,n);a.dragPan=new Xm(d,k,F),this._add("mousePan",k),this._add("touchPan",F,["touchZoom","touchRotate"]);const N=new Ff,q=new Zc;a.touchZoomRotate=new Jm(d,q,N,S),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Qo(a));const G=a.scrollZoom=new qm(a,this);this._add("scrollZoom",G,["mousePan"]);const W=a.keyboard=new Kc;this._add("keyboard",W);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[U]&&a[U].enable(n[U])}_add(n,a,d){this._handlers.push({handlerName:n,handler:a,allowed:d}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Qc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,a,d){for(const m in n)if(m!==d&&(!a||a.indexOf(m)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const a=[];for(const d of n)this._el.contains(d.target)&&a.push(d);return a}handleEvent(n,a){this._updatingCamera=!0;const d=n.type==="renderFrame",m=d?void 0:n,g={needsRenderFrame:!1},b={},S={},A=n.touches?this._getMapTouches(n.touches):void 0,P=A?lt(this._el,A):d?void 0:ht(this._el,n);for(const{handlerName:F,handler:N,allowed:q}of this._handlers){if(!N.isEnabled())continue;let G;this._blockedByActive(S,q,F)?N.reset():N[a||n.type]&&(G=N[a||n.type](n,P,A),this.mergeHandlerResult(g,b,G,F,m),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||N.isActive())&&(S[F]=N)}const D={};for(const F in this._previousActiveHandlers)S[F]||(D[F]=m);this._previousActiveHandlers=S,(Object.keys(D).length||eu(g))&&(this._changes.push([g,b,D]),this._triggerRenderFrame()),(Object.keys(S).length||eu(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:k}=g;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))}mergeHandlerResult(n,a,d,m,g){if(!d)return;o.e(n,d);const b={handlerName:m,originalEvent:d.originalEvent||g};d.zoomDelta!==void 0&&(a.zoom=b),d.panDelta!==void 0&&(a.drag=b),d.pitchDelta!==void 0&&(a.pitch=b),d.bearingDelta!==void 0&&(a.rotate=b)}_applyChanges(){const n={},a={},d={};for(const[m,g,b]of this._changes)m.panDelta&&(n.panDelta=(n.panDelta||new o.P(0,0))._add(m.panDelta)),m.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(n.around=m.around),m.aroundCoord!==void 0&&(n.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(n.pinchAround=m.pinchAround),m.noInertia&&(n.noInertia=m.noInertia),o.e(a,g),o.e(d,b);this._updateMapTransform(n,a,d),this._changes=[]}_updateMapTransform(n,a,d){const m=this._map,g=m.transform,b=X=>[X.x,X.y,X.z];if((X=>{const re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!eu(n)){const X=g.zoom;g.cameraElevationReference="sea",this._originalZoom!=null&&g._orthographicProjectionAtLowPitch&&g.projection.name!=="globe"&&g.pitch===0?(g.cameraElevationReference="ground",g.zoom=this._originalZoom):(g.recenterOnTerrain(),g.cameraElevationReference="ground"),X!==g.zoom&&this._map._update(!0)}if(g._isCameraConstrained&&m._stop(!0),!eu(n))return void this._fireEvents(a,d,!0);let{panDelta:S,zoomDelta:A,bearingDelta:P,pitchDelta:D,around:k,aroundCoord:F,pinchAround:N}=n;g._isCameraConstrained&&(A>0&&(A=0),g._isCameraConstrained=!1),N!==void 0&&(k=N),(A||(X=>a[X]&&!this._eventsInProgress[X])("drag"))&&k&&(this._dragOrigin=b(g.pointCoordinate3D(k)),this._originalZoom=g.zoom,this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",m._stop(!0),k=k||m.transform.centerPoint,P&&(g.bearing+=P),D&&(g.pitch+=D),g._updateCameraState();const q=[0,0,0];if(S)if(g.projection.name==="mercator"){const X=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(k).dir),re=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(k.sub(S)).dir);q[0]=re[0]-X[0],q[1]=re[1]-X[1]}else{const X=g.pointCoordinate(k);if(g.projection.name==="globe"){S=S.rotate(-g.angle);const re=g._pixelsPerMercatorPixel/g.worldSize;q[0]=-S.x*o.d1(o.au(X.y))*re,q[1]=-S.y*o.d1(g.center.lat)*re}else{const re=g.pointCoordinate(k.sub(S));X&&re&&(q[0]=re.x-X.x,q[1]=re.y-X.y)}}const G=g.zoom,W=[0,0,0];if(A){const X=b(F||g.pointCoordinate3D(k)),re={dir:o.N.normalize([],o.N.sub([],X,g._camera.position))};if(re.dir[2]<0){const J=g.zoomDeltaToMovement(X,A);o.N.scale(W,re.dir,J)}}const U=o.N.add(q,q,W);g._translateCameraConstrained(U),A&&Math.abs(g.zoom-G)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,d,!0)}_fireEvents(n,a,d){const m=Qc(this._eventsInProgress),g=Qc(n),b={};for(const D in n){const{originalEvent:k}=n[D];this._eventsInProgress[D]||(b[`${D}start`]=k),this._eventsInProgress[D]=n[D]}!m&&g&&this._fireEvent("movestart",g.originalEvent);for(const D in b)this._fireEvent(D,b[D]);g&&this._fireEvent("move",g.originalEvent);for(const D in n){const{originalEvent:k}=n[D];this._fireEvent(D,k)}const S={};let A;for(const D in this._eventsInProgress){const{handlerName:k,originalEvent:F}=this._eventsInProgress[D];this._handlersById[k].isActive()||(delete this._eventsInProgress[D],A=a[k]||F,S[`${D}end`]=A)}for(const D in S)this._fireEvent(D,S[D]);const P=Qc(this._eventsInProgress);if(d&&(m||g)&&!P){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;D?(k(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:A})):(this._map.fire(new o.b("moveend",{originalEvent:A})),k(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new o.b(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Qm("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const t_="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ni extends o.E{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,o.aY(["_renderFrameCallback"],this)}getCenter(){return new o.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,d){return n=o.P.convert(n).mult(-1),this.panTo(this.transform.center,o.e({offset:n},a),d)}panTo(n,a,d){return this.easeTo(o.e({center:n},a),d)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,d){return this.easeTo(o.e({zoom:n},a),d)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,d){return this.easeTo(o.e({bearing:n},a),d)}resetNorth(n,a){return this.rotateTo(0,o.e({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){n=o.ad.convert(n);const d=a&&a.bearing||0,m=a&&a.pitch||0,g=n.getNorthWest(),b=n.getSouthEast();return this._cameraForBounds(this.transform,g,b,d,m,a)}_extendCameraOptions(n){const a={top:0,bottom:0,right:0,left:0};if(typeof(n=o.e({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const d=n.padding;n.padding={top:d,bottom:d,right:d,left:d}}return n.padding=o.e(a,n.padding),n}_minimumAABBFrustumDistance(n,a){const d=a.max[0]-a.min[0],m=a.max[1]-a.min[1];return d/m>n.aspect?d/(2*Math.tan(.5*n.fovX)*n.aspect):m/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,a,d,m,g,b){const S=n.clone(),A=this._extendCameraOptions(b);S.bearing=m,S.pitch=g;const P=o.bn.convert(a),D=o.bn.convert(d),k=.5*(P.lat+D.lat),F=.5*(P.lng+D.lng),N=o.d2(k,F),q=o.N.normalize([],N),G=o.N.normalize([],o.N.cross([],q,[0,1,0])),W=o.N.cross([],G,q),U=[G[0],G[1],G[2],0,W[0],W[1],W[2],0,q[0],q[1],q[2],0,0,0,0,1],X=[N,o.d2(P.lat,P.lng),o.d2(D.lat,P.lng),o.d2(D.lat,D.lng),o.d2(P.lat,D.lng),o.d2(k,P.lng),o.d2(k,D.lng),o.d2(P.lat,F),o.d2(D.lat,F)];let re=o.bS.fromPoints(X.map(Ae=>[o.N.dot(G,Ae),o.N.dot(W,Ae),o.N.dot(q,Ae)]));const J=o.N.transformMat4([],re.center,U);o.N.squaredLength(J)===0&&o.N.set(J,0,0,1),o.N.normalize(J,J),o.N.scale(J,J,o.ab),S.center=o.d3(J);const ne=S.getWorldToCameraMatrix(),Y=o.a6.invert(new Float64Array(16),ne);re=o.bS.applyTransform(re,o.a6.multiply([],ne,U)),o.N.transformMat4(J,J,ne);const se=.5*(re.max[2]-re.min[2]),ce=this._minimumAABBFrustumDistance(S,re),de=o.N.scale([],[0,0,1],se),ge=o.N.add(de,J,de),De=ce+(S.pitch===0?0:o.N.distance(J,ge)),xe=S.globeCenterInViewSpace,Ne=o.N.sub([],J,[xe[0],xe[1],xe[2]]);o.N.normalize(Ne,Ne),o.N.scale(Ne,Ne,De);const Fe=o.N.add([],J,Ne);o.N.transformMat4(Fe,Fe,Y);const tt=o.d4/o.ab,be=o.N.length(Fe),Oe=o.bl(Math.max(be*tt-o.d4,Number.EPSILON),0),me=Math.min(S.zoomFromMercatorZAdjusted(Oe),A.maxZoom);return me>.5*(o.bG+o.bx)?(S.setProjection({name:"mercator"}),S.zoom=me,this._cameraForBounds(S,a,d,m,g,b)):{center:S.center,zoom:me,bearing:m,pitch:g}}queryTerrainElevation(n,a){const d=this.transform.elevation;return d?(a=o.e({},{exaggerated:!0},a),d.getAtPoint(o.L.fromLngLat(n),null,a.exaggerated)):null}_cameraForBounds(n,a,d,m,g,b){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,a,d,m,g,b);const S=n.clone(),A=this._extendCameraOptions(b),P=S.padding;S.bearing=m,S.pitch=g;const D=o.bn.convert(a),k=o.bn.convert(d),F=new o.bn(D.lng,k.lat),N=new o.bn(k.lng,D.lat),q=S.project(D),G=S.project(k),W=this.queryTerrainElevation(D),U=this.queryTerrainElevation(k),X=this.queryTerrainElevation(F),re=this.queryTerrainElevation(N),J=[[q.x,q.y,Math.min(W||0,U||0,X||0,re||0)],[G.x,G.y,Math.max(W||0,U||0,X||0,re||0)]];let ne=o.bS.fromPoints(J);const Y=S.getWorldToCameraMatrix(),se=o.a6.invert(new Float64Array(16),Y);ne=o.bS.applyTransform(ne,Y);const ce=o.N.sub([],ne.max,ne.min),de=P.left||0,ge=P.right||0,De=P.bottom||0,xe=P.top||0,{left:Ne,right:Fe,top:tt,bottom:be}=A.padding,Oe=.5*(de+ge),me=.5*(xe+De),Ae=Math.min(S.scaleZoom(S.scale*Math.min((S.width-(de+ge+Ne+Fe))/ce[0],(S.height-(De+xe+be+tt))/ce[1])),A.maxZoom),st=S.scale/S.zoomScale(Ae);ne=new o.bS([ne.min[0]-(Ne+Oe)*st,ne.min[1]-(be+me)*st,ne.min[2]],[ne.max[0]+(Fe+Oe)*st,ne.max[1]+(tt+me)*st,ne.max[2]]);const xt=.5*ce[2],_t=this._minimumAABBFrustumDistance(S,ne),Dt=[0,0,1,0];o.a7.transformMat4(Dt,Dt,Y),o.a7.normalize(Dt,Dt);const Qt=o.N.scale([],Dt,_t+xt),cr=o.N.add([],ne.center,Qt),sr=(typeof A.offset.x=="number"&&typeof A.offset.y=="number"?new o.P(A.offset.x,A.offset.y):o.P.convert(A.offset)).rotate(-o.bj(m));ne.center[0]-=sr.x*st,ne.center[1]+=sr.y*st,o.N.transformMat4(ne.center,ne.center,se),o.N.transformMat4(cr,cr,se);const ar=[ne.center[0],ne.center[1],cr[2]*S.pixelsPerMeter];o.N.scale(ar,ar,1/S.worldSize);const kr=o.at(ar[0]),Mr=o.au(ar[1]),Cr=Math.min(S._zoomFromMercatorZ(ar[2]),A.maxZoom),Ir=new o.bn(kr,Mr);return S.mercatorFromTransition&&Cr<.5*(o.bG+o.bx)?(S.setProjection({name:"globe"}),S.zoom=Cr,this._cameraForBounds(S,a,d,m,g,b)):{center:Ir,zoom:Cr,bearing:m,pitch:g}}fitBounds(n,a,d){const m=this.cameraForBounds(n,a);return this._fitInternal(m,a,d)}fitScreenCoordinates(n,a,d,m,g){const b=o.P.convert(n),S=o.P.convert(a),A=new o.P(Math.min(b.x,S.x),Math.min(b.y,S.y)),P=new o.P(Math.max(b.x,S.x),Math.max(b.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,S))return this;const D=this.transform.pointLocation3D(A),k=this.transform.pointLocation3D(P),F=this.transform.pointLocation3D(new o.P(A.x,P.y)),N=this.transform.pointLocation3D(new o.P(P.x,A.y)),q=[Math.min(D.lng,k.lng,F.lng,N.lng),Math.min(D.lat,k.lat,F.lat,N.lat)],G=[Math.max(D.lng,k.lng,F.lng,N.lng),Math.max(D.lat,k.lat,F.lat,N.lat)],W=m&&m.pitch?m.pitch:this.getPitch(),U=this._cameraForBounds(this.transform,q,G,d,W,m);return this._fitInternal(U,m,g)}_fitInternal(n,a,d){return n?(delete(a=o.e(n,a)).padding,a.linear?this.easeTo(a,d):this.flyTo(a,d)):this}jumpTo(n,a){this.stop();const d=n.preloadOnly?this.transform.clone():this.transform;let m=!1,g=!1,b=!1;return"zoom"in n&&d.zoom!==+n.zoom&&(m=!0,d.zoom=+n.zoom),n.center!==void 0&&(d.center=o.bn.convert(n.center)),"bearing"in n&&d.bearing!==+n.bearing&&(g=!0,d.bearing=+n.bearing),"pitch"in n&&d.pitch!==+n.pitch&&(b=!0,d.pitch=+n.pitch),n.padding==null||d.isPaddingEqual(n.padding)||(d.padding=n.padding),n.preloadOnly?(this._preloadTiles(d),this):(this.fire(new o.b("movestart",a)).fire(new o.b("move",a)),m&&this.fire(new o.b("zoomstart",a)).fire(new o.b("zoom",a)).fire(new o.b("zoomend",a)),g&&this.fire(new o.b("rotatestart",a)).fire(new o.b("rotate",a)).fire(new o.b("rotateend",a)),b&&this.fire(new o.b("pitchstart",a)).fire(new o.b("pitch",a)).fire(new o.b("pitchend",a)),this.fire(new o.b("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(t_),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){const d=this.transform;if(!d.projection.supportsFreeCamera)return o.w(t_),this;this.stop();const m=d.zoom,g=d.pitch,b=d.bearing;d.setFreeCameraOptions(n);const S=m!==d.zoom,A=g!==d.pitch,P=b!==d.bearing;return this.fire(new o.b("movestart",a)).fire(new o.b("move",a)),S&&this.fire(new o.b("zoomstart",a)).fire(new o.b("zoom",a)).fire(new o.b("zoomend",a)),P&&this.fire(new o.b("rotatestart",a)).fire(new o.b("rotate",a)).fire(new o.b("rotateend",a)),A&&this.fire(new o.b("pitchstart",a)).fire(new o.b("pitch",a)).fire(new o.b("pitchend",a)),this.fire(new o.b("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),((n=o.e({offset:[0,0],duration:500,easing:o.d0},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const d=this.transform,m=this.getZoom(),g=this.getBearing(),b=this.getPitch(),S=this.getPadding(),A="zoom"in n?+n.zoom:m,P="bearing"in n?this._normalizeBearing(n.bearing,g):g,D="pitch"in n?+n.pitch:b,k="padding"in n?n.padding:d.padding,F=o.P.convert(n.offset);let N,q,G;if(d.projection.name==="globe"){const de=o.L.fromLngLat(d.center),ge=F.rotate(-d.angle);de.x+=ge.x/d.worldSize,de.y+=ge.y/d.worldSize;const De=de.toLngLat(),xe=o.bn.convert(n.center||De);this._normalizeCenter(xe),N=d.centerPoint.add(ge),q=new o.P(de.x,de.y).mult(d.worldSize),G=new o.P(o.a5(xe.lng),o.ae(xe.lat)).mult(d.worldSize).sub(q)}else{N=d.centerPoint.add(F);const de=d.pointLocation(N),ge=o.bn.convert(n.center||de);this._normalizeCenter(ge),q=d.project(de),G=d.project(ge).sub(q)}const W=d.zoomScale(A-m);let U,X;n.around&&(U=o.bn.convert(n.around),X=d.locationPoint(U));const re=this._zooming||A!==m,J=this._rotating||g!==P,ne=this._pitching||D!==b,Y=!d.isPaddingEqual(k),se=de=>ge=>{if(re&&(de.zoom=o.U(m,A,ge)),J&&(de.bearing=o.U(g,P,ge)),ne&&(de.pitch=o.U(b,D,ge)),Y&&(de.interpolatePadding(S,k,ge),N=de.centerPoint.add(F)),U)de.setLocationAtPoint(U,X);else{const De=de.zoomScale(de.zoom-m),xe=A>m?Math.min(2,W):Math.max(.5,W),Ne=Math.pow(xe,1-ge),Fe=de.unproject(q.add(G.mult(ge*Ne)).mult(De));de.setLocationAtPoint(de.renderWorldCopies?Fe.wrap():Fe,N)}return n.preloadOnly||this._fireMoveEvents(a),de};if(n.preloadOnly){const de=this._emulate(se,n.duration,d);return this._preloadTiles(de),this}const ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=J,this._pitching=ne,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,ce),this._ease(se(d),de=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(a,de)},n),this}_prepareEase(n,a,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||d.moving||this.fire(new o.b("movestart",n)),this._zooming&&!d.zooming&&this.fire(new o.b("zoomstart",n)),this._rotating&&!d.rotating&&this.fire(new o.b("rotatestart",n)),this._pitching&&!d.pitching&&this.fire(new o.b("pitchstart",n))}_fireMoveEvents(n){this.fire(new o.b("move",n)),this._zooming&&this.fire(new o.b("zoom",n)),this._rotating&&this.fire(new o.b("rotate",n)),this._pitching&&this.fire(new o.b("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,m=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,d&&this.fire(new o.b("zoomend",n)),m&&this.fire(new o.b("rotateend",n)),g&&this.fire(new o.b("pitchend",n)),this.fire(new o.b("moveend",n))}flyTo(n,a){if(this._prefersReducedMotion(n)){const be=o.ac(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(be,a)}this.stop(),n=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.d0},n);const d=this.transform,m=this.getZoom(),g=this.getBearing(),b=this.getPitch(),S="zoom"in n?o.aa(+n.zoom,d.minZoom,d.maxZoom):m,A="bearing"in n?this._normalizeBearing(n.bearing,g):g,P="pitch"in n?+n.pitch:b,D=d.zoomScale(S-m),k=o.P.convert(n.offset),F=d.centerPoint.add(k),N=d.pointLocation(F);let q=n.center;if(q&&n.padding){const be=this._cameraForBounds(this.transform,q,q,A,P,n);be&&(q=be.center)}q=o.bn.convert(q||N),this._normalizeCenter(q);const G=d.project(N),W=d.project(q).sub(G);let U=n.curve;const X=Math.max(d.width,d.height),re=X/D,J=W.mag();if("minZoom"in n){const be=o.aa(Math.min(n.minZoom,m,S),d.minZoom,d.maxZoom),Oe=X/d.zoomScale(be-m);U=Math.sqrt(Oe/J*2)}const ne=U*U;function Y(be){const Oe=(re*re-X*X+(be?-1:1)*ne*ne*J*J)/(2*(be?re:X)*ne*J);return Math.log(Math.sqrt(Oe*Oe+1)-Oe)}function se(be){return(Math.exp(be)-Math.exp(-be))/2}function ce(be){return(Math.exp(be)+Math.exp(-be))/2}const de=Y(0);let ge=function(be){return ce(de)/ce(de+U*be)},De=function(be){return X*((ce(de)*(se(Oe=de+U*be)/ce(Oe))-se(de))/ne)/J;var Oe},xe=(Y(1)-de)/U;if(Math.abs(J)<1e-6||!isFinite(xe)){if(Math.abs(X-re)<1e-6)return this.easeTo(n,a);const be=re<X?-1:1;xe=Math.abs(Math.log(re/X))/U,De=function(){return 0},ge=function(Oe){return Math.exp(be*U*Oe)}}n.duration="duration"in n?+n.duration:1e3*xe/("screenSpeed"in n?+n.screenSpeed/U:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const Ne=g!==A,Fe=P!==b,tt=be=>Oe=>{const me=Oe*xe,Ae=1/ge(me);be.zoom=Oe===1?S:m+be.scaleZoom(Ae),Ne&&(be.bearing=o.U(g,A,Oe)),Fe&&(be.pitch=o.U(b,P,Oe));const st=Oe===1?q:be.unproject(G.add(W.mult(De(me))).mult(Ae));return be.setLocationAtPoint(be.renderWorldCopies?st.wrap():st,F),be._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),be};if(n.preloadOnly){const be=this._emulate(tt,n.duration,d);return this._preloadTiles(be),this}return this._zooming=!0,this._rotating=Ne,this._pitching=Fe,this._prepareEase(a,!1),this._ease(tt(d),()=>this._afterEase(a),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,a)}if(!n){const d=this.handlers;d&&d.stop(!1)}return this}_ease(n,a,d){d.animate===!1||d.duration===0?(n(1),a()):(this._easeStart=o.f.now(),this._easeOptions=d,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((o.f.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=o.bh(n,-180,180);const d=Math.abs(n-a);return Math.abs(n-360-a)<d&&(n-=360),Math.abs(n+360-a)<d&&(n+=360),n}_normalizeCenter(n){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const d=n.lng-a.center.lng;n.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&o.f.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,a,d){const m=Math.ceil(15*a/1e3),g=[],b=n(d.clone());for(let S=0;S<=m;S++){const A=b(S/m);g.push(A.clone())}return g}}class $f{constructor(n={}){this.options=n,o.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const a=this.options&&this.options.compact;return this._map=n,this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=oe("button","mapboxgl-ctrl-attrib-button",this._container),oe("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=oe("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,a){const d=this._map._getUIString(`AttributionControl.${a}`);n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",d)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.d5.ACCESS_TOKEN}];if(n){const d=a.reduce((m,g,b)=>(g.value&&(m+=`${g.key}=${g.value}${b<a.length-1?"&":""}`),m),"?");n.href=`${o.d5.FEEDBACK_URL}/${d}#${Pf(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const a=this._map.style._mergedSourceCaches;for(const m in a){const g=a[m];if(g.used){const b=g.getSource();b.attribution&&n.indexOf(b.attribution)<0&&n.push(b.attribution)}}n.sort((m,g)=>m.length-g.length),n=n.filter((m,g)=>{for(let b=g+1;b<n.length;b++)if(n[b].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const d=n.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,n.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class r_{constructor(){o.aY(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=oe("div","mapboxgl-ctrl");const a=oe("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const a in n){const d=n[a].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class n_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){const a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(const m of d)if(m.id===n)return void(m.cancelled=!0)}run(n=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const d of a)if(!d.cancelled&&(d.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function tu(h,n,a){if(h=new o.bn(h.lng,h.lat),n){const d=new o.bn(h.lng-360,h.lat),m=new o.bn(h.lng+360,h.lat),g=360*Math.ceil(Math.abs(h.lng-a.center.lng)/360),b=a.locationPoint(h).distSqr(n),S=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint(d).distSqr(n)<b&&(S||Math.abs(d.lng-a.center.lng)<g)?h=d:a.locationPoint(m).distSqr(n)<b&&(S||Math.abs(m.lng-a.center.lng)<g)&&(h=m)}for(;Math.abs(h.lng-a.center.lng)>180;){const d=a.locationPoint(h);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;h.lng>a.center.lng?h.lng-=360:h.lng+=360}return h}const dh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Uf extends o.E{constructor(n,a){if(super(),(n instanceof HTMLElement||a)&&(n=o.e({element:n},a)),o.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=o.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=oe("div");const g=41,b=27,S=_e("svg",{display:"block",height:g*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${g}`},this._element),A=_e("radialGradient",{id:"shadowGradient"},_e("defs",{},S));_e("stop",{offset:"10%","stop-opacity":.4},A),_e("stop",{offset:"100%","stop-opacity":.05},A),_e("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),_e("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),_e("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),_e("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=o.P.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",g=>{g.preventDefault()}),this._element.addEventListener("mousedown",g=>{g.preventDefault()});const d=this._element.classList;for(const g in dh)d.remove(`mapboxgl-marker-anchor-${g}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`);const m=n&&n.className?n.className.trim().split(/\s+/):[];d.add(...m),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=o.bn.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const a=n.code,d=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(n){const a=n.originalEvent.target,d=this._element;this._popup&&(a===d||d.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,a=this._pos;if(!n||!a)return!1;const d=n.unproject(a),m=n.getFreeCameraOptions();if(!m.position)return!1;const g=m.position.toLngLat();return g.distanceTo(d)<.9*g.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();const d=n.unproject(a);let m;n._showingGlobe()&&o.d6(n.transform,this._lngLat)?m=0:(m=1-n._queryFogOpacity(d),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${dh[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const n=this._pos,a=this._map,d=this.getPitchAlignment();if(!a||!n||d!=="map")return"";if(!a._showingGlobe()){const A=a.getPitch();return A?`rotateX(${A}deg)`:""}const m=o.bF(o.d7(a.transform,this._lngLat)),g=n.sub(o.d8(a.transform)),b=Math.abs(g.x)+Math.abs(g.y);if(b===0)return"";const S=m/b;return`rotateX(${-g.y*S}deg) rotateY(${g.x*S}deg)`}_calculateZTransform(){const n=this._pos,a=this._map;if(!a||!n)return"";let d=0;const m=this.getRotationAlignment();if(m==="map")if(a._showingGlobe()){const g=a.project(new o.bn(this._lngLat.lng,this._lngLat.lat+.001)),b=a.project(new o.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(g);d=o.bF(Math.atan2(b.y,b.x))-90}else d=-a.getBearing();else if(m==="horizon"){const g=o.O(4,6,a.getZoom()),b=o.d8(a.transform);b.y+=g*a.transform.height;const S=n.sub(b),A=o.bF(Math.atan2(S.y,S.x));d=(A>90?A-270:A+90)*(1-g)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=tu(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=o.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const a=this._map;if(!a)return;const d=this._pointerdownPos,m=this._positionDelta;if(d&&m){if(!this._isDragging){const g=this._clickTolerance||a._clickTolerance;if(n.point.dist(d)<g)return;this._isDragging=!0}this._pos=n.point.sub(m),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.b("dragstart"))),this.fire(new o.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.b("dragend")),this._state="inactive"}_addDragHandler(n){const a=this._map,d=this._pos;a&&d&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(d),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const i_={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},s_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function o_(h=new o.P(0,0),n="bottom"){if(typeof h=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(n){case"top":return new o.P(0,h);case"top-left":return new o.P(a,a);case"top-right":return new o.P(-a,a);case"bottom":return new o.P(0,-h);case"bottom-left":return new o.P(a,-a);case"bottom-right":return new o.P(-a,-a);case"left":return new o.P(h,0);case"right":return new o.P(-h,0)}return new o.P(0,0)}return h instanceof o.P||Array.isArray(h)?o.P.convert(h):o.P.convert(h[n]||[0,0])}class jf{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const a=o.cc((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,d){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+d}}const ru={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},a_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class Gf{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const fh={showCompass:!0,showZoom:!0,visualizePitch:!1};class To{constructor(n,a,d=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Yc({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,d&&(this.mousePitch=new uh({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),o.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),mt()}move(n,a){const d=this.map,m=this.mouseRotate.mousemoveWindow(n,a),g=m&&m.bearingDelta;if(g&&d.setBearing(d.getBearing()+g),this.mousePitch){const b=this.mousePitch.mousemoveWindow(n,a),S=b&&b.pitchDelta;S&&d.setPitch(d.getPitch()+S)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){gt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(o.e({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),ht(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,ht(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=lt(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=lt(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ph={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Wi={maxWidth:100,unit:"metric"},ra={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:o.dk,supported:$,setRTLTextPlugin:o.dm,getRTLTextPluginStatus:o.dn,Map:class extends ni{constructor(h){const n=h;if((h=o.e({},a_,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&o.d9(window)&&(h.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Cc(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._repaint=!1,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new n_,this._domRenderTaskQueue=new n_,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.aC(),this._locale=o.e({},ru,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new jf(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.da(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?{...h.contextCreateOptions}:{},typeof h.container=="string"){const a=document.getElementById(h.container);if(!a)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=a}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),o.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new Gf,this._tp=h.devtools?new Uc(this):new Uc,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,a=>{this.repaint=a}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,a=>{this.showTileAABBs=a}),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,a=>{this.showPadding=a}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new nv(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||o.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),h.hash&&(this._hash=new ah(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const a=h.bounds;a&&(this.resize(),this.fitBounds(a,o.e({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new $f({customAttribution:h.customAttribution})),this._logoControl=new r_,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new o.b(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new o.b(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(h,n){if(n===void 0&&(n=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new o.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=h.onAdd(this);this._controls.push(h);const d=this._controlPositions[n];return n.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new o.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(h);return n>-1&&this._controls.splice(n,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new o.b("movestart",h)).fire(new o.b("move",h)),this.fire(new o.b("resize",h)),n&&this.fire(new o.b("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(o.ad.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new o.b("zoomstart")).fire(new o.b("zoom")).fire(new o.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new o.b("zoomstart")).fire(new o.b("zoom")).fire(new o.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new o.b("pitchstart")).fire(new o.b("pitch")).fire(new o.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new o.b("pitchstart")).fire(new o.b("pitch")).fire(new o.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(n=>n==="auto"?navigator.language:n):h}setLanguage(h){const n=this._parseLanguage(h);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,n=h.projection.name;let a;n==="globe"&&h.zoom>=o.bx?(h.setMercatorFromTransition(),a=!0):n==="mercator"&&h.zoom<o.bx&&(h.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,n){return this._updateProjection(h||n||{name:"mercator"})}_updateProjection(h){let n;return n=h.name==="globe"&&this.transform.zoom>=o.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h){return this.transform.locationPoint3D(o.bn.convert(h))}unproject(h){return this.transform.pointLocation3D(o.P.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,n,a){if(h==="mouseenter"||h==="mouseover"){let d=!1;const m=b=>{const S=n.filter(P=>this.getLayer(P)),A=S.length?this.queryRenderedFeatures(b.point,{layers:S}):[];A.length?d||(d=!0,a.call(this,new Qi(h,this,b.originalEvent,{features:A}))):d=!1},g=()=>{d=!1};return{layers:new Set(n),listener:a,delegates:{mousemove:m,mouseout:g}}}if(h==="mouseleave"||h==="mouseout"){let d=!1;const m=b=>{const S=n.filter(A=>this.getLayer(A));(S.length?this.queryRenderedFeatures(b.point,{layers:S}):[]).length?d=!0:d&&(d=!1,a.call(this,new Qi(h,this,b.originalEvent)))},g=b=>{d&&(d=!1,a.call(this,new Qi(h,this,b.originalEvent)))};return{layers:new Set(n),listener:a,delegates:{mousemove:m,mouseout:g}}}{const d=m=>{const g=n.filter(S=>this.getLayer(S)),b=g.length?this.queryRenderedFeatures(m.point,{layers:g}):[];b.length&&(m.features=b,a.call(this,m),delete m.features)};return{layers:new Set(n),listener:a,delegates:{[h]:d}}}}on(h,n,a){if(a===void 0)return super.on(h,n);if(Array.isArray(n)||(n=[n]),n){for(const m of n)if(!this._isValidId(m))return this}const d=this._createDelegatedListener(h,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(const m in d.delegates)this.on(m,d.delegates[m]);return this}once(h,n,a){if(a===void 0)return super.once(h,n);if(Array.isArray(n)||(n=[n]),n){for(const m of n)if(!this._isValidId(m))return this}const d=this._createDelegatedListener(h,n,a);for(const m in d.delegates)this.once(m,d.delegates[m]);return this}off(h,n,a){if(a===void 0)return super.off(h,n);n=new Set(Array.isArray(n)?n:[n]);for(const g of n)if(!this._isValidId(g))return this;const d=(g,b)=>{if(g.size!==b.size)return!1;for(const S of g)if(!b.has(S))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[h]:void 0;return m&&(g=>{for(let b=0;b<g.length;b++){const S=g[b];if(S.listener===a&&d(S.layers,n)){for(const A in S.delegates)this.off(A,S.delegates[A]);return g.splice(b,1),this}}})(m),this}queryRenderedFeatures(h,n){if(!this.style)return[];if(n!==void 0||h===void 0||h instanceof o.P||Array.isArray(h)||(n=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],(n=n||{}).layers&&Array.isArray(n.layers)){for(const a of n.layers)if(!this._isValidId(a))return[]}return this.style.queryRenderedFeatures(h,n,this.transform)}querySourceFeatures(h,n){return this._isValidId(h)?this.style.querySourceFeatures(h,n):[]}isPointOnSurface(h){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&o.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(h))}setStyle(h,n){return(n=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(h,n))}_getUIString(h){const n=this._locale[h];if(n==null)throw new Error(`Missing UI string '${h}'`);return n}_updateStyle(h,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new Ns(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ns(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,n){if(typeof h=="string"){const a=this._requestManager.normalizeStyleURL(h),d=this._requestManager.transformRequest(a,o.R.Style);o.g(d,(m,g)=>{m?this.fire(new o.a(m)):g&&this._updateDiff(g,n)})}else typeof h=="object"&&this._updateDiff(h,n)}_updateDiff(h,n){try{this.style.setState(h)&&this._update(!0)}catch(a){o.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(h,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new o.a(new Error("IDs can't be empty."))),!1):!o.c4(h)||(this.fire(new o.a(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}addSource(h,n){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,n),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(h,n,a)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,n,{pixelRatio:a=1,sdf:d=!1,stretchX:m,stretchY:g,content:b}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:S,height:A,data:P}=o.f.getImageData(n);this.style.addImage(h,{data:new o.h({width:S,height:A},P),pixelRatio:a,stretchX:m,stretchY:g,content:b,sdf:d,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new o.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:A}=n,P=n;this.style.addImage(h,{data:new o.h({width:S,height:A},new Uint8Array(P.data)),pixelRatio:a,stretchX:m,stretchY:g,content:b,sdf:d,version:0,userImage:P}),P.onAdd&&P.onAdd(this,h)}}updateImage(h,n){this._lazyInitEmptyStyle();const a=this.style.getImage(h);if(!a)return void this.fire(new o.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?o.f.getImageData(n):n,{width:m,height:g}=d,b=d.data;if(m===void 0||g===void 0)return void this.fire(new o.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==a.data.width||g!==a.data.height)return void this.fire(new o.a(new Error(`The width and height of the updated image (${m}, ${g})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`)));const S=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);a.data.replace(b,S),this.style.updateImage(h,a)}hasImage(h){return h?!!this.style&&!!this.style.getImage(h):(this.fire(new o.a(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,n){o.d(this._requestManager.transformRequest(h,o.R.Image),(a,d)=>{n(a,d instanceof HTMLImageElement?o.f.getImageData(d):d)})}listImages(){return this.style.listImages()}addModel(h,n){this._lazyInitEmptyStyle(),this.style.addModel(h,n)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new o.a(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,n){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,n),this._update(!0)):this}getSlot(h){const n=this.getLayer(h);return n&&n.slot||null}setSlot(h,n){return this.style.setSlot(h,n),this.style.mergeLayers(),this._update(!0)}addImport(h,n){return this.style.addImport(h,n),this}updateImport(h,n){return typeof n!="string"&&n.id!==h?(this.removeImport(h),this.addImport(n)):(this.style.updateImport(h,n),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,n){return this.style.moveImport(h,n),this._update(!0)}moveLayer(h,n){return this._isValidId(h)?(this.style.moveLayer(h,n),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){return this._isValidId(h)?this.style.getOwnLayer(h):null}setLayerZoomRange(h,n,a){return this._isValidId(h)?(this.style.setLayerZoomRange(h,n,a),this._update(!0)):this}setFilter(h,n,a={}){return this._isValidId(h)?(this.style.setFilter(h,n,a),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,n,a,d={}){return this._isValidId(h)?(this.style.setPaintProperty(h,n,a,d),this._update(!0)):this}getPaintProperty(h,n){return this._isValidId(h)?this.style.getPaintProperty(h,n):null}setLayoutProperty(h,n,a,d={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,n,a,d),this._update(!0)):this}getLayoutProperty(h,n){return this._isValidId(h)?this.style.getLayoutProperty(h,n):null}getConfigProperty(h,n){return this.style.getConfigProperty(h,n)}setConfigProperty(h,n,a){return this.style.setConfigProperty(h,n,a),this._update(!0)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const n=h[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.bn.convert(h),this.transform):0}setFeatureState(h,n){return this._isValidId(h.source)?(this.style.setFeatureState(h,n),this._update()):this}removeFeatureState(h,n){return this._isValidId(h.source)?(this.style.removeFeatureState(h,n),this._update()):this}getFeatureState(h){return this._isValidId(h.source)?this.style.getFeatureState(h):null}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let a,d,m,g=this._container;for(;g&&(!d||!m);){const b=window.getComputedStyle(g).transform;b&&b!=="none"&&(a=b.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(d=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(m=a[3])),g=g.parentElement}this._containerWidth=d?Math.abs(h/d):h,this._containerHeight=m?Math.abs(n/m):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=oe("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=oe("div","mapboxgl-canvas-container",h);this._canvas=oe("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=oe("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{d[m]=oe("div",`mapboxgl-ctrl-${m}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,n){const a=o.f.devicePixelRatio||1;this._canvas.width=a*Math.ceil(h),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${n}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const n=this._markers.indexOf(h);n!==-1&&this._markers.splice(n,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const n=this._popups.indexOf(h);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const h=o.e({},$.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",h);n?(o.db(n,!0),this.painter=new Hm(n,this._contextCreateOptions,this.transform,this._tp),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.dc.testSupport(n)):this.fire(new o.a(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.b("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new o.b("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let n;this.fire(new o.b("renderstart"));const a=this.painter.context.extTimerQuery,d=o.f.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=m.createQuery(),m.beginQuery(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,P=this.transform.pitch,D=o.f.now(),k=new o.K(A,{now:D,fadeDuration:g,pitch:P,transition:this.style.transition});this.style.update(k)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(d),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(d),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const A=o.f.now()-d;m.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{const P=m.getQueryParameter(n,m.QUERY_RESULT)/1e6;m.deleteQuery(n),this.fire(new o.b("gpu-timing-frame",{cpuTime:A,gpuTime:P}))},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(A);this.fire(new o.b("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(A);this.fire(new o.b("gpu-timing-deferred-render",{gpuTime:P}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(S||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(b=this._updateAverageElevation(d,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new o.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new o.b("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._performanceMetricsCollection&&o.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const n of this._markers)h&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!h||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(h,n=!1){const a=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(n||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const m=this.transform.averageElevation;let g=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=h;const b=Math.abs(m-g);if(b>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(g),a(g);this._averageElevation.easeTo(g,h,300)}else if(b>1e-4)return this._averageElevation.jumpTo(g),a(g)}return!!this._averageElevation.isEasing(h)&&a(this._averageElevation.getValue(h))}_authenticate(){o.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===o.df||h.status===401)){const n=this.painter.context.gl;o.db(n,!1),this._logoControl instanceof r_&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const a=this.painter.context.gl,d=a.createFramebuffer();function m(g){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,g,0);const b=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,b),b}return a.bindFramebuffer(a.FRAMEBUFFER,d),this._canvasPixelComparison(m(h),n.canvasCopies.map(m),n.timeStamps)}_canvasPixelComparison(h,n,a){let d=a[1]-a[0];const m=h.length/4;for(let g=0;g<n.length;g++){const b=n[g];let S=0;for(let A=0;A<b.length;A+=4)b[A]===h[A]&&b[A+1]===h[A+1]&&b[A+2]===h[A+2]&&b[A+3]===h[A+3]&&(S+=1);d+=(a[g+2]-a[g+1])*(1-S/m)}return d}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.dh(this.painter.context.gl),o.di.remove(),o.dj.remove(),this._removed=!0,this.fire(new o.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=o.f.frame(n=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)}))}_preloadTiles(h){const n=this.style?Object.values(this.style._sourceCaches):[];return o.b1(n,(a,d)=>a._preloadTiles(h,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,n){o.dl(h,n)}get version(){return o.dk}},NavigationControl:class{constructor(h){this.options=o.e({},fh,h),this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(o.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),oe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),oe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))}),this._compassIcon=oe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const n=h.getZoom(),a=n===h.getMaxZoom(),d=n===h.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new To(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,n){const a=oe("button",h,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(h,n){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${n}`);h.setAttribute("aria-label",a),h.firstElementChild&&h.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends o.E{constructor(h){super();const n=navigator.geolocation;this.options=o.e({geolocation:n},ph,h),o.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Gc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const n=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,h(a)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>n(a.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(h){const n=this._map.getMaxBounds(),a=h.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new o.b("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.b("geolocate",h)),this._finish()}}_updateCamera(h){const n=new o.bn(h.coords.longitude,h.coords.latitude),a=h.coords.accuracy,d=this._map.getBearing(),m=o.e({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),m,{geolocateSource:!0})}_updateMarker(h){if(h){const n=new o.bn(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,n=o.bl(1,h._center.lat)*h.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.b("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=oe("button","mapboxgl-ctrl-geolocate",this._container),oe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=oe("div","mapboxgl-user-location"),this._dotElement.appendChild(oe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(oe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Uf({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=oe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Uf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.b("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:$f,ScaleControl:class{constructor(h){this.options=o.e({},Wi,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,d=n._containerWidth/2-h/2,m=n.unproject([d,a]),g=n.unproject([d+h,a]),b=m.distanceTo(g);if(this.options.unit==="imperial"){const S=3.2808*b;S>5280?this._setScale(h,S/5280,"mile"):this._setScale(h,S,"foot")}else this.options.unit==="nautical"?this._setScale(h,b/1852,"nautical-mile"):b>=1e3?this._setScale(h,b/1e3,"kilometer"):this._setScale(h,b,"meter")}_setScale(h,n,a){this._map._requestDomTask(()=>{const d=function(g){const b=Math.pow(10,`${Math.floor(g)}`.length-1);let S=g/b;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(A){const P=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*P)/P}(S),b*S}(n),m=d/n;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(d):`${d}&nbsp;${ra[a]}`,this._container.style.width=h*m+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:o.w("Full screen control 'container' must be a DOM element.")),o.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=oe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);oe("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(h){super(),this.options=o.e(Object.create(i_),h),o.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new o.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new o.b("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=o.bn.convert(h),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const n=document.createDocumentFragment(),a=document.createElement("body");let d;for(a.innerHTML=h;d=a.firstChild,d;)n.appendChild(d);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=oe("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(h),this.options.closeButton){const a=this._closeButton=oe("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let n;return this._classList.delete(h)?n=!1:(this._classList.add(h),n=!0),this._updateClassList(),n}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const n=this._map,a=this._container,d=this._pos;if(!n||!a||!d)return"bottom";const m=a.offsetWidth,g=a.offsetHeight,b=d.x<m/2,S=d.x>n.transform.width-m/2;if(d.y+h<g)return b?"top-left":S?"top-right":"top";if(d.y>n.transform.height-g){if(b)return"bottom-left";if(S)return"bottom-right"}return b?"left":S?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),h.className=n.join(" ")}_update(h){const n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let d=this._container;if(d||(d=this._container=oe("div","mapboxgl-popup",n.getContainer()),this._tip=oe("div","mapboxgl-popup-tip",d),d.appendChild(a)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=tu(this._lngLat,this._pos,n.transform)),!this._trackPointer||h){const m=this._pos=this._trackPointer&&h?h:n.project(this._lngLat),g=o_(this.options.offset),b=this._anchor=this._getAnchor(g.y),S=o_(this.options.offset,b),A=m.add(S).round();n._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${dh[b]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&n._showingGlobe()){const m=o.d6(n.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(s_);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Uf,Style:Ns,LngLat:o.bn,LngLatBounds:o.ad,Point:o.P,MercatorCoordinate:o.L,FreeCameraOptions:Ac,Evented:o.E,config:o.d5,prewarm:o.dp,clearPrewarmedResources:o.dq,get accessToken(){return o.d5.ACCESS_TOKEN},set accessToken(h){o.d5.ACCESS_TOKEN=h},get baseApiUrl(){return o.d5.API_URL},set baseApiUrl(h){o.d5.API_URL=h},get workerCount(){return o.dr.workerCount},set workerCount(h){o.dr.workerCount=h},get maxParallelImageRequests(){return o.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){o.d5.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){o.ds(h)},get workerUrl(){return o.dt.workerUrl},set workerUrl(h){o.dt.workerUrl=h},get workerClass(){return o.dt.workerClass},set workerClass(h){o.dt.workerClass=h},get workerParams(){return o.dt.workerParams},set workerParams(h){o.dt.workerParams=h},get dracoUrl(){return o.du()},set dracoUrl(h){o.dv(h)},get meshoptUrl(){return o.dw()},set meshoptUrl(h){o.dx(h)},setNow:o.f.setNow,restoreNow:o.f.restoreNow}});var R=M;return R})})(eC);var $F=eC.exports;const JM=VF($F),UF=i=>(fc("data-v-62681a9c"),i=i(),pc(),i),jF=UF(()=>Ue("div",{id:"map-cont"},null,-1)),GF=[jF],HF={__name:"mapbox",setup(i){const c=Zr(null),p=Zr(!0),y=Zr(!1);JM.accessToken="pk.eyJ1IjoibWFyaW8wMiIsImEiOiJjbHNxMXR6OWUweDZoMmlvOWVtZjJtMDAwIn0.q5mRNtCKJpmnMPRuhrG_XA";const T={pitch:90,zoom:3,center:[100,70],bearing:0};ya(()=>{window.innerWidth<=450&&(T.zoom=2),c.value=new JM.Map({container:"map-cont",style:"mapbox://styles/mapbox/satellite-v9",projection:"globe",...T}),c.value.on("style.load",()=>{c.value.setFog({color:"rgb(26, 31, 76)","high-color":"rgb(0, 104, 149)","horizon-blend":.02,"space-color":"rgb(11, 11, 25)","star-intensity":1})}),c.value.scrollZoom.disable(),c.value.on("mousedown",()=>{y.value=!0}),c.value.on("mouseup",()=>{y.value=!1,M()}),c.value.on("dragend",()=>{y.value=!1,M()}),c.value.on("pitchend",()=>{y.value=!1,M()}),c.value.on("rotateend",()=>{y.value=!1,M()}),c.value.on("moveend",()=>{M()}),M()});const M=()=>{if(!c.value||y.value)return;const C=c.value.getZoom(),R=120,o=5,B=3;if(p.value&&C<o){let $=360/R;if(C>B){const ie=(o-C)/(o-B);$*=ie}const H=c.value.getCenter();H.lng-=$,c.value.easeTo({center:H,duration:2e3,easing:ie=>ie})}};return(C,R)=>(It(),Wt("section",null,GF))}},rC=Ki(HF,[["__scopeId","data-v-62681a9c"]]),qF={id:"content"},WF={id:"txtbox"},YF=["innerHTML"],ZF=["innerHTML"],XF={__name:"layer1",setup(i){const c=mo(),p=rt(()=>ho().get("layer1",c.language));return(y,T)=>(It(),Wt("div",qF,[Ue("div",WF,[Ue("h1",{innerHTML:p.value.txt1},null,8,YF),Ue("h2",{innerHTML:p.value.txt2},null,8,ZF)])]))}},KF=Ki(XF,[["__scopeId","data-v-4cf58e51"]]),JF="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAC0SURBVEiJ7dWxCkFRAIfx7950B5llvQvlHRgMeASLVzF5QAZSZjKSwWD4DBRuWM65pfiPZ/h9dTp14Oem5upcXaqt2Hiqrr1vEzWiZurB50WPDNVT2ZH+i8hObceMDH4jkqhTYAQkAZ0GUC2cbYFeop6BSgD+aasUsCQcuF7RBBgDaYBTB2qFsy3QCzCvUzvqsZSX9Mff4d0y8UzdF/CN2gzGb4FXH04c/CGSqzN1ER3/yl0ATTCRVV25kfwAAAAASUVORK5CYII=",QF="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAACxAAAAsQHGLUmNAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAaJJREFUSInd1b1rFVEQBfDfS9IYEkja4AcGQgpbTaOgVvoPWGoltpZWgTSClSSlbexsLIKVgk2wEdFKWxHiR9TCEKMGdC3u3GRz3yZvl1h5YOAxzJyzs3veDO0xgxU8xqkOfQMxgbvYxtuI7chNHIZ4CNfwEd9xB2M4glvYwFfcxHBX8vN4iT94gBMNNVO4h994jUttiI9iOYhf4FyLnjN4hkr6RtNNRaNYwBbe44ZuY/dwBe/wC0sYrxdcjyfYxFwH4hJzwVEFp6Gi4AtWsYjJDsST0bMaHH3IE4xKrvhm1yEjBxBnp32SnLYgOW1nglIgk9Ud8gaXG8gv4JVdpx2P/EgbgYzT0th1hxyTnFbhOc4WPZ0ESA65ijX8iFiLXK+hfo/AQe83o8J9PMTTyF2U3DIQbQQyNqW1kX+3QmnTf47/T+C2Yod0xHhw9KG+7D7bf8evRJToSf/oD/ZZdhmD1nWTQLmuTzYRl8gHJzflg1MXmKo9TOuDU8ewdBfWJd/P40nEfOTWdb8dfRiTvs9PaaJKOvpLDnn0S8ziUcRs26a/tHlyo5MtwLoAAAAASUVORK5CYII=",e1=Kx("varStore",()=>{var i=Zr({height:10,destiny:"null",date:[null,null],activities:[],people:1,type:"null"});return{vars:i,changeVar:(p,y)=>{i.value[p]=y}}}),eB={id:"content"},tB=["src"],rB=["placeholder"],nB=["innerHTML"],iB=["src"],sB={__name:"search",setup(i){const c=mo(),p=Zr(null),y=Zr(!1),T=rt(()=>ho().get("search",c.language)),M=Qx(),C=e1(),R=Zr("");ya(()=>{p.value=window.innerWidth,p.value<=750?y.value=!0:y.value=!1}),window.addEventListener("resize",()=>{p.value=window.innerWidth,p.value<=750?y.value=!0:y.value=!1});const o=()=>{C.changeVar("destiny",R.value),setTimeout(()=>{M.push("/options")},1300)};return(B,$)=>(It(),Wt("div",eB,[Ue("div",{id:"box",class:Rn({"fit-area":y.value})},[Ue("img",{id:"arrow",src:yt(JF),alt:"flecha"},null,8,tB),uc(Ue("input",{type:"text","onUpdate:modelValue":$[0]||($[0]=H=>R.value=H),name:"",id:"txt",placeholder:T.value.txt1},null,8,rB),[[sx,R.value]]),Ue("div",{id:"generate",class:Rn({fit:y.value}),onClick:o},[!y.value&&p.value>=600?(It(),Wt("p",{key:0,innerHTML:T.value.txt2},null,8,nB)):Ei("",!0),Ue("img",{id:"imgbox",src:yt(QF),alt:"cubo"},null,8,iB)],2)],2)]))}},oB=Ki(sB,[["__scopeId","data-v-60fabf0b"]]),aB={__name:"home",setup(i){return(c,p)=>(It(),Wt("section",null,[_r(my),_r(KF),_r(rC),_r(oB)]))}},lB=Ki(aB,[["__scopeId","data-v-b9d35bda"]]),cB={__name:"HomeView",setup(i){return(c,p)=>(It(),Wt("main",null,[Ue("div",null,[_r(lB)])]))}},uB={__name:"test",setup(i){return(c,p)=>(It(),Wt("div",null,[_r(rC)]))}},hB={__name:"test",setup(i){return(c,p)=>(It(),Wt("main",null,[Ue("div",null,[_r(uB)])]))}};function nC(i,c){return function(){return i.apply(c,arguments)}}const{toString:dB}=Object.prototype,{getPrototypeOf:t1}=Object,_y=(i=>c=>{const p=dB.call(c);return i[p]||(i[p]=p.slice(8,-1).toLowerCase())})(Object.create(null)),va=i=>(i=i.toLowerCase(),c=>_y(c)===i),gy=i=>c=>typeof c===i,{isArray:ad}=Array,Zp=gy("undefined");function fB(i){return i!==null&&!Zp(i)&&i.constructor!==null&&!Zp(i.constructor)&&lo(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const iC=va("ArrayBuffer");function pB(i){let c;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?c=ArrayBuffer.isView(i):c=i&&i.buffer&&iC(i.buffer),c}const mB=gy("string"),lo=gy("function"),sC=gy("number"),yy=i=>i!==null&&typeof i=="object",_B=i=>i===!0||i===!1,Tg=i=>{if(_y(i)!=="object")return!1;const c=t1(i);return(c===null||c===Object.prototype||Object.getPrototypeOf(c)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},gB=va("Date"),yB=va("File"),vB=va("Blob"),xB=va("FileList"),bB=i=>yy(i)&&lo(i.pipe),wB=i=>{let c;return i&&(typeof FormData=="function"&&i instanceof FormData||lo(i.append)&&((c=_y(i))==="formdata"||c==="object"&&lo(i.toString)&&i.toString()==="[object FormData]"))},TB=va("URLSearchParams"),SB=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function om(i,c,{allOwnKeys:p=!1}={}){if(i===null||typeof i>"u")return;let y,T;if(typeof i!="object"&&(i=[i]),ad(i))for(y=0,T=i.length;y<T;y++)c.call(null,i[y],y,i);else{const M=p?Object.getOwnPropertyNames(i):Object.keys(i),C=M.length;let R;for(y=0;y<C;y++)R=M[y],c.call(null,i[R],R,i)}}function oC(i,c){c=c.toLowerCase();const p=Object.keys(i);let y=p.length,T;for(;y-- >0;)if(T=p[y],c===T.toLowerCase())return T;return null}const aC=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,lC=i=>!Zp(i)&&i!==aC;function dx(){const{caseless:i}=lC(this)&&this||{},c={},p=(y,T)=>{const M=i&&oC(c,T)||T;Tg(c[M])&&Tg(y)?c[M]=dx(c[M],y):Tg(y)?c[M]=dx({},y):ad(y)?c[M]=y.slice():c[M]=y};for(let y=0,T=arguments.length;y<T;y++)arguments[y]&&om(arguments[y],p);return c}const MB=(i,c,p,{allOwnKeys:y}={})=>(om(c,(T,M)=>{p&&lo(T)?i[M]=nC(T,p):i[M]=T},{allOwnKeys:y}),i),EB=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),AB=(i,c,p,y)=>{i.prototype=Object.create(c.prototype,y),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:c.prototype}),p&&Object.assign(i.prototype,p)},IB=(i,c,p,y)=>{let T,M,C;const R={};if(c=c||{},i==null)return c;do{for(T=Object.getOwnPropertyNames(i),M=T.length;M-- >0;)C=T[M],(!y||y(C,i,c))&&!R[C]&&(c[C]=i[C],R[C]=!0);i=p!==!1&&t1(i)}while(i&&(!p||p(i,c))&&i!==Object.prototype);return c},CB=(i,c,p)=>{i=String(i),(p===void 0||p>i.length)&&(p=i.length),p-=c.length;const y=i.indexOf(c,p);return y!==-1&&y===p},PB=i=>{if(!i)return null;if(ad(i))return i;let c=i.length;if(!sC(c))return null;const p=new Array(c);for(;c-- >0;)p[c]=i[c];return p},DB=(i=>c=>i&&c instanceof i)(typeof Uint8Array<"u"&&t1(Uint8Array)),LB=(i,c)=>{const y=(i&&i[Symbol.iterator]).call(i);let T;for(;(T=y.next())&&!T.done;){const M=T.value;c.call(i,M[0],M[1])}},RB=(i,c)=>{let p;const y=[];for(;(p=i.exec(c))!==null;)y.push(p);return y},kB=va("HTMLFormElement"),OB=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(p,y,T){return y.toUpperCase()+T}),QM=(({hasOwnProperty:i})=>(c,p)=>i.call(c,p))(Object.prototype),zB=va("RegExp"),cC=(i,c)=>{const p=Object.getOwnPropertyDescriptors(i),y={};om(p,(T,M)=>{let C;(C=c(T,M,i))!==!1&&(y[M]=C||T)}),Object.defineProperties(i,y)},FB=i=>{cC(i,(c,p)=>{if(lo(i)&&["arguments","caller","callee"].indexOf(p)!==-1)return!1;const y=i[p];if(lo(y)){if(c.enumerable=!1,"writable"in c){c.writable=!1;return}c.set||(c.set=()=>{throw Error("Can not rewrite read-only method '"+p+"'")})}})},BB=(i,c)=>{const p={},y=T=>{T.forEach(M=>{p[M]=!0})};return ad(i)?y(i):y(String(i).split(c)),p},NB=()=>{},VB=(i,c)=>(i=+i,Number.isFinite(i)?i:c),O0="abcdefghijklmnopqrstuvwxyz",eE="0123456789",uC={DIGIT:eE,ALPHA:O0,ALPHA_DIGIT:O0+O0.toUpperCase()+eE},$B=(i=16,c=uC.ALPHA_DIGIT)=>{let p="";const{length:y}=c;for(;i--;)p+=c[Math.random()*y|0];return p};function UB(i){return!!(i&&lo(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator])}const jB=i=>{const c=new Array(10),p=(y,T)=>{if(yy(y)){if(c.indexOf(y)>=0)return;if(!("toJSON"in y)){c[T]=y;const M=ad(y)?[]:{};return om(y,(C,R)=>{const o=p(C,T+1);!Zp(o)&&(M[R]=o)}),c[T]=void 0,M}}return y};return p(i,0)},GB=va("AsyncFunction"),HB=i=>i&&(yy(i)||lo(i))&&lo(i.then)&&lo(i.catch),Ct={isArray:ad,isArrayBuffer:iC,isBuffer:fB,isFormData:wB,isArrayBufferView:pB,isString:mB,isNumber:sC,isBoolean:_B,isObject:yy,isPlainObject:Tg,isUndefined:Zp,isDate:gB,isFile:yB,isBlob:vB,isRegExp:zB,isFunction:lo,isStream:bB,isURLSearchParams:TB,isTypedArray:DB,isFileList:xB,forEach:om,merge:dx,extend:MB,trim:SB,stripBOM:EB,inherits:AB,toFlatObject:IB,kindOf:_y,kindOfTest:va,endsWith:CB,toArray:PB,forEachEntry:LB,matchAll:RB,isHTMLForm:kB,hasOwnProperty:QM,hasOwnProp:QM,reduceDescriptors:cC,freezeMethods:FB,toObjectSet:BB,toCamelCase:OB,noop:NB,toFiniteNumber:VB,findKey:oC,global:aC,isContextDefined:lC,ALPHABET:uC,generateString:$B,isSpecCompliantForm:UB,toJSONObject:jB,isAsyncFn:GB,isThenable:HB};function zn(i,c,p,y,T){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",c&&(this.code=c),p&&(this.config=p),y&&(this.request=y),T&&(this.response=T)}Ct.inherits(zn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ct.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const hC=zn.prototype,dC={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{dC[i]={value:i}});Object.defineProperties(zn,dC);Object.defineProperty(hC,"isAxiosError",{value:!0});zn.from=(i,c,p,y,T,M)=>{const C=Object.create(hC);return Ct.toFlatObject(i,C,function(o){return o!==Error.prototype},R=>R!=="isAxiosError"),zn.call(C,i.message,c,p,y,T),C.cause=i,C.name=i.name,M&&Object.assign(C,M),C};const qB=null;function fx(i){return Ct.isPlainObject(i)||Ct.isArray(i)}function fC(i){return Ct.endsWith(i,"[]")?i.slice(0,-2):i}function tE(i,c,p){return i?i.concat(c).map(function(T,M){return T=fC(T),!p&&M?"["+T+"]":T}).join(p?".":""):c}function WB(i){return Ct.isArray(i)&&!i.some(fx)}const YB=Ct.toFlatObject(Ct,{},null,function(c){return/^is[A-Z]/.test(c)});function vy(i,c,p){if(!Ct.isObject(i))throw new TypeError("target must be an object");c=c||new FormData,p=Ct.toFlatObject(p,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Me,Re){return!Ct.isUndefined(Re[Me])});const y=p.metaTokens,T=p.visitor||$,M=p.dots,C=p.indexes,o=(p.Blob||typeof Blob<"u"&&Blob)&&Ct.isSpecCompliantForm(c);if(!Ct.isFunction(T))throw new TypeError("visitor must be a function");function B(_e){if(_e===null)return"";if(Ct.isDate(_e))return _e.toISOString();if(!o&&Ct.isBlob(_e))throw new zn("Blob is not supported. Use a Buffer instead.");return Ct.isArrayBuffer(_e)||Ct.isTypedArray(_e)?o&&typeof Blob=="function"?new Blob([_e]):Buffer.from(_e):_e}function $(_e,Me,Re){let Ee=_e;if(_e&&!Re&&typeof _e=="object"){if(Ct.endsWith(Me,"{}"))Me=y?Me:Me.slice(0,-2),_e=JSON.stringify(_e);else if(Ct.isArray(_e)&&WB(_e)||(Ct.isFileList(_e)||Ct.endsWith(Me,"[]"))&&(Ee=Ct.toArray(_e)))return Me=fC(Me),Ee.forEach(function(gt,dt){!(Ct.isUndefined(gt)||gt===null)&&c.append(C===!0?tE([Me],dt,M):C===null?Me:Me+"[]",B(gt))}),!1}return fx(_e)?!0:(c.append(tE(Re,Me,M),B(_e)),!1)}const H=[],ie=Object.assign(YB,{defaultVisitor:$,convertValue:B,isVisitable:fx});function oe(_e,Me){if(!Ct.isUndefined(_e)){if(H.indexOf(_e)!==-1)throw Error("Circular reference detected in "+Me.join("."));H.push(_e),Ct.forEach(_e,function(Ee,mt){(!(Ct.isUndefined(Ee)||Ee===null)&&T.call(c,Ee,Ct.isString(mt)?mt.trim():mt,Me,ie))===!0&&oe(Ee,Me?Me.concat(mt):[mt])}),H.pop()}}if(!Ct.isObject(i))throw new TypeError("data must be an object");return oe(i),c}function rE(i){const c={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(y){return c[y]})}function r1(i,c){this._pairs=[],i&&vy(i,this,c)}const pC=r1.prototype;pC.append=function(c,p){this._pairs.push([c,p])};pC.toString=function(c){const p=c?function(y){return c.call(this,y,rE)}:rE;return this._pairs.map(function(T){return p(T[0])+"="+p(T[1])},"").join("&")};function ZB(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function mC(i,c,p){if(!c)return i;const y=p&&p.encode||ZB,T=p&&p.serialize;let M;if(T?M=T(c,p):M=Ct.isURLSearchParams(c)?c.toString():new r1(c,p).toString(y),M){const C=i.indexOf("#");C!==-1&&(i=i.slice(0,C)),i+=(i.indexOf("?")===-1?"?":"&")+M}return i}class nE{constructor(){this.handlers=[]}use(c,p,y){return this.handlers.push({fulfilled:c,rejected:p,synchronous:y?y.synchronous:!1,runWhen:y?y.runWhen:null}),this.handlers.length-1}eject(c){this.handlers[c]&&(this.handlers[c]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(c){Ct.forEach(this.handlers,function(y){y!==null&&c(y)})}}const _C={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},XB=typeof URLSearchParams<"u"?URLSearchParams:r1,KB=typeof FormData<"u"?FormData:null,JB=typeof Blob<"u"?Blob:null,QB={isBrowser:!0,classes:{URLSearchParams:XB,FormData:KB,Blob:JB},protocols:["http","https","file","blob","url","data"]},gC=typeof window<"u"&&typeof document<"u",e4=(i=>gC&&["ReactNative","NativeScript","NS"].indexOf(i)<0)(typeof navigator<"u"&&navigator.product),t4=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",r4=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:gC,hasStandardBrowserEnv:e4,hasStandardBrowserWebWorkerEnv:t4},Symbol.toStringTag,{value:"Module"})),da={...r4,...QB};function n4(i,c){return vy(i,new da.classes.URLSearchParams,Object.assign({visitor:function(p,y,T,M){return da.isNode&&Ct.isBuffer(p)?(this.append(y,p.toString("base64")),!1):M.defaultVisitor.apply(this,arguments)}},c))}function i4(i){return Ct.matchAll(/\w+|\[(\w*)]/g,i).map(c=>c[0]==="[]"?"":c[1]||c[0])}function s4(i){const c={},p=Object.keys(i);let y;const T=p.length;let M;for(y=0;y<T;y++)M=p[y],c[M]=i[M];return c}function yC(i){function c(p,y,T,M){let C=p[M++];if(C==="__proto__")return!0;const R=Number.isFinite(+C),o=M>=p.length;return C=!C&&Ct.isArray(T)?T.length:C,o?(Ct.hasOwnProp(T,C)?T[C]=[T[C],y]:T[C]=y,!R):((!T[C]||!Ct.isObject(T[C]))&&(T[C]=[]),c(p,y,T[C],M)&&Ct.isArray(T[C])&&(T[C]=s4(T[C])),!R)}if(Ct.isFormData(i)&&Ct.isFunction(i.entries)){const p={};return Ct.forEachEntry(i,(y,T)=>{c(i4(y),T,p,0)}),p}return null}function o4(i,c,p){if(Ct.isString(i))try{return(c||JSON.parse)(i),Ct.trim(i)}catch(y){if(y.name!=="SyntaxError")throw y}return(p||JSON.stringify)(i)}const n1={transitional:_C,adapter:["xhr","http"],transformRequest:[function(c,p){const y=p.getContentType()||"",T=y.indexOf("application/json")>-1,M=Ct.isObject(c);if(M&&Ct.isHTMLForm(c)&&(c=new FormData(c)),Ct.isFormData(c))return T?JSON.stringify(yC(c)):c;if(Ct.isArrayBuffer(c)||Ct.isBuffer(c)||Ct.isStream(c)||Ct.isFile(c)||Ct.isBlob(c))return c;if(Ct.isArrayBufferView(c))return c.buffer;if(Ct.isURLSearchParams(c))return p.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),c.toString();let R;if(M){if(y.indexOf("application/x-www-form-urlencoded")>-1)return n4(c,this.formSerializer).toString();if((R=Ct.isFileList(c))||y.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return vy(R?{"files[]":c}:c,o&&new o,this.formSerializer)}}return M||T?(p.setContentType("application/json",!1),o4(c)):c}],transformResponse:[function(c){const p=this.transitional||n1.transitional,y=p&&p.forcedJSONParsing,T=this.responseType==="json";if(c&&Ct.isString(c)&&(y&&!this.responseType||T)){const C=!(p&&p.silentJSONParsing)&&T;try{return JSON.parse(c)}catch(R){if(C)throw R.name==="SyntaxError"?zn.from(R,zn.ERR_BAD_RESPONSE,this,null,this.response):R}}return c}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:da.classes.FormData,Blob:da.classes.Blob},validateStatus:function(c){return c>=200&&c<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ct.forEach(["delete","get","head","post","put","patch"],i=>{n1.headers[i]={}});const i1=n1,a4=Ct.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),l4=i=>{const c={};let p,y,T;return i&&i.split(`
`).forEach(function(C){T=C.indexOf(":"),p=C.substring(0,T).trim().toLowerCase(),y=C.substring(T+1).trim(),!(!p||c[p]&&a4[p])&&(p==="set-cookie"?c[p]?c[p].push(y):c[p]=[y]:c[p]=c[p]?c[p]+", "+y:y)}),c},iE=Symbol("internals");function wp(i){return i&&String(i).trim().toLowerCase()}function Sg(i){return i===!1||i==null?i:Ct.isArray(i)?i.map(Sg):String(i)}function c4(i){const c=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let y;for(;y=p.exec(i);)c[y[1]]=y[2];return c}const u4=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function z0(i,c,p,y,T){if(Ct.isFunction(y))return y.call(this,c,p);if(T&&(c=p),!!Ct.isString(c)){if(Ct.isString(y))return c.indexOf(y)!==-1;if(Ct.isRegExp(y))return y.test(c)}}function h4(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(c,p,y)=>p.toUpperCase()+y)}function d4(i,c){const p=Ct.toCamelCase(" "+c);["get","set","has"].forEach(y=>{Object.defineProperty(i,y+p,{value:function(T,M,C){return this[y].call(this,c,T,M,C)},configurable:!0})})}class xy{constructor(c){c&&this.set(c)}set(c,p,y){const T=this;function M(R,o,B){const $=wp(o);if(!$)throw new Error("header name must be a non-empty string");const H=Ct.findKey(T,$);(!H||T[H]===void 0||B===!0||B===void 0&&T[H]!==!1)&&(T[H||o]=Sg(R))}const C=(R,o)=>Ct.forEach(R,(B,$)=>M(B,$,o));return Ct.isPlainObject(c)||c instanceof this.constructor?C(c,p):Ct.isString(c)&&(c=c.trim())&&!u4(c)?C(l4(c),p):c!=null&&M(p,c,y),this}get(c,p){if(c=wp(c),c){const y=Ct.findKey(this,c);if(y){const T=this[y];if(!p)return T;if(p===!0)return c4(T);if(Ct.isFunction(p))return p.call(this,T,y);if(Ct.isRegExp(p))return p.exec(T);throw new TypeError("parser must be boolean|regexp|function")}}}has(c,p){if(c=wp(c),c){const y=Ct.findKey(this,c);return!!(y&&this[y]!==void 0&&(!p||z0(this,this[y],y,p)))}return!1}delete(c,p){const y=this;let T=!1;function M(C){if(C=wp(C),C){const R=Ct.findKey(y,C);R&&(!p||z0(y,y[R],R,p))&&(delete y[R],T=!0)}}return Ct.isArray(c)?c.forEach(M):M(c),T}clear(c){const p=Object.keys(this);let y=p.length,T=!1;for(;y--;){const M=p[y];(!c||z0(this,this[M],M,c,!0))&&(delete this[M],T=!0)}return T}normalize(c){const p=this,y={};return Ct.forEach(this,(T,M)=>{const C=Ct.findKey(y,M);if(C){p[C]=Sg(T),delete p[M];return}const R=c?h4(M):String(M).trim();R!==M&&delete p[M],p[R]=Sg(T),y[R]=!0}),this}concat(...c){return this.constructor.concat(this,...c)}toJSON(c){const p=Object.create(null);return Ct.forEach(this,(y,T)=>{y!=null&&y!==!1&&(p[T]=c&&Ct.isArray(y)?y.join(", "):y)}),p}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([c,p])=>c+": "+p).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(c){return c instanceof this?c:new this(c)}static concat(c,...p){const y=new this(c);return p.forEach(T=>y.set(T)),y}static accessor(c){const y=(this[iE]=this[iE]={accessors:{}}).accessors,T=this.prototype;function M(C){const R=wp(C);y[R]||(d4(T,C),y[R]=!0)}return Ct.isArray(c)?c.forEach(M):M(c),this}}xy.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ct.reduceDescriptors(xy.prototype,({value:i},c)=>{let p=c[0].toUpperCase()+c.slice(1);return{get:()=>i,set(y){this[p]=y}}});Ct.freezeMethods(xy);const Ja=xy;function F0(i,c){const p=this||i1,y=c||p,T=Ja.from(y.headers);let M=y.data;return Ct.forEach(i,function(R){M=R.call(p,M,T.normalize(),c?c.status:void 0)}),T.normalize(),M}function vC(i){return!!(i&&i.__CANCEL__)}function am(i,c,p){zn.call(this,i??"canceled",zn.ERR_CANCELED,c,p),this.name="CanceledError"}Ct.inherits(am,zn,{__CANCEL__:!0});function f4(i,c,p){const y=p.config.validateStatus;!p.status||!y||y(p.status)?i(p):c(new zn("Request failed with status code "+p.status,[zn.ERR_BAD_REQUEST,zn.ERR_BAD_RESPONSE][Math.floor(p.status/100)-4],p.config,p.request,p))}const p4=da.hasStandardBrowserEnv?{write(i,c,p,y,T,M){const C=[i+"="+encodeURIComponent(c)];Ct.isNumber(p)&&C.push("expires="+new Date(p).toGMTString()),Ct.isString(y)&&C.push("path="+y),Ct.isString(T)&&C.push("domain="+T),M===!0&&C.push("secure"),document.cookie=C.join("; ")},read(i){const c=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return c?decodeURIComponent(c[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function m4(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function _4(i,c){return c?i.replace(/\/?\/$/,"")+"/"+c.replace(/^\/+/,""):i}function xC(i,c){return i&&!m4(c)?_4(i,c):c}const g4=da.hasStandardBrowserEnv?function(){const c=/(msie|trident)/i.test(navigator.userAgent),p=document.createElement("a");let y;function T(M){let C=M;return c&&(p.setAttribute("href",C),C=p.href),p.setAttribute("href",C),{href:p.href,protocol:p.protocol?p.protocol.replace(/:$/,""):"",host:p.host,search:p.search?p.search.replace(/^\?/,""):"",hash:p.hash?p.hash.replace(/^#/,""):"",hostname:p.hostname,port:p.port,pathname:p.pathname.charAt(0)==="/"?p.pathname:"/"+p.pathname}}return y=T(window.location.href),function(C){const R=Ct.isString(C)?T(C):C;return R.protocol===y.protocol&&R.host===y.host}}():function(){return function(){return!0}}();function y4(i){const c=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return c&&c[1]||""}function v4(i,c){i=i||10;const p=new Array(i),y=new Array(i);let T=0,M=0,C;return c=c!==void 0?c:1e3,function(o){const B=Date.now(),$=y[M];C||(C=B),p[T]=o,y[T]=B;let H=M,ie=0;for(;H!==T;)ie+=p[H++],H=H%i;if(T=(T+1)%i,T===M&&(M=(M+1)%i),B-C<c)return;const oe=$&&B-$;return oe?Math.round(ie*1e3/oe):void 0}}function sE(i,c){let p=0;const y=v4(50,250);return T=>{const M=T.loaded,C=T.lengthComputable?T.total:void 0,R=M-p,o=y(R),B=M<=C;p=M;const $={loaded:M,total:C,progress:C?M/C:void 0,bytes:R,rate:o||void 0,estimated:o&&C&&B?(C-M)/o:void 0,event:T};$[c?"download":"upload"]=!0,i($)}}const x4=typeof XMLHttpRequest<"u",b4=x4&&function(i){return new Promise(function(p,y){let T=i.data;const M=Ja.from(i.headers).normalize();let{responseType:C,withXSRFToken:R}=i,o;function B(){i.cancelToken&&i.cancelToken.unsubscribe(o),i.signal&&i.signal.removeEventListener("abort",o)}let $;if(Ct.isFormData(T)){if(da.hasStandardBrowserEnv||da.hasStandardBrowserWebWorkerEnv)M.setContentType(!1);else if(($=M.getContentType())!==!1){const[Me,...Re]=$?$.split(";").map(Ee=>Ee.trim()).filter(Boolean):[];M.setContentType([Me||"multipart/form-data",...Re].join("; "))}}let H=new XMLHttpRequest;if(i.auth){const Me=i.auth.username||"",Re=i.auth.password?unescape(encodeURIComponent(i.auth.password)):"";M.set("Authorization","Basic "+btoa(Me+":"+Re))}const ie=xC(i.baseURL,i.url);H.open(i.method.toUpperCase(),mC(ie,i.params,i.paramsSerializer),!0),H.timeout=i.timeout;function oe(){if(!H)return;const Me=Ja.from("getAllResponseHeaders"in H&&H.getAllResponseHeaders()),Ee={data:!C||C==="text"||C==="json"?H.responseText:H.response,status:H.status,statusText:H.statusText,headers:Me,config:i,request:H};f4(function(gt){p(gt),B()},function(gt){y(gt),B()},Ee),H=null}if("onloadend"in H?H.onloadend=oe:H.onreadystatechange=function(){!H||H.readyState!==4||H.status===0&&!(H.responseURL&&H.responseURL.indexOf("file:")===0)||setTimeout(oe)},H.onabort=function(){H&&(y(new zn("Request aborted",zn.ECONNABORTED,i,H)),H=null)},H.onerror=function(){y(new zn("Network Error",zn.ERR_NETWORK,i,H)),H=null},H.ontimeout=function(){let Re=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const Ee=i.transitional||_C;i.timeoutErrorMessage&&(Re=i.timeoutErrorMessage),y(new zn(Re,Ee.clarifyTimeoutError?zn.ETIMEDOUT:zn.ECONNABORTED,i,H)),H=null},da.hasStandardBrowserEnv&&(R&&Ct.isFunction(R)&&(R=R(i)),R||R!==!1&&g4(ie))){const Me=i.xsrfHeaderName&&i.xsrfCookieName&&p4.read(i.xsrfCookieName);Me&&M.set(i.xsrfHeaderName,Me)}T===void 0&&M.setContentType(null),"setRequestHeader"in H&&Ct.forEach(M.toJSON(),function(Re,Ee){H.setRequestHeader(Ee,Re)}),Ct.isUndefined(i.withCredentials)||(H.withCredentials=!!i.withCredentials),C&&C!=="json"&&(H.responseType=i.responseType),typeof i.onDownloadProgress=="function"&&H.addEventListener("progress",sE(i.onDownloadProgress,!0)),typeof i.onUploadProgress=="function"&&H.upload&&H.upload.addEventListener("progress",sE(i.onUploadProgress)),(i.cancelToken||i.signal)&&(o=Me=>{H&&(y(!Me||Me.type?new am(null,i,H):Me),H.abort(),H=null)},i.cancelToken&&i.cancelToken.subscribe(o),i.signal&&(i.signal.aborted?o():i.signal.addEventListener("abort",o)));const _e=y4(ie);if(_e&&da.protocols.indexOf(_e)===-1){y(new zn("Unsupported protocol "+_e+":",zn.ERR_BAD_REQUEST,i));return}H.send(T||null)})},px={http:qB,xhr:b4};Ct.forEach(px,(i,c)=>{if(i){try{Object.defineProperty(i,"name",{value:c})}catch{}Object.defineProperty(i,"adapterName",{value:c})}});const oE=i=>`- ${i}`,w4=i=>Ct.isFunction(i)||i===null||i===!1,bC={getAdapter:i=>{i=Ct.isArray(i)?i:[i];const{length:c}=i;let p,y;const T={};for(let M=0;M<c;M++){p=i[M];let C;if(y=p,!w4(p)&&(y=px[(C=String(p)).toLowerCase()],y===void 0))throw new zn(`Unknown adapter '${C}'`);if(y)break;T[C||"#"+M]=y}if(!y){const M=Object.entries(T).map(([R,o])=>`adapter ${R} `+(o===!1?"is not supported by the environment":"is not available in the build"));let C=c?M.length>1?`since :
`+M.map(oE).join(`
`):" "+oE(M[0]):"as no adapter specified";throw new zn("There is no suitable adapter to dispatch the request "+C,"ERR_NOT_SUPPORT")}return y},adapters:px};function B0(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new am(null,i)}function aE(i){return B0(i),i.headers=Ja.from(i.headers),i.data=F0.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),bC.getAdapter(i.adapter||i1.adapter)(i).then(function(y){return B0(i),y.data=F0.call(i,i.transformResponse,y),y.headers=Ja.from(y.headers),y},function(y){return vC(y)||(B0(i),y&&y.response&&(y.response.data=F0.call(i,i.transformResponse,y.response),y.response.headers=Ja.from(y.response.headers))),Promise.reject(y)})}const lE=i=>i instanceof Ja?{...i}:i;function Jh(i,c){c=c||{};const p={};function y(B,$,H){return Ct.isPlainObject(B)&&Ct.isPlainObject($)?Ct.merge.call({caseless:H},B,$):Ct.isPlainObject($)?Ct.merge({},$):Ct.isArray($)?$.slice():$}function T(B,$,H){if(Ct.isUndefined($)){if(!Ct.isUndefined(B))return y(void 0,B,H)}else return y(B,$,H)}function M(B,$){if(!Ct.isUndefined($))return y(void 0,$)}function C(B,$){if(Ct.isUndefined($)){if(!Ct.isUndefined(B))return y(void 0,B)}else return y(void 0,$)}function R(B,$,H){if(H in c)return y(B,$);if(H in i)return y(void 0,B)}const o={url:M,method:M,data:M,baseURL:C,transformRequest:C,transformResponse:C,paramsSerializer:C,timeout:C,timeoutMessage:C,withCredentials:C,withXSRFToken:C,adapter:C,responseType:C,xsrfCookieName:C,xsrfHeaderName:C,onUploadProgress:C,onDownloadProgress:C,decompress:C,maxContentLength:C,maxBodyLength:C,beforeRedirect:C,transport:C,httpAgent:C,httpsAgent:C,cancelToken:C,socketPath:C,responseEncoding:C,validateStatus:R,headers:(B,$)=>T(lE(B),lE($),!0)};return Ct.forEach(Object.keys(Object.assign({},i,c)),function($){const H=o[$]||T,ie=H(i[$],c[$],$);Ct.isUndefined(ie)&&H!==R||(p[$]=ie)}),p}const wC="1.6.8",s1={};["object","boolean","number","function","string","symbol"].forEach((i,c)=>{s1[i]=function(y){return typeof y===i||"a"+(c<1?"n ":" ")+i}});const cE={};s1.transitional=function(c,p,y){function T(M,C){return"[Axios v"+wC+"] Transitional option '"+M+"'"+C+(y?". "+y:"")}return(M,C,R)=>{if(c===!1)throw new zn(T(C," has been removed"+(p?" in "+p:"")),zn.ERR_DEPRECATED);return p&&!cE[C]&&(cE[C]=!0,console.warn(T(C," has been deprecated since v"+p+" and will be removed in the near future"))),c?c(M,C,R):!0}};function T4(i,c,p){if(typeof i!="object")throw new zn("options must be an object",zn.ERR_BAD_OPTION_VALUE);const y=Object.keys(i);let T=y.length;for(;T-- >0;){const M=y[T],C=c[M];if(C){const R=i[M],o=R===void 0||C(R,M,i);if(o!==!0)throw new zn("option "+M+" must be "+o,zn.ERR_BAD_OPTION_VALUE);continue}if(p!==!0)throw new zn("Unknown option "+M,zn.ERR_BAD_OPTION)}}const mx={assertOptions:T4,validators:s1},Yl=mx.validators;class Ng{constructor(c){this.defaults=c,this.interceptors={request:new nE,response:new nE}}async request(c,p){try{return await this._request(c,p)}catch(y){if(y instanceof Error){let T;Error.captureStackTrace?Error.captureStackTrace(T={}):T=new Error;const M=T.stack?T.stack.replace(/^.+\n/,""):"";y.stack?M&&!String(y.stack).endsWith(M.replace(/^.+\n.+\n/,""))&&(y.stack+=`
`+M):y.stack=M}throw y}}_request(c,p){typeof c=="string"?(p=p||{},p.url=c):p=c||{},p=Jh(this.defaults,p);const{transitional:y,paramsSerializer:T,headers:M}=p;y!==void 0&&mx.assertOptions(y,{silentJSONParsing:Yl.transitional(Yl.boolean),forcedJSONParsing:Yl.transitional(Yl.boolean),clarifyTimeoutError:Yl.transitional(Yl.boolean)},!1),T!=null&&(Ct.isFunction(T)?p.paramsSerializer={serialize:T}:mx.assertOptions(T,{encode:Yl.function,serialize:Yl.function},!0)),p.method=(p.method||this.defaults.method||"get").toLowerCase();let C=M&&Ct.merge(M.common,M[p.method]);M&&Ct.forEach(["delete","get","head","post","put","patch","common"],_e=>{delete M[_e]}),p.headers=Ja.concat(C,M);const R=[];let o=!0;this.interceptors.request.forEach(function(Me){typeof Me.runWhen=="function"&&Me.runWhen(p)===!1||(o=o&&Me.synchronous,R.unshift(Me.fulfilled,Me.rejected))});const B=[];this.interceptors.response.forEach(function(Me){B.push(Me.fulfilled,Me.rejected)});let $,H=0,ie;if(!o){const _e=[aE.bind(this),void 0];for(_e.unshift.apply(_e,R),_e.push.apply(_e,B),ie=_e.length,$=Promise.resolve(p);H<ie;)$=$.then(_e[H++],_e[H++]);return $}ie=R.length;let oe=p;for(H=0;H<ie;){const _e=R[H++],Me=R[H++];try{oe=_e(oe)}catch(Re){Me.call(this,Re);break}}try{$=aE.call(this,oe)}catch(_e){return Promise.reject(_e)}for(H=0,ie=B.length;H<ie;)$=$.then(B[H++],B[H++]);return $}getUri(c){c=Jh(this.defaults,c);const p=xC(c.baseURL,c.url);return mC(p,c.params,c.paramsSerializer)}}Ct.forEach(["delete","get","head","options"],function(c){Ng.prototype[c]=function(p,y){return this.request(Jh(y||{},{method:c,url:p,data:(y||{}).data}))}});Ct.forEach(["post","put","patch"],function(c){function p(y){return function(M,C,R){return this.request(Jh(R||{},{method:c,headers:y?{"Content-Type":"multipart/form-data"}:{},url:M,data:C}))}}Ng.prototype[c]=p(),Ng.prototype[c+"Form"]=p(!0)});const Mg=Ng;class o1{constructor(c){if(typeof c!="function")throw new TypeError("executor must be a function.");let p;this.promise=new Promise(function(M){p=M});const y=this;this.promise.then(T=>{if(!y._listeners)return;let M=y._listeners.length;for(;M-- >0;)y._listeners[M](T);y._listeners=null}),this.promise.then=T=>{let M;const C=new Promise(R=>{y.subscribe(R),M=R}).then(T);return C.cancel=function(){y.unsubscribe(M)},C},c(function(M,C,R){y.reason||(y.reason=new am(M,C,R),p(y.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(c){if(this.reason){c(this.reason);return}this._listeners?this._listeners.push(c):this._listeners=[c]}unsubscribe(c){if(!this._listeners)return;const p=this._listeners.indexOf(c);p!==-1&&this._listeners.splice(p,1)}static source(){let c;return{token:new o1(function(T){c=T}),cancel:c}}}const S4=o1;function M4(i){return function(p){return i.apply(null,p)}}function E4(i){return Ct.isObject(i)&&i.isAxiosError===!0}const _x={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(_x).forEach(([i,c])=>{_x[c]=i});const A4=_x;function TC(i){const c=new Mg(i),p=nC(Mg.prototype.request,c);return Ct.extend(p,Mg.prototype,c,{allOwnKeys:!0}),Ct.extend(p,c,null,{allOwnKeys:!0}),p.create=function(T){return TC(Jh(i,T))},p}const zi=TC(i1);zi.Axios=Mg;zi.CanceledError=am;zi.CancelToken=S4;zi.isCancel=vC;zi.VERSION=wC;zi.toFormData=vy;zi.AxiosError=zn;zi.Cancel=zi.CanceledError;zi.all=function(c){return Promise.all(c)};zi.spread=M4;zi.isAxiosError=E4;zi.mergeConfig=Jh;zi.AxiosHeaders=Ja;zi.formToJSON=i=>yC(Ct.isHTMLForm(i)?new FormData(i):i);zi.getAdapter=bC.getAdapter;zi.HttpStatusCode=A4;zi.default=zi;const I4={class:"sec1"},C4={class:"title"},P4=["innerHTML"],D4=["innerHTML"],L4=["innerHTML"],R4=["innerHTML"],k4={__name:"AboutSection1",setup(i){const c=mo(),p=ho(),y=e1(),T=rt(()=>p.get("aboutSection1",c.language)),M=Zr(null),C=()=>{var R=document.querySelector(".sec1").offsetHeight;window.innerWidth<700?R+=80:R+=90,y.changeVar("height",R);var o=y.vars.height;M.value.style.height=Zr(o+"px").value};return ya(()=>{C(),window.addEventListener("resize",C)}),(R,o)=>(It(),Wt(Mn,null,[Ue("section",I4,[Ue("h1",C4,[Ue("span",{class:"t-part",innerHTML:T.value.span1},null,8,P4),Ue("span",{class:"t-part",innerHTML:T.value.span2},null,8,D4)]),Ue("p",{class:"mid-title",innerHTML:T.value.txt1},null,8,L4),Ue("p",{class:"bottom-title",innerHTML:T.value.txt2},null,8,R4)]),Ue("div",{class:"hidden-comp",ref_key:"hiddenHeight",ref:M},null,512)],64))}},O4=Ki(k4,[["__scopeId","data-v-00ce8a13"]]),z4=i=>(fc("data-v-5d0309d9"),i=i(),pc(),i),F4=z4(()=>Ue("section",{class:"sec2"},[Ue("p",null,"content available in future versions")],-1)),B4=[F4],N4={__name:"AboutSection2",setup(i){const c=mo(),p=ho();return rt(()=>p.get("",c.language)),(y,T)=>(It(),Wt("div",null,B4))}},V4=Ki(N4,[["__scopeId","data-v-5d0309d9"]]),$4={class:"col1"},U4=["innerHTML"],j4=["innerHTML"],G4=["innerHTML"],H4=["innerHTML"],q4={key:4,class:"btns"},W4={class:"type1 btn-filled"},Y4=["innerHTML"],Z4={class:"type1"},X4=["innerHTML"],K4={key:5},J4=["innerHTML"],Q4={class:"col2"},eN={class:"img"},tN={key:0,src:"",alt:"foto/"},rN={key:1,src:"",alt:"foto/"},nN={__name:"AboutSection3",props:["type"],setup(i){const c=mo(),p=ho(),y=rt(()=>p.get("aboutSection3",c.language));return(T,M)=>(It(),Wt("div",null,[Ue("section",{class:Rn(["sec3",{sec3bottom:i.type==1}])},[Ue("div",$4,[i.type==0?(It(),Wt("h3",{key:0,innerHTML:y.value.type0.txt1},null,8,U4)):(It(),Wt("h3",{key:1,class:Rn({biggerh3:i.type==1}),innerHTML:y.value.type1.txt1},null,10,j4)),i.type==0?(It(),Wt("p",{key:2,innerHTML:y.value.type0.txt2},null,8,G4)):(It(),Wt("p",{key:3,innerHTML:y.value.type1.txt2},null,8,H4)),i.type==1?(It(),Wt("div",q4,[Ue("button",W4,[Ue("a",{href:"",innerHTML:y.value.type1.btn1},null,8,Y4)]),Ue("button",Z4,[Ue("a",{href:"",innerHTML:y.value.type1.btn2},null,8,X4)])])):(It(),Wt("button",K4,[Ue("a",{href:"",innerHTML:y.value.type0.btn1},null,8,J4)]))]),Ue("div",Q4,[Ue("div",eN,[i.type==1?(It(),Wt("img",tN)):(It(),Wt("img",rN))])])],2)]))}},uE=Ki(nN,[["__scopeId","data-v-e75b82f2"]]),lm=i=>(fc("data-v-17ca36f5"),i=i(),pc(),i),iN={class:"sec4"},sN={class:"col"},oN=lm(()=>Ue("span",{class:"material-symbols-outlined"},"chat_bubble",-1)),aN=["innerHTML"],lN=["innerHTML"],cN={class:"col"},uN=lm(()=>Ue("span",{class:"material-symbols-outlined"},"photo_camera",-1)),hN=["innerHTML"],dN=["innerHTML"],fN={class:"col"},pN=lm(()=>Ue("span",{class:"material-symbols-outlined"},"globe",-1)),mN=["innerHTML"],_N=["innerHTML"],gN={class:"col"},yN=lm(()=>Ue("span",{class:"material-symbols-outlined"},"battery_horiz_050",-1)),vN=["innerHTML"],xN=["innerHTML"],bN=lm(()=>Ue("link",{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"},null,-1)),wN={__name:"AboutSection4",setup(i){const c=mo(),p=ho(),y=rt(()=>p.get("aboutSection4",c.language));return(T,M)=>(It(),Wt(Mn,null,[Ue("div",null,[Ue("section",iN,[Ue("div",sN,[oN,Ue("h5",{innerHTML:y.value.title1},null,8,aN),Ue("p",{innerHTML:y.value.txt1},null,8,lN)]),Ue("div",cN,[uN,Ue("h5",{innerHTML:y.value.title2},null,8,hN),Ue("p",{innerHTML:y.value.txt2},null,8,dN)]),Ue("div",fN,[pN,Ue("h5",{innerHTML:y.value.title3},null,8,mN),Ue("p",{innerHTML:y.value.txt3},null,8,_N)]),Ue("div",gN,[yN,Ue("h5",{innerHTML:y.value.title4},null,8,vN),Ue("p",{innerHTML:y.value.txt4},null,8,xN)])])]),bN],64))}},TN=Ki(wN,[["__scopeId","data-v-17ca36f5"]]),SN=i=>(fc("data-v-349044c7"),i=i(),pc(),i),MN=SN(()=>Ue("section",{class:"sec5"},[Ue("p",null,"content available in future versions")],-1)),EN=[MN],AN={__name:"AboutSection5",setup(i){const c=mo(),p=ho();return rt(()=>p.get("",c.language)),(y,T)=>(It(),Wt("div",null,EN))}},IN=Ki(AN,[["__scopeId","data-v-349044c7"]]),SC=i=>(fc("data-v-e6792e7f"),i=i(),pc(),i),CN={class:"col1"},PN=SC(()=>Ue("h6",null,"AIVOY",-1)),DN=["innerHTML"],LN=SC(()=>Ue("div",{class:"col2"},[Ue("span",{class:"material-symbols-outlined"},"nest_thermostat_gen_3"),Ue("span",{class:"material-symbols-outlined"},"nest_thermostat_gen_3"),Ue("span",{class:"material-symbols-outlined"},"nest_thermostat_gen_3")],-1)),RN={__name:"FooterTeo",setup(i){const c=mo(),p=ho(),y=rt(()=>p.get("footerTeo",c.language));return(T,M)=>(It(),Wt("div",null,[Ue("footer",null,[Ue("div",CN,[PN,Ue("p",{innerHTML:y.value.txt1},null,8,DN)]),LN])]))}},kN=Ki(RN,[["__scopeId","data-v-e6792e7f"]]),ON={class:"allComponents"},zN={__name:"AboutComponent",setup(i){console.log("ESTAS EN bienvenido CLIENTE");const c=Qx();return(async()=>{try{const y=await zi.get("/session");console.log("Log client bienvenido=> ",y),y.status===200&&c.push("/about")}catch(y){console.error("Error al iniciar sesin:",y),y.response&&y.response.status===401&&(console.log("La sesin ha caducado, redirigiendo al formulario de inicio de sesin..."),c.push("/login"))}})(),(y,T)=>(It(),Wt("section",ON,[_r(my),_r(O4),_r(V4),_r(uE,{type:"0"}),_r(TN),_r(IN),_r(uE,{type:"1"}),_r(kN)]))}},FN=Ki(zN,[["__scopeId","data-v-5dae32a6"]]),BN={class:"container-fluid"},NN={__name:"AboutView",setup(i){return(c,p)=>(It(),Wt("main",BN,[Ue("div",null,[_r(FN)])]))}};var by={library:"https://accounts.google.com/gsi/client",defaultButtonConfig:{theme:"outline",size:"large"},scopes:"email profile openid"};const bs=Xs({clientId:null,popupType:"CODE",prompt:!1,autoLogin:!1,idConfiguration:null,buttonConfig:by.defaultButtonConfig,callback:()=>{},error:null}),Hh=Xs({apiLoaded:!1,apiLoadIntitited:!1}),VN=i=>{try{const c=i.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),p=decodeURIComponent(atob(c).split("").map(function(y){return"%"+("00"+y.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(p)}catch{throw"JWT provided is invalid"}},MC=new Promise(i=>{const c=typeof window<"u";if(!Hh.apiLoadIntitited&&c){const p=document.createElement("script");Hh.apiLoadIntitited=!0,p.addEventListener("load",()=>{Hh.apiLoaded=!0,i(window.google)}),p.src=by.library,p.async=!0,p.defer=!0,document.head.appendChild(p)}}),wy=i=>{Hh.apiLoadIntitited?Hh.apiLoaded?i(window.google):Oi(()=>Hh.apiLoaded,c=>{c&&i(window.google)}):MC.then(c=>{i(c)})},$N=(i,c,p,y)=>{if(!i.client_id)throw new Error("Prop client id required since plugin is not initialized with a client id");wy(()=>{((T,M,C,R,o)=>{if(o){const $=T.callback;T.callback=H=>{H.credential?$&&$(H):o(H)}}window.google.accounts.id.initialize(T);const B=M.value;B&&!R&&window.google.accounts.id.renderButton(B,C)})(i,c,p.buttonConfig,y,p.error),p.prompt&&GN({clientId:p.clientId,callback:p.callback,error:p.error,autoLogin:p.autoLogin})})},UN=i=>new Promise((c,p)=>{wy(y=>{if(!(i&&i.clientId||bs.clientId))throw new Error("clientId is required since the plugin is not initialized with a Client Id");y.accounts.oauth2.initCodeClient({client_id:i&&i.clientId||bs.clientId||"",scope:by.scopes,ux_mode:"popup",callback:T=>{T.code?c(T):p(T)},error_callback:T=>{p(T)}}).requestCode()})}),jN=i=>new Promise((c,p)=>{wy(y=>{if(!(i&&i.clientId||bs.clientId))throw new Error("clientId is required since the plugin is not initialized with a Client Id");y.accounts.oauth2.initTokenClient({client_id:i&&i.clientId||bs.clientId||"",scope:by.scopes,callback:T=>{T.access_token?c(T):p(T)},error_callback:T=>{p(T)}}).requestAccessToken()})}),GN=i=>{if(!i&&(i={}),!i.clientId&&!bs.clientId)throw new Error("clientId is required");const c={use_fedcm_for_prompt:!0};return i.clientId&&(c.client_id=i.clientId),!i.clientId&&bs.clientId&&(c.client_id=bs.clientId),i.context&&(c.context=i.context),i.autoLogin!=null&&(c.auto_select=i.autoLogin),i.cancelOnTapOutside!=null&&(c.cancel_on_tap_outside=i.cancelOnTapOutside),new Promise((p,y)=>{c.callback=T=>{i&&i.callback&&i.callback(T),T.credential?p(T):y(T)},wy(T=>{T.accounts.id.initialize(c),T.accounts.id.prompt()})})};var gx=Gi({__name:"GoogleLogin",props:{clientId:{type:String,required:!1},prompt:{type:Boolean,required:!1,default:!1},autoLogin:{type:Boolean,required:!1,default:!1},popupType:{type:String,required:!1},idConfiguration:{type:Object,required:!1},buttonConfig:{type:Object,required:!1},callback:{type:Function,required:!1},error:{type:Function,required:!1}},setup(i){const c=!!ZO().default,p=i,y=((C,R)=>{const o={...C};for(const B in R)R[B]!==void 0&&R[B]!==null&&(o[B]=R[B]);return o})(bs,p),T={client_id:y.clientId||null,auto_select:y.autoLogin||!1,callback:y.callback,...y.idConfiguration},M=Zr();return ya(()=>{$N(T,M,y,c),p.popupType&&!c&&console.warn("Option 'popupType' is ignored since a slot which act as a custom login button was not found!!!")}),(C,R)=>(It(),Wt("div",{class:"g-btn-wrapper",onClick:R[0]||(R[0]=o=>yt(c)&&void(yt(y).popupType==="TOKEN"?jN({clientId:y.clientId}).then(B=>{y.callback&&y.callback(B)}).catch(B=>{y.error&&y.error(B)}):UN({clientId:y.clientId}).then(B=>{y.callback&&y.callback(B)}).catch(B=>{y.error&&y.error(B)})))},[yt(c)?Ei("v-if",!0):(It(),Wt("span",{key:0,ref_key:"buttonRef",ref:M,class:"g-btn"},null,512)),od(C.$slots,"default")]))}});(function(i,c){c===void 0&&(c={});var p=c.insertAt;if(i&&typeof document<"u"){var y=document.head||document.getElementsByTagName("head")[0],T=document.createElement("style");T.type="text/css",p==="top"&&y.firstChild?y.insertBefore(T,y.firstChild):y.appendChild(T),T.styleSheet?T.styleSheet.cssText=i:T.appendChild(document.createTextNode(i))}})(`
.g-btn-wrapper[data-v-5e610566] {
  display: inline-block;
}
`),gx.__scopeId="data-v-5e610566",gx.__file="src/plugin/GoogleLogin.vue";var HN={install:(i,c)=>{c&&(p=>{p.clientId&&(bs.clientId=p.clientId),p.popupType&&(bs.popupType=p.popupType),p.prompt!=null&&(bs.prompt=p.prompt),p.autoLogin!=null&&(bs.autoLogin=p.autoLogin),p.idConfiguration&&(bs.idConfiguration=p.idConfiguration),p.buttonConfig&&(bs.buttonConfig=p.buttonConfig),p.callback&&(bs.callback=p.callback)})(c),MC.then(()=>{if(c.clientId){const p={client_id:c.clientId,auto_select:c.autoLogin===!0,callback:c.callback,use_fedcm_for_prompt:!0,...c.idConfiguration};window.google.accounts.id.initialize(p),c.prompt&&window.google.accounts.id.prompt()}}),i.component("GoogleLogin",gx)}};const Ty=i=>(fc("data-v-829acfef"),i=i(),pc(),i),qN={id:"section"},WN={id:"login"},YN={id:"title"},ZN={class:"input-line"},XN={class:"input-line"},KN=Ty(()=>Ue("div",{class:"input-line regist"},[Ue("input",{type:"text",id:"password",placeholder:"Nombre..."})],-1)),JN=Ty(()=>Ue("div",{class:"input-line regist"},[Ue("input",{type:"text",id:"password",placeholder:"Apellido..."})],-1)),QN={id:"submit"},e5={id:"google-log"},t5=Ty(()=>Ue("button",{type:"submit",form:"form"},"Validar datos prueba",-1)),r5=Ty(()=>Ue("div",{id:"register"},null,-1)),n5={__name:"Login",setup(i){const c=Zr(""),p=Zr(""),y=Qx(),T=Zr(!1),M=Zr(!1),C=Zr("Iniciar Sesin");var R=document.documentElement,o=.5;R.style.setProperty("--AnimationTime",o+"s");const B=rt(()=>({animate__animated:!0,animate__flipOutX:M.value,animate__flipInX:!M.value}));function $(oe){T.value=oe,M.value=!0,setTimeout(()=>{M.value=!1},o*1e3),setTimeout(()=>{oe?C.value="Registrarse":C.value="Iniciar Sesin"},o*1e3)}const H=oe=>{const _e=VN(oe.credential);console.log("Handle the userData",_e)},ie=async()=>{try{const oe=await zi.post("/server/login",{mail:c.value,password:p.value});console.log("Log client login => ",oe),oe.status===200?y.push("/about"):oe.status===401?(console.log("La sesin ha caducado, redirigiendo al formulario de inicio de sesin..."),y.push("/login")):console.error("Inicio de sesin fallido:",oe.data.message)}catch(oe){console.error("Error al iniciar sesin:",oe)}};return(oe,_e)=>{const Me=ca("GoogleLogin");return It(),Wt("div",null,[Ue("div",qN,[Ue("div",WN,[Ue("div",{id:"content",class:Rn({"animate-content":T.value})},[Ue("div",YN,[Ue("h1",{class:Rn(B.value)},Mi(C.value),3)]),Ue("form",{onSubmit:wg(ie,["prevent"]),id:"form",class:Rn({"form-Animation":T.value})},[Ue("div",ZN,[uc(Ue("input",{type:"email",id:"email",placeholder:"Email...","onUpdate:modelValue":_e[0]||(_e[0]=Re=>c.value=Re),required:""},null,512),[[sx,c.value]])]),Ue("div",XN,[uc(Ue("input",{type:"password",id:"password",placeholder:"Contrasea...","onUpdate:modelValue":_e[1]||(_e[1]=Re=>p.value=Re),required:""},null,512),[[sx,p.value]])]),KN,JN],34),Ue("div",QN,[Ue("button",{type:"submit",id:"regis",form:"form",onClick:_e[2]||(_e[2]=wg(Re=>$(!0),["prevent"]))},"Registrarse"),Ue("button",{type:"submit",id:"log",form:"form",onClick:_e[3]||(_e[3]=wg(Re=>$(!1),["prevent"]))},"Inciar sesin"),Ue("div",{class:Rn(["colorbox",{"colorbox-tranform":T.value}])},null,2)]),Ue("div",e5,[_r(Me,{callback:H,prompt:"","auto-login":""})]),t5],2)]),r5])])}}},i5=Ki(n5,[["__scopeId","data-v-829acfef"]]),s5={id:"body"},o5={__name:"LoginView",setup(i){return(c,p)=>(It(),Wt("div",s5,[_r(my),_r(i5)]))}},a5=Ki(o5,[["__scopeId","data-v-94fe72c5"]]);var Rs="top",fo="bottom",po="right",ks="left",a1="auto",cm=[Rs,fo,po,ks],Qh="start",Xp="end",l5="clippingParents",EC="viewport",Tp="popper",c5="reference",hE=cm.reduce(function(i,c){return i.concat([c+"-"+Qh,c+"-"+Xp])},[]),AC=[].concat(cm,[a1]).reduce(function(i,c){return i.concat([c,c+"-"+Qh,c+"-"+Xp])},[]),u5="beforeRead",h5="read",d5="afterRead",f5="beforeMain",p5="main",m5="afterMain",_5="beforeWrite",g5="write",y5="afterWrite",v5=[u5,h5,d5,f5,p5,m5,_5,g5,y5];function ga(i){return i?(i.nodeName||"").toLowerCase():null}function Ks(i){if(i==null)return window;if(i.toString()!=="[object Window]"){var c=i.ownerDocument;return c&&c.defaultView||window}return i}function Eu(i){var c=Ks(i).Element;return i instanceof c||i instanceof Element}function co(i){var c=Ks(i).HTMLElement;return i instanceof c||i instanceof HTMLElement}function l1(i){if(typeof ShadowRoot>"u")return!1;var c=Ks(i).ShadowRoot;return i instanceof c||i instanceof ShadowRoot}function x5(i){var c=i.state;Object.keys(c.elements).forEach(function(p){var y=c.styles[p]||{},T=c.attributes[p]||{},M=c.elements[p];!co(M)||!ga(M)||(Object.assign(M.style,y),Object.keys(T).forEach(function(C){var R=T[C];R===!1?M.removeAttribute(C):M.setAttribute(C,R===!0?"":R)}))})}function b5(i){var c=i.state,p={popper:{position:c.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(c.elements.popper.style,p.popper),c.styles=p,c.elements.arrow&&Object.assign(c.elements.arrow.style,p.arrow),function(){Object.keys(c.elements).forEach(function(y){var T=c.elements[y],M=c.attributes[y]||{},C=Object.keys(c.styles.hasOwnProperty(y)?c.styles[y]:p[y]),R=C.reduce(function(o,B){return o[B]="",o},{});!co(T)||!ga(T)||(Object.assign(T.style,R),Object.keys(M).forEach(function(o){T.removeAttribute(o)}))})}}const w5={name:"applyStyles",enabled:!0,phase:"write",fn:x5,effect:b5,requires:["computeStyles"]};function ma(i){return i.split("-")[0]}var Mu=Math.max,Vg=Math.min,ed=Math.round;function yx(){var i=navigator.userAgentData;return i!=null&&i.brands&&Array.isArray(i.brands)?i.brands.map(function(c){return c.brand+"/"+c.version}).join(" "):navigator.userAgent}function IC(){return!/^((?!chrome|android).)*safari/i.test(yx())}function td(i,c,p){c===void 0&&(c=!1),p===void 0&&(p=!1);var y=i.getBoundingClientRect(),T=1,M=1;c&&co(i)&&(T=i.offsetWidth>0&&ed(y.width)/i.offsetWidth||1,M=i.offsetHeight>0&&ed(y.height)/i.offsetHeight||1);var C=Eu(i)?Ks(i):window,R=C.visualViewport,o=!IC()&&p,B=(y.left+(o&&R?R.offsetLeft:0))/T,$=(y.top+(o&&R?R.offsetTop:0))/M,H=y.width/T,ie=y.height/M;return{width:H,height:ie,top:$,right:B+H,bottom:$+ie,left:B,x:B,y:$}}function c1(i){var c=td(i),p=i.offsetWidth,y=i.offsetHeight;return Math.abs(c.width-p)<=1&&(p=c.width),Math.abs(c.height-y)<=1&&(y=c.height),{x:i.offsetLeft,y:i.offsetTop,width:p,height:y}}function CC(i,c){var p=c.getRootNode&&c.getRootNode();if(i.contains(c))return!0;if(p&&l1(p)){var y=c;do{if(y&&i.isSameNode(y))return!0;y=y.parentNode||y.host}while(y)}return!1}function Qa(i){return Ks(i).getComputedStyle(i)}function T5(i){return["table","td","th"].indexOf(ga(i))>=0}function _c(i){return((Eu(i)?i.ownerDocument:i.document)||window.document).documentElement}function Sy(i){return ga(i)==="html"?i:i.assignedSlot||i.parentNode||(l1(i)?i.host:null)||_c(i)}function dE(i){return!co(i)||Qa(i).position==="fixed"?null:i.offsetParent}function S5(i){var c=/firefox/i.test(yx()),p=/Trident/i.test(yx());if(p&&co(i)){var y=Qa(i);if(y.position==="fixed")return null}var T=Sy(i);for(l1(T)&&(T=T.host);co(T)&&["html","body"].indexOf(ga(T))<0;){var M=Qa(T);if(M.transform!=="none"||M.perspective!=="none"||M.contain==="paint"||["transform","perspective"].indexOf(M.willChange)!==-1||c&&M.willChange==="filter"||c&&M.filter&&M.filter!=="none")return T;T=T.parentNode}return null}function um(i){for(var c=Ks(i),p=dE(i);p&&T5(p)&&Qa(p).position==="static";)p=dE(p);return p&&(ga(p)==="html"||ga(p)==="body"&&Qa(p).position==="static")?c:p||S5(i)||c}function u1(i){return["top","bottom"].indexOf(i)>=0?"x":"y"}function Bp(i,c,p){return Mu(i,Vg(c,p))}function M5(i,c,p){var y=Bp(i,c,p);return y>p?p:y}function PC(){return{top:0,right:0,bottom:0,left:0}}function DC(i){return Object.assign({},PC(),i)}function LC(i,c){return c.reduce(function(p,y){return p[y]=i,p},{})}var E5=function(c,p){return c=typeof c=="function"?c(Object.assign({},p.rects,{placement:p.placement})):c,DC(typeof c!="number"?c:LC(c,cm))};function A5(i){var c,p=i.state,y=i.name,T=i.options,M=p.elements.arrow,C=p.modifiersData.popperOffsets,R=ma(p.placement),o=u1(R),B=[ks,po].indexOf(R)>=0,$=B?"height":"width";if(!(!M||!C)){var H=E5(T.padding,p),ie=c1(M),oe=o==="y"?Rs:ks,_e=o==="y"?fo:po,Me=p.rects.reference[$]+p.rects.reference[o]-C[o]-p.rects.popper[$],Re=C[o]-p.rects.reference[o],Ee=um(M),mt=Ee?o==="y"?Ee.clientHeight||0:Ee.clientWidth||0:0,gt=Me/2-Re/2,dt=H[oe],ut=mt-ie[$]-H[_e],ht=mt/2-ie[$]/2+gt,lt=Bp(dt,ht,ut),Qe=o;p.modifiersData[y]=(c={},c[Qe]=lt,c.centerOffset=lt-ht,c)}}function I5(i){var c=i.state,p=i.options,y=p.element,T=y===void 0?"[data-popper-arrow]":y;T!=null&&(typeof T=="string"&&(T=c.elements.popper.querySelector(T),!T)||CC(c.elements.popper,T)&&(c.elements.arrow=T))}const C5={name:"arrow",enabled:!0,phase:"main",fn:A5,effect:I5,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function rd(i){return i.split("-")[1]}var P5={top:"auto",right:"auto",bottom:"auto",left:"auto"};function D5(i,c){var p=i.x,y=i.y,T=c.devicePixelRatio||1;return{x:ed(p*T)/T||0,y:ed(y*T)/T||0}}function fE(i){var c,p=i.popper,y=i.popperRect,T=i.placement,M=i.variation,C=i.offsets,R=i.position,o=i.gpuAcceleration,B=i.adaptive,$=i.roundOffsets,H=i.isFixed,ie=C.x,oe=ie===void 0?0:ie,_e=C.y,Me=_e===void 0?0:_e,Re=typeof $=="function"?$({x:oe,y:Me}):{x:oe,y:Me};oe=Re.x,Me=Re.y;var Ee=C.hasOwnProperty("x"),mt=C.hasOwnProperty("y"),gt=ks,dt=Rs,ut=window;if(B){var ht=um(p),lt="clientHeight",Qe="clientWidth";if(ht===Ks(p)&&(ht=_c(p),Qa(ht).position!=="static"&&R==="absolute"&&(lt="scrollHeight",Qe="scrollWidth")),ht=ht,T===Rs||(T===ks||T===po)&&M===Xp){dt=fo;var Se=H&&ht===ut&&ut.visualViewport?ut.visualViewport.height:ht[lt];Me-=Se-y.height,Me*=o?1:-1}if(T===ks||(T===Rs||T===fo)&&M===Xp){gt=po;var Xt=H&&ht===ut&&ut.visualViewport?ut.visualViewport.width:ht[Qe];oe-=Xt-y.width,oe*=o?1:-1}}var xr=Object.assign({position:R},B&&P5),Ve=$===!0?D5({x:oe,y:Me},Ks(p)):{x:oe,y:Me};if(oe=Ve.x,Me=Ve.y,o){var jt;return Object.assign({},xr,(jt={},jt[dt]=mt?"0":"",jt[gt]=Ee?"0":"",jt.transform=(ut.devicePixelRatio||1)<=1?"translate("+oe+"px, "+Me+"px)":"translate3d("+oe+"px, "+Me+"px, 0)",jt))}return Object.assign({},xr,(c={},c[dt]=mt?Me+"px":"",c[gt]=Ee?oe+"px":"",c.transform="",c))}function L5(i){var c=i.state,p=i.options,y=p.gpuAcceleration,T=y===void 0?!0:y,M=p.adaptive,C=M===void 0?!0:M,R=p.roundOffsets,o=R===void 0?!0:R,B={placement:ma(c.placement),variation:rd(c.placement),popper:c.elements.popper,popperRect:c.rects.popper,gpuAcceleration:T,isFixed:c.options.strategy==="fixed"};c.modifiersData.popperOffsets!=null&&(c.styles.popper=Object.assign({},c.styles.popper,fE(Object.assign({},B,{offsets:c.modifiersData.popperOffsets,position:c.options.strategy,adaptive:C,roundOffsets:o})))),c.modifiersData.arrow!=null&&(c.styles.arrow=Object.assign({},c.styles.arrow,fE(Object.assign({},B,{offsets:c.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:o})))),c.attributes.popper=Object.assign({},c.attributes.popper,{"data-popper-placement":c.placement})}const R5={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:L5,data:{}};var hg={passive:!0};function k5(i){var c=i.state,p=i.instance,y=i.options,T=y.scroll,M=T===void 0?!0:T,C=y.resize,R=C===void 0?!0:C,o=Ks(c.elements.popper),B=[].concat(c.scrollParents.reference,c.scrollParents.popper);return M&&B.forEach(function($){$.addEventListener("scroll",p.update,hg)}),R&&o.addEventListener("resize",p.update,hg),function(){M&&B.forEach(function($){$.removeEventListener("scroll",p.update,hg)}),R&&o.removeEventListener("resize",p.update,hg)}}const O5={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:k5,data:{}};var z5={left:"right",right:"left",bottom:"top",top:"bottom"};function Eg(i){return i.replace(/left|right|bottom|top/g,function(c){return z5[c]})}var F5={start:"end",end:"start"};function pE(i){return i.replace(/start|end/g,function(c){return F5[c]})}function h1(i){var c=Ks(i),p=c.pageXOffset,y=c.pageYOffset;return{scrollLeft:p,scrollTop:y}}function d1(i){return td(_c(i)).left+h1(i).scrollLeft}function B5(i,c){var p=Ks(i),y=_c(i),T=p.visualViewport,M=y.clientWidth,C=y.clientHeight,R=0,o=0;if(T){M=T.width,C=T.height;var B=IC();(B||!B&&c==="fixed")&&(R=T.offsetLeft,o=T.offsetTop)}return{width:M,height:C,x:R+d1(i),y:o}}function N5(i){var c,p=_c(i),y=h1(i),T=(c=i.ownerDocument)==null?void 0:c.body,M=Mu(p.scrollWidth,p.clientWidth,T?T.scrollWidth:0,T?T.clientWidth:0),C=Mu(p.scrollHeight,p.clientHeight,T?T.scrollHeight:0,T?T.clientHeight:0),R=-y.scrollLeft+d1(i),o=-y.scrollTop;return Qa(T||p).direction==="rtl"&&(R+=Mu(p.clientWidth,T?T.clientWidth:0)-M),{width:M,height:C,x:R,y:o}}function f1(i){var c=Qa(i),p=c.overflow,y=c.overflowX,T=c.overflowY;return/auto|scroll|overlay|hidden/.test(p+T+y)}function RC(i){return["html","body","#document"].indexOf(ga(i))>=0?i.ownerDocument.body:co(i)&&f1(i)?i:RC(Sy(i))}function Np(i,c){var p;c===void 0&&(c=[]);var y=RC(i),T=y===((p=i.ownerDocument)==null?void 0:p.body),M=Ks(y),C=T?[M].concat(M.visualViewport||[],f1(y)?y:[]):y,R=c.concat(C);return T?R:R.concat(Np(Sy(C)))}function vx(i){return Object.assign({},i,{left:i.x,top:i.y,right:i.x+i.width,bottom:i.y+i.height})}function V5(i,c){var p=td(i,!1,c==="fixed");return p.top=p.top+i.clientTop,p.left=p.left+i.clientLeft,p.bottom=p.top+i.clientHeight,p.right=p.left+i.clientWidth,p.width=i.clientWidth,p.height=i.clientHeight,p.x=p.left,p.y=p.top,p}function mE(i,c,p){return c===EC?vx(B5(i,p)):Eu(c)?V5(c,p):vx(N5(_c(i)))}function $5(i){var c=Np(Sy(i)),p=["absolute","fixed"].indexOf(Qa(i).position)>=0,y=p&&co(i)?um(i):i;return Eu(y)?c.filter(function(T){return Eu(T)&&CC(T,y)&&ga(T)!=="body"}):[]}function U5(i,c,p,y){var T=c==="clippingParents"?$5(i):[].concat(c),M=[].concat(T,[p]),C=M[0],R=M.reduce(function(o,B){var $=mE(i,B,y);return o.top=Mu($.top,o.top),o.right=Vg($.right,o.right),o.bottom=Vg($.bottom,o.bottom),o.left=Mu($.left,o.left),o},mE(i,C,y));return R.width=R.right-R.left,R.height=R.bottom-R.top,R.x=R.left,R.y=R.top,R}function kC(i){var c=i.reference,p=i.element,y=i.placement,T=y?ma(y):null,M=y?rd(y):null,C=c.x+c.width/2-p.width/2,R=c.y+c.height/2-p.height/2,o;switch(T){case Rs:o={x:C,y:c.y-p.height};break;case fo:o={x:C,y:c.y+c.height};break;case po:o={x:c.x+c.width,y:R};break;case ks:o={x:c.x-p.width,y:R};break;default:o={x:c.x,y:c.y}}var B=T?u1(T):null;if(B!=null){var $=B==="y"?"height":"width";switch(M){case Qh:o[B]=o[B]-(c[$]/2-p[$]/2);break;case Xp:o[B]=o[B]+(c[$]/2-p[$]/2);break}}return o}function Kp(i,c){c===void 0&&(c={});var p=c,y=p.placement,T=y===void 0?i.placement:y,M=p.strategy,C=M===void 0?i.strategy:M,R=p.boundary,o=R===void 0?l5:R,B=p.rootBoundary,$=B===void 0?EC:B,H=p.elementContext,ie=H===void 0?Tp:H,oe=p.altBoundary,_e=oe===void 0?!1:oe,Me=p.padding,Re=Me===void 0?0:Me,Ee=DC(typeof Re!="number"?Re:LC(Re,cm)),mt=ie===Tp?c5:Tp,gt=i.rects.popper,dt=i.elements[_e?mt:ie],ut=U5(Eu(dt)?dt:dt.contextElement||_c(i.elements.popper),o,$,C),ht=td(i.elements.reference),lt=kC({reference:ht,element:gt,strategy:"absolute",placement:T}),Qe=vx(Object.assign({},gt,lt)),Se=ie===Tp?Qe:ht,Xt={top:ut.top-Se.top+Ee.top,bottom:Se.bottom-ut.bottom+Ee.bottom,left:ut.left-Se.left+Ee.left,right:Se.right-ut.right+Ee.right},xr=i.modifiersData.offset;if(ie===Tp&&xr){var Ve=xr[T];Object.keys(Xt).forEach(function(jt){var Ur=[po,fo].indexOf(jt)>=0?1:-1,$e=[Rs,fo].indexOf(jt)>=0?"y":"x";Xt[jt]+=Ve[$e]*Ur})}return Xt}function j5(i,c){c===void 0&&(c={});var p=c,y=p.placement,T=p.boundary,M=p.rootBoundary,C=p.padding,R=p.flipVariations,o=p.allowedAutoPlacements,B=o===void 0?AC:o,$=rd(y),H=$?R?hE:hE.filter(function(_e){return rd(_e)===$}):cm,ie=H.filter(function(_e){return B.indexOf(_e)>=0});ie.length===0&&(ie=H);var oe=ie.reduce(function(_e,Me){return _e[Me]=Kp(i,{placement:Me,boundary:T,rootBoundary:M,padding:C})[ma(Me)],_e},{});return Object.keys(oe).sort(function(_e,Me){return oe[_e]-oe[Me]})}function G5(i){if(ma(i)===a1)return[];var c=Eg(i);return[pE(i),c,pE(c)]}function H5(i){var c=i.state,p=i.options,y=i.name;if(!c.modifiersData[y]._skip){for(var T=p.mainAxis,M=T===void 0?!0:T,C=p.altAxis,R=C===void 0?!0:C,o=p.fallbackPlacements,B=p.padding,$=p.boundary,H=p.rootBoundary,ie=p.altBoundary,oe=p.flipVariations,_e=oe===void 0?!0:oe,Me=p.allowedAutoPlacements,Re=c.options.placement,Ee=ma(Re),mt=Ee===Re,gt=o||(mt||!_e?[Eg(Re)]:G5(Re)),dt=[Re].concat(gt).reduce(function(dn,Bn){return dn.concat(ma(Bn)===a1?j5(c,{placement:Bn,boundary:$,rootBoundary:H,padding:B,flipVariations:_e,allowedAutoPlacements:Me}):Bn)},[]),ut=c.rects.reference,ht=c.rects.popper,lt=new Map,Qe=!0,Se=dt[0],Xt=0;Xt<dt.length;Xt++){var xr=dt[Xt],Ve=ma(xr),jt=rd(xr)===Qh,Ur=[Rs,fo].indexOf(Ve)>=0,$e=Ur?"width":"height",ur=Kp(c,{placement:xr,boundary:$,rootBoundary:H,altBoundary:ie,padding:B}),gr=Ur?jt?po:ks:jt?fo:Rs;ut[$e]>ht[$e]&&(gr=Eg(gr));var zt=Eg(gr),vn=[];if(M&&vn.push(ur[Ve]<=0),R&&vn.push(ur[gr]<=0,ur[zt]<=0),vn.every(function(dn){return dn})){Se=xr,Qe=!1;break}lt.set(xr,vn)}if(Qe)for(var Ft=_e?3:1,zr=function(Bn){var bn=dt.find(function(it){var Kt=lt.get(it);if(Kt)return Kt.slice(0,Bn).every(function(Gt){return Gt})});if(bn)return Se=bn,"break"},nr=Ft;nr>0;nr--){var En=zr(nr);if(En==="break")break}c.placement!==Se&&(c.modifiersData[y]._skip=!0,c.placement=Se,c.reset=!0)}}const q5={name:"flip",enabled:!0,phase:"main",fn:H5,requiresIfExists:["offset"],data:{_skip:!1}};function _E(i,c,p){return p===void 0&&(p={x:0,y:0}),{top:i.top-c.height-p.y,right:i.right-c.width+p.x,bottom:i.bottom-c.height+p.y,left:i.left-c.width-p.x}}function gE(i){return[Rs,po,fo,ks].some(function(c){return i[c]>=0})}function W5(i){var c=i.state,p=i.name,y=c.rects.reference,T=c.rects.popper,M=c.modifiersData.preventOverflow,C=Kp(c,{elementContext:"reference"}),R=Kp(c,{altBoundary:!0}),o=_E(C,y),B=_E(R,T,M),$=gE(o),H=gE(B);c.modifiersData[p]={referenceClippingOffsets:o,popperEscapeOffsets:B,isReferenceHidden:$,hasPopperEscaped:H},c.attributes.popper=Object.assign({},c.attributes.popper,{"data-popper-reference-hidden":$,"data-popper-escaped":H})}const Y5={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:W5};function Z5(i,c,p){var y=ma(i),T=[ks,Rs].indexOf(y)>=0?-1:1,M=typeof p=="function"?p(Object.assign({},c,{placement:i})):p,C=M[0],R=M[1];return C=C||0,R=(R||0)*T,[ks,po].indexOf(y)>=0?{x:R,y:C}:{x:C,y:R}}function X5(i){var c=i.state,p=i.options,y=i.name,T=p.offset,M=T===void 0?[0,0]:T,C=AC.reduce(function($,H){return $[H]=Z5(H,c.rects,M),$},{}),R=C[c.placement],o=R.x,B=R.y;c.modifiersData.popperOffsets!=null&&(c.modifiersData.popperOffsets.x+=o,c.modifiersData.popperOffsets.y+=B),c.modifiersData[y]=C}const K5={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:X5};function J5(i){var c=i.state,p=i.name;c.modifiersData[p]=kC({reference:c.rects.reference,element:c.rects.popper,strategy:"absolute",placement:c.placement})}const Q5={name:"popperOffsets",enabled:!0,phase:"read",fn:J5,data:{}};function e6(i){return i==="x"?"y":"x"}function t6(i){var c=i.state,p=i.options,y=i.name,T=p.mainAxis,M=T===void 0?!0:T,C=p.altAxis,R=C===void 0?!1:C,o=p.boundary,B=p.rootBoundary,$=p.altBoundary,H=p.padding,ie=p.tether,oe=ie===void 0?!0:ie,_e=p.tetherOffset,Me=_e===void 0?0:_e,Re=Kp(c,{boundary:o,rootBoundary:B,padding:H,altBoundary:$}),Ee=ma(c.placement),mt=rd(c.placement),gt=!mt,dt=u1(Ee),ut=e6(dt),ht=c.modifiersData.popperOffsets,lt=c.rects.reference,Qe=c.rects.popper,Se=typeof Me=="function"?Me(Object.assign({},c.rects,{placement:c.placement})):Me,Xt=typeof Se=="number"?{mainAxis:Se,altAxis:Se}:Object.assign({mainAxis:0,altAxis:0},Se),xr=c.modifiersData.offset?c.modifiersData.offset[c.placement]:null,Ve={x:0,y:0};if(ht){if(M){var jt,Ur=dt==="y"?Rs:ks,$e=dt==="y"?fo:po,ur=dt==="y"?"height":"width",gr=ht[dt],zt=gr+Re[Ur],vn=gr-Re[$e],Ft=oe?-Qe[ur]/2:0,zr=mt===Qh?lt[ur]:Qe[ur],nr=mt===Qh?-Qe[ur]:-lt[ur],En=c.elements.arrow,dn=oe&&En?c1(En):{width:0,height:0},Bn=c.modifiersData["arrow#persistent"]?c.modifiersData["arrow#persistent"].padding:PC(),bn=Bn[Ur],it=Bn[$e],Kt=Bp(0,lt[ur],dn[ur]),Gt=gt?lt[ur]/2-Ft-Kt-bn-Xt.mainAxis:zr-Kt-bn-Xt.mainAxis,ir=gt?-lt[ur]/2+Ft+Kt+it+Xt.mainAxis:nr+Kt+it+Xt.mainAxis,Vr=c.elements.arrow&&um(c.elements.arrow),Kr=Vr?dt==="y"?Vr.clientTop||0:Vr.clientLeft||0:0,pe=(jt=xr==null?void 0:xr[dt])!=null?jt:0,ye=gr+Gt-pe-Kr,qe=gr+ir-pe,ft=Bp(oe?Vg(zt,ye):zt,gr,oe?Mu(vn,qe):vn);ht[dt]=ft,Ve[dt]=ft-gr}if(R){var ct,Bt=dt==="x"?Rs:ks,tr=dt==="x"?fo:po,vt=ht[ut],Yt=ut==="y"?"height":"width",Pt=vt+Re[Bt],rr=vt-Re[tr],br=[Rs,ks].indexOf(Ee)!==-1,yr=(ct=xr==null?void 0:xr[ut])!=null?ct:0,Ie=br?Pt:vt-lt[Yt]-Qe[Yt]-yr+Xt.altAxis,Z=br?vt+lt[Yt]+Qe[Yt]-yr-Xt.altAxis:rr,te=oe&&br?M5(Ie,vt,Z):Bp(oe?Ie:Pt,vt,oe?Z:rr);ht[ut]=te,Ve[ut]=te-vt}c.modifiersData[y]=Ve}}const r6={name:"preventOverflow",enabled:!0,phase:"main",fn:t6,requiresIfExists:["offset"]};function n6(i){return{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}}function i6(i){return i===Ks(i)||!co(i)?h1(i):n6(i)}function s6(i){var c=i.getBoundingClientRect(),p=ed(c.width)/i.offsetWidth||1,y=ed(c.height)/i.offsetHeight||1;return p!==1||y!==1}function o6(i,c,p){p===void 0&&(p=!1);var y=co(c),T=co(c)&&s6(c),M=_c(c),C=td(i,T,p),R={scrollLeft:0,scrollTop:0},o={x:0,y:0};return(y||!y&&!p)&&((ga(c)!=="body"||f1(M))&&(R=i6(c)),co(c)?(o=td(c,!0),o.x+=c.clientLeft,o.y+=c.clientTop):M&&(o.x=d1(M))),{x:C.left+R.scrollLeft-o.x,y:C.top+R.scrollTop-o.y,width:C.width,height:C.height}}function a6(i){var c=new Map,p=new Set,y=[];i.forEach(function(M){c.set(M.name,M)});function T(M){p.add(M.name);var C=[].concat(M.requires||[],M.requiresIfExists||[]);C.forEach(function(R){if(!p.has(R)){var o=c.get(R);o&&T(o)}}),y.push(M)}return i.forEach(function(M){p.has(M.name)||T(M)}),y}function l6(i){var c=a6(i);return v5.reduce(function(p,y){return p.concat(c.filter(function(T){return T.phase===y}))},[])}function c6(i){var c;return function(){return c||(c=new Promise(function(p){Promise.resolve().then(function(){c=void 0,p(i())})})),c}}function u6(i){var c=i.reduce(function(p,y){var T=p[y.name];return p[y.name]=T?Object.assign({},T,y,{options:Object.assign({},T.options,y.options),data:Object.assign({},T.data,y.data)}):y,p},{});return Object.keys(c).map(function(p){return c[p]})}var yE={placement:"bottom",modifiers:[],strategy:"absolute"};function vE(){for(var i=arguments.length,c=new Array(i),p=0;p<i;p++)c[p]=arguments[p];return!c.some(function(y){return!(y&&typeof y.getBoundingClientRect=="function")})}function h6(i){i===void 0&&(i={});var c=i,p=c.defaultModifiers,y=p===void 0?[]:p,T=c.defaultOptions,M=T===void 0?yE:T;return function(R,o,B){B===void 0&&(B=M);var $={placement:"bottom",orderedModifiers:[],options:Object.assign({},yE,M),modifiersData:{},elements:{reference:R,popper:o},attributes:{},styles:{}},H=[],ie=!1,oe={state:$,setOptions:function(Ee){var mt=typeof Ee=="function"?Ee($.options):Ee;Me(),$.options=Object.assign({},M,$.options,mt),$.scrollParents={reference:Eu(R)?Np(R):R.contextElement?Np(R.contextElement):[],popper:Np(o)};var gt=l6(u6([].concat(y,$.options.modifiers)));return $.orderedModifiers=gt.filter(function(dt){return dt.enabled}),_e(),oe.update()},forceUpdate:function(){if(!ie){var Ee=$.elements,mt=Ee.reference,gt=Ee.popper;if(vE(mt,gt)){$.rects={reference:o6(mt,um(gt),$.options.strategy==="fixed"),popper:c1(gt)},$.reset=!1,$.placement=$.options.placement,$.orderedModifiers.forEach(function(Xt){return $.modifiersData[Xt.name]=Object.assign({},Xt.data)});for(var dt=0;dt<$.orderedModifiers.length;dt++){if($.reset===!0){$.reset=!1,dt=-1;continue}var ut=$.orderedModifiers[dt],ht=ut.fn,lt=ut.options,Qe=lt===void 0?{}:lt,Se=ut.name;typeof ht=="function"&&($=ht({state:$,options:Qe,name:Se,instance:oe})||$)}}}},update:c6(function(){return new Promise(function(Re){oe.forceUpdate(),Re($)})}),destroy:function(){Me(),ie=!0}};if(!vE(R,o))return oe;oe.setOptions(B).then(function(Re){!ie&&B.onFirstUpdate&&B.onFirstUpdate(Re)});function _e(){$.orderedModifiers.forEach(function(Re){var Ee=Re.name,mt=Re.options,gt=mt===void 0?{}:mt,dt=Re.effect;if(typeof dt=="function"){var ut=dt({state:$,name:Ee,instance:oe,options:gt}),ht=function(){};H.push(ut||ht)}})}function Me(){H.forEach(function(Re){return Re()}),H=[]}return oe}}var d6=[O5,Q5,R5,w5,K5,q5,r6,C5,Y5],f6=h6({defaultModifiers:d6}),p6=Object.defineProperty,m6=(i,c,p)=>c in i?p6(i,c,{enumerable:!0,configurable:!0,writable:!0,value:p}):i[c]=p,$r=(i,c,p)=>(m6(i,typeof c!="symbol"?c+"":c,p),p),dg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function OC(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var _6=Object.prototype,g6=_6.hasOwnProperty;function y6(i,c){return i!=null&&g6.call(i,c)}var v6=y6,x6=Array.isArray,zo=x6,b6=typeof dg=="object"&&dg&&dg.Object===Object&&dg,zC=b6,w6=zC,T6=typeof self=="object"&&self&&self.Object===Object&&self,S6=w6||T6||Function("return this")(),xa=S6,M6=xa,E6=M6.Symbol,My=E6,xE=My,FC=Object.prototype,A6=FC.hasOwnProperty,I6=FC.toString,Sp=xE?xE.toStringTag:void 0;function C6(i){var c=A6.call(i,Sp),p=i[Sp];try{i[Sp]=void 0;var y=!0}catch{}var T=I6.call(i);return y&&(c?i[Sp]=p:delete i[Sp]),T}var P6=C6,D6=Object.prototype,L6=D6.toString;function R6(i){return L6.call(i)}var k6=R6,bE=My,O6=P6,z6=k6,F6="[object Null]",B6="[object Undefined]",wE=bE?bE.toStringTag:void 0;function N6(i){return i==null?i===void 0?B6:F6:wE&&wE in Object(i)?O6(i):z6(i)}var ba=N6;function V6(i){return i!=null&&typeof i=="object"}var Fo=V6,$6=ba,U6=Fo,j6="[object Symbol]";function G6(i){return typeof i=="symbol"||U6(i)&&$6(i)==j6}var p1=G6,H6=zo,q6=p1,W6=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Y6=/^\w*$/;function Z6(i,c){if(H6(i))return!1;var p=typeof i;return p=="number"||p=="symbol"||p=="boolean"||i==null||q6(i)?!0:Y6.test(i)||!W6.test(i)||c!=null&&i in Object(c)}var m1=Z6;function X6(i){var c=typeof i;return i!=null&&(c=="object"||c=="function")}var nl=X6,K6=ba,J6=nl,Q6="[object AsyncFunction]",eV="[object Function]",tV="[object GeneratorFunction]",rV="[object Proxy]";function nV(i){if(!J6(i))return!1;var c=K6(i);return c==eV||c==tV||c==Q6||c==rV}var Du=nV,iV=xa,sV=iV["__core-js_shared__"],oV=sV,N0=oV,TE=function(){var i=/[^.]+$/.exec(N0&&N0.keys&&N0.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}();function aV(i){return!!TE&&TE in i}var lV=aV,cV=Function.prototype,uV=cV.toString;function hV(i){if(i!=null){try{return uV.call(i)}catch{}try{return i+""}catch{}}return""}var BC=hV,dV=Du,fV=lV,pV=nl,mV=BC,_V=/[\\^$.*+?()[\]{}|]/g,gV=/^\[object .+?Constructor\]$/,yV=Function.prototype,vV=Object.prototype,xV=yV.toString,bV=vV.hasOwnProperty,wV=RegExp("^"+xV.call(bV).replace(_V,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function TV(i){if(!pV(i)||fV(i))return!1;var c=dV(i)?wV:gV;return c.test(mV(i))}var SV=TV;function MV(i,c){return i==null?void 0:i[c]}var EV=MV,AV=SV,IV=EV;function CV(i,c){var p=IV(i,c);return AV(p)?p:void 0}var Lu=CV,PV=Lu,DV=PV(Object,"create"),Ey=DV,SE=Ey;function LV(){this.__data__=SE?SE(null):{},this.size=0}var RV=LV;function kV(i){var c=this.has(i)&&delete this.__data__[i];return this.size-=c?1:0,c}var OV=kV,zV=Ey,FV="__lodash_hash_undefined__",BV=Object.prototype,NV=BV.hasOwnProperty;function VV(i){var c=this.__data__;if(zV){var p=c[i];return p===FV?void 0:p}return NV.call(c,i)?c[i]:void 0}var $V=VV,UV=Ey,jV=Object.prototype,GV=jV.hasOwnProperty;function HV(i){var c=this.__data__;return UV?c[i]!==void 0:GV.call(c,i)}var qV=HV,WV=Ey,YV="__lodash_hash_undefined__";function ZV(i,c){var p=this.__data__;return this.size+=this.has(i)?0:1,p[i]=WV&&c===void 0?YV:c,this}var XV=ZV,KV=RV,JV=OV,QV=$V,e$=qV,t$=XV;function ld(i){var c=-1,p=i==null?0:i.length;for(this.clear();++c<p;){var y=i[c];this.set(y[0],y[1])}}ld.prototype.clear=KV;ld.prototype.delete=JV;ld.prototype.get=QV;ld.prototype.has=e$;ld.prototype.set=t$;var r$=ld;function n$(){this.__data__=[],this.size=0}var i$=n$;function s$(i,c){return i===c||i!==i&&c!==c}var cd=s$,o$=cd;function a$(i,c){for(var p=i.length;p--;)if(o$(i[p][0],c))return p;return-1}var Ay=a$,l$=Ay,c$=Array.prototype,u$=c$.splice;function h$(i){var c=this.__data__,p=l$(c,i);if(p<0)return!1;var y=c.length-1;return p==y?c.pop():u$.call(c,p,1),--this.size,!0}var d$=h$,f$=Ay;function p$(i){var c=this.__data__,p=f$(c,i);return p<0?void 0:c[p][1]}var m$=p$,_$=Ay;function g$(i){return _$(this.__data__,i)>-1}var y$=g$,v$=Ay;function x$(i,c){var p=this.__data__,y=v$(p,i);return y<0?(++this.size,p.push([i,c])):p[y][1]=c,this}var b$=x$,w$=i$,T$=d$,S$=m$,M$=y$,E$=b$;function ud(i){var c=-1,p=i==null?0:i.length;for(this.clear();++c<p;){var y=i[c];this.set(y[0],y[1])}}ud.prototype.clear=w$;ud.prototype.delete=T$;ud.prototype.get=S$;ud.prototype.has=M$;ud.prototype.set=E$;var Iy=ud,A$=Lu,I$=xa,C$=A$(I$,"Map"),_1=C$,ME=r$,P$=Iy,D$=_1;function L$(){this.size=0,this.__data__={hash:new ME,map:new(D$||P$),string:new ME}}var R$=L$;function k$(i){var c=typeof i;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?i!=="__proto__":i===null}var O$=k$,z$=O$;function F$(i,c){var p=i.__data__;return z$(c)?p[typeof c=="string"?"string":"hash"]:p.map}var Cy=F$,B$=Cy;function N$(i){var c=B$(this,i).delete(i);return this.size-=c?1:0,c}var V$=N$,$$=Cy;function U$(i){return $$(this,i).get(i)}var j$=U$,G$=Cy;function H$(i){return G$(this,i).has(i)}var q$=H$,W$=Cy;function Y$(i,c){var p=W$(this,i),y=p.size;return p.set(i,c),this.size+=p.size==y?0:1,this}var Z$=Y$,X$=R$,K$=V$,J$=j$,Q$=q$,eU=Z$;function hd(i){var c=-1,p=i==null?0:i.length;for(this.clear();++c<p;){var y=i[c];this.set(y[0],y[1])}}hd.prototype.clear=X$;hd.prototype.delete=K$;hd.prototype.get=J$;hd.prototype.has=Q$;hd.prototype.set=eU;var g1=hd,NC=g1,tU="Expected a function";function y1(i,c){if(typeof i!="function"||c!=null&&typeof c!="function")throw new TypeError(tU);var p=function(){var y=arguments,T=c?c.apply(this,y):y[0],M=p.cache;if(M.has(T))return M.get(T);var C=i.apply(this,y);return p.cache=M.set(T,C)||M,C};return p.cache=new(y1.Cache||NC),p}y1.Cache=NC;var rU=y1,nU=rU,iU=500;function sU(i){var c=nU(i,function(y){return p.size===iU&&p.clear(),y}),p=c.cache;return c}var oU=sU,aU=oU,lU=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,cU=/\\(\\)?/g,uU=aU(function(i){var c=[];return i.charCodeAt(0)===46&&c.push(""),i.replace(lU,function(p,y,T,M){c.push(T?M.replace(cU,"$1"):y||p)}),c}),hU=uU;function dU(i,c){for(var p=-1,y=i==null?0:i.length,T=Array(y);++p<y;)T[p]=c(i[p],p,i);return T}var fU=dU,EE=My,pU=fU,mU=zo,_U=p1,gU=1/0,AE=EE?EE.prototype:void 0,IE=AE?AE.toString:void 0;function VC(i){if(typeof i=="string")return i;if(mU(i))return pU(i,VC)+"";if(_U(i))return IE?IE.call(i):"";var c=i+"";return c=="0"&&1/i==-gU?"-0":c}var yU=VC,vU=yU;function xU(i){return i==null?"":vU(i)}var bU=xU,wU=zo,TU=m1,SU=hU,MU=bU;function EU(i,c){return wU(i)?i:TU(i,c)?[i]:SU(MU(i))}var $C=EU,AU=ba,IU=Fo,CU="[object Arguments]";function PU(i){return IU(i)&&AU(i)==CU}var DU=PU,CE=DU,LU=Fo,UC=Object.prototype,RU=UC.hasOwnProperty,kU=UC.propertyIsEnumerable,OU=CE(function(){return arguments}())?CE:function(i){return LU(i)&&RU.call(i,"callee")&&!kU.call(i,"callee")},v1=OU,zU=9007199254740991,FU=/^(?:0|[1-9]\d*)$/;function BU(i,c){var p=typeof i;return c=c??zU,!!c&&(p=="number"||p!="symbol"&&FU.test(i))&&i>-1&&i%1==0&&i<c}var x1=BU,NU=9007199254740991;function VU(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=NU}var b1=VU,$U=p1,UU=1/0;function jU(i){if(typeof i=="string"||$U(i))return i;var c=i+"";return c=="0"&&1/i==-UU?"-0":c}var Py=jU,GU=$C,HU=v1,qU=zo,WU=x1,YU=b1,ZU=Py;function XU(i,c,p){c=GU(c,i);for(var y=-1,T=c.length,M=!1;++y<T;){var C=ZU(c[y]);if(!(M=i!=null&&p(i,C)))break;i=i[C]}return M||++y!=T?M:(T=i==null?0:i.length,!!T&&YU(T)&&WU(C,T)&&(qU(i)||HU(i)))}var jC=XU,KU=v6,JU=jC;function QU(i,c){return i!=null&&JU(i,c,KU)}var GC=QU,ej=ba,tj=Fo,rj="[object Date]";function nj(i){return tj(i)&&ej(i)==rj}var ij=nj;function sj(i){return function(c){return i(c)}}var HC=sj,Jp={},oj={get exports(){return Jp},set exports(i){Jp=i}};(function(i,c){var p=zC,y=c&&!c.nodeType&&c,T=y&&!0&&i&&!i.nodeType&&i,M=T&&T.exports===y,C=M&&p.process,R=function(){try{var o=T&&T.require&&T.require("util").types;return o||C&&C.binding&&C.binding("util")}catch{}}();i.exports=R})(oj,Jp);var aj=ij,lj=HC,PE=Jp,DE=PE&&PE.isDate,cj=DE?lj(DE):aj,uj=cj,hj=ba,dj=zo,fj=Fo,pj="[object String]";function mj(i){return typeof i=="string"||!dj(i)&&fj(i)&&hj(i)==pj}var fa=mj;function _j(i,c){for(var p=-1,y=i==null?0:i.length;++p<y;)if(c(i[p],p,i))return!0;return!1}var qC=_j,gj=Iy;function yj(){this.__data__=new gj,this.size=0}var vj=yj;function xj(i){var c=this.__data__,p=c.delete(i);return this.size=c.size,p}var bj=xj;function wj(i){return this.__data__.get(i)}var Tj=wj;function Sj(i){return this.__data__.has(i)}var Mj=Sj,Ej=Iy,Aj=_1,Ij=g1,Cj=200;function Pj(i,c){var p=this.__data__;if(p instanceof Ej){var y=p.__data__;if(!Aj||y.length<Cj-1)return y.push([i,c]),this.size=++p.size,this;p=this.__data__=new Ij(y)}return p.set(i,c),this.size=p.size,this}var Dj=Pj,Lj=Iy,Rj=vj,kj=bj,Oj=Tj,zj=Mj,Fj=Dj;function dd(i){var c=this.__data__=new Lj(i);this.size=c.size}dd.prototype.clear=Rj;dd.prototype.delete=kj;dd.prototype.get=Oj;dd.prototype.has=zj;dd.prototype.set=Fj;var w1=dd,Bj="__lodash_hash_undefined__";function Nj(i){return this.__data__.set(i,Bj),this}var Vj=Nj;function $j(i){return this.__data__.has(i)}var Uj=$j,jj=g1,Gj=Vj,Hj=Uj;function $g(i){var c=-1,p=i==null?0:i.length;for(this.__data__=new jj;++c<p;)this.add(i[c])}$g.prototype.add=$g.prototype.push=Gj;$g.prototype.has=Hj;var qj=$g;function Wj(i,c){return i.has(c)}var Yj=Wj,Zj=qj,Xj=qC,Kj=Yj,Jj=1,Qj=2;function e8(i,c,p,y,T,M){var C=p&Jj,R=i.length,o=c.length;if(R!=o&&!(C&&o>R))return!1;var B=M.get(i),$=M.get(c);if(B&&$)return B==c&&$==i;var H=-1,ie=!0,oe=p&Qj?new Zj:void 0;for(M.set(i,c),M.set(c,i);++H<R;){var _e=i[H],Me=c[H];if(y)var Re=C?y(Me,_e,H,c,i,M):y(_e,Me,H,i,c,M);if(Re!==void 0){if(Re)continue;ie=!1;break}if(oe){if(!Xj(c,function(Ee,mt){if(!Kj(oe,mt)&&(_e===Ee||T(_e,Ee,p,y,M)))return oe.push(mt)})){ie=!1;break}}else if(!(_e===Me||T(_e,Me,p,y,M))){ie=!1;break}}return M.delete(i),M.delete(c),ie}var WC=e8,t8=xa,r8=t8.Uint8Array,YC=r8;function n8(i){var c=-1,p=Array(i.size);return i.forEach(function(y,T){p[++c]=[T,y]}),p}var i8=n8;function s8(i){var c=-1,p=Array(i.size);return i.forEach(function(y){p[++c]=y}),p}var o8=s8,LE=My,RE=YC,a8=cd,l8=WC,c8=i8,u8=o8,h8=1,d8=2,f8="[object Boolean]",p8="[object Date]",m8="[object Error]",_8="[object Map]",g8="[object Number]",y8="[object RegExp]",v8="[object Set]",x8="[object String]",b8="[object Symbol]",w8="[object ArrayBuffer]",T8="[object DataView]",kE=LE?LE.prototype:void 0,V0=kE?kE.valueOf:void 0;function S8(i,c,p,y,T,M,C){switch(p){case T8:if(i.byteLength!=c.byteLength||i.byteOffset!=c.byteOffset)return!1;i=i.buffer,c=c.buffer;case w8:return!(i.byteLength!=c.byteLength||!M(new RE(i),new RE(c)));case f8:case p8:case g8:return a8(+i,+c);case m8:return i.name==c.name&&i.message==c.message;case y8:case x8:return i==c+"";case _8:var R=c8;case v8:var o=y&h8;if(R||(R=u8),i.size!=c.size&&!o)return!1;var B=C.get(i);if(B)return B==c;y|=d8,C.set(i,c);var $=l8(R(i),R(c),y,T,M,C);return C.delete(i),$;case b8:if(V0)return V0.call(i)==V0.call(c)}return!1}var M8=S8;function E8(i,c){for(var p=-1,y=c.length,T=i.length;++p<y;)i[T+p]=c[p];return i}var A8=E8,I8=A8,C8=zo;function P8(i,c,p){var y=c(i);return C8(i)?y:I8(y,p(i))}var D8=P8;function L8(i,c){for(var p=-1,y=i==null?0:i.length,T=0,M=[];++p<y;){var C=i[p];c(C,p,i)&&(M[T++]=C)}return M}var R8=L8;function k8(){return[]}var O8=k8,z8=R8,F8=O8,B8=Object.prototype,N8=B8.propertyIsEnumerable,OE=Object.getOwnPropertySymbols,V8=OE?function(i){return i==null?[]:(i=Object(i),z8(OE(i),function(c){return N8.call(i,c)}))}:F8,$8=V8;function U8(i,c){for(var p=-1,y=Array(i);++p<i;)y[p]=c(p);return y}var j8=U8,nd={},G8={get exports(){return nd},set exports(i){nd=i}};function H8(){return!1}var q8=H8;(function(i,c){var p=xa,y=q8,T=c&&!c.nodeType&&c,M=T&&!0&&i&&!i.nodeType&&i,C=M&&M.exports===T,R=C?p.Buffer:void 0,o=R?R.isBuffer:void 0,B=o||y;i.exports=B})(G8,nd);var W8=ba,Y8=b1,Z8=Fo,X8="[object Arguments]",K8="[object Array]",J8="[object Boolean]",Q8="[object Date]",eG="[object Error]",tG="[object Function]",rG="[object Map]",nG="[object Number]",iG="[object Object]",sG="[object RegExp]",oG="[object Set]",aG="[object String]",lG="[object WeakMap]",cG="[object ArrayBuffer]",uG="[object DataView]",hG="[object Float32Array]",dG="[object Float64Array]",fG="[object Int8Array]",pG="[object Int16Array]",mG="[object Int32Array]",_G="[object Uint8Array]",gG="[object Uint8ClampedArray]",yG="[object Uint16Array]",vG="[object Uint32Array]",fi={};fi[hG]=fi[dG]=fi[fG]=fi[pG]=fi[mG]=fi[_G]=fi[gG]=fi[yG]=fi[vG]=!0;fi[X8]=fi[K8]=fi[cG]=fi[J8]=fi[uG]=fi[Q8]=fi[eG]=fi[tG]=fi[rG]=fi[nG]=fi[iG]=fi[sG]=fi[oG]=fi[aG]=fi[lG]=!1;function xG(i){return Z8(i)&&Y8(i.length)&&!!fi[W8(i)]}var bG=xG,wG=bG,TG=HC,zE=Jp,FE=zE&&zE.isTypedArray,SG=FE?TG(FE):wG,T1=SG,MG=j8,EG=v1,AG=zo,IG=nd,CG=x1,PG=T1,DG=Object.prototype,LG=DG.hasOwnProperty;function RG(i,c){var p=AG(i),y=!p&&EG(i),T=!p&&!y&&IG(i),M=!p&&!y&&!T&&PG(i),C=p||y||T||M,R=C?MG(i.length,String):[],o=R.length;for(var B in i)(c||LG.call(i,B))&&!(C&&(B=="length"||T&&(B=="offset"||B=="parent")||M&&(B=="buffer"||B=="byteLength"||B=="byteOffset")||CG(B,o)))&&R.push(B);return R}var ZC=RG,kG=Object.prototype;function OG(i){var c=i&&i.constructor,p=typeof c=="function"&&c.prototype||kG;return i===p}var S1=OG;function zG(i,c){return function(p){return i(c(p))}}var XC=zG,FG=XC,BG=FG(Object.keys,Object),NG=BG,VG=S1,$G=NG,UG=Object.prototype,jG=UG.hasOwnProperty;function GG(i){if(!VG(i))return $G(i);var c=[];for(var p in Object(i))jG.call(i,p)&&p!="constructor"&&c.push(p);return c}var HG=GG,qG=Du,WG=b1;function YG(i){return i!=null&&WG(i.length)&&!qG(i)}var hm=YG,ZG=ZC,XG=HG,KG=hm;function JG(i){return KG(i)?ZG(i):XG(i)}var M1=JG,QG=D8,eH=$8,tH=M1;function rH(i){return QG(i,tH,eH)}var nH=rH,BE=nH,iH=1,sH=Object.prototype,oH=sH.hasOwnProperty;function aH(i,c,p,y,T,M){var C=p&iH,R=BE(i),o=R.length,B=BE(c),$=B.length;if(o!=$&&!C)return!1;for(var H=o;H--;){var ie=R[H];if(!(C?ie in c:oH.call(c,ie)))return!1}var oe=M.get(i),_e=M.get(c);if(oe&&_e)return oe==c&&_e==i;var Me=!0;M.set(i,c),M.set(c,i);for(var Re=C;++H<o;){ie=R[H];var Ee=i[ie],mt=c[ie];if(y)var gt=C?y(mt,Ee,ie,c,i,M):y(Ee,mt,ie,i,c,M);if(!(gt===void 0?Ee===mt||T(Ee,mt,p,y,M):gt)){Me=!1;break}Re||(Re=ie=="constructor")}if(Me&&!Re){var dt=i.constructor,ut=c.constructor;dt!=ut&&"constructor"in i&&"constructor"in c&&!(typeof dt=="function"&&dt instanceof dt&&typeof ut=="function"&&ut instanceof ut)&&(Me=!1)}return M.delete(i),M.delete(c),Me}var lH=aH,cH=Lu,uH=xa,hH=cH(uH,"DataView"),dH=hH,fH=Lu,pH=xa,mH=fH(pH,"Promise"),_H=mH,gH=Lu,yH=xa,vH=gH(yH,"Set"),xH=vH,bH=Lu,wH=xa,TH=bH(wH,"WeakMap"),SH=TH,xx=dH,bx=_1,wx=_H,Tx=xH,Sx=SH,KC=ba,fd=BC,NE="[object Map]",MH="[object Object]",VE="[object Promise]",$E="[object Set]",UE="[object WeakMap]",jE="[object DataView]",EH=fd(xx),AH=fd(bx),IH=fd(wx),CH=fd(Tx),PH=fd(Sx),yu=KC;(xx&&yu(new xx(new ArrayBuffer(1)))!=jE||bx&&yu(new bx)!=NE||wx&&yu(wx.resolve())!=VE||Tx&&yu(new Tx)!=$E||Sx&&yu(new Sx)!=UE)&&(yu=function(i){var c=KC(i),p=c==MH?i.constructor:void 0,y=p?fd(p):"";if(y)switch(y){case EH:return jE;case AH:return NE;case IH:return VE;case CH:return $E;case PH:return UE}return c});var DH=yu,$0=w1,LH=WC,RH=M8,kH=lH,GE=DH,HE=zo,qE=nd,OH=T1,zH=1,WE="[object Arguments]",YE="[object Array]",fg="[object Object]",FH=Object.prototype,ZE=FH.hasOwnProperty;function BH(i,c,p,y,T,M){var C=HE(i),R=HE(c),o=C?YE:GE(i),B=R?YE:GE(c);o=o==WE?fg:o,B=B==WE?fg:B;var $=o==fg,H=B==fg,ie=o==B;if(ie&&qE(i)){if(!qE(c))return!1;C=!0,$=!1}if(ie&&!$)return M||(M=new $0),C||OH(i)?LH(i,c,p,y,T,M):RH(i,c,o,p,y,T,M);if(!(p&zH)){var oe=$&&ZE.call(i,"__wrapped__"),_e=H&&ZE.call(c,"__wrapped__");if(oe||_e){var Me=oe?i.value():i,Re=_e?c.value():c;return M||(M=new $0),T(Me,Re,p,y,M)}}return ie?(M||(M=new $0),kH(i,c,p,y,T,M)):!1}var NH=BH,VH=NH,XE=Fo;function JC(i,c,p,y,T){return i===c?!0:i==null||c==null||!XE(i)&&!XE(c)?i!==i&&c!==c:VH(i,c,p,y,JC,T)}var QC=JC,$H=w1,UH=QC,jH=1,GH=2;function HH(i,c,p,y){var T=p.length,M=T,C=!y;if(i==null)return!M;for(i=Object(i);T--;){var R=p[T];if(C&&R[2]?R[1]!==i[R[0]]:!(R[0]in i))return!1}for(;++T<M;){R=p[T];var o=R[0],B=i[o],$=R[1];if(C&&R[2]){if(B===void 0&&!(o in i))return!1}else{var H=new $H;if(y)var ie=y(B,$,o,i,c,H);if(!(ie===void 0?UH($,B,jH|GH,y,H):ie))return!1}}return!0}var qH=HH,WH=nl;function YH(i){return i===i&&!WH(i)}var eP=YH,ZH=eP,XH=M1;function KH(i){for(var c=XH(i),p=c.length;p--;){var y=c[p],T=i[y];c[p]=[y,T,ZH(T)]}return c}var JH=KH;function QH(i,c){return function(p){return p==null?!1:p[i]===c&&(c!==void 0||i in Object(p))}}var tP=QH,eq=qH,tq=JH,rq=tP;function nq(i){var c=tq(i);return c.length==1&&c[0][2]?rq(c[0][0],c[0][1]):function(p){return p===i||eq(p,i,c)}}var iq=nq,sq=$C,oq=Py;function aq(i,c){c=sq(c,i);for(var p=0,y=c.length;i!=null&&p<y;)i=i[oq(c[p++])];return p&&p==y?i:void 0}var rP=aq,lq=rP;function cq(i,c,p){var y=i==null?void 0:lq(i,c);return y===void 0?p:y}var wu=cq;function uq(i,c){return i!=null&&c in Object(i)}var hq=uq,dq=hq,fq=jC;function pq(i,c){return i!=null&&fq(i,c,dq)}var mq=pq,_q=QC,gq=wu,yq=mq,vq=m1,xq=eP,bq=tP,wq=Py,Tq=1,Sq=2;function Mq(i,c){return vq(i)&&xq(c)?bq(wq(i),c):function(p){var y=gq(p,i);return y===void 0&&y===c?yq(p,i):_q(c,y,Tq|Sq)}}var Eq=Mq;function Aq(i){return i}var E1=Aq;function Iq(i){return function(c){return c==null?void 0:c[i]}}var Cq=Iq,Pq=rP;function Dq(i){return function(c){return Pq(c,i)}}var Lq=Dq,Rq=Cq,kq=Lq,Oq=m1,zq=Py;function Fq(i){return Oq(i)?Rq(zq(i)):kq(i)}var Bq=Fq,Nq=iq,Vq=Eq,$q=E1,Uq=zo,jq=Bq;function Gq(i){return typeof i=="function"?i:i==null?$q:typeof i=="object"?Uq(i)?Vq(i[0],i[1]):Nq(i):jq(i)}var nP=Gq;function Hq(i){return function(c,p,y){for(var T=-1,M=Object(c),C=y(c),R=C.length;R--;){var o=C[i?R:++T];if(p(M[o],o,M)===!1)break}return c}}var qq=Hq,Wq=qq,Yq=Wq(),iP=Yq,Zq=iP,Xq=M1;function Kq(i,c){return i&&Zq(i,c,Xq)}var sP=Kq,Jq=hm;function Qq(i,c){return function(p,y){if(p==null)return p;if(!Jq(p))return i(p,y);for(var T=p.length,M=c?T:-1,C=Object(p);(c?M--:++M<T)&&y(C[M],M,C)!==!1;);return p}}var eW=Qq,tW=sP,rW=eW,nW=rW(tW),iW=nW,sW=iW;function oW(i,c){var p;return sW(i,function(y,T,M){return p=c(y,T,M),!p}),!!p}var aW=oW,lW=cd,cW=hm,uW=x1,hW=nl;function dW(i,c,p){if(!hW(p))return!1;var y=typeof c;return(y=="number"?cW(p)&&uW(c,p.length):y=="string"&&c in p)?lW(p[c],i):!1}var A1=dW,fW=qC,pW=nP,mW=aW,_W=zo,gW=A1;function yW(i,c,p){var y=_W(i)?fW:mW;return p&&gW(i,c,p)&&(c=void 0),y(i,pW(c))}var vW=yW,xW=ba,bW=Fo,wW="[object Boolean]";function TW(i){return i===!0||i===!1||bW(i)&&xW(i)==wW}var SW=TW,MW=ba,EW=Fo,AW="[object Number]";function IW(i){return typeof i=="number"||EW(i)&&MW(i)==AW}var Oo=IW,CW=Lu,PW=function(){try{var i=CW(Object,"defineProperty");return i({},"",{}),i}catch{}}(),oP=PW,KE=oP;function DW(i,c,p){c=="__proto__"&&KE?KE(i,c,{configurable:!0,enumerable:!0,value:p,writable:!0}):i[c]=p}var Dy=DW,LW=Dy,RW=cd,kW=Object.prototype,OW=kW.hasOwnProperty;function zW(i,c,p){var y=i[c];(!(OW.call(i,c)&&RW(y,p))||p===void 0&&!(c in i))&&LW(i,c,p)}var FW=zW,BW=Dy,NW=sP,VW=nP;function $W(i,c){var p={};return c=VW(c),NW(i,function(y,T,M){BW(p,T,c(y,T,M))}),p}var UW=$W;function jW(i,c,p){switch(p.length){case 0:return i.call(c);case 1:return i.call(c,p[0]);case 2:return i.call(c,p[0],p[1]);case 3:return i.call(c,p[0],p[1],p[2])}return i.apply(c,p)}var aP=jW,GW=aP,JE=Math.max;function HW(i,c,p){return c=JE(c===void 0?i.length-1:c,0),function(){for(var y=arguments,T=-1,M=JE(y.length-c,0),C=Array(M);++T<M;)C[T]=y[c+T];T=-1;for(var R=Array(c+1);++T<c;)R[T]=y[T];return R[c]=p(C),GW(i,this,R)}}var qW=HW;function WW(i){return function(){return i}}var YW=WW,ZW=YW,QE=oP,XW=E1,KW=QE?function(i,c){return QE(i,"toString",{configurable:!0,enumerable:!1,value:ZW(c),writable:!0})}:XW,JW=KW,QW=800,eY=16,tY=Date.now;function rY(i){var c=0,p=0;return function(){var y=tY(),T=eY-(y-p);if(p=y,T>0){if(++c>=QW)return arguments[0]}else c=0;return i.apply(void 0,arguments)}}var nY=rY,iY=JW,sY=nY,oY=sY(iY),aY=oY,lY=E1,cY=qW,uY=aY;function hY(i,c){return uY(cY(i,c,lY),i+"")}var I1=hY;function dY(i){var c=[];if(i!=null)for(var p in Object(i))c.push(p);return c}var fY=dY,pY=nl,mY=S1,_Y=fY,gY=Object.prototype,yY=gY.hasOwnProperty;function vY(i){if(!pY(i))return _Y(i);var c=mY(i),p=[];for(var y in i)y=="constructor"&&(c||!yY.call(i,y))||p.push(y);return p}var xY=vY,bY=ZC,wY=xY,TY=hm;function SY(i){return TY(i)?bY(i,!0):wY(i)}var C1=SY,MY=I1,EY=cd,AY=A1,IY=C1,lP=Object.prototype,CY=lP.hasOwnProperty,PY=MY(function(i,c){i=Object(i);var p=-1,y=c.length,T=y>2?c[2]:void 0;for(T&&AY(c[0],c[1],T)&&(y=1);++p<y;)for(var M=c[p],C=IY(M),R=-1,o=C.length;++R<o;){var B=C[R],$=i[B];($===void 0||EY($,lP[B])&&!CY.call(i,B))&&(i[B]=M[B])}return i}),eA=PY,DY=Dy,LY=cd;function RY(i,c,p){(p!==void 0&&!LY(i[c],p)||p===void 0&&!(c in i))&&DY(i,c,p)}var cP=RY,Ug={},kY={get exports(){return Ug},set exports(i){Ug=i}};(function(i,c){var p=xa,y=c&&!c.nodeType&&c,T=y&&!0&&i&&!i.nodeType&&i,M=T&&T.exports===y,C=M?p.Buffer:void 0,R=C?C.allocUnsafe:void 0;function o(B,$){if($)return B.slice();var H=B.length,ie=R?R(H):new B.constructor(H);return B.copy(ie),ie}i.exports=o})(kY,Ug);var tA=YC;function OY(i){var c=new i.constructor(i.byteLength);return new tA(c).set(new tA(i)),c}var zY=OY,FY=zY;function BY(i,c){var p=c?FY(i.buffer):i.buffer;return new i.constructor(p,i.byteOffset,i.length)}var NY=BY;function VY(i,c){var p=-1,y=i.length;for(c||(c=Array(y));++p<y;)c[p]=i[p];return c}var $Y=VY,UY=nl,rA=Object.create,jY=function(){function i(){}return function(c){if(!UY(c))return{};if(rA)return rA(c);i.prototype=c;var p=new i;return i.prototype=void 0,p}}(),GY=jY,HY=XC,qY=HY(Object.getPrototypeOf,Object),uP=qY,WY=GY,YY=uP,ZY=S1;function XY(i){return typeof i.constructor=="function"&&!ZY(i)?WY(YY(i)):{}}var KY=XY,JY=hm,QY=Fo;function eZ(i){return QY(i)&&JY(i)}var tZ=eZ,rZ=ba,nZ=uP,iZ=Fo,sZ="[object Object]",oZ=Function.prototype,aZ=Object.prototype,hP=oZ.toString,lZ=aZ.hasOwnProperty,cZ=hP.call(Object);function uZ(i){if(!iZ(i)||rZ(i)!=sZ)return!1;var c=nZ(i);if(c===null)return!0;var p=lZ.call(c,"constructor")&&c.constructor;return typeof p=="function"&&p instanceof p&&hP.call(p)==cZ}var hZ=uZ;function dZ(i,c){if(!(c==="constructor"&&typeof i[c]=="function")&&c!="__proto__")return i[c]}var dP=dZ,fZ=FW,pZ=Dy;function mZ(i,c,p,y){var T=!p;p||(p={});for(var M=-1,C=c.length;++M<C;){var R=c[M],o=y?y(p[R],i[R],R,p,i):void 0;o===void 0&&(o=i[R]),T?pZ(p,R,o):fZ(p,R,o)}return p}var _Z=mZ,gZ=_Z,yZ=C1;function vZ(i){return gZ(i,yZ(i))}var xZ=vZ,nA=cP,bZ=Ug,wZ=NY,TZ=$Y,SZ=KY,iA=v1,sA=zo,MZ=tZ,EZ=nd,AZ=Du,IZ=nl,CZ=hZ,PZ=T1,oA=dP,DZ=xZ;function LZ(i,c,p,y,T,M,C){var R=oA(i,p),o=oA(c,p),B=C.get(o);if(B){nA(i,p,B);return}var $=M?M(R,o,p+"",i,c,C):void 0,H=$===void 0;if(H){var ie=sA(o),oe=!ie&&EZ(o),_e=!ie&&!oe&&PZ(o);$=o,ie||oe||_e?sA(R)?$=R:MZ(R)?$=TZ(R):oe?(H=!1,$=bZ(o,!0)):_e?(H=!1,$=wZ(o,!0)):$=[]:CZ(o)||iA(o)?($=R,iA(R)?$=DZ(R):(!IZ(R)||AZ(R))&&($=SZ(o))):H=!1}H&&(C.set(o,$),T($,o,y,M,C),C.delete(o)),nA(i,p,$)}var RZ=LZ,kZ=w1,OZ=cP,zZ=iP,FZ=RZ,BZ=nl,NZ=C1,VZ=dP;function fP(i,c,p,y,T){i!==c&&zZ(c,function(M,C){if(T||(T=new kZ),BZ(M))FZ(i,c,C,p,fP,y,T);else{var R=y?y(VZ(i,C),M,C+"",i,c,T):void 0;R===void 0&&(R=M),OZ(i,C,R)}},NZ)}var pP=fP,$Z=pP,aA=nl;function mP(i,c,p,y,T,M){return aA(i)&&aA(c)&&(M.set(c,i),$Z(i,c,void 0,mP,M),M.delete(c)),i}var UZ=mP,jZ=I1,GZ=A1;function HZ(i){return jZ(function(c,p){var y=-1,T=p.length,M=T>1?p[T-1]:void 0,C=T>2?p[2]:void 0;for(M=i.length>3&&typeof M=="function"?(T--,M):void 0,C&&GZ(p[0],p[1],C)&&(M=T<3?void 0:M,T=1),c=Object(c);++y<T;){var R=p[y];R&&i(c,R,y,M)}return c})}var qZ=HZ,WZ=pP,YZ=qZ,ZZ=YZ(function(i,c,p,y){WZ(i,c,p,y)}),XZ=ZZ,KZ=aP,JZ=I1,QZ=UZ,e7=XZ,t7=JZ(function(i){return i.push(void 0,QZ),KZ(e7,void 0,i)}),Qp=t7;function r7(i){return i&&i.length?i[0]:void 0}var _P=r7;function n7(i){var c=i==null?0:i.length;return c?i[c-1]:void 0}var Vh=n7;const i7=i=>Object.prototype.toString.call(i).slice(8,-1),qh=i=>uj(i)&&!isNaN(i.getTime()),el=i=>i7(i)==="Object",gP=GC,lA=(i,c)=>vW(c,p=>GC(i,p)),si=(i,c,p="0")=>{for(i=i!=null?String(i):"",c=c||2;i.length<c;)i=`${p}${i}`;return i},uo=i=>Array.isArray(i),Wa=i=>uo(i)&&i.length>0,jg=i=>i==null?null:document&&fa(i)?document.querySelector(i):i.$el??i,nc=(i,c,p,y=void 0)=>{i.removeEventListener(c,p,y)},ic=(i,c,p,y=void 0)=>(i.addEventListener(c,p,y),()=>nc(i,c,p,y)),Ag=(i,c)=>!!i&&!!c&&(i===c||i.contains(c)),pg=(i,c)=>{(i.key===" "||i.key==="Enter")&&(c(i),i.preventDefault())},yP=(i,...c)=>{const p={};let y;for(y in i)c.includes(y)||(p[y]=i[y]);return p},vP=(i,c)=>{const p={};return c.forEach(y=>{y in i&&(p[y]=i[y])}),p};function s7(i,c,p){return Math.min(Math.max(i,c),p)}var Gg={},o7={get exports(){return Gg},set exports(i){Gg=i}};(function(i,c){Object.defineProperty(c,"__esModule",{value:!0}),c.default=p;function p(y){if(y===null||y===!0||y===!1)return NaN;var T=Number(y);return isNaN(T)?T:T<0?Math.ceil(T):Math.floor(T)}i.exports=c.default})(o7,Gg);const a7=OC(Gg);var Hg={},l7={get exports(){return Hg},set exports(i){Hg=i}};(function(i,c){Object.defineProperty(c,"__esModule",{value:!0}),c.default=p;function p(y){var T=new Date(Date.UTC(y.getFullYear(),y.getMonth(),y.getDate(),y.getHours(),y.getMinutes(),y.getSeconds(),y.getMilliseconds()));return T.setUTCFullYear(y.getFullYear()),y.getTime()-T.getTime()}i.exports=c.default})(l7,Hg);const cA=OC(Hg);function c7(i,c){var p=f7(c);return p.formatToParts?h7(p,i):d7(p,i)}var u7={year:0,month:1,day:2,hour:3,minute:4,second:5};function h7(i,c){try{for(var p=i.formatToParts(c),y=[],T=0;T<p.length;T++){var M=u7[p[T].type];M>=0&&(y[M]=parseInt(p[T].value,10))}return y}catch(C){if(C instanceof RangeError)return[NaN];throw C}}function d7(i,c){var p=i.format(c).replace(/\u200E/g,""),y=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(p);return[y[3],y[1],y[2],y[4],y[5],y[6]]}var U0={};function f7(i){if(!U0[i]){var c=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),p=c==="06/25/2014, 00:00:00"||c==="06/25/2014 00:00:00";U0[i]=p?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:i,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:i,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return U0[i]}function xP(i,c,p,y,T,M,C){var R=new Date(0);return R.setUTCFullYear(i,c,p),R.setUTCHours(y,T,M,C),R}var uA=36e5,p7=6e4,j0={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function m7(i,c,p){var y,T;if(!i||(y=j0.timezoneZ.exec(i),y))return 0;var M;if(y=j0.timezoneHH.exec(i),y)return M=parseInt(y[1],10),hA(M)?-(M*uA):NaN;if(y=j0.timezoneHHMM.exec(i),y){M=parseInt(y[1],10);var C=parseInt(y[2],10);return hA(M,C)?(T=Math.abs(M)*uA+C*p7,M>0?-T:T):NaN}if(y7(i)){c=new Date(c||Date.now());var R=p?c:_7(c),o=Mx(R,i),B=p?o:g7(c,o,i);return-B}return NaN}function _7(i){return xP(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())}function Mx(i,c){var p=c7(i,c),y=xP(p[0],p[1]-1,p[2],p[3]%24,p[4],p[5],0).getTime(),T=i.getTime(),M=T%1e3;return T-=M>=0?M:1e3+M,y-T}function g7(i,c,p){var y=i.getTime(),T=y-c,M=Mx(new Date(T),p);if(c===M)return c;T-=M-c;var C=Mx(new Date(T),p);return M===C?M:Math.max(M,C)}function hA(i,c){return-23<=i&&i<=23&&(c==null||0<=c&&c<=59)}var dA={};function y7(i){if(dA[i])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:i}),dA[i]=!0,!0}catch{return!1}}var v7=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/;const x7=v7;var G0=36e5,fA=6e4,b7=2,Ts={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:x7};function w7(i,c){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(i===null)return new Date(NaN);var p=c||{},y=p.additionalDigits==null?b7:a7(p.additionalDigits);if(y!==2&&y!==1&&y!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(i instanceof Date||typeof i=="object"&&Object.prototype.toString.call(i)==="[object Date]")return new Date(i.getTime());if(typeof i=="number"||Object.prototype.toString.call(i)==="[object Number]")return new Date(i);if(!(typeof i=="string"||Object.prototype.toString.call(i)==="[object String]"))return new Date(NaN);var T=T7(i),M=S7(T.date,y),C=M.year,R=M.restDateString,o=M7(R,C);if(isNaN(o))return new Date(NaN);if(o){var B=o.getTime(),$=0,H;if(T.time&&($=E7(T.time),isNaN($)))return new Date(NaN);if(T.timeZone||p.timeZone){if(H=m7(T.timeZone||p.timeZone,new Date(B+$)),isNaN(H))return new Date(NaN)}else H=cA(new Date(B+$)),H=cA(new Date(B+$+H));return new Date(B+$+H)}else return new Date(NaN)}function T7(i){var c={},p=Ts.dateTimePattern.exec(i),y;if(p?(c.date=p[1],y=p[3]):(p=Ts.datePattern.exec(i),p?(c.date=p[1],y=p[2]):(c.date=null,y=i)),y){var T=Ts.timeZone.exec(y);T?(c.time=y.replace(T[1],""),c.timeZone=T[1].trim()):c.time=y}return c}function S7(i,c){var p=Ts.YYY[c],y=Ts.YYYYY[c],T;if(T=Ts.YYYY.exec(i)||y.exec(i),T){var M=T[1];return{year:parseInt(M,10),restDateString:i.slice(M.length)}}if(T=Ts.YY.exec(i)||p.exec(i),T){var C=T[1];return{year:parseInt(C,10)*100,restDateString:i.slice(C.length)}}return{year:null}}function M7(i,c){if(c===null)return null;var p,y,T,M;if(i.length===0)return y=new Date(0),y.setUTCFullYear(c),y;if(p=Ts.MM.exec(i),p)return y=new Date(0),T=parseInt(p[1],10)-1,mA(c,T)?(y.setUTCFullYear(c,T),y):new Date(NaN);if(p=Ts.DDD.exec(i),p){y=new Date(0);var C=parseInt(p[1],10);return C7(c,C)?(y.setUTCFullYear(c,0,C),y):new Date(NaN)}if(p=Ts.MMDD.exec(i),p){y=new Date(0),T=parseInt(p[1],10)-1;var R=parseInt(p[2],10);return mA(c,T,R)?(y.setUTCFullYear(c,T,R),y):new Date(NaN)}if(p=Ts.Www.exec(i),p)return M=parseInt(p[1],10)-1,_A(c,M)?pA(c,M):new Date(NaN);if(p=Ts.WwwD.exec(i),p){M=parseInt(p[1],10)-1;var o=parseInt(p[2],10)-1;return _A(c,M,o)?pA(c,M,o):new Date(NaN)}return null}function E7(i){var c,p,y;if(c=Ts.HH.exec(i),c)return p=parseFloat(c[1].replace(",",".")),H0(p)?p%24*G0:NaN;if(c=Ts.HHMM.exec(i),c)return p=parseInt(c[1],10),y=parseFloat(c[2].replace(",",".")),H0(p,y)?p%24*G0+y*fA:NaN;if(c=Ts.HHMMSS.exec(i),c){p=parseInt(c[1],10),y=parseInt(c[2],10);var T=parseFloat(c[3].replace(",","."));return H0(p,y,T)?p%24*G0+y*fA+T*1e3:NaN}return null}function pA(i,c,p){c=c||0,p=p||0;var y=new Date(0);y.setUTCFullYear(i,0,4);var T=y.getUTCDay()||7,M=c*7+p+1-T;return y.setUTCDate(y.getUTCDate()+M),y}var A7=[31,28,31,30,31,30,31,31,30,31,30,31],I7=[31,29,31,30,31,30,31,31,30,31,30,31];function bP(i){return i%400===0||i%4===0&&i%100!==0}function mA(i,c,p){if(c<0||c>11)return!1;if(p!=null){if(p<1)return!1;var y=bP(i);if(y&&p>I7[c]||!y&&p>A7[c])return!1}return!0}function C7(i,c){if(c<1)return!1;var p=bP(i);return!(p&&c>366||!p&&c>365)}function _A(i,c,p){return!(c<0||c>52||p!=null&&(p<0||p>6))}function H0(i,c,p){return!(i!=null&&(i<0||i>=25)||c!=null&&(c<0||c>=60)||p!=null&&(p<0||p>=60))}function ps(i,c){if(c.length<i)throw new TypeError(i+" argument"+(i>1?"s":"")+" required, but only "+c.length+" present")}function Ig(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ig=function(p){return typeof p}:Ig=function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},Ig(i)}function il(i){ps(1,arguments);var c=Object.prototype.toString.call(i);return i instanceof Date||Ig(i)==="object"&&c==="[object Date]"?new Date(i.getTime()):typeof i=="number"||c==="[object Number]"?new Date(i):((typeof i=="string"||c==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function pd(i){if(i===null||i===!0||i===!1)return NaN;var c=Number(i);return isNaN(c)?c:c<0?Math.ceil(c):Math.floor(c)}var P7={};function P1(){return P7}function Au(i,c){var p,y,T,M,C,R,o,B;ps(1,arguments);var $=P1(),H=pd((p=(y=(T=(M=c==null?void 0:c.weekStartsOn)!==null&&M!==void 0?M:c==null||(C=c.locale)===null||C===void 0||(R=C.options)===null||R===void 0?void 0:R.weekStartsOn)!==null&&T!==void 0?T:$.weekStartsOn)!==null&&y!==void 0?y:(o=$.locale)===null||o===void 0||(B=o.options)===null||B===void 0?void 0:B.weekStartsOn)!==null&&p!==void 0?p:0);if(!(H>=0&&H<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var ie=il(i),oe=ie.getDay(),_e=(oe<H?7:0)+oe-H;return ie.setDate(ie.getDate()-_e),ie.setHours(0,0,0,0),ie}function gA(i){var c=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()));return c.setUTCFullYear(i.getFullYear()),i.getTime()-c.getTime()}var D7=6048e5;function L7(i,c,p){ps(2,arguments);var y=Au(i,p),T=Au(c,p),M=y.getTime()-gA(y),C=T.getTime()-gA(T);return Math.round((M-C)/D7)}function R7(i){ps(1,arguments);var c=il(i),p=c.getMonth();return c.setFullYear(c.getFullYear(),p+1,0),c.setHours(0,0,0,0),c}function k7(i){ps(1,arguments);var c=il(i);return c.setDate(1),c.setHours(0,0,0,0),c}function O7(i,c){return ps(1,arguments),L7(R7(i),k7(i),c)+1}function z7(i,c){var p,y,T,M,C,R,o,B;ps(1,arguments);var $=il(i),H=$.getFullYear(),ie=P1(),oe=pd((p=(y=(T=(M=c==null?void 0:c.firstWeekContainsDate)!==null&&M!==void 0?M:c==null||(C=c.locale)===null||C===void 0||(R=C.options)===null||R===void 0?void 0:R.firstWeekContainsDate)!==null&&T!==void 0?T:ie.firstWeekContainsDate)!==null&&y!==void 0?y:(o=ie.locale)===null||o===void 0||(B=o.options)===null||B===void 0?void 0:B.firstWeekContainsDate)!==null&&p!==void 0?p:1);if(!(oe>=1&&oe<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var _e=new Date(0);_e.setFullYear(H+1,0,oe),_e.setHours(0,0,0,0);var Me=Au(_e,c),Re=new Date(0);Re.setFullYear(H,0,oe),Re.setHours(0,0,0,0);var Ee=Au(Re,c);return $.getTime()>=Me.getTime()?H+1:$.getTime()>=Ee.getTime()?H:H-1}function F7(i,c){var p,y,T,M,C,R,o,B;ps(1,arguments);var $=P1(),H=pd((p=(y=(T=(M=c==null?void 0:c.firstWeekContainsDate)!==null&&M!==void 0?M:c==null||(C=c.locale)===null||C===void 0||(R=C.options)===null||R===void 0?void 0:R.firstWeekContainsDate)!==null&&T!==void 0?T:$.firstWeekContainsDate)!==null&&y!==void 0?y:(o=$.locale)===null||o===void 0||(B=o.options)===null||B===void 0?void 0:B.firstWeekContainsDate)!==null&&p!==void 0?p:1),ie=z7(i,c),oe=new Date(0);oe.setFullYear(ie,0,H),oe.setHours(0,0,0,0);var _e=Au(oe,c);return _e}var B7=6048e5;function N7(i,c){ps(1,arguments);var p=il(i),y=Au(p,c).getTime()-F7(p,c).getTime();return Math.round(y/B7)+1}function qg(i){return ps(1,arguments),Au(i,{weekStartsOn:1})}function V7(i){ps(1,arguments);var c=il(i),p=c.getFullYear(),y=new Date(0);y.setFullYear(p+1,0,4),y.setHours(0,0,0,0);var T=qg(y),M=new Date(0);M.setFullYear(p,0,4),M.setHours(0,0,0,0);var C=qg(M);return c.getTime()>=T.getTime()?p+1:c.getTime()>=C.getTime()?p:p-1}function $7(i){ps(1,arguments);var c=V7(i),p=new Date(0);p.setFullYear(c,0,4),p.setHours(0,0,0,0);var y=qg(p);return y}var U7=6048e5;function j7(i){ps(1,arguments);var c=il(i),p=qg(c).getTime()-$7(c).getTime();return Math.round(p/U7)+1}function ws(i,c){ps(2,arguments);var p=il(i),y=pd(c);return isNaN(y)?new Date(NaN):(y&&p.setDate(p.getDate()+y),p)}function Wg(i,c){ps(2,arguments);var p=il(i),y=pd(c);if(isNaN(y))return new Date(NaN);if(!y)return p;var T=p.getDate(),M=new Date(p.getTime());M.setMonth(p.getMonth()+y+1,0);var C=M.getDate();return T>=C?M:(p.setFullYear(M.getFullYear(),M.getMonth(),T),p)}function yA(i,c){ps(2,arguments);var p=pd(c);return Wg(i,p*12)}const G7={daily:["year","month","day"],weekly:["year","month","week"],monthly:["year","month"]};function H7({monthComps:i,prevMonthComps:c,nextMonthComps:p},y){const T=[],{firstDayOfWeek:M,firstWeekday:C,isoWeeknumbers:R,weeknumbers:o,numDays:B,numWeeks:$}=i,H=C+(C<M?hs:0)-M;let ie=!0,oe=!1,_e=!1,Me=0;const Re=new Intl.DateTimeFormat(y.id,{weekday:"long",year:"numeric",month:"short",day:"numeric"});let Ee=c.numDays-H+1,mt=c.numDays-Ee+1,gt=Math.floor((Ee-1)/hs+1),dt=1,ut=c.numWeeks,ht=1,lt=c.month,Qe=c.year;const Se=new Date,Xt=Se.getDate(),xr=Se.getMonth()+1,Ve=Se.getFullYear();for(let jt=1;jt<=F9;jt++){for(let Ur=1,$e=M;Ur<=hs;Ur++,$e+=$e===hs?1-hs:1){ie&&$e===C&&(Ee=1,mt=i.numDays,gt=Math.floor((Ee-1)/hs+1),dt=Math.floor((B-Ee)/hs+1),ut=1,ht=$,lt=i.month,Qe=i.year,ie=!1,oe=!0);const ur=y.getDateFromParams(Qe,lt,Ee,0,0,0,0),gr=y.getDateFromParams(Qe,lt,Ee,12,0,0,0),zt=y.getDateFromParams(Qe,lt,Ee,23,59,59,999),vn=ur,Ft=`${si(Qe,4)}-${si(lt,2)}-${si(Ee,2)}`,zr=Ur,nr=hs-Ur,En=o[jt-1],dn=R[jt-1],Bn=Ee===Xt&&lt===xr&&Qe===Ve,bn=oe&&Ee===1,it=oe&&Ee===B,Kt=jt===1,Gt=jt===$,ir=Ur===1,Vr=Ur===hs,Kr=RP(Qe,lt,Ee);T.push({locale:y,id:Ft,position:++Me,label:Ee.toString(),ariaLabel:Re.format(new Date(Qe,lt-1,Ee)),day:Ee,dayFromEnd:mt,weekday:$e,weekdayPosition:zr,weekdayPositionFromEnd:nr,weekdayOrdinal:gt,weekdayOrdinalFromEnd:dt,week:ut,weekFromEnd:ht,weekPosition:jt,weeknumber:En,isoWeeknumber:dn,month:lt,year:Qe,date:vn,startDate:ur,endDate:zt,noonDate:gr,dayIndex:Kr,isToday:Bn,isFirstDay:bn,isLastDay:it,isDisabled:!oe,isFocusable:!oe,isFocused:!1,inMonth:oe,inPrevMonth:ie,inNextMonth:_e,onTop:Kt,onBottom:Gt,onLeft:ir,onRight:Vr,classes:[`id-${Ft}`,`day-${Ee}`,`day-from-end-${mt}`,`weekday-${$e}`,`weekday-position-${zr}`,`weekday-ordinal-${gt}`,`weekday-ordinal-from-end-${dt}`,`week-${ut}`,`week-from-end-${ht}`,{"is-today":Bn,"is-first-day":bn,"is-last-day":it,"in-month":oe,"in-prev-month":ie,"in-next-month":_e,"on-top":Kt,"on-bottom":Gt,"on-left":ir,"on-right":Vr}]}),oe&&it?(oe=!1,_e=!0,Ee=1,mt=B,gt=1,dt=Math.floor((B-Ee)/hs+1),ut=1,ht=p.numWeeks,lt=p.month,Qe=p.year):(Ee++,mt--,gt=Math.floor((Ee-1)/hs+1),dt=Math.floor((B-Ee)/hs+1))}ut++,ht--}return T}function q7(i,c,p,y){const T=i.reduce((M,C,R)=>{const o=Math.floor(R/7);let B=M[o];return B||(B={id:`week-${o+1}`,title:"",week:C.week,weekPosition:C.weekPosition,weeknumber:C.weeknumber,isoWeeknumber:C.isoWeeknumber,weeknumberDisplay:c?C.weeknumber:p?C.isoWeeknumber:void 0,days:[]},M[o]=B),B.days.push(C),M},Array(i.length/hs));return T.forEach(M=>{const C=M.days[0],R=M.days[M.days.length-1];C.month===R.month?M.title=`${y.formatDate(C.date,"MMMM YYYY")}`:C.year===R.year?M.title=`${y.formatDate(C.date,"MMM")} - ${y.formatDate(R.date,"MMM YYYY")}`:M.title=`${y.formatDate(C.date,"MMM YYYY")} - ${y.formatDate(R.date,"MMM YYYY")}`}),T}function W7(i,c){return i.days.map(p=>({label:c.formatDate(p.date,c.masks.weekdays),weekday:p.weekday}))}function Y7(i,c){return`${c}.${si(i,2)}`}function wP(i,c,p){return vP(p.getDateParts(p.toDate(i)),G7[c])}function TP({day:i,week:c,month:p,year:y},T,M,C){if(M==="daily"&&i){const R=new Date(y,p-1,i),o=ws(R,T);return{day:o.getDate(),month:o.getMonth()+1,year:o.getFullYear()}}else if(M==="weekly"&&c){const o=C.getMonthParts(p,y).firstDayOfMonth,B=ws(o,(c-1+T)*7),$=C.getDateParts(B);return{week:$.week,month:$.month,year:$.year}}else{const R=new Date(y,p-1,1),o=Wg(R,T);return{month:o.getMonth()+1,year:o.getFullYear()}}}function pa(i){return i!=null&&i.month!=null&&i.year!=null}function Ex(i,c){return!pa(i)||!pa(c)?!1:(i=i,c=c,i.year!==c.year?i.year<c.year:i.month&&c.month&&i.month!==c.month?i.month<c.month:i.week&&c.week&&i.week!==c.week?i.week<c.week:i.day&&c.day&&i.day!==c.day?i.day<c.day:!1)}function Yg(i,c){return!pa(i)||!pa(c)?!1:(i=i,c=c,i.year!==c.year?i.year>c.year:i.month&&c.month&&i.month!==c.month?i.month>c.month:i.week&&c.week&&i.week!==c.week?i.week>c.week:i.day&&c.day&&i.day!==c.day?i.day>c.day:!1)}function Z7(i,c,p){return(i||!1)&&!Ex(i,c)&&!Yg(i,p)}function X7(i,c){return!i&&c||i&&!c?!1:!i&&!c?!0:(i=i,c=c,i.year===c.year&&i.month===c.month&&i.week===c.week&&i.day===c.day)}function K7(i,c,p,y){if(!pa(i)||!pa(c))return[];const T=[];for(;!Yg(i,c);)T.push(i),i=TP(i,1,p,y);return T}function SP(i){const{day:c,week:p,month:y,year:T}=i;let M=`${T}-${si(y,2)}`;return p&&(M=`${M}-w${p}`),c&&(M=`${M}-${si(c,2)}`),M}function J7(i,c){const{month:p,year:y,showWeeknumbers:T,showIsoWeeknumbers:M}=i,C=new Date(y,p-1,15),R=c.getMonthParts(p,y),o=c.getPrevMonthParts(p,y),B=c.getNextMonthParts(p,y),$=H7({monthComps:R,prevMonthComps:o,nextMonthComps:B},c),H=q7($,T,M,c),ie=W7(H[0],c);return{id:SP(i),month:p,year:y,monthTitle:c.formatDate(C,c.masks.title),shortMonthLabel:c.formatDate(C,"MMM"),monthLabel:c.formatDate(C,"MMMM"),shortYearLabel:y.toString().substring(2),yearLabel:y.toString(),monthComps:R,prevMonthComps:o,nextMonthComps:B,days:$,weeks:H,weekdays:ie}}function Q7(i,c){const{day:p,week:y,view:T,trimWeeks:M}=i,C={...c,...i,title:"",viewDays:[],viewWeeks:[]};switch(T){case"daily":{let R=C.days.find(B=>B.inMonth);p?R=C.days.find(B=>B.day===p&&B.inMonth)||R:y&&(R=C.days.find(B=>B.week===y&&B.inMonth));const o=C.weeks[R.week-1];C.viewWeeks=[o],C.viewDays=[R],C.week=R.week,C.weekTitle=o.title,C.day=R.day,C.dayTitle=R.ariaLabel,C.title=C.dayTitle;break}case"weekly":{C.week=y||1;const R=C.weeks[C.week-1];C.viewWeeks=[R],C.viewDays=R.days,C.weekTitle=R.title,C.title=C.weekTitle;break}default:{C.title=C.monthTitle,C.viewWeeks=C.weeks.slice(0,M?C.monthComps.numWeeks:void 0),C.viewDays=C.days;break}}return C}class vA{constructor(c,p,y){$r(this,"keys",[]),$r(this,"store",{}),this.size=c,this.createKey=p,this.createItem=y}get(...c){const p=this.createKey(...c);return this.store[p]}getOrSet(...c){const p=this.createKey(...c);if(this.store[p])return this.store[p];const y=this.createItem(...c);if(this.keys.length>=this.size){const T=this.keys.shift();T!=null&&delete this.store[T]}return this.keys.push(p),this.store[p]=y,y}}class Wh{constructor(c,p=new Zg){$r(this,"order"),$r(this,"locale"),$r(this,"start",null),$r(this,"end",null),$r(this,"repeat",null);var y;this.locale=p;const{start:T,end:M,span:C,order:R,repeat:o}=c;qh(T)&&(this.start=p.getDateParts(T)),qh(M)?this.end=p.getDateParts(M):this.start!=null&&C&&(this.end=p.getDateParts(ws(this.start.date,C-1))),this.order=R??0,o&&(this.repeat=new Xg({from:(y=this.start)==null?void 0:y.date,...o},{locale:this.locale}))}static fromMany(c,p){return(uo(c)?c:[c]).filter(y=>y).map(y=>Wh.from(y,p))}static from(c,p){if(c instanceof Wh)return c;const y={start:null,end:null};return c!=null&&(uo(c)?(y.start=c[0]??null,y.end=c[1]??null):el(c)?Object.assign(y,c):(y.start=c,y.end=c)),y.start!=null&&(y.start=new Date(y.start)),y.end!=null&&(y.end=new Date(y.end)),new Wh(y,p)}get opts(){const{order:c,locale:p}=this;return{order:c,locale:p}}get hasRepeat(){return!!this.repeat}get isSingleDay(){const{start:c,end:p}=this;return c&&p&&c.year===p.year&&c.month===p.month&&c.day===p.day}get isMultiDay(){return!this.isSingleDay}get daySpan(){return this.start==null||this.end==null?this.hasRepeat?1:1/0:this.end.dayIndex-this.start.dayIndex}startsOnDay(c){var p,y;return((p=this.start)==null?void 0:p.dayIndex)===c.dayIndex||!!((y=this.repeat)!=null&&y.passes(c))}intersectsDay(c){return this.intersectsDayRange(c,c)}intersectsRange(c){var p,y;return this.intersectsDayRange(((p=c.start)==null?void 0:p.dayIndex)??-1/0,((y=c.end)==null?void 0:y.dayIndex)??1/0)}intersectsDayRange(c,p){return!(this.start&&this.start.dayIndex>p||this.end&&this.end.dayIndex<c)}}class e9{constructor(){$r(this,"records",{})}render(c,p,y){var T,M,C,R;let o=null;const B=y[0].dayIndex,$=y[y.length-1].dayIndex;return p.hasRepeat?y.forEach(H=>{var ie,oe;if(p.startsOnDay(H)){const _e=p.daySpan<1/0?p.daySpan:1;o={startDay:H.dayIndex,startTime:((ie=p.start)==null?void 0:ie.time)??0,endDay:H.dayIndex+_e-1,endTime:((oe=p.end)==null?void 0:oe.time)??Cg},this.getRangeRecords(c).push(o)}}):p.intersectsDayRange(B,$)&&(o={startDay:((T=p.start)==null?void 0:T.dayIndex)??-1/0,startTime:((M=p.start)==null?void 0:M.time)??-1/0,endDay:((C=p.end)==null?void 0:C.dayIndex)??1/0,endTime:((R=p.end)==null?void 0:R.time)??1/0},this.getRangeRecords(c).push(o)),o}getRangeRecords(c){let p=this.records[c.key];return p||(p={ranges:[],data:c},this.records[c.key]=p),p.ranges}getCell(c,p){return this.getCells(p).find(M=>M.data.key===c)}cellExists(c,p){const y=this.records[c];return y==null?!1:y.ranges.some(T=>T.startDay<=p&&T.endDay>=p)}getCells(c){const p=Object.values(this.records),y=[],{dayIndex:T}=c;return p.forEach(({data:M,ranges:C})=>{C.filter(R=>R.startDay<=T&&R.endDay>=T).forEach(R=>{const o=T===R.startDay,B=T===R.endDay,$=o?R.startTime:0,H=new Date(c.startDate.getTime()+$),ie=B?R.endTime:Cg,oe=new Date(c.endDate.getTime()+ie),_e=$===0&&ie===Cg,Me=M.order||0;y.push({...R,data:M,onStart:o,onEnd:B,startTime:$,startDate:H,endTime:ie,endDate:oe,allDay:_e,order:Me})})}),y.sort((M,C)=>M.order-C.order),y}}const tl={ar:{dow:7,L:"D/M/YYYY"},bg:{dow:2,L:"D.MM.YYYY"},ca:{dow:2,L:"DD/MM/YYYY"},"zh-CN":{dow:2,L:"YYYY/MM/DD"},"zh-TW":{dow:1,L:"YYYY/MM/DD"},hr:{dow:2,L:"DD.MM.YYYY"},cs:{dow:2,L:"DD.MM.YYYY"},da:{dow:2,L:"DD.MM.YYYY"},nl:{dow:2,L:"DD-MM-YYYY"},"en-US":{dow:1,L:"MM/DD/YYYY"},"en-AU":{dow:2,L:"DD/MM/YYYY"},"en-CA":{dow:1,L:"YYYY-MM-DD"},"en-GB":{dow:2,L:"DD/MM/YYYY"},"en-IE":{dow:2,L:"DD-MM-YYYY"},"en-NZ":{dow:2,L:"DD/MM/YYYY"},"en-ZA":{dow:1,L:"YYYY/MM/DD"},eo:{dow:2,L:"YYYY-MM-DD"},et:{dow:2,L:"DD.MM.YYYY"},fi:{dow:2,L:"DD.MM.YYYY"},fr:{dow:2,L:"DD/MM/YYYY"},"fr-CA":{dow:1,L:"YYYY-MM-DD"},"fr-CH":{dow:2,L:"DD.MM.YYYY"},de:{dow:2,L:"DD.MM.YYYY"},he:{dow:1,L:"DD.MM.YYYY"},id:{dow:2,L:"DD/MM/YYYY"},it:{dow:2,L:"DD/MM/YYYY"},ja:{dow:1,L:"YYYYMD"},ko:{dow:1,L:"YYYY.MM.DD"},lv:{dow:2,L:"DD.MM.YYYY"},lt:{dow:2,L:"DD.MM.YYYY"},mk:{dow:2,L:"D.MM.YYYY"},nb:{dow:2,L:"D. MMMM YYYY"},nn:{dow:2,L:"D. MMMM YYYY"},pl:{dow:2,L:"DD.MM.YYYY"},pt:{dow:2,L:"DD/MM/YYYY"},ro:{dow:2,L:"DD.MM.YYYY"},ru:{dow:2,L:"DD.MM.YYYY"},sk:{dow:2,L:"DD.MM.YYYY"},"es-ES":{dow:2,L:"DD/MM/YYYY"},"es-MX":{dow:2,L:"DD/MM/YYYY"},sv:{dow:2,L:"YYYY-MM-DD"},th:{dow:1,L:"DD/MM/YYYY"},tr:{dow:2,L:"DD.MM.YYYY"},uk:{dow:2,L:"DD.MM.YYYY"},vi:{dow:2,L:"DD/MM/YYYY"}};tl.en=tl["en-US"];tl.es=tl["es-ES"];tl.no=tl.nb;tl.zh=tl["zh-CN"];const t9=Object.entries(tl).reduce((i,[c,{dow:p,L:y}])=>(i[c]={id:c,firstDayOfWeek:p,masks:{L:y}},i),{}),r9="MMMM YYYY",n9="W",i9="MMM",s9="h A",o9=["L","YYYY-MM-DD","YYYY/MM/DD"],a9=["L h:mm A","YYYY-MM-DD h:mm A","YYYY/MM/DD h:mm A"],l9=["L HH:mm","YYYY-MM-DD HH:mm","YYYY/MM/DD HH:mm"],c9=["h:mm A"],u9=["HH:mm"],h9="WWW, MMM D, YYYY",d9=["L","YYYY-MM-DD","YYYY/MM/DD"],f9="iso",p9="YYYY-MM-DDTHH:mm:ss.SSSZ",m9={title:r9,weekdays:n9,navMonths:i9,hours:s9,input:o9,inputDateTime:a9,inputDateTime24hr:l9,inputTime:c9,inputTime24hr:u9,dayPopover:h9,data:d9,model:f9,iso:p9},_9=300,g9=60,y9=80,v9={maxSwipeTime:_9,minHorizontalSwipeDistance:g9,maxVerticalSwipeDistance:y9},x9={componentPrefix:"V",color:"blue",isDark:!1,navVisibility:"click",titlePosition:"center",transition:"slide-h",touch:v9,masks:m9,locales:t9,datePicker:{updateOnInput:!0,inputDebounce:1e3,popover:{visibility:"hover-focus",placement:"bottom-start",isInteractive:!0}}},Ax=Xs(x9),b9=rt(()=>UW(Ax.locales,i=>(i.masks=Qp(i.masks,Ax.masks),i))),dc=i=>typeof window<"u"&&gP(window.__vcalendar__,i)?wu(window.__vcalendar__,i):wu(Ax,i),w9=12,T9=5;function S9(i,c){const p=new Intl.DateTimeFormat().resolvedOptions().locale;let y;fa(i)?y=i:gP(i,"id")&&(y=i.id),y=(y||p).toLowerCase();const T=Object.keys(c),M=o=>T.find(B=>B.toLowerCase()===o);y=M(y)||M(y.substring(0,2))||p;const C={...c["en-IE"],...c[y],id:y,monthCacheSize:w9,pageCacheSize:T9};return el(i)?Qp(i,C):C}class Zg{constructor(c=void 0,p){$r(this,"id"),$r(this,"daysInWeek"),$r(this,"firstDayOfWeek"),$r(this,"masks"),$r(this,"timezone"),$r(this,"hourLabels"),$r(this,"dayNames"),$r(this,"dayNamesShort"),$r(this,"dayNamesShorter"),$r(this,"dayNamesNarrow"),$r(this,"monthNames"),$r(this,"monthNamesShort"),$r(this,"relativeTimeNames"),$r(this,"amPm",["am","pm"]),$r(this,"monthCache"),$r(this,"pageCache");const{id:y,firstDayOfWeek:T,masks:M,monthCacheSize:C,pageCacheSize:R}=S9(c,b9.value);this.monthCache=new vA(C,q9,W9),this.pageCache=new vA(R,SP,J7),this.id=y,this.daysInWeek=hs,this.firstDayOfWeek=s7(T,1,hs),this.masks=M,this.timezone=p||void 0,this.hourLabels=this.getHourLabels(),this.dayNames=q0("long",this.id),this.dayNamesShort=q0("short",this.id),this.dayNamesShorter=this.dayNamesShort.map(o=>o.substring(0,2)),this.dayNamesNarrow=q0("narrow",this.id),this.monthNames=MA("long",this.id),this.monthNamesShort=MA("short",this.id),this.relativeTimeNames=X9(this.id)}formatDate(c,p){return tX(c,p,this)}parseDate(c,p){return EA(c,p,this)}toDate(c,p={}){const y=new Date(NaN);let T=y;const{fillDate:M,mask:C,patch:R,rules:o}=p;if(Oo(c)?(p.type="number",T=new Date(+c)):fa(c)?(p.type="string",T=c?EA(c,C||"iso",this):y):qh(c)?(p.type="date",T=new Date(c.getTime())):D1(c)&&(p.type="object",T=this.getDateFromParts(c)),T&&(R||o)){let B=this.getDateParts(T);if(R&&M!=null){const $=this.getDateParts(this.toDate(M));B=this.getDateParts(this.toDate({...$,...vP(B,z9[R])}))}o&&(B=eX(B,o)),T=this.getDateFromParts(B)}return T||y}toDateOrNull(c,p={}){const y=this.toDate(c,p);return isNaN(y.getTime())?null:y}fromDate(c,{type:p,mask:y}={}){switch(p){case"number":return c?c.getTime():NaN;case"string":return c?this.formatDate(c,y||"iso"):"";case"object":return c?this.getDateParts(c):null;default:return c?new Date(c):null}}range(c){return Wh.from(c,this)}ranges(c){return Wh.fromMany(c,this)}getDateParts(c){return H9(c,this)}getDateFromParts(c){return OP(c,this.timezone)}getDateFromParams(c,p,y,T,M,C,R){return this.getDateFromParts({year:c,month:p,day:y,hours:T,minutes:M,seconds:C,milliseconds:R})}getPage(c){const p=this.pageCache.getOrSet(c,this);return Q7(c,p)}getMonthParts(c,p){const{firstDayOfWeek:y}=this;return this.monthCache.getOrSet(c,p,y)}getThisMonthParts(){const c=new Date;return this.getMonthParts(c.getMonth()+1,c.getFullYear())}getPrevMonthParts(c,p){return c===1?this.getMonthParts(12,p-1):this.getMonthParts(c-1,p)}getNextMonthParts(c,p){return c===12?this.getMonthParts(1,p+1):this.getMonthParts(c+1,p)}getHourLabels(){return Z9().map(c=>this.formatDate(c,this.masks.hours))}getDayId(c){return this.formatDate(c,"YYYY-MM-DD")}}var Nh=(i=>(i.Any="any",i.All="all",i))(Nh||{}),MP=(i=>(i.Days="days",i.Weeks="weeks",i.Months="months",i.Years="years",i))(MP||{}),EP=(i=>(i.Days="days",i.Weekdays="weekdays",i.Weeks="weeks",i.Months="months",i.Years="years",i))(EP||{}),AP=(i=>(i.OrdinalWeekdays="ordinalWeekdays",i))(AP||{});class M9{constructor(c,p,y){$r(this,"validated",!0),this.type=c,this.interval=p,this.from=y,this.from||(console.error('A valid "from" date is required for date interval rule. This rule will be skipped.'),this.validated=!1)}passes(c){if(!this.validated)return!0;const{date:p}=c;switch(this.type){case"days":return L1(this.from.date,p)%this.interval===0;case"weeks":return j9(this.from.date,p)%this.interval===0;case"months":return G9(this.from.date,p)%this.interval===0;case"years":return kP(this.from.date,p)%this.interval===0;default:return!1}}}class md{constructor(c,p,y,T){$r(this,"components",[]),this.type=c,this.validator=y,this.getter=T,this.components=this.normalizeComponents(p)}static create(c,p){switch(c){case"days":return new E9(p);case"weekdays":return new A9(p);case"weeks":return new I9(p);case"months":return new C9(p);case"years":return new P9(p)}}normalizeComponents(c){if(this.validator(c))return[c];if(!uo(c))return[];const p=[];return c.forEach(y=>{if(!this.validator(y)){console.error(`Component value ${y} in invalid for "${this.type}" rule. This rule will be skipped.`);return}p.push(y)}),p}passes(c){return this.getter(c).some(T=>this.components.includes(T))}}class E9 extends md{constructor(c){super("days",c,R9,({day:p,dayFromEnd:y})=>[p,-y])}}class A9 extends md{constructor(c){super("weekdays",c,Ix,({weekday:p})=>[p])}}class I9 extends md{constructor(c){super("weeks",c,k9,({week:p,weekFromEnd:y})=>[p,-y])}}class C9 extends md{constructor(c){super("months",c,O9,({month:p})=>[p])}}class P9 extends md{constructor(c){super("years",c,Oo,({year:p})=>[p])}}class D9{constructor(c,p){$r(this,"components"),this.type=c,this.components=this.normalizeComponents(p)}normalizeArrayConfig(c){const p=[];return c.forEach((y,T)=>{if(Oo(y)){if(T===0)return;if(!xA(c[0])){console.error(`Ordinal range for "${this.type}" rule is from -5 to -1 or 1 to 5. This rule will be skipped.`);return}if(!Ix(y)){console.error(`Acceptable range for "${this.type}" rule is from 1 to 5. This rule will be skipped`);return}p.push([c[0],y])}else uo(y)&&p.push(...this.normalizeArrayConfig(y))}),p}normalizeComponents(c){const p=[];return c.forEach((y,T)=>{if(Oo(y)){if(T===0)return;if(!xA(c[0])){console.error(`Ordinal range for "${this.type}" rule is from -5 to -1 or 1 to 5. This rule will be skipped.`);return}if(!Ix(y)){console.error(`Acceptable range for "${this.type}" rule is from 1 to 5. This rule will be skipped`);return}p.push([c[0],y])}else uo(y)&&p.push(...this.normalizeArrayConfig(y))}),p}passes(c){const{weekday:p,weekdayOrdinal:y,weekdayOrdinalFromEnd:T}=c;return this.components.some(([M,C])=>(M===y||M===-T)&&p===C)}}class L9{constructor(c){$r(this,"type","function"),$r(this,"validated",!0),this.fn=c,Du(c)||(console.error("The function rule requires a valid function. This rule will be skipped."),this.validated=!1)}passes(c){return this.validated?this.fn(c):!0}}class Xg{constructor(c,p={},y){$r(this,"validated",!0),$r(this,"config"),$r(this,"type",Nh.Any),$r(this,"from"),$r(this,"until"),$r(this,"rules",[]),$r(this,"locale",new Zg),this.parent=y,p.locale&&(this.locale=p.locale),this.config=c,Du(c)?(this.type=Nh.All,this.rules=[new L9(c)]):uo(c)?(this.type=Nh.Any,this.rules=c.map(T=>new Xg(T,p,this))):el(c)?(this.type=Nh.All,this.from=c.from?this.locale.getDateParts(c.from):y==null?void 0:y.from,this.until=c.until?this.locale.getDateParts(c.until):y==null?void 0:y.until,this.rules=this.getObjectRules(c)):(console.error("Rule group configuration must be an object or an array."),this.validated=!1)}getObjectRules(c){const p=[];if(c.every&&(fa(c.every)&&(c.every=[1,`${c.every}s`]),uo(c.every))){const[y=1,T=MP.Days]=c.every;p.push(new M9(T,y,this.from))}return Object.values(EP).forEach(y=>{y in c&&p.push(md.create(y,c[y]))}),Object.values(AP).forEach(y=>{y in c&&p.push(new D9(y,c[y]))}),c.on!=null&&(uo(c.on)||(c.on=[c.on]),p.push(new Xg(c.on,{locale:this.locale},this.parent))),p}passes(c){return this.validated?this.from&&c.dayIndex<=this.from.dayIndex||this.until&&c.dayIndex>=this.until.dayIndex?!1:this.type===Nh.Any?this.rules.some(p=>p.passes(c)):this.rules.every(p=>p.passes(c)):!0}}function R9(i){return Oo(i)?i>=1&&i<=31:!1}function Ix(i){return Oo(i)?i>=1&&i<=7:!1}function k9(i){return Oo(i)?i>=-6&&i<=-1||i>=1&&i<=6:!1}function O9(i){return Oo(i)?i>=1&&i<=12:!1}function xA(i){return!(!Oo(i)||i<-5||i>5||i===0)}const z9={dateTime:["year","month","day","hours","minutes","seconds","milliseconds"],date:["year","month","day"],time:["hours","minutes","seconds","milliseconds"]},hs=7,F9=6,IP=1e3,CP=IP*60,PP=CP*60,Cg=PP*24,B9=[31,28,31,30,31,30,31,31,30,31,30,31],N9=["L","iso"],Ip={milliseconds:[0,999,3],seconds:[0,59,2],minutes:[0,59,2],hours:[0,23,2]},DP=/d{1,2}|W{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|Z{1,4}|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,V9=/\[([^]*?)\]/gm,bA={D(i){return i.day},DD(i){return si(i.day,2)},d(i){return i.weekday-1},dd(i){return si(i.weekday-1,2)},W(i,c){return c.dayNamesNarrow[i.weekday-1]},WW(i,c){return c.dayNamesShorter[i.weekday-1]},WWW(i,c){return c.dayNamesShort[i.weekday-1]},WWWW(i,c){return c.dayNames[i.weekday-1]},M(i){return i.month},MM(i){return si(i.month,2)},MMM(i,c){return c.monthNamesShort[i.month-1]},MMMM(i,c){return c.monthNames[i.month-1]},YY(i){return String(i.year).substr(2)},YYYY(i){return si(i.year,4)},h(i){return i.hours%12||12},hh(i){return si(i.hours%12||12,2)},H(i){return i.hours},HH(i){return si(i.hours,2)},m(i){return i.minutes},mm(i){return si(i.minutes,2)},s(i){return i.seconds},ss(i){return si(i.seconds,2)},S(i){return Math.round(i.milliseconds/100)},SS(i){return si(Math.round(i.milliseconds/10),2)},SSS(i){return si(i.milliseconds,3)},a(i,c){return i.hours<12?c.amPm[0]:c.amPm[1]},A(i,c){return i.hours<12?c.amPm[0].toUpperCase():c.amPm[1].toUpperCase()},Z(){return"Z"},ZZ(i){const c=i.timezoneOffset;return`${c>0?"-":"+"}${si(Math.floor(Math.abs(c)/60),2)}`},ZZZ(i){const c=i.timezoneOffset;return`${c>0?"-":"+"}${si(Math.floor(Math.abs(c)/60)*100+Math.abs(c)%60,4)}`},ZZZZ(i){const c=i.timezoneOffset;return`${c>0?"-":"+"}${si(Math.floor(Math.abs(c)/60),2)}:${si(Math.abs(c)%60,2)}`}},Zl=/\d\d?/,$9=/\d{3}/,U9=/\d{4}/,Mp=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF/]+(\s*?[\u0600-\u06FF]+){1,2}/i,wA=()=>{},TA=i=>(c,p,y)=>{const T=y[i].indexOf(p.charAt(0).toUpperCase()+p.substr(1).toLowerCase());~T&&(c.month=T)},li={D:[Zl,(i,c)=>{i.day=c}],Do:[new RegExp(Zl.source+Mp.source),(i,c)=>{i.day=parseInt(c,10)}],d:[Zl,wA],W:[Mp,wA],M:[Zl,(i,c)=>{i.month=c-1}],MMM:[Mp,TA("monthNamesShort")],MMMM:[Mp,TA("monthNames")],YY:[Zl,(i,c)=>{const y=+new Date().getFullYear().toString().substr(0,2);i.year=+`${c>68?y-1:y}${c}`}],YYYY:[U9,(i,c)=>{i.year=c}],S:[/\d/,(i,c)=>{i.milliseconds=c*100}],SS:[/\d{2}/,(i,c)=>{i.milliseconds=c*10}],SSS:[$9,(i,c)=>{i.milliseconds=c}],h:[Zl,(i,c)=>{i.hours=c}],m:[Zl,(i,c)=>{i.minutes=c}],s:[Zl,(i,c)=>{i.seconds=c}],a:[Mp,(i,c,p)=>{const y=c.toLowerCase();y===p.amPm[0]?i.isPm=!1:y===p.amPm[1]&&(i.isPm=!0)}],Z:[/[^\s]*?[+-]\d\d:?\d\d|[^\s]*?Z?/,(i,c)=>{c==="Z"&&(c="+00:00");const p=`${c}`.match(/([+-]|\d\d)/gi);if(p){const y=+p[1]*60+parseInt(p[2],10);i.timezoneOffset=p[0]==="+"?y:-y}}]};li.DD=li.D;li.dd=li.d;li.WWWW=li.WWW=li.WW=li.W;li.MM=li.M;li.mm=li.m;li.hh=li.H=li.HH=li.h;li.ss=li.s;li.A=li.a;li.ZZZZ=li.ZZZ=li.ZZ=li.Z;function LP(i,c){return(Wa(i)&&i||[fa(i)&&i||"YYYY-MM-DD"]).map(p=>N9.reduce((y,T)=>y.replace(T,c.masks[T]||""),p))}function D1(i){return el(i)&&"year"in i&&"month"in i&&"day"in i}function SA(i,c=1){const p=i.getDay()+1,y=p>=c?c-p:-(7-(c-p));return ws(i,y)}function RP(i,c,p){const y=Date.UTC(i,c-1,p);return L1(new Date(0),new Date(y))}function L1(i,c){return Math.round((c.getTime()-i.getTime())/Cg)}function j9(i,c){return Math.ceil(L1(SA(i),SA(c))/7)}function kP(i,c){return c.getUTCFullYear()-i.getUTCFullYear()}function G9(i,c){return kP(i,c)*12+(c.getMonth()-i.getMonth())}function OP(i,c=""){const p=new Date,{year:y=p.getFullYear(),month:T=p.getMonth()+1,day:M=p.getDate(),hours:C=0,minutes:R=0,seconds:o=0,milliseconds:B=0}=i;if(c){const $=`${si(y,4)}-${si(T,2)}-${si(M,2)}T${si(C,2)}:${si(R,2)}:${si(o,2)}.${si(B,3)}`;return w7($,{timeZone:c})}return new Date(y,T-1,M,C,R,o,B)}function H9(i,c){let p=new Date(i.getTime());c.timezone&&(p=new Date(i.toLocaleString("en-US",{timeZone:c.timezone})),p.setMilliseconds(i.getMilliseconds()));const y=p.getMilliseconds(),T=p.getSeconds(),M=p.getMinutes(),C=p.getHours(),R=y+T*IP+M*CP+C*PP,o=p.getMonth()+1,B=p.getFullYear(),$=c.getMonthParts(o,B),H=p.getDate(),ie=$.numDays-H+1,oe=p.getDay()+1,_e=Math.floor((H-1)/7+1),Me=Math.floor(($.numDays-H)/7+1),Re=Math.ceil((H+Math.abs($.firstWeekday-$.firstDayOfWeek))/7),Ee=$.numWeeks-Re+1,mt=$.weeknumbers[Re],gt=RP(B,o,H);return{milliseconds:y,seconds:T,minutes:M,hours:C,time:R,day:H,dayFromEnd:ie,weekday:oe,weekdayOrdinal:_e,weekdayOrdinalFromEnd:Me,week:Re,weekFromEnd:Ee,weeknumber:mt,month:o,year:B,date:p,dateTime:p.getTime(),dayIndex:gt,timezoneOffset:0,isValid:!0}}function q9(i,c,p){return`${c}-${i}-${p}`}function W9(i,c,p){const y=c%4===0&&c%100!==0||c%400===0,T=new Date(c,i-1,1),M=T.getDay()+1,C=i===2&&y?29:B9[i-1],R=p-1,o=O7(T,{weekStartsOn:R}),B=[],$=[];for(let H=0;H<o;H++){const ie=ws(T,H*7);B.push(N7(ie,{weekStartsOn:R})),$.push(j7(ie))}return{firstDayOfWeek:p,firstDayOfMonth:T,inLeapYear:y,firstWeekday:M,numDays:C,numWeeks:o,month:i,year:c,weeknumbers:B,isoWeeknumbers:$}}function Y9(){const i=[];for(let T=0;T<hs;T++)i.push(OP({year:2020,month:1,day:5+T,hours:12}));return i}function q0(i,c=void 0){const p=new Intl.DateTimeFormat(c,{weekday:i});return Y9().map(y=>p.format(y))}function Z9(){const i=[];for(let c=0;c<=24;c++)i.push(new Date(2e3,0,1,c));return i}function X9(i=void 0){const c=["second","minute","hour","day","week","month","quarter","year"],p=new Intl.RelativeTimeFormat(i);return c.reduce((y,T)=>{const M=p.formatToParts(100,T);return y[T]=M[1].unit,y},{})}function zP(){const i=[];for(let c=0;c<12;c++)i.push(new Date(2e3,c,15));return i}function MA(i,c=void 0){const p=new Intl.DateTimeFormat(c,{month:i,timeZone:"UTC"});return zP().map(y=>p.format(y))}function K9(i,c,p){return Oo(c)?c===i:uo(c)?c.includes(i):Du(c)?c(i,p):!(c.min!=null&&c.min>i||c.max!=null&&c.max<i||c.interval!=null&&i%c.interval!==0)}function Cp(i,c,p){const y=[],[T,M,C]=c;for(let R=T;R<=M;R++)(p==null||K9(R,p,i))&&y.push({value:R,label:si(R,C)});return y}function J9(i,c){return{milliseconds:Cp(i,Ip.milliseconds,c.milliseconds),seconds:Cp(i,Ip.seconds,c.seconds),minutes:Cp(i,Ip.minutes,c.minutes),hours:Cp(i,Ip.hours,c.hours)}}function Q9(i,c,p,y){const M=Cp(i,c,y).reduce((C,R)=>{if(R.disabled)return C;if(isNaN(C))return R.value;const o=Math.abs(C-p);return Math.abs(R.value-p)<o?R.value:C},NaN);return isNaN(M)?p:M}function eX(i,c){const p={...i};return Object.entries(c).forEach(([y,T])=>{const M=Ip[y],C=i[y];p[y]=Q9(i,M,C,T)}),p}function EA(i,c,p){return LP(c,p).map(T=>{if(typeof T!="string")throw new Error("Invalid mask");let M=i;if(M.length>1e3)return!1;let C=!0;const R={};if(T.replace(DP,$=>{if(li[$]){const H=li[$],ie=M.search(H[0]);~ie?M.replace(H[0],oe=>(H[1](R,oe,p),M=M.substr(ie+oe.length),oe)):C=!1}return li[$]?"":$.slice(1,$.length-1)}),!C)return!1;const o=new Date;R.hours!=null&&(R.isPm===!0&&+R.hours!=12?R.hours=+R.hours+12:R.isPm===!1&&+R.hours==12&&(R.hours=0));let B;return R.timezoneOffset!=null?(R.minutes=+(R.minutes||0)-+R.timezoneOffset,B=new Date(Date.UTC(R.year||o.getFullYear(),R.month||0,R.day||1,R.hours||0,R.minutes||0,R.seconds||0,R.milliseconds||0))):B=p.getDateFromParts({year:R.year||o.getFullYear(),month:(R.month||0)+1,day:R.day||1,hours:R.hours||0,minutes:R.minutes||0,seconds:R.seconds||0,milliseconds:R.milliseconds||0}),B}).find(T=>T)||new Date(i)}function tX(i,c,p){if(i==null)return"";let y=LP(c,p)[0];/Z$/.test(y)&&(p.timezone="utc");const T=[];y=y.replace(V9,(C,R)=>(T.push(R),"??"));const M=p.getDateParts(i);return y=y.replace(DP,C=>C in bA?bA[C](M,p):C.slice(1,C.length-1)),y.replace(/\?\?/g,()=>T.shift())}let rX=0;class FP{constructor(c,p,y){$r(this,"key",""),$r(this,"hashcode",""),$r(this,"highlight",null),$r(this,"content",null),$r(this,"dot",null),$r(this,"bar",null),$r(this,"event",null),$r(this,"popover",null),$r(this,"customData",null),$r(this,"ranges"),$r(this,"hasRanges",!1),$r(this,"order",0),$r(this,"pinPage",!1),$r(this,"maxRepeatSpan",0),$r(this,"locale");const{dates:T}=Object.assign(this,{hashcode:"",order:0,pinPage:!1},c);this.key||(this.key=++rX),this.locale=y,p.normalizeGlyphs(this),this.ranges=y.ranges(T??[]),this.hasRanges=!!Wa(this.ranges),this.maxRepeatSpan=this.ranges.filter(M=>M.hasRepeat).map(M=>M.daySpan).reduce((M,C)=>Math.max(M,C),0)}intersectsRange({start:c,end:p}){if(c==null||p==null)return!1;const y=this.ranges.filter(C=>!C.hasRepeat);for(const C of y)if(C.intersectsDayRange(c.dayIndex,p.dayIndex))return!0;const T=this.ranges.filter(C=>C.hasRepeat);if(!T.length)return!1;let M=c;for(this.maxRepeatSpan>1&&(M=this.locale.getDateParts(ws(M.date,-this.maxRepeatSpan)));M.dayIndex<=p.dayIndex;){for(const C of T)if(C.startsOnDay(M))return!0;M=this.locale.getDateParts(ws(M.date,1))}return!1}}function Cx(i){document&&document.dispatchEvent(new CustomEvent("show-popover",{detail:i}))}function em(i){document&&document.dispatchEvent(new CustomEvent("hide-popover",{detail:i}))}function BP(i){document&&document.dispatchEvent(new CustomEvent("toggle-popover",{detail:i}))}function NP(i){const{visibility:c}=i,p=c==="click",y=c==="hover",T=c==="hover-focus",M=c==="focus";i.autoHide=!p;let C=!1,R=!1;const o=_e=>{p&&(BP({...i,target:i.target||_e.currentTarget}),_e.stopPropagation())},B=_e=>{C||(C=!0,(y||T)&&Cx({...i,target:i.target||_e.currentTarget}))},$=()=>{C&&(C=!1,(y||T&&!R)&&em(i))},H=_e=>{R||(R=!0,(M||T)&&Cx({...i,target:i.target||_e.currentTarget}))},ie=_e=>{R&&!Ag(_e.currentTarget,_e.relatedTarget)&&(R=!1,(M||T&&!C)&&em(i))},oe={};switch(i.visibility){case"click":oe.click=o;break;case"hover":oe.mousemove=B,oe.mouseleave=$;break;case"focus":oe.focusin=H,oe.focusout=ie;break;case"hover-focus":oe.mousemove=B,oe.mouseleave=$,oe.focusin=H,oe.focusout=ie;break}return oe}const AA=i=>{const c=jg(i);if(c==null)return;const p=c.popoverHandlers;!p||!p.length||(p.forEach(y=>y()),delete c.popoverHandlers)},IA=(i,c)=>{const p=jg(i);if(p==null)return;const y=[],T=NP(c);Object.entries(T).forEach(([M,C])=>{y.push(ic(p,M,C))}),p.popoverHandlers=y},VP={mounted(i,c){const{value:p}=c;p&&IA(i,p)},updated(i,c){const{oldValue:p,value:y}=c,T=p==null?void 0:p.visibility,M=y==null?void 0:y.visibility;T!==M&&(T&&(AA(i),M||em(p)),M&&IA(i,y))},unmounted(i){AA(i)}},nX=(i,c,{maxSwipeTime:p,minHorizontalSwipeDistance:y,maxVerticalSwipeDistance:T})=>{if(!i||!i.addEventListener||!Du(c))return null;let M=0,C=0,R=null,o=!1;function B(H){const ie=H.changedTouches[0];M=ie.screenX,C=ie.screenY,R=new Date().getTime(),o=!0}function $(H){if(!o||!R)return;o=!1;const ie=H.changedTouches[0],oe=ie.screenX-M,_e=ie.screenY-C;if(new Date().getTime()-R<p&&Math.abs(oe)>=y&&Math.abs(_e)<=T){const Re={toLeft:!1,toRight:!1};oe<0?Re.toLeft=!0:Re.toRight=!0,c(Re)}}return ic(i,"touchstart",B,{passive:!0}),ic(i,"touchend",$,{passive:!0}),()=>{nc(i,"touchstart",B),nc(i,"touchend",$)}},Pg={},iX=(i,c=10)=>{Pg[i]=Date.now()+c},sX=(i,c)=>{if(i in Pg){const p=Pg[i];if(Date.now()<p)return;delete Pg[i]}c()};function $P(){return typeof window<"u"}function oX(i){return $P()&&i in window}function aX(i){const c=Zr(!1),p=rt(()=>c.value?"dark":"light");let y,T;function M(oe){c.value=oe.matches}function C(){oX("matchMedia")&&(y=window.matchMedia("(prefers-color-scheme: dark)"),y.addEventListener("change",M),c.value=y.matches)}function R(){const{selector:oe=":root",darkClass:_e="dark"}=i.value,Me=document.querySelector(oe);c.value=Me.classList.contains(_e)}function o(oe){const{selector:_e=":root",darkClass:Me="dark"}=oe;if($P()&&_e&&Me){const Re=document.querySelector(_e);Re&&(T=new MutationObserver(R),T.observe(Re,{attributes:!0,attributeFilter:["class"]}),c.value=Re.classList.contains(Me))}}function B(){H();const oe=typeof i.value;oe==="string"&&i.value.toLowerCase()==="system"?C():oe==="object"?o(i.value):c.value=!!i.value}const $=Oi(()=>i.value,()=>B(),{immediate:!0});function H(){y&&(y.removeEventListener("change",M),y=void 0),T&&(T.disconnect(),T=void 0)}function ie(){H(),$()}return nm(()=>ie()),{isDark:c,displayMode:p,cleanup:ie}}const lX=["base","start","end","startEnd"],cX=["class","wrapperClass","contentClass","style","contentStyle","color","fillMode"],uX={base:{},start:{},end:{}};function R1(i,c,p=uX){let y=i,T={};c===!0||fa(c)?(y=fa(c)?c:y,T={...p}):el(c)&&(lA(c,lX)?T={...c}:T={base:{...c},start:{...c},end:{...c}});const M=Qp(T,{start:T.startEnd,end:T.startEnd},p);return Object.entries(M).forEach(([C,R])=>{let o=y;R===!0||fa(R)?(o=fa(R)?R:o,M[C]={color:o}):el(R)&&(lA(R,cX)?M[C]={...R}:M[C]={}),Qp(M[C],{color:o})}),M}class hX{constructor(){$r(this,"type","highlight")}normalizeConfig(c,p){return R1(c,p,{base:{fillMode:"light"},start:{fillMode:"solid"},end:{fillMode:"solid"}})}prepareRender(c){c.highlights=[],c.content||(c.content=[])}render({data:c,onStart:p,onEnd:y},T){const{key:M,highlight:C}=c;if(!C)return;const{highlights:R}=T,{base:o,start:B,end:$}=C;p&&y?R.push({...B,key:M,wrapperClass:`vc-day-layer vc-day-box-center-center vc-attr vc-${B.color}`,class:[`vc-highlight vc-highlight-bg-${B.fillMode}`,B.class],contentClass:[`vc-attr vc-highlight-content-${B.fillMode} vc-${B.color}`,B.contentClass]}):p?(R.push({...o,key:`${M}-base`,wrapperClass:`vc-day-layer vc-day-box-right-center vc-attr vc-${o.color}`,class:[`vc-highlight vc-highlight-base-start vc-highlight-bg-${o.fillMode}`,o.class]}),R.push({...B,key:M,wrapperClass:`vc-day-layer vc-day-box-center-center vc-attr vc-${B.color}`,class:[`vc-highlight vc-highlight-bg-${B.fillMode}`,B.class],contentClass:[`vc-attr vc-highlight-content-${B.fillMode} vc-${B.color}`,B.contentClass]})):y?(R.push({...o,key:`${M}-base`,wrapperClass:`vc-day-layer vc-day-box-left-center vc-attr vc-${o.color}`,class:[`vc-highlight vc-highlight-base-end vc-highlight-bg-${o.fillMode}`,o.class]}),R.push({...$,key:M,wrapperClass:`vc-day-layer vc-day-box-center-center vc-attr vc-${$.color}`,class:[`vc-highlight vc-highlight-bg-${$.fillMode}`,$.class],contentClass:[`vc-attr vc-highlight-content-${$.fillMode} vc-${$.color}`,$.contentClass]})):R.push({...o,key:`${M}-middle`,wrapperClass:`vc-day-layer vc-day-box-center-center vc-attr vc-${o.color}`,class:[`vc-highlight vc-highlight-base-middle vc-highlight-bg-${o.fillMode}`,o.class],contentClass:[`vc-attr vc-highlight-content-${o.fillMode} vc-${o.color}`,o.contentClass]})}}class k1{constructor(c,p){$r(this,"type",""),$r(this,"collectionType",""),this.type=c,this.collectionType=p}normalizeConfig(c,p){return R1(c,p)}prepareRender(c){c[this.collectionType]=[]}render({data:c,onStart:p,onEnd:y},T){const{key:M}=c,C=c[this.type];if(!M||!C)return;const R=T[this.collectionType],{base:o,start:B,end:$}=C;p?R.push({...B,key:M,class:[`vc-${this.type} vc-${this.type}-start vc-${B.color} vc-attr`,B.class]}):y?R.push({...$,key:M,class:[`vc-${this.type} vc-${this.type}-end vc-${$.color} vc-attr`,$.class]}):R.push({...o,key:M,class:[`vc-${this.type} vc-${this.type}-base vc-${o.color} vc-attr`,o.class]})}}class dX extends k1{constructor(){super("content","content")}normalizeConfig(c,p){return R1("base",p)}}class fX extends k1{constructor(){super("dot","dots")}}class pX extends k1{constructor(){super("bar","bars")}}class mX{constructor(c){$r(this,"color"),$r(this,"renderers",[new dX,new hX,new fX,new pX]),this.color=c}normalizeGlyphs(c){this.renderers.forEach(p=>{const y=p.type;c[y]!=null&&(c[y]=p.normalizeConfig(this.color,c[y]))})}prepareRender(c={}){return this.renderers.forEach(p=>{p.prepareRender(c)}),c}render(c,p){this.renderers.forEach(y=>{y.render(c,p)})}}const UP=Symbol("__vc_base_context__"),jP={color:{type:String,default:()=>dc("color")},isDark:{type:[Boolean,String,Object],default:()=>dc("isDark")},firstDayOfWeek:Number,masks:Object,locale:[String,Object],timezone:String,minDate:null,maxDate:null,disabledDates:null};function GP(i){const c=rt(()=>i.color??""),p=rt(()=>i.isDark??!1),{displayMode:y}=aX(p),T=rt(()=>new mX(c.value)),M=rt(()=>{if(i.locale instanceof Zg)return i.locale;const ie=el(i.locale)?i.locale:{id:i.locale,firstDayOfWeek:i.firstDayOfWeek,masks:i.masks};return new Zg(ie,i.timezone)}),C=rt(()=>M.value.masks),R=rt(()=>i.minDate),o=rt(()=>i.maxDate),B=rt(()=>{const ie=i.disabledDates?[...i.disabledDates]:[];return R.value!=null&&ie.push({start:null,end:ws(M.value.toDate(R.value),-1)}),o.value!=null&&ie.push({start:ws(M.value.toDate(o.value),1),end:null}),M.value.ranges(ie)}),$=rt(()=>new FP({key:"disabled",dates:B.value,order:100},T.value,M.value)),H={color:c,isDark:p,displayMode:y,theme:T,locale:M,masks:C,minDate:R,maxDate:o,disabledDates:B,disabledAttribute:$};return Xa(UP,H),H}function _X(i){return fs(UP,()=>GP(i),!0)}function HP(i){return`__vc_slot_${i}__`}function qP(i,c={}){Object.keys(i).forEach(p=>{Xa(HP(c[p]??p),i[p])})}function WP(i){return fs(HP(i),null)}const gX={...jP,view:{type:String,default:"monthly",validator(i){return["daily","weekly","monthly"].includes(i)}},rows:{type:Number,default:1},columns:{type:Number,default:1},step:Number,titlePosition:{type:String,default:()=>dc("titlePosition")},navVisibility:{type:String,default:()=>dc("navVisibility")},showWeeknumbers:[Boolean,String],showIsoWeeknumbers:[Boolean,String],expanded:Boolean,borderless:Boolean,transparent:Boolean,initialPage:Object,initialPagePosition:{type:Number,default:1},minPage:Object,maxPage:Object,transition:String,attributes:Array,trimWeeks:Boolean,disablePageSwipe:Boolean},yX=["dayclick","daymouseenter","daymouseleave","dayfocusin","dayfocusout","daykeydown","weeknumberclick","transition-start","transition-end","did-move","update:view","update:pages"],YP=Symbol("__vc_calendar_context__");function vX(i,{slots:c,emit:p}){const y=Zr(null),T=Zr(null),M=Zr(new Date().getDate()),C=Zr(!1),R=Zr(Symbol()),o=Zr(Symbol()),B=Zr(i.view),$=Zr([]),H=Zr("");let ie=null,oe=null;qP(c);const{theme:_e,color:Me,displayMode:Re,locale:Ee,masks:mt,minDate:gt,maxDate:dt,disabledAttribute:ut,disabledDates:ht}=_X(i),lt=rt(()=>i.rows*i.columns),Qe=rt(()=>i.step||lt.value),Se=rt(()=>_P($.value)??null),Xt=rt(()=>Vh($.value)??null),xr=rt(()=>i.minPage||(gt.value?nr(gt.value):null)),Ve=rt(()=>i.maxPage||(dt.value?nr(dt.value):null)),jt=rt(()=>i.navVisibility),Ur=rt(()=>!!i.showWeeknumbers),$e=rt(()=>!!i.showIsoWeeknumbers),ur=rt(()=>B.value==="monthly"),gr=rt(()=>B.value==="weekly"),zt=rt(()=>B.value==="daily"),vn=()=>{C.value=!0,p("transition-start")},Ft=()=>{C.value=!1,p("transition-end"),ie&&(ie.resolve(!0),ie=null)},zr=(Pe,ue,Je=B.value)=>TP(Pe,ue,Je,Ee.value),nr=Pe=>wP(Pe,B.value,Ee.value),En=Pe=>{!ut.value||!Gt.value||(Pe.isDisabled=Gt.value.cellExists(ut.value.key,Pe.dayIndex))},dn=Pe=>{Pe.isFocusable=Pe.inMonth&&Pe.day===M.value},Bn=(Pe,ue)=>{for(const Je of Pe)for(const Ot of Je.days)if(ue(Ot)===!1)return},bn=rt(()=>$.value.reduce((Pe,ue)=>(Pe.push(...ue.viewDays),Pe),[])),it=rt(()=>{const Pe=[];return(i.attributes||[]).forEach((ue,Je)=>{!ue||!ue.dates||Pe.push(new FP({...ue,order:ue.order||0},_e.value,Ee.value))}),ut.value&&Pe.push(ut.value),Pe}),Kt=rt(()=>Wa(it.value)),Gt=rt(()=>{const Pe=new e9;return it.value.forEach(ue=>{ue.ranges.forEach(Je=>{Pe.render(ue,Je,bn.value)})}),Pe}),ir=rt(()=>bn.value.reduce((Pe,ue)=>(Pe[ue.dayIndex]={day:ue,cells:[]},Pe[ue.dayIndex].cells.push(...Gt.value.getCells(ue)),Pe),{})),Vr=(Pe,ue)=>{const Je=i.showWeeknumbers||i.showIsoWeeknumbers;return Je==null?"":SW(Je)?Je?"left":"":Je.startsWith("right")?ue>1?"right":Je:Pe>1?"left":Je},Kr=()=>{var Pe,ue;if(!Kt.value)return null;const Je=it.value.find(Sr=>Sr.pinPage)||it.value[0];if(!Je||!Je.hasRanges)return null;const[Ot]=Je.ranges,hr=((Pe=Ot.start)==null?void 0:Pe.date)||((ue=Ot.end)==null?void 0:ue.date);return hr?nr(hr):null},pe=()=>{if(pa(Se.value))return Se.value;const Pe=Kr();return pa(Pe)?Pe:nr(new Date)},ye=(Pe,ue={})=>{const{view:Je=B.value,position:Ot=1,force:hr}=ue,Sr=Ot>0?1-Ot:-(lt.value+Ot);let Rr=zr(Pe,Sr,Je),Hr=zr(Rr,lt.value-1,Je);return hr||(Ex(Rr,xr.value)?Rr=xr.value:Yg(Hr,Ve.value)&&(Rr=zr(Ve.value,1-lt.value)),Hr=zr(Rr,lt.value-1)),{fromPage:Rr,toPage:Hr}},qe=(Pe,ue,Je="")=>{if(Je==="none"||Je==="fade")return Je;if((Pe==null?void 0:Pe.view)!==(ue==null?void 0:ue.view))return"fade";const Ot=Yg(ue,Pe),hr=Ex(ue,Pe);return!Ot&&!hr?"fade":Je==="slide-v"?hr?"slide-down":"slide-up":hr?"slide-right":"slide-left"},ft=(Pe={})=>new Promise((ue,Je)=>{const{position:Ot=1,force:hr=!1,transition:Sr}=Pe,Rr=pa(Pe.page)?Pe.page:pe(),{fromPage:Hr}=ye(Rr,{position:Ot,force:hr}),Tn=[];for(let Qn=0;Qn<lt.value;Qn++){const An=zr(Hr,Qn),Vn=Qn+1,bi=Math.ceil(Vn/i.columns),Ci=i.rows-bi+1,Wn=Vn%i.columns||i.columns,jn=i.columns-Wn+1,He=Vr(Wn,jn);Tn.push(Ee.value.getPage({...An,view:B.value,titlePosition:i.titlePosition,trimWeeks:i.trimWeeks,position:Vn,row:bi,rowFromEnd:Ci,column:Wn,columnFromEnd:jn,showWeeknumbers:Ur.value,showIsoWeeknumbers:$e.value,weeknumberPosition:He}))}H.value=qe($.value[0],Tn[0],Sr),$.value=Tn,H.value&&H.value!=="none"?ie={resolve:ue,reject:Je}:ue(!0)}),ct=Pe=>{const ue=Se.value??nr(new Date);return zr(ue,Pe)},Bt=(Pe,ue={})=>{const Je=pa(Pe)?Pe:nr(Pe);return Object.assign(ue,ye(Je,{...ue,force:!0})),K7(ue.fromPage,ue.toPage,B.value,Ee.value).map(hr=>Z7(hr,xr.value,Ve.value)).some(hr=>hr)},tr=(Pe,ue={})=>Bt(ct(Pe),ue),vt=rt(()=>tr(-Qe.value)),Yt=rt(()=>tr(Qe.value)),Pt=async(Pe,ue={})=>!ue.force&&!Bt(Pe,ue)?!1:(ue.fromPage&&!X7(ue.fromPage,Se.value)&&(em({id:R.value,hideDelay:0}),ue.view&&(iX("view",10),B.value=ue.view),await ft({...ue,page:ue.fromPage,position:1,force:!0}),p("did-move",$.value)),!0),rr=(Pe,ue={})=>Pt(ct(Pe),ue),br=()=>rr(-Qe.value),yr=()=>rr(Qe.value),Ie=Pe=>{const ue=ur.value?".in-month":"",Je=`.id-${Ee.value.getDayId(Pe)}${ue}`,Ot=`${Je}.vc-focusable, ${Je} .vc-focusable`,hr=y.value;if(hr){const Sr=hr.querySelector(Ot);if(Sr)return Sr.focus(),!0}return!1},Z=async(Pe,ue={})=>Ie(Pe)?!0:(await Pt(Pe,ue),Ie(Pe)),te=(Pe,ue)=>{M.value=Pe.day,p("dayclick",Pe,ue)},he=(Pe,ue)=>{p("daymouseenter",Pe,ue)},ke=(Pe,ue)=>{p("daymouseleave",Pe,ue)},We=(Pe,ue)=>{M.value=Pe.day,T.value=Pe,Pe.isFocused=!0,p("dayfocusin",Pe,ue)},nt=(Pe,ue)=>{T.value=null,Pe.isFocused=!1,p("dayfocusout",Pe,ue)},Ut=(Pe,ue)=>{p("daykeydown",Pe,ue);const Je=Pe.noonDate;let Ot=null;switch(ue.key){case"ArrowLeft":{Ot=ws(Je,-1);break}case"ArrowRight":{Ot=ws(Je,1);break}case"ArrowUp":{Ot=ws(Je,-7);break}case"ArrowDown":{Ot=ws(Je,7);break}case"Home":{Ot=ws(Je,-Pe.weekdayPosition+1);break}case"End":{Ot=ws(Je,Pe.weekdayPositionFromEnd);break}case"PageUp":{ue.altKey?Ot=yA(Je,-1):Ot=Wg(Je,-1);break}case"PageDown":{ue.altKey?Ot=yA(Je,1):Ot=Wg(Je,1);break}}Ot&&(ue.preventDefault(),Z(Ot).catch())},Ge=Pe=>{const ue=T.value;ue!=null&&Ut(ue,Pe)},Ht=(Pe,ue)=>{p("weeknumberclick",Pe,ue)};ft({page:i.initialPage,position:i.initialPagePosition}),ya(()=>{!i.disablePageSwipe&&y.value&&(oe=nX(y.value,({toLeft:Pe=!1,toRight:ue=!1})=>{Pe?yr():ue&&br()},dc("touch")))}),nm(()=>{$.value=[],oe&&oe()}),Oi(()=>Ee.value,()=>{ft()}),Oi(()=>lt.value,()=>ft()),Oi(()=>i.view,()=>B.value=i.view),Oi(()=>B.value,()=>{sX("view",()=>{ft()}),p("update:view",B.value)}),Oi(()=>M.value,()=>{Bn($.value,Pe=>dn(Pe))}),dI(()=>{p("update:pages",$.value),Bn($.value,Pe=>{En(Pe),dn(Pe)})});const Et={emit:p,containerRef:y,focusedDay:T,inTransition:C,navPopoverId:R,dayPopoverId:o,view:B,pages:$,transitionName:H,theme:_e,color:Me,displayMode:Re,locale:Ee,masks:mt,attributes:it,disabledAttribute:ut,disabledDates:ht,attributeContext:Gt,days:bn,dayCells:ir,count:lt,step:Qe,firstPage:Se,lastPage:Xt,canMovePrev:vt,canMoveNext:Yt,minPage:xr,maxPage:Ve,isMonthly:ur,isWeekly:gr,isDaily:zt,navVisibility:jt,showWeeknumbers:Ur,showIsoWeeknumbers:$e,getDateAddress:nr,canMove:Bt,canMoveBy:tr,move:Pt,moveBy:rr,movePrev:br,moveNext:yr,onTransitionBeforeEnter:vn,onTransitionAfterEnter:Ft,tryFocusDate:Ie,focusDate:Z,onKeydown:Ge,onDayKeydown:Ut,onDayClick:te,onDayMouseenter:he,onDayMouseleave:ke,onDayFocusin:We,onDayFocusout:nt,onWeeknumberClick:Ht};return Xa(YP,Et),Et}function Ru(){const i=fs(YP);if(i)return i;throw new Error("Calendar context missing. Please verify this component is nested within a valid context provider.")}const xX=Gi({inheritAttrs:!1,emits:["before-show","after-show","before-hide","after-hide"],props:{id:{type:[Number,String,Symbol],required:!0},showDelay:{type:Number,default:0},hideDelay:{type:Number,default:110},boundarySelector:{type:String}},setup(i,{emit:c}){let p;const y=Zr();let T=null,M=null;const C=Xs({isVisible:!1,target:null,data:null,transition:"slide-fade",placement:"bottom",direction:"",positionFixed:!1,modifiers:[],isInteractive:!0,visibility:"click",isHovered:!1,isFocused:!1,autoHide:!1,force:!1});function R(Ft){Ft&&(C.direction=Ft.split("-")[0])}function o({placement:Ft,options:zr}){R(Ft||(zr==null?void 0:zr.placement))}const B=rt(()=>({placement:C.placement,strategy:C.positionFixed?"fixed":"absolute",boundary:"",modifiers:[{name:"onUpdate",enabled:!0,phase:"afterWrite",fn:o},...C.modifiers||[]],onFirstUpdate:o})),$=rt(()=>{const Ft=C.direction==="left"||C.direction==="right";let zr="";if(C.placement){const nr=C.placement.split("-");nr.length>1&&(zr=nr[1])}return["start","top","left"].includes(zr)?Ft?"top":"left":["end","bottom","right"].includes(zr)?Ft?"bottom":"right":Ft?"middle":"center"});function H(){M&&(M.destroy(),M=null)}function ie(){qa(()=>{const Ft=jg(C.target);!Ft||!y.value||(M&&M.state.elements.reference!==Ft&&H(),M?M.update():M=f6(Ft,y.value,B.value))})}function oe(Ft){Object.assign(C,yP(Ft,"force"))}function _e(Ft,zr){clearTimeout(p),Ft>0?p=setTimeout(zr,Ft):zr()}function Me(Ft){return!Ft||!M?!1:jg(Ft)===M.state.elements.reference}async function Re(Ft={}){C.force||(Ft.force&&(C.force=!0),_e(Ft.showDelay??i.showDelay,()=>{C.isVisible&&(C.force=!1),oe({...Ft,isVisible:!0}),ie()}))}function Ee(Ft={}){M&&(Ft.target&&!Me(Ft.target)||C.force||(Ft.force&&(C.force=!0),_e(Ft.hideDelay??i.hideDelay,()=>{C.isVisible||(C.force=!1),C.isVisible=!1})))}function mt(Ft={}){Ft.target!=null&&(C.isVisible&&Me(Ft.target)?Ee(Ft):Re(Ft))}function gt(Ft){if(!M)return;const zr=M.state.elements.reference;if(!y.value||!zr)return;const nr=Ft.target;Ag(y.value,nr)||Ag(zr,nr)||Ee({force:!0})}function dt(Ft){(Ft.key==="Esc"||Ft.key==="Escape")&&Ee()}function ut({detail:Ft}){!Ft.id||Ft.id!==i.id||Re(Ft)}function ht({detail:Ft}){!Ft.id||Ft.id!==i.id||Ee(Ft)}function lt({detail:Ft}){!Ft.id||Ft.id!==i.id||mt(Ft)}function Qe(){ic(document,"keydown",dt),ic(document,"click",gt),ic(document,"show-popover",ut),ic(document,"hide-popover",ht),ic(document,"toggle-popover",lt)}function Se(){nc(document,"keydown",dt),nc(document,"click",gt),nc(document,"show-popover",ut),nc(document,"hide-popover",ht),nc(document,"toggle-popover",lt)}function Xt(Ft){c("before-show",Ft)}function xr(Ft){C.force=!1,c("after-show",Ft)}function Ve(Ft){c("before-hide",Ft)}function jt(Ft){C.force=!1,H(),c("after-hide",Ft)}function Ur(Ft){Ft.stopPropagation()}function $e(){C.isHovered=!0,C.isInteractive&&["hover","hover-focus"].includes(C.visibility)&&Re()}function ur(){if(C.isHovered=!1,!M)return;const Ft=M.state.elements.reference;C.autoHide&&!C.isFocused&&(!Ft||Ft!==document.activeElement)&&["hover","hover-focus"].includes(C.visibility)&&Ee()}function gr(){C.isFocused=!0,C.isInteractive&&["focus","hover-focus"].includes(C.visibility)&&Re()}function zt(Ft){["focus","hover-focus"].includes(C.visibility)&&(!Ft.relatedTarget||!Ag(y.value,Ft.relatedTarget))&&(C.isFocused=!1,!C.isHovered&&C.autoHide&&Ee())}function vn(){T!=null&&(T.disconnect(),T=null)}return Oi(()=>y.value,Ft=>{vn(),Ft&&(T=new ResizeObserver(()=>{M&&M.update()}),T.observe(Ft))}),Oi(()=>C.placement,R,{immediate:!0}),ya(()=>{Qe()}),nm(()=>{H(),vn(),Se()}),{...nI(C),popoverRef:y,alignment:$,hide:Ee,setupPopper:ie,beforeEnter:Xt,afterEnter:xr,beforeLeave:Ve,afterLeave:jt,onClick:Ur,onMouseOver:$e,onMouseLeave:ur,onFocusIn:gr,onFocusOut:zt}}}),gc=(i,c)=>{const p=i.__vccOpts||i;for(const[y,T]of c)p[y]=T;return p};function bX(i,c,p,y,T,M){return It(),Wt("div",{class:Rn(["vc-popover-content-wrapper",{"is-interactive":i.isInteractive}]),ref:"popoverRef",onClick:c[0]||(c[0]=(...C)=>i.onClick&&i.onClick(...C)),onMouseover:c[1]||(c[1]=(...C)=>i.onMouseOver&&i.onMouseOver(...C)),onMouseleave:c[2]||(c[2]=(...C)=>i.onMouseLeave&&i.onMouseLeave(...C)),onFocusin:c[3]||(c[3]=(...C)=>i.onFocusIn&&i.onFocusIn(...C)),onFocusout:c[4]||(c[4]=(...C)=>i.onFocusOut&&i.onFocusOut(...C))},[_r(hy,{name:`vc-${i.transition}`,appear:"",onBeforeEnter:i.beforeEnter,onAfterEnter:i.afterEnter,onBeforeLeave:i.beforeLeave,onAfterLeave:i.afterLeave},{default:Ai(()=>[i.isVisible?(It(),Wt("div",mc({key:0,tabindex:"-1",class:`vc-popover-content direction-${i.direction}`},i.$attrs),[od(i.$slots,"default",{direction:i.direction,alignment:i.alignment,data:i.data,hide:i.hide},()=>[im(Mi(i.data),1)]),Ue("span",{class:Rn(["vc-popover-caret",`direction-${i.direction}`,`align-${i.alignment}`])},null,2)],16)):Ei("",!0)]),_:3},8,["name","onBeforeEnter","onAfterEnter","onBeforeLeave","onAfterLeave"])],34)}const O1=gc(xX,[["render",bX]]),wX={class:"vc-day-popover-row"},TX={key:0,class:"vc-day-popover-row-indicator"},SX={class:"vc-day-popover-row-label"},MX=Gi({__name:"PopoverRow",props:{attribute:null},setup(i){const c=i,p=rt(()=>{const{content:y,highlight:T,dot:M,bar:C,popover:R}=c.attribute;return R&&R.hideIndicator?null:y?{class:`vc-bar vc-day-popover-row-bar vc-attr vc-${y.base.color}`}:T?{class:`vc-highlight-bg-solid vc-day-popover-row-highlight vc-attr vc-${T.base.color}`}:M?{class:`vc-dot vc-attr vc-${M.base.color}`}:C?{class:`vc-bar vc-day-popover-row-bar vc-attr vc-${C.base.color}`}:null});return(y,T)=>(It(),Wt("div",wX,[yt(p)?(It(),Wt("div",TX,[Ue("span",{class:Rn(yt(p).class)},null,2)])):Ei("",!0),Ue("div",SX,[od(y.$slots,"default",{},()=>[im(Mi(i.attribute.popover?i.attribute.popover.label:"No content provided"),1)])])]))}}),EX={inheritAttrs:!1},so=Gi({...EX,__name:"CalendarSlot",props:{name:null},setup(i){const p=WP(i.name);return(y,T)=>yt(p)?(It(),rs(hI(yt(p)),Dp(mc({key:0},y.$attrs)),null,16)):od(y.$slots,"default",{key:1})}}),AX={class:"vc-day-popover-container"},IX={key:0,class:"vc-day-popover-header"},CX=Gi({__name:"CalendarDayPopover",setup(i){const{dayPopoverId:c,displayMode:p,color:y,masks:T,locale:M}=Ru();function C(o,B){return M.value.formatDate(o,B)}function R(o){return M.value.formatDate(o.date,T.value.dayPopover)}return(o,B)=>(It(),rs(O1,{id:yt(c),class:Rn([`vc-${yt(y)}`,`vc-${yt(p)}`])},{default:Ai(({data:{day:$,attributes:H},hide:ie})=>[_r(so,{name:"day-popover",day:$,"day-title":R($),attributes:H,format:C,masks:yt(T),hide:ie},{default:Ai(()=>[Ue("div",AX,[yt(T).dayPopover?(It(),Wt("div",IX,Mi(R($)),1)):Ei("",!0),(It(!0),Wt(Mn,null,Xi(H,oe=>(It(),rs(MX,{key:oe.key,attribute:oe},null,8,["attribute"]))),128))])]),_:2},1032,["day","day-title","attributes","masks","hide"])]),_:1},8,["id","class"]))}}),PX={},DX={"stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},LX=Ue("polyline",{points:"9 18 15 12 9 6"},null,-1),RX=[LX];function kX(i,c){return It(),Wt("svg",DX,RX)}const OX=gc(PX,[["render",kX]]),zX={},FX={"stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},BX=Ue("polyline",{points:"15 18 9 12 15 6"},null,-1),NX=[BX];function VX(i,c){return It(),Wt("svg",FX,NX)}const $X=gc(zX,[["render",VX]]),UX={},jX={"stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},GX=Ue("polyline",{points:"6 9 12 15 18 9"},null,-1),HX=[GX];function qX(i,c){return It(),Wt("svg",jX,HX)}const WX=gc(UX,[["render",qX]]),YX={},ZX={fill:"none","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24"},XX=Ue("path",{d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1),KX=[XX];function JX(i,c){return It(),Wt("svg",ZX,KX)}const QX=gc(YX,[["render",JX]]),eK=Object.freeze(Object.defineProperty({__proto__:null,IconChevronDown:WX,IconChevronLeft:$X,IconChevronRight:OX,IconClock:QX},Symbol.toStringTag,{value:"Module"})),id=Gi({__name:"BaseIcon",props:{name:{type:String,required:!0},width:{type:String},height:{type:String},size:{type:String,default:"26"},viewBox:{type:String}},setup(i){const c=i,p=rt(()=>c.width||c.size),y=rt(()=>c.height||c.size),T=rt(()=>eK[`Icon${c.name}`]);return(M,C)=>(It(),rs(hI(yt(T)),{width:yt(p),height:yt(y),class:"vc-base-icon"},null,8,["width","height"]))}}),tK=["disabled"],rK={key:1,class:"vc-title-wrapper"},nK={type:"button",class:"vc-title"},iK=["disabled"],ZP=Gi({__name:"CalendarHeader",props:{page:null,layout:null,isLg:{type:Boolean},isXl:{type:Boolean},is2xl:{type:Boolean},hideTitle:{type:Boolean},hideArrows:{type:Boolean}},setup(i){const c=i,{navPopoverId:p,navVisibility:y,canMovePrev:T,movePrev:M,canMoveNext:C,moveNext:R}=Ru(),o=rt(()=>{switch(c.page.titlePosition){case"left":return"bottom-start";case"right":return"bottom-end";default:return"bottom"}}),B=rt(()=>{const{page:Me}=c;return{id:p.value,visibility:y.value,placement:o.value,modifiers:[{name:"flip",options:{fallbackPlacements:["bottom"]}}],data:{page:Me},isInteractive:!0}}),$=rt(()=>c.page.titlePosition.includes("left")),H=rt(()=>c.page.titlePosition.includes("right")),ie=rt(()=>c.layout?c.layout:$.value?"tu-pn":H.value?"pn-tu":"p-tu-n;"),oe=rt(()=>({prev:ie.value.includes("p")&&!c.hideArrows,title:ie.value.includes("t")&&!c.hideTitle,next:ie.value.includes("n")&&!c.hideArrows})),_e=rt(()=>({gridTemplateColumns:ie.value.split("").map(Re=>{switch(Re){case"p":return"[prev] auto";case"n":return"[next] auto";case"t":return"[title] auto";case"-":return"1fr";default:return""}}).join(" ")}));return(Me,Re)=>(It(),Wt("div",{class:Rn(["vc-header",{"is-lg":i.isLg,"is-xl":i.isXl,"is-2xl":i.is2xl}]),style:Ya(yt(_e))},[yt(oe).prev?(It(),Wt("button",{key:0,type:"button",class:"vc-arrow vc-prev vc-focus",disabled:!yt(T),onClick:Re[0]||(Re[0]=(...Ee)=>yt(M)&&yt(M)(...Ee)),onKeydown:Re[1]||(Re[1]=DM((...Ee)=>yt(M)&&yt(M)(...Ee),["space","enter"]))},[_r(so,{name:"header-prev-button",disabled:!yt(T)},{default:Ai(()=>[_r(id,{name:"ChevronLeft",size:"24"})]),_:1},8,["disabled"])],40,tK)):Ei("",!0),yt(oe).title?(It(),Wt("div",rK,[_r(so,{name:"header-title-wrapper"},{default:Ai(()=>[uc((It(),Wt("button",nK,[_r(so,{name:"header-title",title:i.page.title},{default:Ai(()=>[Ue("span",null,Mi(i.page.title),1)]),_:1},8,["title"])])),[[yt(VP),yt(B)]])]),_:1})])):Ei("",!0),yt(oe).next?(It(),Wt("button",{key:2,type:"button",class:"vc-arrow vc-next vc-focus",disabled:!yt(C),onClick:Re[2]||(Re[2]=(...Ee)=>yt(R)&&yt(R)(...Ee)),onKeydown:Re[3]||(Re[3]=DM((...Ee)=>yt(R)&&yt(R)(...Ee),["space","enter"]))},[_r(so,{name:"header-next-button",disabled:!yt(C)},{default:Ai(()=>[_r(id,{name:"ChevronRight",size:"24"})]),_:1},8,["disabled"])],40,iK)):Ei("",!0)],6))}}),XP=Symbol("__vc_page_context__");function sK(i){const{locale:c,getDateAddress:p,canMove:y}=Ru();function T(R,o){const{month:B,year:$}=p(new Date);return zP().map((H,ie)=>{const oe=ie+1;return{month:oe,year:R,id:Y7(oe,R),label:c.value.formatDate(H,o),ariaLabel:c.value.formatDate(H,"MMMM"),isActive:oe===i.value.month&&R===i.value.year,isCurrent:oe===B&&R===$,isDisabled:!y({month:oe,year:R},{position:i.value.position})}})}function M(R,o){const{year:B}=p(new Date),{position:$}=i.value,H=[];for(let ie=R;ie<=o;ie+=1){const oe=[...Array(12).keys()].some(_e=>y({month:_e+1,year:ie},{position:$}));H.push({year:ie,id:ie.toString(),label:ie.toString(),ariaLabel:ie.toString(),isActive:ie===i.value.year,isCurrent:ie===B,isDisabled:!oe})}return H}const C={page:i,getMonthItems:T,getYearItems:M};return Xa(XP,C),C}function KP(){const i=fs(XP);if(i)return i;throw new Error("Page context missing. Please verify this component is nested within a valid context provider.")}const oK={class:"vc-nav-header"},aK=["disabled"],lK=["disabled"],cK={class:"vc-nav-items"},uK=["data-id","aria-label","disabled","onClick","onKeydown"],hK=Gi({__name:"CalendarNav",setup(i){const{masks:c,move:p}=Ru(),{page:y,getMonthItems:T,getYearItems:M}=KP(),C=Zr(!0),R=12,o=Zr(y.value.year),B=Zr(ie(y.value.year)),$=Zr(null);function H(){setTimeout(()=>{if($.value==null)return;const nr=$.value.querySelector(".vc-nav-item:not(:disabled)");nr&&nr.focus()},10)}function ie(nr){return Math.floor(nr/R)}function oe(){C.value=!C.value}function _e(nr){return nr*R}function Me(nr){return R*(nr+1)-1}function Re(){gr.value&&(C.value&&mt(),dt())}function Ee(){zt.value&&(C.value&&gt(),ut())}function mt(){o.value--}function gt(){o.value++}function dt(){B.value--}function ut(){B.value++}const ht=rt(()=>T(o.value,c.value.navMonths).map(nr=>({...nr,click:()=>p({month:nr.month,year:nr.year},{position:y.value.position})}))),lt=rt(()=>T(o.value-1,c.value.navMonths)),Qe=rt(()=>lt.value.some(nr=>!nr.isDisabled)),Se=rt(()=>T(o.value+1,c.value.navMonths)),Xt=rt(()=>Se.value.some(nr=>!nr.isDisabled)),xr=rt(()=>M(_e(B.value),Me(B.value)).map(nr=>({...nr,click:()=>{o.value=nr.year,C.value=!0,H()}}))),Ve=rt(()=>M(_e(B.value-1),Me(B.value-1))),jt=rt(()=>Ve.value.some(nr=>!nr.isDisabled)),Ur=rt(()=>M(_e(B.value+1),Me(B.value+1))),$e=rt(()=>Ur.value.some(nr=>!nr.isDisabled)),ur=rt(()=>C.value?ht.value:xr.value),gr=rt(()=>C.value?Qe.value:jt.value),zt=rt(()=>C.value?Xt.value:$e.value),vn=rt(()=>_P(xr.value.map(nr=>nr.year))),Ft=rt(()=>Vh(xr.value.map(nr=>nr.year))),zr=rt(()=>C.value?o.value:`${vn.value} - ${Ft.value}`);return dI(()=>{o.value=y.value.year,H()}),Oi(()=>o.value,nr=>B.value=ie(nr)),ya(()=>H()),(nr,En)=>(It(),Wt("div",{class:"vc-nav-container",ref_key:"navContainer",ref:$},[Ue("div",oK,[Ue("button",{type:"button",class:"vc-nav-arrow is-left vc-focus",disabled:!yt(gr),onClick:Re,onKeydown:En[0]||(En[0]=dn=>yt(pg)(dn,Re))},[_r(so,{name:"nav-prev-button",move:Re,disabled:!yt(gr)},{default:Ai(()=>[_r(id,{name:"ChevronLeft",width:"22px",height:"24px"})]),_:1},8,["disabled"])],40,aK),Ue("button",{type:"button",class:"vc-nav-title vc-focus",onClick:oe,onKeydown:En[1]||(En[1]=dn=>yt(pg)(dn,oe))},Mi(yt(zr)),33),Ue("button",{type:"button",class:"vc-nav-arrow is-right vc-focus",disabled:!yt(zt),onClick:Ee,onKeydown:En[2]||(En[2]=dn=>yt(pg)(dn,Ee))},[_r(so,{name:"nav-next-button",move:Ee,disabled:!yt(zt)},{default:Ai(()=>[_r(id,{name:"ChevronRight",width:"22px",height:"24px"})]),_:1},8,["disabled"])],40,lK)]),Ue("div",cK,[(It(!0),Wt(Mn,null,Xi(yt(ur),dn=>(It(),Wt("button",{key:dn.label,type:"button","data-id":dn.id,"aria-label":dn.ariaLabel,class:Rn(["vc-nav-item vc-focus",[dn.isActive?"is-active":dn.isCurrent?"is-current":""]]),disabled:dn.isDisabled,onClick:dn.click,onKeydown:Bn=>yt(pg)(Bn,dn.click)},Mi(dn.label),43,uK))),128))])],512))}}),JP=Gi({__name:"CalendarPageProvider",props:{page:null},setup(i){return sK(yg(i,"page")),(p,y)=>od(p.$slots,"default")}}),dK=Gi({__name:"CalendarNavPopover",setup(i){const{navPopoverId:c,color:p,displayMode:y}=Ru();return(T,M)=>(It(),rs(O1,{id:yt(c),class:Rn(["vc-nav-popover-container",`vc-${yt(p)}`,`vc-${yt(y)}`])},{default:Ai(({data:C})=>[_r(JP,{page:C.page},{default:Ai(()=>[_r(so,{name:"nav"},{default:Ai(()=>[_r(hK)]),_:1})]),_:2},1032,["page"])]),_:1},8,["id","class"]))}}),fK=Gi({directives:{popover:VP},components:{CalendarSlot:so},props:{day:{type:Object,required:!0}},setup(i){const{locale:c,theme:p,attributeContext:y,dayPopoverId:T,onDayClick:M,onDayMouseenter:C,onDayMouseleave:R,onDayFocusin:o,onDayFocusout:B,onDayKeydown:$}=Ru(),H=rt(()=>i.day),ie=rt(()=>y.value.getCells(H.value)),oe=rt(()=>ie.value.map($e=>$e.data)),_e=rt(()=>({...H.value,attributes:oe.value,attributeCells:ie.value}));function Me({data:$e},{popovers:ur}){const{key:gr,customData:zt,popover:vn}=$e;if(!vn)return;const Ft=eA({key:gr,customData:zt,attribute:$e},{...vn},{visibility:vn.label?"hover":"click",placement:"bottom",isInteractive:!vn.label});ur.splice(0,0,Ft)}const Re=rt(()=>{const $e={...p.value.prepareRender({}),popovers:[]};return ie.value.forEach(ur=>{p.value.render(ur,$e),Me(ur,$e)}),$e}),Ee=rt(()=>Re.value.highlights),mt=rt(()=>!!Wa(Ee.value)),gt=rt(()=>Re.value.content),dt=rt(()=>Re.value.dots),ut=rt(()=>!!Wa(dt.value)),ht=rt(()=>Re.value.bars),lt=rt(()=>!!Wa(ht.value)),Qe=rt(()=>Re.value.popovers),Se=rt(()=>Qe.value.map($e=>$e.attribute)),Xt=WP("day-content"),xr=rt(()=>["vc-day",...H.value.classes,{"vc-day-box-center-center":!Xt},{"is-not-in-month":!i.day.inMonth}]),Ve=rt(()=>{let $e;H.value.isFocusable?$e="0":$e="-1";const ur=["vc-day-content vc-focusable vc-focus vc-attr",{"vc-disabled":H.value.isDisabled},wu(Vh(Ee.value),"contentClass"),wu(Vh(gt.value),"class")||""],gr={...wu(Vh(Ee.value),"contentStyle"),...wu(Vh(gt.value),"style")};return{class:ur,style:gr,tabindex:$e,"aria-label":H.value.ariaLabel,"aria-disabled":!!H.value.isDisabled,role:"button"}}),jt=rt(()=>({click($e){M(_e.value,$e)},mouseenter($e){C(_e.value,$e)},mouseleave($e){R(_e.value,$e)},focusin($e){o(_e.value,$e)},focusout($e){B(_e.value,$e)},keydown($e){$(_e.value,$e)}})),Ur=rt(()=>Wa(Qe.value)?eA({id:T.value,data:{day:H,attributes:Se.value}},...Qe.value):null);return{attributes:oe,attributeCells:ie,bars:ht,dayClasses:xr,dayContentProps:Ve,dayContentEvents:jt,dayPopover:Ur,glyphs:Re,dots:dt,hasDots:ut,hasBars:lt,highlights:Ee,hasHighlights:mt,locale:c,popovers:Qe}}}),pK={key:0,class:"vc-highlights vc-day-layer"},mK={key:1,class:"vc-day-layer vc-day-box-center-bottom"},_K={class:"vc-dots"},gK={key:2,class:"vc-day-layer vc-day-box-center-bottom"},yK={class:"vc-bars"};function vK(i,c,p,y,T,M){const C=ca("CalendarSlot"),R=CO("popover");return It(),Wt("div",{class:Rn(i.dayClasses)},[i.hasHighlights?(It(),Wt("div",pK,[(It(!0),Wt(Mn,null,Xi(i.highlights,({key:o,wrapperClass:B,class:$,style:H})=>(It(),Wt("div",{key:o,class:Rn(B)},[Ue("div",{class:Rn($),style:Ya(H)},null,6)],2))),128))])):Ei("",!0),_r(C,{name:"day-content",day:i.day,attributes:i.attributes,"attribute-cells":i.attributeCells,dayProps:i.dayContentProps,dayEvents:i.dayContentEvents,locale:i.locale},{default:Ai(()=>[uc((It(),Wt("div",mc(i.dayContentProps,xI(i.dayContentEvents,!0)),[im(Mi(i.day.label),1)],16)),[[R,i.dayPopover]])]),_:1},8,["day","attributes","attribute-cells","dayProps","dayEvents","locale"]),i.hasDots?(It(),Wt("div",mK,[Ue("div",_K,[(It(!0),Wt(Mn,null,Xi(i.dots,({key:o,class:B,style:$})=>(It(),Wt("span",{key:o,class:Rn(B),style:Ya($)},null,6))),128))])])):Ei("",!0),i.hasBars?(It(),Wt("div",gK,[Ue("div",yK,[(It(!0),Wt(Mn,null,Xi(i.bars,({key:o,class:B,style:$})=>(It(),Wt("span",{key:o,class:Rn(B),style:Ya($)},null,6))),128))])])):Ei("",!0)],2)}const xK=gc(fK,[["render",vK]]),bK={class:"vc-weekdays"},wK=["onClick"],TK={inheritAttrs:!1},SK=Gi({...TK,__name:"CalendarPage",setup(i){const{page:c}=KP(),{onWeeknumberClick:p}=Ru();return(y,T)=>(It(),Wt("div",{class:Rn(["vc-pane",`row-${yt(c).row}`,`row-from-end-${yt(c).rowFromEnd}`,`column-${yt(c).column}`,`column-from-end-${yt(c).columnFromEnd}`]),ref:"pane"},[_r(ZP,{page:yt(c),"is-lg":"","hide-arrows":""},null,8,["page"]),Ue("div",{class:Rn(["vc-weeks",{[`vc-show-weeknumbers-${yt(c).weeknumberPosition}`]:yt(c).weeknumberPosition}])},[Ue("div",bK,[(It(!0),Wt(Mn,null,Xi(yt(c).weekdays,({weekday:M,label:C},R)=>(It(),Wt("div",{key:R,class:Rn(`vc-weekday vc-weekday-${M}`)},Mi(C),3))),128))]),(It(!0),Wt(Mn,null,Xi(yt(c).viewWeeks,M=>(It(),Wt("div",{key:`weeknumber-${M.weeknumber}`,class:"vc-week"},[yt(c).weeknumberPosition?(It(),Wt("div",{key:0,class:Rn(["vc-weeknumber",`is-${yt(c).weeknumberPosition}`])},[Ue("span",{class:Rn(["vc-weeknumber-content"]),onClick:C=>yt(p)(M,C)},Mi(M.weeknumberDisplay),9,wK)],2)):Ei("",!0),(It(!0),Wt(Mn,null,Xi(M.days,C=>(It(),rs(xK,{key:C.id,day:C},null,8,["day"]))),128))]))),128))],2)],2))}}),MK=Gi({components:{CalendarHeader:ZP,CalendarPage:SK,CalendarNavPopover:dK,CalendarDayPopover:CX,CalendarPageProvider:JP,CalendarSlot:so},props:gX,emit:yX,setup(i,{emit:c,slots:p}){return vX(i,{emit:c,slots:p})}}),EK={class:"vc-pane-header-wrapper"};function AK(i,c,p,y,T,M){const C=ca("CalendarHeader"),R=ca("CalendarPage"),o=ca("CalendarSlot"),B=ca("CalendarPageProvider"),$=ca("CalendarDayPopover"),H=ca("CalendarNavPopover");return It(),Wt(Mn,null,[Ue("div",mc({"data-helptext":"Press the arrow keys to navigate by day, Home and End to navigate to week ends, PageUp and PageDown to navigate by month, Alt+PageUp and Alt+PageDown to navigate by year"},i.$attrs,{class:["vc-container",`vc-${i.view}`,`vc-${i.color}`,`vc-${i.displayMode}`,{"vc-expanded":i.expanded,"vc-bordered":!i.borderless,"vc-transparent":i.transparent}],onMouseup:c[0]||(c[0]=wg(()=>{},["prevent"])),ref:"containerRef"}),[Ue("div",{class:Rn(["vc-pane-container",{"in-transition":i.inTransition}])},[Ue("div",EK,[i.firstPage?(It(),rs(C,{key:0,page:i.firstPage,"is-lg":"","hide-title":""},null,8,["page"])):Ei("",!0)]),_r(hy,{name:`vc-${i.transitionName}`,onBeforeEnter:i.onTransitionBeforeEnter,onAfterEnter:i.onTransitionAfterEnter},{default:Ai(()=>[(It(),Wt("div",{key:i.pages[0].id,class:"vc-pane-layout",style:Ya({gridTemplateColumns:`repeat(${i.columns}, 1fr)`})},[(It(!0),Wt(Mn,null,Xi(i.pages,ie=>(It(),rs(B,{key:ie.id,page:ie},{default:Ai(()=>[_r(o,{name:"page",page:ie},{default:Ai(()=>[_r(R)]),_:2},1032,["page"])]),_:2},1032,["page"]))),128))],4))]),_:1},8,["name","onBeforeEnter","onAfterEnter"]),_r(o,{name:"footer"})],2)],16),_r($),_r(H)],64)}const IK=gc(MK,[["render",AK]]),QP=Symbol("__vc_date_picker_context__"),CK={...jP,mode:{type:String,default:"date"},modelValue:{type:[Number,String,Date,Object]},modelModifiers:{type:Object,default:()=>({})},rules:[String,Object],is24hr:Boolean,hideTimeHeader:Boolean,timeAccuracy:{type:Number,default:2},isRequired:Boolean,isRange:Boolean,updateOnInput:{type:Boolean,default:()=>dc("datePicker.updateOnInput")},inputDebounce:{type:Number,default:()=>dc("datePicker.inputDebounce")},popover:{type:[Boolean,Object],default:!0},dragAttribute:Object,selectAttribute:Object,attributes:[Object,Array]},PK=["update:modelValue","drag","dayclick","daykeydown","popover-will-show","popover-did-show","popover-will-hide","popover-did-hide"];function DK(i,{emit:c,slots:p}){qP(p,{footer:"dp-footer"});const y=GP(i),{locale:T,masks:M,disabledAttribute:C}=y,R=Zr(!1),o=Zr(Symbol()),B=Zr(null),$=Zr(null),H=Zr(["",""]),ie=Zr(null),oe=Zr(null);let _e,Me,Re=!0;const Ee=rt(()=>i.isRange||i.modelModifiers.range===!0),mt=rt(()=>Ee.value&&B.value!=null?B.value.start:null),gt=rt(()=>Ee.value&&B.value!=null?B.value.end:null),dt=rt(()=>i.mode.toLowerCase()==="date"),ut=rt(()=>i.mode.toLowerCase()==="datetime"),ht=rt(()=>i.mode.toLowerCase()==="time"),lt=rt(()=>!!$.value),Qe=rt(()=>{let ue="date";i.modelModifiers.number&&(ue="number"),i.modelModifiers.string&&(ue="string");const Je=M.value.modelValue||"iso";return En({type:ue,mask:Je})}),Se=rt(()=>tr($.value??B.value)),Xt=rt(()=>ht.value?i.is24hr?M.value.inputTime24hr:M.value.inputTime:ut.value?i.is24hr?M.value.inputDateTime24hr:M.value.inputDateTime:M.value.input),xr=rt(()=>/[Hh]/g.test(Xt.value)),Ve=rt(()=>/[dD]{1,2}|Do|W{1,4}|M{1,4}|YY(?:YY)?/g.test(Xt.value)),jt=rt(()=>{if(xr.value&&Ve.value)return"dateTime";if(Ve.value)return"date";if(xr.value)return"time"}),Ur=rt(()=>{var ue;const Je=((ue=ie.value)==null?void 0:ue.$el.previousElementSibling)??void 0;return Qp({},i.popover,dc("datePicker.popover"),{target:Je})}),$e=rt(()=>NP({...Ur.value,id:o.value})),ur=rt(()=>Ee.value?{start:H.value[0],end:H.value[1]}:H.value[0]),gr=rt(()=>{const ue=["start","end"].map(Je=>({input:ft(Je),change:ct(Je),keyup:Bt,...i.popover&&$e.value}));return Ee.value?{start:ue[0],end:ue[1]}:ue[0]}),zt=rt(()=>{if(!it(B.value))return null;const ue={key:"select-drag",...i.selectAttribute,dates:B.value,pinPage:!0},{dot:Je,bar:Ot,highlight:hr,content:Sr}=ue;return!Je&&!Ot&&!hr&&!Sr&&(ue.highlight=!0),ue}),vn=rt(()=>{if(!Ee.value||!it($.value))return null;const ue={key:"select-drag",...i.dragAttribute,dates:$.value},{dot:Je,bar:Ot,highlight:hr,content:Sr}=ue;return!Je&&!Ot&&!hr&&!Sr&&(ue.highlight={startEnd:{fillMode:"outline"}}),ue}),Ft=rt(()=>{const ue=uo(i.attributes)?[...i.attributes]:[];return vn.value?ue.unshift(vn.value):zt.value&&ue.unshift(zt.value),ue}),zr=rt(()=>En(i.rules==="auto"?nr():i.rules??{}));function nr(){const ue={ms:[0,999],sec:[0,59],min:[0,59],hr:[0,23]},Je=dt.value?0:i.timeAccuracy;return[0,1].map(Ot=>{switch(Je){case 0:return{hours:ue.hr[Ot],minutes:ue.min[Ot],seconds:ue.sec[Ot],milliseconds:ue.ms[Ot]};case 1:return{minutes:ue.min[Ot],seconds:ue.sec[Ot],milliseconds:ue.ms[Ot]};case 3:return{milliseconds:ue.ms[Ot]};case 4:return{};default:return{seconds:ue.sec[Ot],milliseconds:ue.ms[Ot]}}})}function En(ue){return uo(ue)?ue.length===1?[ue[0],ue[0]]:ue:[ue,ue]}function dn(ue){return En(ue).map((Je,Ot)=>({...Je,rules:zr.value[Ot]}))}function Bn(ue){return ue==null?!1:Oo(ue)?!isNaN(ue):qh(ue)?!isNaN(ue.getTime()):fa(ue)?ue!=="":D1(ue)}function bn(ue){return el(ue)&&"start"in ue&&"end"in ue&&Bn(ue.start??null)&&Bn(ue.end??null)}function it(ue){return bn(ue)||Bn(ue)}function Kt(ue,Je){if(ue==null&&Je==null)return!0;if(ue==null||Je==null)return!1;const Ot=qh(ue),hr=qh(Je);return Ot&&hr?ue.getTime()===Je.getTime():Ot||hr?!1:Kt(ue.start,Je.start)&&Kt(ue.end,Je.end)}function Gt(ue){return!it(ue)||!C.value?!1:C.value.intersectsRange(T.value.range(ue))}function ir(ue,Je,Ot,hr){if(!it(ue))return null;if(bn(ue)){const Sr=T.value.toDate(ue.start,{...Je[0],fillDate:mt.value??void 0,patch:Ot}),Rr=T.value.toDate(ue.end,{...Je[1],fillDate:gt.value??void 0,patch:Ot});return nt({start:Sr,end:Rr},hr)}return T.value.toDateOrNull(ue,{...Je[0],fillDate:B.value,patch:Ot})}function Vr(ue,Je){return bn(ue)?{start:T.value.fromDate(ue.start,Je[0]),end:T.value.fromDate(ue.end,Je[1])}:Ee.value?null:T.value.fromDate(ue,Je[0])}function Kr(ue,Je={}){return clearTimeout(_e),new Promise(Ot=>{const{debounce:hr=0,...Sr}=Je;hr>0?_e=window.setTimeout(()=>{Ot(pe(ue,Sr))},hr):Ot(pe(ue,Sr))})}function pe(ue,{config:Je=Qe.value,patch:Ot="dateTime",clearIfEqual:hr=!1,formatInput:Sr=!0,hidePopover:Rr=!1,dragging:Hr=lt.value,targetPriority:Tn,moveToValue:Qn=!1}={}){const An=dn(Je);let Vn=ir(ue,An,Ot,Tn);if(Gt(Vn)){if(Hr)return null;Vn=B.value,Rr=!1}else Vn==null&&i.isRequired?Vn=B.value:Vn!=null&&Kt(B.value,Vn)&&hr&&(Vn=null);const Ci=Hr?$:B,Wn=!Kt(Ci.value,Vn);Ci.value=Vn,Hr||($.value=null);const jn=Vr(Vn,Qe.value);return Wn&&(Re=!1,c(Hr?"drag":"update:modelValue",jn),qa(()=>Re=!0)),Rr&&!Hr&&ke(),Sr&&ye(),Qn&&qa(()=>Ht(Tn??"start")),jn}function ye(){qa(()=>{const ue=dn({type:"string",mask:Xt.value}),Je=Vr($.value??B.value,ue);Ee.value?H.value=[Je&&Je.start,Je&&Je.end]:H.value=[Je,""]})}function qe(ue,Je,Ot){H.value.splice(Je==="start"?0:1,1,ue);const hr=Ee.value?{start:H.value[0],end:H.value[1]||H.value[0]}:ue,Sr={type:"string",mask:Xt.value};Kr(hr,{...Ot,config:Sr,patch:jt.value,targetPriority:Je,moveToValue:!0})}function ft(ue){return Je=>{i.updateOnInput&&qe(Je.currentTarget.value,ue,{formatInput:!1,hidePopover:!1,debounce:i.inputDebounce})}}function ct(ue){return Je=>{qe(Je.currentTarget.value,ue,{formatInput:!0,hidePopover:!1})}}function Bt(ue){ue.key==="Escape"&&Kr(B.value,{formatInput:!0,hidePopover:!0})}function tr(ue){return Ee.value?[ue&&ue.start?T.value.getDateParts(ue.start):null,ue&&ue.end?T.value.getDateParts(ue.end):null]:[ue?T.value.getDateParts(ue):null]}function vt(){$.value=null,ye()}function Yt(ue){c("popover-will-show",ue)}function Pt(ue){c("popover-did-show",ue)}function rr(ue){vt(),c("popover-will-hide",ue)}function br(ue){c("popover-did-hide",ue)}function yr(ue){const Je={patch:"date",formatInput:!0,hidePopover:!0};if(Ee.value){const Ot=!lt.value;Ot?Me={start:ue.startDate,end:ue.endDate}:Me!=null&&(Me.end=ue.date),Kr(Me,{...Je,dragging:Ot})}else Kr(ue.date,{...Je,clearIfEqual:!i.isRequired})}function Ie(ue,Je){yr(ue),c("dayclick",ue,Je)}function Z(ue,Je){switch(Je.key){case" ":case"Enter":{yr(ue),Je.preventDefault();break}case"Escape":ke()}c("daykeydown",ue,Je)}function te(ue,Je){!lt.value||Me==null||(Me.end=ue.date,Kr(nt(Me),{patch:"date",formatInput:!0}))}function he(ue={}){Cx({...Ur.value,...ue,isInteractive:!0,id:o.value})}function ke(ue={}){em({hideDelay:10,force:!0,...Ur.value,...ue,id:o.value})}function We(ue){BP({...Ur.value,...ue,isInteractive:!0,id:o.value})}function nt(ue,Je){const{start:Ot,end:hr}=ue;if(Ot>hr)switch(Je){case"start":return{start:Ot,end:Ot};case"end":return{start:hr,end:hr};default:return{start:hr,end:Ot}}return{start:Ot,end:hr}}async function Ut(ue,Je={}){return oe.value==null?!1:oe.value.move(ue,Je)}async function Ge(ue,Je={}){return oe.value==null?!1:oe.value.moveBy(ue,Je)}async function Ht(ue,Je={}){const Ot=B.value;if(oe.value==null||!it(Ot))return!1;const hr=ue!=="end",Sr=hr?1:-1,Rr=bn(Ot)?hr?Ot.start:Ot.end:Ot,Hr=wP(Rr,"monthly",T.value);return oe.value.move(Hr,{position:Sr,...Je})}Oi(()=>i.isRange,ue=>{ue&&console.warn("The `is-range` prop will be deprecated in future releases. Please use the `range` modifier.")},{immediate:!0}),Oi(()=>Ee.value,()=>{pe(null,{formatInput:!0})}),Oi(()=>Xt.value,()=>ye()),Oi(()=>i.modelValue,ue=>{Re&&pe(ue,{formatInput:!0,hidePopover:!1})}),Oi(()=>zr.value,()=>{el(i.rules)&&pe(i.modelValue,{formatInput:!0,hidePopover:!1})}),Oi(()=>i.timezone,()=>{pe(B.value,{formatInput:!0})});const Et=En(Qe.value);B.value=ir(i.modelValue??null,Et,"dateTime"),ya(()=>{pe(i.modelValue,{formatInput:!0,hidePopover:!1})}),qa(()=>R.value=!0);const Pe={...y,showCalendar:R,datePickerPopoverId:o,popoverRef:ie,popoverEvents:$e,calendarRef:oe,isRange:Ee,isTimeMode:ht,isDateTimeMode:ut,is24hr:yg(i,"is24hr"),hideTimeHeader:yg(i,"hideTimeHeader"),timeAccuracy:yg(i,"timeAccuracy"),isDragging:lt,inputValue:ur,inputEvents:gr,dateParts:Se,attributes:Ft,rules:zr,move:Ut,moveBy:Ge,moveToValue:Ht,updateValue:Kr,showPopover:he,hidePopover:ke,togglePopover:We,onDayClick:Ie,onDayKeydown:Z,onDayMouseEnter:te,onPopoverBeforeShow:Yt,onPopoverAfterShow:Pt,onPopoverBeforeHide:rr,onPopoverAfterHide:br};return Xa(QP,Pe),Pe}function z1(){const i=fs(QP);if(i)return i;throw new Error("DatePicker context missing. Please verify this component is nested within a valid context provider.")}const LK=[{value:0,label:"12"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"},{value:6,label:"6"},{value:7,label:"7"},{value:8,label:"8"},{value:9,label:"9"},{value:10,label:"10"},{value:11,label:"11"}],RK=[{value:12,label:"12"},{value:13,label:"1"},{value:14,label:"2"},{value:15,label:"3"},{value:16,label:"4"},{value:17,label:"5"},{value:18,label:"6"},{value:19,label:"7"},{value:20,label:"8"},{value:21,label:"9"},{value:22,label:"10"},{value:23,label:"11"}];function kK(i){const c=z1(),{locale:p,isRange:y,isTimeMode:T,dateParts:M,rules:C,is24hr:R,hideTimeHeader:o,timeAccuracy:B,updateValue:$}=c;function H(Ve){Ve=Object.assign(oe.value,Ve);let jt=null;if(y.value){const Ur=ie.value?Ve:M.value[0],$e=ie.value?M.value[1]:Ve;jt={start:Ur,end:$e}}else jt=Ve;$(jt,{patch:"time",targetPriority:ie.value?"start":"end",moveToValue:!0})}const ie=rt(()=>i.position===0),oe=rt(()=>M.value[i.position]||{isValid:!1}),_e=rt(()=>D1(oe.value)),Me=rt(()=>!!oe.value.isValid),Re=rt(()=>!o.value&&Me.value),Ee=rt(()=>{if(!_e.value)return null;let Ve=p.value.toDate(oe.value);return oe.value.hours===24&&(Ve=new Date(Ve.getTime()-1)),Ve}),mt=rt({get(){return oe.value.hours},set(Ve){H({hours:Ve})}}),gt=rt({get(){return oe.value.minutes},set(Ve){H({minutes:Ve})}}),dt=rt({get(){return oe.value.seconds},set(Ve){H({seconds:Ve})}}),ut=rt({get(){return oe.value.milliseconds},set(Ve){H({milliseconds:Ve})}}),ht=rt({get(){return oe.value.hours<12},set(Ve){Ve=String(Ve).toLowerCase()=="true";let jt=mt.value;Ve&&jt>=12?jt-=12:!Ve&&jt<12&&(jt+=12),H({hours:jt})}}),lt=rt(()=>J9(oe.value,C.value[i.position])),Qe=rt(()=>LK.filter(Ve=>lt.value.hours.some(jt=>jt.value===Ve.value))),Se=rt(()=>RK.filter(Ve=>lt.value.hours.some(jt=>jt.value===Ve.value))),Xt=rt(()=>R.value?lt.value.hours:ht.value?Qe.value:Se.value),xr=rt(()=>{const Ve=[];return Wa(Qe.value)&&Ve.push({value:!0,label:"AM"}),Wa(Se.value)&&Ve.push({value:!1,label:"PM"}),Ve});return{...c,showHeader:Re,timeAccuracy:B,parts:oe,isValid:Me,date:Ee,hours:mt,minutes:gt,seconds:dt,milliseconds:ut,options:lt,hourOptions:Xt,isAM:ht,isAMOptions:xr,is24hr:R}}const OK=["value"],zK=["value","disabled"],FK={key:1,class:"vc-base-sizer","aria-hidden":"true"},BK={inheritAttrs:!1},Ep=Gi({...BK,__name:"BaseSelect",props:{options:null,modelValue:null,alignRight:{type:Boolean},alignLeft:{type:Boolean},showIcon:{type:Boolean},fitContent:{type:Boolean}},emits:["update:modelValue"],setup(i){const c=i,p=rt(()=>{const y=c.options.find(T=>T.value===c.modelValue);return y==null?void 0:y.label});return(y,T)=>(It(),Wt("div",{class:Rn(["vc-base-select",{"vc-fit-content":i.fitContent,"vc-has-icon":i.showIcon}])},[Ue("select",mc(y.$attrs,{value:i.modelValue,class:["vc-focus",{"vc-align-right":i.alignRight,"vc-align-left":i.alignLeft}],onChange:T[0]||(T[0]=M=>y.$emit("update:modelValue",M.target.value))}),[(It(!0),Wt(Mn,null,Xi(i.options,M=>(It(),Wt("option",{key:M.value,value:M.value,disabled:M.disabled},Mi(M.label),9,zK))),128))],16,OK),i.showIcon?(It(),rs(id,{key:0,name:"ChevronDown",size:"18"})):Ei("",!0),i.fitContent?(It(),Wt("div",FK,Mi(yt(p)),1)):Ei("",!0)],2))}}),NK={key:0,class:"vc-time-header"},VK={class:"vc-time-weekday"},$K={class:"vc-time-month"},UK={class:"vc-time-day"},jK={class:"vc-time-year"},GK={class:"vc-time-select-group"},HK=Ue("span",{class:"vc-time-colon"},":",-1),qK=Ue("span",{class:"vc-time-colon"},":",-1),WK=Ue("span",{class:"vc-time-decimal"},".",-1),CA=Gi({__name:"TimePicker",props:{position:null},setup(i,{expose:c}){const y=kK(i);c(y);const{locale:T,isValid:M,date:C,hours:R,minutes:o,seconds:B,milliseconds:$,options:H,hourOptions:ie,isTimeMode:oe,isAM:_e,isAMOptions:Me,is24hr:Re,showHeader:Ee,timeAccuracy:mt}=y;return(gt,dt)=>(It(),Wt("div",{class:Rn(["vc-time-picker",[{"vc-invalid":!yt(M),"vc-attached":!yt(oe)}]])},[_r(so,{name:"time-header"},{default:Ai(()=>[yt(Ee)&&yt(C)?(It(),Wt("div",NK,[Ue("span",VK,Mi(yt(T).formatDate(yt(C),"WWW")),1),Ue("span",$K,Mi(yt(T).formatDate(yt(C),"MMM")),1),Ue("span",UK,Mi(yt(T).formatDate(yt(C),"D")),1),Ue("span",jK,Mi(yt(T).formatDate(yt(C),"YYYY")),1)])):Ei("",!0)]),_:1}),Ue("div",GK,[_r(id,{name:"Clock",size:"17"}),_r(Ep,{modelValue:yt(R),"onUpdate:modelValue":dt[0]||(dt[0]=ut=>ui(R)?R.value=ut:null),modelModifiers:{number:!0},options:yt(ie),class:"vc-time-select-hours","align-right":""},null,8,["modelValue","options"]),yt(mt)>1?(It(),Wt(Mn,{key:0},[HK,_r(Ep,{modelValue:yt(o),"onUpdate:modelValue":dt[1]||(dt[1]=ut=>ui(o)?o.value=ut:null),modelModifiers:{number:!0},options:yt(H).minutes,class:"vc-time-select-minutes","align-left":yt(mt)===2},null,8,["modelValue","options","align-left"])],64)):Ei("",!0),yt(mt)>2?(It(),Wt(Mn,{key:1},[qK,_r(Ep,{modelValue:yt(B),"onUpdate:modelValue":dt[2]||(dt[2]=ut=>ui(B)?B.value=ut:null),modelModifiers:{number:!0},options:yt(H).seconds,class:"vc-time-select-seconds","align-left":yt(mt)===3},null,8,["modelValue","options","align-left"])],64)):Ei("",!0),yt(mt)>3?(It(),Wt(Mn,{key:2},[WK,_r(Ep,{modelValue:yt($),"onUpdate:modelValue":dt[3]||(dt[3]=ut=>ui($)?$.value=ut:null),modelModifiers:{number:!0},options:yt(H).milliseconds,class:"vc-time-select-milliseconds","align-left":""},null,8,["modelValue","options"])],64)):Ei("",!0),yt(Re)?Ei("",!0):(It(),rs(Ep,{key:3,modelValue:yt(_e),"onUpdate:modelValue":dt[4]||(dt[4]=ut=>ui(_e)?_e.value=ut:null),options:yt(Me)},null,8,["modelValue","options"]))])],2))}}),eD=Gi({__name:"DatePickerBase",setup(i){const{attributes:c,calendarRef:p,color:y,displayMode:T,isDateTimeMode:M,isTimeMode:C,isRange:R,onDayClick:o,onDayMouseEnter:B,onDayKeydown:$}=z1(),H=R.value?[0,1]:[0];return(ie,oe)=>yt(C)?(It(),Wt("div",{key:0,class:Rn(`vc-container vc-bordered vc-${yt(y)} vc-${yt(T)}`)},[(It(!0),Wt(Mn,null,Xi(yt(H),_e=>(It(),rs(CA,{key:_e,position:_e},null,8,["position"]))),128))],2)):(It(),rs(IK,{key:1,attributes:yt(c),ref_key:"calendarRef",ref:p,onDayclick:yt(o),onDaymouseenter:yt(B),onDaykeydown:yt($)},{footer:Ai(()=>[yt(M)?(It(!0),Wt(Mn,{key:0},Xi(yt(H),_e=>(It(),rs(CA,{key:_e,position:_e},null,8,["position"]))),128)):Ei("",!0),_r(so,{name:"dp-footer"})]),_:1},8,["attributes","onDayclick","onDaymouseenter","onDaykeydown"]))}}),YK={inheritAttrs:!1},ZK=Gi({...YK,__name:"DatePickerPopover",setup(i){const{datePickerPopoverId:c,color:p,displayMode:y,popoverRef:T,onPopoverBeforeShow:M,onPopoverAfterShow:C,onPopoverBeforeHide:R,onPopoverAfterHide:o}=z1();return(B,$)=>(It(),rs(O1,{id:yt(c),placement:"bottom-start",class:Rn(`vc-date-picker-content vc-${yt(p)} vc-${yt(y)}`),ref_key:"popoverRef",ref:T,onBeforeShow:yt(M),onAfterShow:yt(C),onBeforeHide:yt(R),onAfterHide:yt(o)},{default:Ai(()=>[_r(eD,Dp(Fg(B.$attrs)),null,16)]),_:1},8,["id","class","onBeforeShow","onAfterShow","onBeforeHide","onAfterHide"]))}}),XK=Gi({inheritAttrs:!1,emits:PK,props:CK,components:{DatePickerBase:eD,DatePickerPopover:ZK},setup(i,c){const p=DK(i,c),y=Xs(yP(p,"calendarRef","popoverRef"));return{...p,slotCtx:y}}});function KK(i,c,p,y,T,M){const C=ca("DatePickerPopover"),R=ca("DatePickerBase");return i.$slots.default?(It(),Wt(Mn,{key:0},[od(i.$slots,"default",Dp(Fg(i.slotCtx))),_r(C,Dp(Fg(i.$attrs)),null,16)],64)):(It(),rs(R,Dp(mc({key:1},i.$attrs)),null,16))}const JK=gc(XK,[["render",KK]]);Zr(new Date);const _d=i=>(fc("data-v-9dbe9abb"),i=i(),pc(),i),QK=_d(()=>Ue("div",{class:"title-h2"},[Ue("h2",null,"Plan your next adventure")],-1)),eJ={class:"section1"},tJ=_d(()=>Ue("h4",null,"Place & dates",-1)),rJ=["placeholder"],nJ={class:"text-sm"},iJ={class:"flex rounded-lg border border-gray-300 dark:border-gray-600 overflow-hidden calendar whole_calendar",id:"whole_calendar"},sJ=["onClick"],oJ=_d(()=>Ue("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-calendar w-5 h-5"},[Ue("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),Ue("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),Ue("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),Ue("line",{x1:"3",y1:"10",x2:"21",y2:"10"})],-1)),aJ=[oJ],lJ=["value"],cJ={class:"section2"},uJ=_d(()=>Ue("h4",null,"Kind of Activities",-1)),hJ={class:"box"},dJ=["onUpdate:modelValue","id"],fJ=["id","for","onClick"],pJ=["onUpdate:modelValue","id"],mJ=["id","for","onClick"],_J={class:"section3"},gJ=_d(()=>Ue("h4",null,"How many people is going?",-1)),yJ={class:"content3"},vJ={class:"c-0"},xJ=_d(()=>Ue("p",null,"People",-1)),bJ=gz('<section class="section4" data-v-9dbe9abb><div class="box" data-v-9dbe9abb><ul data-v-9dbe9abb><li data-v-9dbe9abb><input type="radio" id="couple" name="relationship" value="couple" checked data-v-9dbe9abb><label class="label" for="couple" data-v-9dbe9abb>Couple</label></li><li data-v-9dbe9abb><input type="radio" id="family" name="relationship" value="family" data-v-9dbe9abb><label class="label" for="family" data-v-9dbe9abb>Family</label></li><li data-v-9dbe9abb><input type="radio" id="friends" name="relationship" value="friends" data-v-9dbe9abb><label class="label" for="friends" data-v-9dbe9abb>Friends</label></li></ul></div></section>',1),wJ={class:"submit-btn"},TJ=["on-click"],SJ={__name:"OptionsMain",setup(i){const c=mo();rt(()=>ho().get("search",c.language));const p=e1();Zr(new Date);var y=Zr({start:new Date,end:new Date});const T=Zr({dot:!0}),M=Zr(null),C=Zr("orange"),R=rt(()=>({popover:{visibility:"hover",isInteractive:!1}}));var o=Zr(1);function B(){o.value>1&&o.value--}function $(){o.value<5&&o.value++}const H=[{label:"Kid Friendly",value:"kid_friendly",selected:!1,count:0},{label:"Museums",value:"museums",selected:!1,count:0},{label:"Historical",value:"historical",selected:!1,count:0},{label:"Shopping",value:"shopping",selected:!1,count:0}],ie=[{label:"Outdoor Adventures",value:"outdoor_adventures",selected:!1,count:0},{label:"Art & Cultural",value:"art_cultural",selected:!1,count:0},{label:"Amusement Parks",value:"amusement_parks",selected:!1,count:0}];function oe(){var ut=[];for(const ht in H)ht.selected==!0&&(ut.push=ht.label);console.log(ut)}function _e(ut,ht){const lt=ht==1?H:ie;var Qe=lt.findIndex(Se=>Se.value===ut);lt[Qe].selected=!lt[Qe].selected,console.log(H),console.log(Me())}function Me(){for(var ut=document.getElementsByName("relationship"),ht=0;ht<ut.length;ht++)if(ut[ht].checked)return ut[ht].value;return null}const Re=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];var Ee=Zr("Select a range date"),mt=document.getElementById("btn_calendar");document.addEventListener("DOMContentLoaded",function(){mt.addEventListener("click",()=>{var ut=Re[y.value.start.getMonth()],ht=Re[y.value.end.getMonth()],lt=y.value.start.getDate(),Qe=y.value.end.getDate();Ee.value=`${lt} ${ut} ~ ${Qe} ${ht}`,console.log(Ee.value)})});function gt(){dt(),oe(),p.changeVar("type",Me()),p.changeVar("people",o.value),console.log(p.vars)}function dt(){var ut=Re[y.value.start.getMonth()],ht=Re[y.value.end.getMonth()],lt=y.value.start.getDate(),Qe=y.value.end.getDate(),Se=document.querySelector(".inputWrong"),Xt=new Date;Ee.value=="Select a range date"&&Qe==Xt.getDate()&&ht==Re[Xt.getMonth()]||Qe==lt&&ht==ut?(Ee.value="Select a range date",document.addEventListener("DOMContentLoaded",function(){Se.style.color="black"})):Xt.getDate()>y.value.start.getDate()&&Xt.getMonth()>y.value.start.getMonth()||Xt.getDate()>y.value.start.getDate()&&Xt.getMonth()==y.value.start.getMonth()?(Ee.value="Select a valid range",Se.style.color="red"):(Se.style.color="black",Ee.value=`${lt} ${ut} ~ ${Qe} ${ht}`),console.log(Ee.value)}return(ut,ht)=>(It(),Wt("main",null,[QK,Ue("section",eJ,[tJ,Ue("div",null,[Ue("input",{type:"",placeholder:yt(p).vars.destiny=="null"?"Select a destiny":yt(p).vars.destiny,class:"destiny"},null,8,rJ),Ue("div",null,[_r(yt(JK),{color:C.value,modelValue:yt(y),"onUpdate:modelValue":ht[0]||(ht[0]=lt=>ui(y)?y.value=lt:y=lt),modelModifiers:{range:!0},popover:!1,"select-attribute":T.value,"drag-attribute":R.value,onDrag:ht[1]||(ht[1]=lt=>M.value=lt)},{"day-popover":Ai(({format:lt})=>[Ue("div",nJ,Mi(lt(M.value?M.value.start:yt(y).start,"MMM D"))+" - "+Mi(lt(M.value?M.value.end:yt(y).end,"MMM D")),1)]),default:Ai(({togglePopover:lt,inputEvents:Qe})=>[Ue("div",iJ,[Ue("button",{class:"flex justify-center items-center px-2 bg-accent-100 hover:bg-accent-200 text-accent-700 border-r border-gray-300 dark:bg-gray-700 dark:text-accent-300 dark:border-gray-600 dark:hover:bg-gray-600 btn-calendar",onClick:()=>lt(),id:"btn-calendar"},aJ,8,sJ),Ue("input",mc({value:yt(Ee)},xI(Qe,!0),{class:"flex-grow px-2 py-1 bg-white dark:bg-gray-700 inputWrong"}),null,16,lJ)])]),_:1},8,["color","modelValue","select-attribute","drag-attribute"])])])]),Ue("section",cJ,[uJ,Ue("div",hJ,[Ue("ul",null,[(It(),Wt(Mn,null,Xi(H,lt=>Ue("li",{key:lt.value},[uc(Ue("input",{type:"checkbox","onUpdate:modelValue":Qe=>lt.selected=Qe,id:lt.value},null,8,dJ),[[IM,lt.selected]]),Ue("label",{id:lt.value,class:"label",for:lt.value,onClick:Qe=>_e(lt.value,1)},Mi(lt.label),9,fJ)])),64))]),Ue("ul",null,[(It(),Wt(Mn,null,Xi(ie,lt=>Ue("li",{key:lt.value},[uc(Ue("input",{type:"checkbox","onUpdate:modelValue":Qe=>lt.selected=Qe,id:lt.value},null,8,pJ),[[IM,lt.selected]]),Ue("label",{id:lt.value,class:"label",for:lt.value,onClick:Qe=>_e(lt.value,1)},Mi(lt.label),9,mJ)])),64))])])]),Ue("section",_J,[gJ,Ue("div",yJ,[Ue("div",vJ,[Ue("p",null,Mi(yt(o)),1)]),Ue("div",{class:"c-1"},[xJ,Ue("div",{class:"c-2"},[Ue("div",{class:"box-btn"},[Ue("button",{onClick:B},"-")]),Ue("div",{class:"box-btn"},[Ue("button",{onClick:$},"+")])])])])]),bJ,Ue("div",wJ,[Ue("input",{type:"submit",value:"Create New Trip","on-click":gt()},null,40,TJ)])]))}},MJ=Ki(SJ,[["__scopeId","data-v-9dbe9abb"]]),EJ={class:"allComponents"},AJ={__name:"OptionsComponent",setup(i){return(c,p)=>(It(),Wt("section",EJ,[_r(my),_r(MJ)]))}},IJ=Ki(AJ,[["__scopeId","data-v-6a7a6de7"]]),CJ={class:"container-fluid"},PJ={__name:"OptionsView",setup(i){return(c,p)=>(It(),Wt("main",CJ,[Ue("div",null,[_r(IJ)])]))}},DJ=mF({history:H3("/"),routes:[{path:"/",name:"home",component:cB},{path:"/about",name:"about",component:NN},{path:"/test",name:"test",component:hB},{path:"/login",name:"login",component:a5},{path:"/options",name:"options",component:PJ}]}),Ly=s3(gF);Ly.use(c3());Ly.use(DJ);Ly.use(HN,{clientId:"585388550874-da88aogj6sqc6he9o5mnmm9ibagborua.apps.googleusercontent.com"});Ly.mount("#app");
