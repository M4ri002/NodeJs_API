(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const L of document.querySelectorAll('link[rel="modulepreload"]'))S(L);new MutationObserver(L=>{for(const k of L)if(k.type==="childList")for(const V of k.addedNodes)V.tagName==="LINK"&&V.rel==="modulepreload"&&S(V)}).observe(document,{childList:!0,subtree:!0});function w(L){const k={};return L.integrity&&(k.integrity=L.integrity),L.referrerPolicy&&(k.referrerPolicy=L.referrerPolicy),L.crossOrigin==="use-credentials"?k.credentials="include":L.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function S(L){if(L.ep)return;L.ep=!0;const k=w(L);fetch(L.href,k)}})();/**
* @vue/shared v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Ly(d,g){const w=new Set(d.split(","));return g?S=>w.has(S.toLowerCase()):S=>w.has(S)}const Zr={},Eu=[],Os=()=>{},YM=()=>!1,Pm=d=>d.charCodeAt(0)===111&&d.charCodeAt(1)===110&&(d.charCodeAt(2)>122||d.charCodeAt(2)<97),Dy=d=>d.startsWith("onUpdate:"),Bn=Object.assign,zy=(d,g)=>{const w=d.indexOf(g);w>-1&&d.splice(w,1)},KM=Object.prototype.hasOwnProperty,yr=(d,g)=>KM.call(d,g),Pi=Array.isArray,Su=d=>af(d)==="[object Map]",Rm=d=>af(d)==="[object Set]",hb=d=>af(d)==="[object Date]",Qi=d=>typeof d=="function",Sn=d=>typeof d=="string",cl=d=>typeof d=="symbol",jr=d=>d!==null&&typeof d=="object",Sw=d=>(jr(d)||Qi(d))&&Qi(d.then)&&Qi(d.catch),Aw=Object.prototype.toString,af=d=>Aw.call(d),JM=d=>af(d).slice(8,-1),Mw=d=>af(d)==="[object Object]",ky=d=>Sn(d)&&d!=="NaN"&&d[0]!=="-"&&""+parseInt(d,10)===d,qd=Ly(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Lm=d=>{const g=Object.create(null);return w=>g[w]||(g[w]=d(w))},QM=/-(\w)/g,Bo=Lm(d=>d.replace(QM,(g,w)=>w?w.toUpperCase():"")),eI=/\B([A-Z])/g,Ou=Lm(d=>d.replace(eI,"-$1").toLowerCase()),Dm=Lm(d=>d.charAt(0).toUpperCase()+d.slice(1)),Wg=Lm(d=>d?`on${Dm(d)}`:""),ul=(d,g)=>!Object.is(d,g),um=(d,g)=>{for(let w=0;w<d.length;w++)d[w](g)},xm=(d,g,w)=>{Object.defineProperty(d,g,{configurable:!0,enumerable:!1,value:w})},Jd=d=>{const g=parseFloat(d);return isNaN(g)?d:g};let db;const Iw=()=>db||(db=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Oy(d){if(Pi(d)){const g={};for(let w=0;w<d.length;w++){const S=d[w],L=Sn(S)?nI(S):Oy(S);if(L)for(const k in L)g[k]=L[k]}return g}else if(Sn(d)||jr(d))return d}const tI=/;(?![^(]*\))/g,iI=/:([^]+)/,rI=/\/\*[^]*?\*\//g;function nI(d){const g={};return d.replace(rI,"").split(tI).forEach(w=>{if(w){const S=w.split(iI);S.length>1&&(g[S[0].trim()]=S[1].trim())}}),g}function Bs(d){let g="";if(Sn(d))g=d;else if(Pi(d))for(let w=0;w<d.length;w++){const S=Bs(d[w]);S&&(g+=S+" ")}else if(jr(d))for(const w in d)d[w]&&(g+=w+" ");return g.trim()}const sI="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",oI=Ly(sI);function Cw(d){return!!d||d===""}function aI(d,g){if(d.length!==g.length)return!1;let w=!0;for(let S=0;w&&S<d.length;S++)w=zm(d[S],g[S]);return w}function zm(d,g){if(d===g)return!0;let w=hb(d),S=hb(g);if(w||S)return w&&S?d.getTime()===g.getTime():!1;if(w=cl(d),S=cl(g),w||S)return d===g;if(w=Pi(d),S=Pi(g),w||S)return w&&S?aI(d,g):!1;if(w=jr(d),S=jr(g),w||S){if(!w||!S)return!1;const L=Object.keys(d).length,k=Object.keys(g).length;if(L!==k)return!1;for(const V in d){const X=d.hasOwnProperty(V),o=g.hasOwnProperty(V);if(X&&!o||!X&&o||!zm(d[V],g[V]))return!1}}return String(d)===String(g)}function lI(d,g){return d.findIndex(w=>zm(w,g))}const Pw=d=>Sn(d)?d:d==null?"":Pi(d)||jr(d)&&(d.toString===Aw||!Qi(d.toString))?JSON.stringify(d,Rw,2):String(d),Rw=(d,g)=>g&&g.__v_isRef?Rw(d,g.value):Su(g)?{[`Map(${g.size})`]:[...g.entries()].reduce((w,[S,L],k)=>(w[Xg(S,k)+" =>"]=L,w),{})}:Rm(g)?{[`Set(${g.size})`]:[...g.values()].map(w=>Xg(w))}:cl(g)?Xg(g):jr(g)&&!Pi(g)&&!Mw(g)?String(g):g,Xg=(d,g="")=>{var w;return cl(d)?`Symbol(${(w=d.description)!=null?w:g})`:d};/**
* @vue/reactivity v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Cs;class Lw{constructor(g=!1){this.detached=g,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Cs,!g&&Cs&&(this.index=(Cs.scopes||(Cs.scopes=[])).push(this)-1)}get active(){return this._active}run(g){if(this._active){const w=Cs;try{return Cs=this,g()}finally{Cs=w}}}on(){Cs=this}off(){Cs=this.parent}stop(g){if(this._active){let w,S;for(w=0,S=this.effects.length;w<S;w++)this.effects[w].stop();for(w=0,S=this.cleanups.length;w<S;w++)this.cleanups[w]();if(this.scopes)for(w=0,S=this.scopes.length;w<S;w++)this.scopes[w].stop(!0);if(!this.detached&&this.parent&&!g){const L=this.parent.scopes.pop();L&&L!==this&&(this.parent.scopes[this.index]=L,L.index=this.index)}this.parent=void 0,this._active=!1}}}function Dw(d){return new Lw(d)}function cI(d,g=Cs){g&&g.active&&g.effects.push(d)}function zw(){return Cs}function uI(d){Cs&&Cs.cleanups.push(d)}let fc;class By{constructor(g,w,S,L){this.fn=g,this.trigger=w,this.scheduler=S,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,cI(this,L)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,mc();for(let g=0;g<this._depsLength;g++){const w=this.deps[g];if(w.computed&&(hI(w.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),_c()}return this._dirtyLevel>=4}set dirty(g){this._dirtyLevel=g?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let g=ol,w=fc;try{return ol=!0,fc=this,this._runnings++,fb(this),this.fn()}finally{pb(this),this._runnings--,fc=w,ol=g}}stop(){var g;this.active&&(fb(this),pb(this),(g=this.onStop)==null||g.call(this),this.active=!1)}}function hI(d){return d.value}function fb(d){d._trackId++,d._depsLength=0}function pb(d){if(d.deps.length>d._depsLength){for(let g=d._depsLength;g<d.deps.length;g++)kw(d.deps[g],d);d.deps.length=d._depsLength}}function kw(d,g){const w=d.get(g);w!==void 0&&g._trackId!==w&&(d.delete(g),d.size===0&&d.cleanup())}let ol=!0,cy=0;const Ow=[];function mc(){Ow.push(ol),ol=!1}function _c(){const d=Ow.pop();ol=d===void 0?!0:d}function Fy(){cy++}function Ny(){for(cy--;!cy&&uy.length;)uy.shift()()}function Bw(d,g,w){if(g.get(d)!==d._trackId){g.set(d,d._trackId);const S=d.deps[d._depsLength];S!==g?(S&&kw(S,d),d.deps[d._depsLength++]=g):d._depsLength++}}const uy=[];function Fw(d,g,w){Fy();for(const S of d.keys()){let L;S._dirtyLevel<g&&(L??(L=d.get(S)===S._trackId))&&(S._shouldSchedule||(S._shouldSchedule=S._dirtyLevel===0),S._dirtyLevel=g),S._shouldSchedule&&(L??(L=d.get(S)===S._trackId))&&(S.trigger(),(!S._runnings||S.allowRecurse)&&S._dirtyLevel!==2&&(S._shouldSchedule=!1,S.scheduler&&uy.push(S.scheduler)))}Ny()}const Nw=(d,g)=>{const w=new Map;return w.cleanup=d,w.computed=g,w},vm=new WeakMap,pc=Symbol(""),hy=Symbol("");function ms(d,g,w){if(ol&&fc){let S=vm.get(d);S||vm.set(d,S=new Map);let L=S.get(w);L||S.set(w,L=Nw(()=>S.delete(w))),Bw(fc,L)}}function ua(d,g,w,S,L,k){const V=vm.get(d);if(!V)return;let X=[];if(g==="clear")X=[...V.values()];else if(w==="length"&&Pi(d)){const o=Number(S);V.forEach((re,oe)=>{(oe==="length"||!cl(oe)&&oe>=o)&&X.push(re)})}else switch(w!==void 0&&X.push(V.get(w)),g){case"add":Pi(d)?ky(w)&&X.push(V.get("length")):(X.push(V.get(pc)),Su(d)&&X.push(V.get(hy)));break;case"delete":Pi(d)||(X.push(V.get(pc)),Su(d)&&X.push(V.get(hy)));break;case"set":Su(d)&&X.push(V.get(pc));break}Fy();for(const o of X)o&&Fw(o,4);Ny()}function dI(d,g){var w;return(w=vm.get(d))==null?void 0:w.get(g)}const fI=Ly("__proto__,__v_isRef,__isVue"),Vw=new Set(Object.getOwnPropertyNames(Symbol).filter(d=>d!=="arguments"&&d!=="caller").map(d=>Symbol[d]).filter(cl)),mb=pI();function pI(){const d={};return["includes","indexOf","lastIndexOf"].forEach(g=>{d[g]=function(...w){const S=xr(this);for(let k=0,V=this.length;k<V;k++)ms(S,"get",k+"");const L=S[g](...w);return L===-1||L===!1?S[g](...w.map(xr)):L}}),["push","pop","shift","unshift","splice"].forEach(g=>{d[g]=function(...w){mc(),Fy();const S=xr(this)[g].apply(this,w);return Ny(),_c(),S}}),d}function mI(d){const g=xr(this);return ms(g,"has",d),g.hasOwnProperty(d)}class Uw{constructor(g=!1,w=!1){this._isReadonly=g,this._isShallow=w}get(g,w,S){const L=this._isReadonly,k=this._isShallow;if(w==="__v_isReactive")return!L;if(w==="__v_isReadonly")return L;if(w==="__v_isShallow")return k;if(w==="__v_raw")return S===(L?k?II:qw:k?$w:Gw).get(g)||Object.getPrototypeOf(g)===Object.getPrototypeOf(S)?g:void 0;const V=Pi(g);if(!L){if(V&&yr(mb,w))return Reflect.get(mb,w,S);if(w==="hasOwnProperty")return mI}const X=Reflect.get(g,w,S);return(cl(w)?Vw.has(w):fI(w))||(L||ms(g,"get",w),k)?X:An(X)?V&&ky(w)?X:X.value:jr(X)?L?Hw(X):Fo(X):X}}class jw extends Uw{constructor(g=!1){super(!1,g)}set(g,w,S,L){let k=g[w];if(!this._isShallow){const o=Ru(k);if(!bm(S)&&!Ru(S)&&(k=xr(k),S=xr(S)),!Pi(g)&&An(k)&&!An(S))return o?!1:(k.value=S,!0)}const V=Pi(g)&&ky(w)?Number(w)<g.length:yr(g,w),X=Reflect.set(g,w,S,L);return g===xr(L)&&(V?ul(S,k)&&ua(g,"set",w,S):ua(g,"add",w,S)),X}deleteProperty(g,w){const S=yr(g,w);g[w];const L=Reflect.deleteProperty(g,w);return L&&S&&ua(g,"delete",w,void 0),L}has(g,w){const S=Reflect.has(g,w);return(!cl(w)||!Vw.has(w))&&ms(g,"has",w),S}ownKeys(g){return ms(g,"iterate",Pi(g)?"length":pc),Reflect.ownKeys(g)}}class _I extends Uw{constructor(g=!1){super(!0,g)}set(g,w){return!0}deleteProperty(g,w){return!0}}const gI=new jw,yI=new _I,xI=new jw(!0),Vy=d=>d,km=d=>Reflect.getPrototypeOf(d);function nm(d,g,w=!1,S=!1){d=d.__v_raw;const L=xr(d),k=xr(g);w||(ul(g,k)&&ms(L,"get",g),ms(L,"get",k));const{has:V}=km(L),X=S?Vy:w?Gy:Qd;if(V.call(L,g))return X(d.get(g));if(V.call(L,k))return X(d.get(k));d!==L&&d.get(g)}function sm(d,g=!1){const w=this.__v_raw,S=xr(w),L=xr(d);return g||(ul(d,L)&&ms(S,"has",d),ms(S,"has",L)),d===L?w.has(d):w.has(d)||w.has(L)}function om(d,g=!1){return d=d.__v_raw,!g&&ms(xr(d),"iterate",pc),Reflect.get(d,"size",d)}function _b(d){d=xr(d);const g=xr(this);return km(g).has.call(g,d)||(g.add(d),ua(g,"add",d,d)),this}function gb(d,g){g=xr(g);const w=xr(this),{has:S,get:L}=km(w);let k=S.call(w,d);k||(d=xr(d),k=S.call(w,d));const V=L.call(w,d);return w.set(d,g),k?ul(g,V)&&ua(w,"set",d,g):ua(w,"add",d,g),this}function yb(d){const g=xr(this),{has:w,get:S}=km(g);let L=w.call(g,d);L||(d=xr(d),L=w.call(g,d)),S&&S.call(g,d);const k=g.delete(d);return L&&ua(g,"delete",d,void 0),k}function xb(){const d=xr(this),g=d.size!==0,w=d.clear();return g&&ua(d,"clear",void 0,void 0),w}function am(d,g){return function(S,L){const k=this,V=k.__v_raw,X=xr(V),o=g?Vy:d?Gy:Qd;return!d&&ms(X,"iterate",pc),V.forEach((re,oe)=>S.call(L,o(re),o(oe),k))}}function lm(d,g,w){return function(...S){const L=this.__v_raw,k=xr(L),V=Su(k),X=d==="entries"||d===Symbol.iterator&&V,o=d==="keys"&&V,re=L[d](...S),oe=w?Vy:g?Gy:Qd;return!g&&ms(k,"iterate",o?hy:pc),{next(){const{value:se,done:Se}=re.next();return Se?{value:se,done:Se}:{value:X?[oe(se[0]),oe(se[1])]:oe(se),done:Se}},[Symbol.iterator](){return this}}}}function Ja(d){return function(...g){return d==="delete"?!1:d==="clear"?void 0:this}}function vI(){const d={get(k){return nm(this,k)},get size(){return om(this)},has:sm,add:_b,set:gb,delete:yb,clear:xb,forEach:am(!1,!1)},g={get(k){return nm(this,k,!1,!0)},get size(){return om(this)},has:sm,add:_b,set:gb,delete:yb,clear:xb,forEach:am(!1,!0)},w={get(k){return nm(this,k,!0)},get size(){return om(this,!0)},has(k){return sm.call(this,k,!0)},add:Ja("add"),set:Ja("set"),delete:Ja("delete"),clear:Ja("clear"),forEach:am(!0,!1)},S={get(k){return nm(this,k,!0,!0)},get size(){return om(this,!0)},has(k){return sm.call(this,k,!0)},add:Ja("add"),set:Ja("set"),delete:Ja("delete"),clear:Ja("clear"),forEach:am(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(k=>{d[k]=lm(k,!1,!1),w[k]=lm(k,!0,!1),g[k]=lm(k,!1,!0),S[k]=lm(k,!0,!0)}),[d,w,g,S]}const[bI,wI,TI,EI]=vI();function Uy(d,g){const w=g?d?EI:TI:d?wI:bI;return(S,L,k)=>L==="__v_isReactive"?!d:L==="__v_isReadonly"?d:L==="__v_raw"?S:Reflect.get(yr(w,L)&&L in S?w:S,L,k)}const SI={get:Uy(!1,!1)},AI={get:Uy(!1,!0)},MI={get:Uy(!0,!1)},Gw=new WeakMap,$w=new WeakMap,qw=new WeakMap,II=new WeakMap;function CI(d){switch(d){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function PI(d){return d.__v_skip||!Object.isExtensible(d)?0:CI(JM(d))}function Fo(d){return Ru(d)?d:jy(d,!1,gI,SI,Gw)}function Zw(d){return jy(d,!1,xI,AI,$w)}function Hw(d){return jy(d,!0,yI,MI,qw)}function jy(d,g,w,S,L){if(!jr(d)||d.__v_raw&&!(g&&d.__v_isReactive))return d;const k=L.get(d);if(k)return k;const V=PI(d);if(V===0)return d;const X=new Proxy(d,V===2?S:w);return L.set(d,X),X}function al(d){return Ru(d)?al(d.__v_raw):!!(d&&d.__v_isReactive)}function Ru(d){return!!(d&&d.__v_isReadonly)}function bm(d){return!!(d&&d.__v_isShallow)}function Ww(d){return al(d)||Ru(d)}function xr(d){const g=d&&d.__v_raw;return g?xr(g):d}function Om(d){return Object.isExtensible(d)&&xm(d,"__v_skip",!0),d}const Qd=d=>jr(d)?Fo(d):d,Gy=d=>jr(d)?Hw(d):d;class Xw{constructor(g,w,S,L){this.getter=g,this._setter=w,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new By(()=>g(this._value),()=>hm(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!L,this.__v_isReadonly=S}get value(){const g=xr(this);return(!g._cacheable||g.effect.dirty)&&ul(g._value,g._value=g.effect.run())&&hm(g,4),Yw(g),g.effect._dirtyLevel>=2&&hm(g,2),g._value}set value(g){this._setter(g)}get _dirty(){return this.effect.dirty}set _dirty(g){this.effect.dirty=g}}function RI(d,g,w=!1){let S,L;const k=Qi(d);return k?(S=d,L=Os):(S=d.get,L=d.set),new Xw(S,L,k||!L,w)}function Yw(d){var g;ol&&fc&&(d=xr(d),Bw(fc,(g=d.dep)!=null?g:d.dep=Nw(()=>d.dep=void 0,d instanceof Xw?d:void 0)))}function hm(d,g=4,w){d=xr(d);const S=d.dep;S&&Fw(S,g)}function An(d){return!!(d&&d.__v_isRef===!0)}function ln(d){return Kw(d,!1)}function LI(d){return Kw(d,!0)}function Kw(d,g){return An(d)?d:new DI(d,g)}class DI{constructor(g,w){this.__v_isShallow=w,this.dep=void 0,this.__v_isRef=!0,this._rawValue=w?g:xr(g),this._value=w?g:Qd(g)}get value(){return Yw(this),this._value}set value(g){const w=this.__v_isShallow||bm(g)||Ru(g);g=w?g:xr(g),ul(g,this._rawValue)&&(this._rawValue=g,this._value=w?g:Qd(g),hm(this,4))}}function Yn(d){return An(d)?d.value:d}const zI={get:(d,g,w)=>Yn(Reflect.get(d,g,w)),set:(d,g,w,S)=>{const L=d[g];return An(L)&&!An(w)?(L.value=w,!0):Reflect.set(d,g,w,S)}};function Jw(d){return al(d)?d:new Proxy(d,zI)}function kI(d){const g=Pi(d)?new Array(d.length):{};for(const w in d)g[w]=BI(d,w);return g}class OI{constructor(g,w,S){this._object=g,this._key=w,this._defaultValue=S,this.__v_isRef=!0}get value(){const g=this._object[this._key];return g===void 0?this._defaultValue:g}set value(g){this._object[this._key]=g}get dep(){return dI(xr(this._object),this._key)}}function BI(d,g,w){const S=d[g];return An(S)?S:new OI(d,g,w)}/**
* @vue/runtime-core v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ll(d,g,w,S){try{return S?d(...S):d()}catch(L){Bm(L,g,w)}}function ro(d,g,w,S){if(Qi(d)){const k=ll(d,g,w,S);return k&&Sw(k)&&k.catch(V=>{Bm(V,g,w)}),k}const L=[];for(let k=0;k<d.length;k++)L.push(ro(d[k],g,w,S));return L}function Bm(d,g,w,S=!0){const L=g?g.vnode:null;if(g){let k=g.parent;const V=g.proxy,X=`https://vuejs.org/error-reference/#runtime-${w}`;for(;k;){const re=k.ec;if(re){for(let oe=0;oe<re.length;oe++)if(re[oe](d,V,X)===!1)return}k=k.parent}const o=g.appContext.config.errorHandler;if(o){ll(o,null,10,[d,V,X]);return}}FI(d,w,L,S)}function FI(d,g,w,S=!0){console.error(d)}let ef=!1,dy=!1;const Xn=[];let ko=0;const Au=[];let il=null,uc=0;const Qw=Promise.resolve();let $y=null;function Fm(d){const g=$y||Qw;return d?g.then(this?d.bind(this):d):g}function NI(d){let g=ko+1,w=Xn.length;for(;g<w;){const S=g+w>>>1,L=Xn[S],k=tf(L);k<d||k===d&&L.pre?g=S+1:w=S}return g}function qy(d){(!Xn.length||!Xn.includes(d,ef&&d.allowRecurse?ko+1:ko))&&(d.id==null?Xn.push(d):Xn.splice(NI(d.id),0,d),eT())}function eT(){!ef&&!dy&&(dy=!0,$y=Qw.then(iT))}function VI(d){const g=Xn.indexOf(d);g>ko&&Xn.splice(g,1)}function UI(d){Pi(d)?Au.push(...d):(!il||!il.includes(d,d.allowRecurse?uc+1:uc))&&Au.push(d),eT()}function vb(d,g,w=ef?ko+1:0){for(;w<Xn.length;w++){const S=Xn[w];if(S&&S.pre){if(d&&S.id!==d.uid)continue;Xn.splice(w,1),w--,S()}}}function tT(d){if(Au.length){const g=[...new Set(Au)].sort((w,S)=>tf(w)-tf(S));if(Au.length=0,il){il.push(...g);return}for(il=g,uc=0;uc<il.length;uc++)il[uc]();il=null,uc=0}}const tf=d=>d.id==null?1/0:d.id,jI=(d,g)=>{const w=tf(d)-tf(g);if(w===0){if(d.pre&&!g.pre)return-1;if(g.pre&&!d.pre)return 1}return w};function iT(d){dy=!1,ef=!0,Xn.sort(jI);try{for(ko=0;ko<Xn.length;ko++){const g=Xn[ko];g&&g.active!==!1&&ll(g,null,14)}}finally{ko=0,Xn.length=0,tT(),ef=!1,$y=null,(Xn.length||Au.length)&&iT()}}function GI(d,g,...w){if(d.isUnmounted)return;const S=d.vnode.props||Zr;let L=w;const k=g.startsWith("update:"),V=k&&g.slice(7);if(V&&V in S){const oe=`${V==="modelValue"?"model":V}Modifiers`,{number:se,trim:Se}=S[oe]||Zr;Se&&(L=w.map(Ie=>Sn(Ie)?Ie.trim():Ie)),se&&(L=w.map(Jd))}let X,o=S[X=Wg(g)]||S[X=Wg(Bo(g))];!o&&k&&(o=S[X=Wg(Ou(g))]),o&&ro(o,d,6,L);const re=S[X+"Once"];if(re){if(!d.emitted)d.emitted={};else if(d.emitted[X])return;d.emitted[X]=!0,ro(re,d,6,L)}}function rT(d,g,w=!1){const S=g.emitsCache,L=S.get(d);if(L!==void 0)return L;const k=d.emits;let V={},X=!1;if(!Qi(d)){const o=re=>{const oe=rT(re,g,!0);oe&&(X=!0,Bn(V,oe))};!w&&g.mixins.length&&g.mixins.forEach(o),d.extends&&o(d.extends),d.mixins&&d.mixins.forEach(o)}return!k&&!X?(jr(d)&&S.set(d,null),null):(Pi(k)?k.forEach(o=>V[o]=null):Bn(V,k),jr(d)&&S.set(d,V),V)}function Nm(d,g){return!d||!Pm(g)?!1:(g=g.slice(2).replace(/Once$/,""),yr(d,g[0].toLowerCase()+g.slice(1))||yr(d,Ou(g))||yr(d,g))}let bn=null,Vm=null;function wm(d){const g=bn;return bn=d,Vm=d&&d.type.__scopeId||null,g}function gc(d){Vm=d}function yc(){Vm=null}function $I(d,g=bn,w){if(!g||d._n)return d;const S=(...L)=>{S._d&&Rb(-1);const k=wm(g);let V;try{V=d(...L)}finally{wm(k),S._d&&Rb(1)}return V};return S._n=!0,S._c=!0,S._d=!0,S}function Yg(d){const{type:g,vnode:w,proxy:S,withProxy:L,props:k,propsOptions:[V],slots:X,attrs:o,emit:re,render:oe,renderCache:se,data:Se,setupState:Ie,ctx:qe,inheritAttrs:at}=d;let Ft,Nt;const ri=wm(d);try{if(w.shapeFlag&4){const Xi=L||S,er=Xi;Ft=zo(oe.call(er,Xi,se,k,Ie,Se,qe)),Nt=o}else{const Xi=g;Ft=zo(Xi.length>1?Xi(k,{attrs:o,slots:X,emit:re}):Xi(k,null)),Nt=g.props?o:qI(o)}}catch(Xi){Wd.length=0,Bm(Xi,d,1),Ft=nr(hl)}let Jt=Ft;if(Nt&&at!==!1){const Xi=Object.keys(Nt),{shapeFlag:er}=Jt;Xi.length&&er&7&&(V&&Xi.some(Dy)&&(Nt=ZI(Nt,V)),Jt=Lu(Jt,Nt))}return w.dirs&&(Jt=Lu(Jt),Jt.dirs=Jt.dirs?Jt.dirs.concat(w.dirs):w.dirs),w.transition&&(Jt.transition=w.transition),Ft=Jt,wm(ri),Ft}const qI=d=>{let g;for(const w in d)(w==="class"||w==="style"||Pm(w))&&((g||(g={}))[w]=d[w]);return g},ZI=(d,g)=>{const w={};for(const S in d)(!Dy(S)||!(S.slice(9)in g))&&(w[S]=d[S]);return w};function HI(d,g,w){const{props:S,children:L,component:k}=d,{props:V,children:X,patchFlag:o}=g,re=k.emitsOptions;if(g.dirs||g.transition)return!0;if(w&&o>=0){if(o&1024)return!0;if(o&16)return S?bb(S,V,re):!!V;if(o&8){const oe=g.dynamicProps;for(let se=0;se<oe.length;se++){const Se=oe[se];if(V[Se]!==S[Se]&&!Nm(re,Se))return!0}}}else return(L||X)&&(!X||!X.$stable)?!0:S===V?!1:S?V?bb(S,V,re):!0:!!V;return!1}function bb(d,g,w){const S=Object.keys(g);if(S.length!==Object.keys(d).length)return!0;for(let L=0;L<S.length;L++){const k=S[L];if(g[k]!==d[k]&&!Nm(w,k))return!0}return!1}function WI({vnode:d,parent:g},w){for(;g;){const S=g.subTree;if(S.suspense&&S.suspense.activeBranch===d&&(S.el=d.el),S===d)(d=g.vnode).el=w,g=g.parent;else break}}const nT="components";function XI(d,g){return KI(nT,d,!0,g)||d}const YI=Symbol.for("v-ndc");function KI(d,g,w=!0,S=!1){const L=bn||Rn;if(L){const k=L.type;if(d===nT){const X=WC(k,!1);if(X&&(X===g||X===Bo(g)||X===Dm(Bo(g))))return k}const V=wb(L[d]||k[d],g)||wb(L.appContext[d],g);return!V&&S?k:V}}function wb(d,g){return d&&(d[g]||d[Bo(g)]||d[Dm(Bo(g))])}const JI=d=>d.__isSuspense;function QI(d,g){g&&g.pendingBranch?Pi(d)?g.effects.push(...d):g.effects.push(d):UI(d)}const eC=Symbol.for("v-scx"),tC=()=>no(eC),cm={};function Mu(d,g,w){return sT(d,g,w)}function sT(d,g,{immediate:w,deep:S,flush:L,once:k,onTrack:V,onTrigger:X}=Zr){if(g&&k){const wi=g;g=(...vr)=>{wi(...vr),er()}}const o=Rn,re=wi=>S===!0?wi:dc(wi,S===!1?1:void 0);let oe,se=!1,Se=!1;if(An(d)?(oe=()=>d.value,se=bm(d)):al(d)?(oe=()=>re(d),se=!0):Pi(d)?(Se=!0,se=d.some(wi=>al(wi)||bm(wi)),oe=()=>d.map(wi=>{if(An(wi))return wi.value;if(al(wi))return re(wi);if(Qi(wi))return ll(wi,o,2)})):Qi(d)?g?oe=()=>ll(d,o,2):oe=()=>(Ie&&Ie(),ro(d,o,3,[qe])):oe=Os,g&&S){const wi=oe;oe=()=>dc(wi())}let Ie,qe=wi=>{Ie=Jt.onStop=()=>{ll(wi,o,4),Ie=Jt.onStop=void 0}},at;if($m)if(qe=Os,g?w&&ro(g,o,3,[oe(),Se?[]:void 0,qe]):oe(),L==="sync"){const wi=tC();at=wi.__watcherHandles||(wi.__watcherHandles=[])}else return Os;let Ft=Se?new Array(d.length).fill(cm):cm;const Nt=()=>{if(!(!Jt.active||!Jt.dirty))if(g){const wi=Jt.run();(S||se||(Se?wi.some((vr,zi)=>ul(vr,Ft[zi])):ul(wi,Ft)))&&(Ie&&Ie(),ro(g,o,3,[wi,Ft===cm?void 0:Se&&Ft[0]===cm?[]:Ft,qe]),Ft=wi)}else Jt.run()};Nt.allowRecurse=!!g;let ri;L==="sync"?ri=Nt:L==="post"?ri=()=>ps(Nt,o&&o.suspense):(Nt.pre=!0,o&&(Nt.id=o.uid),ri=()=>qy(Nt));const Jt=new By(oe,Os,ri),Xi=zw(),er=()=>{Jt.stop(),Xi&&zy(Xi.effects,Jt)};return g?w?Nt():Ft=Jt.run():L==="post"?ps(Jt.run.bind(Jt),o&&o.suspense):Jt.run(),at&&at.push(er),er}function iC(d,g,w){const S=this.proxy,L=Sn(d)?d.includes(".")?oT(S,d):()=>S[d]:d.bind(S,S);let k;Qi(g)?k=g:(k=g.handler,w=g);const V=lf(this),X=sT(L,k.bind(S),w);return V(),X}function oT(d,g){const w=g.split(".");return()=>{let S=d;for(let L=0;L<w.length&&S;L++)S=S[w[L]];return S}}function dc(d,g,w=0,S){if(!jr(d)||d.__v_skip)return d;if(g&&g>0){if(w>=g)return d;w++}if(S=S||new Set,S.has(d))return d;if(S.add(d),An(d))dc(d.value,g,w,S);else if(Pi(d))for(let L=0;L<d.length;L++)dc(d[L],g,w,S);else if(Rm(d)||Su(d))d.forEach(L=>{dc(L,g,w,S)});else if(Mw(d))for(const L in d)dc(d[L],g,w,S);return d}function fy(d,g){if(bn===null)return d;const w=qm(bn)||bn.proxy,S=d.dirs||(d.dirs=[]);for(let L=0;L<g.length;L++){let[k,V,X,o=Zr]=g[L];k&&(Qi(k)&&(k={mounted:k,updated:k}),k.deep&&dc(V),S.push({dir:k,instance:w,value:V,oldValue:void 0,arg:X,modifiers:o}))}return d}function lc(d,g,w,S){const L=d.dirs,k=g&&g.dirs;for(let V=0;V<L.length;V++){const X=L[V];k&&(X.oldValue=k[V].value);let o=X.dir[S];o&&(mc(),ro(o,w,8,[d.el,X,d,g]),_c())}}/*! #__NO_SIDE_EFFECTS__ */function Zy(d,g){return Qi(d)?Bn({name:d.name},g,{setup:d}):d}const Zd=d=>!!d.type.__asyncLoader,aT=d=>d.type.__isKeepAlive;function rC(d,g){lT(d,"a",g)}function nC(d,g){lT(d,"da",g)}function lT(d,g,w=Rn){const S=d.__wdc||(d.__wdc=()=>{let L=w;for(;L;){if(L.isDeactivated)return;L=L.parent}return d()});if(Um(g,S,w),w){let L=w.parent;for(;L&&L.parent;)aT(L.parent.vnode)&&sC(S,g,w,L),L=L.parent}}function sC(d,g,w,S){const L=Um(g,d,S,!0);cT(()=>{zy(S[g],L)},w)}function Um(d,g,w=Rn,S=!1){if(w){const L=w[d]||(w[d]=[]),k=g.__weh||(g.__weh=(...V)=>{if(w.isUnmounted)return;mc();const X=lf(w),o=ro(g,w,d,V);return X(),_c(),o});return S?L.unshift(k):L.push(k),k}}const da=d=>(g,w=Rn)=>(!$m||d==="sp")&&Um(d,(...S)=>g(...S),w),oC=da("bm"),Bu=da("m"),aC=da("bu"),lC=da("u"),cC=da("bum"),cT=da("um"),uC=da("sp"),hC=da("rtg"),dC=da("rtc");function fC(d,g=Rn){Um("ec",d,g)}function Tm(d,g,w,S){let L;const k=w&&w[S];if(Pi(d)||Sn(d)){L=new Array(d.length);for(let V=0,X=d.length;V<X;V++)L[V]=g(d[V],V,void 0,k&&k[V])}else if(typeof d=="number"){L=new Array(d);for(let V=0;V<d;V++)L[V]=g(V+1,V,void 0,k&&k[V])}else if(jr(d))if(d[Symbol.iterator])L=Array.from(d,(V,X)=>g(V,X,void 0,k&&k[X]));else{const V=Object.keys(d);L=new Array(V.length);for(let X=0,o=V.length;X<o;X++){const re=V[X];L[X]=g(d[re],re,X,k&&k[X])}}else L=[];return w&&(w[S]=L),L}function pC(d,g,w={},S,L){if(bn.isCE||bn.parent&&Zd(bn.parent)&&bn.parent.isCE)return g!=="default"&&(w.name=g),nr("slot",w,S&&S());let k=d[g];k&&k._c&&(k._d=!1),Wi();const V=k&&uT(k(w)),X=bT(En,{key:w.key||V&&V.key||`_${g}`},V||(S?S():[]),V&&d._===1?64:-2);return!L&&X.scopeId&&(X.slotScopeIds=[X.scopeId+"-s"]),k&&k._c&&(k._d=!0),X}function uT(d){return d.some(g=>Sm(g)?!(g.type===hl||g.type===En&&!uT(g.children)):!0)?d:null}const py=d=>d?ET(d)?qm(d)||d.proxy:py(d.parent):null,Hd=Bn(Object.create(null),{$:d=>d,$el:d=>d.vnode.el,$data:d=>d.data,$props:d=>d.props,$attrs:d=>d.attrs,$slots:d=>d.slots,$refs:d=>d.refs,$parent:d=>py(d.parent),$root:d=>py(d.root),$emit:d=>d.emit,$options:d=>Hy(d),$forceUpdate:d=>d.f||(d.f=()=>{d.effect.dirty=!0,qy(d.update)}),$nextTick:d=>d.n||(d.n=Fm.bind(d.proxy)),$watch:d=>iC.bind(d)}),Kg=(d,g)=>d!==Zr&&!d.__isScriptSetup&&yr(d,g),mC={get({_:d},g){const{ctx:w,setupState:S,data:L,props:k,accessCache:V,type:X,appContext:o}=d;let re;if(g[0]!=="$"){const Ie=V[g];if(Ie!==void 0)switch(Ie){case 1:return S[g];case 2:return L[g];case 4:return w[g];case 3:return k[g]}else{if(Kg(S,g))return V[g]=1,S[g];if(L!==Zr&&yr(L,g))return V[g]=2,L[g];if((re=d.propsOptions[0])&&yr(re,g))return V[g]=3,k[g];if(w!==Zr&&yr(w,g))return V[g]=4,w[g];my&&(V[g]=0)}}const oe=Hd[g];let se,Se;if(oe)return g==="$attrs"&&ms(d,"get",g),oe(d);if((se=X.__cssModules)&&(se=se[g]))return se;if(w!==Zr&&yr(w,g))return V[g]=4,w[g];if(Se=o.config.globalProperties,yr(Se,g))return Se[g]},set({_:d},g,w){const{data:S,setupState:L,ctx:k}=d;return Kg(L,g)?(L[g]=w,!0):S!==Zr&&yr(S,g)?(S[g]=w,!0):yr(d.props,g)||g[0]==="$"&&g.slice(1)in d?!1:(k[g]=w,!0)},has({_:{data:d,setupState:g,accessCache:w,ctx:S,appContext:L,propsOptions:k}},V){let X;return!!w[V]||d!==Zr&&yr(d,V)||Kg(g,V)||(X=k[0])&&yr(X,V)||yr(S,V)||yr(Hd,V)||yr(L.config.globalProperties,V)},defineProperty(d,g,w){return w.get!=null?d._.accessCache[g]=0:yr(w,"value")&&this.set(d,g,w.value,null),Reflect.defineProperty(d,g,w)}};function _C(){return gC().slots}function gC(){const d=$C();return d.setupContext||(d.setupContext=AT(d))}function Tb(d){return Pi(d)?d.reduce((g,w)=>(g[w]=null,g),{}):d}let my=!0;function yC(d){const g=Hy(d),w=d.proxy,S=d.ctx;my=!1,g.beforeCreate&&Eb(g.beforeCreate,d,"bc");const{data:L,computed:k,methods:V,watch:X,provide:o,inject:re,created:oe,beforeMount:se,mounted:Se,beforeUpdate:Ie,updated:qe,activated:at,deactivated:Ft,beforeDestroy:Nt,beforeUnmount:ri,destroyed:Jt,unmounted:Xi,render:er,renderTracked:wi,renderTriggered:vr,errorCaptured:zi,serverPrefetch:Ue,expose:Sr,inheritAttrs:Hr,components:ni,directives:br,filters:ss}=g;if(re&&xC(re,S,null),V)for(const Fi in V){const zt=V[Fi];Qi(zt)&&(S[Fi]=zt.bind(w))}if(L){const Fi=L.call(w,w);jr(Fi)&&(d.data=Fo(Fi))}if(my=!0,k)for(const Fi in k){const zt=k[Fi],Mn=Qi(zt)?zt.bind(w,w):Qi(zt.get)?zt.get.bind(w,w):Os,wn=!Qi(zt)&&Qi(zt.set)?zt.set.bind(w):Os,Wr=Ur({get:Mn,set:wn});Object.defineProperty(S,Fi,{enumerable:!0,configurable:!0,get:()=>Wr.value,set:dr=>Wr.value=dr})}if(X)for(const Fi in X)hT(X[Fi],S,w,Fi);if(o){const Fi=Qi(o)?o.call(w):o;Reflect.ownKeys(Fi).forEach(zt=>{dm(zt,Fi[zt])})}oe&&Eb(oe,d,"c");function Vi(Fi,zt){Pi(zt)?zt.forEach(Mn=>Fi(Mn.bind(w))):zt&&Fi(zt.bind(w))}if(Vi(oC,se),Vi(Bu,Se),Vi(aC,Ie),Vi(lC,qe),Vi(rC,at),Vi(nC,Ft),Vi(fC,zi),Vi(dC,wi),Vi(hC,vr),Vi(cC,ri),Vi(cT,Xi),Vi(uC,Ue),Pi(Sr))if(Sr.length){const Fi=d.exposed||(d.exposed={});Sr.forEach(zt=>{Object.defineProperty(Fi,zt,{get:()=>w[zt],set:Mn=>w[zt]=Mn})})}else d.exposed||(d.exposed={});er&&d.render===Os&&(d.render=er),Hr!=null&&(d.inheritAttrs=Hr),ni&&(d.components=ni),br&&(d.directives=br)}function xC(d,g,w=Os){Pi(d)&&(d=_y(d));for(const S in d){const L=d[S];let k;jr(L)?"default"in L?k=no(L.from||S,L.default,!0):k=no(L.from||S):k=no(L),An(k)?Object.defineProperty(g,S,{enumerable:!0,configurable:!0,get:()=>k.value,set:V=>k.value=V}):g[S]=k}}function Eb(d,g,w){ro(Pi(d)?d.map(S=>S.bind(g.proxy)):d.bind(g.proxy),g,w)}function hT(d,g,w,S){const L=S.includes(".")?oT(w,S):()=>w[S];if(Sn(d)){const k=g[d];Qi(k)&&Mu(L,k)}else if(Qi(d))Mu(L,d.bind(w));else if(jr(d))if(Pi(d))d.forEach(k=>hT(k,g,w,S));else{const k=Qi(d.handler)?d.handler.bind(w):g[d.handler];Qi(k)&&Mu(L,k,d)}}function Hy(d){const g=d.type,{mixins:w,extends:S}=g,{mixins:L,optionsCache:k,config:{optionMergeStrategies:V}}=d.appContext,X=k.get(g);let o;return X?o=X:!L.length&&!w&&!S?o=g:(o={},L.length&&L.forEach(re=>Em(o,re,V,!0)),Em(o,g,V)),jr(g)&&k.set(g,o),o}function Em(d,g,w,S=!1){const{mixins:L,extends:k}=g;k&&Em(d,k,w,!0),L&&L.forEach(V=>Em(d,V,w,!0));for(const V in g)if(!(S&&V==="expose")){const X=vC[V]||w&&w[V];d[V]=X?X(d[V],g[V]):g[V]}return d}const vC={data:Sb,props:Ab,emits:Ab,methods:$d,computed:$d,beforeCreate:rs,created:rs,beforeMount:rs,mounted:rs,beforeUpdate:rs,updated:rs,beforeDestroy:rs,beforeUnmount:rs,destroyed:rs,unmounted:rs,activated:rs,deactivated:rs,errorCaptured:rs,serverPrefetch:rs,components:$d,directives:$d,watch:wC,provide:Sb,inject:bC};function Sb(d,g){return g?d?function(){return Bn(Qi(d)?d.call(this,this):d,Qi(g)?g.call(this,this):g)}:g:d}function bC(d,g){return $d(_y(d),_y(g))}function _y(d){if(Pi(d)){const g={};for(let w=0;w<d.length;w++)g[d[w]]=d[w];return g}return d}function rs(d,g){return d?[...new Set([].concat(d,g))]:g}function $d(d,g){return d?Bn(Object.create(null),d,g):g}function Ab(d,g){return d?Pi(d)&&Pi(g)?[...new Set([...d,...g])]:Bn(Object.create(null),Tb(d),Tb(g??{})):g}function wC(d,g){if(!d)return g;if(!g)return d;const w=Bn(Object.create(null),d);for(const S in g)w[S]=rs(d[S],g[S]);return w}function dT(){return{app:null,config:{isNativeTag:YM,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let TC=0;function EC(d,g){return function(S,L=null){Qi(S)||(S=Bn({},S)),L!=null&&!jr(L)&&(L=null);const k=dT(),V=new WeakSet;let X=!1;const o=k.app={_uid:TC++,_component:S,_props:L,_container:null,_context:k,_instance:null,version:YC,get config(){return k.config},set config(re){},use(re,...oe){return V.has(re)||(re&&Qi(re.install)?(V.add(re),re.install(o,...oe)):Qi(re)&&(V.add(re),re(o,...oe))),o},mixin(re){return k.mixins.includes(re)||k.mixins.push(re),o},component(re,oe){return oe?(k.components[re]=oe,o):k.components[re]},directive(re,oe){return oe?(k.directives[re]=oe,o):k.directives[re]},mount(re,oe,se){if(!X){const Se=nr(S,L);return Se.appContext=k,se===!0?se="svg":se===!1&&(se=void 0),oe&&g?g(Se,re):d(Se,re,se),X=!0,o._container=re,re.__vue_app__=o,qm(Se.component)||Se.component.proxy}},unmount(){X&&(d(null,o._container),delete o._container.__vue_app__)},provide(re,oe){return k.provides[re]=oe,o},runWithContext(re){const oe=Iu;Iu=o;try{return re()}finally{Iu=oe}}};return o}}let Iu=null;function dm(d,g){if(Rn){let w=Rn.provides;const S=Rn.parent&&Rn.parent.provides;S===w&&(w=Rn.provides=Object.create(S)),w[d]=g}}function no(d,g,w=!1){const S=Rn||bn;if(S||Iu){const L=S?S.parent==null?S.vnode.appContext&&S.vnode.appContext.provides:S.parent.provides:Iu._context.provides;if(L&&d in L)return L[d];if(arguments.length>1)return w&&Qi(g)?g.call(S&&S.proxy):g}}function SC(){return!!(Rn||bn||Iu)}function AC(d,g,w,S=!1){const L={},k={};xm(k,Gm,1),d.propsDefaults=Object.create(null),fT(d,g,L,k);for(const V in d.propsOptions[0])V in L||(L[V]=void 0);w?d.props=S?L:Zw(L):d.type.props?d.props=L:d.props=k,d.attrs=k}function MC(d,g,w,S){const{props:L,attrs:k,vnode:{patchFlag:V}}=d,X=xr(L),[o]=d.propsOptions;let re=!1;if((S||V>0)&&!(V&16)){if(V&8){const oe=d.vnode.dynamicProps;for(let se=0;se<oe.length;se++){let Se=oe[se];if(Nm(d.emitsOptions,Se))continue;const Ie=g[Se];if(o)if(yr(k,Se))Ie!==k[Se]&&(k[Se]=Ie,re=!0);else{const qe=Bo(Se);L[qe]=gy(o,X,qe,Ie,d,!1)}else Ie!==k[Se]&&(k[Se]=Ie,re=!0)}}}else{fT(d,g,L,k)&&(re=!0);let oe;for(const se in X)(!g||!yr(g,se)&&((oe=Ou(se))===se||!yr(g,oe)))&&(o?w&&(w[se]!==void 0||w[oe]!==void 0)&&(L[se]=gy(o,X,se,void 0,d,!0)):delete L[se]);if(k!==X)for(const se in k)(!g||!yr(g,se))&&(delete k[se],re=!0)}re&&ua(d,"set","$attrs")}function fT(d,g,w,S){const[L,k]=d.propsOptions;let V=!1,X;if(g)for(let o in g){if(qd(o))continue;const re=g[o];let oe;L&&yr(L,oe=Bo(o))?!k||!k.includes(oe)?w[oe]=re:(X||(X={}))[oe]=re:Nm(d.emitsOptions,o)||(!(o in S)||re!==S[o])&&(S[o]=re,V=!0)}if(k){const o=xr(w),re=X||Zr;for(let oe=0;oe<k.length;oe++){const se=k[oe];w[se]=gy(L,o,se,re[se],d,!yr(re,se))}}return V}function gy(d,g,w,S,L,k){const V=d[w];if(V!=null){const X=yr(V,"default");if(X&&S===void 0){const o=V.default;if(V.type!==Function&&!V.skipFactory&&Qi(o)){const{propsDefaults:re}=L;if(w in re)S=re[w];else{const oe=lf(L);S=re[w]=o.call(null,g),oe()}}else S=o}V[0]&&(k&&!X?S=!1:V[1]&&(S===""||S===Ou(w))&&(S=!0))}return S}function pT(d,g,w=!1){const S=g.propsCache,L=S.get(d);if(L)return L;const k=d.props,V={},X=[];let o=!1;if(!Qi(d)){const oe=se=>{o=!0;const[Se,Ie]=pT(se,g,!0);Bn(V,Se),Ie&&X.push(...Ie)};!w&&g.mixins.length&&g.mixins.forEach(oe),d.extends&&oe(d.extends),d.mixins&&d.mixins.forEach(oe)}if(!k&&!o)return jr(d)&&S.set(d,Eu),Eu;if(Pi(k))for(let oe=0;oe<k.length;oe++){const se=Bo(k[oe]);Mb(se)&&(V[se]=Zr)}else if(k)for(const oe in k){const se=Bo(oe);if(Mb(se)){const Se=k[oe],Ie=V[se]=Pi(Se)||Qi(Se)?{type:Se}:Bn({},Se);if(Ie){const qe=Pb(Boolean,Ie.type),at=Pb(String,Ie.type);Ie[0]=qe>-1,Ie[1]=at<0||qe<at,(qe>-1||yr(Ie,"default"))&&X.push(se)}}}const re=[V,X];return jr(d)&&S.set(d,re),re}function Mb(d){return d[0]!=="$"&&!qd(d)}function Ib(d){return d===null?"null":typeof d=="function"?d.name||"":typeof d=="object"&&d.constructor&&d.constructor.name||""}function Cb(d,g){return Ib(d)===Ib(g)}function Pb(d,g){return Pi(g)?g.findIndex(w=>Cb(w,d)):Qi(g)&&Cb(g,d)?0:-1}const mT=d=>d[0]==="_"||d==="$stable",Wy=d=>Pi(d)?d.map(zo):[zo(d)],IC=(d,g,w)=>{if(g._n)return g;const S=$I((...L)=>Wy(g(...L)),w);return S._c=!1,S},_T=(d,g,w)=>{const S=d._ctx;for(const L in d){if(mT(L))continue;const k=d[L];if(Qi(k))g[L]=IC(L,k,S);else if(k!=null){const V=Wy(k);g[L]=()=>V}}},gT=(d,g)=>{const w=Wy(g);d.slots.default=()=>w},CC=(d,g)=>{if(d.vnode.shapeFlag&32){const w=g._;w?(d.slots=xr(g),xm(g,"_",w)):_T(g,d.slots={})}else d.slots={},g&&gT(d,g);xm(d.slots,Gm,1)},PC=(d,g,w)=>{const{vnode:S,slots:L}=d;let k=!0,V=Zr;if(S.shapeFlag&32){const X=g._;X?w&&X===1?k=!1:(Bn(L,g),!w&&X===1&&delete L._):(k=!g.$stable,_T(g,L)),V=g}else g&&(gT(d,g),V={default:1});if(k)for(const X in L)!mT(X)&&V[X]==null&&delete L[X]};function yy(d,g,w,S,L=!1){if(Pi(d)){d.forEach((Se,Ie)=>yy(Se,g&&(Pi(g)?g[Ie]:g),w,S,L));return}if(Zd(S)&&!L)return;const k=S.shapeFlag&4?qm(S.component)||S.component.proxy:S.el,V=L?null:k,{i:X,r:o}=d,re=g&&g.r,oe=X.refs===Zr?X.refs={}:X.refs,se=X.setupState;if(re!=null&&re!==o&&(Sn(re)?(oe[re]=null,yr(se,re)&&(se[re]=null)):An(re)&&(re.value=null)),Qi(o))ll(o,X,12,[V,oe]);else{const Se=Sn(o),Ie=An(o);if(Se||Ie){const qe=()=>{if(d.f){const at=Se?yr(se,o)?se[o]:oe[o]:o.value;L?Pi(at)&&zy(at,k):Pi(at)?at.includes(k)||at.push(k):Se?(oe[o]=[k],yr(se,o)&&(se[o]=oe[o])):(o.value=[k],d.k&&(oe[d.k]=o.value))}else Se?(oe[o]=V,yr(se,o)&&(se[o]=V)):Ie&&(o.value=V,d.k&&(oe[d.k]=V))};V?(qe.id=-1,ps(qe,w)):qe()}}}const ps=QI;function RC(d){return LC(d)}function LC(d,g){const w=Iw();w.__VUE__=!0;const{insert:S,remove:L,patchProp:k,createElement:V,createText:X,createComment:o,setText:re,setElementText:oe,parentNode:se,nextSibling:Se,setScopeId:Ie=Os,insertStaticContent:qe}=d,at=(de,pe,Be,ot=null,Ke=null,Tt=null,Vt=void 0,ft=null,Lt=!!pe.dynamicChildren)=>{if(de===pe)return;de&&!Ud(de,pe)&&(ot=it(de),dr(de,Ke,Tt,!0),de=null),pe.patchFlag===-2&&(Lt=!1,pe.dynamicChildren=null);const{type:gt,ref:jt,shapeFlag:si}=pe;switch(gt){case jm:Ft(de,pe,Be,ot);break;case hl:Nt(de,pe,Be,ot);break;case fm:de==null&&ri(pe,Be,ot,Vt);break;case En:ni(de,pe,Be,ot,Ke,Tt,Vt,ft,Lt);break;default:si&1?er(de,pe,Be,ot,Ke,Tt,Vt,ft,Lt):si&6?br(de,pe,Be,ot,Ke,Tt,Vt,ft,Lt):(si&64||si&128)&&gt.process(de,pe,Be,ot,Ke,Tt,Vt,ft,Lt,qt)}jt!=null&&Ke&&yy(jt,de&&de.ref,Tt,pe||de,!pe)},Ft=(de,pe,Be,ot)=>{if(de==null)S(pe.el=X(pe.children),Be,ot);else{const Ke=pe.el=de.el;pe.children!==de.children&&re(Ke,pe.children)}},Nt=(de,pe,Be,ot)=>{de==null?S(pe.el=o(pe.children||""),Be,ot):pe.el=de.el},ri=(de,pe,Be,ot)=>{[de.el,de.anchor]=qe(de.children,pe,Be,ot,de.el,de.anchor)},Jt=({el:de,anchor:pe},Be,ot)=>{let Ke;for(;de&&de!==pe;)Ke=Se(de),S(de,Be,ot),de=Ke;S(pe,Be,ot)},Xi=({el:de,anchor:pe})=>{let Be;for(;de&&de!==pe;)Be=Se(de),L(de),de=Be;L(pe)},er=(de,pe,Be,ot,Ke,Tt,Vt,ft,Lt)=>{pe.type==="svg"?Vt="svg":pe.type==="math"&&(Vt="mathml"),de==null?wi(pe,Be,ot,Ke,Tt,Vt,ft,Lt):Ue(de,pe,Ke,Tt,Vt,ft,Lt)},wi=(de,pe,Be,ot,Ke,Tt,Vt,ft)=>{let Lt,gt;const{props:jt,shapeFlag:si,transition:ei,dirs:we}=de;if(Lt=de.el=V(de.type,Tt,jt&&jt.is,jt),si&8?oe(Lt,de.children):si&16&&zi(de.children,Lt,null,ot,Ke,Jg(de,Tt),Vt,ft),we&&lc(de,null,ot,"created"),vr(Lt,de,de.scopeId,Vt,ot),jt){for(const te in jt)te!=="value"&&!qd(te)&&k(Lt,te,null,jt[te],Tt,de.children,ot,Ke,Xr);"value"in jt&&k(Lt,"value",null,jt.value,Tt),(gt=jt.onVnodeBeforeMount)&&Do(gt,ot,de)}we&&lc(de,null,ot,"beforeMount");const q=DC(Ke,ei);q&&ei.beforeEnter(Lt),S(Lt,pe,Be),((gt=jt&&jt.onVnodeMounted)||q||we)&&ps(()=>{gt&&Do(gt,ot,de),q&&ei.enter(Lt),we&&lc(de,null,ot,"mounted")},Ke)},vr=(de,pe,Be,ot,Ke)=>{if(Be&&Ie(de,Be),ot)for(let Tt=0;Tt<ot.length;Tt++)Ie(de,ot[Tt]);if(Ke){let Tt=Ke.subTree;if(pe===Tt){const Vt=Ke.vnode;vr(de,Vt,Vt.scopeId,Vt.slotScopeIds,Ke.parent)}}},zi=(de,pe,Be,ot,Ke,Tt,Vt,ft,Lt=0)=>{for(let gt=Lt;gt<de.length;gt++){const jt=de[gt]=ft?rl(de[gt]):zo(de[gt]);at(null,jt,pe,Be,ot,Ke,Tt,Vt,ft)}},Ue=(de,pe,Be,ot,Ke,Tt,Vt)=>{const ft=pe.el=de.el;let{patchFlag:Lt,dynamicChildren:gt,dirs:jt}=pe;Lt|=de.patchFlag&16;const si=de.props||Zr,ei=pe.props||Zr;let we;if(Be&&cc(Be,!1),(we=ei.onVnodeBeforeUpdate)&&Do(we,Be,pe,de),jt&&lc(pe,de,Be,"beforeUpdate"),Be&&cc(Be,!0),gt?Sr(de.dynamicChildren,gt,ft,Be,ot,Jg(pe,Ke),Tt):Vt||zt(de,pe,ft,null,Be,ot,Jg(pe,Ke),Tt,!1),Lt>0){if(Lt&16)Hr(ft,pe,si,ei,Be,ot,Ke);else if(Lt&2&&si.class!==ei.class&&k(ft,"class",null,ei.class,Ke),Lt&4&&k(ft,"style",si.style,ei.style,Ke),Lt&8){const q=pe.dynamicProps;for(let te=0;te<q.length;te++){const ue=q[te],Ce=si[ue],Oe=ei[ue];(Oe!==Ce||ue==="value")&&k(ft,ue,Ce,Oe,Ke,de.children,Be,ot,Xr)}}Lt&1&&de.children!==pe.children&&oe(ft,pe.children)}else!Vt&&gt==null&&Hr(ft,pe,si,ei,Be,ot,Ke);((we=ei.onVnodeUpdated)||jt)&&ps(()=>{we&&Do(we,Be,pe,de),jt&&lc(pe,de,Be,"updated")},ot)},Sr=(de,pe,Be,ot,Ke,Tt,Vt)=>{for(let ft=0;ft<pe.length;ft++){const Lt=de[ft],gt=pe[ft],jt=Lt.el&&(Lt.type===En||!Ud(Lt,gt)||Lt.shapeFlag&70)?se(Lt.el):Be;at(Lt,gt,jt,null,ot,Ke,Tt,Vt,!0)}},Hr=(de,pe,Be,ot,Ke,Tt,Vt)=>{if(Be!==ot){if(Be!==Zr)for(const ft in Be)!qd(ft)&&!(ft in ot)&&k(de,ft,Be[ft],null,Vt,pe.children,Ke,Tt,Xr);for(const ft in ot){if(qd(ft))continue;const Lt=ot[ft],gt=Be[ft];Lt!==gt&&ft!=="value"&&k(de,ft,gt,Lt,Vt,pe.children,Ke,Tt,Xr)}"value"in ot&&k(de,"value",Be.value,ot.value,Vt)}},ni=(de,pe,Be,ot,Ke,Tt,Vt,ft,Lt)=>{const gt=pe.el=de?de.el:X(""),jt=pe.anchor=de?de.anchor:X("");let{patchFlag:si,dynamicChildren:ei,slotScopeIds:we}=pe;we&&(ft=ft?ft.concat(we):we),de==null?(S(gt,Be,ot),S(jt,Be,ot),zi(pe.children||[],Be,jt,Ke,Tt,Vt,ft,Lt)):si>0&&si&64&&ei&&de.dynamicChildren?(Sr(de.dynamicChildren,ei,Be,Ke,Tt,Vt,ft),(pe.key!=null||Ke&&pe===Ke.subTree)&&yT(de,pe,!0)):zt(de,pe,Be,jt,Ke,Tt,Vt,ft,Lt)},br=(de,pe,Be,ot,Ke,Tt,Vt,ft,Lt)=>{pe.slotScopeIds=ft,de==null?pe.shapeFlag&512?Ke.ctx.activate(pe,Be,ot,Vt,Lt):ss(pe,Be,ot,Ke,Tt,Vt,Lt):lt(de,pe,Lt)},ss=(de,pe,Be,ot,Ke,Tt,Vt)=>{const ft=de.component=GC(de,ot,Ke);if(aT(de)&&(ft.ctx.renderer=qt),qC(ft),ft.asyncDep){if(Ke&&Ke.registerDep(ft,Vi),!de.el){const Lt=ft.subTree=nr(hl);Nt(null,Lt,pe,Be)}}else Vi(ft,de,pe,Be,Ke,Tt,Vt)},lt=(de,pe,Be)=>{const ot=pe.component=de.component;if(HI(de,pe,Be))if(ot.asyncDep&&!ot.asyncResolved){Fi(ot,pe,Be);return}else ot.next=pe,VI(ot.update),ot.effect.dirty=!0,ot.update();else pe.el=de.el,ot.vnode=pe},Vi=(de,pe,Be,ot,Ke,Tt,Vt)=>{const ft=()=>{if(de.isMounted){let{next:jt,bu:si,u:ei,parent:we,vnode:q}=de;{const Xe=xT(de);if(Xe){jt&&(jt.el=q.el,Fi(de,jt,Vt)),Xe.asyncDep.then(()=>{de.isUnmounted||ft()});return}}let te=jt,ue;cc(de,!1),jt?(jt.el=q.el,Fi(de,jt,Vt)):jt=q,si&&um(si),(ue=jt.props&&jt.props.onVnodeBeforeUpdate)&&Do(ue,we,jt,q),cc(de,!0);const Ce=Yg(de),Oe=de.subTree;de.subTree=Ce,at(Oe,Ce,se(Oe.el),it(Oe),de,Ke,Tt),jt.el=Ce.el,te===null&&WI(de,Ce.el),ei&&ps(ei,Ke),(ue=jt.props&&jt.props.onVnodeUpdated)&&ps(()=>Do(ue,we,jt,q),Ke)}else{let jt;const{el:si,props:ei}=pe,{bm:we,m:q,parent:te}=de,ue=Zd(pe);if(cc(de,!1),we&&um(we),!ue&&(jt=ei&&ei.onVnodeBeforeMount)&&Do(jt,te,pe),cc(de,!0),si&&tr){const Ce=()=>{de.subTree=Yg(de),tr(si,de.subTree,de,Ke,null)};ue?pe.type.__asyncLoader().then(()=>!de.isUnmounted&&Ce()):Ce()}else{const Ce=de.subTree=Yg(de);at(null,Ce,Be,ot,de,Ke,Tt),pe.el=Ce.el}if(q&&ps(q,Ke),!ue&&(jt=ei&&ei.onVnodeMounted)){const Ce=pe;ps(()=>Do(jt,te,Ce),Ke)}(pe.shapeFlag&256||te&&Zd(te.vnode)&&te.vnode.shapeFlag&256)&&de.a&&ps(de.a,Ke),de.isMounted=!0,pe=Be=ot=null}},Lt=de.effect=new By(ft,Os,()=>qy(gt),de.scope),gt=de.update=()=>{Lt.dirty&&Lt.run()};gt.id=de.uid,cc(de,!0),gt()},Fi=(de,pe,Be)=>{pe.component=de;const ot=de.vnode.props;de.vnode=pe,de.next=null,MC(de,pe.props,ot,Be),PC(de,pe.children,Be),mc(),vb(de),_c()},zt=(de,pe,Be,ot,Ke,Tt,Vt,ft,Lt=!1)=>{const gt=de&&de.children,jt=de?de.shapeFlag:0,si=pe.children,{patchFlag:ei,shapeFlag:we}=pe;if(ei>0){if(ei&128){wn(gt,si,Be,ot,Ke,Tt,Vt,ft,Lt);return}else if(ei&256){Mn(gt,si,Be,ot,Ke,Tt,Vt,ft,Lt);return}}we&8?(jt&16&&Xr(gt,Ke,Tt),si!==gt&&oe(Be,si)):jt&16?we&16?wn(gt,si,Be,ot,Ke,Tt,Vt,ft,Lt):Xr(gt,Ke,Tt,!0):(jt&8&&oe(Be,""),we&16&&zi(si,Be,ot,Ke,Tt,Vt,ft,Lt))},Mn=(de,pe,Be,ot,Ke,Tt,Vt,ft,Lt)=>{de=de||Eu,pe=pe||Eu;const gt=de.length,jt=pe.length,si=Math.min(gt,jt);let ei;for(ei=0;ei<si;ei++){const we=pe[ei]=Lt?rl(pe[ei]):zo(pe[ei]);at(de[ei],we,Be,null,Ke,Tt,Vt,ft,Lt)}gt>jt?Xr(de,Ke,Tt,!0,!1,si):zi(pe,Be,ot,Ke,Tt,Vt,ft,Lt,si)},wn=(de,pe,Be,ot,Ke,Tt,Vt,ft,Lt)=>{let gt=0;const jt=pe.length;let si=de.length-1,ei=jt-1;for(;gt<=si&&gt<=ei;){const we=de[gt],q=pe[gt]=Lt?rl(pe[gt]):zo(pe[gt]);if(Ud(we,q))at(we,q,Be,null,Ke,Tt,Vt,ft,Lt);else break;gt++}for(;gt<=si&&gt<=ei;){const we=de[si],q=pe[ei]=Lt?rl(pe[ei]):zo(pe[ei]);if(Ud(we,q))at(we,q,Be,null,Ke,Tt,Vt,ft,Lt);else break;si--,ei--}if(gt>si){if(gt<=ei){const we=ei+1,q=we<jt?pe[we].el:ot;for(;gt<=ei;)at(null,pe[gt]=Lt?rl(pe[gt]):zo(pe[gt]),Be,q,Ke,Tt,Vt,ft,Lt),gt++}}else if(gt>ei)for(;gt<=si;)dr(de[gt],Ke,Tt,!0),gt++;else{const we=gt,q=gt,te=new Map;for(gt=q;gt<=ei;gt++){const ht=pe[gt]=Lt?rl(pe[gt]):zo(pe[gt]);ht.key!=null&&te.set(ht.key,gt)}let ue,Ce=0;const Oe=ei-q+1;let Xe=!1,St=0;const ke=new Array(Oe);for(gt=0;gt<Oe;gt++)ke[gt]=0;for(gt=we;gt<=si;gt++){const ht=de[gt];if(Ce>=Oe){dr(ht,Ke,Tt,!0);continue}let bt;if(ht.key!=null)bt=te.get(ht.key);else for(ue=q;ue<=ei;ue++)if(ke[ue-q]===0&&Ud(ht,pe[ue])){bt=ue;break}bt===void 0?dr(ht,Ke,Tt,!0):(ke[bt-q]=gt+1,bt>=St?St=bt:Xe=!0,at(ht,pe[bt],Be,null,Ke,Tt,Vt,ft,Lt),Ce++)}const It=Xe?zC(ke):Eu;for(ue=It.length-1,gt=Oe-1;gt>=0;gt--){const ht=q+gt,bt=pe[ht],fi=ht+1<jt?pe[ht+1].el:ot;ke[gt]===0?at(null,bt,Be,fi,Ke,Tt,Vt,ft,Lt):Xe&&(ue<0||gt!==It[ue]?Wr(bt,Be,fi,2):ue--)}}},Wr=(de,pe,Be,ot,Ke=null)=>{const{el:Tt,type:Vt,transition:ft,children:Lt,shapeFlag:gt}=de;if(gt&6){Wr(de.component.subTree,pe,Be,ot);return}if(gt&128){de.suspense.move(pe,Be,ot);return}if(gt&64){Vt.move(de,pe,Be,qt);return}if(Vt===En){S(Tt,pe,Be);for(let si=0;si<Lt.length;si++)Wr(Lt[si],pe,Be,ot);S(de.anchor,pe,Be);return}if(Vt===fm){Jt(de,pe,Be);return}if(ot!==2&&gt&1&&ft)if(ot===0)ft.beforeEnter(Tt),S(Tt,pe,Be),ps(()=>ft.enter(Tt),Ke);else{const{leave:si,delayLeave:ei,afterLeave:we}=ft,q=()=>S(Tt,pe,Be),te=()=>{si(Tt,()=>{q(),we&&we()})};ei?ei(Tt,q,te):te()}else S(Tt,pe,Be)},dr=(de,pe,Be,ot=!1,Ke=!1)=>{const{type:Tt,props:Vt,ref:ft,children:Lt,dynamicChildren:gt,shapeFlag:jt,patchFlag:si,dirs:ei}=de;if(ft!=null&&yy(ft,null,Be,de,!0),jt&256){pe.ctx.deactivate(de);return}const we=jt&1&&ei,q=!Zd(de);let te;if(q&&(te=Vt&&Vt.onVnodeBeforeUnmount)&&Do(te,pe,de),jt&6)Ps(de.component,Be,ot);else{if(jt&128){de.suspense.unmount(Be,ot);return}we&&lc(de,null,pe,"beforeUnmount"),jt&64?de.type.remove(de,pe,Be,Ke,qt,ot):gt&&(Tt!==En||si>0&&si&64)?Xr(gt,pe,Be,!1,!0):(Tt===En&&si&384||!Ke&&jt&16)&&Xr(Lt,pe,Be),ot&&Nn(de)}(q&&(te=Vt&&Vt.onVnodeUnmounted)||we)&&ps(()=>{te&&Do(te,pe,de),we&&lc(de,null,pe,"unmounted")},Be)},Nn=de=>{const{type:pe,el:Be,anchor:ot,transition:Ke}=de;if(pe===En){Kn(Be,ot);return}if(pe===fm){Xi(de);return}const Tt=()=>{L(Be),Ke&&!Ke.persisted&&Ke.afterLeave&&Ke.afterLeave()};if(de.shapeFlag&1&&Ke&&!Ke.persisted){const{leave:Vt,delayLeave:ft}=Ke,Lt=()=>Vt(Be,Tt);ft?ft(de.el,Tt,Lt):Lt()}else Tt()},Kn=(de,pe)=>{let Be;for(;de!==pe;)Be=Se(de),L(de),de=Be;L(pe)},Ps=(de,pe,Be)=>{const{bum:ot,scope:Ke,update:Tt,subTree:Vt,um:ft}=de;ot&&um(ot),Ke.stop(),Tt&&(Tt.active=!1,dr(Vt,de,pe,Be)),ft&&ps(ft,pe),ps(()=>{de.isUnmounted=!0},pe),pe&&pe.pendingBranch&&!pe.isUnmounted&&de.asyncDep&&!de.asyncResolved&&de.suspenseId===pe.pendingId&&(pe.deps--,pe.deps===0&&pe.resolve())},Xr=(de,pe,Be,ot=!1,Ke=!1,Tt=0)=>{for(let Vt=Tt;Vt<de.length;Vt++)dr(de[Vt],pe,Be,ot,Ke)},it=de=>de.shapeFlag&6?it(de.component.subTree):de.shapeFlag&128?de.suspense.next():Se(de.anchor||de.el);let Wt=!1;const Bt=(de,pe,Be)=>{de==null?pe._vnode&&dr(pe._vnode,null,null,!0):at(pe._vnode||null,de,pe,null,null,null,Be),Wt||(Wt=!0,vb(),tT(),Wt=!1),pe._vnode=de},qt={p:at,um:dr,m:Wr,r:Nn,mt:ss,mc:zi,pc:zt,pbc:Sr,n:it,o:d};let Ui,tr;return g&&([Ui,tr]=g(qt)),{render:Bt,hydrate:Ui,createApp:EC(Bt,Ui)}}function Jg({type:d,props:g},w){return w==="svg"&&d==="foreignObject"||w==="mathml"&&d==="annotation-xml"&&g&&g.encoding&&g.encoding.includes("html")?void 0:w}function cc({effect:d,update:g},w){d.allowRecurse=g.allowRecurse=w}function DC(d,g){return(!d||d&&!d.pendingBranch)&&g&&!g.persisted}function yT(d,g,w=!1){const S=d.children,L=g.children;if(Pi(S)&&Pi(L))for(let k=0;k<S.length;k++){const V=S[k];let X=L[k];X.shapeFlag&1&&!X.dynamicChildren&&((X.patchFlag<=0||X.patchFlag===32)&&(X=L[k]=rl(L[k]),X.el=V.el),w||yT(V,X)),X.type===jm&&(X.el=V.el)}}function zC(d){const g=d.slice(),w=[0];let S,L,k,V,X;const o=d.length;for(S=0;S<o;S++){const re=d[S];if(re!==0){if(L=w[w.length-1],d[L]<re){g[S]=L,w.push(S);continue}for(k=0,V=w.length-1;k<V;)X=k+V>>1,d[w[X]]<re?k=X+1:V=X;re<d[w[k]]&&(k>0&&(g[S]=w[k-1]),w[k]=S)}}for(k=w.length,V=w[k-1];k-- >0;)w[k]=V,V=g[V];return w}function xT(d){const g=d.subTree.component;if(g)return g.asyncDep&&!g.asyncResolved?g:xT(g)}const kC=d=>d.__isTeleport,En=Symbol.for("v-fgt"),jm=Symbol.for("v-txt"),hl=Symbol.for("v-cmt"),fm=Symbol.for("v-stc"),Wd=[];let io=null;function Wi(d=!1){Wd.push(io=d?null:[])}function OC(){Wd.pop(),io=Wd[Wd.length-1]||null}let rf=1;function Rb(d){rf+=d}function vT(d){return d.dynamicChildren=rf>0?io||Eu:null,OC(),rf>0&&io&&io.push(d),d}function Ji(d,g,w,S,L,k){return vT(Et(d,g,w,S,L,k,!0))}function bT(d,g,w,S,L){return vT(nr(d,g,w,S,L,!0))}function Sm(d){return d?d.__v_isVNode===!0:!1}function Ud(d,g){return d.type===g.type&&d.key===g.key}const Gm="__vInternal",wT=({key:d})=>d??null,pm=({ref:d,ref_key:g,ref_for:w})=>(typeof d=="number"&&(d=""+d),d!=null?Sn(d)||An(d)||Qi(d)?{i:bn,r:d,k:g,f:!!w}:d:null);function Et(d,g=null,w=null,S=0,L=null,k=d===En?0:1,V=!1,X=!1){const o={__v_isVNode:!0,__v_skip:!0,type:d,props:g,key:g&&wT(g),ref:g&&pm(g),scopeId:Vm,slotScopeIds:null,children:w,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:k,patchFlag:S,dynamicProps:L,dynamicChildren:null,appContext:null,ctx:bn};return X?(Yy(o,w),k&128&&d.normalize(o)):w&&(o.shapeFlag|=Sn(w)?8:16),rf>0&&!V&&io&&(o.patchFlag>0||k&6)&&o.patchFlag!==32&&io.push(o),o}const nr=BC;function BC(d,g=null,w=null,S=0,L=null,k=!1){if((!d||d===YI)&&(d=hl),Sm(d)){const X=Lu(d,g,!0);return w&&Yy(X,w),rf>0&&!k&&io&&(X.shapeFlag&6?io[io.indexOf(d)]=X:io.push(X)),X.patchFlag|=-2,X}if(XC(d)&&(d=d.__vccOpts),g){g=FC(g);let{class:X,style:o}=g;X&&!Sn(X)&&(g.class=Bs(X)),jr(o)&&(Ww(o)&&!Pi(o)&&(o=Bn({},o)),g.style=Oy(o))}const V=Sn(d)?1:JI(d)?128:kC(d)?64:jr(d)?4:Qi(d)?2:0;return Et(d,g,w,S,L,V,k,!0)}function FC(d){return d?Ww(d)||Gm in d?Bn({},d):d:null}function Lu(d,g,w=!1){const{props:S,ref:L,patchFlag:k,children:V}=d,X=g?VC(S||{},g):S;return{__v_isVNode:!0,__v_skip:!0,type:d.type,props:X,key:X&&wT(X),ref:g&&g.ref?w&&L?Pi(L)?L.concat(pm(g)):[L,pm(g)]:pm(g):L,scopeId:d.scopeId,slotScopeIds:d.slotScopeIds,children:V,target:d.target,targetAnchor:d.targetAnchor,staticCount:d.staticCount,shapeFlag:d.shapeFlag,patchFlag:g&&d.type!==En?k===-1?16:k|16:k,dynamicProps:d.dynamicProps,dynamicChildren:d.dynamicChildren,appContext:d.appContext,dirs:d.dirs,transition:d.transition,component:d.component,suspense:d.suspense,ssContent:d.ssContent&&Lu(d.ssContent),ssFallback:d.ssFallback&&Lu(d.ssFallback),el:d.el,anchor:d.anchor,ctx:d.ctx,ce:d.ce}}function TT(d=" ",g=0){return nr(jm,null,d,g)}function NC(d,g){const w=nr(fm,null,d);return w.staticCount=g,w}function Xy(d="",g=!1){return g?(Wi(),bT(hl,null,d)):nr(hl,null,d)}function zo(d){return d==null||typeof d=="boolean"?nr(hl):Pi(d)?nr(En,null,d.slice()):typeof d=="object"?rl(d):nr(jm,null,String(d))}function rl(d){return d.el===null&&d.patchFlag!==-1||d.memo?d:Lu(d)}function Yy(d,g){let w=0;const{shapeFlag:S}=d;if(g==null)g=null;else if(Pi(g))w=16;else if(typeof g=="object")if(S&65){const L=g.default;L&&(L._c&&(L._d=!1),Yy(d,L()),L._c&&(L._d=!0));return}else{w=32;const L=g._;!L&&!(Gm in g)?g._ctx=bn:L===3&&bn&&(bn.slots._===1?g._=1:(g._=2,d.patchFlag|=1024))}else Qi(g)?(g={default:g,_ctx:bn},w=32):(g=String(g),S&64?(w=16,g=[TT(g)]):w=8);d.children=g,d.shapeFlag|=w}function VC(...d){const g={};for(let w=0;w<d.length;w++){const S=d[w];for(const L in S)if(L==="class")g.class!==S.class&&(g.class=Bs([g.class,S.class]));else if(L==="style")g.style=Oy([g.style,S.style]);else if(Pm(L)){const k=g[L],V=S[L];V&&k!==V&&!(Pi(k)&&k.includes(V))&&(g[L]=k?[].concat(k,V):V)}else L!==""&&(g[L]=S[L])}return g}function Do(d,g,w,S=null){ro(d,g,7,[w,S])}const UC=dT();let jC=0;function GC(d,g,w){const S=d.type,L=(g?g.appContext:d.appContext)||UC,k={uid:jC++,vnode:d,type:S,parent:g,appContext:L,root:null,next:null,subTree:null,effect:null,update:null,scope:new Lw(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:g?g.provides:Object.create(L.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:pT(S,L),emitsOptions:rT(S,L),emit:null,emitted:null,propsDefaults:Zr,inheritAttrs:S.inheritAttrs,ctx:Zr,data:Zr,props:Zr,attrs:Zr,slots:Zr,refs:Zr,setupState:Zr,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:w,suspenseId:w?w.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return k.ctx={_:k},k.root=g?g.root:k,k.emit=GI.bind(null,k),d.ce&&d.ce(k),k}let Rn=null;const $C=()=>Rn||bn;let Am,xy;{const d=Iw(),g=(w,S)=>{let L;return(L=d[w])||(L=d[w]=[]),L.push(S),k=>{L.length>1?L.forEach(V=>V(k)):L[0](k)}};Am=g("__VUE_INSTANCE_SETTERS__",w=>Rn=w),xy=g("__VUE_SSR_SETTERS__",w=>$m=w)}const lf=d=>{const g=Rn;return Am(d),d.scope.on(),()=>{d.scope.off(),Am(g)}},Lb=()=>{Rn&&Rn.scope.off(),Am(null)};function ET(d){return d.vnode.shapeFlag&4}let $m=!1;function qC(d,g=!1){g&&xy(g);const{props:w,children:S}=d.vnode,L=ET(d);AC(d,w,L,g),CC(d,S);const k=L?ZC(d,g):void 0;return g&&xy(!1),k}function ZC(d,g){const w=d.type;d.accessCache=Object.create(null),d.proxy=Om(new Proxy(d.ctx,mC));const{setup:S}=w;if(S){const L=d.setupContext=S.length>1?AT(d):null,k=lf(d);mc();const V=ll(S,d,0,[d.props,L]);if(_c(),k(),Sw(V)){if(V.then(Lb,Lb),g)return V.then(X=>{Db(d,X,g)}).catch(X=>{Bm(X,d,0)});d.asyncDep=V}else Db(d,V,g)}else ST(d,g)}function Db(d,g,w){Qi(g)?d.type.__ssrInlineRender?d.ssrRender=g:d.render=g:jr(g)&&(d.setupState=Jw(g)),ST(d,w)}let zb;function ST(d,g,w){const S=d.type;if(!d.render){if(!g&&zb&&!S.render){const L=S.template||Hy(d).template;if(L){const{isCustomElement:k,compilerOptions:V}=d.appContext.config,{delimiters:X,compilerOptions:o}=S,re=Bn(Bn({isCustomElement:k,delimiters:X},V),o);S.render=zb(L,re)}}d.render=S.render||Os}{const L=lf(d);mc();try{yC(d)}finally{_c(),L()}}}function HC(d){return d.attrsProxy||(d.attrsProxy=new Proxy(d.attrs,{get(g,w){return ms(d,"get","$attrs"),g[w]}}))}function AT(d){const g=w=>{d.exposed=w||{}};return{get attrs(){return HC(d)},slots:d.slots,emit:d.emit,expose:g}}function qm(d){if(d.exposed)return d.exposeProxy||(d.exposeProxy=new Proxy(Jw(Om(d.exposed)),{get(g,w){if(w in g)return g[w];if(w in Hd)return Hd[w](d)},has(g,w){return w in g||w in Hd}}))}function WC(d,g=!0){return Qi(d)?d.displayName||d.name:d.name||g&&d.__name}function XC(d){return Qi(d)&&"__vccOpts"in d}const Ur=(d,g)=>RI(d,g,$m);function MT(d,g,w){const S=arguments.length;return S===2?jr(g)&&!Pi(g)?Sm(g)?nr(d,null,[g]):nr(d,g):nr(d,null,g):(S>3?w=Array.prototype.slice.call(arguments,2):S===3&&Sm(w)&&(w=[w]),nr(d,g,w))}const YC="3.4.21";/**
* @vue/runtime-dom v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const KC="http://www.w3.org/2000/svg",JC="http://www.w3.org/1998/Math/MathML",nl=typeof document<"u"?document:null,kb=nl&&nl.createElement("template"),QC={insert:(d,g,w)=>{g.insertBefore(d,w||null)},remove:d=>{const g=d.parentNode;g&&g.removeChild(d)},createElement:(d,g,w,S)=>{const L=g==="svg"?nl.createElementNS(KC,d):g==="mathml"?nl.createElementNS(JC,d):nl.createElement(d,w?{is:w}:void 0);return d==="select"&&S&&S.multiple!=null&&L.setAttribute("multiple",S.multiple),L},createText:d=>nl.createTextNode(d),createComment:d=>nl.createComment(d),setText:(d,g)=>{d.nodeValue=g},setElementText:(d,g)=>{d.textContent=g},parentNode:d=>d.parentNode,nextSibling:d=>d.nextSibling,querySelector:d=>nl.querySelector(d),setScopeId(d,g){d.setAttribute(g,"")},insertStaticContent(d,g,w,S,L,k){const V=w?w.previousSibling:g.lastChild;if(L&&(L===k||L.nextSibling))for(;g.insertBefore(L.cloneNode(!0),w),!(L===k||!(L=L.nextSibling)););else{kb.innerHTML=S==="svg"?`<svg>${d}</svg>`:S==="mathml"?`<math>${d}</math>`:d;const X=kb.content;if(S==="svg"||S==="mathml"){const o=X.firstChild;for(;o.firstChild;)X.appendChild(o.firstChild);X.removeChild(o)}g.insertBefore(X,w)}return[V?V.nextSibling:g.firstChild,w?w.previousSibling:g.lastChild]}},eP=Symbol("_vtc");function tP(d,g,w){const S=d[eP];S&&(g=(g?[g,...S]:[...S]).join(" ")),g==null?d.removeAttribute("class"):w?d.setAttribute("class",g):d.className=g}const Ob=Symbol("_vod"),iP=Symbol("_vsh"),rP=Symbol(""),nP=/(^|;)\s*display\s*:/;function sP(d,g,w){const S=d.style,L=Sn(w);let k=!1;if(w&&!L){if(g)if(Sn(g))for(const V of g.split(";")){const X=V.slice(0,V.indexOf(":")).trim();w[X]==null&&mm(S,X,"")}else for(const V in g)w[V]==null&&mm(S,V,"");for(const V in w)V==="display"&&(k=!0),mm(S,V,w[V])}else if(L){if(g!==w){const V=S[rP];V&&(w+=";"+V),S.cssText=w,k=nP.test(w)}}else g&&d.removeAttribute("style");Ob in d&&(d[Ob]=k?S.display:"",d[iP]&&(S.display="none"))}const Bb=/\s*!important$/;function mm(d,g,w){if(Pi(w))w.forEach(S=>mm(d,g,S));else if(w==null&&(w=""),g.startsWith("--"))d.setProperty(g,w);else{const S=oP(d,g);Bb.test(w)?d.setProperty(Ou(S),w.replace(Bb,""),"important"):d[S]=w}}const Fb=["Webkit","Moz","ms"],Qg={};function oP(d,g){const w=Qg[g];if(w)return w;let S=Bo(g);if(S!=="filter"&&S in d)return Qg[g]=S;S=Dm(S);for(let L=0;L<Fb.length;L++){const k=Fb[L]+S;if(k in d)return Qg[g]=k}return g}const Nb="http://www.w3.org/1999/xlink";function aP(d,g,w,S,L){if(S&&g.startsWith("xlink:"))w==null?d.removeAttributeNS(Nb,g.slice(6,g.length)):d.setAttributeNS(Nb,g,w);else{const k=oI(g);w==null||k&&!Cw(w)?d.removeAttribute(g):d.setAttribute(g,k?"":w)}}function lP(d,g,w,S,L,k,V){if(g==="innerHTML"||g==="textContent"){S&&V(S,L,k),d[g]=w??"";return}const X=d.tagName;if(g==="value"&&X!=="PROGRESS"&&!X.includes("-")){const re=X==="OPTION"?d.getAttribute("value")||"":d.value,oe=w??"";(re!==oe||!("_value"in d))&&(d.value=oe),w==null&&d.removeAttribute(g),d._value=w;return}let o=!1;if(w===""||w==null){const re=typeof d[g];re==="boolean"?w=Cw(w):w==null&&re==="string"?(w="",o=!0):re==="number"&&(w=0,o=!0)}try{d[g]=w}catch{}o&&d.removeAttribute(g)}function hc(d,g,w,S){d.addEventListener(g,w,S)}function cP(d,g,w,S){d.removeEventListener(g,w,S)}const Vb=Symbol("_vei");function uP(d,g,w,S,L=null){const k=d[Vb]||(d[Vb]={}),V=k[g];if(S&&V)V.value=S;else{const[X,o]=hP(g);if(S){const re=k[g]=pP(S,L);hc(d,X,re,o)}else V&&(cP(d,X,V,o),k[g]=void 0)}}const Ub=/(?:Once|Passive|Capture)$/;function hP(d){let g;if(Ub.test(d)){g={};let S;for(;S=d.match(Ub);)d=d.slice(0,d.length-S[0].length),g[S[0].toLowerCase()]=!0}return[d[2]===":"?d.slice(3):Ou(d.slice(2)),g]}let ey=0;const dP=Promise.resolve(),fP=()=>ey||(dP.then(()=>ey=0),ey=Date.now());function pP(d,g){const w=S=>{if(!S._vts)S._vts=Date.now();else if(S._vts<=w.attached)return;ro(mP(S,w.value),g,5,[S])};return w.value=d,w.attached=fP(),w}function mP(d,g){if(Pi(g)){const w=d.stopImmediatePropagation;return d.stopImmediatePropagation=()=>{w.call(d),d._stopped=!0},g.map(S=>L=>!L._stopped&&S&&S(L))}else return g}const jb=d=>d.charCodeAt(0)===111&&d.charCodeAt(1)===110&&d.charCodeAt(2)>96&&d.charCodeAt(2)<123,_P=(d,g,w,S,L,k,V,X,o)=>{const re=L==="svg";g==="class"?tP(d,S,re):g==="style"?sP(d,w,S):Pm(g)?Dy(g)||uP(d,g,w,S,V):(g[0]==="."?(g=g.slice(1),!0):g[0]==="^"?(g=g.slice(1),!1):gP(d,g,S,re))?lP(d,g,S,k,V,X,o):(g==="true-value"?d._trueValue=S:g==="false-value"&&(d._falseValue=S),aP(d,g,S,re))};function gP(d,g,w,S){if(S)return!!(g==="innerHTML"||g==="textContent"||g in d&&jb(g)&&Qi(w));if(g==="spellcheck"||g==="draggable"||g==="translate"||g==="form"||g==="list"&&d.tagName==="INPUT"||g==="type"&&d.tagName==="TEXTAREA")return!1;if(g==="width"||g==="height"){const L=d.tagName;if(L==="IMG"||L==="VIDEO"||L==="CANVAS"||L==="SOURCE")return!1}return jb(g)&&Sn(w)?!1:g in d}const Mm=d=>{const g=d.props["onUpdate:modelValue"]||!1;return Pi(g)?w=>um(g,w):g};function yP(d){d.target.composing=!0}function Gb(d){const g=d.target;g.composing&&(g.composing=!1,g.dispatchEvent(new Event("input")))}const Cu=Symbol("_assign"),$b={created(d,{modifiers:{lazy:g,trim:w,number:S}},L){d[Cu]=Mm(L);const k=S||L.props&&L.props.type==="number";hc(d,g?"change":"input",V=>{if(V.target.composing)return;let X=d.value;w&&(X=X.trim()),k&&(X=Jd(X)),d[Cu](X)}),w&&hc(d,"change",()=>{d.value=d.value.trim()}),g||(hc(d,"compositionstart",yP),hc(d,"compositionend",Gb),hc(d,"change",Gb))},mounted(d,{value:g}){d.value=g??""},beforeUpdate(d,{value:g,modifiers:{lazy:w,trim:S,number:L}},k){if(d[Cu]=Mm(k),d.composing)return;const V=L||d.type==="number"?Jd(d.value):d.value,X=g??"";V!==X&&(document.activeElement===d&&d.type!=="range"&&(w||S&&d.value.trim()===X)||(d.value=X))}},xP={deep:!0,created(d,{value:g,modifiers:{number:w}},S){const L=Rm(g);hc(d,"change",()=>{const k=Array.prototype.filter.call(d.options,V=>V.selected).map(V=>w?Jd(Im(V)):Im(V));d[Cu](d.multiple?L?new Set(k):k:k[0]),d._assigning=!0,Fm(()=>{d._assigning=!1})}),d[Cu]=Mm(S)},mounted(d,{value:g,modifiers:{number:w}}){qb(d,g,w)},beforeUpdate(d,g,w){d[Cu]=Mm(w)},updated(d,{value:g,modifiers:{number:w}}){d._assigning||qb(d,g,w)}};function qb(d,g,w){const S=d.multiple,L=Pi(g);if(!(S&&!L&&!Rm(g))){for(let k=0,V=d.options.length;k<V;k++){const X=d.options[k],o=Im(X);if(S)if(L){const re=typeof o;re==="string"||re==="number"?X.selected=g.includes(w?Jd(o):o):X.selected=lI(g,o)>-1}else X.selected=g.has(o);else if(zm(Im(X),g)){d.selectedIndex!==k&&(d.selectedIndex=k);return}}!S&&d.selectedIndex!==-1&&(d.selectedIndex=-1)}}function Im(d){return"_value"in d?d._value:d.value}const vP=["ctrl","shift","alt","meta"],bP={stop:d=>d.stopPropagation(),prevent:d=>d.preventDefault(),self:d=>d.target!==d.currentTarget,ctrl:d=>!d.ctrlKey,shift:d=>!d.shiftKey,alt:d=>!d.altKey,meta:d=>!d.metaKey,left:d=>"button"in d&&d.button!==0,middle:d=>"button"in d&&d.button!==1,right:d=>"button"in d&&d.button!==2,exact:(d,g)=>vP.some(w=>d[`${w}Key`]&&!g.includes(w))},ty=(d,g)=>{const w=d._withMods||(d._withMods={}),S=g.join(".");return w[S]||(w[S]=(L,...k)=>{for(let V=0;V<g.length;V++){const X=bP[g[V]];if(X&&X(L,g))return}return d(L,...k)})},wP=Bn({patchProp:_P},QC);let Zb;function TP(){return Zb||(Zb=RC(wP))}const EP=(...d)=>{const g=TP().createApp(...d),{mount:w}=g;return g.mount=S=>{const L=AP(S);if(!L)return;const k=g._component;!Qi(k)&&!k.render&&!k.template&&(k.template=L.innerHTML),L.innerHTML="";const V=w(L,!1,SP(L));return L instanceof Element&&(L.removeAttribute("v-cloak"),L.setAttribute("data-v-app","")),V},g};function SP(d){if(d instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&d instanceof MathMLElement)return"mathml"}function AP(d){return Sn(d)?document.querySelector(d):d}var MP=!1;/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let IT;const Zm=d=>IT=d,CT=Symbol();function vy(d){return d&&typeof d=="object"&&Object.prototype.toString.call(d)==="[object Object]"&&typeof d.toJSON!="function"}var Xd;(function(d){d.direct="direct",d.patchObject="patch object",d.patchFunction="patch function"})(Xd||(Xd={}));function IP(){const d=Dw(!0),g=d.run(()=>ln({}));let w=[],S=[];const L=Om({install(k){Zm(L),L._a=k,k.provide(CT,L),k.config.globalProperties.$pinia=L,S.forEach(V=>w.push(V)),S=[]},use(k){return!this._a&&!MP?S.push(k):w.push(k),this},_p:w,_a:null,_e:d,_s:new Map,state:g});return L}const PT=()=>{};function Hb(d,g,w,S=PT){d.push(g);const L=()=>{const k=d.indexOf(g);k>-1&&(d.splice(k,1),S())};return!w&&zw()&&uI(L),L}function wu(d,...g){d.slice().forEach(w=>{w(...g)})}const CP=d=>d();function by(d,g){d instanceof Map&&g instanceof Map&&g.forEach((w,S)=>d.set(S,w)),d instanceof Set&&g instanceof Set&&g.forEach(d.add,d);for(const w in g){if(!g.hasOwnProperty(w))continue;const S=g[w],L=d[w];vy(L)&&vy(S)&&d.hasOwnProperty(w)&&!An(S)&&!al(S)?d[w]=by(L,S):d[w]=S}return d}const PP=Symbol();function RP(d){return!vy(d)||!d.hasOwnProperty(PP)}const{assign:tl}=Object;function LP(d){return!!(An(d)&&d.effect)}function DP(d,g,w,S){const{state:L,actions:k,getters:V}=g,X=w.state.value[d];let o;function re(){X||(w.state.value[d]=L?L():{});const oe=kI(w.state.value[d]);return tl(oe,k,Object.keys(V||{}).reduce((se,Se)=>(se[Se]=Om(Ur(()=>{Zm(w);const Ie=w._s.get(d);return V[Se].call(Ie,Ie)})),se),{}))}return o=RT(d,re,g,w,S,!0),o}function RT(d,g,w={},S,L,k){let V;const X=tl({actions:{}},w),o={deep:!0};let re,oe,se=[],Se=[],Ie;const qe=S.state.value[d];!k&&!qe&&(S.state.value[d]={}),ln({});let at;function Ft(zi){let Ue;re=oe=!1,typeof zi=="function"?(zi(S.state.value[d]),Ue={type:Xd.patchFunction,storeId:d,events:Ie}):(by(S.state.value[d],zi),Ue={type:Xd.patchObject,payload:zi,storeId:d,events:Ie});const Sr=at=Symbol();Fm().then(()=>{at===Sr&&(re=!0)}),oe=!0,wu(se,Ue,S.state.value[d])}const Nt=k?function(){const{state:Ue}=w,Sr=Ue?Ue():{};this.$patch(Hr=>{tl(Hr,Sr)})}:PT;function ri(){V.stop(),se=[],Se=[],S._s.delete(d)}function Jt(zi,Ue){return function(){Zm(S);const Sr=Array.from(arguments),Hr=[],ni=[];function br(Vi){Hr.push(Vi)}function ss(Vi){ni.push(Vi)}wu(Se,{args:Sr,name:zi,store:er,after:br,onError:ss});let lt;try{lt=Ue.apply(this&&this.$id===d?this:er,Sr)}catch(Vi){throw wu(ni,Vi),Vi}return lt instanceof Promise?lt.then(Vi=>(wu(Hr,Vi),Vi)).catch(Vi=>(wu(ni,Vi),Promise.reject(Vi))):(wu(Hr,lt),lt)}}const Xi={_p:S,$id:d,$onAction:Hb.bind(null,Se),$patch:Ft,$reset:Nt,$subscribe(zi,Ue={}){const Sr=Hb(se,zi,Ue.detached,()=>Hr()),Hr=V.run(()=>Mu(()=>S.state.value[d],ni=>{(Ue.flush==="sync"?oe:re)&&zi({storeId:d,type:Xd.direct,events:Ie},ni)},tl({},o,Ue)));return Sr},$dispose:ri},er=Fo(Xi);S._s.set(d,er);const vr=(S._a&&S._a.runWithContext||CP)(()=>S._e.run(()=>(V=Dw()).run(g)));for(const zi in vr){const Ue=vr[zi];if(An(Ue)&&!LP(Ue)||al(Ue))k||(qe&&RP(Ue)&&(An(Ue)?Ue.value=qe[zi]:by(Ue,qe[zi])),S.state.value[d][zi]=Ue);else if(typeof Ue=="function"){const Sr=Jt(zi,Ue);vr[zi]=Sr,X.actions[zi]=Ue}}return tl(er,vr),tl(xr(er),vr),Object.defineProperty(er,"$state",{get:()=>S.state.value[d],set:zi=>{Ft(Ue=>{tl(Ue,zi)})}}),S._p.forEach(zi=>{tl(er,V.run(()=>zi({store:er,app:S._a,pinia:S,options:X})))}),qe&&k&&w.hydrate&&w.hydrate(er.$state,qe),re=!0,oe=!0,er}function LT(d,g,w){let S,L;const k=typeof g=="function";typeof d=="string"?(S=d,L=k?w:g):(L=d,S=d.id);function V(X,o){const re=SC();return X=X||(re?no(CT,null):null),X&&Zm(X),X=IT,X._s.has(S)||(k?RT(S,g,L,X):DP(S,L,X)),X._s.get(S)}return V.$id=S,V}/*!
  * vue-router v4.3.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Tu=typeof document<"u";function zP(d){return d.__esModule||d[Symbol.toStringTag]==="Module"}const Or=Object.assign;function iy(d,g){const w={};for(const S in g){const L=g[S];w[S]=so(L)?L.map(d):d(L)}return w}const Yd=()=>{},so=Array.isArray,DT=/#/g,kP=/&/g,OP=/\//g,BP=/=/g,FP=/\?/g,zT=/\+/g,NP=/%5B/g,VP=/%5D/g,kT=/%5E/g,UP=/%60/g,OT=/%7B/g,jP=/%7C/g,BT=/%7D/g,GP=/%20/g;function Ky(d){return encodeURI(""+d).replace(jP,"|").replace(NP,"[").replace(VP,"]")}function $P(d){return Ky(d).replace(OT,"{").replace(BT,"}").replace(kT,"^")}function wy(d){return Ky(d).replace(zT,"%2B").replace(GP,"+").replace(DT,"%23").replace(kP,"%26").replace(UP,"`").replace(OT,"{").replace(BT,"}").replace(kT,"^")}function qP(d){return wy(d).replace(BP,"%3D")}function ZP(d){return Ky(d).replace(DT,"%23").replace(FP,"%3F")}function HP(d){return d==null?"":ZP(d).replace(OP,"%2F")}function nf(d){try{return decodeURIComponent(""+d)}catch{}return""+d}const WP=/\/$/,XP=d=>d.replace(WP,"");function ry(d,g,w="/"){let S,L={},k="",V="";const X=g.indexOf("#");let o=g.indexOf("?");return X<o&&X>=0&&(o=-1),o>-1&&(S=g.slice(0,o),k=g.slice(o+1,X>-1?X:g.length),L=d(k)),X>-1&&(S=S||g.slice(0,X),V=g.slice(X,g.length)),S=QP(S??g,w),{fullPath:S+(k&&"?")+k+V,path:S,query:L,hash:nf(V)}}function YP(d,g){const w=g.query?d(g.query):"";return g.path+(w&&"?")+w+(g.hash||"")}function Wb(d,g){return!g||!d.toLowerCase().startsWith(g.toLowerCase())?d:d.slice(g.length)||"/"}function KP(d,g,w){const S=g.matched.length-1,L=w.matched.length-1;return S>-1&&S===L&&Du(g.matched[S],w.matched[L])&&FT(g.params,w.params)&&d(g.query)===d(w.query)&&g.hash===w.hash}function Du(d,g){return(d.aliasOf||d)===(g.aliasOf||g)}function FT(d,g){if(Object.keys(d).length!==Object.keys(g).length)return!1;for(const w in d)if(!JP(d[w],g[w]))return!1;return!0}function JP(d,g){return so(d)?Xb(d,g):so(g)?Xb(g,d):d===g}function Xb(d,g){return so(g)?d.length===g.length&&d.every((w,S)=>w===g[S]):d.length===1&&d[0]===g}function QP(d,g){if(d.startsWith("/"))return d;if(!d)return g;const w=g.split("/"),S=d.split("/"),L=S[S.length-1];(L===".."||L===".")&&S.push("");let k=w.length-1,V,X;for(V=0;V<S.length;V++)if(X=S[V],X!==".")if(X==="..")k>1&&k--;else break;return w.slice(0,k).join("/")+"/"+S.slice(V).join("/")}var sf;(function(d){d.pop="pop",d.push="push"})(sf||(sf={}));var Kd;(function(d){d.back="back",d.forward="forward",d.unknown=""})(Kd||(Kd={}));function eR(d){if(!d)if(Tu){const g=document.querySelector("base");d=g&&g.getAttribute("href")||"/",d=d.replace(/^\w+:\/\/[^\/]+/,"")}else d="/";return d[0]!=="/"&&d[0]!=="#"&&(d="/"+d),XP(d)}const tR=/^[^#]+#/;function iR(d,g){return d.replace(tR,"#")+g}function rR(d,g){const w=document.documentElement.getBoundingClientRect(),S=d.getBoundingClientRect();return{behavior:g.behavior,left:S.left-w.left-(g.left||0),top:S.top-w.top-(g.top||0)}}const Hm=()=>({left:window.scrollX,top:window.scrollY});function nR(d){let g;if("el"in d){const w=d.el,S=typeof w=="string"&&w.startsWith("#"),L=typeof w=="string"?S?document.getElementById(w.slice(1)):document.querySelector(w):w;if(!L)return;g=rR(L,d)}else g=d;"scrollBehavior"in document.documentElement.style?window.scrollTo(g):window.scrollTo(g.left!=null?g.left:window.scrollX,g.top!=null?g.top:window.scrollY)}function Yb(d,g){return(history.state?history.state.position-g:-1)+d}const Ty=new Map;function sR(d,g){Ty.set(d,g)}function oR(d){const g=Ty.get(d);return Ty.delete(d),g}let aR=()=>location.protocol+"//"+location.host;function NT(d,g){const{pathname:w,search:S,hash:L}=g,k=d.indexOf("#");if(k>-1){let X=L.includes(d.slice(k))?d.slice(k).length:1,o=L.slice(X);return o[0]!=="/"&&(o="/"+o),Wb(o,"")}return Wb(w,d)+S+L}function lR(d,g,w,S){let L=[],k=[],V=null;const X=({state:Se})=>{const Ie=NT(d,location),qe=w.value,at=g.value;let Ft=0;if(Se){if(w.value=Ie,g.value=Se,V&&V===qe){V=null;return}Ft=at?Se.position-at.position:0}else S(Ie);L.forEach(Nt=>{Nt(w.value,qe,{delta:Ft,type:sf.pop,direction:Ft?Ft>0?Kd.forward:Kd.back:Kd.unknown})})};function o(){V=w.value}function re(Se){L.push(Se);const Ie=()=>{const qe=L.indexOf(Se);qe>-1&&L.splice(qe,1)};return k.push(Ie),Ie}function oe(){const{history:Se}=window;Se.state&&Se.replaceState(Or({},Se.state,{scroll:Hm()}),"")}function se(){for(const Se of k)Se();k=[],window.removeEventListener("popstate",X),window.removeEventListener("beforeunload",oe)}return window.addEventListener("popstate",X),window.addEventListener("beforeunload",oe,{passive:!0}),{pauseListeners:o,listen:re,destroy:se}}function Kb(d,g,w,S=!1,L=!1){return{back:d,current:g,forward:w,replaced:S,position:window.history.length,scroll:L?Hm():null}}function cR(d){const{history:g,location:w}=window,S={value:NT(d,w)},L={value:g.state};L.value||k(S.value,{back:null,current:S.value,forward:null,position:g.length-1,replaced:!0,scroll:null},!0);function k(o,re,oe){const se=d.indexOf("#"),Se=se>-1?(w.host&&document.querySelector("base")?d:d.slice(se))+o:aR()+d+o;try{g[oe?"replaceState":"pushState"](re,"",Se),L.value=re}catch(Ie){console.error(Ie),w[oe?"replace":"assign"](Se)}}function V(o,re){const oe=Or({},g.state,Kb(L.value.back,o,L.value.forward,!0),re,{position:L.value.position});k(o,oe,!0),S.value=o}function X(o,re){const oe=Or({},L.value,g.state,{forward:o,scroll:Hm()});k(oe.current,oe,!0);const se=Or({},Kb(S.value,o,null),{position:oe.position+1},re);k(o,se,!1),S.value=o}return{location:S,state:L,push:X,replace:V}}function uR(d){d=eR(d);const g=cR(d),w=lR(d,g.state,g.location,g.replace);function S(k,V=!0){V||w.pauseListeners(),history.go(k)}const L=Or({location:"",base:d,go:S,createHref:iR.bind(null,d)},g,w);return Object.defineProperty(L,"location",{enumerable:!0,get:()=>g.location.value}),Object.defineProperty(L,"state",{enumerable:!0,get:()=>g.state.value}),L}function hR(d){return typeof d=="string"||d&&typeof d=="object"}function VT(d){return typeof d=="string"||typeof d=="symbol"}const Qa={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},UT=Symbol("");var Jb;(function(d){d[d.aborted=4]="aborted",d[d.cancelled=8]="cancelled",d[d.duplicated=16]="duplicated"})(Jb||(Jb={}));function zu(d,g){return Or(new Error,{type:d,[UT]:!0},g)}function ca(d,g){return d instanceof Error&&UT in d&&(g==null||!!(d.type&g))}const Qb="[^/]+?",dR={sensitive:!1,strict:!1,start:!0,end:!0},fR=/[.+*?^${}()[\]/\\]/g;function pR(d,g){const w=Or({},dR,g),S=[];let L=w.start?"^":"";const k=[];for(const re of d){const oe=re.length?[]:[90];w.strict&&!re.length&&(L+="/");for(let se=0;se<re.length;se++){const Se=re[se];let Ie=40+(w.sensitive?.25:0);if(Se.type===0)se||(L+="/"),L+=Se.value.replace(fR,"\\$&"),Ie+=40;else if(Se.type===1){const{value:qe,repeatable:at,optional:Ft,regexp:Nt}=Se;k.push({name:qe,repeatable:at,optional:Ft});const ri=Nt||Qb;if(ri!==Qb){Ie+=10;try{new RegExp(`(${ri})`)}catch(Xi){throw new Error(`Invalid custom RegExp for param "${qe}" (${ri}): `+Xi.message)}}let Jt=at?`((?:${ri})(?:/(?:${ri}))*)`:`(${ri})`;se||(Jt=Ft&&re.length<2?`(?:/${Jt})`:"/"+Jt),Ft&&(Jt+="?"),L+=Jt,Ie+=20,Ft&&(Ie+=-8),at&&(Ie+=-20),ri===".*"&&(Ie+=-50)}oe.push(Ie)}S.push(oe)}if(w.strict&&w.end){const re=S.length-1;S[re][S[re].length-1]+=.7000000000000001}w.strict||(L+="/?"),w.end?L+="$":w.strict&&(L+="(?:/|$)");const V=new RegExp(L,w.sensitive?"":"i");function X(re){const oe=re.match(V),se={};if(!oe)return null;for(let Se=1;Se<oe.length;Se++){const Ie=oe[Se]||"",qe=k[Se-1];se[qe.name]=Ie&&qe.repeatable?Ie.split("/"):Ie}return se}function o(re){let oe="",se=!1;for(const Se of d){(!se||!oe.endsWith("/"))&&(oe+="/"),se=!1;for(const Ie of Se)if(Ie.type===0)oe+=Ie.value;else if(Ie.type===1){const{value:qe,repeatable:at,optional:Ft}=Ie,Nt=qe in re?re[qe]:"";if(so(Nt)&&!at)throw new Error(`Provided param "${qe}" is an array but it is not repeatable (* or + modifiers)`);const ri=so(Nt)?Nt.join("/"):Nt;if(!ri)if(Ft)Se.length<2&&(oe.endsWith("/")?oe=oe.slice(0,-1):se=!0);else throw new Error(`Missing required param "${qe}"`);oe+=ri}}return oe||"/"}return{re:V,score:S,keys:k,parse:X,stringify:o}}function mR(d,g){let w=0;for(;w<d.length&&w<g.length;){const S=g[w]-d[w];if(S)return S;w++}return d.length<g.length?d.length===1&&d[0]===80?-1:1:d.length>g.length?g.length===1&&g[0]===80?1:-1:0}function _R(d,g){let w=0;const S=d.score,L=g.score;for(;w<S.length&&w<L.length;){const k=mR(S[w],L[w]);if(k)return k;w++}if(Math.abs(L.length-S.length)===1){if(ew(S))return 1;if(ew(L))return-1}return L.length-S.length}function ew(d){const g=d[d.length-1];return d.length>0&&g[g.length-1]<0}const gR={type:0,value:""},yR=/[a-zA-Z0-9_]/;function xR(d){if(!d)return[[]];if(d==="/")return[[gR]];if(!d.startsWith("/"))throw new Error(`Invalid path "${d}"`);function g(Ie){throw new Error(`ERR (${w})/"${re}": ${Ie}`)}let w=0,S=w;const L=[];let k;function V(){k&&L.push(k),k=[]}let X=0,o,re="",oe="";function se(){re&&(w===0?k.push({type:0,value:re}):w===1||w===2||w===3?(k.length>1&&(o==="*"||o==="+")&&g(`A repeatable param (${re}) must be alone in its segment. eg: '/:ids+.`),k.push({type:1,value:re,regexp:oe,repeatable:o==="*"||o==="+",optional:o==="*"||o==="?"})):g("Invalid state to consume buffer"),re="")}function Se(){re+=o}for(;X<d.length;){if(o=d[X++],o==="\\"&&w!==2){S=w,w=4;continue}switch(w){case 0:o==="/"?(re&&se(),V()):o===":"?(se(),w=1):Se();break;case 4:Se(),w=S;break;case 1:o==="("?w=2:yR.test(o)?Se():(se(),w=0,o!=="*"&&o!=="?"&&o!=="+"&&X--);break;case 2:o===")"?oe[oe.length-1]=="\\"?oe=oe.slice(0,-1)+o:w=3:oe+=o;break;case 3:se(),w=0,o!=="*"&&o!=="?"&&o!=="+"&&X--,oe="";break;default:g("Unknown state");break}}return w===2&&g(`Unfinished custom RegExp for param "${re}"`),se(),V(),L}function vR(d,g,w){const S=pR(xR(d.path),w),L=Or(S,{record:d,parent:g,children:[],alias:[]});return g&&!L.record.aliasOf==!g.record.aliasOf&&g.children.push(L),L}function bR(d,g){const w=[],S=new Map;g=rw({strict:!1,end:!0,sensitive:!1},g);function L(oe){return S.get(oe)}function k(oe,se,Se){const Ie=!Se,qe=wR(oe);qe.aliasOf=Se&&Se.record;const at=rw(g,oe),Ft=[qe];if("alias"in oe){const Jt=typeof oe.alias=="string"?[oe.alias]:oe.alias;for(const Xi of Jt)Ft.push(Or({},qe,{components:Se?Se.record.components:qe.components,path:Xi,aliasOf:Se?Se.record:qe}))}let Nt,ri;for(const Jt of Ft){const{path:Xi}=Jt;if(se&&Xi[0]!=="/"){const er=se.record.path,wi=er[er.length-1]==="/"?"":"/";Jt.path=se.record.path+(Xi&&wi+Xi)}if(Nt=vR(Jt,se,at),Se?Se.alias.push(Nt):(ri=ri||Nt,ri!==Nt&&ri.alias.push(Nt),Ie&&oe.name&&!iw(Nt)&&V(oe.name)),qe.children){const er=qe.children;for(let wi=0;wi<er.length;wi++)k(er[wi],Nt,Se&&Se.children[wi])}Se=Se||Nt,(Nt.record.components&&Object.keys(Nt.record.components).length||Nt.record.name||Nt.record.redirect)&&o(Nt)}return ri?()=>{V(ri)}:Yd}function V(oe){if(VT(oe)){const se=S.get(oe);se&&(S.delete(oe),w.splice(w.indexOf(se),1),se.children.forEach(V),se.alias.forEach(V))}else{const se=w.indexOf(oe);se>-1&&(w.splice(se,1),oe.record.name&&S.delete(oe.record.name),oe.children.forEach(V),oe.alias.forEach(V))}}function X(){return w}function o(oe){let se=0;for(;se<w.length&&_R(oe,w[se])>=0&&(oe.record.path!==w[se].record.path||!jT(oe,w[se]));)se++;w.splice(se,0,oe),oe.record.name&&!iw(oe)&&S.set(oe.record.name,oe)}function re(oe,se){let Se,Ie={},qe,at;if("name"in oe&&oe.name){if(Se=S.get(oe.name),!Se)throw zu(1,{location:oe});at=Se.record.name,Ie=Or(tw(se.params,Se.keys.filter(ri=>!ri.optional).concat(Se.parent?Se.parent.keys.filter(ri=>ri.optional):[]).map(ri=>ri.name)),oe.params&&tw(oe.params,Se.keys.map(ri=>ri.name))),qe=Se.stringify(Ie)}else if(oe.path!=null)qe=oe.path,Se=w.find(ri=>ri.re.test(qe)),Se&&(Ie=Se.parse(qe),at=Se.record.name);else{if(Se=se.name?S.get(se.name):w.find(ri=>ri.re.test(se.path)),!Se)throw zu(1,{location:oe,currentLocation:se});at=Se.record.name,Ie=Or({},se.params,oe.params),qe=Se.stringify(Ie)}const Ft=[];let Nt=Se;for(;Nt;)Ft.unshift(Nt.record),Nt=Nt.parent;return{name:at,path:qe,params:Ie,matched:Ft,meta:ER(Ft)}}return d.forEach(oe=>k(oe)),{addRoute:k,resolve:re,removeRoute:V,getRoutes:X,getRecordMatcher:L}}function tw(d,g){const w={};for(const S of g)S in d&&(w[S]=d[S]);return w}function wR(d){return{path:d.path,redirect:d.redirect,name:d.name,meta:d.meta||{},aliasOf:void 0,beforeEnter:d.beforeEnter,props:TR(d),children:d.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in d?d.components||null:d.component&&{default:d.component}}}function TR(d){const g={},w=d.props||!1;if("component"in d)g.default=w;else for(const S in d.components)g[S]=typeof w=="object"?w[S]:w;return g}function iw(d){for(;d;){if(d.record.aliasOf)return!0;d=d.parent}return!1}function ER(d){return d.reduce((g,w)=>Or(g,w.meta),{})}function rw(d,g){const w={};for(const S in d)w[S]=S in g?g[S]:d[S];return w}function jT(d,g){return g.children.some(w=>w===d||jT(d,w))}function SR(d){const g={};if(d===""||d==="?")return g;const S=(d[0]==="?"?d.slice(1):d).split("&");for(let L=0;L<S.length;++L){const k=S[L].replace(zT," "),V=k.indexOf("="),X=nf(V<0?k:k.slice(0,V)),o=V<0?null:nf(k.slice(V+1));if(X in g){let re=g[X];so(re)||(re=g[X]=[re]),re.push(o)}else g[X]=o}return g}function nw(d){let g="";for(let w in d){const S=d[w];if(w=qP(w),S==null){S!==void 0&&(g+=(g.length?"&":"")+w);continue}(so(S)?S.map(k=>k&&wy(k)):[S&&wy(S)]).forEach(k=>{k!==void 0&&(g+=(g.length?"&":"")+w,k!=null&&(g+="="+k))})}return g}function AR(d){const g={};for(const w in d){const S=d[w];S!==void 0&&(g[w]=so(S)?S.map(L=>L==null?null:""+L):S==null?S:""+S)}return g}const MR=Symbol(""),sw=Symbol(""),Wm=Symbol(""),GT=Symbol(""),Ey=Symbol("");function jd(){let d=[];function g(S){return d.push(S),()=>{const L=d.indexOf(S);L>-1&&d.splice(L,1)}}function w(){d=[]}return{add:g,list:()=>d.slice(),reset:w}}function sl(d,g,w,S,L,k=V=>V()){const V=S&&(S.enterCallbacks[L]=S.enterCallbacks[L]||[]);return()=>new Promise((X,o)=>{const re=Se=>{Se===!1?o(zu(4,{from:w,to:g})):Se instanceof Error?o(Se):hR(Se)?o(zu(2,{from:g,to:Se})):(V&&S.enterCallbacks[L]===V&&typeof Se=="function"&&V.push(Se),X())},oe=k(()=>d.call(S&&S.instances[L],g,w,re));let se=Promise.resolve(oe);d.length<3&&(se=se.then(re)),se.catch(Se=>o(Se))})}function ny(d,g,w,S,L=k=>k()){const k=[];for(const V of d)for(const X in V.components){let o=V.components[X];if(!(g!=="beforeRouteEnter"&&!V.instances[X]))if(IR(o)){const oe=(o.__vccOpts||o)[g];oe&&k.push(sl(oe,w,S,V,X,L))}else{let re=o();k.push(()=>re.then(oe=>{if(!oe)return Promise.reject(new Error(`Couldn't resolve component "${X}" at "${V.path}"`));const se=zP(oe)?oe.default:oe;V.components[X]=se;const Ie=(se.__vccOpts||se)[g];return Ie&&sl(Ie,w,S,V,X,L)()}))}}return k}function IR(d){return typeof d=="object"||"displayName"in d||"props"in d||"__vccOpts"in d}function ow(d){const g=no(Wm),w=no(GT),S=Ur(()=>g.resolve(Yn(d.to))),L=Ur(()=>{const{matched:o}=S.value,{length:re}=o,oe=o[re-1],se=w.matched;if(!oe||!se.length)return-1;const Se=se.findIndex(Du.bind(null,oe));if(Se>-1)return Se;const Ie=aw(o[re-2]);return re>1&&aw(oe)===Ie&&se[se.length-1].path!==Ie?se.findIndex(Du.bind(null,o[re-2])):Se}),k=Ur(()=>L.value>-1&&LR(w.params,S.value.params)),V=Ur(()=>L.value>-1&&L.value===w.matched.length-1&&FT(w.params,S.value.params));function X(o={}){return RR(o)?g[Yn(d.replace)?"replace":"push"](Yn(d.to)).catch(Yd):Promise.resolve()}return{route:S,href:Ur(()=>S.value.href),isActive:k,isExactActive:V,navigate:X}}const CR=Zy({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:ow,setup(d,{slots:g}){const w=Fo(ow(d)),{options:S}=no(Wm),L=Ur(()=>({[lw(d.activeClass,S.linkActiveClass,"router-link-active")]:w.isActive,[lw(d.exactActiveClass,S.linkExactActiveClass,"router-link-exact-active")]:w.isExactActive}));return()=>{const k=g.default&&g.default(w);return d.custom?k:MT("a",{"aria-current":w.isExactActive?d.ariaCurrentValue:null,href:w.href,onClick:w.navigate,class:L.value},k)}}}),PR=CR;function RR(d){if(!(d.metaKey||d.altKey||d.ctrlKey||d.shiftKey)&&!d.defaultPrevented&&!(d.button!==void 0&&d.button!==0)){if(d.currentTarget&&d.currentTarget.getAttribute){const g=d.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(g))return}return d.preventDefault&&d.preventDefault(),!0}}function LR(d,g){for(const w in g){const S=g[w],L=d[w];if(typeof S=="string"){if(S!==L)return!1}else if(!so(L)||L.length!==S.length||S.some((k,V)=>k!==L[V]))return!1}return!0}function aw(d){return d?d.aliasOf?d.aliasOf.path:d.path:""}const lw=(d,g,w)=>d??g??w,DR=Zy({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(d,{attrs:g,slots:w}){const S=no(Ey),L=Ur(()=>d.route||S.value),k=no(sw,0),V=Ur(()=>{let re=Yn(k);const{matched:oe}=L.value;let se;for(;(se=oe[re])&&!se.components;)re++;return re}),X=Ur(()=>L.value.matched[V.value]);dm(sw,Ur(()=>V.value+1)),dm(MR,X),dm(Ey,L);const o=ln();return Mu(()=>[o.value,X.value,d.name],([re,oe,se],[Se,Ie,qe])=>{oe&&(oe.instances[se]=re,Ie&&Ie!==oe&&re&&re===Se&&(oe.leaveGuards.size||(oe.leaveGuards=Ie.leaveGuards),oe.updateGuards.size||(oe.updateGuards=Ie.updateGuards))),re&&oe&&(!Ie||!Du(oe,Ie)||!Se)&&(oe.enterCallbacks[se]||[]).forEach(at=>at(re))},{flush:"post"}),()=>{const re=L.value,oe=d.name,se=X.value,Se=se&&se.components[oe];if(!Se)return cw(w.default,{Component:Se,route:re});const Ie=se.props[oe],qe=Ie?Ie===!0?re.params:typeof Ie=="function"?Ie(re):Ie:null,Ft=MT(Se,Or({},qe,g,{onVnodeUnmounted:Nt=>{Nt.component.isUnmounted&&(se.instances[oe]=null)},ref:o}));return cw(w.default,{Component:Ft,route:re})||Ft}}});function cw(d,g){if(!d)return null;const w=d(g);return w.length===1?w[0]:w}const Sy=DR;function zR(d){const g=bR(d.routes,d),w=d.parseQuery||SR,S=d.stringifyQuery||nw,L=d.history,k=jd(),V=jd(),X=jd(),o=LI(Qa);let re=Qa;Tu&&d.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const oe=iy.bind(null,it=>""+it),se=iy.bind(null,HP),Se=iy.bind(null,nf);function Ie(it,Wt){let Bt,qt;return VT(it)?(Bt=g.getRecordMatcher(it),qt=Wt):qt=it,g.addRoute(qt,Bt)}function qe(it){const Wt=g.getRecordMatcher(it);Wt&&g.removeRoute(Wt)}function at(){return g.getRoutes().map(it=>it.record)}function Ft(it){return!!g.getRecordMatcher(it)}function Nt(it,Wt){if(Wt=Or({},Wt||o.value),typeof it=="string"){const pe=ry(w,it,Wt.path),Be=g.resolve({path:pe.path},Wt),ot=L.createHref(pe.fullPath);return Or(pe,Be,{params:Se(Be.params),hash:nf(pe.hash),redirectedFrom:void 0,href:ot})}let Bt;if(it.path!=null)Bt=Or({},it,{path:ry(w,it.path,Wt.path).path});else{const pe=Or({},it.params);for(const Be in pe)pe[Be]==null&&delete pe[Be];Bt=Or({},it,{params:se(pe)}),Wt.params=se(Wt.params)}const qt=g.resolve(Bt,Wt),Ui=it.hash||"";qt.params=oe(Se(qt.params));const tr=YP(S,Or({},it,{hash:$P(Ui),path:qt.path})),de=L.createHref(tr);return Or({fullPath:tr,hash:Ui,query:S===nw?AR(it.query):it.query||{}},qt,{redirectedFrom:void 0,href:de})}function ri(it){return typeof it=="string"?ry(w,it,o.value.path):Or({},it)}function Jt(it,Wt){if(re!==it)return zu(8,{from:Wt,to:it})}function Xi(it){return vr(it)}function er(it){return Xi(Or(ri(it),{replace:!0}))}function wi(it){const Wt=it.matched[it.matched.length-1];if(Wt&&Wt.redirect){const{redirect:Bt}=Wt;let qt=typeof Bt=="function"?Bt(it):Bt;return typeof qt=="string"&&(qt=qt.includes("?")||qt.includes("#")?qt=ri(qt):{path:qt},qt.params={}),Or({query:it.query,hash:it.hash,params:qt.path!=null?{}:it.params},qt)}}function vr(it,Wt){const Bt=re=Nt(it),qt=o.value,Ui=it.state,tr=it.force,de=it.replace===!0,pe=wi(Bt);if(pe)return vr(Or(ri(pe),{state:typeof pe=="object"?Or({},Ui,pe.state):Ui,force:tr,replace:de}),Wt||Bt);const Be=Bt;Be.redirectedFrom=Wt;let ot;return!tr&&KP(S,qt,Bt)&&(ot=zu(16,{to:Be,from:qt}),Wr(qt,qt,!0,!1)),(ot?Promise.resolve(ot):Sr(Be,qt)).catch(Ke=>ca(Ke)?ca(Ke,2)?Ke:wn(Ke):zt(Ke,Be,qt)).then(Ke=>{if(Ke){if(ca(Ke,2))return vr(Or({replace:de},ri(Ke.to),{state:typeof Ke.to=="object"?Or({},Ui,Ke.to.state):Ui,force:tr}),Wt||Be)}else Ke=ni(Be,qt,!0,de,Ui);return Hr(Be,qt,Ke),Ke})}function zi(it,Wt){const Bt=Jt(it,Wt);return Bt?Promise.reject(Bt):Promise.resolve()}function Ue(it){const Wt=Kn.values().next().value;return Wt&&typeof Wt.runWithContext=="function"?Wt.runWithContext(it):it()}function Sr(it,Wt){let Bt;const[qt,Ui,tr]=kR(it,Wt);Bt=ny(qt.reverse(),"beforeRouteLeave",it,Wt);for(const pe of qt)pe.leaveGuards.forEach(Be=>{Bt.push(sl(Be,it,Wt))});const de=zi.bind(null,it,Wt);return Bt.push(de),Xr(Bt).then(()=>{Bt=[];for(const pe of k.list())Bt.push(sl(pe,it,Wt));return Bt.push(de),Xr(Bt)}).then(()=>{Bt=ny(Ui,"beforeRouteUpdate",it,Wt);for(const pe of Ui)pe.updateGuards.forEach(Be=>{Bt.push(sl(Be,it,Wt))});return Bt.push(de),Xr(Bt)}).then(()=>{Bt=[];for(const pe of tr)if(pe.beforeEnter)if(so(pe.beforeEnter))for(const Be of pe.beforeEnter)Bt.push(sl(Be,it,Wt));else Bt.push(sl(pe.beforeEnter,it,Wt));return Bt.push(de),Xr(Bt)}).then(()=>(it.matched.forEach(pe=>pe.enterCallbacks={}),Bt=ny(tr,"beforeRouteEnter",it,Wt,Ue),Bt.push(de),Xr(Bt))).then(()=>{Bt=[];for(const pe of V.list())Bt.push(sl(pe,it,Wt));return Bt.push(de),Xr(Bt)}).catch(pe=>ca(pe,8)?pe:Promise.reject(pe))}function Hr(it,Wt,Bt){X.list().forEach(qt=>Ue(()=>qt(it,Wt,Bt)))}function ni(it,Wt,Bt,qt,Ui){const tr=Jt(it,Wt);if(tr)return tr;const de=Wt===Qa,pe=Tu?history.state:{};Bt&&(qt||de?L.replace(it.fullPath,Or({scroll:de&&pe&&pe.scroll},Ui)):L.push(it.fullPath,Ui)),o.value=it,Wr(it,Wt,Bt,de),wn()}let br;function ss(){br||(br=L.listen((it,Wt,Bt)=>{if(!Ps.listening)return;const qt=Nt(it),Ui=wi(qt);if(Ui){vr(Or(Ui,{replace:!0}),qt).catch(Yd);return}re=qt;const tr=o.value;Tu&&sR(Yb(tr.fullPath,Bt.delta),Hm()),Sr(qt,tr).catch(de=>ca(de,12)?de:ca(de,2)?(vr(de.to,qt).then(pe=>{ca(pe,20)&&!Bt.delta&&Bt.type===sf.pop&&L.go(-1,!1)}).catch(Yd),Promise.reject()):(Bt.delta&&L.go(-Bt.delta,!1),zt(de,qt,tr))).then(de=>{de=de||ni(qt,tr,!1),de&&(Bt.delta&&!ca(de,8)?L.go(-Bt.delta,!1):Bt.type===sf.pop&&ca(de,20)&&L.go(-1,!1)),Hr(qt,tr,de)}).catch(Yd)}))}let lt=jd(),Vi=jd(),Fi;function zt(it,Wt,Bt){wn(it);const qt=Vi.list();return qt.length?qt.forEach(Ui=>Ui(it,Wt,Bt)):console.error(it),Promise.reject(it)}function Mn(){return Fi&&o.value!==Qa?Promise.resolve():new Promise((it,Wt)=>{lt.add([it,Wt])})}function wn(it){return Fi||(Fi=!it,ss(),lt.list().forEach(([Wt,Bt])=>it?Bt(it):Wt()),lt.reset()),it}function Wr(it,Wt,Bt,qt){const{scrollBehavior:Ui}=d;if(!Tu||!Ui)return Promise.resolve();const tr=!Bt&&oR(Yb(it.fullPath,0))||(qt||!Bt)&&history.state&&history.state.scroll||null;return Fm().then(()=>Ui(it,Wt,tr)).then(de=>de&&nR(de)).catch(de=>zt(de,it,Wt))}const dr=it=>L.go(it);let Nn;const Kn=new Set,Ps={currentRoute:o,listening:!0,addRoute:Ie,removeRoute:qe,hasRoute:Ft,getRoutes:at,resolve:Nt,options:d,push:Xi,replace:er,go:dr,back:()=>dr(-1),forward:()=>dr(1),beforeEach:k.add,beforeResolve:V.add,afterEach:X.add,onError:Vi.add,isReady:Mn,install(it){const Wt=this;it.component("RouterLink",PR),it.component("RouterView",Sy),it.config.globalProperties.$router=Wt,Object.defineProperty(it.config.globalProperties,"$route",{enumerable:!0,get:()=>Yn(o)}),Tu&&!Nn&&o.value===Qa&&(Nn=!0,Xi(L.location).catch(Ui=>{}));const Bt={};for(const Ui in Qa)Object.defineProperty(Bt,Ui,{get:()=>o.value[Ui],enumerable:!0});it.provide(Wm,Wt),it.provide(GT,Zw(Bt)),it.provide(Ey,o);const qt=it.unmount;Kn.add(it),it.unmount=function(){Kn.delete(it),Kn.size<1&&(re=Qa,br&&br(),br=null,o.value=Qa,Nn=!1,Fi=!1),qt()}}};function Xr(it){return it.reduce((Wt,Bt)=>Wt.then(()=>Ue(Bt)),Promise.resolve())}return Ps}function kR(d,g){const w=[],S=[],L=[],k=Math.max(g.matched.length,d.matched.length);for(let V=0;V<k;V++){const X=g.matched[V];X&&(d.matched.find(re=>Du(re,X))?S.push(X):w.push(X));const o=d.matched[V];o&&(g.matched.find(re=>Du(re,o))||L.push(o))}return[w,S,L]}function $T(){return no(Wm)}const OR={__name:"App",setup(d){return localStorage.language="es",(g,w)=>(Wi(),Ji(En,null,[nr(Yn(Sy)),nr(Yn(Sy))],64))}},BR=["es","en"],FR=[["Sección 1","Section 1"],["Sección 2","Section 2"],["Sección 3","Section 3"],["es-fot-1","en-fot-1"],["es-fot-2","en-fot-2"],["es-fot-3","en-fot-3"]],uw={languages:BR,dictionary:FR},ao=LT("i18n",()=>{const d=Fo(uw.languages),g=Fo(uw.dictionary),w=ln(k());function S(V){const X=g.findIndex(re=>re[0]===V),o=d.findIndex(re=>re===w.value);return X===-1||o===-1?V:g[X][o]}function L(V){d.includes(V)&&(w.value=V),localStorage.setItem("language",w.value)}function k(){return localStorage.getItem("language")||d[0]}return{_:S,languages:d,language:w,set:L,get:k}}),oo=LT("data",()=>{const d=Fo({header:{es:{txt1:"Producto",txt2:"Contacto",txt3:"Blog",txt4:"Sobre nosotros",txt5:"Inscribirse",txt6:"Registrarse"},en:{txt1:"Product",txt2:"Contact",txt3:"Blog",txt4:"About",txt5:"Login",txt6:"Sign in"},links:{link1:"/product",link2:"/contact",link3:"/blog",link4:"/about",link5:"/login",link6:"/login"}},layer1:{es:{txt1:"Transformando la Experiencia de Viaje",txt2:"Encuentra el camino hacia tu viaje",txt3:"Organiza tu viaje ideal con nosotros"},en:{txt1:"Transforming the Travel Experience",txt2:"Find the way to your journey",txt3:"Organize your ideal trip with us"}},search:{es:{txt1:"¿Donde quieres ir de viaje?",txt2:"Generar viaje"},en:{txt1:"Where are you going to?",txt2:"Generate trip"}},aboutSection1:{es:{span1:"Descubre tu",span2:"próxima aventura",txt1:"Selecciona y personaliza tu viaje",txt2:"Comienza tu viaje"},en:{span1:"Discover your",span2:"next adventure",txt1:"Select and customize your trip",txt2:"Start your journey"}},aboutSection3:{es:{type0:{txt1:"Simplicidad en Accion",txt2:"Introduce un prompt, genera un plan de viaje",btn1:"Ver cómo"},type1:{txt1:"Emprende la aventura",txt2:"El mundo te espera, descúbrelo",btn1:"Únete Ahora",btn2:"Saber más"}},en:{type0:{txt1:"Simplicity in Action",txt2:"Enter a prompt, generate a travel plan",btn1:"See how"},type1:{txt1:"Start the adventure",txt2:"The world awaits you, discover it",btn1:"Join Now",btn2:"Learn more"}}},aboutSection4:{es:{title1:"Propmt Inteligente",title2:"Aventuras a medida",title3:"Exploración mundial",title4:"Itinerarios instantáneos",txt1:"Tecnología que convierte palabras en itinerarios",txt2:"Personalice sus viajes con la creatividad de la IA",txt3:"Descubra destinos gracias a la inteligencia artificial",txt4:"Generar rápidamente planes para cualquier ayuda"},en:{title1:"Propmt Inteligence",title2:"Custom Adventures",title3:"Global Exploration",title4:"Instant Itinieraries",txt1:"Technology that turns words into itineraries",txt2:"Personalize your travel with AI creativity",txt3:"Discover destinations throught AI insights",txt4:"Quickly generate plans for any help"}},footerTeo:{es:{txt1:"Todos los derechos reservados 2024"},en:{txt1:"All rights reserved 2024"}}});function g(w,S){return d[w][S]}return{get:g}}),qT="/assets/logo-CKH6eN2w.png",Fn=(d,g)=>{const w=d.__vccOpts||d;for(const[S,L]of g)w[S]=L;return w},NR=["value"],VR={__name:"traduction",setup(d){const g=ao(),w=localStorage.language?localStorage.language:"es",S=ln(w);function L(k){g.set(k.target.value)}return(k,V)=>(Wi(),Ji("div",null,[fy(Et("select",{onChange:L,"onUpdate:modelValue":V[0]||(V[0]=X=>S.value=X)},[(Wi(!0),Ji(En,null,Tm(Yn(g).languages,(X,o)=>(Wi(),Ji("option",{key:o,value:X},Pw(X),9,NR))),128))],544),[[xP,S.value]])]))}},ZT=Fn(VR,[["__scopeId","data-v-af2f236d"]]),UR=d=>(gc("data-v-ccf5eccb"),d=d(),yc(),d),jR=UR(()=>Et("img",{src:"",alt:""},null,-1)),GR={id:"menu-content"},$R={id:"nav"},qR={id:"col1"},ZR=["href","innerHTML"],HR={__name:"mobileMenu",setup(d){const g=ao(),w=Ur(()=>oo().get("header",g.language)),S=Ur(()=>oo().get("header","links")),L=ln(Object.keys(w.value).length),k=ln(!1),V=ln(window.innerWidth);window.addEventListener("resize",()=>{window.innerWidth<=1200?V.value=!0:(V.value,k.value=!1)});function X(){k.value=!k.value}return(o,re)=>(Wi(),Ji("div",null,[Et("div",{id:"desp",onClick:X},[jR,TT("= ")]),nr(ZT,{id:"Mtraduction"}),V.value<=1200?(Wi(),Ji("div",{key:0,id:"menu",class:Bs({desplegar:k.value})},[Et("div",GR,[Et("nav",$R,[Et("ul",qR,[(Wi(!0),Ji(En,null,Tm(L.value,(oe,se)=>(Wi(),Ji("li",{key:se},[Et("a",{href:S.value["link"+oe],innerHTML:w.value["txt"+oe]},null,8,ZR)]))),128))])])])],2)):Xy("",!0)]))}},WR=Fn(HR,[["__scopeId","data-v-ccf5eccb"]]),XR={class:"logo"},YR={href:"/"},KR=["src"],JR={id:"col1"},QR=["href","innerHTML"],eL={id:"col2"},tL=["href","innerHTML"],hw=4,iL={__name:"HeaderComponent",setup(d){const g=ao(),w=oo(),S=Ur(()=>w.get("header",g.language)),L=Ur(()=>w.get("header","links")),k=Ur(()=>Object.keys(S.value).length);return(V,X)=>(Wi(),Ji(En,null,[nr(WR),Et("header",null,[Et("div",XR,[Et("a",YR,[Et("img",{src:Yn(qT),alt:"logo"},null,8,KR)])]),Et("ul",JR,[(Wi(!0),Ji(En,null,Tm(Math.min(k.value,hw),(o,re)=>(Wi(),Ji("li",{key:re},[Et("a",{href:L.value["link"+o],innerHTML:S.value["txt"+o]},null,8,QR)]))),128))]),Et("ul",eL,[nr(ZT,{id:"traduction"}),(Wi(!0),Ji(En,null,Tm(Math.max(0,k.value-hw),(o,re)=>(Wi(),Ji("li",{key:re},[Et("a",{href:L.value["link"+(k.value-re)],innerHTML:S.value["txt"+(k.value-re)]},null,8,tL)]))),128))])])],64))}},HT=Fn(iL,[["__scopeId","data-v-1b7d3dad"]]);var rL=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nL(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var WT={exports:{}};(function(d,g){var w={};(function(S,L){d.exports=L()})(rL,function(){var S,L,k;function V(o,re){if(!S)S=re;else if(!L)L=re;else{var oe="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+S+")(sharedChunk); ("+L+")(sharedChunk); self.onerror = null;",se={};S(se),k=re(se),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(k.workerUrl=window.URL.createObjectURL(new Blob([oe],{type:"text/javascript"})))}}V(["exports"],function(o){var re="3.3.0";let oe;const se={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(oe==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{oe=w.API_URL_REGEX!=null?new RegExp(w.API_URL_REGEX):t}catch{oe=t}}return oe},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!se.API_URL)return null;try{const t=new URL(se.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function Se(t){return se.API_URL_REGEX.test(t)}function Ie(t){return t.indexOf("mapbox:")===0}function qe(t){return se.API_CDN_URL_REGEX.test(t)}function at(t){return se.API_SPRITE_REGEX.test(t)}function Ft(t){return se.API_STYLE_REGEX.test(t)&&!at(t)}const Nt={create:"create",load:"load",fullLoad:"fullLoad"};function ri(t){const e=t.name.split("?")[0];return qe(e)&&e.includes("mapbox-gl.js")?"javascript":qe(e)&&e.includes("mapbox-gl.css")?"css":function(i){return se.API_FONTS_REGEX.test(i)}(e)?"fontRange":at(e)?"sprite":Ft(e)?"style":function(i){return se.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}function Jt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Xi=er;function er(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=n}er.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,n=0;n<8;n++){var a=this.sampleCurveX(i)-t;if(Math.abs(a)<e)return i;var l=this.sampleCurveDerivativeX(i);if(Math.abs(l)<1e-6)break;i-=a/l}var h=0,p=1;for(i=t,n=0;n<20&&(a=this.sampleCurveX(i),!(Math.abs(a-t)<e));n++)t>a?h=i:p=i,i=.5*(p-h)+h;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var wi=Jt(Xi),vr=zi;function zi(t,e){this.x=t,this.y=e}zi.prototype={clone:function(){return new zi(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),a=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-n*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},zi.convert=function(t){return t instanceof zi?t:Array.isArray(t)?new zi(t[0],t[1]):t};var Ue=Jt(vr);const Sr=Math.PI/180,Hr=180/Math.PI;function ni(t){return t*Sr}function br(t){return t*Hr}const ss=[[0,0],[1,0],[1,1],[0,1]];function lt(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function Vi(t,e,i,n){const a=new wi(t,e,i,n);return function(l){return a.solve(l)}}const Fi=Vi(.25,.1,.25,1);function zt(t,e,i){return Math.min(i,Math.max(e,t))}function Mn(t,e,i){return(i=zt((i-t)/(e-t),0,1))*i*(3-2*i)}function wn(t,e,i){const n=i-e,a=((t-e)%n+n)%n+e;return a===e?i:a}function Wr(t,e,i){if(!t.length)return i(null,[]);let n=t.length;const a=new Array(t.length);let l=null;t.forEach((h,p)=>{e(h,(_,y)=>{_&&(l=_),a[p]=y,--n==0&&i(l,a)})})}function dr(t,...e){for(const i of e)for(const n in i)t[n]=i[n];return t}let Nn=1;function Kn(){return Nn++}function Ps(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Xr(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function it(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Wt(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Bt(t,e){return t.indexOf(e,t.length-e.length)!==-1}function qt(t,e,i){const n={};for(const a in t)n[a]=e.call(i||this,t[a],a,t);return n}function Ui(t,e,i){const n={};for(const a in t)e.call(i||this,t[a],a,t)&&(n[a]=t[a]);return n}function tr(t){return Array.isArray(t)?t.map(tr):typeof t=="object"&&t?qt(t,tr):t}const de={};function pe(t){de[t]||(typeof console<"u"&&console.warn(t),de[t]=!0)}function Be(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function ot(t){let e=0;for(let i,n,a=0,l=t.length,h=l-1;a<l;h=a++)i=t[a],n=t[h],e+=(n.x-i.x)*(i.y+n.y);return e}function Ke([t,e,i]){const n=ni(e+90),a=ni(i);return{x:t*Math.cos(n)*Math.sin(a),y:t*Math.sin(n)*Math.sin(a),z:t*Math.cos(a),azimuthal:e,polar:i}}function Tt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Vt(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,n,a,l)=>{const h=a||l;return e[n]=!h||h.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let ft,Lt,gt,jt,si,ei,we=null;function q(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function te(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function ue(t,e,i,n){for(;e<i;){const a=e+i>>1;t[a]<n?e=a+1:i=a}return e}function Ce(t,e,i,n){for(;e<i;){const a=e+i>>1;t[a]<=n?e=a+1:i=a}return e}function Oe(){return ft==null&&(ft=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ft}const Xe={now:()=>jt!==void 0?jt:performance.now(),setNow(t){jt=t},restoreNow(){jt=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:n}=t;si||(si=document.createElement("canvas"));const a=si.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(i>si.width||n>si.height)&&(si.width=i,si.height=n),a.clearRect(-e,-e,i+2*e,n+2*e),a.drawImage(t,0,0,i,n),a.getImageData(-e,-e,i+2*e,n+2*e)},resolveURL:t=>(Lt||(Lt=document.createElement("a")),Lt.href=t,Lt.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(gt==null&&(gt=window.matchMedia("(prefers-reduced-motion: reduce)")),gt.matches)},hasCanvasFingerprintNoise(){if(ei!==void 0)return ei;if(!Oe())return ei=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let i=0;for(let a=0;a<t.width;++a)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(a,0,1,1);const n=e.getImageData(0,0,t.width,t.height);i=0;for(let a=0;a<n.data.length;++a)if(a%4!=3&&i++!==n.data[a])return ei=!0,!0;return ei=!1,!1}},St="mapbox-tiles";let ke=500,It=50,ht,bt;function fi(){try{return caches}catch{}}function sr(){const t=fi();t&&!ht&&(ht=t.open(St))}function wr(t){const e=t.indexOf("?");if(e<0)return t;const i=["language","worldview"],n=new URLSearchParams,a=new URLSearchParams(t.slice(e));for(const l of i){const h=a.get(l);h&&n.set(l,h)}return`${t.slice(0,e)}?${n.toString()}`}function or(t,e){const i=t.indexOf("?");if(i<0)return`${t}?${new URLSearchParams(e).toString()}`;const n=new URLSearchParams(t.slice(i));for(const a in e)n.set(a,e[a]);return`${t.slice(0,i)}?${n.toString()}`}let Yi=1/0;const $i={supported:!1,testSupport:function(t){!nn&&fr&&(gr?In(t):ir=t)}};let ir,fr,nn=!1,gr=!1;const Ln=typeof self<"u"?self:{};function In(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,fr),t.isContextLost())return;$i.supported=!0}catch{}t.deleteTexture(e),nn=!0}Ln.document&&(fr=Ln.document.createElement("img"),fr.onload=function(){ir&&In(ir),ir=null,gr=!0},fr.onerror=function(){nn=!0,ir=null},fr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Vn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Vn);class Yr extends Error{constructor(e,i,n){i===401&&Se(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Gr=Tt()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ze=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(Gr())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(n,a){const l=new AbortController,h=new Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:Gr(),referrerPolicy:n.referrerPolicy,signal:l.signal});let p=!1,_=!1;const y=(v=h.url).indexOf("sku=")>0&&Se(v);var v;n.type==="json"&&h.headers.set("Accept","application/json");const T=(C,R,D)=>{if(_)return;if(C&&C.message!=="SecurityError"&&pe(C.toString()),R&&D)return A(R);const B=Date.now();fetch(h).then(N=>{if(N.ok){const H=y?N.clone():null;return A(N,H,B)}return a(new Yr(N.statusText,N.status,n.url))}).catch(N=>{N.name!=="AbortError"&&a(new Error(`${N.message} ${n.url}`))})},A=(C,R,D)=>{(n.type==="arrayBuffer"?C.arrayBuffer():n.type==="json"?C.json():C.text()).then(B=>{_||(R&&D&&function(N,H,K){if(sr(),!ht)return;const Y=Vt(H.headers.get("Cache-Control")||"");if(Y["no-store"])return;const ne={status:H.status,statusText:H.statusText,headers:new Headers};H.headers.forEach((me,ye)=>ne.headers.set(ye,me)),Y["max-age"]&&ne.headers.set("Expires",new Date(K+1e3*Y["max-age"]).toUTCString());const ie=ne.headers.get("Expires");if(!ie||new Date(ie).getTime()-K<42e4)return;let ce=wr(N.url);if(H.status===206){const me=N.headers.get("Range");if(!me)return;ne.status=200,ce=or(ce,{range:me})}(function(me,ye){if(bt===void 0)try{new Response(new ReadableStream),bt=!0}catch{bt=!1}bt?ye(me.body):me.blob().then(ye)})(H,me=>{const ye=new Response(me,ne);sr(),ht&&ht.then(Ee=>Ee.put(ce,ye)).catch(Ee=>pe(Ee.message))})}(h,R,D),p=!0,a(null,B,C.headers.get("Cache-Control"),C.headers.get("Expires")))}).catch(B=>{_||a(new Error(B.message))})};return y?function(C,R){if(sr(),!ht)return R(null);ht.then(D=>{let B=wr(C.url);const N=C.headers.get("Range");N&&(B=or(B,{range:N})),D.match(B).then(H=>{const K=function(Y){if(!Y)return!1;const ne=new Date(Y.headers.get("Expires")||0),ie=Vt(Y.headers.get("Cache-Control")||"");return ne>Date.now()&&!ie["no-cache"]}(H);D.delete(B),K&&D.put(B,H.clone()),R(null,H,K)}).catch(R)}).catch(R)}(h,T):T(null,null),{cancel:()=>{_=!0,p||l.abort()}}}(t,e);if(Tt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(n,a){const l=new XMLHttpRequest;l.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(const h in n.headers)l.setRequestHeader(h,n.headers[h]);return n.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=n.credentials==="include",l.onerror=()=>{a(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let h=l.response;if(n.type==="json")try{h=JSON.parse(l.response)}catch(p){return a(p)}a(null,h,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else a(new Yr(l.statusText,l.status,n.url))},l.send(n.body),{cancel:()=>l.abort()}}(t,e)},Fe=function(t,e){return ze(dr(t,{type:"arrayBuffer"}),e)};function Ye(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const st="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let et,pt;et=[],pt=0;const mt=function(t,e){if($i.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),pt>=se.MAX_PARALLEL_IMAGE_REQUESTS){const l={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return et.push(l),l}pt++;let i=!1;const n=()=>{if(!i)for(i=!0,pt--;et.length&&pt<se.MAX_PARALLEL_IMAGE_REQUESTS;){const l=et.shift(),{requestParameters:h,callback:p,cancelled:_}=l;_||(l.cancel=mt(h,p).cancel)}},a=Fe(t,(l,h,p,_)=>{n(),l?e(l):h&&(self.createImageBitmap?function(y,v){const T=new Blob([new Uint8Array(y)],{type:"image/png"});createImageBitmap(T).then(A=>{v(null,A)}).catch(A=>{v(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(y,v)=>e(y,v,p,_)):function(y,v){const T=new Image;T.onload=()=>{v(null,T),URL.revokeObjectURL(T.src),T.onload=null,requestAnimationFrame(()=>{T.src=st})},T.onerror=()=>v(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const A=new Blob([new Uint8Array(y)],{type:"image/png"});T.src=y.byteLength?URL.createObjectURL(A):st}(h,(y,v)=>e(y,v,p,_)))});return{cancel:()=>{a.cancel(),n()}}},rt="01",yt="NO_ACCESS_TOKEN",ct=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Kt(t){const e=t.match(ct);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ei(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Ot="mapbox.eventData";function ar(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ar{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=ar(se.ACCESS_TOKEN);let n="";return n=i&&i.u?btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(a,l)=>String.fromCharCode(+("0x"+l)))):se.ACCESS_TOKEN||"",e?`${Ot}.${e}:${n}`:`${Ot}:${n}`}fetchEventData(){const e=q("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const a=localStorage.getItem(i);a&&(this.eventData=JSON.parse(a));const l=localStorage.getItem(n);l&&(this.anonId=l)}catch{pe("Unable to read from LocalStorage")}}saveEventData(){const e=q("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid"),a=this.anonId;if(e&&a)try{localStorage.setItem(n,a),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{pe("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,n,a){if(!se.EVENTS_URL)return;const l=Kt(se.EVENTS_URL);l.params.push(`access_token=${a||se.ACCESS_TOKEN||""}`);const h={event:this.type,created:new Date(e).toISOString()},p=i?dr(h,i):h,_={url:Ei(l),headers:{"Content-Type":"text/plain"},body:JSON.stringify([p])};this.pendingRequest=function(y,v){return ze(dr(y,{method:"POST"}),v)}(_,y=>{this.pendingRequest=null,n(y),this.saveEventData(),this.processRequests(a)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const hr=new class extends Ar{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){se.EVENTS_URL&&se.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>Ie(i)||Se(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=ar(se.ACCESS_TOKEN),i=e?e.u:se.ACCESS_TOKEN;let n=i!==this.eventData.tokenU;it(this.anonId)||(this.anonId=Ps(),n=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const l=new Date(this.eventData.lastSuccess),h=new Date(a),p=(a-this.eventData.lastSuccess)/864e5;n=n||p>=1||p<-1||l.getDate()!==h.getDate()}else n=!0;n?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:re,skuId:rt,"enabled.telemetry":!1,userId:this.anonId},l=>{l||(this.eventData.lastSuccess=a,this.eventData.tokenU=i)},t):this.processRequests()}},Kr=hr.postTurnstileEvent.bind(hr),mn=new class extends Ar{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,n){this.skuToken=e,this.errorCb=n,se.EVENTS_URL&&(i||se.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(yt)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),it(this.anonId)||(this.anonId=Ps()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:re,skuId:rt,skuToken:this.skuToken,userId:this.anonId},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},ji=mn.postMapLoadEvent.bind(mn),Jn=new class extends Ar{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){se.EVENTS_URL&&(t||se.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),n=function(a){const l=performance.getEntriesByType("resource"),h=performance.getEntriesByType("mark"),p=function(C){const R={};if(C){for(const D in C)if(D!=="other")for(const B of C[D]){const N=`${D}ResolveRangeMin`,H=`${D}ResolveRangeMax`,K=`${D}RequestCount`,Y=`${D}RequestCachedCount`;R[N]=Math.min(R[N]||1/0,B.startTime),R[H]=Math.max(R[H]||-1/0,B.responseEnd);const ne=ie=>{R[ie]===void 0&&(R[ie]=0),++R[ie]};B.transferSize!==void 0&&B.transferSize===0&&ne(Y),ne(K)}}return R}(function(C,R){const D={};if(C)for(const B of C){const N=R(B);D[N]===void 0&&(D[N]=[]),D[N].push(B)}return D}(l,ri)),_=window.devicePixelRatio,y=navigator.connection||navigator.mozConnection||navigator.webkitConnection,v=y?y.effectiveType:void 0,T={counters:[],metadata:[],attributes:[]},A=(C,R,D)=>{D!=null&&C.push({name:R,value:D.toString()})};for(const C in p)A(T.counters,C,p[C]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(A(T.counters,"interactionRangeMin",a.interactionRange[0]),A(T.counters,"interactionRangeMax",a.interactionRange[1])),h)for(const C of Object.keys(Nt)){const R=Nt[C],D=h.find(B=>B.name===R);D&&A(T.counters,R,D.startTime)}return A(T.counters,"visibilityHidden",a.visibilityHidden),A(T.attributes,"style",function(C){if(C)for(const R of C){const D=R.name.split("?")[0];if(Ft(D)){const B=D.split("/").slice(-2);if(B.length===2)return`mapbox://styles/${B[0]}/${B[1]}`}}}(l)),A(T.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),A(T.attributes,"fogEnabled",a.fogEnabled?"true":"false"),A(T.attributes,"projection",a.projection),A(T.attributes,"zoom",a.zoom),A(T.metadata,"devicePixelRatio",_),A(T.metadata,"connectionEffectiveType",v),A(T.metadata,"navigatorUserAgent",navigator.userAgent),A(T.metadata,"screenWidth",window.screen.width),A(T.metadata,"screenHeight",window.screen.height),A(T.metadata,"windowWidth",window.innerWidth),A(T.metadata,"windowHeight",window.innerHeight),A(T.metadata,"mapWidth",a.width/_),A(T.metadata,"mapHeight",a.height/_),A(T.metadata,"webglRenderer",a.renderer),A(T.metadata,"webglVendor",a.vendor),A(T.metadata,"sdkVersion",re),A(T.metadata,"sdkIdentifier","mapbox-gl-js"),T}(i);for(const a of n.metadata);for(const a of n.counters);for(const a of n.attributes);this.postEvent(e,n,()=>{},t)}},_s=Jn.postPerformanceEvent.bind(Jn),_n=new class extends Ar{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,n){if(!se.API_URL||!se.SESSION_PATH)return;const a=Kt(se.API_URL+se.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${n||se.ACCESS_TOKEN||""}`);const l={url:Ei(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(h,p){return ze(dr(h,{method:"GET"}),p)}(l,h=>{this.pendingRequest=null,i(h),this.saveEventData(),this.processRequests(n)})}getSessionAPI(t,e,i,n){this.skuToken=e,this.errorCb=n,se.SESSION_PATH&&se.API_URL&&(i||se.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(yt)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},dl=_n.getSessionAPI.bind(_n),lo=new Set;function fa(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function Nu(t,e,i){if(i&&i[t]){const n=i[t].indexOf(e);n!==-1&&i[t].splice(n,1)}}class Vo{constructor(e,i={}){dr(this,i),this.type=e}}class Vu extends Vo{constructor(e,i={}){super("error",dr({error:e},i))}}class pa{on(e,i){return this._listeners=this._listeners||{},fa(e,i,this._listeners),this}off(e,i){return Nu(e,i,this._listeners),Nu(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},fa(e,i,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,i){typeof e=="string"&&(e=new Vo(e,i||{}));const n=e.type;if(this.listens(n)){e.target=this;const a=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const p of a)p.call(this,e);const l=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const p of l)Nu(n,p,this._oneTimeListeners),p.call(this,e);const h=this._eventedParent;h&&(dr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),h.fire(e))}else e instanceof Vu&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}o.y=void 0;var df={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function xc(t){return(t=Math.round(t))<0?0:t>255?255:t}function Uu(t){return xc(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function vc(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function ju(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{o.y={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in df)return df[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=i.indexOf("("),a=i.indexOf(")");if(n!==-1&&a+1===i.length){var l=i.substr(0,n),h=i.substr(n+1,a-(n+1)).split(","),p=1;switch(l){case"rgba":if(h.length!==4)return null;p=vc(h.pop());case"rgb":return h.length!==3?null:[Uu(h[0]),Uu(h[1]),Uu(h[2]),p];case"hsla":if(h.length!==4)return null;p=vc(h.pop());case"hsl":if(h.length!==3)return null;var _=(parseFloat(h[0])%360+360)%360/360,y=vc(h[1]),v=vc(h[2]),T=v<=.5?v*(y+1):v+y-v*y,A=2*v-T;return[xc(255*ju(A,T,_+1/3)),xc(255*ju(A,T,_)),xc(255*ju(A,T,_-1/3)),p];default:return null}}return null}}catch{}class Un{constructor(e,i,n,a=1){this.r=e,this.g=i,this.b=n,this.a=a}static parse(e){if(!e)return;if(e instanceof Un)return e;if(typeof e!="string")return;const i=o.y(e);return i?new Un(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,n,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(n)},${a})`}toArray(){const{r:e,g:i,b:n,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*i/a,255*n/a,a]}toArray01(){const{r:e,g:i,b:n,a}=this;return a===0?[0,0,0,0]:[e/a,i/a,n/a,a]}toArray01Scaled(e){const{r:i,g:n,b:a,a:l}=this;return l===0?[0,0,0]:[i/l*e,n/l*e,a/l*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:n,a}=this;return[e,i,n,a]}toArray01Linear(){const{r:e,g:i,b:n,a}=this;return a===0?[0,0,0,0]:[Math.pow(e/a,2.2),Math.pow(i/a,2.2),Math.pow(n/a,2.2),a]}}Un.black=new Un(0,0,0,1),Un.white=new Un(1,1,1,1),Un.transparent=new Un(0,0,0,0),Un.red=new Un(1,0,0,1),Un.blue=new Un(0,0,1,1);var $r=Un;function Si(t,e,i){return t*(1-i)+e*i}function ff(t,e,i){return t.map((n,a)=>Si(n,e[a],i))}var bc=Object.freeze({__proto__:null,array:ff,color:function(t,e,i){return new $r(Si(t.r,e.r,i),Si(t.g,e.g,i),Si(t.b,e.b,i),Si(t.a,e.a,i))},number:Si});function Gu(t,...e){for(const i of e)for(const n in i)t[n]=i[n];return t}class r_ extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var Rs=r_;class $u{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[n,a]of i)this.bindings[n]=a}concat(e){return new $u(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var n_=$u;const ma={kind:"null"},vt={kind:"number"},qi={kind:"string"},Zi={kind:"boolean"},os={kind:"color"},_a={kind:"object"},Ri={kind:"value"},wc={kind:"collator"},ga={kind:"formatted"},fl={kind:"resolvedImage"};function jn(t,e){return{kind:"array",itemType:t,N:e}}function Vr(t){if(t.kind==="array"){const e=Vr(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const Zt=[ma,vt,qi,Zi,os,ga,_a,jn(Ri),fl];function Uo(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Uo(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of Zt)if(!Uo(i,e))return null}}return`Expected ${Vr(t)} but found ${Vr(e)} instead.`}function ti(t,e){return e.some(i=>i.kind===t.kind)}function co(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}class gi{constructor(e,i,n){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ya{constructor(e,i,n,a,l){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=n,this.fontStack=a,this.textColor=l}}class gn{constructor(e){this.sections=e}static fromString(e){return new gn([new ya(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof gn?e:gn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const n={};i.fontStack&&(n["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(n["font-scale"]=i.scale),i.textColor&&(n["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(n)}return e}}class Ht{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new Ht({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function pf(t,e,i,n){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[t,e,i,n]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function jo(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof $r||t instanceof gi||t instanceof gn||t instanceof Ht)return!0;if(Array.isArray(t)){for(const e of t)if(!jo(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!jo(t[e]))return!1;return!0}return!1}function Jr(t){if(t===null)return ma;if(typeof t=="string")return qi;if(typeof t=="boolean")return Zi;if(typeof t=="number")return vt;if(t instanceof $r)return os;if(t instanceof gi)return wc;if(t instanceof gn)return ga;if(t instanceof Ht)return fl;if(Array.isArray(t)){const e=t.length;let i;for(const n of t){const a=Jr(n);if(i){if(i===a)continue;i=Ri;break}i=a}return jn(i||Ri,e)}return _a}function as(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof $r||t instanceof gn||t instanceof Ht?t.toString():JSON.stringify(t)}class uo{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!jo(e[1]))return i.error("invalid value");const n=e[1];let a=Jr(n);const l=i.expectedType;return a.kind!=="array"||a.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(a=l),new uo(a,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof $r?["rgba"].concat(this.value.toArray()):this.value instanceof gn?this.value.serialize():this.value}}var Ns=uo,Qr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const qu={string:qi,number:vt,boolean:Zi,object:_a};class Zu{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let n,a=1;const l=e[0];if(l==="array"){let p,_;if(e.length>2){const y=e[1];if(typeof y!="string"||!(y in qu)||y==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);p=qu[y],a++}else p=Ri;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);_=e[2],a++}n=jn(p,_)}else n=qu[l];const h=[];for(;a<e.length;a++){const p=i.parse(e[a],a,Ri);if(!p)return null;h.push(p)}return new Zu(n,h)}evaluate(e){for(let i=0;i<this.args.length;i++){const n=this.args[i].evaluate(e);if(!Uo(this.type,Jr(n)))return n;if(i===this.args.length-1)throw new Qr(`Expected value to be of type ${Vr(this.type)}, but found ${Vr(Jr(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){i.push(n.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&i.push(a)}}return i.concat(this.args.map(n=>n.serialize()))}}var Vs=Zu;class xa{constructor(e){this.type=ga,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return i.error("First argument must be an image or text section.");const a=[];let l=!1;for(let h=1;h<=e.length-1;++h){const p=e[h];if(l&&typeof p=="object"&&!Array.isArray(p)){l=!1;let _=null;if(p["font-scale"]&&(_=i.parse(p["font-scale"],1,vt),!_))return null;let y=null;if(p["text-font"]&&(y=i.parse(p["text-font"],1,jn(qi)),!y))return null;let v=null;if(p["text-color"]&&(v=i.parse(p["text-color"],1,os),!v))return null;const T=a[a.length-1];T.scale=_,T.font=y,T.textColor=v}else{const _=i.parse(e[h],1,Ri);if(!_)return null;const y=_.type.kind;if(y!=="string"&&y!=="value"&&y!=="null"&&y!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,a.push({content:_,scale:null,font:null,textColor:null})}}return new xa(a)}evaluate(e){return new gn(this.sections.map(i=>{const n=i.content.evaluate(e);return Jr(n)===fl?new ya("",n,null,null,null):new ya(as(n),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const n={};i.scale&&(n["font-scale"]=i.scale.serialize()),i.font&&(n["text-font"]=i.font.serialize()),i.textColor&&(n["text-color"]=i.textColor.serialize()),e.push(n)}return e}}class Go{constructor(e,i){this.type=fl,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");const n=i.parse(e[1],1,qi);if(!n)return i.error("No image name provided.");if(e.length===2)return new Go(n);const a=i.parse(e[2],1,qi);return a?new Go(n,a):i.error("Secondary image variant is not a string.")}evaluate(e){const i=Ht.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function va(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const gs={"to-boolean":Zi,"to-color":os,"to-number":vt,"to-string":qi};class Tc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const n=e[0],a=[];let l=ma;if(n==="to-array"){if(!Array.isArray(e[1]))return null;const h=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);l=jn(i.expectedType.itemType,h)}else{if(!(h>0&&jo(e[1][0])))return null;l=jn(Jr(e[1][0]),h)}for(let p=0;p<h;p++){const _=e[1][p];let y;if(va(_)==="array")y=i.parse(_,void 0,l.itemType);else{const v=va(_);if(v!==l.itemType.kind)return i.error(`Expected ${l.itemType.kind} but found ${v}.`);y=i.registry.literal.parse(["literal",_===void 0?null:_],i)}if(!y)return null;a.push(y)}}else{if((n==="to-boolean"||n==="to-string")&&e.length!==2)return i.error("Expected one argument.");l=gs[n];for(let h=1;h<e.length;h++){const p=i.parse(e[h],h,Ri);if(!p)return null;a.push(p)}}return new Tc(l,a)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,n;for(const a of this.args){if(i=a.evaluate(e),n=null,i instanceof $r)return i;if(typeof i=="string"){const l=e.parseColor(i);if(l)return l}else if(Array.isArray(i)&&(n=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:pf(i[0],i[1],i[2],i[3]),!n))return new $r(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Qr(n||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const n of this.args){if(i=n.evaluate(e),i===null)return 0;const a=Number(i);if(!isNaN(a))return a}throw new Qr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?gn.fromString(as(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ht.fromString(as(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):as(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new xa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Go(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Us=Tc;const pl=["Unknown","Point","LineString","Polygon"];var mf=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?pl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(n*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=$r.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class $o{constructor(e,i,n,a,l){this.name=e,this.type=i,this._evaluate=n,this.args=a,this._overloadIndex=l}evaluate(e){if(!this._evaluate){const i=$o.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const n=e[0],a=$o.definitions[n];if(!a)return i.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(a)?a[0]:a.type,h=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,p=[];let _=null,y=-1;for(const[v,T]of h){if(Array.isArray(v)&&v.length!==e.length-1)continue;p.push(v),y++,_=new wf(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const A=[];let C=!1;for(let R=1;R<e.length;R++){const D=e[R],B=Array.isArray(v)?v[R-1]:v.type,N=_.parse(D,1+A.length,B);if(!N){C=!0;break}A.push(N)}if(!C)if(Array.isArray(v)&&v.length!==A.length)_.error(`Expected ${v.length} arguments, but found ${A.length} instead.`);else{for(let R=0;R<A.length;R++){const D=Array.isArray(v)?v[R]:v.type,B=A[R];_.concat(R+1).checkSubtype(D,B.type)}if(_.errors.length===0)return new $o(n,l,T,A,y)}}if(p.length===1)i.errors.push(..._.errors);else{const v=(p.length?p:h.map(([A])=>A)).map(_f).join(" | "),T=[];for(let A=1;A<e.length;A++){const C=i.parse(e[A],1+T.length);if(!C)return null;T.push(Vr(C.type))}i.error(`Expected arguments of type ${v}, but found (${T.join(", ")}) instead.`)}return null}static register(e,i){$o.definitions=i;for(const n in i)e[n]=$o}}function _f(t){return Array.isArray(t)?`(${t.map(Vr).join(", ")})`:`(${Vr(t.type)}...)`}var Mi=$o;class ml{constructor(e,i,n){this.type=wc,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return i.error("Collator options argument must be an object.");const a=i.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,Zi);if(!a)return null;const l=i.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,Zi);if(!l)return null;let h=null;return n.locale&&(h=i.parse(n.locale,1,qi),!h)?null:new ml(a,l,h)}evaluate(e){return new gi(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Hu={exports:{}};Hu.exports=function(){function t(n,a,l,h,p){for(;h>l;){if(h-l>600){var _=h-l+1,y=a-l+1,v=Math.log(_),T=.5*Math.exp(2*v/3),A=.5*Math.sqrt(v*T*(_-T)/_)*(y-_/2<0?-1:1);t(n,a,Math.max(l,Math.floor(a-y*T/_+A)),Math.min(h,Math.floor(a+(_-y)*T/_+A)),p)}var C=n[a],R=l,D=h;for(e(n,l,a),p(n[h],C)>0&&e(n,l,h);R<D;){for(e(n,R,D),R++,D--;p(n[R],C)<0;)R++;for(;p(n[D],C)>0;)D--}p(n[l],C)===0?e(n,l,D):e(n,++D,h),D<=a&&(l=D+1),a<=D&&(h=D-1)}}function e(n,a,l){var h=n[a];n[a]=n[l],n[l]=h}function i(n,a){return n<a?-1:n>a?1:0}return function(n,a,l,h,p){t(n,a,l||0,h||n.length-1,p||i)}}();var s_=Jt(Hu.exports);function o_(t){let e=0;for(let i,n,a=0,l=t.length,h=l-1;a<l;h=a++)i=t[a],n=t[h],e+=(n.x-i.x)*(i.y+n.y);return e}function ho(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function fo(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Ec(t,e,i){const n=t[0]-e[0],a=t[1]-e[1],l=t[0]-i[0],h=t[1]-i[1];return n*h-l*a==0&&n*l<=0&&a*h<=0}function ba(t,e,i=!1){let n=!1;for(let p=0,_=e.length;p<_;p++){const y=e[p];for(let v=0,T=y.length,A=T-1;v<T;A=v++){const C=y[A],R=y[v];if(Ec(t,C,R))return i;(l=C)[1]>(a=t)[1]!=(h=R)[1]>a[1]&&a[0]<(h[0]-l[0])*(a[1]-l[1])/(h[1]-l[1])+l[0]&&(n=!n)}}var a,l,h;return n}function Wu(t,e,i,n){const a=n[0]-i[0],l=n[1]-i[1],h=(t[0]-i[0])*l-a*(t[1]-i[1]),p=(e[0]-i[0])*l-a*(e[1]-i[1]);return h>0&&p<0||h<0&&p>0}function js(t,e,i,n){return(a=[n[0]-i[0],n[1]-i[1]])[0]*(l=[e[0]-t[0],e[1]-t[1]])[1]-a[1]*l[0]!=0&&!(!Wu(t,e,i,n)||!Wu(i,n,t,e));var a,l}const po=8192;function _l(t,e){const i=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(i*a*po),Math.round(n*a*po)]}function Xu(t,e){for(let i=0;i<e.length;i++)if(ba(t,e[i]))return!0;return!1}function Yu(t,e,i){for(const n of i)for(let a=0,l=n.length,h=l-1;a<l;h=a++)if(js(t,e,n[h],n[a]))return!0;return!1}function ls(t,e){for(let i=0;i<t.length;++i)if(!ba(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Yu(t[i],t[i+1],e))return!1;return!0}function gf(t,e){for(let i=0;i<e.length;i++)if(ls(t,e[i]))return!0;return!1}function Ku(t,e,i){const n=[];for(let a=0;a<t.length;a++){const l=[];for(let h=0;h<t[a].length;h++){const p=_l(t[a][h],i);ho(e,p),l.push(p)}n.push(l)}return n}function Ju(t,e,i){const n=[];for(let a=0;a<t.length;a++){const l=Ku(t[a],e,i);n.push(l)}return n}function Qu(t,e,i,n){if(t[0]<i[0]||t[0]>i[2]){const a=.5*n;let l=t[0]-i[0]>a?-n:i[0]-t[0]>a?n:0;l===0&&(l=t[0]-i[2]>a?-n:i[2]-t[0]>a?n:0),t[0]+=l}ho(e,t)}function eh(t,e,i,n){const a=Math.pow(2,n.z)*po,l=[n.x*po,n.y*po],h=[];if(!t)return h;for(const p of t)for(const _ of p){const y=[_.x+l[0],_.y+l[1]];Qu(y,e,i,a),h.push(y)}return h}function th(t,e,i,n){const a=Math.pow(2,n.z)*po,l=[n.x*po,n.y*po],h=[];if(!t)return h;for(const _ of t){const y=[];for(const v of _){const T=[v.x+l[0],v.y+l[1]];ho(e,T),y.push(T)}h.push(y)}if(e[2]-e[0]<=a/2){(p=e)[0]=p[1]=1/0,p[2]=p[3]=-1/0;for(const _ of h)for(const y of _)Qu(y,e,i,a)}var p;return h}class wa{constructor(e,i){this.type=Zi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(jo(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let a=0;a<n.features.length;++a){const l=n.features[a].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new wa(n,n.features[a].geometry)}else if(n.type==="Feature"){const a=n.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new wa(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new wa(n,n)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,n){const a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(n.type==="Polygon"){const p=Ku(n.coordinates,l,h),_=eh(i.geometry(),a,l,h);if(!fo(a,l))return!1;for(const y of _)if(!ba(y,p))return!1}if(n.type==="MultiPolygon"){const p=Ju(n.coordinates,l,h),_=eh(i.geometry(),a,l,h);if(!fo(a,l))return!1;for(const y of _)if(!Xu(y,p))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,n){const a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(n.type==="Polygon"){const p=Ku(n.coordinates,l,h),_=th(i.geometry(),a,l,h);if(!fo(a,l))return!1;for(const y of _)if(!ls(y,p))return!1}if(n.type==="MultiPolygon"){const p=Ju(n.coordinates,l,h),_=th(i.geometry(),a,l,h);if(!fo(a,l))return!1;for(const y of _)if(!gf(y,p))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Sc=wa,gl={exports:{}};gl.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,i=e*(2-e),n=Math.PI/180,a=function(y,v){if(y===void 0)throw new Error("No latitude given.");if(v&&!t[v])throw new Error("Unknown unit "+v+". Use one of: "+Object.keys(t).join(", "));var T=6378.137*n*(v?t[v]:1),A=Math.cos(y*n),C=1/(1-i*(1-A*A)),R=Math.sqrt(C);this.kx=T*R*A,this.ky=T*R*C*(1-i)},l={units:{configurable:!0}};function h(y,v){return y[0]===v[0]&&y[1]===v[1]}function p(y,v,T){var A=_(v[0]-y[0]);return[y[0]+A*T,y[1]+(v[1]-y[1])*T]}function _(y){for(;y<-180;)y+=360;for(;y>180;)y-=360;return y}return a.fromTile=function(y,v,T){var A=Math.PI*(1-2*(y+.5)/Math.pow(2,v)),C=Math.atan(.5*(Math.exp(A)-Math.exp(-A)))/n;return new a(C,T)},l.units.get=function(){return t},a.prototype.distance=function(y,v){var T=_(y[0]-v[0])*this.kx,A=(y[1]-v[1])*this.ky;return Math.sqrt(T*T+A*A)},a.prototype.bearing=function(y,v){var T=_(v[0]-y[0])*this.kx;return Math.atan2(T,(v[1]-y[1])*this.ky)/n},a.prototype.destination=function(y,v,T){var A=T*n;return this.offset(y,Math.sin(A)*v,Math.cos(A)*v)},a.prototype.offset=function(y,v,T){return[y[0]+v/this.kx,y[1]+T/this.ky]},a.prototype.lineDistance=function(y){for(var v=0,T=0;T<y.length-1;T++)v+=this.distance(y[T],y[T+1]);return v},a.prototype.area=function(y){for(var v=0,T=0;T<y.length;T++)for(var A=y[T],C=0,R=A.length,D=R-1;C<R;D=C++)v+=_(A[C][0]-A[D][0])*(A[C][1]+A[D][1])*(T?-1:1);return Math.abs(v)/2*this.kx*this.ky},a.prototype.along=function(y,v){var T=0;if(v<=0)return y[0];for(var A=0;A<y.length-1;A++){var C=y[A],R=y[A+1],D=this.distance(C,R);if((T+=D)>v)return p(C,R,(v-(T-D))/D)}return y[y.length-1]},a.prototype.pointToSegmentDistance=function(y,v,T){var A=v[0],C=v[1],R=_(T[0]-A)*this.kx,D=(T[1]-C)*this.ky,B=0;return R===0&&D===0||((B=(_(y[0]-A)*this.kx*R+(y[1]-C)*this.ky*D)/(R*R+D*D))>1?(A=T[0],C=T[1]):B>0&&(A+=R/this.kx*B,C+=D/this.ky*B)),R=_(y[0]-A)*this.kx,D=(y[1]-C)*this.ky,Math.sqrt(R*R+D*D)},a.prototype.pointOnLine=function(y,v){for(var T,A,C,R,D=1/0,B=0;B<y.length-1;B++){var N=y[B][0],H=y[B][1],K=_(y[B+1][0]-N)*this.kx,Y=(y[B+1][1]-H)*this.ky,ne=0;K===0&&Y===0||((ne=(_(v[0]-N)*this.kx*K+(v[1]-H)*this.ky*Y)/(K*K+Y*Y))>1?(N=y[B+1][0],H=y[B+1][1]):ne>0&&(N+=K/this.kx*ne,H+=Y/this.ky*ne));var ie=(K=_(v[0]-N)*this.kx)*K+(Y=(v[1]-H)*this.ky)*Y;ie<D&&(D=ie,T=N,A=H,C=B,R=ne)}return{point:[T,A],index:C,t:Math.max(0,Math.min(1,R))}},a.prototype.lineSlice=function(y,v,T){var A=this.pointOnLine(T,y),C=this.pointOnLine(T,v);if(A.index>C.index||A.index===C.index&&A.t>C.t){var R=A;A=C,C=R}var D=[A.point],B=A.index+1,N=C.index;!h(T[B],D[0])&&B<=N&&D.push(T[B]);for(var H=B+1;H<=N;H++)D.push(T[H]);return h(T[N],C.point)||D.push(C.point),D},a.prototype.lineSliceAlong=function(y,v,T){for(var A=0,C=[],R=0;R<T.length-1;R++){var D=T[R],B=T[R+1],N=this.distance(D,B);if((A+=N)>y&&C.length===0&&C.push(p(D,B,(y-(A-N))/N)),A>=v)return C.push(p(D,B,(v-(A-N))/N)),C;A>y&&C.push(B)}return C},a.prototype.bufferPoint=function(y,v){var T=v/this.ky,A=v/this.kx;return[y[0]-A,y[1]-T,y[0]+A,y[1]+T]},a.prototype.bufferBBox=function(y,v){var T=v/this.ky,A=v/this.kx;return[y[0]-A,y[1]-T,y[2]+A,y[3]+T]},a.prototype.insideBBox=function(y,v){return _(y[0]-v[0])>=0&&_(y[0]-v[2])<=0&&y[1]>=v[1]&&y[1]<=v[3]},Object.defineProperties(a,l),a}();var mo=Jt(gl.exports),ih={exports:{}};ih.exports=function(){var t=function(i,n){if(i===void 0&&(i=[]),n===void 0&&(n=e),this.data=i,this.length=this.data.length,this.compare=n,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};function e(i,n){return i<n?-1:i>n?1:0}return t.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var i=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),i}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(i){for(var n=this.data,a=this.compare,l=n[i];i>0;){var h=i-1>>1,p=n[h];if(a(l,p)>=0)break;n[i]=p,i=h}n[i]=l},t.prototype._down=function(i){for(var n=this.data,a=this.compare,l=this.length>>1,h=n[i];i<l;){var p=1+(i<<1),_=n[p],y=p+1;if(y<this.length&&a(n[y],_)<0&&(p=y,_=n[y]),a(_,h)>=0)break;n[i]=_,i=p}n[i]=h},t}();var cs=Jt(ih.exports),_t=8192;function Ac(t,e){return e.dist-t.dist}const rh=100,yl=50;function nh(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function _o(t){return t[1]-t[0]+1}function ys(t,e){const i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function sh(t,e){if(t[0]>t[1])return[null,null];const i=_o(t);if(e){if(i===2)return[t,null];const n=Math.floor(i/2);return[[t[0],t[0]+n],[t[0]+n,t[1]]]}{if(i===1)return[t,null];const n=Math.floor(i/2)-1;return[[t[0],t[0]+n],[t[0]+n+1,t[1]]]}}function qo(t,e){const i=[1/0,1/0,-1/0,-1/0];if(!ys(e,t.length))return i;for(let n=e[0];n<=e[1];++n)ho(i,t[n]);return i}function Mc(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let n=0;n<t[i].length;++n)ho(e,t[i][n]);return e}function Zo(t,e,i){if(nh(t)||nh(e))return NaN;let n=0,a=0;return t[2]<e[0]&&(n=e[0]-t[2]),t[0]>e[2]&&(n=t[0]-e[2]),t[1]>e[3]&&(a=t[1]-e[3]),t[3]<e[1]&&(a=e[1]-t[3]),i.distance([0,0],[n,a])}function oh(t){return 360*t-180}function a_(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Ta(t,e){const i=Math.pow(2,e.z),n=(t.y/_t+e.y)/i;return[oh((t.x/_t+e.x)/i),a_(n)]}function l_(t,e){const i=[];for(let n=0;n<t.length;++n)i.push(Ta(t[n],e));return i}function yf(t,e,i){const n=i.pointOnLine(e,t).point;return i.distance(t,n)}function xf(t,e,i,n,a){const l=i.slice(n[0],n[1]+1);let h=1/0;for(let p=e[0];p<=e[1];++p)if((h=Math.min(h,yf(t[p],l,a)))===0)return 0;return h}function ah(t,e,i,n,a){const l=Math.min(a.pointToSegmentDistance(t,i,n),a.pointToSegmentDistance(e,i,n)),h=Math.min(a.pointToSegmentDistance(i,t,e),a.pointToSegmentDistance(n,t,e));return Math.min(l,h)}function c_(t,e,i,n,a){if(!ys(e,t.length)||!ys(n,i.length))return NaN;let l=1/0;for(let h=e[0];h<e[1];++h)for(let p=n[0];p<n[1];++p){if(js(t[h],t[h+1],i[p],i[p+1]))return 0;l=Math.min(l,ah(t[h],t[h+1],i[p],i[p+1],a))}return l}function u_(t,e,i,n,a){if(!ys(e,t.length)||!ys(n,i.length))return NaN;let l=1/0;for(let h=e[0];h<=e[1];++h)for(let p=n[0];p<=n[1];++p)if((l=Math.min(l,a.distance(t[h],i[p])))===0)return l;return l}function h_(t,e,i){if(ba(t,e,!0))return 0;let n=1/0;for(const a of e){const l=a.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[l-1]&&(n=Math.min(n,i.pointToSegmentDistance(t,a[l-1],a[0])))===0||(n=Math.min(n,yf(t,a,i)))===0)return n}return n}function vf(t,e,i,n){if(!ys(e,t.length))return NaN;for(let l=e[0];l<=e[1];++l)if(ba(t[l],i,!0))return 0;let a=1/0;for(let l=e[0];l<e[1];++l)for(const h of i)for(let p=0,_=h.length,y=_-1;p<_;y=p++){if(js(t[l],t[l+1],h[y],h[p]))return 0;a=Math.min(a,ah(t[l],t[l+1],h[y],h[p],n))}return a}function xl(t,e){for(const i of t)for(let n=0;n<=i.length-1;++n)if(ba(i[n],e,!0))return!0;return!1}function d_(t,e,i,n=1/0){const a=Mc(t),l=Mc(e);if(n!==1/0&&Zo(a,l,i)>=n)return n;if(fo(a,l)){if(xl(t,e))return 0}else if(xl(e,t))return 0;let h=n;for(const p of t)for(let _=0,y=p.length,v=y-1;_<y;v=_++)for(const T of e)for(let A=0,C=T.length,R=C-1;A<C;R=A++){if(js(p[v],p[_],T[R],T[A]))return 0;h=Math.min(h,ah(p[v],p[_],T[R],T[A],i))}return h}function Ic(t,e,i,n,a,l,h){if(l===null||h===null)return;const p=Zo(qo(n,l),qo(a,h),i);p<e&&t.push({dist:p,range1:l,range2:h})}function lh(t,e,i,n,a=1/0){let l=Math.min(n.distance(t[0],i[0][0]),a);if(l===0)return l;const h=new cs([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Ac),p=e?yl:rh,_=Mc(i);for(;h.length;){const y=h.pop();if(y.dist>=l)continue;const v=y.range1;if(_o(v)<=p){if(!ys(v,t.length))return NaN;if(e){const T=vf(t,v,i,n);if((l=Math.min(l,T))===0)return l}else for(let T=v[0];T<=v[1];++T){const A=h_(t[T],i,n);if((l=Math.min(l,A))===0)return l}}else{const T=sh(v,e);if(T[0]!==null){const A=Zo(qo(t,T[0]),_,n);A<l&&h.push({dist:A,range1:T[0],range2:[0,0]})}if(T[1]!==null){const A=Zo(qo(t,T[1]),_,n);A<l&&h.push({dist:A,range1:T[1],range2:[0,0]})}}}return l}function bf(t,e,i,n,a,l=1/0){let h=Math.min(l,a.distance(t[0],i[0]));if(h===0)return h;const p=new cs([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],Ac),_=e?yl:rh,y=n?yl:rh;for(;p.length;){const v=p.pop();if(v.dist>=h)continue;const T=v.range1,A=v.range2;if(_o(T)<=_&&_o(A)<=y){if(!ys(T,t.length)||!ys(A,i.length))return NaN;if(e&&n?h=Math.min(h,c_(t,T,i,A,a)):e||n?e&&!n?h=Math.min(h,xf(i,A,t,T,a)):!e&&n&&(h=Math.min(h,xf(t,T,i,A,a))):h=Math.min(h,u_(t,T,i,A,a)),h===0)return h}else{const C=sh(T,e),R=sh(A,n);Ic(p,h,a,t,i,C[0],R[0]),Ic(p,h,a,t,i,C[0],R[1]),Ic(p,h,a,t,i,C[1],R[0]),Ic(p,h,a,t,i,C[1],R[1])}}return h}function ch(t,e,i,n,a=1/0){let l=a;const h=qo(t,[0,t.length-1]);for(const p of i)if(!(l!==1/0&&Zo(h,qo(p,[0,p.length-1]),n)>=l)&&(l=Math.min(l,bf(t,e,p,!0,n,l)),l===0))return l;return l}function Cc(t,e,i,n,a=1/0){let l=a;const h=qo(t,[0,t.length-1]);for(const p of i){if(l!==1/0&&Zo(h,Mc(p),n)>=l)continue;const _=lh(t,e,p,n,l);if(isNaN(_))return _;if((l=Math.min(l,_))===0)return l}return l}function uh(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Ho{constructor(e,i){this.type=vt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(jo(e[1])){const n=e[1];if(n.type==="FeatureCollection"){for(let a=0;a<n.features.length;++a)if(uh(n.features[a].geometry.type))return new Ho(n,n.features[a].geometry)}else if(n.type==="Feature"){if(uh(n.geometry.type))return new Ho(n,n.geometry)}else if(uh(n.type))return new Ho(n,n)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),n=e.canonicalID();if(i!=null&&n!=null){if(e.geometryType()==="Point")return function(a,l,h){const p=[];for(const y of a)for(const v of y)p.push(Ta(v,l));const _=new mo(p[0][1],"meters");return h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString"?bf(p,!1,h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",_):h.type==="MultiLineString"?ch(p,!1,h.coordinates,_):h.type==="Polygon"||h.type==="MultiPolygon"?Cc(p,!1,h.type==="Polygon"?[h.coordinates]:h.coordinates,_):null}(i,n,this.geometries);if(e.geometryType()==="LineString")return function(a,l,h){const p=[];for(const y of a){const v=[];for(const T of y)v.push(Ta(T,l));p.push(v)}const _=new mo(p[0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return ch(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",p,_);if(h.type==="MultiLineString"){let y=1/0;for(let v=0;v<h.coordinates.length;v++){const T=ch(h.coordinates[v],!0,p,_,y);if(isNaN(T))return T;if((y=Math.min(y,T))===0)return y}return y}if(h.type==="Polygon"||h.type==="MultiPolygon"){let y=1/0;for(let v=0;v<p.length;v++){const T=Cc(p[v],!0,h.type==="Polygon"?[h.coordinates]:h.coordinates,_,y);if(isNaN(T))return T;if((y=Math.min(y,T))===0)return y}return y}return null}(i,n,this.geometries);if(e.geometryType()==="Polygon")return function(a,l,h){const p=[];for(const y of function(v,T){const A=v.length;if(A<=1)return[v];const C=[];let R,D;for(let B=0;B<A;B++){const N=o_(v[B]);N!==0&&(v[B].area=Math.abs(N),D===void 0&&(D=N<0),D===N<0?(R&&C.push(R),R=[v[B]]):R.push(v[B]))}return R&&C.push(R),C}(a)){const v=[];for(let T=0;T<y.length;++T)v.push(l_(y[T],l));p.push(v)}const _=new mo(p[0][0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return Cc(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",p,_);if(h.type==="MultiLineString"){let y=1/0;for(let v=0;v<h.coordinates.length;v++){const T=Cc(h.coordinates[v],!0,p,_,y);if(isNaN(T))return T;if((y=Math.min(y,T))===0)return y}return y}return h.type==="Polygon"||h.type==="MultiPolygon"?function(y,v,T){let A=1/0;for(const C of y)for(const R of v){const D=d_(C,R,T,A);if(isNaN(D))return D;if((A=Math.min(A,D))===0)return A}return A}(h.type==="Polygon"?[h.coordinates]:h.coordinates,p,_):null}(i,n,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Pc=Ho;function vl(t,e){switch(t){case"string":return as(e);case"number":return+e;case"boolean":return!!e;case"color":return $r.parse(e);case"formatted":return gn.fromString(as(e));case"resolvedImage":return Ht.fromString(as(e))}return e}function hh(t,e,i,n){return n!==void 0&&(t=n*Math.round(t/n)),e!==void 0&&t<e&&(t=e),i!==void 0&&t>i&&(t=i),t}class bl{constructor(e,i,n){this.type=e,this.key=i,this.scope=n}static parse(e,i){let n=i.expectedType;if(n==null&&(n=Ri),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const a=i.parse(e[1],1);if(!(a instanceof Ns))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const l=i.parse(e[2],2);return l instanceof Ns?new bl(n,as(a.value),as(l.value)):i.error("Scope of 'config' expression must be a string literal.")}return new bl(n,as(a.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),n=e.getConfig(i);if(!n)return null;const{type:a,value:l,values:h,minValue:p,maxValue:_,stepValue:y}=n,v=n.default.evaluate(e);let T=v;if(l){const A=e.scope;e.scope=(A||"").split("").slice(1).join(""),T=l.evaluate(e),e.scope=A}return a&&(T=vl(a,T)),T===void 0||p===void 0&&_===void 0&&y===void 0||(typeof T=="number"?T=hh(T,p,_,y):Array.isArray(T)&&(T=T.map(A=>typeof A=="number"?hh(A,p,_,y):A))),l!==void 0&&T!==void 0&&h&&!h.includes(T)&&(T=v,a&&(T=vl(a,T))),(a&&a!==this.type||T!==void 0&&Jr(T)!==this.type)&&(T=vl(this.type.kind,T)),T}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}var Ea=bl;function Sa(t){if(t instanceof Mi&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Sc||t instanceof Pc)return!1;let e=!0;return t.eachChild(i=>{e&&!Sa(i)&&(e=!1)}),e}function wl(t){if(t instanceof Mi&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!wl(i)&&(e=!1)}),e}function Tl(t){if(t instanceof Ea)return!1;let e=!0;return t.eachChild(i=>{e&&!Tl(i)&&(e=!1)}),e}function yn(t,e){if(t instanceof Mi&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(n=>{i&&!yn(n,e)&&(i=!1)}),i}class go{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const n=e[1];return i.scope.has(n)?new go(n,i.scope.get(n)):i.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Dn=go;class dh{constructor(e,i=[],n,a=new n_,l=[],h,p){this.registry=e,this.path=i,this.key=i.map(_=>`[${_}]`).join(""),this.scope=a,this.errors=l,this.expectedType=n,this._scope=h,this.options=p}parse(e,i,n,a,l={}){return i||n?this.concat(i,n,a)._parse(e,l):this._parse(e,l)}_parse(e,i){function n(a,l,h){return h==="assert"?new Vs(l,[a]):h==="coerce"?new Us(l,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(a){let l=a.parse(e,this);if(!l)return null;if(this.expectedType){const h=this.expectedType,p=l.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||p.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||p.kind!=="value"&&p.kind!=="string"){if(this.checkSubtype(h,p))return null}else l=n(l,h,i.typeAnnotation||"coerce");else l=n(l,h,i.typeAnnotation||"assert")}if(!(l instanceof Ns)&&l.type.kind!=="resolvedImage"&&fh(l)){const h=new mf(this._scope,this.options);try{l=new Ns(l.type,l.evaluate(h))}catch(p){return this.error(p.message),null}}return l}return Us.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,n){const a=typeof e=="number"?this.path.concat(e):this.path,l=n?this.scope.concat(n):this.scope;return new dh(this.registry,a,i||null,l,this.errors,this._scope,this.options)}error(e,...i){const n=`${this.key}${i.map(a=>`[${a}]`).join("")}`;this.errors.push(new Rs(n,e))}checkSubtype(e,i){const n=Uo(e,i);return n&&this.error(n),n}}var wf=dh;function fh(t){if(t instanceof Dn)return fh(t.boundExpression);if(t instanceof Mi&&t.name==="error"||t instanceof ml||t instanceof Sc||t instanceof Pc||t instanceof Ea)return!1;const e=t instanceof Us||t instanceof Vs;let i=!0;return t.eachChild(n=>{i=e?i&&fh(n):i&&n instanceof Ns}),!!i&&Sa(t)&&yn(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Wo(t,e){const i=t.length-1;let n,a,l=0,h=i,p=0;for(;l<=h;)if(p=Math.floor((l+h)/2),n=t[p],a=t[p+1],n<=e){if(p===i||e<a)return p;l=p+1}else{if(!(n>e))throw new Qr("Input is not a number.");h=p-1}return 0}class Rc{constructor(e,i,n){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[a,l]of n)this.labels.push(a),this.outputs.push(l)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const n=i.parse(e[1],1,vt);if(!n)return null;const a=[];let l=null;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);for(let h=1;h<e.length;h+=2){const p=h===1?-1/0:e[h],_=e[h+1],y=h,v=h+1;if(typeof p!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',y);if(a.length&&a[a.length-1][0]>=p)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',y);const T=i.parse(_,v,l);if(!T)return null;l=l||T.type,a.push([p,T])}return new Rc(l,n,a)}evaluate(e){const i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return n[0].evaluate(e);const l=i.length;return a>=i[l-1]?n[l-1].evaluate(e):n[Wo(i,a)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var El=Rc;const Tf=.95047,yo=1.08883,Ef=4/29,Aa=6/29,ph=3*Aa*Aa,Sf=Aa*Aa*Aa,f_=Math.PI/180,xs=180/Math.PI;function Lc(t){return t>Sf?Math.pow(t,1/3):t/ph+Ef}function Dc(t){return t>Aa?t*t*t:ph*(t-Ef)}function zc(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function kc(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function mh(t){const e=kc(t.r),i=kc(t.g),n=kc(t.b),a=Lc((.4124564*e+.3575761*i+.1804375*n)/Tf),l=Lc((.2126729*e+.7151522*i+.072175*n)/1);return{l:116*l-16,a:500*(a-l),b:200*(l-Lc((.0193339*e+.119192*i+.9503041*n)/yo)),alpha:t.a}}function _h(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*Dc(e),i=Tf*Dc(i),n=yo*Dc(n),new $r(zc(3.2404542*i-1.5371385*e-.4985314*n),zc(-.969266*i+1.8760108*e+.041556*n),zc(.0556434*i-.2040259*e+1.0572252*n),t.alpha)}function Af(t,e,i){const n=e-t;return t+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const Ma={forward:mh,reverse:_h,interpolate:function(t,e,i){return{l:Si(t.l,e.l,i),a:Si(t.a,e.a,i),b:Si(t.b,e.b,i),alpha:Si(t.alpha,e.alpha,i)}}},Ia={forward:function(t){const{l:e,a:i,b:n}=mh(t),a=Math.atan2(n,i)*xs;return{h:a<0?a+360:a,c:Math.sqrt(i*i+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*f_,i=t.c;return _h({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Af(t.h,e.h,i),c:Si(t.c,e.c,i),l:Si(t.l,e.l,i),alpha:Si(t.alpha,e.alpha,i)}}};var gh=Object.freeze({__proto__:null,hcl:Ia,lab:Ma});class Sl{constructor(e,i,n,a,l){this.type=e,this.operator=i,this.interpolation=n,this.input=a,this.labels=[],this.outputs=[];for(const[h,p]of l)this.labels.push(h),this.outputs.push(p)}static interpolationFactor(e,i,n,a){let l=0;if(e.name==="exponential")l=Ca(i,e.base,n,a);else if(e.name==="linear")l=Ca(i,1,n,a);else if(e.name==="cubic-bezier"){const h=e.controlPoints;l=new wi(h[0],h[1],h[2],h[3]).solve(Ca(i,1,n,a))}return l}static parse(e,i){let[n,a,l,...h]=e;if(!Array.isArray(a)||a.length===0)return i.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const y=a[1];if(typeof y!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:y}}else{if(a[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const y=a.slice(1);if(y.length!==4||y.some(v=>typeof v!="number"||v<0||v>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:y}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(l=i.parse(l,2,vt),!l)return null;const p=[];let _=null;n==="interpolate-hcl"||n==="interpolate-lab"?_=os:i.expectedType&&i.expectedType.kind!=="value"&&(_=i.expectedType);for(let y=0;y<h.length;y+=2){const v=h[y],T=h[y+1],A=y+3,C=y+4;if(typeof v!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(p.length&&p[p.length-1][0]>=v)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const R=i.parse(T,C,_);if(!R)return null;_=_||R.type,p.push([v,R])}return _.kind==="number"||_.kind==="color"||_.kind==="array"&&_.itemType.kind==="number"&&typeof _.N=="number"?new Sl(_,n,a,l,p):i.error(`Type ${Vr(_)} is not interpolatable.`)}evaluate(e){const i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return n[0].evaluate(e);const l=i.length;if(a>=i[l-1])return n[l-1].evaluate(e);const h=Wo(i,a),p=Sl.interpolationFactor(this.interpolation,a,i[h],i[h+1]),_=n[h].evaluate(e),y=n[h+1].evaluate(e);return this.operator==="interpolate"?bc[this.type.kind.toLowerCase()](_,y,p):this.operator==="interpolate-hcl"?Ia.reverse(Ia.interpolate(Ia.forward(_),Ia.forward(y),p)):Ma.reverse(Ma.interpolate(Ma.forward(_),Ma.forward(y),p))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)i.push(this.labels[n],this.outputs[n].serialize());return i}}function Ca(t,e,i,n){const a=n-i,l=t-i;return a===0?0:e===1?l/a:(Math.pow(e,l)-1)/(Math.pow(e,a)-1)}var Qn=Sl;class Pa{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let n=null;const a=i.expectedType;a&&a.kind!=="value"&&(n=a);const l=[];for(const p of e.slice(1)){const _=i.parse(p,1+l.length,n,void 0,{typeAnnotation:"omit"});if(!_)return null;n=n||_.type,l.push(_)}const h=a&&l.some(p=>Uo(a,p.type));return new Pa(h?Ri:n,l)}evaluate(e){let i,n=null,a=0;for(const l of this.args){if(a++,n=l.evaluate(e),n&&n instanceof Ht&&!n.available&&(i||(i=n),n=null,a===this.args.length))return i;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var yh=Pa;class Oc{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let l=1;l<e.length-1;l+=2){const h=e[l];if(typeof h!="string")return i.error(`Expected string, but found ${typeof h} instead.`,l);if(/[^a-zA-Z0-9_]/.test(h))return i.error("Variable names must contain only alphanumeric characters or '_'.",l);const p=i.parse(e[l+1],l+1);if(!p)return null;n.push([h,p])}const a=i.parse(e[e.length-1],e.length-1,i.expectedType,n);return a?new Oc(n,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,n]of this.bindings)e.push(i,n.serialize());return e.push(this.result.serialize()),e}}var xh=Oc;class xo{constructor(e,i,n){this.type=e,this.index=i,this.input=n}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,vt),a=i.parse(e[2],2,jn(i.expectedType||Ri));return n&&a?new xo(a.type.itemType,n,a):null}evaluate(e){const i=this.index.evaluate(e),n=this.input.evaluate(e);if(i<0)throw new Qr(`Array index out of bounds: ${i} < 0.`);if(i>=n.length)throw new Qr(`Array index out of bounds: ${i} > ${n.length-1}.`);if(i!==Math.floor(i))throw new Qr(`Array index must be an integer, but found ${i} instead.`);return n[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Li=xo;class vh{constructor(e,i){this.type=Zi,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,Ri),a=i.parse(e[2],2,Ri);return n&&a?ti(n.type,[Zi,qi,vt,ma,Ri])?new vh(n,a):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(n.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(n==null)return!1;if(!co(i,["boolean","string","number","null"]))throw new Qr(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(Jr(i))} instead.`);if(!co(n,["string","array"]))throw new Qr(`Expected second argument to be of type array or string, but found ${Vr(Jr(n))} instead.`);return n.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var p_=vh;class Bc{constructor(e,i,n){this.type=vt,this.needle=e,this.haystack=i,this.fromIndex=n}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,Ri),a=i.parse(e[2],2,Ri);if(!n||!a)return null;if(!ti(n.type,[Zi,qi,vt,ma,Ri]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(n.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,vt);return l?new Bc(n,a,l):null}return new Bc(n,a)}evaluate(e){const i=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!co(i,["boolean","string","number","null"]))throw new Qr(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(Jr(i))} instead.`);if(!co(n,["string","array"]))throw new Qr(`Expected second argument to be of type array or string, but found ${Vr(Jr(n))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return n.indexOf(i,a)}return n.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Mf=Bc;class bh{constructor(e,i,n,a,l,h){this.inputType=e,this.type=i,this.input=n,this.cases=a,this.outputs=l,this.otherwise=h}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let n,a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const l={},h=[];for(let y=2;y<e.length-1;y+=2){let v=e[y];const T=e[y+1];Array.isArray(v)||(v=[v]);const A=i.concat(y);if(v.length===0)return A.error("Expected at least one branch label.");for(const R of v){if(typeof R!="number"&&typeof R!="string")return A.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return A.error("Numeric branch labels must be integer values.");if(n){if(A.checkSubtype(n,Jr(R)))return null}else n=Jr(R);if(l[String(R)]!==void 0)return A.error("Branch labels must be unique.");l[String(R)]=h.length}const C=i.parse(T,y,a);if(!C)return null;a=a||C.type,h.push(C)}const p=i.parse(e[1],1,Ri);if(!p)return null;const _=i.parse(e[e.length-1],e.length-1,a);return _?p.type.kind!=="value"&&i.concat(1).checkSubtype(n,p.type)?null:new bh(n,a,p,l,h,_):null}evaluate(e){const i=this.input.evaluate(e);return(Jr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),n=[],a={};for(const h of i){const p=a[this.cases[h]];p===void 0?(a[this.cases[h]]=n.length,n.push([this.cases[h],[h]])):n[p][1].push(h)}const l=h=>this.inputType.kind==="number"?Number(h):h;for(const[h,p]of n)e.push(p.length===1?l(p[0]):p.map(l)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}var If=bh;class Fc{constructor(e,i,n){this.type=e,this.branches=i,this.otherwise=n}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let n;i.expectedType&&i.expectedType.kind!=="value"&&(n=i.expectedType);const a=[];for(let h=1;h<e.length-1;h+=2){const p=i.parse(e[h],h,Zi);if(!p)return null;const _=i.parse(e[h+1],h+1,n);if(!_)return null;a.push([p,_]),n=n||_.type}const l=i.parse(e[e.length-1],e.length-1,n);return l?new Fc(n,a,l):null}evaluate(e){for(const[i,n]of this.branches)if(i.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,n]of this.branches)e(i),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Cf=Fc;class Al{constructor(e,i,n,a){this.type=e,this.input=i,this.beginIndex=n,this.endIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,Ri),a=i.parse(e[2],2,vt);if(!n||!a)return null;if(!ti(n.type,[jn(Ri),qi,Ri]))return i.error(`Expected first argument to be of type array or string, but found ${Vr(n.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,vt);return l?new Al(n.type,n,a,l):null}return new Al(n.type,n,a)}evaluate(e){const i=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!co(i,["string","array"]))throw new Qr(`Expected first argument to be of type array or string, but found ${Vr(Jr(i))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return i.slice(n,a)}return i.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ra=Al;function wh(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Th(t,e,i,n){return n.compare(e,i)===0}function La(t,e,i){const n=t!=="=="&&t!=="!=";return class XT{constructor(l,h,p){this.type=Zi,this.lhs=l,this.rhs=h,this.collator=p,this.hasUntypedArgument=l.type.kind==="value"||h.type.kind==="value"}static parse(l,h){if(l.length!==3&&l.length!==4)return h.error("Expected two or three arguments.");const p=l[0];let _=h.parse(l[1],1,Ri);if(!_)return null;if(!wh(p,_.type))return h.concat(1).error(`"${p}" comparisons are not supported for type '${Vr(_.type)}'.`);let y=h.parse(l[2],2,Ri);if(!y)return null;if(!wh(p,y.type))return h.concat(2).error(`"${p}" comparisons are not supported for type '${Vr(y.type)}'.`);if(_.type.kind!==y.type.kind&&_.type.kind!=="value"&&y.type.kind!=="value")return h.error(`Cannot compare types '${Vr(_.type)}' and '${Vr(y.type)}'.`);n&&(_.type.kind==="value"&&y.type.kind!=="value"?_=new Vs(y.type,[_]):_.type.kind!=="value"&&y.type.kind==="value"&&(y=new Vs(_.type,[y])));let v=null;if(l.length===4){if(_.type.kind!=="string"&&y.type.kind!=="string"&&_.type.kind!=="value"&&y.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(v=h.parse(l[3],3,wc),!v)return null}return new XT(_,y,v)}evaluate(l){const h=this.lhs.evaluate(l),p=this.rhs.evaluate(l);if(n&&this.hasUntypedArgument){const _=Jr(h),y=Jr(p);if(_.kind!==y.kind||_.kind!=="string"&&_.kind!=="number")throw new Qr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${_.kind}, ${y.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const _=Jr(h),y=Jr(p);if(_.kind!=="string"||y.kind!=="string")return e(l,h,p)}return this.collator?i(l,h,p,this.collator.evaluate(l)):e(l,h,p)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){const l=[t];return this.eachChild(h=>{l.push(h.serialize())}),l}}}const Eh=La("==",function(t,e,i){return e===i},Th),Sh=La("!=",function(t,e,i){return e!==i},function(t,e,i,n){return!Th(0,e,i,n)}),m_=La("<",function(t,e,i){return e<i},function(t,e,i,n){return n.compare(e,i)<0}),__=La(">",function(t,e,i){return e>i},function(t,e,i,n){return n.compare(e,i)>0}),Pf=La("<=",function(t,e,i){return e<=i},function(t,e,i,n){return n.compare(e,i)<=0}),g_=La(">=",function(t,e,i){return e>=i},function(t,e,i,n){return n.compare(e,i)>=0});class Ah{constructor(e,i,n,a,l,h){this.type=qi,this.number=e,this.locale=i,this.currency=n,this.unit=a,this.minFractionDigits=l,this.maxFractionDigits=h}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const n=i.parse(e[1],1,vt);if(!n)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return i.error("NumberFormat options argument must be an object.");let l=null;if(a.locale&&(l=i.parse(a.locale,1,qi),!l))return null;let h=null;if(a.currency&&(h=i.parse(a.currency,1,qi),!h))return null;let p=null;if(a.unit&&(p=i.parse(a.unit,1,qi),!p))return null;let _=null;if(a["min-fraction-digits"]&&(_=i.parse(a["min-fraction-digits"],1,vt),!_))return null;let y=null;return a["max-fraction-digits"]&&(y=i.parse(a["max-fraction-digits"],1,vt),!y)?null:new Ah(n,l,h,p,_,y)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Mh{constructor(e){this.type=vt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=i.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Vr(n.type)} instead.`):new Mh(n):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Qr(`Expected value to be of type string or array, but found ${Vr(Jr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function Rf(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Ih={"==":Eh,"!=":Sh,">":__,"<":m_,">=":g_,"<=":Pf,array:Vs,at:Li,boolean:Vs,case:Cf,coalesce:yh,collator:ml,format:xa,image:Go,in:p_,"index-of":Mf,interpolate:Qn,"interpolate-hcl":Qn,"interpolate-lab":Qn,length:Mh,let:xh,literal:Ns,match:If,number:Vs,"number-format":Ah,object:Vs,slice:Ra,step:El,string:Vs,"to-boolean":Us,"to-color":Us,"to-number":Us,"to-string":Us,var:Dn,within:Sc,distance:Pc,config:Ea};function Ch(t,[e,i,n,a]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const l=a?a.evaluate(t):1,h=pf(e,i,n,l);if(h)throw new Qr(h);return new $r(e/255*l,i/255*l,n/255*l,l)}function Lf(t,[e,i,n,a]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const l=a?a.evaluate(t):1,h=function(y,v,T,A){return typeof y=="number"&&y>=0&&y<=360?typeof v=="number"&&v>=0&&v<=100&&typeof T=="number"&&T>=0&&T<=100?A===void 0||typeof A=="number"&&A>=0&&A<=1?null:`Invalid hsla value [${[y,v,T,A].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof A=="number"?[y,v,T,A]:[y,v,T]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof A=="number"?[y,v,T,A]:[y,v,T]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,n,l);if(h)throw new Qr(h);const p=`hsla(${e}, ${i}%, ${n}%, ${l})`,_=$r.parse(p);if(!_)throw new Qr(`Failed to parse HSLA color: ${p}`);return _}function Ph(t,e){return t in e}function Rh(t,e){const i=e[t];return i===void 0?null:i}function Xo(t){return{type:t}}Mi.register(Ih,{error:[{kind:"error"},[qi],(t,[e])=>{throw new Qr(e.evaluate(t))}],typeof:[qi,[Ri],(t,[e])=>Vr(Jr(e.evaluate(t)))],"to-rgba":[jn(vt,4),[os],(t,[e])=>e.evaluate(t).toArray()],rgb:[os,[vt,vt,vt],Ch],rgba:[os,[vt,vt,vt,vt],Ch],hsl:[os,[vt,vt,vt],Lf],hsla:[os,[vt,vt,vt,vt],Lf],has:{type:Zi,overloads:[[[qi],(t,[e])=>Ph(e.evaluate(t),t.properties())],[[qi,_a],(t,[e,i])=>Ph(e.evaluate(t),i.evaluate(t))]]},get:{type:Ri,overloads:[[[qi],(t,[e])=>Rh(e.evaluate(t),t.properties())],[[qi,_a],(t,[e,i])=>Rh(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Ri,[qi],(t,[e])=>Rh(e.evaluate(t),t.featureState||{})],properties:[_a,[],t=>t.properties()],"geometry-type":[qi,[],t=>t.geometryType()],id:[Ri,[],t=>t.id()],zoom:[vt,[],t=>t.globals.zoom],pitch:[vt,[],t=>t.globals.pitch||0],"distance-from-center":[vt,[],t=>t.distanceFromCenter()],"measure-light":[vt,[qi],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[vt,[],t=>t.globals.heatmapDensity||0],"line-progress":[vt,[],t=>t.globals.lineProgress||0],"raster-value":[vt,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[vt,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[vt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Ri,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[vt,Xo(vt),(t,e)=>{let i=0;for(const n of e)i+=n.evaluate(t);return i}],"*":[vt,Xo(vt),(t,e)=>{let i=1;for(const n of e)i*=n.evaluate(t);return i}],"-":{type:vt,overloads:[[[vt,vt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[vt],(t,[e])=>-e.evaluate(t)]]},"/":[vt,[vt,vt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[vt,[vt,vt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[vt,[],()=>Math.LN2],pi:[vt,[],()=>Math.PI],e:[vt,[],()=>Math.E],"^":[vt,[vt,vt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[vt,[vt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[vt,[vt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[vt,[vt],(t,[e])=>Math.log(e.evaluate(t))],log2:[vt,[vt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[vt,[vt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[vt,[vt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[vt,[vt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[vt,[vt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[vt,[vt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[vt,[vt],(t,[e])=>Math.atan(e.evaluate(t))],min:[vt,Xo(vt),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[vt,Xo(vt),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[vt,[vt],(t,[e])=>Math.abs(e.evaluate(t))],round:[vt,[vt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[vt,[vt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[vt,[vt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Zi,[qi,Ri],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Zi,[Ri],(t,[e])=>t.id()===e.value],"filter-type-==":[Zi,[qi],(t,[e])=>t.geometryType()===e.value],"filter-<":[Zi,[qi,Ri],(t,[e,i])=>{const n=t.properties()[e.value],a=i.value;return typeof n==typeof a&&n<a}],"filter-id-<":[Zi,[Ri],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<n}],"filter->":[Zi,[qi,Ri],(t,[e,i])=>{const n=t.properties()[e.value],a=i.value;return typeof n==typeof a&&n>a}],"filter-id->":[Zi,[Ri],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>n}],"filter-<=":[Zi,[qi,Ri],(t,[e,i])=>{const n=t.properties()[e.value],a=i.value;return typeof n==typeof a&&n<=a}],"filter-id-<=":[Zi,[Ri],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<=n}],"filter->=":[Zi,[qi,Ri],(t,[e,i])=>{const n=t.properties()[e.value],a=i.value;return typeof n==typeof a&&n>=a}],"filter-id->=":[Zi,[Ri],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>=n}],"filter-has":[Zi,[Ri],(t,[e])=>e.value in t.properties()],"filter-has-id":[Zi,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Zi,[jn(qi)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Zi,[jn(Ri)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Zi,[qi,jn(Ri)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Zi,[qi,jn(Ri)],(t,[e,i])=>function(n,a,l,h){for(;l<=h;){const p=l+h>>1;if(a[p]===n)return!0;a[p]>n?h=p-1:l=p+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Zi,overloads:[[[Zi,Zi],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Xo(Zi),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Zi,overloads:[[[Zi,Zi],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Xo(Zi),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Zi,[Zi],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Zi,[qi],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[qi,[qi],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[qi,[qi],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[qi,Xo(Ri),(t,e)=>e.map(i=>as(i.evaluate(t))).join("")],"resolved-locale":[qi,[wc],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[vt,[vt,vt,Ri],(t,e)=>{const[i,n,a]=e.map(h=>h.evaluate(t));if(i>n||i===n)return i;let l;if(typeof a=="string")l=function(h){let p=0;if(h.length===0)return p;for(let _=0;_<h.length;_++)p=(p<<5)-p+h.charCodeAt(_),p|=0;return p}(a);else{if(typeof a!="number")throw new Qr(`Invalid seed input: ${a}`);l=a}return i+Rf(l)()*(n-i)}]});var Da=Ih;function Lh(t){return{result:"success",value:t}}function Yo(t){return{result:"error",value:t}}function Df(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Nc(t){return t["property-type"]==="data-driven"}function Dh(t){return Df(t.expression,"measure-light")}function zf(t){return Df(t.expression,"zoom")}function zh(t){return!!t.expression&&t.expression.interpolated}function Vc(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function kf(t){return t}function kh(t,e){const i=e.type==="color",n=t.stops&&typeof t.stops[0][0]=="object",a=n||!(n||t.property!==void 0),l=t.type||(zh(e)?"exponential":"interval");if(i&&((t=Gu({},t)).stops&&(t.stops=t.stops.map(y=>[y[0],$r.parse(y[1])])),t.default=$r.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!gh[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let h,p,_;if(l==="exponential")h=Of;else if(l==="interval")h=x_;else if(l==="categorical"){h=y_,p=Object.create(null);for(const y of t.stops)p[y[0]]=y[1];_=typeof t.stops[0][0]}else{if(l!=="identity")throw new Error(`Unknown function type "${l}"`);h=Bf}if(n){const y={},v=[];for(let C=0;C<t.stops.length;C++){const R=t.stops[C],D=R[0].zoom;y[D]===void 0&&(y[D]={zoom:D,type:t.type,property:t.property,default:t.default,stops:[]},v.push(D)),y[D].stops.push([R[0].value,R[1]])}const T=[];for(const C of v)T.push([y[C].zoom,kh(y[C],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:Qn.interpolationFactor.bind(void 0,A),zoomStops:T.map(C=>C[0]),evaluate:({zoom:C},R)=>Of({stops:T,base:t.base},e,C).evaluate(C,R)}}if(a){const y=l==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:y,interpolationFactor:Qn.interpolationFactor.bind(void 0,y),zoomStops:t.stops.map(v=>v[0]),evaluate:({zoom:v})=>h(t,e,v,p,_)}}return{kind:"source",evaluate(y,v){const T=v&&v.properties?v.properties[t.property]:void 0;return T===void 0?Ml(t.default,e.default):h(t,e,T,p,_)}}}function Ml(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function y_(t,e,i,n,a){return Ml(typeof i===a?n[i]:void 0,t.default,e.default)}function x_(t,e,i){if(va(i)!=="number")return Ml(t.default,e.default);const n=t.stops.length;if(n===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const a=Wo(t.stops.map(l=>l[0]),i);return t.stops[a][1]}function Of(t,e,i){const n=t.base!==void 0?t.base:1;if(va(i)!=="number")return Ml(t.default,e.default);const a=t.stops.length;if(a===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[a-1][0])return t.stops[a-1][1];const l=Wo(t.stops.map(v=>v[0]),i),h=function(v,T,A,C){const R=C-A,D=v-A;return R===0?0:T===1?D/R:(Math.pow(T,D)-1)/(Math.pow(T,R)-1)}(i,n,t.stops[l][0],t.stops[l+1][0]),p=t.stops[l][1],_=t.stops[l+1][1];let y=bc[e.type]||kf;if(t.colorSpace&&t.colorSpace!=="rgb"){const v=gh[t.colorSpace];y=(T,A)=>v.reverse(v.interpolate(v.forward(T),v.forward(A),h))}return typeof p.evaluate=="function"?{evaluate(...v){const T=p.evaluate.apply(void 0,v),A=_.evaluate.apply(void 0,v);if(T!==void 0&&A!==void 0)return y(T,A,h)}}:y(p,_,h)}function Bf(t,e,i){return e.type==="color"?i=$r.parse(i):e.type==="formatted"?i=gn.fromString(i.toString()):e.type==="resolvedImage"?i=Ht.fromString(i.toString()):va(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Ml(i,t.default,e.default)}class Uc{constructor(e,i,n,a){this.expression=e,this._warningHistory={},this._evaluator=new mf(n,a),this._defaultValue=i?function(l){return l.type==="color"&&(Vc(l.default)||Array.isArray(l.default))?new $r(0,0,0,0):l.type==="color"?$r.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,n,a,l,h,p,_){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=n,this._evaluator.canonical=a||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=_||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,n,a,l,h,p,_){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=n||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=_||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Qr(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function Il(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Da}function jc(t,e,i,n){const a=new wf(Da,[],e?function(h){const p={color:os,string:qi,number:vt,enum:qi,boolean:Zi,formatted:ga,resolvedImage:fl};return h.type==="array"?jn(p[h.value]||Ri,h.length):p[h.type]}(e):void 0,void 0,void 0,i,n),l=a.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Lh(new Uc(l,e,i,n)):Yo(a.errors)}class Oh{constructor(e,i,n){this.kind=e,this._styleExpression=i,this.isLightConstant=n,this.isStateDependent=e!=="constant"&&!wl(i.expression),this.isConfigDependent=!Tl(i.expression)}evaluateWithoutErrorHandling(e,i,n,a,l,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,n,a,l,h)}evaluate(e,i,n,a,l,h){return this._styleExpression.evaluate(e,i,n,a,l,h)}}class Cl{constructor(e,i,n,a,l){this.kind=e,this.zoomStops=n,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!wl(i.expression),this.isLightConstant=l,this.isConfigDependent=!Tl(i.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,i,n,a,l,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,n,a,l,h)}evaluate(e,i,n,a,l,h){return this._styleExpression.evaluate(e,i,n,a,l,h)}interpolationFactor(e,i,n){return this.interpolationType?Qn.interpolationFactor(this.interpolationType,e,i,n):0}}function Gc(t,e,i,n){if((t=jc(t,e,i,n)).result==="error")return t;const a=t.value.expression,l=Sa(a);if(!l&&!Nc(e))return Yo([new Rs("","data expressions not supported")]);const h=yn(a,["zoom","pitch","distance-from-center"]);if(!h&&!zf(e))return Yo([new Rs("","zoom expressions not supported")]);const p=yn(a,["measure-light"]);if(!p&&!Dh(e))return Yo([new Rs("","measure-light expression not supported")]);const _=e.expression&&e.expression.relaxZoomRestriction,y=Rl(a);return y||h||_?y instanceof Rs?Yo([y]):y instanceof Qn&&!zh(e)?Yo([new Rs("",'"interpolate" expressions cannot be used with this property')]):Lh(y?new Cl(l?"camera":"composite",t.value,y.labels,y instanceof Qn?y.interpolation:void 0,p):new Oh(l?"constant":"source",t.value,p)):Yo([new Rs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Pl{constructor(e,i){this._parameters=e,this._specification=i,Gu(this,kh(this._parameters,this._specification))}static deserialize(e){return new Pl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Rl(t){let e=null;if(t instanceof xh)e=Rl(t.result);else if(t instanceof yh){for(const i of t.args)if(e=Rl(i),e)break}else(t instanceof El||t instanceof Qn)&&t.input instanceof Mi&&t.input.name==="zoom"&&(e=t);return e instanceof Rs||t.eachChild(i=>{const n=Rl(i);n instanceof Rs?e=n:e&&n&&e!==n&&(e=new Rs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var v_=bs,vs=3;function bs(t,e,i){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],this.d=(e=a[1])+2*(i=a[2]);for(var l=0;l<this.d*this.d;l++){var h=a[vs+l],p=a[vs+l+1];n.push(h===p?null:a.subarray(h,p))}var _=a[vs+n.length+1];this.keys=a.subarray(a[vs+n.length],_),this.bboxes=a.subarray(_),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var y=0;y<this.d*this.d;y++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var v=i/e*t;this.min=-v,this.max=t+v}bs.prototype.insert=function(t,e,i,n,a){this._forEachCell(e,i,n,a,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(a)},bs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},bs.prototype._insertCell=function(t,e,i,n,a,l){this.cells[a].push(l)},bs.prototype.query=function(t,e,i,n,a){var l=this.min,h=this.max;if(t<=l&&e<=l&&h<=i&&h<=n&&!a)return Array.prototype.slice.call(this.keys);var p=[];return this._forEachCell(t,e,i,n,this._queryCell,p,{},a),p},bs.prototype._queryCell=function(t,e,i,n,a,l,h,p){var _=this.cells[a];if(_!==null)for(var y=this.keys,v=this.bboxes,T=0;T<_.length;T++){var A=_[T];if(h[A]===void 0){var C=4*A;(p?p(v[C+0],v[C+1],v[C+2],v[C+3]):t<=v[C+2]&&e<=v[C+3]&&i>=v[C+0]&&n>=v[C+1])?(h[A]=!0,l.push(y[A])):h[A]=!1}}},bs.prototype._forEachCell=function(t,e,i,n,a,l,h,p){for(var _=this._convertToCellCoord(t),y=this._convertToCellCoord(e),v=this._convertToCellCoord(i),T=this._convertToCellCoord(n),A=_;A<=v;A++)for(var C=y;C<=T;C++){var R=this.d*C+A;if((!p||p(this._convertFromCellCoord(A),this._convertFromCellCoord(C),this._convertFromCellCoord(A+1),this._convertFromCellCoord(C+1)))&&a.call(this,t,e,i,n,R,l,h,p))return}},bs.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},bs.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},bs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=vs+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var a=new Int32Array(e+i+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var l=e,h=0;h<t.length;h++){var p=t[h];a[vs+h]=l,a.set(p,l),l+=p.length}return a[vs+t.length]=l,a.set(this.keys,l),a[vs+t.length+1]=l+=this.keys.length,a.set(this.bboxes,l),l+=this.bboxes.length,a.buffer};var Gs=Jt(v_);const Ll={};function wt(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Ll[e]={klass:t,omit:i.omit||[]}}wt(Object,"Object"),Gs.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},Gs.deserialize=function(t){return new Gs(t.buffer)},Object.defineProperty(Gs,"name",{value:"Grid"}),wt(Gs,"Grid"),wt($r,"Color"),wt(Error,"Error"),wt(gn,"Formatted"),wt(ya,"FormattedSection"),wt(Yr,"AJAXError"),wt(Ht,"ResolvedImage"),wt(Pl,"StylePropertyFunction"),wt(Uc,"StyleExpression",{omit:["_evaluator"]}),wt(Cl,"ZoomDependentExpression"),wt(Oh,"ZoomConstantExpression"),wt(Mi,"CompoundExpression",{omit:["_evaluate"]});for(const t in Da)Ll[Da[t]._classRegistryKey]||wt(Da[t],`Expression${t}`);function Ff(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function $c(t){return self.ImageBitmap&&t instanceof ImageBitmap}function vo(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Ff(t)||$c(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.add(i.buffer),i}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const n of t)i.push(vo(n,e));return i}if(t instanceof Map){const i={$name:"Map"};for(const[n,a]of t.entries())i[n]=vo(a);return i}if(typeof t=="object"){const i=t.constructor,n=i._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const a=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const l in t)t.hasOwnProperty(l)&&(Ll[n].omit.indexOf(l)>=0||(a[l]=vo(t[l],e)));t instanceof Error&&(a.message=t.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(a.$name=n),a}throw new Error("can't serialize object of type "+typeof t)}function Ko(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Ff(t)||$c(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Ko);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const a=new Map;for(const l of Object.keys(t))l!=="$name"&&a.set(l,Ko(t[l]));return a}const{klass:i}=Ll[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const n=Object.create(i.prototype);for(const a of Object.keys(t))a!=="$name"&&(n[a]=Ko(t[a]));return n}throw new Error("can't deserialize object of type "+typeof t)}const Pt={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function bo(t){for(const e of t)if(Bh(e.charCodeAt(0)))return!0;return!1}function b_(t){for(const e of t)if(!w_(e.charCodeAt(0)))return!1;return!0}function w_(t){return!(Pt.Arabic(t)||Pt["Arabic Supplement"](t)||Pt["Arabic Extended-A"](t)||Pt["Arabic Presentation Forms-A"](t)||Pt["Arabic Presentation Forms-B"](t))}function Bh(t){return!(t!==746&&t!==747&&(t<4352||!(Pt["Bopomofo Extended"](t)||Pt.Bopomofo(t)||Pt["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Pt["CJK Compatibility Ideographs"](t)||Pt["CJK Compatibility"](t)||Pt["CJK Radicals Supplement"](t)||Pt["CJK Strokes"](t)||!(!Pt["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Pt["CJK Unified Ideographs Extension A"](t)||Pt["CJK Unified Ideographs"](t)||Pt["Enclosed CJK Letters and Months"](t)||Pt["Hangul Compatibility Jamo"](t)||Pt["Hangul Jamo Extended-A"](t)||Pt["Hangul Jamo Extended-B"](t)||Pt["Hangul Jamo"](t)||Pt["Hangul Syllables"](t)||Pt.Hiragana(t)||Pt["Ideographic Description Characters"](t)||Pt.Kanbun(t)||Pt["Kangxi Radicals"](t)||Pt["Katakana Phonetic Extensions"](t)||Pt.Katakana(t)&&t!==12540||!(!Pt["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Pt["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Pt["Unified Canadian Aboriginal Syllabics"](t)||Pt["Unified Canadian Aboriginal Syllabics Extended"](t)||Pt["Vertical Forms"](t)||Pt["Yijing Hexagram Symbols"](t)||Pt["Yi Syllables"](t)||Pt["Yi Radicals"](t))))}function Nf(t){return!(Bh(t)||function(e){return!!(Pt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Pt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Pt["Letterlike Symbols"](e)||Pt["Number Forms"](e)||Pt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Pt["Control Pictures"](e)&&e!==9251||Pt["Optical Character Recognition"](e)||Pt["Enclosed Alphanumerics"](e)||Pt["Geometric Shapes"](e)||Pt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Pt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Pt["CJK Symbols and Punctuation"](e)||Pt.Katakana(e)||Pt["Private Use Area"](e)||Pt["CJK Compatibility Forms"](e)||Pt["Small Form Variants"](e)||Pt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function Vf(t){return t>=1424&&t<=2303||Pt["Arabic Presentation Forms-A"](t)||Pt["Arabic Presentation Forms-B"](t)}function Uf(t,e){return!(!e&&Vf(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Pt.Khmer(t))}function Fh(t){for(const e of t)if(Vf(e.charCodeAt(0)))return!0;return!1}const Nh="deferred",Vh="loading",Uh="loaded";let jh=null,Gn="unavailable",wo=null;const jf=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Gn="error"),jh&&jh(t)};function Gh(){$h.fire(new Vo("pluginStateChange",{pluginStatus:Gn,pluginURL:wo}))}const $h=new pa,To=function(){return Gn},qh=function(){if(Gn!==Nh||!wo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gn=Vh,Gh(),wo&&Fe({url:wo},t=>{t?jf(t):(Gn=Uh,Gh())})},es={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Gn===Uh||es.applyArabicShaping!=null,isLoading:()=>Gn===Vh,setState(t){Gn=t.pluginStatus,wo=t.pluginURL},isParsed:()=>es.applyArabicShaping!=null&&es.processBidirectionalText!=null&&es.processStyledBidirectionalText!=null,getPluginURL:()=>wo};class Cr{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,n){for(const a of i)if(!Uf(a.charCodeAt(0),n))return!1;return!0}(e,es.isLoaded())}}class qc{constructor(e,i,n,a){this.property=e,this.value=i,this.expression=function(l,h,p,_){if(Vc(l))return new Pl(l,h);if(Il(l)||Array.isArray(l)&&l.length>0){const y=Gc(l,h,p,_);if(y.result==="error")throw new Error(y.value.map(v=>`${v.key}: ${v.message}`).join(", "));return y.value}{let y=l;return typeof l=="string"&&h.type==="color"&&(y=$r.parse(l)),{kind:"constant",isConfigDependent:!1,evaluate:()=>y}}}(i===void 0?e.specification.default:i,e.specification,n,a)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,n){return this.property.possiblyEvaluate(this,e,i,n)}}class Zh{constructor(e,i,n){this.property=e,this.value=new qc(e,void 0,i,n)}transitioned(e,i){return new Hh(this.property,this.value,i,dr({},e.transition,this.transition),e.now)}untransitioned(){return new Hh(this.property,this.value,null,{},0)}}class $s{constructor(e,i,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=n,this.isConfigDependent=!1}getValue(e){return tr(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Zh(this._values[e].property,this._scope,this._options)),this._values[e].value=new qc(this._values[e].property,i===null?void 0:tr(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,i){i&&(this._options=i);const n=this._properties.properties;if(e)for(const a in e){const l=e[a];if(Bt(a,"-transition")){const h=a.slice(0,-11);n[h]&&this.setTransition(h,l)}else n[a]&&this.setValue(a,l)}}getTransition(e){return tr(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Zh(this._values[e].property)),this._values[e].transition=tr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const n=this.getValue(i);n!==void 0&&(e[i]=n);const a=this.getTransition(i);a!==void 0&&(e[`${i}-transition`]=a)}return e}transitioned(e,i){const n=new Jo(this._properties);for(const a of Object.keys(this._values))n._values[a]=this._values[a].transitioned(e,i._values[a]);return n}untransitioned(){const e=new Jo(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Hh{constructor(e,i,n,a,l){const h=a.delay||0,p=a.duration||0;l=l||0,this.property=e,this.value=i,this.begin=l+h,this.end=this.begin+p,e.specification.transition&&(a.delay||a.duration)&&(this.prior=n)}possiblyEvaluate(e,i,n){const a=e.now||0,l=this.value.possiblyEvaluate(e,i,n),h=this.prior;if(h){if(a>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(a<this.begin)return h.possiblyEvaluate(e,i,n);{const p=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,i,n),l,lt(p))}}return l}}class Jo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,n){const a=new Dl(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(e,i,n);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class T_{constructor(e,i,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=n,this.isConfigDependent=!1}getValue(e){return tr(this._values[e].value)}setValue(e,i){this._values[e]=new qc(this._values[e].property,i===null?void 0:tr(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const i of Object.keys(this._values)){const n=this.getValue(i);n!==void 0&&(e[i]=n)}return e}possiblyEvaluate(e,i,n){const a=new Dl(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(e,i,n);return a}}class za{constructor(e,i,n){this.property=e,this.value=i,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,n,a){return this.property.evaluate(this.value,this.parameters,e,i,n,a)}}class Dl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class tt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,n){const a=bc[this.specification.type];return a?a(e,i,n):e}}class Gt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,n,a){return new za(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},n,a)}:e.expression,i)}interpolate(e,i,n){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new za(this,{kind:"constant",value:void 0},e.parameters);const a=bc[this.specification.type];return a?new za(this,{kind:"constant",value:a(e.value.value,i.value.value,n)},e.parameters):e}evaluate(e,i,n,a,l,h){return e.kind==="constant"?e.value:e.evaluate(i,n,a,l,h)}}class Qo{constructor(e){this.specification=e}possiblyEvaluate(e,i,n,a){return!!e.expression.evaluate(i,null,{},n,a)}interpolate(){return!1}}class Pr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Cr(0,{});for(const n in e){const a=e[n];a.specification.overridable&&this.overridableProperties.push(n);const l=this.defaultPropertyValues[n]=new qc(a,void 0),h=this.defaultTransitionablePropertyValues[n]=new Zh(a);this.defaultTransitioningPropertyValues[n]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=l.possiblyEvaluate(i)}}}function zl(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function kl(t){if(Array.isArray(t))return t.map(kl);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=kl(t[i]);return e}return zl(t)}wt(Gt,"DataDrivenProperty"),wt(tt,"DataConstantProperty"),wt(Qo,"ColorRampProperty");var be=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Wh(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Wh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function ts(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Wh(t)||(t=Ol(t));const i=t;let n=!0;try{n=function(y){if(!ka(y))return y;let v=kl(y);return Xh(v),v=Gf(v),v}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const a=be[`filter_${e}`],l=jc(n,a);let h=null;if(l.result==="error")throw new Error(l.value.map(y=>`${y.key}: ${y.message}`).join(", "));h=(y,v,T)=>l.value.evaluate(y,v,{},T);let p=null,_=null;if(n!==i){const y=jc(i,a);if(y.result==="error")throw new Error(y.value.map(v=>`${v.key}: ${v.message}`).join(", "));p=(v,T,A,C,R)=>y.value.evaluate(v,T,{},A,void 0,void 0,C,R),_=!Sa(y.value.expression)}return{filter:h,dynamicFilter:p||void 0,needGeometry:$f(n),needFeature:!!_}}function Gf(t){if(!Array.isArray(t))return t;const e=function(i){if(E_.has(i[0])){for(let n=1;n<i.length;n++)if(ka(i[n]))return!0}return i}(t);return e===!0?e:e.map(i=>Gf(i))}function Xh(t){let e=!1;const i=[];if(t[0]==="case"){for(let n=1;n<t.length-1;n+=2)e=e||ka(t[n]),i.push(t[n+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||ka(t[1]);for(let n=2;n<t.length-1;n+=2)i.push(t[n+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||ka(t[1]);for(let n=1;n<t.length-1;n+=2)i.push(t[n+1])}e&&(t.length=0,t.push("any",...i));for(let n=1;n<t.length;n++)Xh(t[n])}function ka(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(ka(t[i]))return!0;return!1}const E_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function S_(t,e){return t<e?-1:t>e?1:0}function $f(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if($f(t[e]))return!0;return!1}function Ol(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Bl(t[1],t[2],"=="):e==="!="?Fl(Bl(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Bl(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(Ol))):e==="all"?["all"].concat(t.slice(1).map(Ol)):e==="none"?["all"].concat(t.slice(1).map(Ol).map(Fl)):e==="in"?Yh(t[1],t.slice(2)):e==="!in"?Fl(Yh(t[1],t.slice(2))):e==="has"?qf(t[1]):e!=="!has"||Fl(qf(t[1]));var i}function Bl(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Yh(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(S_)]]:["filter-in-small",t,["literal",e]]}}function qf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Fl(t){return["!",t]}const Zc="";function Kh(t,e){return e?`${t}${Zc}${e}`:t}const Nl="-transition";class $n extends pa{constructor(e,i,n,a){if(super(),this.id=e.id,this.fqid=Kh(this.id,n),this.type=e.type,this.scope=n,this.options=a,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new T_(i.layout,this.scope,a),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new $s(i.paint,this.scope,a);for(const l in e.paint)this.setPaintProperty(l,e.paint[l]);for(const l in e.layout)this.setLayoutProperty(l,e.layout[l]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Dl(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const n=this._unevaluatedLayout;n._properties.properties[e]&&(n.setValue(e,i),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Bt(e,Nl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const n=this._transitionablePaint,a=n._properties.properties;if(Bt(e,Nl)){const T=e.slice(0,-11);return a[T]&&n.setTransition(T,i||void 0),!1}if(!a[e])return!1;const l=n._values[e],h=l.value.isDataDriven(),p=l.value;n.setValue(e,i),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const _=n._values[e].value,y=_.isDataDriven(),v=Bt(e,"pattern")||e==="line-dasharray";return y||h||v||this._handleOverridablePaintPropertyUpdate(e,p,_)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i){return null}_handleOverridablePaintPropertyUpdate(e,i,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Ui({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof za&&Nc(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ts(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}const A_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Hc{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Tr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ki(t,e=1){let i=0,n=0;return{members:t.map(a=>{const l=A_[a.type].BYTES_PER_ELEMENT,h=i=Vl(i,Math.max(e,l)),p=a.components||1;return n=Math.max(n,l),i+=l*p,{name:a.name,type:a.type,components:p,offset:h}}),size:Vl(i,Math.max(n,e)),alignment:e}}function Vl(t,e){return Math.ceil(t/e)*e}class ws extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,i)}emplace(e,i,n){const a=2*e;return this.int16[a+0]=i,this.int16[a+1]=n,e}}ws.prototype.bytesPerElement=4,wt(ws,"StructArrayLayout2i4");class zn extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,n)}emplace(e,i,n,a){const l=3*e;return this.int16[l+0]=i,this.int16[l+1]=n,this.int16[l+2]=a,e}}zn.prototype.bytesPerElement=6,wt(zn,"StructArrayLayout3i6");class qs extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,n,a)}emplace(e,i,n,a,l){const h=4*e;return this.int16[h+0]=i,this.int16[h+1]=n,this.int16[h+2]=a,this.int16[h+3]=l,e}}qs.prototype.bytesPerElement=8,wt(qs,"StructArrayLayout4i8");class Jh extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,n,a,l)}emplace(e,i,n,a,l,h){const p=5*e;return this.int16[p+0]=i,this.int16[p+1]=n,this.int16[p+2]=a,this.int16[p+3]=l,this.int16[p+4]=h,e}}Jh.prototype.bytesPerElement=10,wt(Jh,"StructArrayLayout5i10");class Qh extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,l,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,n,a,l,h,p)}emplace(e,i,n,a,l,h,p,_){const y=6*e,v=12*e,T=3*e;return this.int16[y+0]=i,this.int16[y+1]=n,this.uint8[v+4]=a,this.uint8[v+5]=l,this.uint8[v+6]=h,this.uint8[v+7]=p,this.float32[T+2]=_,e}}Qh.prototype.bytesPerElement=12,wt(Qh,"StructArrayLayout2i4ub1f12");class Eo extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,n,a)}emplace(e,i,n,a,l){const h=4*e;return this.float32[h+0]=i,this.float32[h+1]=n,this.float32[h+2]=a,this.float32[h+3]=l,e}}Eo.prototype.bytesPerElement=16,wt(Eo,"StructArrayLayout4f16");class So extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,n,a,l)}emplace(e,i,n,a,l,h){const p=6*e,_=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=n,this.uint16[p+2]=a,this.uint16[p+3]=l,this.float32[_+2]=h,e}}So.prototype.bytesPerElement=12,wt(So,"StructArrayLayout4ui1f12");class Oa extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,n,a)}emplace(e,i,n,a,l){const h=4*e;return this.uint16[h+0]=i,this.uint16[h+1]=n,this.uint16[h+2]=a,this.uint16[h+3]=l,e}}Oa.prototype.bytesPerElement=8,wt(Oa,"StructArrayLayout4ui8");class Wc extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,n,a,l,h)}emplace(e,i,n,a,l,h,p){const _=6*e;return this.int16[_+0]=i,this.int16[_+1]=n,this.int16[_+2]=a,this.int16[_+3]=l,this.int16[_+4]=h,this.int16[_+5]=p,e}}Wc.prototype.bytesPerElement=12,wt(Wc,"StructArrayLayout6i12");class Ul extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,l,h,p,_,y,v,T,A){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,n,a,l,h,p,_,y,v,T,A)}emplace(e,i,n,a,l,h,p,_,y,v,T,A,C){const R=12*e;return this.int16[R+0]=i,this.int16[R+1]=n,this.int16[R+2]=a,this.int16[R+3]=l,this.uint16[R+4]=h,this.uint16[R+5]=p,this.uint16[R+6]=_,this.uint16[R+7]=y,this.int16[R+8]=v,this.int16[R+9]=T,this.int16[R+10]=A,this.int16[R+11]=C,e}}Ul.prototype.bytesPerElement=24,wt(Ul,"StructArrayLayout4i4ui4i24");class ed extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,n,a,l,h)}emplace(e,i,n,a,l,h,p){const _=10*e,y=5*e;return this.int16[_+0]=i,this.int16[_+1]=n,this.int16[_+2]=a,this.float32[y+2]=l,this.float32[y+3]=h,this.float32[y+4]=p,e}}ed.prototype.bytesPerElement=20,wt(ed,"StructArrayLayout3i3f20");class td extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}td.prototype.bytesPerElement=4,wt(td,"StructArrayLayout1ul4");class Ls extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,i)}emplace(e,i,n){const a=2*e;return this.uint16[a+0]=i,this.uint16[a+1]=n,e}}Ls.prototype.bytesPerElement=4,wt(Ls,"StructArrayLayout2ui4");class id extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,l,h,p,_,y,v,T,A,C){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,n,a,l,h,p,_,y,v,T,A,C)}emplace(e,i,n,a,l,h,p,_,y,v,T,A,C,R){const D=20*e,B=10*e;return this.int16[D+0]=i,this.int16[D+1]=n,this.int16[D+2]=a,this.int16[D+3]=l,this.int16[D+4]=h,this.float32[B+3]=p,this.float32[B+4]=_,this.float32[B+5]=y,this.float32[B+6]=v,this.int16[D+14]=T,this.uint32[B+8]=A,this.uint16[D+18]=C,this.uint16[D+19]=R,e}}id.prototype.bytesPerElement=40,wt(id,"StructArrayLayout5i4f1i1ul2ui40");class jl extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,l,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,n,a,l,h,p)}emplace(e,i,n,a,l,h,p,_){const y=8*e;return this.int16[y+0]=i,this.int16[y+1]=n,this.int16[y+2]=a,this.int16[y+4]=l,this.int16[y+5]=h,this.int16[y+6]=p,this.int16[y+7]=_,e}}jl.prototype.bytesPerElement=16,wt(jl,"StructArrayLayout3i2i2i16");class Xc extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,n,a,l)}emplace(e,i,n,a,l,h){const p=4*e,_=8*e;return this.float32[p+0]=i,this.float32[p+1]=n,this.float32[p+2]=a,this.int16[_+6]=l,this.int16[_+7]=h,e}}Xc.prototype.bytesPerElement=16,wt(Xc,"StructArrayLayout2f1f2i16");class rd extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,n,a)}emplace(e,i,n,a,l){const h=12*e,p=3*e;return this.uint8[h+0]=i,this.uint8[h+1]=n,this.float32[p+1]=a,this.float32[p+2]=l,e}}rd.prototype.bytesPerElement=12,wt(rd,"StructArrayLayout2ub2f12");class sn extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,n)}emplace(e,i,n,a){const l=3*e;return this.uint16[l+0]=i,this.uint16[l+1]=n,this.uint16[l+2]=a,e}}sn.prototype.bytesPerElement=6,wt(sn,"StructArrayLayout3ui6");class Ba extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,l,h,p,_,y,v,T,A,C,R,D,B,N,H,K,Y,ne){const ie=this.length;return this.resize(ie+1),this.emplace(ie,e,i,n,a,l,h,p,_,y,v,T,A,C,R,D,B,N,H,K,Y,ne)}emplace(e,i,n,a,l,h,p,_,y,v,T,A,C,R,D,B,N,H,K,Y,ne,ie){const ce=30*e,me=15*e,ye=60*e;return this.int16[ce+0]=i,this.int16[ce+1]=n,this.int16[ce+2]=a,this.float32[me+2]=l,this.float32[me+3]=h,this.uint16[ce+8]=p,this.uint16[ce+9]=_,this.uint32[me+5]=y,this.uint32[me+6]=v,this.uint32[me+7]=T,this.uint16[ce+16]=A,this.uint16[ce+17]=C,this.uint16[ce+18]=R,this.float32[me+10]=D,this.float32[me+11]=B,this.uint8[ye+48]=N,this.uint8[ye+49]=H,this.uint8[ye+50]=K,this.uint32[me+13]=Y,this.int16[ce+28]=ne,this.uint8[ye+58]=ie,e}}Ba.prototype.bytesPerElement=60,wt(Ba,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Yc extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,l,h,p,_,y,v,T,A,C,R,D,B,N,H,K,Y,ne,ie,ce,me,ye,Ee,xe,De,je,Re,Ve,Me){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,e,i,n,a,l,h,p,_,y,v,T,A,C,R,D,B,N,H,K,Y,ne,ie,ce,me,ye,Ee,xe,De,je,Re,Ve,Me)}emplace(e,i,n,a,l,h,p,_,y,v,T,A,C,R,D,B,N,H,K,Y,ne,ie,ce,me,ye,Ee,xe,De,je,Re,Ve,Me,Ne){const nt=20*e,Ge=40*e,Mt=80*e;return this.float32[nt+0]=i,this.float32[nt+1]=n,this.int16[Ge+4]=a,this.int16[Ge+5]=l,this.int16[Ge+6]=h,this.int16[Ge+7]=p,this.int16[Ge+8]=_,this.int16[Ge+9]=y,this.int16[Ge+10]=v,this.int16[Ge+11]=T,this.int16[Ge+12]=A,this.uint16[Ge+13]=C,this.uint16[Ge+14]=R,this.uint16[Ge+15]=D,this.uint16[Ge+16]=B,this.uint16[Ge+17]=N,this.uint16[Ge+18]=H,this.uint16[Ge+19]=K,this.uint16[Ge+20]=Y,this.uint16[Ge+21]=ne,this.uint16[Ge+22]=ie,this.uint16[Ge+23]=ce,this.uint16[Ge+24]=me,this.uint16[Ge+25]=ye,this.uint16[Ge+26]=Ee,this.uint16[Ge+27]=xe,this.uint32[nt+14]=De,this.float32[nt+15]=je,this.float32[nt+16]=Re,this.float32[nt+17]=Ve,this.float32[nt+18]=Me,this.uint8[Mt+76]=Ne,e}}Yc.prototype.bytesPerElement=80,wt(Yc,"StructArrayLayout2f9i15ui1ul4f1ub80");class Gl extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Gl.prototype.bytesPerElement=4,wt(Gl,"StructArrayLayout1f4");class Ao extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,n,a,l)}emplace(e,i,n,a,l,h){const p=5*e;return this.float32[p+0]=i,this.float32[p+1]=n,this.float32[p+2]=a,this.float32[p+3]=l,this.float32[p+4]=h,e}}Ao.prototype.bytesPerElement=20,wt(Ao,"StructArrayLayout5f20");class nd extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,l,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,n,a,l,h,p)}emplace(e,i,n,a,l,h,p,_){const y=7*e;return this.float32[y+0]=i,this.float32[y+1]=n,this.float32[y+2]=a,this.float32[y+3]=l,this.float32[y+4]=h,this.float32[y+5]=p,this.float32[y+6]=_,e}}nd.prototype.bytesPerElement=28,wt(nd,"StructArrayLayout7f28");class $l extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,n,a)}emplace(e,i,n,a,l){const h=6*e;return this.uint32[3*e+0]=i,this.uint16[h+2]=n,this.uint16[h+3]=a,this.uint16[h+4]=l,e}}$l.prototype.bytesPerElement=12,wt($l,"StructArrayLayout1ul3ui12");class sd extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}sd.prototype.bytesPerElement=2,wt(sd,"StructArrayLayout1ui2");class ea extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,n)}emplace(e,i,n,a){const l=3*e;return this.float32[l+0]=i,this.float32[l+1]=n,this.float32[l+2]=a,e}}ea.prototype.bytesPerElement=12,wt(ea,"StructArrayLayout3f12");class ql extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,i)}emplace(e,i,n){const a=2*e;return this.float32[a+0]=i,this.float32[a+1]=n,e}}ql.prototype.bytesPerElement=8,wt(ql,"StructArrayLayout2f8");class od extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,l,h,p,_,y,v,T,A,C,R,D,B){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,n,a,l,h,p,_,y,v,T,A,C,R,D,B)}emplace(e,i,n,a,l,h,p,_,y,v,T,A,C,R,D,B,N){const H=16*e;return this.float32[H+0]=i,this.float32[H+1]=n,this.float32[H+2]=a,this.float32[H+3]=l,this.float32[H+4]=h,this.float32[H+5]=p,this.float32[H+6]=_,this.float32[H+7]=y,this.float32[H+8]=v,this.float32[H+9]=T,this.float32[H+10]=A,this.float32[H+11]=C,this.float32[H+12]=R,this.float32[H+13]=D,this.float32[H+14]=B,this.float32[H+15]=N,e}}od.prototype.bytesPerElement=64,wt(od,"StructArrayLayout16f64");class Zl extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,l,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,n,a,l,h,p)}emplace(e,i,n,a,l,h,p,_){const y=10*e,v=5*e;return this.uint16[y+0]=i,this.uint16[y+1]=n,this.uint16[y+2]=a,this.uint16[y+3]=l,this.float32[v+2]=h,this.float32[v+3]=p,this.float32[v+4]=_,e}}Zl.prototype.bytesPerElement=20,wt(Zl,"StructArrayLayout4ui3f20");class ad extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}ad.prototype.bytesPerElement=1,wt(ad,"StructArrayLayout1ub1");class Zf extends Hc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Zf.prototype.size=40;class Hf extends id{get(e){return new Zf(this,e)}}wt(Hf,"CollisionBoxArray");class Wf extends Hc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Wf.prototype.size=60;class Xf extends Ba{get(e){return new Wf(this,e)}}wt(Xf,"PlacedSymbolArray");class Yf extends Hc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Yf.prototype.size=80;class Kf extends Yc{get(e){return new Yf(this,e)}}wt(Kf,"SymbolInstanceArray");class Jf extends Gl{getoffsetX(e){return this.float32[1*e+0]}}wt(Jf,"GlyphOffsetArray");class Hl extends ws{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}wt(Hl,"SymbolLineVertexArray");class Qf extends Hc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Qf.prototype.size=12;class ep extends $l{get(e){return new Qf(this,e)}}wt(ep,"FeatureIndexArray");class Wl extends Ls{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}wt(Wl,"FillExtrusionCentroidArray");const M_=Ki([{name:"a_pos",components:2,type:"Int16"}],4),tp=Ki([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Br{constructor(e=[]){this.segments=e}_prepareSegment(e,i,n,a){let l=this.segments[this.segments.length-1];return e>Br.MAX_VERTEX_ARRAY_LENGTH&&pe(`Max vertices per segment is ${Br.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>Br.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==a)&&(l={vertexOffset:i,primitiveOffset:n,vertexLength:0,primitiveLength:0},a!==void 0&&(l.sortKey=a),this.segments.push(l)),l}prepareSegment(e,i,n,a){return this._prepareSegment(e,i.length,n.length,a)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,n,a){return new Br([{vertexOffset:e,primitiveOffset:i,vertexLength:n,primitiveLength:a,vaos:{},sortKey:0}])}}function ld(t,e){return 256*(t=zt(Math.floor(t),0,255))+zt(Math.floor(e),0,255)}Br.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,wt(Br,"SegmentVector");const ip=Ki([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),rp=Ki([{name:"a_dash",components:4,type:"Uint16"}]);var Xl={exports:{}},Kc={exports:{}};(function(t){t.exports=function(e,i){var n,a,l,h,p,_,y,v;for(a=e.length-(n=3&e.length),l=i,p=3432918353,_=461845907,v=0;v<a;)y=255&e.charCodeAt(v)|(255&e.charCodeAt(++v))<<8|(255&e.charCodeAt(++v))<<16|(255&e.charCodeAt(++v))<<24,++v,l=27492+(65535&(h=5*(65535&(l=(l^=y=(65535&(y=(y=(65535&y)*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(y=0,n){case 3:y^=(255&e.charCodeAt(v+2))<<16;case 2:y^=(255&e.charCodeAt(v+1))<<8;case 1:l^=y=(65535&(y=(y=(65535&(y^=255&e.charCodeAt(v)))*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295}return l^=e.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0}})(Kc);var cd=Kc.exports,np={exports:{}};(function(t){t.exports=function(e,i){for(var n,a=e.length,l=i^a,h=0;a>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(h)|(255&e.charCodeAt(++h))<<8|(255&e.charCodeAt(++h))<<16|(255&e.charCodeAt(++h))<<24))+((1540483477*(n>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++h;switch(a){case 3:l^=(255&e.charCodeAt(h+2))<<16;case 2:l^=(255&e.charCodeAt(h+1))<<8;case 1:l=1540483477*(65535&(l^=255&e.charCodeAt(h)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0}})(np);var sp=cd,op=np.exports;Xl.exports=sp,Xl.exports.murmur3=sp,Xl.exports.murmur2=op;var ud=Jt(Xl.exports);class Yl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,n,a){this.ids.push(ap(e)),this.positions.push(i,n,a)}eachPosition(e,i){const n=ap(e);let a=0,l=this.ids.length-1;for(;a<l;){const h=a+l>>1;this.ids[h]>=n?l=h:a=h+1}for(;this.ids[a]===n;)i(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,i){const n=new Float64Array(e.ids),a=new Uint32Array(e.positions);return hd(n,a,0,n.length-1),i&&(i.add(n.buffer),i.add(a.buffer)),{ids:n,positions:a}}static deserialize(e){const i=new Yl;let n;i.ids=e.ids,i.positions=e.positions;for(const a of i.ids)a!==n&&i.uniqueIds.push(a),n=a;return i.indexed=!0,i}}function ap(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ud(String(t))}function hd(t,e,i,n){for(;i<n;){const a=t[i+n>>1];let l=i-1,h=n+1;for(;;){do l++;while(t[l]<a);do h--;while(t[h]>a);if(l>=h)break;Jc(t,l,h),Jc(e,3*l,3*h),Jc(e,3*l+1,3*h+1),Jc(e,3*l+2,3*h+2)}h-i<n-h?(hd(t,e,i,h),i=h+1):(hd(t,e,h+1,n),n=h)}}function Jc(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}wt(Yl,"FeaturePositionMap");class Zs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class Qc extends Zs{constructor(e){super(e),this.current=0}set(e,i,n){this.fetchUniformLocation(e,i)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}}class Cn extends Zs{constructor(e){super(e),this.current=0}set(e,i,n){this.fetchUniformLocation(e,i)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Mo extends Zs{constructor(e){super(e),this.current=[0,0]}set(e,i,n){this.fetchUniformLocation(e,i)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}}class lp extends Zs{constructor(e){super(e),this.current=[0,0,0]}set(e,i,n){this.fetchUniformLocation(e,i)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}}class c extends Zs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,n){this.fetchUniformLocation(e,i)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class r extends Zs{constructor(e){super(e),this.current=$r.transparent}set(e,i,n){this.fetchUniformLocation(e,i)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const s=new Float32Array(16);class u extends Zs{constructor(e){super(e),this.current=s}set(e,i,n){if(this.fetchUniformLocation(e,i)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let a=1;a<16;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}}const f=new Float32Array(9),m=new Float32Array(4);class x extends Zs{constructor(e){super(e),this.current=m}set(e,i,n){if(this.fetchUniformLocation(e,i)){for(let a=0;a<4;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}}function b(t){return[ld(255*t.r,255*t.g),ld(255*t.b,255*t.a)]}class E{constructor(e,i,n){this.value=e,this.uniformNames=i.map(a=>`u_${a}`),this.type=n}setUniform(e,i,n,a,l){i.set(e,l,a.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new r(e):new Cn(e)}}class M{constructor(e,i){this.uniformNames=i.map(n=>`u_${n}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,n,a,l){const h=l==="u_pattern"||l==="u_dash"?this.pattern:l==="u_pixel_ratio"?this.pixelRatio:null;h&&i.set(e,l,h)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new c(e):new Cn(e)}}class I{constructor(e,i,n,a){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=i.map(l=>({name:`a_${l}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,i,n,a,l,h,p){const _=this.paintVertexArray.length,y=this.expression.evaluate(new Cr(0,{brightness:h}),i,{},l,a,p);this.paintVertexArray.resize(e),this._setPaintValue(_,e,y)}updatePaintArray(e,i,n,a,l,h,p){const _=this.expression.evaluate({zoom:0,brightness:p},n,a,void 0,l);this._setPaintValue(e,i,_)}_setPaintValue(e,i,n){if(this.type==="color"){const a=b(n);for(let l=e;l<i;l++)this.paintVertexArray.emplace(l,a[0],a[1])}else{for(let a=e;a<i;a++)this.paintVertexArray.emplace(a,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class P{constructor(e,i,n,a,l,h){this.expression=e,this.uniformNames=i.map(p=>`u_${p}_t`),this.type=n,this.useIntegerZoom=a,this.zoom=l,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,n,a,l,h,p){const _=this.expression.evaluate(new Cr(this.zoom,{brightness:h}),i,{},l,a,p),y=this.expression.evaluate(new Cr(this.zoom+1,{brightness:h}),i,{},l,a,p),v=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(v,e,_,y)}updatePaintArray(e,i,n,a,l,h,p){const _=this.expression.evaluate({zoom:this.zoom,brightness:p},n,a,void 0,l),y=this.expression.evaluate({zoom:this.zoom+1,brightness:p},n,a,void 0,l);this._setPaintValue(e,i,_,y)}_setPaintValue(e,i,n,a){if(this.type==="color"){const l=b(n),h=b(a);for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,l[0],l[1],h[0],h[1])}else{for(let l=e;l<i;l++)this.paintVertexArray.emplace(l,n,a);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,n,a,l){const h=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,p=zt(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(e,l,p)}getBinding(e,i){return new Cn(e)}}class z{constructor(e,i,n,a,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=(n==="array"?rp:ip).members;for(let h=0;h<i.length;++h);this.paintVertexArray=new a}populatePaintArray(e,i,n){const a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(a,e,i.patterns&&i.patterns[this.layerId],n)}updatePaintArray(e,i,n,a,l,h,p){this._setPaintValues(e,i,n.patterns&&n.patterns[this.layerId],h)}_setPaintValues(e,i,n,a){if(!a||!n)return;const l=a[n];if(!l)return;const{tl:h,br:p,pixelRatio:_}=l;for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,h[0],h[1],p[0],p[1],_)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class O{constructor(e,i,n=()=>!0){this.binders={},this._buffers=[];const a=[];for(const l in e.paint._values){const h=e.paint.get(l);if(!n(l)||!(h instanceof za&&Nc(h.property.specification)))continue;const p=G(l,e.type),_=h.value,y=h.property.specification.type,v=!!h.property.useIntegerZoom,T=l==="line-dasharray"||l.endsWith("pattern"),A=l==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(_.kind!=="constant"||A)if(_.kind==="source"||A||T){const C=J(l,y,"source");this.binders[l]=T?new z(_,p,y,C,e.id):new I(_,p,y,C),a.push(`/a_${l}`)}else{const C=J(l,y,"composite");this.binders[l]=new P(_,p,y,v,i,C),a.push(`/z_${l}`)}else this.binders[l]=T?new M(_.value,p):new E(_.value,p,y),a.push(`/u_${l}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof I||i instanceof P?i.maxValue:0}populatePaintArrays(e,i,n,a,l,h,p){for(const _ in this.binders){const y=this.binders[_];(y instanceof I||y instanceof P||y instanceof z)&&y.populatePaintArray(e,i,n,a,l,h,p)}}setConstantPatternPositions(e){for(const i in this.binders){const n=this.binders[i];n instanceof M&&n.setConstantPatternPositions(e)}}updatePaintArrays(e,i,n,a,l,h,p,_){let y=!1;const v=Object.keys(e),T=v.length!==0,A=T?v:i.uniqueIds;for(const C in this.binders){const R=this.binders[C];if((R instanceof I||R instanceof P||R instanceof z)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){const D=l.paint.get(C);R.expression=D.value;for(const B of A){const N=e[B.toString()];i.eachPosition(B,(H,K,Y)=>{const ne=a.feature(H);R.updatePaintArray(K,Y,ne,N,h,p,_)})}if(!T)for(const B of n.uniqueIds){const N=e[B.toString()];n.eachPosition(B,(H,K,Y)=>{const ne=a.feature(H);R.updatePaintArray(K,Y,ne,N,h,p,_)})}y=!0}}return y}defines(){const e=[];for(const i in this.binders){const n=this.binders[i];(n instanceof E||n instanceof M)&&e.push(...n.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const n=this.binders[i];if(n instanceof I||n instanceof P||n instanceof z)for(let a=0;a<n.paintVertexAttributes.length;a++)e.push(n.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const n=this.binders[i];if(n instanceof E||n instanceof M||n instanceof P)for(const a of n.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof E||a instanceof M||a instanceof P)for(const l of a.uniformNames)i.push({name:l,property:n,binding:a.getBinding(e,l)})}return i}setUniforms(e,i,n,a,l){for(const{name:h,property:p,binding:_}of n)this.binders[p].setUniform(e,_,l,a.get(p),h)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof I||i instanceof P||i instanceof z)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const n=this.binders[i];(n instanceof I||n instanceof P||n instanceof z)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof I||i instanceof P||i instanceof z)&&i.destroy()}}}class j{constructor(e,i,n=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new O(a,i,n);this.needsUpload=!1,this._featureMap=new Yl,this._featureMapWithoutIds=new Yl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,n,a,l,h,p,_){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(e,i,a,l,h,p,_);i.id!==void 0?this._featureMap.add(i.id,n,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,n,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,n,a,l,h){for(const p of n)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,p,a,l,h||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const U={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function G(t,e){return U[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const F={"line-pattern":{source:So,composite:So},"fill-pattern":{source:So,composite:So},"fill-extrusion-pattern":{source:So,composite:So},"line-dasharray":{source:Oa,composite:Oa}},Z={color:{source:ql,composite:Eo},number:{source:Gl,composite:ql}};function J(t,e,i){const n=F[t];return n&&n[i]||Z[e][i]}wt(E,"ConstantBinder"),wt(M,"PatternConstantBinder"),wt(I,"SourceExpressionBinder"),wt(z,"PatternCompositeBinder"),wt(P,"CompositeExpressionBinder"),wt(O,"ProgramConfiguration",{omit:["_buffers"]}),wt(j,"ProgramConfigurationSet");const W=_t/Math.PI/2,Q=5,$=6,ee=16383,ae=64,le=[ae,32,16],fe=-W,Te=W;function _e(t,e,i,n=W){return i=ni(i),[t*Math.sin(i)*n,-e*n,t*Math.cos(i)*n]}function Le(t,e,i){return _e(Math.cos(ni(t)),Math.sin(ni(t)),e,i)}const Pe=63710088e-1,$e=2*Math.PI*Pe;class ge{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ge(wn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,n=this.lat*i,a=e.lat*i,l=Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos((e.lng-this.lng)*i);return Pe*Math.acos(Math.min(l,1))}toBounds(e=0){const i=360*e/40075017,n=i/Math.cos(Math.PI/180*this.lat);return new Ae({lng:this.lng-n,lat:this.lat-i},{lng:this.lng+n,lat:this.lat+i})}toEcef(e){return Le(this.lat,this.lng,W+e*W/Pe)}static convert(e){if(e instanceof ge)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ge(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ge(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ae{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ge?new ge(e.lng,e.lat):ge.convert(e),this}setSouthWest(e){return this._sw=e instanceof ge?new ge(e.lng,e.lat):ge.convert(e),this}extend(e){const i=this._sw,n=this._ne;let a,l;if(e instanceof ge)a=e,l=e;else{if(!(e instanceof Ae))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ae.convert(e)):this.extend(ge.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ge.convert(e)):this;if(a=e._sw,l=e._ne,!a||!l)return this}return i||n?(i.lng=Math.min(a.lng,i.lng),i.lat=Math.min(a.lat,i.lat),n.lng=Math.max(l.lng,n.lng),n.lat=Math.max(l.lat,n.lat)):(this._sw=new ge(a.lng,a.lat),this._ne=new ge(l.lng,l.lat)),this}getCenter(){return new ge((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ge(this.getWest(),this.getNorth())}getSouthEast(){return new ge(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:n}=ge.convert(e);let a=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&a}static convert(e){return!e||e instanceof Ae?e:new Ae(e)}}var he={};(function(t,e){(function(i){function n(l,h,p){var _=a(256*l,256*(h=Math.pow(2,p)-h-1),p),y=a(256*(l+1),256*(h+1),p);return _[0]+","+_[1]+","+y[0]+","+y[1]}function a(l,h,p){var _=2*Math.PI*6378137/256/Math.pow(2,p);return[l*_-2*Math.PI*6378137/2,h*_-2*Math.PI*6378137/2]}i.getURL=function(l,h,p,_,y,v){return v=v||{},l+"?"+["bbox="+n(p,_,y),"format="+(v.format||"image/png"),"service="+(v.service||"WMS"),"version="+(v.version||"1.1.1"),"request="+(v.request||"GetMap"),"srs="+(v.srs||"EPSG:3857"),"width="+(v.width||256),"height="+(v.height||256),"layers="+h].join("&")},i.getTileBBox=n,i.getMercCoords=a,Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,he);var ve=he;class Ze{constructor(e,i,n){this.z=e,this.x=i,this.y=n,this.key=dt(0,e,e,i,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const n=ve.getTileBBox(this.x,this.y,this.z),a=function(l,h,p){let _,y="";for(let v=l;v>0;v--)_=1<<v-1,y+=(h&_?1:0)+(p&_?2:0);return y}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Qe{constructor(e,i){this.wrap=e,this.canonical=i,this.key=dt(e,i.z,i.z,i.x,i.y)}}class Je{constructor(e,i,n,a,l){this.overscaledZ=e,this.wrap=i,this.canonical=new Ze(n,+a,+l),this.key=i===0&&e===n?this.canonical.key:dt(i,e,n,a,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Je(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Je(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return dt(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return dt(this.wrap*+i,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Je(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,n=2*this.canonical.x,a=2*this.canonical.y;return[new Je(i,this.wrap,i,n,a),new Je(i,this.wrap,i,n+1,a),new Je(i,this.wrap,i,n,a+1),new Je(i,this.wrap,i,n+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Je(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Je(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Qe(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function dt(t,e,i,n,a){const l=1<<Math.min(i,22);let h=l*(a%l)+n%l;return t&&i<22&&(h+=l*l*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*h+i)+(e-i)}const Ct=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new Je(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new Je(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new Je(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new Je(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];wt(Ze,"CanonicalTileID"),wt(Je,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Ut=0,Rt=25.5;function kt(t){return $e*Math.cos(t*Math.PI/180)}function hi(t){return(180+t)/360}function Qt(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ai(t,e){return t/kt(e)}function oi(t){return 360*t-180}function Ii(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function ur(t,e){return t*kt(Ii(e))}const xi=85.051129;function Rr(t){return Math.cos(ni(zt(t,-xi,xi)))}function vi(t,e){const i=zt(e,Ut,Rt),n=Math.pow(2,i);return Rr(t)*$e/(512*n)}function ki(t){return 1/Math.cos(t*Math.PI/180)}function bi(t,e=0){const i=Math.exp(Math.PI*(1-(t.y+e/_t)/(1<<t.z)*2));return 80150034*i/(i*i+1)/_t/(1<<t.z)}class Di{constructor(e,i,n=0){this.x=+e,this.y=+i,this.z=+n}static fromLngLat(e,i=0){const n=ge.convert(e);return new Di(hi(n.lng),Qt(n.lat),ai(i,n.lat))}toLngLat(){return new ge(oi(this.x),Ii(this.y))}toAltitude(){return ur(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/$e*ki(Ii(this.y))}}function pr(t,e,i,n,a,l,h,p,_){const y=(e+n)/2,v=(i+a)/2,T=new Ue(y,v);p(T),function(A,C,R,D,B,N){const H=R-B,K=D-N;return Math.abs((D-C)*H-(R-A)*K)/Math.hypot(H,K)}(T.x,T.y,l.x,l.y,h.x,h.y)>=_?(pr(t,e,i,y,v,l,T,p,_),pr(t,y,v,n,a,T,h,p,_)):t.push(h)}function Gi(t,e,i){let n=t[0],a=n.x,l=n.y;e(n);const h=[n];for(let p=1;p<t.length;p++){const _=t[p],{x:y,y:v}=_;e(_),pr(h,a,l,y,v,n,_,e,i),a=y,l=v,n=_}return h}function on(t,e,i,n){if(n(e,i)){const a=e.add(i)._mult(.5);on(t,e,a,n),on(t,a,i,n)}else t.push(i)}function xn(t,e){let i=t[0];const n=[i];for(let a=1;a<t.length;a++){const l=t[a];on(n,i,l,e),i=l}return n}const qn=Math.pow(2,14)-1,Ds=-qn-1;function Zn(t,e){const i=Math.round(t.x*e),n=Math.round(t.y*e);return t.x=zt(i,Ds,qn),t.y=zt(n,Ds,qn),(i<t.x||i>t.x+1||n<t.y||n>t.y+1)&&pe("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function an(t,e,i){const n=t.loadGeometry(),a=t.extent,l=_t/a;if(e&&i&&i.projection.isReprojectedInTileSpace){const h=1<<e.z,{scale:p,x:_,y,projection:v}=i,T=A=>{const C=oi((e.x+A.x/a)/h),R=Ii((e.y+A.y/a)/h),D=v.project(C,R);A.x=(D.x*p-_)*a,A.y=(D.y*p-y)*a};for(let A=0;A<n.length;A++)if(t.type!==1)n[A]=Gi(n[A],T,1);else{const C=[];for(const R of n[A])R.x<0||R.x>=a||R.y<0||R.y>=a||(T(R),C.push(R));n[A]=C}}for(const h of n)for(const p of h)Zn(p,l);return n}function en(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?an(t):[]}}function Pn(t,e,i,n,a){t.emplaceBack(2*e+(n+1)/2,2*i+(a+1)/2)}function kn(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Hn{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ws,this.indexArray=new sn,this.segments=new Br,this.programConfigurations=new j(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,n,a){const l=this.layers[0],h=[];let p=null;l.type==="circle"&&(p=l.layout.get("circle-sort-key"));for(const{feature:y,id:v,index:T,sourceLayerIndex:A}of e){const C=this.layers[0]._featureFilter.needGeometry,R=en(y,C);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom),R,n))continue;const D=p?p.evaluate(R,{},n):void 0,B={id:v,properties:y.properties,type:y.type,sourceLayerIndex:A,index:T,geometry:C?R.geometry:an(y,n,a),patterns:{},sortKey:D};h.push(B)}p&&h.sort((y,v)=>y.sortKey-v.sortKey);let _=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new Wc,_=a.projection);for(const y of h){const{geometry:v,index:T,sourceLayerIndex:A}=y,C=e[T].feature;this.addFeature(y,v,T,i.availableImages,n,_,i.brightness),i.featureIndex.insert(C,v,T,A,this.index)}}update(e,i,n,a,l){const h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,h?this.stateDependentLayers:this.layers,n,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,M_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,tp.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,n,a,l,h,p){for(const _ of i)for(const y of _){const v=y.x,T=y.y;if(v<0||v>=_t||T<0||T>=_t)continue;if(h){const R=h.projectTilePoint(v,T,l),D=h.upVector(l,v,T),B=this.globeExtVertexArray;kn(B,R,D),kn(B,R,D),kn(B,R,D),kn(B,R,D)}const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),C=A.vertexLength;Pn(this.layoutVertexArray,v,T,-1,-1),Pn(this.layoutVertexArray,v,T,1,-1),Pn(this.layoutVertexArray,v,T,1,1),Pn(this.layoutVertexArray,v,T,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+2,C+3),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},a,l,p)}}function zs(t,e){for(let i=0;i<t.length;i++)if(Hs(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Hs(t,e[i]))return!0;return!!Jl(t,e)}function Io(t,e,i){return!!Hs(t,e)||!!Ql(e,t,i)}function ta(t,e){if(t.length===1)return eu(e,t[0]);for(let i=0;i<e.length;i++){const n=e[i];for(let a=0;a<n.length;a++)if(Hs(t,n[a]))return!0}for(let i=0;i<t.length;i++)if(eu(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Jl(t,e[i]))return!0;return!1}function Kl(t,e,i){if(t.length>1){if(Jl(t,e))return!0;for(let n=0;n<e.length;n++)if(Ql(e[n],t,i))return!0}for(let n=0;n<t.length;n++)if(Ql(t[n],e,i))return!0;return!1}function Jl(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const n=t[i],a=t[i+1];for(let l=0;l<e.length-1;l++)if(dd(n,a,e[l],e[l+1]))return!0}return!1}function dd(t,e,i,n){return Be(t,i,n)!==Be(e,i,n)&&Be(t,e,i)!==Be(t,e,n)}function Ql(t,e,i){const n=i*i;if(e.length===1)return t.distSqr(e[0])<n;for(let a=1;a<e.length;a++)if(Fa(t,e[a-1],e[a])<n)return!0;return!1}function Fa(t,e,i){const n=e.distSqr(i);if(n===0)return t.distSqr(e);const a=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return t.distSqr(a<0?e:a>1?i:i.sub(e)._mult(a)._add(e))}function eu(t,e){let i,n,a,l=!1;for(let h=0;h<t.length;h++){i=t[h];for(let p=0,_=i.length-1;p<i.length;_=p++)n=i[p],a=i[_],n.y>e.y!=a.y>e.y&&e.x<(a.x-n.x)*(e.y-n.y)/(a.y-n.y)+n.x&&(l=!l)}return l}function Hs(t,e){let i=!1;for(let n=0,a=t.length-1;n<t.length;a=n++){const l=t[n],h=t[a];l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(i=!i)}return i}function s0(t,e,i,n,a){for(const h of t)if(e<=h.x&&i<=h.y&&n>=h.x&&a>=h.y)return!0;const l=[new Ue(e,i),new Ue(e,a),new Ue(n,a),new Ue(n,i)];if(t.length>2){for(const h of l)if(Hs(t,h))return!0}for(let h=0;h<t.length-1;h++)if(vE(t[h],t[h+1],l))return!0;return!1}function vE(t,e,i){const n=i[0],a=i[2];if(t.x<n.x&&e.x<n.x||t.x>a.x&&e.x>a.x||t.y<n.y&&e.y<n.y||t.y>a.y&&e.y>a.y)return!1;const l=Be(t,e,i[0]);return l!==Be(t,e,i[1])||l!==Be(t,e,i[2])||l!==Be(t,e,i[3])}function tu(t,e,i,n,a,l){let h=e.y-t.y,p=t.x-e.x;if(l=l||0){const _=h*h+p*p;if(_===0)return!0;const y=Math.sqrt(_);h/=y,p/=y}return!((i.x-t.x)*h+(i.y-t.y)*p-l<0||(n.x-t.x)*h+(n.y-t.y)*p-l<0||(a.x-t.x)*h+(a.y-t.y)*p-l<0)}function I_(t,e,i,n,a,l,h){return!(tu(t,e,n,a,l,h)||tu(e,i,n,a,l,h)||tu(i,t,n,a,l,h)||tu(n,a,t,e,i,h)||tu(a,l,t,e,i,h)||tu(l,n,t,e,i,h))}function iu(t,e,i){const n=e.paint.get(t).value;return n.kind==="constant"?n.value:i.programConfigurations.get(e.id).getMaxValue(t)}function cp(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function o0(t,e,i,n,a){if(!e[0]&&!e[1])return t;const l=Ue.convert(e)._mult(a);i==="viewport"&&l._rotate(-n);const h=[];for(let p=0;p<t.length;p++)h.push(t[p].sub(l));return h}function a0(t,e,i,n){const a=Ue.convert(t)._mult(n);return e==="viewport"&&a._rotate(-i),a}wt(Hn,"CircleBucket",{omit:["layers"]});const bE=new Pr({"circle-sort-key":new Gt(be.layout_circle["circle-sort-key"]),visibility:new tt(be.layout_circle.visibility)});var wE={paint:new Pr({"circle-radius":new Gt(be.paint_circle["circle-radius"]),"circle-color":new Gt(be.paint_circle["circle-color"]),"circle-blur":new Gt(be.paint_circle["circle-blur"]),"circle-opacity":new Gt(be.paint_circle["circle-opacity"]),"circle-translate":new tt(be.paint_circle["circle-translate"]),"circle-translate-anchor":new tt(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new tt(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new tt(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gt(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gt(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gt(be.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new tt(be.paint_circle["circle-emissive-strength"])}),layout:bE},cn={},un={};Object.defineProperty(un,"__esModule",{value:!0}),un.setMatrixArrayType=function(t){un.ARRAY_TYPE=c0=t},un.toRadian=function(t){return t*EE},un.equals=function(t,e){return Math.abs(t-e)<=l0*Math.max(1,Math.abs(t),Math.abs(e))},un.RANDOM=un.ARRAY_TYPE=un.EPSILON=void 0;var l0=1e-6;un.EPSILON=l0;var c0=typeof Float32Array<"u"?Float32Array:Array;un.ARRAY_TYPE=c0;var TE=Math.random;un.RANDOM=TE;var EE=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Lr={};function C_(t){return C_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C_(t)}Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.create=function(){var t=new Na.ARRAY_TYPE(4);return Na.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Lr.clone=function(t){var e=new Na.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Lr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Lr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Lr.fromValues=function(t,e,i,n){var a=new Na.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=n,a},Lr.set=function(t,e,i,n,a){return t[0]=e,t[1]=i,t[2]=n,t[3]=a,t},Lr.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Lr.invert=function(t,e){var i=e[0],n=e[1],a=e[2],l=e[3],h=i*l-a*n;return h?(t[0]=l*(h=1/h),t[1]=-n*h,t[2]=-a*h,t[3]=i*h,t):null},Lr.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},Lr.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Lr.multiply=h0,Lr.rotate=function(t,e,i){var n=e[0],a=e[1],l=e[2],h=e[3],p=Math.sin(i),_=Math.cos(i);return t[0]=n*_+l*p,t[1]=a*_+h*p,t[2]=n*-p+l*_,t[3]=a*-p+h*_,t},Lr.scale=function(t,e,i){var n=e[1],a=e[2],l=e[3],h=i[0],p=i[1];return t[0]=e[0]*h,t[1]=n*h,t[2]=a*p,t[3]=l*p,t},Lr.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t},Lr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Lr.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Lr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Lr.LDU=function(t,e,i,n){return t[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-t[2]*i[1],[t,e,i]},Lr.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Lr.subtract=d0,Lr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Lr.equals=function(t,e){var i=t[0],n=t[1],a=t[2],l=t[3],h=e[0],p=e[1],_=e[2],y=e[3];return Math.abs(i-h)<=Na.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-p)<=Na.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-_)<=Na.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(l-y)<=Na.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))},Lr.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Lr.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},Lr.sub=Lr.mul=void 0;var Na=function(t,e){if(t&&t.__esModule)return t;if(t===null||C_(t)!=="object"&&typeof t!="function")return{default:t};var i=u0(void 0);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,i&&i.set(t,n),n}(un);function u0(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(u0=function(n){return n?i:e})(t)}function h0(t,e,i){var n=e[0],a=e[1],l=e[2],h=e[3],p=i[0],_=i[1],y=i[2],v=i[3];return t[0]=n*p+l*_,t[1]=a*p+h*_,t[2]=n*y+l*v,t[3]=a*y+h*v,t}function d0(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}Lr.mul=h0,Lr.sub=d0;var zr={};function P_(t){return P_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P_(t)}Object.defineProperty(zr,"__esModule",{value:!0}),zr.create=function(){var t=new Co.ARRAY_TYPE(6);return Co.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},zr.clone=function(t){var e=new Co.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},zr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},zr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},zr.fromValues=function(t,e,i,n,a,l){var h=new Co.ARRAY_TYPE(6);return h[0]=t,h[1]=e,h[2]=i,h[3]=n,h[4]=a,h[5]=l,h},zr.set=function(t,e,i,n,a,l,h){return t[0]=e,t[1]=i,t[2]=n,t[3]=a,t[4]=l,t[5]=h,t},zr.invert=function(t,e){var i=e[0],n=e[1],a=e[2],l=e[3],h=e[4],p=e[5],_=i*l-n*a;return _?(t[0]=l*(_=1/_),t[1]=-n*_,t[2]=-a*_,t[3]=i*_,t[4]=(a*p-l*h)*_,t[5]=(n*h-i*p)*_,t):null},zr.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},zr.multiply=p0,zr.rotate=function(t,e,i){var n=e[0],a=e[1],l=e[2],h=e[3],p=e[4],_=e[5],y=Math.sin(i),v=Math.cos(i);return t[0]=n*v+l*y,t[1]=a*v+h*y,t[2]=n*-y+l*v,t[3]=a*-y+h*v,t[4]=p,t[5]=_,t},zr.scale=function(t,e,i){var n=e[1],a=e[2],l=e[3],h=e[4],p=e[5],_=i[0],y=i[1];return t[0]=e[0]*_,t[1]=n*_,t[2]=a*y,t[3]=l*y,t[4]=h,t[5]=p,t},zr.translate=function(t,e,i){var n=e[0],a=e[1],l=e[2],h=e[3],p=e[4],_=e[5],y=i[0],v=i[1];return t[0]=n,t[1]=a,t[2]=l,t[3]=h,t[4]=n*y+l*v+p,t[5]=a*y+h*v+_,t},zr.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t[4]=0,t[5]=0,t},zr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},zr.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},zr.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},zr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},zr.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},zr.subtract=m0,zr.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},zr.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t},zr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},zr.equals=function(t,e){var i=t[0],n=t[1],a=t[2],l=t[3],h=t[4],p=t[5],_=e[0],y=e[1],v=e[2],T=e[3],A=e[4],C=e[5];return Math.abs(i-_)<=Co.EPSILON*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(n-y)<=Co.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(a-v)<=Co.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-T)<=Co.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(h-A)<=Co.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(p-C)<=Co.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))},zr.sub=zr.mul=void 0;var Co=function(t,e){if(t&&t.__esModule)return t;if(t===null||P_(t)!=="object"&&typeof t!="function")return{default:t};var i=f0(void 0);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,i&&i.set(t,n),n}(un);function f0(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(f0=function(n){return n?i:e})(t)}function p0(t,e,i){var n=e[0],a=e[1],l=e[2],h=e[3],p=e[4],_=e[5],y=i[0],v=i[1],T=i[2],A=i[3],C=i[4],R=i[5];return t[0]=n*y+l*v,t[1]=a*y+h*v,t[2]=n*T+l*A,t[3]=a*T+h*A,t[4]=n*C+l*R+p,t[5]=a*C+h*R+_,t}function m0(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}zr.mul=p0,zr.sub=m0;var lr={};function R_(t){return R_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R_(t)}Object.defineProperty(lr,"__esModule",{value:!0}),lr.create=function(){var t=new Ts.ARRAY_TYPE(9);return Ts.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},lr.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},lr.clone=function(t){var e=new Ts.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},lr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},lr.fromValues=function(t,e,i,n,a,l,h,p,_){var y=new Ts.ARRAY_TYPE(9);return y[0]=t,y[1]=e,y[2]=i,y[3]=n,y[4]=a,y[5]=l,y[6]=h,y[7]=p,y[8]=_,y},lr.set=function(t,e,i,n,a,l,h,p,_,y){return t[0]=e,t[1]=i,t[2]=n,t[3]=a,t[4]=l,t[5]=h,t[6]=p,t[7]=_,t[8]=y,t},lr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},lr.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},lr.invert=function(t,e){var i=e[0],n=e[1],a=e[2],l=e[3],h=e[4],p=e[5],_=e[6],y=e[7],v=e[8],T=v*h-p*y,A=-v*l+p*_,C=y*l-h*_,R=i*T+n*A+a*C;return R?(t[0]=T*(R=1/R),t[1]=(-v*n+a*y)*R,t[2]=(p*n-a*h)*R,t[3]=A*R,t[4]=(v*i-a*_)*R,t[5]=(-p*i+a*l)*R,t[6]=C*R,t[7]=(-y*i+n*_)*R,t[8]=(h*i-n*l)*R,t):null},lr.adjoint=function(t,e){var i=e[0],n=e[1],a=e[2],l=e[3],h=e[4],p=e[5],_=e[6],y=e[7],v=e[8];return t[0]=h*v-p*y,t[1]=a*y-n*v,t[2]=n*p-a*h,t[3]=p*_-l*v,t[4]=i*v-a*_,t[5]=a*l-i*p,t[6]=l*y-h*_,t[7]=n*_-i*y,t[8]=i*h-n*l,t},lr.determinant=function(t){var e=t[3],i=t[4],n=t[5],a=t[6],l=t[7],h=t[8];return t[0]*(h*i-n*l)+t[1]*(-h*e+n*a)+t[2]*(l*e-i*a)},lr.multiply=g0,lr.translate=function(t,e,i){var n=e[0],a=e[1],l=e[2],h=e[3],p=e[4],_=e[5],y=e[6],v=e[7],T=e[8],A=i[0],C=i[1];return t[0]=n,t[1]=a,t[2]=l,t[3]=h,t[4]=p,t[5]=_,t[6]=A*n+C*h+y,t[7]=A*a+C*p+v,t[8]=A*l+C*_+T,t},lr.rotate=function(t,e,i){var n=e[0],a=e[1],l=e[2],h=e[3],p=e[4],_=e[5],y=e[6],v=e[7],T=e[8],A=Math.sin(i),C=Math.cos(i);return t[0]=C*n+A*h,t[1]=C*a+A*p,t[2]=C*l+A*_,t[3]=C*h-A*n,t[4]=C*p-A*a,t[5]=C*_-A*l,t[6]=y,t[7]=v,t[8]=T,t},lr.scale=function(t,e,i){var n=i[0],a=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},lr.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},lr.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},lr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},lr.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},lr.fromQuat=function(t,e){var i=e[0],n=e[1],a=e[2],l=e[3],h=i+i,p=n+n,_=a+a,y=i*h,v=n*h,T=n*p,A=a*h,C=a*p,R=a*_,D=l*h,B=l*p,N=l*_;return t[0]=1-T-R,t[3]=v-N,t[6]=A+B,t[1]=v+N,t[4]=1-y-R,t[7]=C-D,t[2]=A-B,t[5]=C+D,t[8]=1-y-T,t},lr.normalFromMat4=function(t,e){var i=e[0],n=e[1],a=e[2],l=e[3],h=e[4],p=e[5],_=e[6],y=e[7],v=e[8],T=e[9],A=e[10],C=e[11],R=e[12],D=e[13],B=e[14],N=e[15],H=i*p-n*h,K=i*_-a*h,Y=i*y-l*h,ne=n*_-a*p,ie=n*y-l*p,ce=a*y-l*_,me=v*D-T*R,ye=v*B-A*R,Ee=v*N-C*R,xe=T*B-A*D,De=T*N-C*D,je=A*N-C*B,Re=H*je-K*De+Y*xe+ne*Ee-ie*ye+ce*me;return Re?(t[0]=(p*je-_*De+y*xe)*(Re=1/Re),t[1]=(_*Ee-h*je-y*ye)*Re,t[2]=(h*De-p*Ee+y*me)*Re,t[3]=(a*De-n*je-l*xe)*Re,t[4]=(i*je-a*Ee+l*ye)*Re,t[5]=(n*Ee-i*De-l*me)*Re,t[6]=(D*ce-B*ie+N*ne)*Re,t[7]=(B*Y-R*ce-N*K)*Re,t[8]=(R*ie-D*Y+N*H)*Re,t):null},lr.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},lr.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},lr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},lr.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},lr.subtract=y0,lr.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},lr.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t},lr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},lr.equals=function(t,e){var i=t[0],n=t[1],a=t[2],l=t[3],h=t[4],p=t[5],_=t[6],y=t[7],v=t[8],T=e[0],A=e[1],C=e[2],R=e[3],D=e[4],B=e[5],N=e[6],H=e[7],K=e[8];return Math.abs(i-T)<=Ts.EPSILON*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(n-A)<=Ts.EPSILON*Math.max(1,Math.abs(n),Math.abs(A))&&Math.abs(a-C)<=Ts.EPSILON*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(l-R)<=Ts.EPSILON*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(h-D)<=Ts.EPSILON*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(p-B)<=Ts.EPSILON*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(_-N)<=Ts.EPSILON*Math.max(1,Math.abs(_),Math.abs(N))&&Math.abs(y-H)<=Ts.EPSILON*Math.max(1,Math.abs(y),Math.abs(H))&&Math.abs(v-K)<=Ts.EPSILON*Math.max(1,Math.abs(v),Math.abs(K))},lr.sub=lr.mul=void 0;var Ts=function(t,e){if(t&&t.__esModule)return t;if(t===null||R_(t)!=="object"&&typeof t!="function")return{default:t};var i=_0(void 0);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,i&&i.set(t,n),n}(un);function _0(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(_0=function(n){return n?i:e})(t)}function g0(t,e,i){var n=e[0],a=e[1],l=e[2],h=e[3],p=e[4],_=e[5],y=e[6],v=e[7],T=e[8],A=i[0],C=i[1],R=i[2],D=i[3],B=i[4],N=i[5],H=i[6],K=i[7],Y=i[8];return t[0]=A*n+C*h+R*y,t[1]=A*a+C*p+R*v,t[2]=A*l+C*_+R*T,t[3]=D*n+B*h+N*y,t[4]=D*a+B*p+N*v,t[5]=D*l+B*_+N*T,t[6]=H*n+K*h+Y*y,t[7]=H*a+K*p+Y*v,t[8]=H*l+K*_+Y*T,t}function y0(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}lr.mul=g0,lr.sub=y0;var pi={};function L_(t){return L_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L_(t)}Object.defineProperty(pi,"__esModule",{value:!0}),pi.create=function(){var t=new Nr.ARRAY_TYPE(16);return Nr.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},pi.clone=function(t){var e=new Nr.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},pi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},pi.fromValues=function(t,e,i,n,a,l,h,p,_,y,v,T,A,C,R,D){var B=new Nr.ARRAY_TYPE(16);return B[0]=t,B[1]=e,B[2]=i,B[3]=n,B[4]=a,B[5]=l,B[6]=h,B[7]=p,B[8]=_,B[9]=y,B[10]=v,B[11]=T,B[12]=A,B[13]=C,B[14]=R,B[15]=D,B},pi.set=function(t,e,i,n,a,l,h,p,_,y,v,T,A,C,R,D,B){return t[0]=e,t[1]=i,t[2]=n,t[3]=a,t[4]=l,t[5]=h,t[6]=p,t[7]=_,t[8]=y,t[9]=v,t[10]=T,t[11]=A,t[12]=C,t[13]=R,t[14]=D,t[15]=B,t},pi.identity=v0,pi.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],a=e[3],l=e[6],h=e[7],p=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=l,t[11]=e[14],t[12]=a,t[13]=h,t[14]=p}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},pi.invert=function(t,e){var i=e[0],n=e[1],a=e[2],l=e[3],h=e[4],p=e[5],_=e[6],y=e[7],v=e[8],T=e[9],A=e[10],C=e[11],R=e[12],D=e[13],B=e[14],N=e[15],H=i*p-n*h,K=i*_-a*h,Y=i*y-l*h,ne=n*_-a*p,ie=n*y-l*p,ce=a*y-l*_,me=v*D-T*R,ye=v*B-A*R,Ee=v*N-C*R,xe=T*B-A*D,De=T*N-C*D,je=A*N-C*B,Re=H*je-K*De+Y*xe+ne*Ee-ie*ye+ce*me;return Re?(t[0]=(p*je-_*De+y*xe)*(Re=1/Re),t[1]=(a*De-n*je-l*xe)*Re,t[2]=(D*ce-B*ie+N*ne)*Re,t[3]=(A*ie-T*ce-C*ne)*Re,t[4]=(_*Ee-h*je-y*ye)*Re,t[5]=(i*je-a*Ee+l*ye)*Re,t[6]=(B*Y-R*ce-N*K)*Re,t[7]=(v*ce-A*Y+C*K)*Re,t[8]=(h*De-p*Ee+y*me)*Re,t[9]=(n*Ee-i*De-l*me)*Re,t[10]=(R*ie-D*Y+N*H)*Re,t[11]=(T*Y-v*ie-C*H)*Re,t[12]=(p*ye-h*xe-_*me)*Re,t[13]=(i*xe-n*ye+a*me)*Re,t[14]=(D*K-R*ne-B*H)*Re,t[15]=(v*ne-T*K+A*H)*Re,t):null},pi.adjoint=function(t,e){var i=e[0],n=e[1],a=e[2],l=e[3],h=e[4],p=e[5],_=e[6],y=e[7],v=e[8],T=e[9],A=e[10],C=e[11],R=e[12],D=e[13],B=e[14],N=e[15];return t[0]=p*(A*N-C*B)-T*(_*N-y*B)+D*(_*C-y*A),t[1]=-(n*(A*N-C*B)-T*(a*N-l*B)+D*(a*C-l*A)),t[2]=n*(_*N-y*B)-p*(a*N-l*B)+D*(a*y-l*_),t[3]=-(n*(_*C-y*A)-p*(a*C-l*A)+T*(a*y-l*_)),t[4]=-(h*(A*N-C*B)-v*(_*N-y*B)+R*(_*C-y*A)),t[5]=i*(A*N-C*B)-v*(a*N-l*B)+R*(a*C-l*A),t[6]=-(i*(_*N-y*B)-h*(a*N-l*B)+R*(a*y-l*_)),t[7]=i*(_*C-y*A)-h*(a*C-l*A)+v*(a*y-l*_),t[8]=h*(T*N-C*D)-v*(p*N-y*D)+R*(p*C-y*T),t[9]=-(i*(T*N-C*D)-v*(n*N-l*D)+R*(n*C-l*T)),t[10]=i*(p*N-y*D)-h*(n*N-l*D)+R*(n*y-l*p),t[11]=-(i*(p*C-y*T)-h*(n*C-l*T)+v*(n*y-l*p)),t[12]=-(h*(T*B-A*D)-v*(p*B-_*D)+R*(p*A-_*T)),t[13]=i*(T*B-A*D)-v*(n*B-a*D)+R*(n*A-a*T),t[14]=-(i*(p*B-_*D)-h*(n*B-a*D)+R*(n*_-a*p)),t[15]=i*(p*A-_*T)-h*(n*A-a*T)+v*(n*_-a*p),t},pi.determinant=function(t){var e=t[0],i=t[1],n=t[2],a=t[3],l=t[4],h=t[5],p=t[6],_=t[7],y=t[8],v=t[9],T=t[10],A=t[11],C=t[12],R=t[13],D=t[14],B=t[15];return(e*h-i*l)*(T*B-A*D)-(e*p-n*l)*(v*B-A*R)+(e*_-a*l)*(v*D-T*R)+(i*p-n*h)*(y*B-A*C)-(i*_-a*h)*(y*D-T*C)+(n*_-a*p)*(y*R-v*C)},pi.multiply=b0,pi.translate=function(t,e,i){var n,a,l,h,p,_,y,v,T,A,C,R,D=i[0],B=i[1],N=i[2];return e===t?(t[12]=e[0]*D+e[4]*B+e[8]*N+e[12],t[13]=e[1]*D+e[5]*B+e[9]*N+e[13],t[14]=e[2]*D+e[6]*B+e[10]*N+e[14],t[15]=e[3]*D+e[7]*B+e[11]*N+e[15]):(a=e[1],l=e[2],h=e[3],p=e[4],_=e[5],y=e[6],v=e[7],T=e[8],A=e[9],C=e[10],R=e[11],t[0]=n=e[0],t[1]=a,t[2]=l,t[3]=h,t[4]=p,t[5]=_,t[6]=y,t[7]=v,t[8]=T,t[9]=A,t[10]=C,t[11]=R,t[12]=n*D+p*B+T*N+e[12],t[13]=a*D+_*B+A*N+e[13],t[14]=l*D+y*B+C*N+e[14],t[15]=h*D+v*B+R*N+e[15]),t},pi.scale=function(t,e,i){var n=i[0],a=i[1],l=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},pi.rotate=function(t,e,i,n){var a,l,h,p,_,y,v,T,A,C,R,D,B,N,H,K,Y,ne,ie,ce,me,ye,Ee,xe,De=n[0],je=n[1],Re=n[2],Ve=Math.hypot(De,je,Re);return Ve<Nr.EPSILON?null:(De*=Ve=1/Ve,je*=Ve,Re*=Ve,a=Math.sin(i),l=Math.cos(i),_=e[1],y=e[2],v=e[3],A=e[5],C=e[6],R=e[7],B=e[9],N=e[10],H=e[11],K=De*De*(h=1-l)+l,ie=De*je*h-Re*a,ce=je*je*h+l,me=Re*je*h+De*a,ye=De*Re*h+je*a,Ee=je*Re*h-De*a,xe=Re*Re*h+l,t[0]=(p=e[0])*K+(T=e[4])*(Y=je*De*h+Re*a)+(D=e[8])*(ne=Re*De*h-je*a),t[1]=_*K+A*Y+B*ne,t[2]=y*K+C*Y+N*ne,t[3]=v*K+R*Y+H*ne,t[4]=p*ie+T*ce+D*me,t[5]=_*ie+A*ce+B*me,t[6]=y*ie+C*ce+N*me,t[7]=v*ie+R*ce+H*me,t[8]=p*ye+T*Ee+D*xe,t[9]=_*ye+A*Ee+B*xe,t[10]=y*ye+C*Ee+N*xe,t[11]=v*ye+R*Ee+H*xe,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},pi.rotateX=function(t,e,i){var n=Math.sin(i),a=Math.cos(i),l=e[4],h=e[5],p=e[6],_=e[7],y=e[8],v=e[9],T=e[10],A=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*a+y*n,t[5]=h*a+v*n,t[6]=p*a+T*n,t[7]=_*a+A*n,t[8]=y*a-l*n,t[9]=v*a-h*n,t[10]=T*a-p*n,t[11]=A*a-_*n,t},pi.rotateY=function(t,e,i){var n=Math.sin(i),a=Math.cos(i),l=e[0],h=e[1],p=e[2],_=e[3],y=e[8],v=e[9],T=e[10],A=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*a-y*n,t[1]=h*a-v*n,t[2]=p*a-T*n,t[3]=_*a-A*n,t[8]=l*n+y*a,t[9]=h*n+v*a,t[10]=p*n+T*a,t[11]=_*n+A*a,t},pi.rotateZ=function(t,e,i){var n=Math.sin(i),a=Math.cos(i),l=e[0],h=e[1],p=e[2],_=e[3],y=e[4],v=e[5],T=e[6],A=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*a+y*n,t[1]=h*a+v*n,t[2]=p*a+T*n,t[3]=_*a+A*n,t[4]=y*a-l*n,t[5]=v*a-h*n,t[6]=T*a-p*n,t[7]=A*a-_*n,t},pi.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},pi.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},pi.fromRotation=function(t,e,i){var n,a,l,h=i[0],p=i[1],_=i[2],y=Math.hypot(h,p,_);return y<Nr.EPSILON?null:(h*=y=1/y,p*=y,_*=y,n=Math.sin(e),a=Math.cos(e),t[0]=h*h*(l=1-a)+a,t[1]=p*h*l+_*n,t[2]=_*h*l-p*n,t[3]=0,t[4]=h*p*l-_*n,t[5]=p*p*l+a,t[6]=_*p*l+h*n,t[7]=0,t[8]=h*_*l+p*n,t[9]=p*_*l-h*n,t[10]=_*_*l+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},pi.fromXRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},pi.fromYRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},pi.fromZRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},pi.fromRotationTranslation=w0,pi.fromQuat2=function(t,e){var i=new Nr.ARRAY_TYPE(3),n=-e[0],a=-e[1],l=-e[2],h=e[3],p=e[4],_=e[5],y=e[6],v=e[7],T=n*n+a*a+l*l+h*h;return T>0?(i[0]=2*(p*h+v*n+_*l-y*a)/T,i[1]=2*(_*h+v*a+y*n-p*l)/T,i[2]=2*(y*h+v*l+p*a-_*n)/T):(i[0]=2*(p*h+v*n+_*l-y*a),i[1]=2*(_*h+v*a+y*n-p*l),i[2]=2*(y*h+v*l+p*a-_*n)),w0(t,e,i),t},pi.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},pi.getScaling=T0,pi.getRotation=function(t,e){var i=new Nr.ARRAY_TYPE(3);T0(i,e);var n=1/i[0],a=1/i[1],l=1/i[2],h=e[0]*n,p=e[1]*a,_=e[2]*l,y=e[4]*n,v=e[5]*a,T=e[6]*l,A=e[8]*n,C=e[9]*a,R=e[10]*l,D=h+v+R,B=0;return D>0?(B=2*Math.sqrt(D+1),t[3]=.25*B,t[0]=(T-C)/B,t[1]=(A-_)/B,t[2]=(p-y)/B):h>v&&h>R?(B=2*Math.sqrt(1+h-v-R),t[3]=(T-C)/B,t[0]=.25*B,t[1]=(p+y)/B,t[2]=(A+_)/B):v>R?(B=2*Math.sqrt(1+v-h-R),t[3]=(A-_)/B,t[0]=(p+y)/B,t[1]=.25*B,t[2]=(T+C)/B):(B=2*Math.sqrt(1+R-h-v),t[3]=(p-y)/B,t[0]=(A+_)/B,t[1]=(T+C)/B,t[2]=.25*B),t},pi.fromRotationTranslationScale=function(t,e,i,n){var a=e[0],l=e[1],h=e[2],p=e[3],_=a+a,y=l+l,v=h+h,T=a*_,A=a*y,C=a*v,R=l*y,D=l*v,B=h*v,N=p*_,H=p*y,K=p*v,Y=n[0],ne=n[1],ie=n[2];return t[0]=(1-(R+B))*Y,t[1]=(A+K)*Y,t[2]=(C-H)*Y,t[3]=0,t[4]=(A-K)*ne,t[5]=(1-(T+B))*ne,t[6]=(D+N)*ne,t[7]=0,t[8]=(C+H)*ie,t[9]=(D-N)*ie,t[10]=(1-(T+R))*ie,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},pi.fromRotationTranslationScaleOrigin=function(t,e,i,n,a){var l=e[0],h=e[1],p=e[2],_=e[3],y=l+l,v=h+h,T=p+p,A=l*y,C=l*v,R=l*T,D=h*v,B=h*T,N=p*T,H=_*y,K=_*v,Y=_*T,ne=n[0],ie=n[1],ce=n[2],me=a[0],ye=a[1],Ee=a[2],xe=(1-(D+N))*ne,De=(C+Y)*ne,je=(R-K)*ne,Re=(C-Y)*ie,Ve=(1-(A+N))*ie,Me=(B+H)*ie,Ne=(R+K)*ce,nt=(B-H)*ce,Ge=(1-(A+D))*ce;return t[0]=xe,t[1]=De,t[2]=je,t[3]=0,t[4]=Re,t[5]=Ve,t[6]=Me,t[7]=0,t[8]=Ne,t[9]=nt,t[10]=Ge,t[11]=0,t[12]=i[0]+me-(xe*me+Re*ye+Ne*Ee),t[13]=i[1]+ye-(De*me+Ve*ye+nt*Ee),t[14]=i[2]+Ee-(je*me+Me*ye+Ge*Ee),t[15]=1,t},pi.fromQuat=function(t,e){var i=e[0],n=e[1],a=e[2],l=e[3],h=i+i,p=n+n,_=a+a,y=i*h,v=n*h,T=n*p,A=a*h,C=a*p,R=a*_,D=l*h,B=l*p,N=l*_;return t[0]=1-T-R,t[1]=v+N,t[2]=A-B,t[3]=0,t[4]=v-N,t[5]=1-y-R,t[6]=C+D,t[7]=0,t[8]=A+B,t[9]=C-D,t[10]=1-y-T,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},pi.frustum=function(t,e,i,n,a,l,h){var p=1/(i-e),_=1/(a-n),y=1/(l-h);return t[0]=2*l*p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*l*_,t[6]=0,t[7]=0,t[8]=(i+e)*p,t[9]=(a+n)*_,t[10]=(h+l)*y,t[11]=-1,t[12]=0,t[13]=0,t[14]=h*l*2*y,t[15]=0,t},pi.perspectiveNO=E0,pi.perspectiveZO=function(t,e,i,n,a){var l,h=1/Math.tan(e/2);return t[0]=h/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=a*(l=1/(n-a)),t[14]=a*n*l):(t[10]=-1,t[14]=-n),t},pi.perspectiveFromFieldOfView=function(t,e,i,n){var a=Math.tan(e.upDegrees*Math.PI/180),l=Math.tan(e.downDegrees*Math.PI/180),h=Math.tan(e.leftDegrees*Math.PI/180),p=Math.tan(e.rightDegrees*Math.PI/180),_=2/(h+p),y=2/(a+l);return t[0]=_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=y,t[6]=0,t[7]=0,t[8]=-(h-p)*_*.5,t[9]=(a-l)*y*.5,t[10]=n/(i-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*i/(i-n),t[15]=0,t},pi.orthoNO=S0,pi.orthoZO=function(t,e,i,n,a,l,h){var p=1/(e-i),_=1/(n-a),y=1/(l-h);return t[0]=-2*p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=y,t[11]=0,t[12]=(e+i)*p,t[13]=(a+n)*_,t[14]=l*y,t[15]=1,t},pi.lookAt=function(t,e,i,n){var a,l,h,p,_,y,v,T,A,C,R=e[0],D=e[1],B=e[2],N=n[0],H=n[1],K=n[2],Y=i[0],ne=i[1],ie=i[2];return Math.abs(R-Y)<Nr.EPSILON&&Math.abs(D-ne)<Nr.EPSILON&&Math.abs(B-ie)<Nr.EPSILON?v0(t):(v=R-Y,T=D-ne,A=B-ie,a=H*(A*=C=1/Math.hypot(v,T,A))-K*(T*=C),l=K*(v*=C)-N*A,h=N*T-H*v,(C=Math.hypot(a,l,h))?(a*=C=1/C,l*=C,h*=C):(a=0,l=0,h=0),p=T*h-A*l,_=A*a-v*h,y=v*l-T*a,(C=Math.hypot(p,_,y))?(p*=C=1/C,_*=C,y*=C):(p=0,_=0,y=0),t[0]=a,t[1]=p,t[2]=v,t[3]=0,t[4]=l,t[5]=_,t[6]=T,t[7]=0,t[8]=h,t[9]=y,t[10]=A,t[11]=0,t[12]=-(a*R+l*D+h*B),t[13]=-(p*R+_*D+y*B),t[14]=-(v*R+T*D+A*B),t[15]=1,t)},pi.targetTo=function(t,e,i,n){var a=e[0],l=e[1],h=e[2],p=n[0],_=n[1],y=n[2],v=a-i[0],T=l-i[1],A=h-i[2],C=v*v+T*T+A*A;C>0&&(v*=C=1/Math.sqrt(C),T*=C,A*=C);var R=_*A-y*T,D=y*v-p*A,B=p*T-_*v;return(C=R*R+D*D+B*B)>0&&(R*=C=1/Math.sqrt(C),D*=C,B*=C),t[0]=R,t[1]=D,t[2]=B,t[3]=0,t[4]=T*B-A*D,t[5]=A*R-v*B,t[6]=v*D-T*R,t[7]=0,t[8]=v,t[9]=T,t[10]=A,t[11]=0,t[12]=a,t[13]=l,t[14]=h,t[15]=1,t},pi.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},pi.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},pi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},pi.subtract=A0,pi.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},pi.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t[9]=e[9]+i[9]*n,t[10]=e[10]+i[10]*n,t[11]=e[11]+i[11]*n,t[12]=e[12]+i[12]*n,t[13]=e[13]+i[13]*n,t[14]=e[14]+i[14]*n,t[15]=e[15]+i[15]*n,t},pi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},pi.equals=function(t,e){var i=t[0],n=t[1],a=t[2],l=t[3],h=t[4],p=t[5],_=t[6],y=t[7],v=t[8],T=t[9],A=t[10],C=t[11],R=t[12],D=t[13],B=t[14],N=t[15],H=e[0],K=e[1],Y=e[2],ne=e[3],ie=e[4],ce=e[5],me=e[6],ye=e[7],Ee=e[8],xe=e[9],De=e[10],je=e[11],Re=e[12],Ve=e[13],Me=e[14],Ne=e[15];return Math.abs(i-H)<=Nr.EPSILON*Math.max(1,Math.abs(i),Math.abs(H))&&Math.abs(n-K)<=Nr.EPSILON*Math.max(1,Math.abs(n),Math.abs(K))&&Math.abs(a-Y)<=Nr.EPSILON*Math.max(1,Math.abs(a),Math.abs(Y))&&Math.abs(l-ne)<=Nr.EPSILON*Math.max(1,Math.abs(l),Math.abs(ne))&&Math.abs(h-ie)<=Nr.EPSILON*Math.max(1,Math.abs(h),Math.abs(ie))&&Math.abs(p-ce)<=Nr.EPSILON*Math.max(1,Math.abs(p),Math.abs(ce))&&Math.abs(_-me)<=Nr.EPSILON*Math.max(1,Math.abs(_),Math.abs(me))&&Math.abs(y-ye)<=Nr.EPSILON*Math.max(1,Math.abs(y),Math.abs(ye))&&Math.abs(v-Ee)<=Nr.EPSILON*Math.max(1,Math.abs(v),Math.abs(Ee))&&Math.abs(T-xe)<=Nr.EPSILON*Math.max(1,Math.abs(T),Math.abs(xe))&&Math.abs(A-De)<=Nr.EPSILON*Math.max(1,Math.abs(A),Math.abs(De))&&Math.abs(C-je)<=Nr.EPSILON*Math.max(1,Math.abs(C),Math.abs(je))&&Math.abs(R-Re)<=Nr.EPSILON*Math.max(1,Math.abs(R),Math.abs(Re))&&Math.abs(D-Ve)<=Nr.EPSILON*Math.max(1,Math.abs(D),Math.abs(Ve))&&Math.abs(B-Me)<=Nr.EPSILON*Math.max(1,Math.abs(B),Math.abs(Me))&&Math.abs(N-Ne)<=Nr.EPSILON*Math.max(1,Math.abs(N),Math.abs(Ne))},pi.sub=pi.mul=pi.ortho=pi.perspective=void 0;var Nr=function(t,e){if(t&&t.__esModule)return t;if(t===null||L_(t)!=="object"&&typeof t!="function")return{default:t};var i=x0(void 0);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,i&&i.set(t,n),n}(un);function x0(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(x0=function(n){return n?i:e})(t)}function v0(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function b0(t,e,i){var n=e[0],a=e[1],l=e[2],h=e[3],p=e[4],_=e[5],y=e[6],v=e[7],T=e[8],A=e[9],C=e[10],R=e[11],D=e[12],B=e[13],N=e[14],H=e[15],K=i[0],Y=i[1],ne=i[2],ie=i[3];return t[0]=K*n+Y*p+ne*T+ie*D,t[1]=K*a+Y*_+ne*A+ie*B,t[2]=K*l+Y*y+ne*C+ie*N,t[3]=K*h+Y*v+ne*R+ie*H,t[4]=(K=i[4])*n+(Y=i[5])*p+(ne=i[6])*T+(ie=i[7])*D,t[5]=K*a+Y*_+ne*A+ie*B,t[6]=K*l+Y*y+ne*C+ie*N,t[7]=K*h+Y*v+ne*R+ie*H,t[8]=(K=i[8])*n+(Y=i[9])*p+(ne=i[10])*T+(ie=i[11])*D,t[9]=K*a+Y*_+ne*A+ie*B,t[10]=K*l+Y*y+ne*C+ie*N,t[11]=K*h+Y*v+ne*R+ie*H,t[12]=(K=i[12])*n+(Y=i[13])*p+(ne=i[14])*T+(ie=i[15])*D,t[13]=K*a+Y*_+ne*A+ie*B,t[14]=K*l+Y*y+ne*C+ie*N,t[15]=K*h+Y*v+ne*R+ie*H,t}function w0(t,e,i){var n=e[0],a=e[1],l=e[2],h=e[3],p=n+n,_=a+a,y=l+l,v=n*p,T=n*_,A=n*y,C=a*_,R=a*y,D=l*y,B=h*p,N=h*_,H=h*y;return t[0]=1-(C+D),t[1]=T+H,t[2]=A-N,t[3]=0,t[4]=T-H,t[5]=1-(v+D),t[6]=R+B,t[7]=0,t[8]=A+N,t[9]=R-B,t[10]=1-(v+C),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function T0(t,e){var i=e[4],n=e[5],a=e[6],l=e[8],h=e[9],p=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,n,a),t[2]=Math.hypot(l,h,p),t}function E0(t,e,i,n,a){var l,h=1/Math.tan(e/2);return t[0]=h/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=(a+n)*(l=1/(n-a)),t[14]=2*a*n*l):(t[10]=-1,t[14]=-2*n),t}function S0(t,e,i,n,a,l,h){var p=1/(e-i),_=1/(n-a),y=1/(l-h);return t[0]=-2*p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*y,t[11]=0,t[12]=(e+i)*p,t[13]=(a+n)*_,t[14]=(h+l)*y,t[15]=1,t}function A0(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}pi.perspective=E0,pi.ortho=S0,pi.mul=b0,pi.sub=A0;var ci={},di={};function D_(t){return D_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D_(t)}Object.defineProperty(di,"__esModule",{value:!0}),di.create=I0,di.clone=function(t){var e=new ia.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},di.length=C0,di.fromValues=function(t,e,i){var n=new ia.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=i,n},di.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},di.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},di.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},di.subtract=P0,di.multiply=R0,di.divide=L0,di.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},di.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},di.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},di.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},di.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},di.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},di.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t},di.distance=D0,di.squaredDistance=z0,di.squaredLength=k0,di.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},di.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},di.normalize=function(t,e){var i=e[0],n=e[1],a=e[2],l=i*i+n*n+a*a;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t},di.dot=O0,di.cross=function(t,e,i){var n=e[0],a=e[1],l=e[2],h=i[0],p=i[1],_=i[2];return t[0]=a*_-l*p,t[1]=l*h-n*_,t[2]=n*p-a*h,t},di.lerp=function(t,e,i,n){var a=e[0],l=e[1],h=e[2];return t[0]=a+n*(i[0]-a),t[1]=l+n*(i[1]-l),t[2]=h+n*(i[2]-h),t},di.hermite=function(t,e,i,n,a,l){var h=l*l,p=h*(2*l-3)+1,_=h*(l-2)+l,y=h*(l-1),v=h*(3-2*l);return t[0]=e[0]*p+i[0]*_+n[0]*y+a[0]*v,t[1]=e[1]*p+i[1]*_+n[1]*y+a[1]*v,t[2]=e[2]*p+i[2]*_+n[2]*y+a[2]*v,t},di.bezier=function(t,e,i,n,a,l){var h=1-l,p=h*h,_=l*l,y=p*h,v=3*l*p,T=3*_*h,A=_*l;return t[0]=e[0]*y+i[0]*v+n[0]*T+a[0]*A,t[1]=e[1]*y+i[1]*v+n[1]*T+a[1]*A,t[2]=e[2]*y+i[2]*v+n[2]*T+a[2]*A,t},di.random=function(t,e){e=e||1;var i=2*ia.RANDOM()*Math.PI,n=2*ia.RANDOM()-1,a=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*a,t[1]=Math.sin(i)*a,t[2]=n*e,t},di.transformMat4=function(t,e,i){var n=e[0],a=e[1],l=e[2],h=i[3]*n+i[7]*a+i[11]*l+i[15];return t[0]=(i[0]*n+i[4]*a+i[8]*l+i[12])/(h=h||1),t[1]=(i[1]*n+i[5]*a+i[9]*l+i[13])/h,t[2]=(i[2]*n+i[6]*a+i[10]*l+i[14])/h,t},di.transformMat3=function(t,e,i){var n=e[0],a=e[1],l=e[2];return t[0]=n*i[0]+a*i[3]+l*i[6],t[1]=n*i[1]+a*i[4]+l*i[7],t[2]=n*i[2]+a*i[5]+l*i[8],t},di.transformQuat=function(t,e,i){var n=i[0],a=i[1],l=i[2],h=e[0],p=e[1],_=e[2],y=a*_-l*p,v=l*h-n*_,T=n*p-a*h,A=a*T-l*v,C=l*y-n*T,R=n*v-a*y,D=2*i[3];return v*=D,T*=D,C*=2,R*=2,t[0]=h+(y*=D)+(A*=2),t[1]=p+v+C,t[2]=_+T+R,t},di.rotateX=function(t,e,i,n){var a=[],l=[];return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],l[0]=a[0],l[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),l[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),t[0]=l[0]+i[0],t[1]=l[1]+i[1],t[2]=l[2]+i[2],t},di.rotateY=function(t,e,i,n){var a=[],l=[];return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],l[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),l[1]=a[1],l[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),t[0]=l[0]+i[0],t[1]=l[1]+i[1],t[2]=l[2]+i[2],t},di.rotateZ=function(t,e,i,n){var a=[],l=[];return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],l[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),l[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),l[2]=a[2],t[0]=l[0]+i[0],t[1]=l[1]+i[1],t[2]=l[2]+i[2],t},di.angle=function(t,e){var i=t[0],n=t[1],a=t[2],l=e[0],h=e[1],p=e[2],_=Math.sqrt(i*i+n*n+a*a)*Math.sqrt(l*l+h*h+p*p),y=_&&O0(t,e)/_;return Math.acos(Math.min(Math.max(y,-1),1))},di.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},di.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},di.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},di.equals=function(t,e){var i=t[0],n=t[1],a=t[2],l=e[0],h=e[1],p=e[2];return Math.abs(i-l)<=ia.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-h)<=ia.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-p)<=ia.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))},di.forEach=di.sqrLen=di.len=di.sqrDist=di.dist=di.div=di.mul=di.sub=void 0;var ia=function(t,e){if(t&&t.__esModule)return t;if(t===null||D_(t)!=="object"&&typeof t!="function")return{default:t};var i=M0(void 0);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,i&&i.set(t,n),n}(un);function M0(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(M0=function(n){return n?i:e})(t)}function I0(){var t=new ia.ARRAY_TYPE(3);return ia.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function C0(t){return Math.hypot(t[0],t[1],t[2])}function P0(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function R0(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function L0(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function D0(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function z0(t,e){var i=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return i*i+n*n+a*a}function k0(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n}function O0(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}di.sub=P0,di.mul=R0,di.div=L0,di.dist=D0,di.sqrDist=z0,di.len=C0,di.sqrLen=k0;var ra,SE=(ra=I0(),function(t,e,i,n,a,l){var h,p;for(e||(e=3),i||(i=0),p=n?Math.min(n*e+i,t.length):t.length,h=i;h<p;h+=e)ra[0]=t[h],ra[1]=t[h+1],ra[2]=t[h+2],a(ra,ra,l),t[h]=ra[0],t[h+1]=ra[1],t[h+2]=ra[2];return t});di.forEach=SE;var Ti={};function z_(t){return z_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z_(t)}Object.defineProperty(Ti,"__esModule",{value:!0}),Ti.create=F0,Ti.clone=function(t){var e=new ks.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ti.fromValues=function(t,e,i,n){var a=new ks.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=n,a},Ti.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ti.set=function(t,e,i,n,a){return t[0]=e,t[1]=i,t[2]=n,t[3]=a,t},Ti.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Ti.subtract=N0,Ti.multiply=V0,Ti.divide=U0,Ti.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Ti.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Ti.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},Ti.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},Ti.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Ti.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Ti.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},Ti.distance=j0,Ti.squaredDistance=G0,Ti.length=$0,Ti.squaredLength=q0,Ti.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Ti.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Ti.normalize=function(t,e){var i=e[0],n=e[1],a=e[2],l=e[3],h=i*i+n*n+a*a+l*l;return h>0&&(h=1/Math.sqrt(h)),t[0]=i*h,t[1]=n*h,t[2]=a*h,t[3]=l*h,t},Ti.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Ti.cross=function(t,e,i,n){var a=i[0]*n[1]-i[1]*n[0],l=i[0]*n[2]-i[2]*n[0],h=i[0]*n[3]-i[3]*n[0],p=i[1]*n[2]-i[2]*n[1],_=i[1]*n[3]-i[3]*n[1],y=i[2]*n[3]-i[3]*n[2],v=e[0],T=e[1],A=e[2],C=e[3];return t[0]=T*y-A*_+C*p,t[1]=-v*y+A*h-C*l,t[2]=v*_-T*h+C*a,t[3]=-v*p+T*l-A*a,t},Ti.lerp=function(t,e,i,n){var a=e[0],l=e[1],h=e[2],p=e[3];return t[0]=a+n*(i[0]-a),t[1]=l+n*(i[1]-l),t[2]=h+n*(i[2]-h),t[3]=p+n*(i[3]-p),t},Ti.random=function(t,e){var i,n,a,l,h,p;e=e||1;do h=(i=2*ks.RANDOM()-1)*i+(n=2*ks.RANDOM()-1)*n;while(h>=1);do p=(a=2*ks.RANDOM()-1)*a+(l=2*ks.RANDOM()-1)*l;while(p>=1);var _=Math.sqrt((1-h)/p);return t[0]=e*i,t[1]=e*n,t[2]=e*a*_,t[3]=e*l*_,t},Ti.transformMat4=function(t,e,i){var n=e[0],a=e[1],l=e[2],h=e[3];return t[0]=i[0]*n+i[4]*a+i[8]*l+i[12]*h,t[1]=i[1]*n+i[5]*a+i[9]*l+i[13]*h,t[2]=i[2]*n+i[6]*a+i[10]*l+i[14]*h,t[3]=i[3]*n+i[7]*a+i[11]*l+i[15]*h,t},Ti.transformQuat=function(t,e,i){var n=e[0],a=e[1],l=e[2],h=i[0],p=i[1],_=i[2],y=i[3],v=y*n+p*l-_*a,T=y*a+_*n-h*l,A=y*l+h*a-p*n,C=-h*n-p*a-_*l;return t[0]=v*y+C*-h+T*-_-A*-p,t[1]=T*y+C*-p+A*-h-v*-_,t[2]=A*y+C*-_+v*-p-T*-h,t[3]=e[3],t},Ti.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Ti.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Ti.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Ti.equals=function(t,e){var i=t[0],n=t[1],a=t[2],l=t[3],h=e[0],p=e[1],_=e[2],y=e[3];return Math.abs(i-h)<=ks.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-p)<=ks.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-_)<=ks.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(l-y)<=ks.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))},Ti.forEach=Ti.sqrLen=Ti.len=Ti.sqrDist=Ti.dist=Ti.div=Ti.mul=Ti.sub=void 0;var ks=function(t,e){if(t&&t.__esModule)return t;if(t===null||z_(t)!=="object"&&typeof t!="function")return{default:t};var i=B0(void 0);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,i&&i.set(t,n),n}(un);function B0(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(B0=function(n){return n?i:e})(t)}function F0(){var t=new ks.ARRAY_TYPE(4);return ks.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function N0(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function V0(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function U0(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function j0(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function G0(t,e){var i=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],l=e[3]-t[3];return i*i+n*n+a*a+l*l}function $0(t){return Math.hypot(t[0],t[1],t[2],t[3])}function q0(t){var e=t[0],i=t[1],n=t[2],a=t[3];return e*e+i*i+n*n+a*a}Ti.sub=N0,Ti.mul=V0,Ti.div=U0,Ti.dist=j0,Ti.sqrDist=G0,Ti.len=$0,Ti.sqrLen=q0;var AE=function(){var t=F0();return function(e,i,n,a,l,h){var p,_;for(i||(i=4),n||(n=0),_=a?Math.min(a*i+n,e.length):e.length,p=n;p<_;p+=i)t[0]=e[p],t[1]=e[p+1],t[2]=e[p+2],t[3]=e[p+3],l(t,t,h),e[p]=t[0],e[p+1]=t[1],e[p+2]=t[2],e[p+3]=t[3];return e}}();function k_(t){return k_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k_(t)}Ti.forEach=AE,Object.defineProperty(ci,"__esModule",{value:!0}),ci.create=O_,ci.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},ci.setAxisAngle=H0,ci.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),n=Math.sin(i/2);return n>ec.EPSILON?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),i},ci.getAngle=function(t,e){var i=Q0(t,e);return Math.acos(2*i*i-1)},ci.multiply=W0,ci.rotateX=function(t,e,i){i*=.5;var n=e[0],a=e[1],l=e[2],h=e[3],p=Math.sin(i),_=Math.cos(i);return t[0]=n*_+h*p,t[1]=a*_+l*p,t[2]=l*_-a*p,t[3]=h*_-n*p,t},ci.rotateY=function(t,e,i){i*=.5;var n=e[0],a=e[1],l=e[2],h=e[3],p=Math.sin(i),_=Math.cos(i);return t[0]=n*_-l*p,t[1]=a*_+h*p,t[2]=l*_+n*p,t[3]=h*_-a*p,t},ci.rotateZ=function(t,e,i){i*=.5;var n=e[0],a=e[1],l=e[2],h=e[3],p=Math.sin(i),_=Math.cos(i);return t[0]=n*_+a*p,t[1]=a*_-n*p,t[2]=l*_+h*p,t[3]=h*_-l*p,t},ci.calculateW=function(t,e){var i=e[0],n=e[1],a=e[2];return t[0]=i,t[1]=n,t[2]=a,t[3]=Math.sqrt(Math.abs(1-i*i-n*n-a*a)),t},ci.exp=X0,ci.ln=Y0,ci.pow=function(t,e,i){return Y0(t,e),J0(t,t,i),X0(t,t),t},ci.slerp=hp,ci.random=function(t){var e=ec.RANDOM(),i=ec.RANDOM(),n=ec.RANDOM(),a=Math.sqrt(1-e),l=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*i),t[1]=a*Math.cos(2*Math.PI*i),t[2]=l*Math.sin(2*Math.PI*n),t[3]=l*Math.cos(2*Math.PI*n),t},ci.invert=function(t,e){var i=e[0],n=e[1],a=e[2],l=e[3],h=i*i+n*n+a*a+l*l,p=h?1/h:0;return t[0]=-i*p,t[1]=-n*p,t[2]=-a*p,t[3]=l*p,t},ci.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},ci.fromMat3=K0,ci.fromEuler=function(t,e,i,n){var a=.5*Math.PI/180;e*=a,i*=a,n*=a;var l=Math.sin(e),h=Math.cos(e),p=Math.sin(i),_=Math.cos(i),y=Math.sin(n),v=Math.cos(n);return t[0]=l*_*v-h*p*y,t[1]=h*p*v+l*_*y,t[2]=h*_*y-l*p*v,t[3]=h*_*v+l*p*y,t},ci.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},ci.setAxes=ci.sqlerp=ci.rotationTo=ci.equals=ci.exactEquals=ci.normalize=ci.sqrLen=ci.squaredLength=ci.len=ci.length=ci.lerp=ci.dot=ci.scale=ci.mul=ci.add=ci.set=ci.copy=ci.fromValues=ci.clone=void 0;var ec=up(un),ME=up(lr),na=up(di),Es=up(Ti);function Z0(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Z0=function(n){return n?i:e})(t)}function up(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||k_(t)!=="object"&&typeof t!="function")return{default:t};var i=Z0(e);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,i&&i.set(t,n),n}function O_(){var t=new ec.ARRAY_TYPE(4);return ec.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function H0(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t}function W0(t,e,i){var n=e[0],a=e[1],l=e[2],h=e[3],p=i[0],_=i[1],y=i[2],v=i[3];return t[0]=n*v+h*p+a*y-l*_,t[1]=a*v+h*_+l*p-n*y,t[2]=l*v+h*y+n*_-a*p,t[3]=h*v-n*p-a*_-l*y,t}function X0(t,e){var i=e[0],n=e[1],a=e[2],l=e[3],h=Math.sqrt(i*i+n*n+a*a),p=Math.exp(l),_=h>0?p*Math.sin(h)/h:0;return t[0]=i*_,t[1]=n*_,t[2]=a*_,t[3]=p*Math.cos(h),t}function Y0(t,e){var i=e[0],n=e[1],a=e[2],l=e[3],h=Math.sqrt(i*i+n*n+a*a),p=h>0?Math.atan2(h,l)/h:0;return t[0]=i*p,t[1]=n*p,t[2]=a*p,t[3]=.5*Math.log(i*i+n*n+a*a+l*l),t}function hp(t,e,i,n){var a,l,h,p,_,y=e[0],v=e[1],T=e[2],A=e[3],C=i[0],R=i[1],D=i[2],B=i[3];return(l=y*C+v*R+T*D+A*B)<0&&(l=-l,C=-C,R=-R,D=-D,B=-B),1-l>ec.EPSILON?(a=Math.acos(l),h=Math.sin(a),p=Math.sin((1-n)*a)/h,_=Math.sin(n*a)/h):(p=1-n,_=n),t[0]=p*y+_*C,t[1]=p*v+_*R,t[2]=p*T+_*D,t[3]=p*A+_*B,t}function K0(t,e){var i,n=e[0]+e[4]+e[8];if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var l=(a+1)%3,h=(a+2)%3;i=Math.sqrt(e[3*a+a]-e[3*l+l]-e[3*h+h]+1),t[a]=.5*i,t[3]=(e[3*l+h]-e[3*h+l])*(i=.5/i),t[l]=(e[3*l+a]+e[3*a+l])*i,t[h]=(e[3*h+a]+e[3*a+h])*i}return t}ci.clone=Es.clone,ci.fromValues=Es.fromValues,ci.copy=Es.copy,ci.set=Es.set,ci.add=Es.add,ci.mul=W0;var J0=Es.scale;ci.scale=J0;var Q0=Es.dot;ci.dot=Q0,ci.lerp=Es.lerp;var ex=Es.length;ci.length=ex,ci.len=ex;var tx=Es.squaredLength;ci.squaredLength=tx,ci.sqrLen=tx;var B_=Es.normalize;ci.normalize=B_,ci.exactEquals=Es.exactEquals,ci.equals=Es.equals;var Ws,ix,rx,IE=(Ws=na.create(),ix=na.fromValues(1,0,0),rx=na.fromValues(0,1,0),function(t,e,i){var n=na.dot(e,i);return n<-.999999?(na.cross(Ws,ix,e),na.len(Ws)<1e-6&&na.cross(Ws,rx,e),na.normalize(Ws,Ws),H0(t,Ws,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(na.cross(Ws,e,i),t[0]=Ws[0],t[1]=Ws[1],t[2]=Ws[2],t[3]=1+n,B_(t,t))});ci.rotationTo=IE;var F_,N_,CE=(F_=O_(),N_=O_(),function(t,e,i,n,a,l){return hp(F_,e,a,l),hp(N_,i,n,l),hp(t,F_,N_,2*l*(1-l)),t});ci.sqlerp=CE;var Xs,PE=(Xs=ME.create(),function(t,e,i,n){return Xs[0]=i[0],Xs[3]=i[1],Xs[6]=i[2],Xs[1]=n[0],Xs[4]=n[1],Xs[7]=n[2],Xs[2]=-e[0],Xs[5]=-e[1],Xs[8]=-e[2],B_(t,K0(t,Xs))});ci.setAxes=PE;var Ci={};function V_(t){return V_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V_(t)}Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.create=function(){var t=new is.ARRAY_TYPE(8);return is.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Ci.clone=function(t){var e=new is.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Ci.fromValues=function(t,e,i,n,a,l,h,p){var _=new is.ARRAY_TYPE(8);return _[0]=t,_[1]=e,_[2]=i,_[3]=n,_[4]=a,_[5]=l,_[6]=h,_[7]=p,_},Ci.fromRotationTranslationValues=function(t,e,i,n,a,l,h){var p=new is.ARRAY_TYPE(8);p[0]=t,p[1]=e,p[2]=i,p[3]=n;var _=.5*a,y=.5*l,v=.5*h;return p[4]=_*n+y*i-v*e,p[5]=y*n+v*t-_*i,p[6]=v*n+_*e-y*t,p[7]=-_*t-y*e-v*i,p},Ci.fromRotationTranslation=ox,Ci.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Ci.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Ci.fromMat4=function(t,e){var i=sa.create();nx.getRotation(i,e);var n=new is.ARRAY_TYPE(3);return nx.getTranslation(n,e),ox(t,i,n),t},Ci.copy=ax,Ci.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Ci.set=function(t,e,i,n,a,l,h,p,_){return t[0]=e,t[1]=i,t[2]=n,t[3]=a,t[4]=l,t[5]=h,t[6]=p,t[7]=_,t},Ci.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Ci.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Ci.getTranslation=function(t,e){var i=e[4],n=e[5],a=e[6],l=e[7],h=-e[0],p=-e[1],_=-e[2],y=e[3];return t[0]=2*(i*y+l*h+n*_-a*p),t[1]=2*(n*y+l*p+a*h-i*_),t[2]=2*(a*y+l*_+i*p-n*h),t},Ci.translate=function(t,e,i){var n=e[0],a=e[1],l=e[2],h=e[3],p=.5*i[0],_=.5*i[1],y=.5*i[2],v=e[4],T=e[5],A=e[6],C=e[7];return t[0]=n,t[1]=a,t[2]=l,t[3]=h,t[4]=h*p+a*y-l*_+v,t[5]=h*_+l*p-n*y+T,t[6]=h*y+n*_-a*p+A,t[7]=-n*p-a*_-l*y+C,t},Ci.rotateX=function(t,e,i){var n=-e[0],a=-e[1],l=-e[2],h=e[3],p=e[4],_=e[5],y=e[6],v=e[7],T=p*h+v*n+_*l-y*a,A=_*h+v*a+y*n-p*l,C=y*h+v*l+p*a-_*n,R=v*h-p*n-_*a-y*l;return sa.rotateX(t,e,i),t[4]=T*(h=t[3])+R*(n=t[0])+A*(l=t[2])-C*(a=t[1]),t[5]=A*h+R*a+C*n-T*l,t[6]=C*h+R*l+T*a-A*n,t[7]=R*h-T*n-A*a-C*l,t},Ci.rotateY=function(t,e,i){var n=-e[0],a=-e[1],l=-e[2],h=e[3],p=e[4],_=e[5],y=e[6],v=e[7],T=p*h+v*n+_*l-y*a,A=_*h+v*a+y*n-p*l,C=y*h+v*l+p*a-_*n,R=v*h-p*n-_*a-y*l;return sa.rotateY(t,e,i),t[4]=T*(h=t[3])+R*(n=t[0])+A*(l=t[2])-C*(a=t[1]),t[5]=A*h+R*a+C*n-T*l,t[6]=C*h+R*l+T*a-A*n,t[7]=R*h-T*n-A*a-C*l,t},Ci.rotateZ=function(t,e,i){var n=-e[0],a=-e[1],l=-e[2],h=e[3],p=e[4],_=e[5],y=e[6],v=e[7],T=p*h+v*n+_*l-y*a,A=_*h+v*a+y*n-p*l,C=y*h+v*l+p*a-_*n,R=v*h-p*n-_*a-y*l;return sa.rotateZ(t,e,i),t[4]=T*(h=t[3])+R*(n=t[0])+A*(l=t[2])-C*(a=t[1]),t[5]=A*h+R*a+C*n-T*l,t[6]=C*h+R*l+T*a-A*n,t[7]=R*h-T*n-A*a-C*l,t},Ci.rotateByQuatAppend=function(t,e,i){var n=i[0],a=i[1],l=i[2],h=i[3],p=e[0],_=e[1],y=e[2],v=e[3];return t[0]=p*h+v*n+_*l-y*a,t[1]=_*h+v*a+y*n-p*l,t[2]=y*h+v*l+p*a-_*n,t[3]=v*h-p*n-_*a-y*l,t[4]=(p=e[4])*h+(v=e[7])*n+(_=e[5])*l-(y=e[6])*a,t[5]=_*h+v*a+y*n-p*l,t[6]=y*h+v*l+p*a-_*n,t[7]=v*h-p*n-_*a-y*l,t},Ci.rotateByQuatPrepend=function(t,e,i){var n=e[0],a=e[1],l=e[2],h=e[3],p=i[0],_=i[1],y=i[2],v=i[3];return t[0]=n*v+h*p+a*y-l*_,t[1]=a*v+h*_+l*p-n*y,t[2]=l*v+h*y+n*_-a*p,t[3]=h*v-n*p-a*_-l*y,t[4]=n*(v=i[7])+h*(p=i[4])+a*(y=i[6])-l*(_=i[5]),t[5]=a*v+h*_+l*p-n*y,t[6]=l*v+h*y+n*_-a*p,t[7]=h*v-n*p-a*_-l*y,t},Ci.rotateAroundAxis=function(t,e,i,n){if(Math.abs(n)<is.EPSILON)return ax(t,e);var a=Math.hypot(i[0],i[1],i[2]);n*=.5;var l=Math.sin(n),h=l*i[0]/a,p=l*i[1]/a,_=l*i[2]/a,y=Math.cos(n),v=e[0],T=e[1],A=e[2],C=e[3];t[0]=v*y+C*h+T*_-A*p,t[1]=T*y+C*p+A*h-v*_,t[2]=A*y+C*_+v*p-T*h,t[3]=C*y-v*h-T*p-A*_;var R=e[4],D=e[5],B=e[6],N=e[7];return t[4]=R*y+N*h+D*_-B*p,t[5]=D*y+N*p+B*h-R*_,t[6]=B*y+N*_+R*p-D*h,t[7]=N*y-R*h-D*p-B*_,t},Ci.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},Ci.multiply=lx,Ci.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},Ci.lerp=function(t,e,i,n){var a=1-n;return cx(e,i)<0&&(n=-n),t[0]=e[0]*a+i[0]*n,t[1]=e[1]*a+i[1]*n,t[2]=e[2]*a+i[2]*n,t[3]=e[3]*a+i[3]*n,t[4]=e[4]*a+i[4]*n,t[5]=e[5]*a+i[5]*n,t[6]=e[6]*a+i[6]*n,t[7]=e[7]*a+i[7]*n,t},Ci.invert=function(t,e){var i=dp(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},Ci.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Ci.normalize=function(t,e){var i=dp(e);if(i>0){i=Math.sqrt(i);var n=e[0]/i,a=e[1]/i,l=e[2]/i,h=e[3]/i,p=e[4],_=e[5],y=e[6],v=e[7],T=n*p+a*_+l*y+h*v;t[0]=n,t[1]=a,t[2]=l,t[3]=h,t[4]=(p-n*T)/i,t[5]=(_-a*T)/i,t[6]=(y-l*T)/i,t[7]=(v-h*T)/i}return t},Ci.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Ci.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Ci.equals=function(t,e){var i=t[0],n=t[1],a=t[2],l=t[3],h=t[4],p=t[5],_=t[6],y=t[7],v=e[0],T=e[1],A=e[2],C=e[3],R=e[4],D=e[5],B=e[6],N=e[7];return Math.abs(i-v)<=is.EPSILON*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(n-T)<=is.EPSILON*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(a-A)<=is.EPSILON*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(l-C)<=is.EPSILON*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(h-R)<=is.EPSILON*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(p-D)<=is.EPSILON*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(_-B)<=is.EPSILON*Math.max(1,Math.abs(_),Math.abs(B))&&Math.abs(y-N)<=is.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))},Ci.sqrLen=Ci.squaredLength=Ci.len=Ci.length=Ci.dot=Ci.mul=Ci.setReal=Ci.getReal=void 0;var is=U_(un),sa=U_(ci),nx=U_(pi);function sx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(sx=function(n){return n?i:e})(t)}function U_(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||V_(t)!=="object"&&typeof t!="function")return{default:t};var i=sx(e);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,i&&i.set(t,n),n}function ox(t,e,i){var n=.5*i[0],a=.5*i[1],l=.5*i[2],h=e[0],p=e[1],_=e[2],y=e[3];return t[0]=h,t[1]=p,t[2]=_,t[3]=y,t[4]=n*y+a*_-l*p,t[5]=a*y+l*h-n*_,t[6]=l*y+n*p-a*h,t[7]=-n*h-a*p-l*_,t}function ax(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function lx(t,e,i){var n=e[0],a=e[1],l=e[2],h=e[3],p=i[4],_=i[5],y=i[6],v=i[7],T=e[4],A=e[5],C=e[6],R=e[7],D=i[0],B=i[1],N=i[2],H=i[3];return t[0]=n*H+h*D+a*N-l*B,t[1]=a*H+h*B+l*D-n*N,t[2]=l*H+h*N+n*B-a*D,t[3]=h*H-n*D-a*B-l*N,t[4]=n*v+h*p+a*y-l*_+T*H+R*D+A*N-C*B,t[5]=a*v+h*_+l*p-n*y+A*H+R*B+C*D-T*N,t[6]=l*v+h*y+n*_-a*p+C*H+R*N+T*B-A*D,t[7]=h*v-n*p-a*_-l*y+R*H-T*D-A*B-C*N,t}Ci.getReal=sa.copy,Ci.setReal=sa.copy,Ci.mul=lx;var cx=sa.dot;Ci.dot=cx;var ux=sa.length;Ci.length=ux,Ci.len=ux;var dp=sa.squaredLength;Ci.squaredLength=dp,Ci.sqrLen=dp;var yi={};function j_(t){return j_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j_(t)}Object.defineProperty(yi,"__esModule",{value:!0}),yi.create=dx,yi.clone=function(t){var e=new tc.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},yi.fromValues=function(t,e){var i=new tc.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},yi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},yi.set=function(t,e,i){return t[0]=e,t[1]=i,t},yi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},yi.subtract=fx,yi.multiply=px,yi.divide=mx,yi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},yi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},yi.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},yi.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},yi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},yi.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},yi.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t},yi.distance=_x,yi.squaredDistance=gx,yi.length=yx,yi.squaredLength=xx,yi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},yi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},yi.normalize=function(t,e){var i=e[0],n=e[1],a=i*i+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t},yi.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},yi.cross=function(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t},yi.lerp=function(t,e,i,n){var a=e[0],l=e[1];return t[0]=a+n*(i[0]-a),t[1]=l+n*(i[1]-l),t},yi.random=function(t,e){e=e||1;var i=2*tc.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},yi.transformMat2=function(t,e,i){var n=e[0],a=e[1];return t[0]=i[0]*n+i[2]*a,t[1]=i[1]*n+i[3]*a,t},yi.transformMat2d=function(t,e,i){var n=e[0],a=e[1];return t[0]=i[0]*n+i[2]*a+i[4],t[1]=i[1]*n+i[3]*a+i[5],t},yi.transformMat3=function(t,e,i){var n=e[0],a=e[1];return t[0]=i[0]*n+i[3]*a+i[6],t[1]=i[1]*n+i[4]*a+i[7],t},yi.transformMat4=function(t,e,i){var n=e[0],a=e[1];return t[0]=i[0]*n+i[4]*a+i[12],t[1]=i[1]*n+i[5]*a+i[13],t},yi.rotate=function(t,e,i,n){var a=e[0]-i[0],l=e[1]-i[1],h=Math.sin(n),p=Math.cos(n);return t[0]=a*p-l*h+i[0],t[1]=a*h+l*p+i[1],t},yi.angle=function(t,e){var i=t[0],n=t[1],a=e[0],l=e[1],h=Math.sqrt(i*i+n*n)*Math.sqrt(a*a+l*l);return Math.acos(Math.min(Math.max(h&&(i*a+n*l)/h,-1),1))},yi.zero=function(t){return t[0]=0,t[1]=0,t},yi.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},yi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},yi.equals=function(t,e){var i=t[0],n=t[1],a=e[0],l=e[1];return Math.abs(i-a)<=tc.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=tc.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))},yi.forEach=yi.sqrLen=yi.sqrDist=yi.dist=yi.div=yi.mul=yi.sub=yi.len=void 0;var tc=function(t,e){if(t&&t.__esModule)return t;if(t===null||j_(t)!=="object"&&typeof t!="function")return{default:t};var i=hx(void 0);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,i&&i.set(t,n),n}(un);function hx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(hx=function(n){return n?i:e})(t)}function dx(){var t=new tc.ARRAY_TYPE(2);return tc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function fx(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function px(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function mx(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function _x(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function gx(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n}function yx(t){return Math.hypot(t[0],t[1])}function xx(t){var e=t[0],i=t[1];return e*e+i*i}yi.len=yx,yi.sub=fx,yi.mul=px,yi.div=mx,yi.dist=_x,yi.sqrDist=gx,yi.sqrLen=xx;var RE=function(){var t=dx();return function(e,i,n,a,l,h){var p,_;for(i||(i=2),n||(n=0),_=a?Math.min(a*i+n,e.length):e.length,p=n;p<_;p+=i)t[0]=e[p],t[1]=e[p+1],l(t,t,h),e[p]=t[0],e[p+1]=t[1];return e}}();function G_(t){return G_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G_(t)}yi.forEach=RE,Object.defineProperty(cn,"__esModule",{value:!0}),o.a7=cn.vec4=o.N=cn.vec3=cn.vec2=cn.quat2=o.bi=cn.quat=o.a6=cn.mat4=o.co=cn.mat3=cn.mat2d=o.b4=cn.mat2=cn.glMatrix=void 0;var LE=Po(un);cn.glMatrix=LE;var DE=Po(Lr);o.b4=cn.mat2=DE;var zE=Po(zr);cn.mat2d=zE;var kE=Po(lr);o.co=cn.mat3=kE;var OE=Po(pi);o.a6=cn.mat4=OE;var BE=Po(ci);o.bi=cn.quat=BE;var FE=Po(Ci);cn.quat2=FE;var NE=Po(yi);cn.vec2=NE;var VE=Po(di);o.N=cn.vec3=VE;var UE=Po(Ti);function vx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(vx=function(n){return n?i:e})(t)}function Po(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||G_(t)!=="object"&&typeof t!="function")return{default:t};var i=vx(e);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,i&&i.set(t,n),n}o.a7=cn.vec4=UE;class $_{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,n){const a=o.N.dot(i,this.dir);if(Math.abs(a)<1e-6)return!1;const l=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/a;return n[0]=this.pos[0]+this.dir[0]*l,n[1]=this.pos[1]+this.dir[1]*l,n[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,i,n){if(o.N.equals(this.pos,e)||i===0)return n[0]=n[1]=n[2]=0,!1;const[a,l,h]=this.dir,p=this.pos[0]-e[0],_=this.pos[1]-e[1],y=this.pos[2]-e[2],v=a*a+l*l+h*h,T=2*(p*a+_*l+y*h),A=T*T-4*v*(p*p+_*_+y*y-i*i);if(A<0){const C=Math.max(-T/2,0),R=p+a*C,D=_+l*C,B=y+h*C,N=Math.hypot(R,D,B);return n[0]=R*i/N,n[1]=D*i/N,n[2]=B*i/N,!1}{const C=(-T-Math.sqrt(A))/(2*v);if(C<0){const R=Math.hypot(p,_,y);return n[0]=p*i/R,n[1]=_*i/R,n[2]=y*i/R,!1}return n[0]=p+a*C,n[1]=_+l*C,n[2]=y+h*C,!0}}}class q_{constructor(e,i,n,a,l){this.TL=e,this.TR=i,this.BR=n,this.BL=a,this.horizon=l}static fromInvProjectionMatrix(e,i,n){const a=[-1,1,1],l=[1,1,1],h=[1,-1,1],p=[-1,-1,1],_=o.N.transformMat4(a,a,e),y=o.N.transformMat4(l,l,e),v=o.N.transformMat4(h,h,e),T=o.N.transformMat4(p,p,e);return new q_(_,y,v,T,i/n)}}function fd(t,e,i){let n=1/0,a=-1/0;const l=[];for(const h of t){o.N.sub(l,h,e);const p=o.N.dot(l,i);n=Math.min(n,p),a=Math.max(a,p)}return[n,a]}function bx(t,e){let i=!0;for(let n=0;n<t.planes.length;n++){const a=t.planes[n];let l=0;for(let h=0;h<e.length;h++)l+=o.N.dot(a,e[h])+a[3]>=0;if(l===0)return 0;l!==e.length&&(i=!1)}return i?2:1}function wx(t,e){for(const i of t.projections){const n=fd(e,t.points[0],i.axis);if(i.projection[1]<n[0]||i.projection[0]>n[1])return 0}return 1}function Tx(t,e){let i=0;const n=[0,0,0,0];for(let a=0;a<t.length;a++)n[0]=t[a][0],n[1]=t[a][1],n[2]=t[a][2],n[3]=1,o.a7.dot(n,e)>=0&&i++;return i}class Z_{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=kr.fromPoints(this.points),this.projections=[],this.frustumEdges=[o.N.sub([],this.points[2],this.points[3]),o.N.sub([],this.points[0],this.points[3]),o.N.sub([],this.points[4],this.points[0]),o.N.sub([],this.points[5],this.points[1]),o.N.sub([],this.points[6],this.points[2]),o.N.sub([],this.points[7],this.points[3])];for(const n of this.frustumEdges){const a=[0,-n[2],n[1]],l=[n[2],0,-n[0]];this.projections.push({axis:a,projection:fd(this.points,this.points[0],a)}),this.projections.push({axis:l,projection:fd(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,i,n,a){const l=Math.pow(2,n),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{const v=o.a7.transformMat4([],y,e),T=1/v[3]/i*l;return o.a7.mul(v,v,[T,T,a?1/v[3]:T,T])}),p=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{const v=o.N.sub([],h[y[0]],h[y[1]]),T=o.N.sub([],h[y[2]],h[y[1]]),A=o.N.normalize([],o.N.cross([],v,T)),C=-o.N.dot(A,h[y[1]]);return A.concat(C)}),_=[];for(let y=0;y<h.length;y++)_.push([h[y][0],h[y][1],h[y][2]]);return new Z_(_,p)}intersectsPrecise(e,i,n){for(let a=0;a<i.length;a++)if(!Tx(e,i[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!Tx(e,this.planes[a]))return 0;for(const a of n)for(const l of this.frustumEdges){const h=o.N.cross([],a,l),p=o.N.length(h);if(p===0)continue;o.N.scale(h,h,1/p);const _=fd(this.points,this.points[0],h),y=fd(e,this.points[0],h);if(_[0]>y[1]||y[0]>_[1])return 0}return 1}}class kr{static fromPoints(e){const i=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const a of e)o.N.min(i,i,a),o.N.max(n,n,a);return new kr(i,n)}static fromTileIdAndHeight(e,i,n){const a=1<<e.canonical.z,l=e.canonical.x,h=e.canonical.y;return new kr([l/a,h/a,i],[(l+1)/a,(h+1)/a,n])}static applyTransform(e,i){const n=e.getCorners();for(let a=0;a<n.length;++a)o.N.transformMat4(n[a],n[a],i);return kr.fromPoints(n)}static projectAabbCorners(e,i){const n=e.getCorners();for(let a=0;a<n.length;++a)o.N.transformMat4(n[a],n[a],i);return n}constructor(e,i){this.min=e,this.max=i,this.center=o.N.scale([],o.N.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],n=o.N.clone(this.min),a=o.N.clone(this.max);for(let l=0;l<i.length;l++)n[l]=i[l]?this.min[l]:this.center[l],a[l]=i[l]?this.center[l]:this.max[l];return a[2]=this.max[2],new kr(n,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?bx(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?bx(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?wx(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?wx(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}wt(kr,"Aabb");const jE=Ki([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:fp}=jE,GE=Ki([{name:"a_pos_3",components:3,type:"Int16"}]);var Ex=Ki([{name:"a_pos",type:"Int16",components:2}]);function pp(t){return t*W/Pe}const $E=[new kr([fe,fe,fe],[Te,Te,Te]),new kr([fe,fe,fe],[0,0,Te]),new kr([0,fe,fe],[Te,0,Te]),new kr([fe,0,fe],[0,Te,Te]),new kr([0,0,fe],[Te,Te,Te])];function Sx(t,e,i,n=!0){const a=o.N.scale([],t._camera.position,t.worldSize),l=[e,i,1,1];o.a7.transformMat4(l,l,t.pixelMatrixInverse),o.a7.scale(l,l,1/l[3]);const h=o.N.sub([],l,a),p=o.N.normalize([],h),_=t.globeMatrix,y=[_[12],_[13],_[14]],v=o.N.sub([],y,a),T=o.N.length(v),A=o.N.normalize([],v),C=t.worldSize/(2*Math.PI),R=o.N.dot(A,p),D=Math.asin(C/T);if(D<Math.acos(R)){if(!n)return null;const xe=[],De=[];o.N.scale(xe,p,T/R),o.N.normalize(De,o.N.sub(De,xe,v)),o.N.normalize(p,o.N.add(p,v,o.N.scale(p,De,Math.tan(D)*T)))}const B=[];new $_(a,p).closestPointOnSphere(y,C,B);const N=o.N.normalize([],te(_,0)),H=o.N.normalize([],te(_,1)),K=o.N.normalize([],te(_,2)),Y=o.N.dot(N,B),ne=o.N.dot(H,B),ie=o.N.dot(K,B),ce=br(Math.asin(-ne/C));let me=br(Math.atan2(Y,ie));me=t.center.lng+function(xe,De){const je=(De-xe+180)%360-180;return je<-180?je+360:je}(t.center.lng,me);const ye=hi(me),Ee=zt(Qt(ce),0,1);return new Di(ye,Ee)}class qE{constructor(e,i,n){this.a=o.N.sub([],e,n),this.b=o.N.sub([],i,n),this.center=n;const a=o.N.normalize([],this.a),l=o.N.normalize([],this.b);this.angle=Math.acos(o.N.dot(a,l))}}function H_(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(n,a,l,h){const p=Math.sin(l);return n*(Math.sin((1-h)*l)/p)+a*(Math.sin(h*l)/p)}(t.a[e],t.b[e],t.angle,zt(i,0,1))+t.center[e]}function Ro(t){if(t.z<=1)return $E[t.z+2*t.y+t.x];const e=W_(mp(t));return kr.fromPoints(e)}function oa(t,e,i){return o.N.scale(t,t,1-i),o.N.scaleAndAdd(t,t,e,i)}function Ax(t,e,i){for(const n of t)o.N.transformMat4(n,n,e),o.N.scale(n,n,i)}function Mx(t,e,i,n){const a=e/t.worldSize,l=t.globeMatrix;if(i.z<=1){const ye=Ro(i).getCorners();return Ax(ye,l,a),kr.fromPoints(ye)}const h=mp(i,n),p=W_(h,W+pp(t._tileCoverLift));Ax(p,l,a);const _=Number.MAX_VALUE,y=[-_,-_,-_],v=[_,_,_];if(h.contains(t.center)){for(const xe of p)o.N.min(v,v,xe),o.N.max(y,y,xe);y[2]=0;const ye=t.point,Ee=[ye.x*a,ye.y*a,0];return o.N.min(v,v,Ee),o.N.max(y,y,Ee),new kr(v,y)}if(t._tileCoverLift>0){for(const ye of p)o.N.min(v,v,ye),o.N.max(y,y,ye);return new kr(v,y)}const T=[l[12]*a,l[13]*a,l[14]*a],A=h.getCenter(),C=zt(t.center.lat,-xi,xi),R=zt(A.lat,-xi,xi),D=hi(t.center.lng),B=Qt(C);let N=D-hi(A.lng);const H=B-Qt(R);N>.5?N-=1:N<-.5&&(N+=1);let K=0;if(Math.abs(N)>Math.abs(H))K=N>=0?1:3;else{K=H>=0?0:2;const ye=[l[4]*a,l[5]*a,l[6]*a],Ee=-Math.sin(ni(H>=0?h.getSouth():h.getNorth()))*W;o.N.scaleAndAdd(T,T,ye,Ee)}const Y=p[K],ne=p[(K+1)%4],ie=new qE(Y,ne,T),ce=[H_(ie,0)||Y[0],H_(ie,1)||Y[1],H_(ie,2)||Y[2]],me=Va(t.zoom);if(me>0){const ye=function({x:xe,y:De,z:je},Re,Ve,Me,Ne){const nt=1/(1<<je);let Ge=xe*nt,Mt=Ge+nt,xt=De*nt,He=xt+nt,Xt=0;const Dt=(Ge+Mt)/2-Me;return Dt>.5?Xt=-1:Dt<-.5&&(Xt=1),Ge=((Ge+Xt)*Re-(Me*=Re))*Ve+Me,Mt=((Mt+Xt)*Re-Me)*Ve+Me,xt=(xt*Re-(Ne*=Re))*Ve+Ne,He=(He*Re-Ne)*Ve+Ne,[[Ge,He,0],[Mt,He,0],[Mt,xt,0],[Ge,xt,0]]}(i,e,t._pixelsPerMercatorPixel,D,B);for(let xe=0;xe<p.length;xe++)oa(p[xe],ye[xe],me);const Ee=o.N.add([],ye[K],ye[(K+1)%4]);o.N.scale(Ee,Ee,.5),oa(ce,Ee,me)}for(const ye of p)o.N.min(v,v,ye),o.N.max(y,y,ye);return v[2]=Math.min(Y[2],ne[2]),o.N.min(v,v,ce),o.N.max(y,y,ce),new kr(v,y)}function mp({x:t,y:e,z:i},n=!1){const a=1/(1<<i),l=new ge(oi(t*a),e===(1<<i)-1&&n?-90:Ii((e+1)*a)),h=new ge(oi((t+1)*a),e===0&&n?90:Ii(e*a));return new Ae(l,h)}function W_(t,e=W){const i=ni(t.getNorth()),n=ni(t.getSouth()),a=Math.cos(i),l=Math.cos(n),h=Math.sin(i),p=Math.sin(n),_=t.getWest(),y=t.getEast();return[_e(l,p,_,e),_e(l,p,y,e),_e(a,h,y,e),_e(a,h,_,e)]}function pd(t,e,i,n){const a=1<<i.z,l=(t/_t+i.x)/a;return Le(Ii((e/_t+i.y)/a),oi(l),n)}function _p({min:t,max:e}){return ee/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Ix=new Float64Array(16);function gp(t){const e=_p(t),i=o.a6.fromScaling(Ix,[e,e,e]);return o.a6.translate(i,i,o.N.negate([],t.min))}function X_(t){const e=o.a6.fromTranslation(Ix,t.min),i=1/_p(t);return o.a6.scale(e,e,[i,i,i])}function Y_(t){const e=_t/(2*Math.PI);return t/(2*Math.PI)/e}function Cx(t,e){return _t/(512*Math.pow(2,t))*_p(Ro(e))}function Px(t,e,i,n,a){const l=Y_(i),h=[t,e,-i/(2*Math.PI)],p=o.a6.identity(new Float64Array(16));return o.a6.translate(p,p,h),o.a6.scale(p,p,[l,l,l]),o.a6.rotateX(p,p,ni(-a)),o.a6.rotateY(p,p,ni(-n)),p}function Va(t){return Mn(Q,$,t)}function Rx(t,e){const i=Le(e.lat,e.lng),n=function(l){const h=Le(l._center.lat,l._center.lng),p=o.N.fromValues(0,1,0);let _=o.N.cross([],p,h);const y=o.a6.fromRotation([],-l.angle,h);_=o.N.transformMat4(_,_,y),o.a6.fromRotation(y,-l._pitch,_);const v=o.N.normalize([],h);return o.N.scale(v,v,pp(l.cameraToCenterDistance/l.pixelsPerMeter)),o.N.transformMat4(v,v,y),o.N.add([],h,v)}(t),a=o.N.subtract([],n,i);return o.N.angle(a,i)}function K_(t,e){return Rx(t,e)>Math.PI/2*1.01}const Lx=ni(85),ZE=Math.cos(Lx),HE=Math.sin(Lx),WE=o.a6.create(),Dx=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function zx(t,e,i,n,a,l,h,p,_){if(l&&t.queryGeometry.isAboveHorizon)return!1;l&&(_*=t.pixelToTileUnitsFactor);const y=t.tileID.canonical,v=i.projection.upVectorScale(y,i.center.lat,i.worldSize).metersToTile;for(const T of e)for(const A of T){const C=A.add(p),R=a&&i.elevation?i.elevation.exaggeration()*a.getElevationAt(C.x,C.y,!0):0,D=i.projection.projectTilePoint(C.x,C.y,y);if(R>0){const K=i.projection.upVector(y,C.x,C.y);D.x+=K[0]*v*R,D.y+=K[1]*v*R,D.z+=K[2]*v*R}const B=l?C:XE(D.x,D.y,D.z,n),N=l?t.tilespaceRays.map(K=>KE(K,R)):t.queryGeometry.screenGeometry,H=o.a7.transformMat4([],[D.x,D.y,D.z,1],n);if(!h&&l?_*=H[3]/i.cameraToCenterDistance:h&&!l&&(_*=i.cameraToCenterDistance/H[3]),l){const K=Ii((A.y/_t+y.y)/(1<<y.z));_/=i.projection.pixelsPerMeter(K,1)/ai(1,K)}if(Io(N,B,_))return!0}return!1}function XE(t,e,i,n){const a=o.a7.transformMat4([],[t,e,i,1],n);return new Ue(a[0]/a[3],a[1]/a[3])}const kx=o.N.fromValues(0,0,0),YE=o.N.fromValues(0,0,1);function KE(t,e){const i=o.N.create();return kx[2]=e,t.intersectsPlane(kx,YE,i),new Ue(i[0],i[1])}class Ox extends Hn{}function Bx(t,{width:e,height:i},n,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*i*n)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*i*n);return t.width=e,t.height=i,t.data=a,t}function Fx(t,e,i){const{width:n,height:a}=e;n===t.width&&a===t.height||(J_(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,a)},i),t.width=n,t.height=a,t.data=e.data)}function J_(t,e,i,n,a,l,h){if(a.width===0||a.height===0)return e;if(a.width>t.width||a.height>t.height||i.x>t.width-a.width||i.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||n.x>e.width-a.width||n.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const p=t.data,_=e.data,y=l===4&&h;for(let v=0;v<a.height;v++){const T=((i.y+v)*t.width+i.x)*l,A=((n.y+v)*e.width+n.x)*l;if(y)for(let C=0;C<a.width;C++){const R=T+C*l+3,D=A+C*l;_[D+0]=255,_[D+1]=255,_[D+2]=255,_[D+3]=p[R]}else for(let C=0;C<a.width*l;C++)_[A+C]=p[T+C]}return e}wt(Ox,"HeatmapBucket",{omit:["layers"]});class Ua{constructor(e,i){Bx(this,e,1,i)}resize(e){Fx(this,new Ua(e),1)}clone(){return new Ua({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,n,a,l){J_(e,i,n,a,l,1)}}class Ss{constructor(e,i){Bx(this,e,4,i)}resize(e){Fx(this,new Ss(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ss({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,n,a,l,h){J_(e,i,n,a,l,4,h)}}class Nx{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}wt(Ua,"AlphaImage"),wt(Ss,"RGBAImage");const JE=new Pr({visibility:new tt(be.layout_heatmap.visibility)});var QE={paint:new Pr({"heatmap-radius":new Gt(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gt(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new tt(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Qo(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new tt(be.paint_heatmap["heatmap-opacity"])}),layout:JE};function md(t){const e={},i=t.resolution||256,n=t.clips?t.clips.length:1,a=t.image||new Ss({width:i,height:n}),l=(h,p,_)=>{e[t.evaluationKey]=_;const y=t.expression.evaluate(e);y&&(a.data[h+p+0]=Math.floor(255*y.r/y.a),a.data[h+p+1]=Math.floor(255*y.g/y.a),a.data[h+p+2]=Math.floor(255*y.b/y.a),a.data[h+p+3]=Math.floor(255*y.a))};if(t.clips)for(let h=0,p=0;h<n;++h,p+=4*i)for(let _=0,y=0;_<i;_++,y+=4){const v=_/(i-1),{start:T,end:A}=t.clips[h];l(p,y,T*(1-v)+A*v)}else for(let h=0,p=0;h<i;h++,p+=4)l(0,p,h/(i-1));return a}const eS=new Pr({visibility:new tt(be.layout_hillshade.visibility)});var tS={paint:new Pr({"hillshade-illumination-direction":new tt(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new tt(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new tt(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new tt(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new tt(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new tt(be.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new tt(be.paint_hillshade["hillshade-emissive-strength"])}),layout:eS};const iS=Ki([{name:"a_pos",components:2,type:"Int16"}],4),{members:rS}=iS;var Q_={exports:{}};function yp(t,e,i){i=i||2;var n,a,l,h,p,_,y,v=e&&e.length,T=v?e[0]*i:t.length,A=Vx(t,0,T,i,!0),C=[];if(!A||A.next===A.prev)return C;if(v&&(A=function(D,B,N,H){var K,Y,ne,ie=[];for(K=0,Y=B.length;K<Y;K++)(ne=Vx(D,B[K]*H,K<Y-1?B[K+1]*H:D.length,H,!1))===ne.next&&(ne.steiner=!0),ie.push(hS(ne));for(ie.sort(lS),K=0;K<ie.length;K++)N=cS(ie[K],N);return N}(t,e,A,i)),t.length>80*i){n=l=t[0],a=h=t[1];for(var R=i;R<T;R+=i)(p=t[R])<n&&(n=p),(_=t[R+1])<a&&(a=_),p>l&&(l=p),_>h&&(h=_);y=(y=Math.max(l-n,h-a))!==0?32767/y:0}return _d(A,C,i,n,a,y,0),C}function Vx(t,e,i,n,a){var l,h;if(a===ig(t,e,i,n)>0)for(l=e;l<i;l+=n)h=Gx(l,t[l],t[l+1],h);else for(l=i-n;l>=e;l-=n)h=Gx(l,t[l],t[l+1],h);return h&&xp(h,h.next)&&(yd(h),h=h.next),h}function ic(t,e){if(!t)return t;e||(e=t);var i,n=t;do if(i=!1,n.steiner||!xp(n,n.next)&&tn(n.prev,n,n.next)!==0)n=n.next;else{if(yd(n),(n=e=n.prev)===n.next)break;i=!0}while(i||n!==e);return e}function _d(t,e,i,n,a,l,h){if(t){!h&&l&&function(v,T,A,C){var R=v;do R.z===0&&(R.z=eg(R.x,R.y,T,A,C)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==v);R.prevZ.nextZ=null,R.prevZ=null,function(D){var B,N,H,K,Y,ne,ie,ce,me=1;do{for(N=D,D=null,Y=null,ne=0;N;){for(ne++,H=N,ie=0,B=0;B<me&&(ie++,H=H.nextZ);B++);for(ce=me;ie>0||ce>0&&H;)ie!==0&&(ce===0||!H||N.z<=H.z)?(K=N,N=N.nextZ,ie--):(K=H,H=H.nextZ,ce--),Y?Y.nextZ=K:D=K,K.prevZ=Y,Y=K;N=H}Y.nextZ=null,me*=2}while(ne>1)}(R)}(t,n,a,l);for(var p,_,y=t;t.prev!==t.next;)if(p=t.prev,_=t.next,l?sS(t,n,a,l):nS(t))e.push(p.i/i|0),e.push(t.i/i|0),e.push(_.i/i|0),yd(t),t=_.next,y=_.next;else if((t=_)===y){h?h===1?_d(t=oS(ic(t),e,i),e,i,n,a,l,2):h===2&&aS(t,e,i,n,a,l):_d(ic(t),e,i,n,a,l,1);break}}}function nS(t){var e=t.prev,i=t,n=t.next;if(tn(e,i,n)>=0)return!1;for(var a=e.x,l=i.x,h=n.x,p=e.y,_=i.y,y=n.y,v=a<l?a<h?a:h:l<h?l:h,T=p<_?p<y?p:y:_<y?_:y,A=a>l?a>h?a:h:l>h?l:h,C=p>_?p>y?p:y:_>y?_:y,R=n.next;R!==e;){if(R.x>=v&&R.x<=A&&R.y>=T&&R.y<=C&&ru(a,p,l,_,h,y,R.x,R.y)&&tn(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function sS(t,e,i,n){var a=t.prev,l=t,h=t.next;if(tn(a,l,h)>=0)return!1;for(var p=a.x,_=l.x,y=h.x,v=a.y,T=l.y,A=h.y,C=p<_?p<y?p:y:_<y?_:y,R=v<T?v<A?v:A:T<A?T:A,D=p>_?p>y?p:y:_>y?_:y,B=v>T?v>A?v:A:T>A?T:A,N=eg(C,R,e,i,n),H=eg(D,B,e,i,n),K=t.prevZ,Y=t.nextZ;K&&K.z>=N&&Y&&Y.z<=H;){if(K.x>=C&&K.x<=D&&K.y>=R&&K.y<=B&&K!==a&&K!==h&&ru(p,v,_,T,y,A,K.x,K.y)&&tn(K.prev,K,K.next)>=0||(K=K.prevZ,Y.x>=C&&Y.x<=D&&Y.y>=R&&Y.y<=B&&Y!==a&&Y!==h&&ru(p,v,_,T,y,A,Y.x,Y.y)&&tn(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;K&&K.z>=N;){if(K.x>=C&&K.x<=D&&K.y>=R&&K.y<=B&&K!==a&&K!==h&&ru(p,v,_,T,y,A,K.x,K.y)&&tn(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;Y&&Y.z<=H;){if(Y.x>=C&&Y.x<=D&&Y.y>=R&&Y.y<=B&&Y!==a&&Y!==h&&ru(p,v,_,T,y,A,Y.x,Y.y)&&tn(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function oS(t,e,i){var n=t;do{var a=n.prev,l=n.next.next;!xp(a,l)&&Ux(a,n,n.next,l)&&gd(a,l)&&gd(l,a)&&(e.push(a.i/i|0),e.push(n.i/i|0),e.push(l.i/i|0),yd(n),yd(n.next),n=t=l),n=n.next}while(n!==t);return ic(n)}function aS(t,e,i,n,a,l){var h=t;do{for(var p=h.next.next;p!==h.prev;){if(h.i!==p.i&&dS(h,p)){var _=jx(h,p);return h=ic(h,h.next),_=ic(_,_.next),_d(h,e,i,n,a,l,0),void _d(_,e,i,n,a,l,0)}p=p.next}h=h.next}while(h!==t)}function lS(t,e){return t.x-e.x}function cS(t,e){var i=function(a,l){var h,p=l,_=a.x,y=a.y,v=-1/0;do{if(y<=p.y&&y>=p.next.y&&p.next.y!==p.y){var T=p.x+(y-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(T<=_&&T>v&&(v=T,h=p.x<p.next.x?p:p.next,T===_))return h}p=p.next}while(p!==l);if(!h)return null;var A,C=h,R=h.x,D=h.y,B=1/0;p=h;do _>=p.x&&p.x>=R&&_!==p.x&&ru(y<D?_:v,y,R,D,y<D?v:_,y,p.x,p.y)&&(A=Math.abs(y-p.y)/(_-p.x),gd(p,a)&&(A<B||A===B&&(p.x>h.x||p.x===h.x&&uS(h,p)))&&(h=p,B=A)),p=p.next;while(p!==C);return h}(t,e);if(!i)return e;var n=jx(i,t);return ic(n,n.next),ic(i,i.next)}function uS(t,e){return tn(t.prev,t,e.prev)<0&&tn(e.next,t,t.next)<0}function eg(t,e,i,n,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function hS(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function ru(t,e,i,n,a,l,h,p){return(a-h)*(e-p)>=(t-h)*(l-p)&&(t-h)*(n-p)>=(i-h)*(e-p)&&(i-h)*(l-p)>=(a-h)*(n-p)}function dS(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,n){var a=i;do{if(a.i!==i.i&&a.next.i!==i.i&&a.i!==n.i&&a.next.i!==n.i&&Ux(a,a.next,i,n))return!0;a=a.next}while(a!==i);return!1}(t,e)&&(gd(t,e)&&gd(e,t)&&function(i,n){var a=i,l=!1,h=(i.x+n.x)/2,p=(i.y+n.y)/2;do a.y>p!=a.next.y>p&&a.next.y!==a.y&&h<(a.next.x-a.x)*(p-a.y)/(a.next.y-a.y)+a.x&&(l=!l),a=a.next;while(a!==i);return l}(t,e)&&(tn(t.prev,t,e.prev)||tn(t,e.prev,e))||xp(t,e)&&tn(t.prev,t,t.next)>0&&tn(e.prev,e,e.next)>0)}function tn(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function xp(t,e){return t.x===e.x&&t.y===e.y}function Ux(t,e,i,n){var a=bp(tn(t,e,i)),l=bp(tn(t,e,n)),h=bp(tn(i,n,t)),p=bp(tn(i,n,e));return a!==l&&h!==p||!(a!==0||!vp(t,i,e))||!(l!==0||!vp(t,n,e))||!(h!==0||!vp(i,t,n))||!(p!==0||!vp(i,e,n))}function vp(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function bp(t){return t>0?1:t<0?-1:0}function gd(t,e){return tn(t.prev,t,t.next)<0?tn(t,e,t.next)>=0&&tn(t,t.prev,e)>=0:tn(t,e,t.prev)<0||tn(t,t.next,e)<0}function jx(t,e){var i=new tg(t.i,t.x,t.y),n=new tg(e.i,e.x,e.y),a=t.next,l=e.prev;return t.next=e,e.prev=t,i.next=a,a.prev=i,n.next=i,i.prev=n,l.next=n,n.prev=l,n}function Gx(t,e,i,n){var a=new tg(t,e,i);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function yd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function tg(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ig(t,e,i,n){for(var a=0,l=e,h=i-n;l<i;l+=n)a+=(t[h]-t[l])*(t[l+1]+t[h+1]),h=l;return a}Q_.exports=yp,Q_.exports.default=yp,yp.deviation=function(t,e,i,n){var a=e&&e.length,l=Math.abs(ig(t,0,a?e[0]*i:t.length,i));if(a)for(var h=0,p=e.length;h<p;h++)l-=Math.abs(ig(t,e[h]*i,h<p-1?e[h+1]*i:t.length,i));var _=0;for(h=0;h<n.length;h+=3){var y=n[h]*i,v=n[h+1]*i,T=n[h+2]*i;_+=Math.abs((t[y]-t[T])*(t[v+1]-t[y+1])-(t[y]-t[v])*(t[T+1]-t[y+1]))}return l===0&&_===0?0:Math.abs((_-l)/l)},yp.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,a=0;a<t.length;a++){for(var l=0;l<t[a].length;l++)for(var h=0;h<e;h++)i.vertices.push(t[a][l][h]);a>0&&i.holes.push(n+=t[a-1].length)}return i};var wp=Jt(Q_.exports);function rg(t,e){const i=t.length;if(i<=1)return[t];const n=[];let a,l;for(let h=0;h<i;h++){const p=ot(t[h]);p!==0&&(t[h].area=Math.abs(p),l===void 0&&(l=p<0),l===p<0?(a&&n.push(a),a=[t[h]]):a.push(t[h]))}if(a&&n.push(a),e>1)for(let h=0;h<n.length;h++)n[h].length<=e||(s_(n[h],e,1,n[h].length-1,fS),n[h]=n[h].slice(0,e));return n}function fS(t,e){return e.area-t.area}function ng(t,e,i){const n=i.patternDependencies;let a=!1;for(const l of e){const h=l.paint.get(`${t}-pattern`);h.isConstant()||(a=!0);const p=h.constantOr(null);p&&(a=!0,n[p]=!0)}return a}function sg(t,e,i,n,a){const l=a.patternDependencies;for(const h of e){const p=h.paint.get(`${t}-pattern`).value;if(p.kind!=="constant"){let _=p.evaluate({zoom:n},i,{},a.availableImages);_=_&&_.name?_.name:_,l[_]=!0,i.patterns[h.id]=_}}return i}class og{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ws,this.indexArray=new sn,this.indexArray2=new Ls,this.programConfigurations=new j(e.layers,e.zoom),this.segments=new Br,this.segments2=new Br,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,n,a){this.hasPattern=ng("fill",this.layers,i);const l=this.layers[0].layout.get("fill-sort-key"),h=[];for(const{feature:p,id:_,index:y,sourceLayerIndex:v}of e){const T=this.layers[0]._featureFilter.needGeometry,A=en(p,T);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom),A,n))continue;const C=l?l.evaluate(A,{},n,i.availableImages):void 0,R={id:_,properties:p.properties,type:p.type,sourceLayerIndex:v,index:y,geometry:T?A.geometry:an(p,n,a),patterns:{},sortKey:C};h.push(R)}l&&h.sort((p,_)=>p.sortKey-_.sortKey);for(const p of h){const{geometry:_,index:y,sourceLayerIndex:v}=p;if(this.hasPattern){const T=sg("fill",this.layers,p,this.zoom,i);this.patternFeatures.push(T)}else this.addFeature(p,_,y,n,{},i.availableImages,i.brightness);i.featureIndex.insert(e[y].feature,_,y,v,this.index)}}update(e,i,n,a,l){const h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,h?this.stateDependentLayers:this.layers,n,a,l)}addFeatures(e,i,n,a,l,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,i,n,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rS),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,n,a,l,h=[],p){for(const _ of rg(i,500)){let y=0;for(const D of _)y+=D.length;const v=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),T=v.vertexLength,A=[],C=[];for(const D of _){if(D.length===0)continue;D!==_[0]&&C.push(A.length/2);const B=this.segments2.prepareSegment(D.length,this.layoutVertexArray,this.indexArray2),N=B.vertexLength;this.layoutVertexArray.emplaceBack(D[0].x,D[0].y),this.indexArray2.emplaceBack(N+D.length-1,N),A.push(D[0].x),A.push(D[0].y);for(let H=1;H<D.length;H++)this.layoutVertexArray.emplaceBack(D[H].x,D[H].y),this.indexArray2.emplaceBack(N+H-1,N+H),A.push(D[H].x),A.push(D[H].y);B.vertexLength+=D.length,B.primitiveLength+=D.length}const R=wp(A,C);for(let D=0;D<R.length;D+=3)this.indexArray.emplaceBack(T+R[D],T+R[D+1],T+R[D+2]);v.vertexLength+=y,v.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,l,h,a,p)}}wt(og,"FillBucket",{omit:["layers","patternFeatures"]});const pS=new Pr({"fill-sort-key":new Gt(be.layout_fill["fill-sort-key"]),visibility:new tt(be.layout_fill.visibility)});var mS={paint:new Pr({"fill-antialias":new tt(be.paint_fill["fill-antialias"]),"fill-opacity":new Gt(be.paint_fill["fill-opacity"]),"fill-color":new Gt(be.paint_fill["fill-color"]),"fill-outline-color":new Gt(be.paint_fill["fill-outline-color"]),"fill-translate":new tt(be.paint_fill["fill-translate"]),"fill-translate-anchor":new tt(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gt(be.paint_fill["fill-pattern"]),"fill-emissive-strength":new tt(be.paint_fill["fill-emissive-strength"])}),layout:pS};const _S=Ki([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),gS=Ki([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),yS=Ki([{name:"a_centroid_pos",components:2,type:"Uint16"}]),xS=Ki([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),vS=Ki([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:bS}=_S;var Tp={},wS=vr,$x=nu;function nu(t,e,i,n,a){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=a,t.readFields(TS,this,e)}function TS(t,e,i){t==1?e.id=i.readVarint():t==2?function(n,a){for(var l=n.readVarint()+n.pos;n.pos<l;){var h=a._keys[n.readVarint()],p=a._values[n.readVarint()];a.properties[h]=p}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function ES(t){for(var e,i,n=0,a=0,l=t.length,h=l-1;a<l;h=a++)n+=((i=t[h]).x-(e=t[a]).x)*(e.y+i.y);return n}nu.types=["Unknown","Point","LineString","Polygon"],nu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,n=1,a=0,l=0,h=0,p=[];t.pos<i;){if(a<=0){var _=t.readVarint();n=7&_,a=_>>3}if(a--,n===1||n===2)l+=t.readSVarint(),h+=t.readSVarint(),n===1&&(e&&p.push(e),e=[]),e.push(new wS(l,h));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&p.push(e),p},nu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,a=0,l=0,h=1/0,p=-1/0,_=1/0,y=-1/0;t.pos<e;){if(n<=0){var v=t.readVarint();i=7&v,n=v>>3}if(n--,i===1||i===2)(a+=t.readSVarint())<h&&(h=a),a>p&&(p=a),(l+=t.readSVarint())<_&&(_=l),l>y&&(y=l);else if(i!==7)throw new Error("unknown command "+i)}return[h,_,p,y]},nu.prototype.toGeoJSON=function(t,e,i){var n,a,l=this.extent*Math.pow(2,i),h=this.extent*t,p=this.extent*e,_=this.loadGeometry(),y=nu.types[this.type];function v(C){for(var R=0;R<C.length;R++){var D=C[R];C[R]=[360*(D.x+h)/l-180,360/Math.PI*Math.atan(Math.exp((180-360*(D.y+p)/l)*Math.PI/180))-90]}}switch(this.type){case 1:var T=[];for(n=0;n<_.length;n++)T[n]=_[n][0];v(_=T);break;case 2:for(n=0;n<_.length;n++)v(_[n]);break;case 3:for(_=function(C){var R=C.length;if(R<=1)return[C];for(var D,B,N=[],H=0;H<R;H++){var K=ES(C[H]);K!==0&&(B===void 0&&(B=K<0),B===K<0?(D&&N.push(D),D=[C[H]]):D.push(C[H]))}return D&&N.push(D),N}(_),n=0;n<_.length;n++)for(a=0;a<_[n].length;a++)v(_[n][a])}_.length===1?_=_[0]:y="Multi"+y;var A={type:"Feature",geometry:{type:y,coordinates:_},properties:this.properties};return"id"in this&&(A.id=this.id),A};var SS=$x,qx=Zx;function Zx(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(AS,this,e),this.length=this._features.length}function AS(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(n){for(var a=null,l=n.readVarint()+n.pos;n.pos<l;){var h=n.readVarint()>>3;a=h===1?n.readString():h===2?n.readFloat():h===3?n.readDouble():h===4?n.readVarint64():h===5?n.readVarint():h===6?n.readSVarint():h===7?n.readBoolean():null}return a}(i))}Zx.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new SS(this._pbf,e,this.extent,this._keys,this._values)};var MS=qx;function IS(t,e,i){if(t===3){var n=new MS(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}var ag=Tp.VectorTile=function(t,e){this.layers=t.readFields(IS,{},e)},Ep=Tp.VectorTileFeature=$x;function Sp(t,e,i,n){const a=[],l=n===0?(h,p,_,y,v,T)=>{h.push(new Ue(T,_+(T-p)/(y-p)*(v-_)))}:(h,p,_,y,v,T)=>{h.push(new Ue(p+(T-_)/(v-_)*(y-p),T))};for(const h of t){const p=[];for(const _ of h){if(_.length<=2)continue;const y=[];for(let A=0;A<_.length-1;A++){const C=_[A].x,R=_[A].y,D=_[A+1].x,B=_[A+1].y,N=n===0?C:R,H=n===0?D:B;N<e?H>e&&l(y,C,R,D,B,e):N>i?H<i&&l(y,C,R,D,B,i):y.push(_[A]),H<e&&N>=e&&l(y,C,R,D,B,e),H>i&&N<=i&&l(y,C,R,D,B,i)}let v=_[_.length-1];const T=n===0?v.x:v.y;T>=e&&T<=i&&y.push(v),y.length&&(v=y[y.length-1],y[0].x===v.x&&y[0].y===v.y||y.push(y[0]),p.push(y))}p.length&&a.push(p)}return a}function Ap(t,e){return t.x-e.x||t.y-e.y}function Hx(t,e){return Ap(t.min,e.min)===0&&Ap(t.max,e.max)===0}function Wx(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Xx(t,e,i){const n=1/_t,a=1/(1<<i.canonical.z),l=(e.x*n+i.canonical.x)*a+i.wrap,h=(e.y*n+i.canonical.y)*a;return{min:new Ue((t.x*n+i.canonical.x)*a+i.wrap,(t.y*n+i.canonical.y)*a),max:new Ue(l,h)}}function CS(t,e,i){const n=1<<i.canonical.z,a=((e.x-i.wrap)*n-i.canonical.x)*_t,l=(e.y*n-i.canonical.y)*_t;return{min:new Ue(((t.x-i.wrap)*n-i.canonical.x)*_t,(t.y*n-i.canonical.y)*_t),max:new Ue(a,l)}}function Yx(t,e,i,n,a,l,h){const p=t.indices,_=t.vertices,y=[];for(let v=n;v<n+a;v+=3){const T=e[i[v+0]+l],A=e[i[v+1]+l],C=e[i[v+2]+l],R=Math.min(T.x,A.x,C.x),D=Math.max(T.x,A.x,C.x),B=Math.min(T.y,A.y,C.y),N=Math.max(T.y,A.y,C.y);y.length=0,t.grid.query(new Ue(R,B),new Ue(D,N),y);for(let H=0;H<y.length;H++){const K=y[H];if(I_(_[p[3*K+0]],_[p[3*K+1]],_[p[3*K+2]],T,A,C,h))return!0}}return!1}function Kx(t,e,i,n){if(!t||!i)return!1;let a=t.vertices;if(!e.canonical.equals(n.canonical)||e.wrap!==n.wrap){if(i.vertices.length<t.vertices.length)return Kx(i,n,t,e);const l=e.canonical,h=n.canonical,p=Math.pow(2,h.z-l.z);a=t.vertices.map(_=>new Ue(_.x*l.x*_t*p-h.x*_t,_.y*l.y*_t*p-h.y*_t))}return Yx(i,a,t.indices,0,t.indices.length,0,0)}Tp.VectorTileLayer=qx;class Jx{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const n=this.toIdx(e,i);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Qx(t,e,i,n){let a=0,l=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(n[h])<1e-15){if(i[h]<t[h]||i[h]>e[h])return null}else{const p=1/n[h];let _=(t[h]-i[h])*p,y=(e[h]-i[h])*p;if(_>y){const v=_;_=y,y=v}if(_>a&&(a=_),y<l&&(l=y),a>l)return null}return a}function ev(t,e,i,n,a,l,h,p,_,y,v){const T=n-t,A=a-e,C=l-i,R=h-t,D=p-e,B=_-i,N=v[1]*B-v[2]*D,H=v[2]*R-v[0]*B,K=v[0]*D-v[1]*R,Y=T*N+A*H+C*K;if(Math.abs(Y)<1e-15)return null;const ne=1/Y,ie=y[0]-t,ce=y[1]-e,me=y[2]-i,ye=(ie*N+ce*H+me*K)*ne;if(ye<0||ye>1)return null;const Ee=ce*C-me*A,xe=me*T-ie*C,De=ie*A-ce*T,je=(v[0]*Ee+v[1]*xe+v[2]*De)*ne;return je<0||ye+je>1?null:(R*Ee+D*xe+B*De)*ne}function tv(t,e,i){return(t-e)/(i-e)}function iv(t,e,i,n,a,l,h,p,_){const y=1<<i,v=l-n,T=h-a,A=(t+1)/y*v+n,C=(e+0)/y*T+a,R=(e+1)/y*T+a;p[0]=(t+0)/y*v+n,p[1]=C,_[0]=A,_[1]=R}class rv{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(l){const h=Math.ceil(Math.log2(l.dim/8)),p=[];let _=Math.ceil(Math.pow(2,h));const y=1/_,v=(C,R,D,B,N)=>{const H=B?1:0,K=(C+1)*D-H,Y=R*D,ne=(R+1)*D-H;N[0]=C*D,N[1]=Y,N[2]=K,N[3]=ne};let T=new Jx(_);const A=[];for(let C=0;C<_*_;C++){v(C%_,Math.floor(C/_),y,!1,A);const R=ja(A[0],A[1],l),D=ja(A[2],A[1],l),B=ja(A[2],A[3],l),N=ja(A[0],A[3],l);T.minimums.push(Math.min(R,D,B,N)),T.maximums.push(Math.max(R,D,B,N)),T.leaves.push(1)}for(p.push(T),_/=2;_>=1;_/=2){const C=p[p.length-1];T=new Jx(_);for(let R=0;R<_*_;R++){v(R%_,Math.floor(R/_),2,!0,A);const D=C.getElevation(A[0],A[1]),B=C.getElevation(A[2],A[1]),N=C.getElevation(A[2],A[3]),H=C.getElevation(A[0],A[3]),K=C.isLeaf(A[0],A[1]),Y=C.isLeaf(A[2],A[1]),ne=C.isLeaf(A[2],A[3]),ie=C.isLeaf(A[0],A[3]),ce=Math.min(D.min,B.min,N.min,H.min),me=Math.max(D.max,B.max,N.max,H.max),ye=K&&Y&&ne&&ie;T.maximums.push(me),T.minimums.push(ce),T.leaves.push(me-ce<=5&&ye?1:0)}p.push(T)}return p}(this.dem),n=i.length-1,a=i[n];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(i,0,0,n,0)}raycastRoot(e,i,n,a,l,h,p=1){return Qx([e,i,-100],[n,a,this.maximums[0]*p],l,h)}raycast(e,i,n,a,l,h,p=1){if(!this.nodeCount)return null;const _=this.raycastRoot(e,i,n,a,l,h,p);if(_==null)return null;const y=[],v=[],T=[],A=[],C=[{idx:0,t:_,nodex:0,nodey:0,depth:0}];for(;C.length>0;){const{idx:R,t:D,nodex:B,nodey:N,depth:H}=C.pop();if(this.leaves[R]){iv(B,N,H,e,i,n,a,T,A);const Y=1<<H,ne=(B+0)/Y,ie=(B+1)/Y,ce=(N+0)/Y,me=(N+1)/Y,ye=ja(ne,ce,this.dem)*p,Ee=ja(ie,ce,this.dem)*p,xe=ja(ie,me,this.dem)*p,De=ja(ne,me,this.dem)*p,je=ev(T[0],T[1],ye,A[0],T[1],Ee,A[0],A[1],xe,l,h),Re=ev(A[0],A[1],xe,T[0],A[1],De,T[0],T[1],ye,l,h),Ve=Math.min(je!==null?je:Number.MAX_VALUE,Re!==null?Re:Number.MAX_VALUE);if(Ve!==Number.MAX_VALUE)return Ve;{const Me=o.N.scaleAndAdd([],l,h,D);if(nv(ye,Ee,De,xe,tv(Me[0],T[0],A[0]),tv(Me[1],T[1],A[1]))>=Me[2])return D}continue}let K=0;for(let Y=0;Y<this._siblingOffset.length;Y++){iv((B<<1)+this._siblingOffset[Y][0],(N<<1)+this._siblingOffset[Y][1],H+1,e,i,n,a,T,A),T[2]=-100,A[2]=this.maximums[this.childOffsets[R]+Y]*p;const ne=Qx(T,A,l,h);if(ne!=null){const ie=ne;y[Y]=ie;let ce=!1;for(let me=0;me<K&&!ce;me++)ie>=y[v[me]]&&(v.splice(me,0,Y),ce=!0);ce||(v[K]=Y),K++}}for(let Y=0;Y<K;Y++){const ne=v[Y];C.push({idx:this.childOffsets[R]+ne,t:y[ne],nodex:(B<<1)+this._siblingOffset[ne][0],nodey:(N<<1)+this._siblingOffset[ne][1],depth:H+1})}}return null}_addNode(e,i,n){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,n,a,l){if(e[a].isLeaf(i,n)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);const h=a-1,p=e[h];let _=0,y=0;for(let v=0;v<this._siblingOffset.length;v++){const T=2*i+this._siblingOffset[v][0],A=2*n+this._siblingOffset[v][1],C=p.getElevation(T,A),R=p.isLeaf(T,A),D=this._addNode(C.min,C.max,R);R&&(_|=1<<v),y||(y=D)}for(let v=0;v<this._siblingOffset.length;v++)_&1<<v||this._construct(e,2*i+this._siblingOffset[v][0],2*n+this._siblingOffset[v][1],h,y+v)}}function nv(t,e,i,n,a,l){return Si(Si(t,i,l),Si(e,n,l),a)}function ja(t,e,i){const n=i.dim,a=zt(t*n-.5,0,n-1),l=zt(e*n-.5,0,n-1),h=Math.floor(a),p=Math.floor(l),_=Math.min(h+1,n-1),y=Math.min(p+1,n-1);return nv(i.get(h,p),i.get(_,p),i.get(h,y),i.get(_,y),a-h,l-p)}const PS={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function RS(t,e,i){return(256*t*256+256*e+i)/10-1e4}function LS(t,e,i){return 256*t+e+i/256-32768}class Mp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,n,a=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return pe(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const l=this.dim=i.height-2,h=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let _=0;_<l;_++)h[this._idx(-1,_)]=h[this._idx(0,_)],h[this._idx(l,_)]=h[this._idx(l-1,_)],h[this._idx(_,-1)]=h[this._idx(_,0)],h[this._idx(_,l)]=h[this._idx(_,l-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(l,-1)]=h[this._idx(l-1,0)],h[this._idx(-1,l)]=h[this._idx(0,l-1)],h[this._idx(l,l)]=h[this._idx(l-1,l-1)]}const p=n==="terrarium"?LS:RS;for(let _=0;_<h.length;++_){const y=4*_;this.floatView[_]=p(this.pixels[y],this.pixels[y+1],this.pixels[y+2])}this._timestamp=Xe.now()}_buildQuadTree(){this._tree=new rv(this)}get(e,i,n=!1){n&&(e=zt(e,-1,this.dim),i=zt(i,-1,this.dim));const a=this._idx(e,i);return this.floatView[a]}set(e,i,n){const a=this._idx(e,i),l=this.floatView[a];return this.floatView[a]=n,n-l}static getUnpackVector(e){return PS[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const n=[0,0,0,0],a=Mp.getUnpackVector(i);let l=Math.floor((e+a[3])/a[2]);return n[2]=l%256,l=Math.floor(l/256),n[1]=l%256,l=Math.floor(l/256),n[0]=l,n}getPixels(){return new Nx({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=i*this.dim,l=i*this.dim+this.dim,h=n*this.dim,p=n*this.dim+this.dim;switch(i){case-1:a=l-1;break;case 1:l=a+1}switch(n){case-1:h=p-1;break;case 1:p=h+1}const _=-i*this.dim,y=-n*this.dim;for(let v=h;v<p;v++)for(let T=a;T<l;T++){const A=4*this._idx(T,v),C=4*this._idx(T+_,v+y);this.pixels[A+0]=e.pixels[C+0],this.pixels[A+1]=e.pixels[C+1],this.pixels[A+2]=e.pixels[C+2],this.pixels[A+3]=e.pixels[C+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}wt(Mp,"DEMData"),wt(rv,"DemMinMaxQuadTree",{omit:["dem"]});class su{constructor(e,i,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=n}static create(e,i,n){const a=n||e.findDEMTileFor(i);if(!a||!a.dem)return;const l=a.dem,h=a.tileID,p=1<<i.canonical.z-h.canonical.z;return new su(a,l.dim/_t/p,[(i.canonical.x/p-h.canonical.x)*l.dim,(i.canonical.y/p-h.canonical.y)*l.dim])}tileCoordToPixel(e,i){const n=i*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(n);return new Ue(a,l)}getElevationAt(e,i,n,a){const l=e*this._scale+this._offset[0],h=i*this._scale+this._offset[1],p=Math.floor(l),_=Math.floor(h),y=this._dem;return a=!!a,n?Si(Si(y.get(p,_,a),y.get(p,_+1,a),h-_),Si(y.get(p+1,_,a),y.get(p+1,_+1,a),h-_),l-p):y.get(p,_,a)}getElevationAtPixel(e,i,n){return this._dem.get(e,i,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ai(1,e)*this._dem.stride}}const DS=Ep.types,zS=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],kS=["fill-extrusion-flood-light-ground-radius"],OS=Math.pow(2,13),BS=Math.pow(2,15)-1,sv=new Ue(0,1),Ga=2147483648;function xd(t,e,i,n,a,l,h,p){t.emplaceBack((e<<1)+h,(i<<1)+l,(Math.floor(n*OS)<<1)+a,Math.round(p))}function Ip(t,e,i,n,a,l){t.emplaceBack(e.x,e.y,(i.x<<1)+n,(i.y<<1)+a,l)}function vd(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class ov{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class av{constructor(){this.centroidXY=new Ue(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ue(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ue(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ue(this.max.x-this.min.x,this.max.y-this.min.y)}}class lv{constructor(){this.acc=new Ue(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,n){this.accCount++,this.acc._add(i);let a=!!this.borders;i.x<e.min.x?(e.min.x=i.x,a=!0):i.x>e.max.x&&(e.max.x=i.x,a=!0),i.y<e.min.y?(e.min.y=i.y,a=!0):i.y>e.max.y&&(e.max.y=i.y,a=!0),((i.x===0||i.x===_t)&&i.x===n.x)!=((i.y===0||i.y===_t)&&i.y===n.y)&&this.processBorderOverlap(i,n),a&&this.checkBorderIntersection(i,n)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Si(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>_t!=e.x>_t&&this.addBorderIntersection(1,Si(i.y,e.y,(_t-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Si(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>_t!=e.y>_t&&this.addBorderIntersection(3,Si(i.x,e.x,(_t-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];i<n[0]&&(n[0]=i),i>n[1]&&(n[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,i.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,i.x),this.addBorderIntersection(n,e.x)}}centroid(){return this.accCount===0?new Ue(0,0):new Ue(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function cv(t,e){const i=t.add(e)._unit(),n=zt(t.x*i.x+t.y*i.y,-1,1);var a,l,h;return a=Math.acos(n),Math.min(4,Math.max(-4,Math.tan(a)))/4*BS*((l=t).x*(h=e).y-l.y*h.x<0?-1:1)}const FS=[t=>t.x<0,t=>t.x>_t,t=>t.y<0,t=>t.y>_t];function NS(t,e,i,n){const a=[4];if(n===0)return a;i._mult(n);const l=t.sub(i),h=e.sub(i),p=[t,e,l,h];for(let _=0;_<4;_++)for(const y of p)if(FS[_](y)){a.push(_);break}return a}class uv{constructor(e){this.vertexArray=new Jh,this.indexArray=new sn,this.programConfigurations=new j(e.layers,e.zoom,i=>kS.includes(i)),this._segments=new Br,this.hiddenByLandmarkVertexArray=new ad,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Br}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,n,a=!1){const l=e.length;if(l>2){let h=Math.max(0,this._segments.get().length-1);const p=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[h].length);let _;h!==this._segments.get().length-1&&(h++,this._segmentToGroundQuads[h]=[],this._segmentToRegionTriCounts[h]=[0,0,0,0,0]);{const y=e[0],v=e[1];_=cv(y.sub(e[l-1])._perp()._unit(),v.sub(y)._perp()._unit())}for(let y=0;y<l;y++){const v=y===l-1?0:y+1,T=e[y],A=e[v],C=e[v===l-1?0:v+1],R=A.sub(T)._perp()._unit(),D=cv(R,C.sub(A)._perp()._unit()),B=_,N=D;if(lg(T,A,i)||a&&fv(T,i)&&fv(A,i)){_=D;continue}const H=p.vertexLength;Ip(this.vertexArray,T,A,1,1,B),Ip(this.vertexArray,T,A,1,0,B),Ip(this.vertexArray,T,A,0,1,N),Ip(this.vertexArray,T,A,0,0,N),p.vertexLength+=4;const K=NS(T,A,R,n);for(const Y of K)this._segmentToGroundQuads[h].push({id:H,region:Y}),this._segmentToRegionTriCounts[h][Y]+=2,p.primitiveLength+=2;_=D}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let n=0;n<i;n++)this._segmentToGroundQuads[n].sort((a,l)=>a.region-l.region);for(let n=0;n<i;n++){const a=this._segmentToGroundQuads[n],l=e[n],h=this._segmentToRegionTriCounts[n];h.reduce((_,y)=>_+y,0);let p=0;for(let _=0;_<=4;_++){const y=h[_];if(y!==0){let v=this.regionSegments[_];v||(v=this.regionSegments[_]=new Br);const T={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+p,vertexLength:l.vertexLength,primitiveLength:y};v.get().push(T)}p+=y}for(let _=0;_<a.length;_++){const y=a[_].id;this.indexArray.emplaceBack(y,y+1,y+3),this.indexArray.emplaceBack(y,y+3,y+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,n,a,l,h){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,n,a,l,h)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,gS.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,n,a,l,h){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,n,a,l,h)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const n=e.flags&Ga?1:0;for(let a=e.groundVertexArrayOffset;a<i;++a)this.hiddenByLandmarkVertexArray.emplace(a,n);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,xS.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Cp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new sn,this.footprintVertices=new ws,this.footprintSegments=[],this.layoutVertexArray=new qs,this.centroidVertexArray=new Wl,this.indexArray=new sn,this.programConfigurations=new j(e.layers,e.zoom,i=>zS.includes(i)),this.segments=new Br,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new uv(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,i,n,a){this.features=[],this.hasPattern=ng("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=bi(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:l,id:h,index:p,sourceLayerIndex:_}of e){const y=this.layers[0]._featureFilter.needGeometry,v=en(l,y);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom),v,n))continue;const T={id:h,sourceLayerIndex:_,index:p,geometry:y?v.geometry:an(l,n,a),properties:l.properties,type:l.type,patterns:{}},A=this.layoutVertexArray.length;this.hasPattern?this.features.push(sg("fill-extrusion",this.layers,T,this.zoom,i)):this.addFeature(T,T.geometry,p,n,{},i.availableImages,a,i.brightness),i.featureIndex.insert(l,T.geometry,p,_,this.index,A)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,n,a,l,h){for(const p of this.features){const{geometry:_}=p;this.addFeature(p,_,p.index,i,n,a,l,h)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,n,a,l){const h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;const p=h?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,p,n,a,l),this.groundEffect.update(e,i,p,n,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bS),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,vS.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,yS.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,n,a,l,h,p,_){const y=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,v=[new Ue(0,0),new Ue(_t,_t)],T=p.projection,A=T.name==="globe",C=DS[e.type]==="Polygon",R=new lv;R.centroidDataIndex=this.centroidData.length;const D=new av,B=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},a)<=0,N=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},a);D.height=N,D.vertexArrayOffset=this.layoutVertexArray.length,D.groundVertexArrayOffset=this.groundEffect.vertexArray.length,A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Wc);const H=rg(i,500);for(let me=H.length-1;me>=0;me--){const ye=H[me];(ye.length===0||(K=ye[0]).every(Ee=>Ee.x<=0)||K.every(Ee=>Ee.x>=_t)||K.every(Ee=>Ee.y<=0)||K.every(Ee=>Ee.y>=_t))&&H.splice(me,1)}var K;let Y;if(A)Y=gv(H,v,a);else{Y=[];for(const me of H)Y.push({polygon:me,bounds:v})}const ne=C?this.edgeRadius:0,ie=ne>0&&this.zoom<17,ce=(me,ye)=>{if(me.length===0)return!1;const Ee=me[me.length-1];return ye.x===Ee.x&&ye.y===Ee.y};for(const{polygon:me,bounds:ye}of Y){let Ee=0,xe=0;for(const Ve of me)C&&!Ve[0].equals(Ve[Ve.length-1])&&Ve.push(Ve[0]),xe+=C?Ve.length-1:Ve.length;const De=this.segments.prepareSegment((C?5:4)*xe,this.layoutVertexArray,this.indexArray);D.footprintSegIdx<0&&(D.footprintSegIdx=this.footprintSegments.length),D.polygonSegIdx<0&&(D.polygonSegIdx=this.polygonSegments.length);const je={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Re=new ov;if(Re.vertexOffset=this.footprintVertices.length,Re.indexOffset=3*this.footprintIndices.length,Re.ringIndices=[],C){const Ve=[],Me=[];Ee=De.vertexLength;for(let nt=0;nt<me.length;nt++){const Ge=me[nt];Ge.length&&nt!==0&&Me.push(Ve.length/2);const Mt=[];let xt,He;xt=Ge[1].sub(Ge[0])._perp()._unit(),Re.ringIndices.push(Ge.length-1);for(let Xt=1;Xt<Ge.length;Xt++){const Dt=Ge[Xt],At=Ge[Xt===Ge.length-1?1:Xt+1],We=Dt.clone();if(ne){He=At.sub(Dt)._perp()._unit();const $t=xt.add(He)._unit(),mi=ne*Math.min(4,1/(xt.x*$t.x+xt.y*$t.y));We.x+=mi*$t.x,We.y+=mi*$t.y,We.x=Math.round(We.x),We.y=Math.round(We.y),xt=He}!B||ne!==0&&!ie||ce(Mt,We)||Mt.push(We),xd(this.layoutVertexArray,We.x,We.y,0,0,1,1,0),De.vertexLength++,this.footprintVertices.emplaceBack(Dt.x,Dt.y),Ve.push(Dt.x,Dt.y),A&&vd(this.layoutVertexExtArray,T.projectTilePoint(We.x,We.y,a),T.upVector(a,We.x,We.y))}B&&(ne===0||ie)&&(Mt.length!==0&&ce(Mt,Mt[0])&&Mt.pop(),this.groundEffect.addData(Mt,ye,y))}const Ne=wp(Ve,Me);for(let nt=0;nt<Ne.length;nt+=3)this.footprintIndices.emplaceBack(Re.vertexOffset+Ne[nt+0],Re.vertexOffset+Ne[nt+1],Re.vertexOffset+Ne[nt+2]),this.indexArray.emplaceBack(Ee+Ne[nt],Ee+Ne[nt+2],Ee+Ne[nt+1]),De.primitiveLength++;Re.indexCount+=Ne.length,Re.vertexCount+=this.footprintVertices.length-Re.vertexOffset}for(let Ve=0;Ve<me.length;Ve++){const Me=me[Ve];R.startRing(D,Me[0]);let Ne=Me.length>4&&pv(Me[Me.length-2],Me[0],Me[1]),nt=ne?VS(Me[Me.length-2],Me[0],Me[1],ne):0;const Ge=[];let Mt,xt,He;xt=Me[1].sub(Me[0])._perp()._unit();let Xt=!0;for(let Dt=1,At=0;Dt<Me.length;Dt++){let We=Me[Dt-1],$t=Me[Dt];const mi=Me[Dt===Me.length-1?1:Dt+1];if(R.appendEdge(D,$t,We),lg($t,We,ye)){ne&&(xt=mi.sub($t)._perp()._unit(),Xt=!Xt);continue}const Yt=$t.sub(We)._perp(),_i=Yt.x/(Math.abs(Yt.x)+Math.abs(Yt.y)),ii=Yt.y>0?1:0,Ai=We.dist($t);if(At+Ai>32768&&(At=0),ne){He=mi.sub($t)._perp()._unit();let Ni=dv(We,$t,mi,hv(xt,He),ne);isNaN(Ni)&&(Ni=0);const Hi=$t.sub(We)._unit();We=We.add(Hi.mult(nt))._round(),$t=$t.add(Hi.mult(-Ni))._round(),nt=Ni,xt=He,B&&this.zoom>=17&&(ce(Ge,We)||Ge.push(We),ce(Ge,$t)||Ge.push($t))}const li=De.vertexLength,cr=Me.length>4&&pv(We,$t,mi);let Oi=mv(At,Ne,Xt);if(xd(this.layoutVertexArray,We.x,We.y,_i,ii,0,0,Oi),xd(this.layoutVertexArray,We.x,We.y,_i,ii,0,1,Oi),At+=Ai,Oi=mv(At,cr,!Xt),Ne=cr,xd(this.layoutVertexArray,$t.x,$t.y,_i,ii,0,0,Oi),xd(this.layoutVertexArray,$t.x,$t.y,_i,ii,0,1,Oi),De.vertexLength+=4,this.indexArray.emplaceBack(li+0,li+1,li+2),this.indexArray.emplaceBack(li+1,li+3,li+2),De.primitiveLength+=2,ne){const Ni=Ee+(Dt===1?Me.length-2:Dt-2),Hi=Dt===1?Ee:Ni+1;if(this.indexArray.emplaceBack(li+1,Ni,li+3),this.indexArray.emplaceBack(Ni,Hi,li+3),De.primitiveLength+=2,Mt===void 0&&(Mt=li),!lg(mi,Me[Dt],ye)){const Bi=Dt===Me.length-1?Mt:De.vertexLength;this.indexArray.emplaceBack(li+2,li+3,Bi),this.indexArray.emplaceBack(li+3,Bi+1,Bi),this.indexArray.emplaceBack(li+3,Hi,Bi+1),De.primitiveLength+=3}Xt=!Xt}if(A){const Ni=this.layoutVertexExtArray,Hi=T.projectTilePoint(We.x,We.y,a),Bi=T.projectTilePoint($t.x,$t.y,a),Ir=T.upVector(a,We.x,We.y),rr=T.upVector(a,$t.x,$t.y);vd(Ni,Hi,Ir),vd(Ni,Hi,Ir),vd(Ni,Bi,rr),vd(Ni,Bi,rr)}}C&&(Ee+=Me.length-1),B&&ne&&this.zoom>=17&&(Ge.length!==0&&ce(Ge,Ge[0])&&Ge.pop(),this.groundEffect.addData(Ge,ye,y,ne>0))}this.footprintSegments.push(Re),je.triangleCount=this.indexArray.length-je.triangleArrayOffset,this.polygonSegments.push(je),++D.footprintSegLen,++D.polygonSegLen}if(D.vertexCount=this.layoutVertexArray.length-D.vertexArrayOffset,D.groundVertexCount=this.groundEffect.vertexArray.length-D.groundVertexArrayOffset,D.vertexCount!==0){if(D.centroidXY=R.borders?sv:this.encodeCentroid(R,D),this.centroidData.push(D),R.borders){this.featuresOnBorder.push(R);const me=this.featuresOnBorder.length-1;for(let ye=0;ye<R.borders.length;ye++)R.borders[ye][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ye].push(me)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,l,h,a,_),this.groundEffect.addPaintPropertiesData(e,n,l,h,a,_),this.maxHeight=Math.max(this.maxHeight,N)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,n)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}splitToSubtiles(){const e=[];for(let p=0;p<this.centroidData.length;p++){const _=this.centroidData[p],y=+(_.min.y+_.max.y>_t),v=2*y+(+(_.min.x+_.max.x>_t)^y);for(let T=0;T<_.polygonSegLen;T++){const A=_.polygonSegIdx+T;e.push({centroidIdx:p,subtile:v,polygonSegmentIdx:A,triangleSegmentIdx:this.polygonSegments[A].triangleSegIdx})}}const i=new sn;e.sort((p,_)=>p.triangleSegmentIdx===_.triangleSegmentIdx?p.subtile-_.subtile:p.triangleSegmentIdx-_.triangleSegmentIdx);let n=0,a=0,l=0;for(const p of e){if(p.triangleSegmentIdx!==n)break;l++}const h=e.length;for(;a!==e.length;){n=e[a].triangleSegmentIdx;let p=0,_=a,y=a;for(let v=_;v<l&&e[v].subtile===p;v++)y++;for(;_!==l;){const v=e[_];p=v.subtile;const T=this.centroidData[v.centroidIdx].min.clone(),A=this.centroidData[v.centroidIdx].max.clone(),C={vertexOffset:this.segments.segments[n].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[n].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=_;R<y;R++){const D=e[R],B=this.polygonSegments[D.polygonSegmentIdx],N=this.centroidData[D.centroidIdx].min,H=this.centroidData[D.centroidIdx].max,K=this.indexArray.uint16;for(let Y=B.triangleArrayOffset;Y<B.triangleArrayOffset+B.triangleCount;Y++)i.emplaceBack(K[3*Y],K[3*Y+1],K[3*Y+2]);C.primitiveLength+=B.triangleCount,T.x=Math.min(T.x,N.x),T.y=Math.min(T.y,N.y),A.x=Math.max(A.x,H.x),A.y=Math.max(A.y,H.y)}C.primitiveLength>0&&this.triangleSubSegments.push({segment:C,min:T,max:A}),_=y;for(let R=_;R<l&&e[R].subtile===e[_].subtile;R++)y++}a=l;for(let v=a;v<h&&e[v].triangleSegmentIdx===e[a].triangleSegmentIdx;v++)l++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,n){let a=0,l=0;const h=1<<e.canonical.z;if(i){const D=i.getMinMaxForTile(e);D&&(a=D.min,l=D.max)}l+=this.maxHeight;const p=e.toUnwrapped();let _;const y=[p.canonical.x/h+p.wrap,p.canonical.y/h],v=[(p.canonical.x+1)/h+p.wrap,(p.canonical.y+1)/h],T=new Br,A=(D,B,N)=>[D[0]*(1-N[0])+B[0]*N[0],D[1]*(1-N[1])+B[1]*N[1]],C=[],R=[];for(const D of this.triangleSubSegments){C[0]=D.min.x/_t,C[1]=D.min.y/_t,R[0]=D.max.x/_t,R[1]=D.max.y/_t;const B=A(y,v,C),N=A(y,v,R);if(new kr([B[0],B[1],a],[N[0],N[1],l]).intersectsPrecise(n)===0){_&&(T.segments.push(_),_=void 0);continue}const H=D.segment;_&&_.vertexOffset!==H.vertexOffset&&(T.segments.push(_),_=void 0),_?(_.vertexLength+=H.vertexLength,_.primitiveLength+=H.primitiveLength):_={vertexOffset:H.vertexOffset,primitiveLength:H.primitiveLength,vertexLength:H.vertexLength,primitiveOffset:H.primitiveOffset,sortKey:void 0,vaos:{}}}return _&&T.segments.push(_),T}encodeCentroid(e,i){const n=e.centroid(),a=i.span(),l=Math.min(7,Math.round(a.x*this.tileToMeter/10)),h=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new Ue(zt(n.x,1,_t-1)<<3|l,zt(n.y,1,_t-1)<<3|h)}encodeBorderCentroid(e){if(!e.borders)return new Ue(0,0);const i=e.borders,n=Number.MAX_VALUE;if(i[0][0]!==n||i[1][0]!==n){const a=i[0][0]!==n?0:1;return new Ue(6|(i[0][0]!==n?0:65528),(i[a][0]+i[a][1])/2<<3|6)}{const a=i[2][0]!==n?2:3;return new Ue((i[a][0]+i[a][1])/2<<3|6,6|(i[2][0]!==n?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Ga,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,n=e.vertexCount+e.vertexArrayOffset,a=e.flags&Ga?sv:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==a.y||l!==a.x){for(let h=i;h<n;++h)this.centroidVertexArray.emplace(h,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const n=i.getReplacementRegionsForTile(e.toUnwrapped());if(function(l,h){if(l.length!==h.length)return!1;for(let p=0;p<l.length;p++)if(l[p].sourceId!==h[p].sourceId||!Hx(l[p],h[p]))return!1;return!0}(this.activeReplacements,n))return;if(this.activeReplacements=n,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const l of this.centroidData)l.flags&=2147483647;const a=[];for(const l of this.activeReplacements){const h=Math.pow(2,l.footprintTileId.canonical.z-e.canonical.z);for(const p of this.centroidData)if(!(p.flags&Ga||l.min.x>p.max.x||p.min.x>l.max.x||l.min.y>p.max.y||p.min.y>l.max.y))for(let _=0;_<p.footprintSegLen;_++){const y=this.footprintSegments[p.footprintSegIdx+_];if(a.length=0,US(this.footprintVertices,y.vertexOffset,y.vertexCount,l.footprintTileId.canonical,e.canonical,a),Yx(l.footprint,a,this.footprintIndices.uint16,y.indexOffset,y.indexCount,-y.vertexOffset,-h)){p.flags|=Ga;break}}}for(const l of this.centroidData)this.writeCentroidToBuffer(l);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,n){let a=!1;for(let l=0;l<n.footprintSegLen;l++){const h=this.footprintSegments[n.footprintSegIdx+l];let p=0;for(const _ of h.ringIndices){for(let y=p,v=_+p-1;y<_+p;v=y++){const T=this.footprintVertices.int16[2*(y+h.vertexOffset)+0],A=this.footprintVertices.int16[2*(y+h.vertexOffset)+1],C=this.footprintVertices.int16[2*(v+h.vertexOffset)+1];A>i!=C>i&&e<(this.footprintVertices.int16[2*(v+h.vertexOffset)+0]-T)*(i-A)/(C-A)+T&&(a=!a)}p=_}}return a}getHeightAtTileCoord(e,i){let n=Number.NEGATIVE_INFINITY,a=!0;const l=4*(e+_t)*_t+(i+_t);if(this.partLookup.hasOwnProperty(l)){const h=this.partLookup[l];return h?{height:h.height,hidden:!!(h.flags&Ga)}:void 0}for(const h of this.centroidData)e>h.max.x||h.min.x>e||i>h.max.y||h.min.y>i||this.footprintContainsPoint(e,i,h)&&h&&h.height>n&&(n=h.height,this.partLookup[l]=h,a=!!(h.flags&Ga));if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:a};this.partLookup[l]=void 0}}function hv(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function VS(t,e,i,n){const a=e.sub(t)._perp()._unit(),l=i.sub(e)._perp()._unit();return dv(t,e,i,hv(a,l),n)}function dv(t,e,i,n,a){const l=Math.sqrt(1-n*n);return Math.min(t.dist(e)/3,e.dist(i)/3,a*l/n)}function lg(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function fv(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function pv(t,e,i){if(t.x<0||t.x>=_t||e.x<0||e.x>=_t||i.x<0||i.x>=_t)return!1;const n=i.sub(e),a=n.perp(),l=t.sub(e);return(n.x*l.x+n.y*l.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(l.x*l.x+l.y*l.y))>-.866&&a.x*l.x+a.y*l.y<0}function mv(t,e,i){const n=e?2|t:-3&t;return i?1|n:-2&n}function _v(){const t=Math.PI/32,e=Math.tan(t),i=Pe;return i*Math.sqrt(1+2*e*e)-i}function gv(t,e,i){const n=1<<i.z,a=oi(i.x/n),l=oi((i.x+1)/n),h=Ii(i.y/n),p=Ii((i.y+1)/n);return function(_,y,v,T,A=0,C){const R=[];if(!_.length||!v||!T)return R;const D=(ie,ce)=>{for(const me of ie)R.push({polygon:me,bounds:ce})},B=Math.ceil(Math.log2(v)),N=Math.ceil(Math.log2(T)),H=B-N,K=[];for(let ie=0;ie<Math.abs(H);ie++)K.push(H>0?0:1);for(let ie=0;ie<Math.min(B,N);ie++)K.push(0),K.push(1);let Y=_;if(Y=Sp(Y,y[0].y-A,y[1].y+A,1),Y=Sp(Y,y[0].x-A,y[1].x+A,0),!Y.length)return R;const ne=[];for(K.length?ne.push({polygons:Y,bounds:y,depth:0}):D(Y,y);ne.length;){const ie=ne.pop(),ce=ie.depth,me=K[ce],ye=ie.bounds[0],Ee=ie.bounds[1],xe=me===0?ye.x:ye.y,De=me===0?Ee.x:Ee.y,je=C?C(me,xe,De):.5*(xe+De),Re=Sp(ie.polygons,xe-A,je+A,me),Ve=Sp(ie.polygons,je-A,De+A,me);if(Re.length){const Me=[ye,new Ue(me===0?je:Ee.x,me===1?je:Ee.y)];K.length>ce+1?ne.push({polygons:Re,bounds:Me,depth:ce+1}):D(Re,Me)}if(Ve.length){const Me=[new Ue(me===0?je:ye.x,me===1?je:ye.y),Ee];K.length>ce+1?ne.push({polygons:Ve,bounds:Me,depth:ce+1}):D(Ve,Me)}}return R}(t,e,Math.ceil((l-a)/11.25),Math.ceil((h-p)/11.25),1,(_,y,v)=>{if(_===0)return .5*(y+v);{const T=Ii((i.y+y/_t)/n);return(Qt(.5*(Ii((i.y+v/_t)/n)+T))*n-i.y)*_t}})}function US(t,e,i,n,a,l){const h=Math.pow(2,n.z-a.z);for(let p=0;p<i;p++){let _=t.int16[2*(p+e)+0],y=t.int16[2*(p+e)+1];_=(_+a.x*_t)*h-n.x*_t,y=(y+a.y*_t)*h-n.y*_t,l.push(new Ue(_,y))}}wt(Cp,"FillExtrusionBucket",{omit:["layers","features"]}),wt(av,"PartData"),wt(ov,"FootprintSegment"),wt(lv,"BorderCentroidData"),wt(uv,"GroundEffect");const jS=new Pr({visibility:new tt(be["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new tt(be["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var GS={paint:new Pr({"fill-extrusion-opacity":new tt(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gt(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new tt(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new tt(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gt(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gt(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gt(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new tt(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new tt(be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new tt(be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new tt(be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new tt(be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new tt(be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new tt(be["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new tt(be["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Gt(be["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Gt(be["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new tt(be["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new tt(be["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new tt(be["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new tt(be["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new tt(be["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:jS};class ou extends Ue{constructor(e,i,n){super(e,i),this.z=n}}function bd(t,e){return t.x*e.x+t.y*e.y}function yv(t,e){if(t.length===1){let i=0;const n=e[i++];let a;for(;!a||n.equals(a);)if(a=e[i++],!a)return 1/0;for(;i<e.length;i++){const l=e[i],h=t[0],p=a.sub(n),_=l.sub(n),y=h.sub(n),v=bd(p,p),T=bd(p,_),A=bd(_,_),C=bd(y,p),R=bd(y,_),D=v*A-T*T,B=(A*C-T*R)/D,N=(v*R-T*C)/D,H=n.z*(1-B-N)+a.z*B+l.z*N;if(isFinite(H))return H}return 1/0}{let i=1/0;for(const n of e)i=Math.min(i,n.z);return i}}function xv(t,e,i,n,a,l,h,p){const _=h*a.getElevationAt(t,e,!0,!0),y=l[0]!==0,v=y?l[1]===0?h*(l[0]/7-450):h*function(T,A,C){const R=Math.floor(A[0]/8),D=Math.floor(A[1]/8),B=10*(A[0]-8*R),N=10*(A[1]-8*D),H=T.getElevationAt(R,D,!0,!0),K=T.getMeterToDEM(C),Y=Math.floor(.5*(B*K-1)),ne=Math.floor(.5*(N*K-1)),ie=T.tileCoordToPixel(R,D),ce=2*Y+1,me=2*ne+1,ye=function(Ve,Me,Ne,nt,Ge){return[Ve.getElevationAtPixel(Me,Ne,!0),Ve.getElevationAtPixel(Me+Ge,Ne,!0),Ve.getElevationAtPixel(Me,Ne+Ge,!0),Ve.getElevationAtPixel(Me+nt,Ne+Ge,!0)]}(T,ie.x-Y,ie.y-ne,ce,me),Ee=Math.abs(ye[0]-ye[1]),xe=Math.abs(ye[2]-ye[3]),De=Math.abs(ye[0]-ye[2])+Math.abs(ye[1]-ye[3]),je=Math.min(.25,.5*K*(Ee+xe)/ce),Re=Math.min(.25,.5*K*De/me);return H+Math.max(je*B,Re*N)}(a,l,p):_;return{base:_+(i===0)?-1:i,top:y?Math.max(v+n,_+i+2):_+n}}const $S=Ki([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:qS}=$S,ZS=Ki([{name:"a_packed",components:4,type:"Float32"}]),{members:HS}=ZS;class vv{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Ua({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const n=this.getKey(e,i);return this.positions[n]}trim(){const e=this.width,i=this.height=Xr(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,n){const a=[];let l=e.length%2==1?-e[e.length-1]*n:0,h=e[0]*n,p=!0;a.push({left:l,right:h,isDash:p,zeroLength:e[0]===0});let _=e[0];for(let y=1;y<e.length;y++){p=!p;const v=e[y];l=_*n,_+=v,h=_*n,a.push({left:l,right:h,isDash:p,zeroLength:v===0})}return a}addRoundDash(e,i,n){const a=i/2;for(let l=-n;l<=n;l++){const h=this.width*(this.nextRow+n+l);let p=0,_=e[p];for(let y=0;y<this.width;y++){y/_.right>1&&(_=e[++p]);const v=Math.abs(y-_.left),T=Math.abs(y-_.right),A=Math.min(v,T);let C;const R=l/n*(a+1);if(_.isDash){const D=a-Math.abs(R);C=Math.sqrt(A*A+D*D)}else C=a-Math.sqrt(A*A+R*R);this.image.data[h+y]=Math.max(0,Math.min(255,C+128))}}}addRegularDash(e,i){for(let _=e.length-1;_>=0;--_){const y=e[_],v=e[_+1];y.zeroLength?e.splice(_,1):v&&v.isDash===y.isDash&&(v.left=y.left,e.splice(_,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const l=this.width*this.nextRow;let h=0,p=e[h];for(let _=0;_<this.width;_++){_/p.right>1&&(p=e[++h]);const y=Math.abs(_-p.left),v=Math.abs(_-p.right),T=Math.min(y,v);this.image.data[l+_]=Math.max(0,Math.min(255,(p.isDash?T:-T)+i+128))}}addDash(e,i){const n=this.getKey(e,i);if(this.positions[n])return this.positions[n];const a=i==="round",l=a?7:0,h=2*l+1;if(this.nextRow+h>this.height)return pe("LineAtlas out of space"),null;e.length===0&&e.push(1);let p=0;for(let v=0;v<e.length;v++)e[v]<0&&(pe("Negative value is found in line dasharray, replacing values with 0"),e[v]=0),p+=e[v];if(p!==0){const v=this.width/p,T=this.getDashRanges(e,this.width,v);a?this.addRoundDash(T,v,l):this.addRegularDash(T,i==="square"?.5*v:0)}const _=this.nextRow+l;this.nextRow+=h;const y={tl:[_,l],br:[p,0]};return this.positions[n]=y,y}}wt(vv,"LineAtlas");const WS=Ep.types,XS=Math.cos(Math.PI/180*37.5);class cg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Qh,this.layoutVertexArray2=new Eo,this.indexArray=new sn,this.programConfigurations=new j(e.layers,e.zoom),this.segments=new Br,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,n,a){this.hasPattern=ng("line",this.layers,i);const l=this.layers[0].layout.get("line-sort-key"),h=[];for(const{feature:v,id:T,index:A,sourceLayerIndex:C}of e){const R=this.layers[0]._featureFilter.needGeometry,D=en(v,R);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom),D,n))continue;const B=l?l.evaluate(D,{},n):void 0,N={id:T,properties:v.properties,type:v.type,sourceLayerIndex:C,index:A,geometry:R?D.geometry:an(v,n,a),patterns:{},sortKey:B};h.push(N)}l&&h.sort((v,T)=>v.sortKey-T.sortKey);const{lineAtlas:p,featureIndex:_}=i,y=this.addConstantDashes(p);for(const v of h){const{geometry:T,index:A,sourceLayerIndex:C}=v;if(y&&this.addFeatureDashes(v,p),this.hasPattern){const R=sg("line",this.layers,v,this.zoom,i);this.patternFeatures.push(R)}else this.addFeature(v,T,A,n,p.positions,i.availableImages,i.brightness);_.insert(e[A].feature,T,A,C,this.index)}}addConstantDashes(e){let i=!1;for(const n of this.layers){const a=n.paint.get("line-dasharray").value,l=n.layout.get("line-cap").value;if(a.kind!=="constant"||l.kind!=="constant")i=!0;else{const h=l.value,p=a.value;if(!p)continue;e.addDash(p,h)}}return i}addFeatureDashes(e,i){const n=this.zoom;for(const a of this.layers){const l=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if(l.kind==="constant"&&h.kind==="constant")continue;let p,_;if(l.kind==="constant"){if(p=l.value,!p)continue}else p=l.evaluate({zoom:n},e);_=h.kind==="constant"?h.value:h.evaluate({zoom:n},e),i.addDash(p,_),e.patterns[a.id]=i.getKey(p,_)}}update(e,i,n,a,l){const h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,h?this.stateDependentLayers:this.layers,n,a,l)}addFeatures(e,i,n,a,l,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,i,n,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,HS)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qS),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,n,a,l,h,p){const _=this.layers[0].layout,y=_.get("line-join").evaluate(e,{}),v=_.get("line-cap").evaluate(e,{}),T=_.get("line-miter-limit"),A=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const C of i)this.addLine(C,e,y,v,T,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,l,h,a,p)}addLine(e,i,n,a,l,h){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let N=0;N<e.length-1;N++)this.totalDistance+=e[N].dist(e[N+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const p=WS[i.type]==="Polygon";let _=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let y=0;for(;y<_-1&&e[y].equals(e[y+1]);)y++;if(_<(p?3:2))return;n==="bevel"&&(l=1.05);const v=this.overscaling<=16?15*_t/(512*this.overscaling):0,T=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray);let A,C,R,D,B;this.e1=this.e2=-1,p&&(A=e[_-2],B=e[y].sub(A)._unit()._perp());for(let N=y;N<_;N++){if(R=N===_-1?p?e[y+1]:void 0:e[N+1],R&&e[N].equals(R))continue;B&&(D=B),A&&(C=A),A=e[N],B=R?R.sub(A)._unit()._perp():D,D=D||B;let H=D.add(B);H.x===0&&H.y===0||H._unit();const K=D.x*B.x+D.y*B.y,Y=H.x*B.x+H.y*B.y,ne=Y!==0?1/Y:1/0,ie=2*Math.sqrt(2-2*Y),ce=Y<XS&&C&&R,me=D.x*B.y-D.y*B.x>0;if(ce&&N>y){const xe=A.dist(C);if(xe>2*v){const De=A.sub(A.sub(C)._mult(v/xe)._round());this.updateDistance(C,De),this.addCurrentVertex(De,D,0,0,T),C=De}}const ye=C&&R;let Ee=ye?n:p?"butt":a;if(ye&&Ee==="round"&&(ne<h?Ee="miter":ne<=2&&(Ee="fakeround")),Ee==="miter"&&ne>l&&(Ee="bevel"),Ee==="bevel"&&(ne>2&&(Ee="flipbevel"),ne<l&&(Ee="miter")),C&&this.updateDistance(C,A),Ee==="miter")H._mult(ne),this.addCurrentVertex(A,H,0,0,T);else if(Ee==="flipbevel"){if(ne>100)H=B.mult(-1);else{const xe=ne*D.add(B).mag()/D.sub(B).mag();H._perp()._mult(xe*(me?-1:1))}this.addCurrentVertex(A,H,0,0,T),this.addCurrentVertex(A,H.mult(-1),0,0,T)}else if(Ee==="bevel"||Ee==="fakeround"){const xe=-Math.sqrt(ne*ne-1),De=me?xe:0,je=me?0:xe;if(C&&this.addCurrentVertex(A,D,De,je,T),Ee==="fakeround"){const Re=Math.round(180*ie/Math.PI/20);for(let Ve=1;Ve<Re;Ve++){let Me=Ve/Re;if(Me!==.5){const nt=Me-.5;Me+=Me*nt*(Me-1)*((1.0904+K*(K*(3.55645-1.43519*K)-3.2452))*nt*nt+(.848013+K*(.215638*K-1.06021)))}const Ne=B.sub(D)._mult(Me)._add(D)._unit()._mult(me?-1:1);this.addHalfVertex(A,Ne.x,Ne.y,!1,me,0,T)}}R&&this.addCurrentVertex(A,B,-De,-je,T)}else if(Ee==="butt")this.addCurrentVertex(A,H,0,0,T);else if(Ee==="square"){const xe=C?1:-1;C||this.addCurrentVertex(A,H,xe,xe,T),this.addCurrentVertex(A,H,0,0,T),C&&this.addCurrentVertex(A,H,xe,xe,T)}else Ee==="round"&&(C&&(this.addCurrentVertex(A,D,0,0,T),this.addCurrentVertex(A,D,1,1,T,!0)),R&&(this.addCurrentVertex(A,B,-1,-1,T,!0),this.addCurrentVertex(A,B,0,0,T)));if(ce&&N<_-1){const xe=A.dist(R);if(xe>2*v){const De=A.add(R.sub(A)._mult(v/xe)._round());this.updateDistance(A,De),this.addCurrentVertex(De,B,0,0,T),A=De}}}}addCurrentVertex(e,i,n,a,l,h=!1){const p=i.y*a-i.x,_=-i.y-i.x*a;this.addHalfVertex(e,i.x+i.y*n,i.y-i.x*n,h,!1,n,l),this.addHalfVertex(e,p,_,h,!0,-a,l)}addHalfVertex({x:e,y:i},n,a,l,h,p,_){this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(i<<1)+(h?1:0),Math.round(63*n)+128,Math.round(63*a)+128,1+(p===0?0:p<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const y=_.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,y),_.primitiveLength++),h?this.e2=y:this.e1=y}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}wt(cg,"LineBucket",{omit:["layers","patternFeatures"]});const YS=new Pr({"line-cap":new Gt(be.layout_line["line-cap"]),"line-join":new Gt(be.layout_line["line-join"]),"line-miter-limit":new tt(be.layout_line["line-miter-limit"]),"line-round-limit":new tt(be.layout_line["line-round-limit"]),"line-sort-key":new Gt(be.layout_line["line-sort-key"]),visibility:new tt(be.layout_line.visibility)});var bv={paint:new Pr({"line-opacity":new Gt(be.paint_line["line-opacity"]),"line-color":new Gt(be.paint_line["line-color"]),"line-translate":new tt(be.paint_line["line-translate"]),"line-translate-anchor":new tt(be.paint_line["line-translate-anchor"]),"line-width":new Gt(be.paint_line["line-width"]),"line-gap-width":new Gt(be.paint_line["line-gap-width"]),"line-offset":new Gt(be.paint_line["line-offset"]),"line-blur":new Gt(be.paint_line["line-blur"]),"line-dasharray":new Gt(be.paint_line["line-dasharray"]),"line-pattern":new Gt(be.paint_line["line-pattern"]),"line-gradient":new Qo(be.paint_line["line-gradient"]),"line-trim-offset":new tt(be.paint_line["line-trim-offset"]),"line-emissive-strength":new tt(be.paint_line["line-emissive-strength"]),"line-border-width":new Gt(be.paint_line["line-border-width"]),"line-border-color":new Gt(be.paint_line["line-border-color"])}),layout:YS};function wv(t,e,i){return e*(_t/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}function Tv(t,e){return 1/wv(t,1,e.tileZoom)}function Ev(t,e,i,n){return t.translatePosMatrix(n||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Sv=t=>{const e=[];Av(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=t.paint.get("line-trim-offset");return i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function Av(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}const Mv=new class extends Gt{possiblyEvaluate(t,e){return e=new Cr(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,n){return e=dr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,n)}}(bv.paint.properties["line-width"].specification);function Iv(t,e){return e>0?e+2*t:t}Mv.useIntegerZoom=!0;const KS=Ki([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),JS=Ki([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),QS=Ki([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ki([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const eA=Ki([{name:"a_z_offset",components:1,type:"Float32"}],4),tA=Ki([{name:"a_texb",components:2,type:"Uint16"}]),iA=Ki([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),rA=Ki([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Ki([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Cv=Ki([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nA=Ki([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ki([{name:"triangle",components:3,type:"Uint16"}]),Ki([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ki([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Ki([{type:"Float32",name:"offsetX"}]),Ki([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Tn=24;const Ys=128;function ug(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Cr(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:a}=i;let l=0;for(;l<n.length&&n[l]<=t;)l++;l=Math.max(0,l-1);let h=l;for(;h<n.length&&n[h]<t+1;)h++;h=Math.min(n.length-1,h);const p=n[l],_=n[h];return i.kind==="composite"?{kind:"composite",minZoom:p,maxZoom:_,interpolationType:a}:{kind:"camera",minZoom:p,maxZoom:_,minSize:i.evaluate(new Cr(p)),maxSize:i.evaluate(new Cr(_)),interpolationType:a}}}function Pp(t,{uSize:e,uSizeT:i},{lowerSize:n,upperSize:a}){return t.kind==="source"?n/Ys:t.kind==="composite"?Si(n/Ys,a/Ys,i):e}function au(t,e){let i=0,n=0;if(t.kind==="constant")n=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:a,minZoom:l,maxZoom:h}=t,p=a?zt(Qn.interpolationFactor(a,e,l,h),0,1):0;t.kind==="camera"?n=Si(t.minSize,t.maxSize,p):i=p}return{uSizeT:i,uSize:n}}var sA=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ys,evaluateSizeForFeature:Pp,evaluateSizeForZoom:au,getSizeData:ug});function oA(t,e,i){return t.sections.forEach(n=>{n.text=function(a,l,h){const p=l.layout.get("text-transform").evaluate(h,{});return p==="uppercase"?a=a.toLocaleUpperCase():p==="lowercase"&&(a=a.toLocaleLowerCase()),es.applyArabicShaping&&(a=es.applyArabicShaping(a)),a}(n.text,e,i)}),t}const wd={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function aA(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function lA(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}var cA={read:function(t,e,i,n,a){var l,h,p=8*a-n-1,_=(1<<p)-1,y=_>>1,v=-7,T=i?a-1:0,A=i?-1:1,C=t[e+T];for(T+=A,l=C&(1<<-v)-1,C>>=-v,v+=p;v>0;l=256*l+t[e+T],T+=A,v-=8);for(h=l&(1<<-v)-1,l>>=-v,v+=n;v>0;h=256*h+t[e+T],T+=A,v-=8);if(l===0)l=1-y;else{if(l===_)return h?NaN:1/0*(C?-1:1);h+=Math.pow(2,n),l-=y}return(C?-1:1)*h*Math.pow(2,l-n)},write:function(t,e,i,n,a,l){var h,p,_,y=8*l-a-1,v=(1<<y)-1,T=v>>1,A=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,C=n?0:l-1,R=n?1:-1,D=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(p=isNaN(e)?1:0,h=v):(h=Math.floor(Math.log(e)/Math.LN2),e*(_=Math.pow(2,-h))<1&&(h--,_*=2),(e+=h+T>=1?A/_:A*Math.pow(2,1-T))*_>=2&&(h++,_/=2),h+T>=v?(p=0,h=v):h+T>=1?(p=(e*_-1)*Math.pow(2,a),h+=T):(p=e*Math.pow(2,T-1)*Math.pow(2,a),h=0));a>=8;t[i+C]=255&p,C+=R,p/=256,a-=8);for(h=h<<a|p,y+=a;y>0;t[i+C]=255&h,C+=R,h/=256,y-=8);t[i+C-R]|=128*D}},Pv=Mr,Rp=cA;function Mr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Mr.Varint=0,Mr.Fixed64=1,Mr.Bytes=2,Mr.Fixed32=5;var hg=4294967296,Rv=1/hg,Lv=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function aa(t){return t.type===Mr.Bytes?t.readVarint()+t.pos:t.pos+1}function lu(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Dv(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var a=i.pos-1;a>=t;a--)i.buf[a+n]=i.buf[a]}function uA(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function hA(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function dA(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function fA(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function pA(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function mA(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function _A(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function gA(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function yA(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Lp(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function cu(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function zv(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Mr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),a=n>>3,l=this.pos;this.type=7&n,t(a,e,this),this.pos===l&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Lp(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=zv(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Lp(this.buf,this.pos)+Lp(this.buf,this.pos+4)*hg;return this.pos+=8,t},readSFixed64:function(){var t=Lp(this.buf,this.pos)+zv(this.buf,this.pos+4)*hg;return this.pos+=8,t},readFloat:function(){var t=Rp.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Rp.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(a,l,h){var p,_,y=h.buf;if(p=(112&(_=y[h.pos++]))>>4,_<128||(p|=(127&(_=y[h.pos++]))<<3,_<128)||(p|=(127&(_=y[h.pos++]))<<10,_<128)||(p|=(127&(_=y[h.pos++]))<<17,_<128)||(p|=(127&(_=y[h.pos++]))<<24,_<128)||(p|=(1&(_=y[h.pos++]))<<31,_<128))return lu(a,p,l);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Lv?function(i,n,a){return Lv.decode(i.subarray(n,a))}(this.buf,e,t):function(i,n,a){for(var l="",h=n;h<a;){var p,_,y,v=i[h],T=null,A=v>239?4:v>223?3:v>191?2:1;if(h+A>a)break;A===1?v<128&&(T=v):A===2?(192&(p=i[h+1]))==128&&(T=(31&v)<<6|63&p)<=127&&(T=null):A===3?(_=i[h+2],(192&(p=i[h+1]))==128&&(192&_)==128&&((T=(15&v)<<12|(63&p)<<6|63&_)<=2047||T>=55296&&T<=57343)&&(T=null)):A===4&&(_=i[h+2],y=i[h+3],(192&(p=i[h+1]))==128&&(192&_)==128&&(192&y)==128&&((T=(15&v)<<18|(63&p)<<12|(63&_)<<6|63&y)<=65535||T>=1114112)&&(T=null)),T===null?(T=65533,A=1):T>65535&&(T-=65536,l+=String.fromCharCode(T>>>10&1023|55296),T=56320|1023&T),l+=String.fromCharCode(T),h+=A}return l}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Mr.Bytes)return t.push(this.readVarint(e));var i=aa(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Mr.Bytes)return t.push(this.readSVarint());var e=aa(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Mr.Bytes)return t.push(this.readBoolean());var e=aa(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Mr.Bytes)return t.push(this.readFloat());var e=aa(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Mr.Bytes)return t.push(this.readDouble());var e=aa(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Mr.Bytes)return t.push(this.readFixed32());var e=aa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Mr.Bytes)return t.push(this.readSFixed32());var e=aa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Mr.Bytes)return t.push(this.readFixed64());var e=aa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Mr.Bytes)return t.push(this.readSFixed64());var e=aa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Mr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Mr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Mr.Fixed32)this.pos+=4;else{if(e!==Mr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),cu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),cu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),cu(this.buf,-1&t,this.pos),cu(this.buf,Math.floor(t*Rv),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),cu(this.buf,-1&t,this.pos),cu(this.buf,Math.floor(t*Rv),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var n,a;if(e>=0?(n=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(l,h,p){p.buf[p.pos++]=127&l|128,l>>>=7,p.buf[p.pos++]=127&l|128,l>>>=7,p.buf[p.pos++]=127&l|128,l>>>=7,p.buf[p.pos++]=127&l|128,p.buf[p.pos]=127&(l>>>=7)}(n,0,i),function(l,h){var p=(7&l)<<4;h.buf[h.pos++]|=p|((l>>>=3)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l)))))}(a,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(n,a,l){for(var h,p,_=0;_<a.length;_++){if((h=a.charCodeAt(_))>55295&&h<57344){if(!p){h>56319||_+1===a.length?(n[l++]=239,n[l++]=191,n[l++]=189):p=h;continue}if(h<56320){n[l++]=239,n[l++]=191,n[l++]=189,p=h;continue}h=p-55296<<10|h-56320|65536,p=null}else p&&(n[l++]=239,n[l++]=191,n[l++]=189,p=null);h<128?n[l++]=h:(h<2048?n[l++]=h>>6|192:(h<65536?n[l++]=h>>12|224:(n[l++]=h>>18|240,n[l++]=h>>12&63|128),n[l++]=h>>6&63|128),n[l++]=63&h|128)}return l}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Dv(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Rp.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Rp.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&Dv(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,Mr.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,uA,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,hA,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,pA,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,dA,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,fA,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,mA,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,_A,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,gA,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,yA,e)},writeBytesField:function(t,e){this.writeTag(t,Mr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Mr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Mr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Mr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Mr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Mr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Mr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Mr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Mr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Mr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var uu=Jt(Pv);const dg=3;function xA(t,e,i){e.glyphs=[],t===1&&i.readMessage(vA,e)}function vA(t,e,i){if(t===3){const{id:n,bitmap:a,width:l,height:h,left:p,top:_,advance:y}=i.readMessage(bA,{});e.glyphs.push({id:n,bitmap:new Ua({width:l+2*dg,height:h+2*dg},a),metrics:{width:l,height:h,left:p,top:_,advance:y}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function bA(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}const kv=dg,As={horizontal:1,vertical:2,horizontalOnly:3};class Td{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const n=new Td;return n.scale=e||1,n.fontStack=i,n}static forImage(e){const i=new Td;return i.imageName=e,i}}class hu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const n=new hu;for(let a=0;a<e.sections.length;a++){const l=e.sections[a];l.image?n.addImageSection(l):n.addTextSection(l,i)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,n){let a="";for(let l=0;l<i.length;l++){const h=i.charCodeAt(l+1)||null,p=i.charCodeAt(l-1)||null;a+=!n&&(h&&Nf(h)&&!wd[i[l+1]]||p&&Nf(p)&&!wd[i[l-1]])||!wd[i[l]]?i[l]:wd[i[l]]}return a}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&Dp[this.text.charCodeAt(n)];n++)e++;let i=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&Dp[this.text.charCodeAt(n)];n--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const n=new hu;return n.text=this.text.substring(e,i),n.sectionIndex=this.sectionIndex.slice(e,i),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Td.forText(e.scale,e.fontStack||i));const n=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(n)}addImageSection(e){const i=e.image?e.image.namePrimary:"";if(i.length===0)return void pe("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCodePoint(n),this.sections.push(Td.forImage(i)),this.sectionIndex.push(this.sections.length-1)):pe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function fg(t,e,i,n,a,l,h,p,_,y,v,T,A,C,R){const D=hu.fromFeature(t,a);T===As.vertical&&D.verticalizePunctuation(A);let B=[];const N=function(ie,ce,me,ye,Ee,xe){if(!ie)return[];const De=[],je=function(Ne,nt,Ge,Mt,xt,He){let Xt=0;for(let Dt=0;Dt<Ne.length();Dt++){const At=Ne.getSection(Dt);Xt+=Ov(Ne.getCodePoint(Dt),At,Mt,xt,nt,He)}return Xt/Math.max(1,Math.ceil(Xt/Ge))}(ie,ce,me,ye,Ee,xe),Re=ie.text.indexOf("​")>=0;let Ve=0;for(let Ne=0;Ne<ie.length();Ne++){const nt=ie.getSection(Ne),Ge=ie.getCodePoint(Ne);if(Dp[Ge]||(Ve+=Ov(Ge,nt,ye,Ee,ce,xe)),Ne<ie.length()-1){const Mt=!((Me=Ge)<11904||!(Pt["Bopomofo Extended"](Me)||Pt.Bopomofo(Me)||Pt["CJK Compatibility Forms"](Me)||Pt["CJK Compatibility Ideographs"](Me)||Pt["CJK Compatibility"](Me)||Pt["CJK Radicals Supplement"](Me)||Pt["CJK Strokes"](Me)||Pt["CJK Symbols and Punctuation"](Me)||Pt["CJK Unified Ideographs Extension A"](Me)||Pt["CJK Unified Ideographs"](Me)||Pt["Enclosed CJK Letters and Months"](Me)||Pt["Halfwidth and Fullwidth Forms"](Me)||Pt.Hiragana(Me)||Pt["Ideographic Description Characters"](Me)||Pt["Kangxi Radicals"](Me)||Pt["Katakana Phonetic Extensions"](Me)||Pt.Katakana(Me)||Pt["Vertical Forms"](Me)||Pt["Yi Radicals"](Me)||Pt["Yi Syllables"](Me)));(wA[Ge]||Mt||nt.imageName)&&De.push(Fv(Ne+1,Ve,je,De,TA(Ge,ie.getCodePoint(Ne+1),Mt&&Re),!1))}}var Me;return Nv(Fv(ie.length(),Ve,je,De,0,!0))}(D,y,l,e,n,C),{processBidirectionalText:H,processStyledBidirectionalText:K}=es;if(H&&D.sections.length===1){const ie=H(D.toString(),N);for(const ce of ie){const me=new hu;me.text=ce,me.sections=D.sections;for(let ye=0;ye<ce.length;ye++)me.sectionIndex.push(0);B.push(me)}}else if(K){const ie=K(D.text,D.sectionIndex,N);for(const ce of ie){const me=new hu;me.text=ce[0],me.sectionIndex=ce[1],me.sections=D.sections,B.push(me)}}else B=function(ie,ce){const me=[],ye=ie.text;let Ee=0;for(const xe of ce)me.push(ie.substring(Ee,xe)),Ee=xe;return Ee<ye.length&&me.push(ie.substring(Ee,ye.length)),me}(D,N);const Y=[],ne={positionedLines:Y,text:D.toString(),top:v[1],bottom:v[1],left:v[0],right:v[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ie,ce,me,ye,Ee,xe,De,je,Re,Ve,Me,Ne){let nt=0,Ge=0,Mt=0;const xt=je==="right"?1:je==="left"?0:.5;let He=!1;for(const mi of Ee){const Yt=mi.getSections();for(const _i of Yt){if(_i.imageName)continue;const ii=ce[_i.fontStack];if(ii&&(He=ii.ascender!==void 0&&ii.descender!==void 0,!He))break}if(!He)break}let Xt=0;for(const mi of Ee){mi.trim();const Yt=mi.getMaxScale(),_i=(Yt-1)*Tn,ii={positionedGlyphs:[],lineOffset:0};ie.positionedLines[Xt]=ii;const Ai=ii.positionedGlyphs;let li=0;if(!mi.length()){Ge+=xe,++Xt;continue}let cr=0,Oi=0;for(let Hi=0;Hi<mi.length();Hi++){const Bi=mi.getSection(Hi),Ir=mi.getSectionIndex(Hi),rr=mi.getCodePoint(Hi);let Fr=Bi.scale,rn=null,vn=null,Er=null,Dr=Tn,hn=0;const dn=!(Re===As.horizontal||!Me&&!Bh(rr)||Me&&(Dp[rr]||(Dt=rr,Pt.Arabic(Dt)||Pt["Arabic Supplement"](Dt)||Pt["Arabic Extended-A"](Dt)||Pt["Arabic Presentation Forms-A"](Dt)||Pt["Arabic Presentation Forms-B"](Dt))));if(Bi.imageName){const fn=ye[Bi.imageName];if(!fn)continue;Er=Bi.imageName,ie.iconsInText=ie.iconsInText||!0,vn=fn.paddedRect;const mr=fn.displaySize;Fr=Fr*Tn/Ne,rn={width:mr[0],height:mr[1],left:0,top:-kv,advance:dn?mr[1]:mr[0],localGlyph:!1},hn=He?-rn.height*Fr:Yt*Tn-17-mr[1]*Fr,Dr=rn.advance;const hs=(dn?mr[0]:mr[1])*Fr-Tn*Yt;hs>0&&hs>li&&(li=hs)}else{const fn=me[Bi.fontStack];if(!fn)continue;fn[rr]&&(vn=fn[rr]);const mr=ce[Bi.fontStack];if(!mr)continue;const hs=mr.glyphs[rr];if(!hs)continue;if(rn=hs.metrics,Dr=rr!==8203?Tn:0,He){const Ya=mr.ascender!==void 0?Math.abs(mr.ascender):0,Wn=mr.descender!==void 0?Math.abs(mr.descender):0,On=(Ya+Wn)*Fr;cr<On&&(cr=On,Oi=(Ya-Wn)/2*Fr),hn=-Ya*Fr}else hn=(Yt-Fr)*Tn-17}dn?(ie.verticalizable=!0,Ai.push({glyph:rr,imageName:Er,x:nt,y:Ge+hn,vertical:dn,scale:Fr,localGlyph:rn.localGlyph,fontStack:Bi.fontStack,sectionIndex:Ir,metrics:rn,rect:vn}),nt+=Dr*Fr+Ve):(Ai.push({glyph:rr,imageName:Er,x:nt,y:Ge+hn,vertical:dn,scale:Fr,localGlyph:rn.localGlyph,fontStack:Bi.fontStack,sectionIndex:Ir,metrics:rn,rect:vn}),nt+=rn.advance*Fr+Ve)}Ai.length!==0&&(Mt=Math.max(nt-Ve,Mt),He?Vv(Ai,xt,li,Oi,xe*Yt/2):Vv(Ai,xt,li,0,xe/2)),nt=0;const Ni=xe*Yt+li;ii.lineOffset=Math.max(li,_i),Ge+=Ni,++Xt}var Dt;const At=Ge,{horizontalAlign:We,verticalAlign:$t}=pg(De);(function(mi,Yt,_i,ii,Ai,li){const cr=(Yt-_i)*Ai,Oi=-li*ii;for(const Ni of mi)for(const Hi of Ni.positionedGlyphs)Hi.x+=cr,Hi.y+=Oi})(ie.positionedLines,xt,We,$t,Mt,At),ie.top+=-$t*At,ie.bottom=ie.top+At,ie.left+=-We*Mt,ie.right=ie.left+Mt,ie.hasBaseline=He}(ne,e,i,n,B,h,p,_,T,y,A,R),!function(ie){for(const ce of ie)if(ce.positionedGlyphs.length!==0)return!1;return!0}(Y)&&ne}const Dp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},wA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ov(t,e,i,n,a,l){if(e.imageName){const h=n[e.imageName];return h?h.displaySize[0]*e.scale*Tn/l+a:0}{const h=i[e.fontStack],p=h&&h.glyphs[t];return p?p.metrics.advance*e.scale+a:0}}function Bv(t,e,i,n){const a=Math.pow(t-e,2);return n?t<e?a/2:2*a:a+Math.abs(i)*i}function TA(t,e,i){let n=0;return t===10&&(n-=1e4),i&&(n+=150),t!==40&&t!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function Fv(t,e,i,n,a,l){let h=null,p=Bv(e,i,a,l);for(const _ of n){const y=Bv(e-_.x,i,a,l)+_.badness;y<=p&&(h=_,p=y)}return{index:t,x:e,priorBreak:h,badness:p}}function Nv(t){return t?Nv(t.priorBreak).concat(t.index):[]}function pg(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Vv(t,e,i,n,a){if(!(e||i||n||a))return;const l=t.length-1,h=t[l],p=(h.x+h.metrics.advance*h.scale)*e;for(let _=0;_<=l;_++)t[_].x-=p,t[_].y+=i+n+a}function EA(t,e,i,n){const{horizontalAlign:a,verticalAlign:l}=pg(n),h=i[0]-t.displaySize[0]*a,p=i[1]-t.displaySize[1]*l;return{imagePrimary:t,imageSecondary:e,top:p,bottom:p+t.displaySize[1],left:h,right:h+t.displaySize[0]}}function Uv(t,e,i,n,a,l){const h=t.imagePrimary;let p;if(h.content){const B=h.content,N=h.pixelRatio||1;p=[B[0]/N,B[1]/N,h.displaySize[0]-B[2]/N,h.displaySize[1]-B[3]/N]}const _=e.left*l,y=e.right*l;let v,T,A,C;i==="width"||i==="both"?(C=a[0]+_-n[3],T=a[0]+y+n[1]):(C=a[0]+(_+y-h.displaySize[0])/2,T=C+h.displaySize[0]);const R=e.top*l,D=e.bottom*l;return i==="height"||i==="both"?(v=a[1]+R-n[0],A=a[1]+D+n[2]):(v=a[1]+(R+D-h.displaySize[1])/2,A=v+h.displaySize[1]),{imagePrimary:h,imageSecondary:void 0,top:v,right:T,bottom:A,left:C,collisionPadding:p}}class la extends Ue{constructor(e,i,n,a,l){super(e,i),this.angle=a,this.z=n,l!==void 0&&(this.segment=l)}clone(){return new la(this.x,this.y,this.z,this.angle,this.segment)}}function jv(t,e,i,n,a){if(e.segment===void 0)return!0;let l=e,h=e.segment+1,p=0;for(;p>-i/2;){if(h--,h<0)return!1;p-=t[h].dist(l),l=t[h]}p+=t[h].dist(t[h+1]),h++;const _=[];let y=0;for(;p<i/2;){const v=t[h],T=t[h+1];if(!T)return!1;let A=t[h-1].angleTo(v)-v.angleTo(T);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),_.push({distance:p,angleDelta:A}),y+=A;p-_[0].distance>n;)y-=_.shift().angleDelta;if(y>a)return!1;h++,p+=v.dist(T)}return!0}function Gv(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function $v(t,e,i){return t?.6*e*i:0}function qv(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function SA(t,e,i,n,a,l){const h=$v(i,a,l),p=qv(i,n)*l;let _=0;const y=Gv(t)/2;for(let v=0;v<t.length-1;v++){const T=t[v],A=t[v+1],C=T.dist(A);if(_+C>y){const R=(y-_)/C,D=Si(T.x,A.x,R),B=Si(T.y,A.y,R),N=new la(D,B,0,A.angleTo(T),v);return!h||jv(t,N,p,h,e)?N:void 0}_+=C}}function AA(t,e,i,n,a,l,h,p,_){const y=$v(n,l,h),v=qv(n,a),T=v*h,A=t[0].x===0||t[0].x===_||t[0].y===0||t[0].y===_;return e-T<e/4&&(e=T+e/4),Zv(t,A?e/2*p%e:(v/2+2*l)*h*p%e,e,y,i,T,A,!1,_)}function Zv(t,e,i,n,a,l,h,p,_){const y=l/2,v=Gv(t);let T=0,A=e-i,C=[];for(let R=0;R<t.length-1;R++){const D=t[R],B=t[R+1],N=D.dist(B),H=B.angleTo(D);for(;A+i<T+N;){A+=i;const K=(A-T)/N,Y=Si(D.x,B.x,K),ne=Si(D.y,B.y,K);if(Y>=0&&Y<_&&ne>=0&&ne<_&&A-y>=0&&A+y<=v){const ie=new la(Y,ne,0,H,R);n&&!jv(t,ie,l,n,a)||C.push(ie)}}T+=N}return p||C.length||h||(C=Zv(t,T/2,i,n,a,l,h,!0,_)),C}function Hv(t,e,i,n,a){const l=[];for(let h=0;h<t.length;h++){const p=t[h];let _;for(let y=0;y<p.length-1;y++){let v=p[y],T=p[y+1];v.x<e&&T.x<e||(v.x<e?v=new Ue(e,v.y+(e-v.x)/(T.x-v.x)*(T.y-v.y))._round():T.x<e&&(T=new Ue(e,v.y+(e-v.x)/(T.x-v.x)*(T.y-v.y))._round()),v.y<i&&T.y<i||(v.y<i?v=new Ue(v.x+(i-v.y)/(T.y-v.y)*(T.x-v.x),i)._round():T.y<i&&(T=new Ue(v.x+(i-v.y)/(T.y-v.y)*(T.x-v.x),i)._round()),v.x>=n&&T.x>=n||(v.x>=n?v=new Ue(n,v.y+(n-v.x)/(T.x-v.x)*(T.y-v.y))._round():T.x>=n&&(T=new Ue(n,v.y+(n-v.x)/(T.x-v.x)*(T.y-v.y))._round()),v.y>=a&&T.y>=a||(v.y>=a?v=new Ue(v.x+(a-v.y)/(T.y-v.y)*(T.x-v.x),a)._round():T.y>=a&&(T=new Ue(v.x+(a-v.y)/(T.y-v.y)*(T.x-v.x),a)._round()),_&&v.equals(_[_.length-1])||(_=[v],l.push(_)),_.push(T)))))}}return l}function Wv(t){let e=0,i=0;for(const h of t)e+=h.w*h.h,i=Math.max(i,h.w);t.sort((h,p)=>p.h-h.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let a=0,l=0;for(const h of t)for(let p=n.length-1;p>=0;p--){const _=n[p];if(!(h.w>_.w||h.h>_.h)){if(h.x=_.x,h.y=_.y,l=Math.max(l,h.y+h.h),a=Math.max(a,h.x+h.w),h.w===_.w&&h.h===_.h){const y=n.pop();p<n.length&&(n[p]=y)}else h.h===_.h?(_.x+=h.w,_.w-=h.w):h.w===_.w?(_.y+=h.h,_.h-=h.h):(n.push({x:_.x+h.w,y:_.y,w:_.w-h.w,h:h.h}),_.y+=h.h,_.h-=h.h);break}}return{w:a,h:l,fill:e/(a*l)||0}}wt(la,"Anchor");const us=1;class mg{constructor(e,{pixelRatio:i,version:n,stretchX:a,stretchY:l,content:h}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=a,this.stretchY=l,this.content=h,this.version=n}get tl(){return[this.paddedRect.x+us,this.paddedRect.y+us]}get br(){return[this.paddedRect.x+this.paddedRect.w-us,this.paddedRect.y+this.paddedRect.h-us]}get displaySize(){return[(this.paddedRect.w-2*us)/this.pixelRatio,(this.paddedRect.h-2*us)/this.pixelRatio]}}class Xv{constructor(e,i){const n={},a={};this.haveRenderCallbacks=[];const l=[];this.addImages(e,n,l),this.addImages(i,a,l);const{w:h,h:p}=Wv(l),_=new Ss({width:h||1,height:p||1});for(const y in e){const v=e[y],T=n[y].paddedRect;Ss.copy(v.data,_,{x:0,y:0},{x:T.x+us,y:T.y+us},v.data,v.sdf)}for(const y in i){const v=i[y],T=a[y].paddedRect,A=T.x+us,C=T.y+us,R=v.data.width,D=v.data.height;Ss.copy(v.data,_,{x:0,y:0},{x:A,y:C},v.data),Ss.copy(v.data,_,{x:0,y:D-1},{x:A,y:C-1},{width:R,height:1}),Ss.copy(v.data,_,{x:0,y:0},{x:A,y:C+D},{width:R,height:1}),Ss.copy(v.data,_,{x:R-1,y:0},{x:A-1,y:C},{width:1,height:D}),Ss.copy(v.data,_,{x:0,y:0},{x:A+R,y:C},{width:1,height:D})}this.image=_,this.iconPositions=n,this.patternPositions=a}addImages(e,i,n){for(const a in e){const l=e[a],h={x:0,y:0,w:l.data.width+2*us,h:l.data.height+2*us};n.push(h),i[a]=new mg(h,l),l.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,i,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a,n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,n);for(const a in e.getUpdatedImages(n))this.patchUpdatedImage(this.iconPositions[a],e.getImage(a,n),i),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a,n),i)}patchUpdatedImage(e,i,n){if(!e||!i||e.version===i.version)return;e.version=i.version;const[a,l]=e.tl,h=!!Object.keys(this.patternPositions).length;n.update(i.data,{useMipmap:h},{x:a,y:l})}}wt(mg,"ImagePosition"),wt(Xv,"ImageAtlas");const Ed=1e20;function Yv(t,e,i,n,a,l,h,p,_){for(let y=e;y<e+n;y++)Kv(t,i*l+y,l,a,h,p,_);for(let y=i;y<i+a;y++)Kv(t,y*l+e,1,n,h,p,_)}function Kv(t,e,i,n,a,l,h){l[0]=0,h[0]=-Ed,h[1]=Ed,a[0]=t[e];for(let p=1,_=0,y=0;p<n;p++){a[p]=t[e+p*i];const v=p*p;do{const T=l[_];y=(a[p]-a[T]+v-T*T)/(p-T)/2}while(y<=h[_]&&--_>-1);_++,l[_]=p,h[_]=y,h[_+1]=Ed}for(let p=0,_=0;p<n;p++){for(;h[_+1]<p;)_++;const y=l[_],v=p-y;t[e+p*i]=a[y]+v*v}}const Ks=2,_g={none:0,ideographs:1,all:2};class du{constructor(e,i,n){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=n,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,n){const a=[],l=this.urls[i]||se.GLYPHS_URL;for(const h in e)for(const p of e[h])a.push({stack:h,id:p});Wr(a,({stack:h,id:p},_)=>{let y=this.entries[h];y||(y=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=y.glyphs[p];if(v!==void 0)return void _(null,{stack:h,id:p,glyph:v});if(v=this._tinySDF(y,h,p),v)return y.glyphs[p]=v,void _(null,{stack:h,id:p,glyph:v});const T=Math.floor(p/256);if(256*T>65535)return void _(new Error("glyphs > 65535 not supported"));if(y.ranges[T])return void _(null,{stack:h,id:p,glyph:v});let A=y.requests[T];A||(A=y.requests[T]=[],du.loadGlyphRange(h,T,l,this.requestManager,(C,R)=>{if(R){y.ascender=R.ascender,y.descender=R.descender;for(const D in R.glyphs)this._doesCharSupportLocalGlyph(+D)||(y.glyphs[+D]=R.glyphs[+D]);y.ranges[T]=!0}for(const D of A)D(C,R);delete y.requests[T]})),A.push((C,R)=>{C?_(C):R&&_(null,{stack:h,id:p,glyph:R.glyphs[p]||null})})},(h,p)=>{if(h)n(h);else if(p){const _={};for(const{stack:y,id:v,glyph:T}of p)_[y]===void 0&&(_[y]={}),_[y].glyphs===void 0&&(_[y].glyphs={}),_[y].glyphs[v]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},_[y].ascender=this.entries[y].ascender,_[y].descender=this.entries[y].descender;n(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==_g.none&&(this.localGlyphMode===_g.all?!!this.localFontFamily:!!this.localFontFamily&&(Pt["CJK Unified Ideographs"](e)||Pt["Hangul Syllables"](e)||Pt.Hiragana(e)||Pt.Katakana(e)||Pt["CJK Symbols and Punctuation"](e)||Pt["CJK Unified Ideographs Extension A"](e)||Pt["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,i,n){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(n))return;let l=e.tinySDF;if(!l){let D="400";/bold/i.test(i)?D="900":/medium/i.test(i)?D="500":/light/i.test(i)&&(D="200"),l=e.tinySDF=new du.TinySDF({fontFamily:a,fontWeight:D,fontSize:24*Ks,buffer:3*Ks,radius:8*Ks}),l.fontWeight=D}if(this.localGlyphs[l.fontWeight][n])return this.localGlyphs[l.fontWeight][n];const h=String.fromCodePoint(n),{data:p,width:_,height:y,glyphWidth:v,glyphHeight:T,glyphLeft:A,glyphTop:C,glyphAdvance:R}=l.draw(h);return this.localGlyphs[l.fontWeight][n]={id:n,bitmap:new Ua({width:_,height:y},p),metrics:{width:v/Ks,height:T/Ks,left:A/Ks,top:C/Ks-27,advance:R/Ks,localGlyph:!0}}}}du.loadGlyphRange=function(t,e,i,n,a){const l=256*e,h=l+255,p=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${l}-${h}`),Vn.Glyphs);Fe(p,(_,y)=>{if(_)a(_);else if(y){const v={},T=function(A){return new uu(A).readFields(xA,{})}(y);for(const A of T.glyphs)v[A.id]=A;a(null,{glyphs:v,ascender:T.ascender,descender:T.descender})}})},du.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:n=.25,fontFamily:a="sans-serif",fontWeight:l="normal",fontStyle:h="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=i;const p=this.size=t+4*e,_=this._createCanvas(p),y=this.ctx=_.getContext("2d",{willReadFrequently:!0});y.font=`${h} ${l} ${t}px ${a}`,y.textBaseline="alphabetic",y.textAlign="left",y.fillStyle="black",this.gridOuter=new Float64Array(p*p),this.gridInner=new Float64Array(p*p),this.f=new Float64Array(p),this.z=new Float64Array(p+1),this.v=new Uint16Array(p)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:a,actualBoundingBoxRight:l}=this.ctx.measureText(t),h=Math.ceil(i),p=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-a))),_=Math.min(this.size-this.buffer,h+Math.ceil(n)),y=p+2*this.buffer,v=_+2*this.buffer,T=Math.max(y*v,0),A=new Uint8ClampedArray(T),C={data:A,width:y,height:v,glyphWidth:p,glyphHeight:_,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(p===0||_===0)return C;const{ctx:R,buffer:D,gridInner:B,gridOuter:N}=this;R.clearRect(D,D,p,_),R.fillText(t,D,D+h);const H=R.getImageData(D,D,p,_);N.fill(Ed,0,T),B.fill(0,0,T);for(let K=0;K<_;K++)for(let Y=0;Y<p;Y++){const ne=H.data[4*(K*p+Y)+3]/255;if(ne===0)continue;const ie=(K+D)*y+Y+D;if(ne===1)N[ie]=0,B[ie]=Ed;else{const ce=.5-ne;N[ie]=ce>0?ce*ce:0,B[ie]=ce<0?ce*ce:0}}Yv(N,0,0,y,v,y,this.f,this.v,this.z),Yv(B,D,D,p,_,y,this.f,this.v,this.z);for(let K=0;K<T;K++){const Y=Math.sqrt(N[K])-Math.sqrt(B[K]);A[K]=Math.round(255-255*(Y/this.radius+this.cutoff))}return C}};const $a=us;function Jv(t,e,i,n){const a=[],l=t.imagePrimary,h=l.pixelRatio,p=l.paddedRect.w-2*$a,_=l.paddedRect.h-2*$a,y=t.right-t.left,v=t.bottom-t.top,T=l.stretchX||[[0,p]],A=l.stretchY||[[0,_]],C=(xe,De)=>xe+De[1]-De[0],R=T.reduce(C,0),D=A.reduce(C,0),B=p-R,N=_-D;let H=0,K=R,Y=0,ne=D,ie=0,ce=B,me=0,ye=N;if(l.content&&n){const xe=l.content;H=zp(T,0,xe[0]),Y=zp(A,0,xe[1]),K=zp(T,xe[0],xe[2]),ne=zp(A,xe[1],xe[3]),ie=xe[0]-H,me=xe[1]-Y,ce=xe[2]-xe[0]-K,ye=xe[3]-xe[1]-ne}const Ee=(xe,De,je,Re)=>{const Ve=kp(xe.stretch-H,K,y,t.left),Me=Op(xe.fixed-ie,ce,xe.stretch,R),Ne=kp(De.stretch-Y,ne,v,t.top),nt=Op(De.fixed-me,ye,De.stretch,D),Ge=kp(je.stretch-H,K,y,t.left),Mt=Op(je.fixed-ie,ce,je.stretch,R),xt=kp(Re.stretch-Y,ne,v,t.top),He=Op(Re.fixed-me,ye,Re.stretch,D),Xt=new Ue(Ve,Ne),Dt=new Ue(Ge,Ne),At=new Ue(Ge,xt),We=new Ue(Ve,xt),$t=new Ue(Me/h,nt/h),mi=new Ue(Mt/h,He/h),Yt=e*Math.PI/180;if(Yt){const Oi=Math.sin(Yt),Ni=Math.cos(Yt),Hi=[Ni,-Oi,Oi,Ni];Xt._matMult(Hi),Dt._matMult(Hi),We._matMult(Hi),At._matMult(Hi)}const _i=xe.stretch+xe.fixed,ii=je.stretch+je.fixed,Ai=De.stretch+De.fixed,li=Re.stretch+Re.fixed,cr=t.imageSecondary;return{tl:Xt,tr:Dt,bl:We,br:At,texPrimary:{x:l.paddedRect.x+$a+_i,y:l.paddedRect.y+$a+Ai,w:ii-_i,h:li-Ai},texSecondary:cr?{x:cr.paddedRect.x+$a+_i,y:cr.paddedRect.y+$a+Ai,w:ii-_i,h:li-Ai}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:$t,pixelOffsetBR:mi,minFontScaleX:ce/h/y,minFontScaleY:ye/h/v,isSDF:i}};if(n&&(l.stretchX||l.stretchY)){const xe=Qv(T,B,R),De=Qv(A,N,D);for(let je=0;je<xe.length-1;je++){const Re=xe[je],Ve=xe[je+1];for(let Me=0;Me<De.length-1;Me++)a.push(Ee(Re,De[Me],Ve,De[Me+1]))}}else a.push(Ee({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:p+1},{fixed:0,stretch:_+1}));return a}function zp(t,e,i){let n=0;for(const a of t)n+=Math.max(e,Math.min(i,a[1]))-Math.max(e,Math.min(i,a[0]));return n}function Qv(t,e,i){const n=[{fixed:-$a,stretch:0}];for(const[a,l]of t){const h=n[n.length-1];n.push({fixed:a-h.stretch,stretch:h.stretch}),n.push({fixed:a-h.stretch,stretch:h.stretch+(l-a)})}return n.push({fixed:e+$a,stretch:i}),n}function kp(t,e,i,n){return t/e*i+n}function Op(t,e,i,n){return t-e*i/n}function MA(t,e,i,n){const a=e+t.positionedLines[n].lineOffset;return n===0?i+a/2:i+(a+(e+t.positionedLines[n-1].lineOffset))/2}function IA(t,e=1,i=!1){let n=1/0,a=1/0,l=-1/0,h=-1/0;const p=t[0];for(let C=0;C<p.length;C++){const R=p[C];(!C||R.x<n)&&(n=R.x),(!C||R.y<a)&&(a=R.y),(!C||R.x>l)&&(l=R.x),(!C||R.y>h)&&(h=R.y)}const _=Math.min(l-n,h-a);let y=_/2;const v=new cs([],CA);if(_===0)return new Ue(n,a);for(let C=n;C<l;C+=_)for(let R=a;R<h;R+=_)v.push(new fu(C+y,R+y,y,t));let T=function(C){let R=0,D=0,B=0;const N=C[0];for(let H=0,K=N.length,Y=K-1;H<K;Y=H++){const ne=N[H],ie=N[Y],ce=ne.x*ie.y-ie.x*ne.y;D+=(ne.x+ie.x)*ce,B+=(ne.y+ie.y)*ce,R+=3*ce}return new fu(D/R,B/R,0,C)}(t),A=v.length;for(;v.length;){const C=v.pop();(C.d>T.d||!T.d)&&(T=C,i&&console.log("found best %d after %d probes",Math.round(1e4*C.d)/1e4,A)),C.max-T.d<=e||(y=C.h/2,v.push(new fu(C.p.x-y,C.p.y-y,y,t)),v.push(new fu(C.p.x+y,C.p.y-y,y,t)),v.push(new fu(C.p.x-y,C.p.y+y,y,t)),v.push(new fu(C.p.x+y,C.p.y+y,y,t)),A+=4)}return i&&(console.log(`num probes: ${A}`),console.log(`best distance: ${T.d}`)),T.p}function CA(t,e){return e.max-t.max}class fu{constructor(e,i,n,a){this.p=new Ue(e,i),this.h=n,this.d=function(l,h){let p=!1,_=1/0;for(let y=0;y<h.length;y++){const v=h[y];for(let T=0,A=v.length,C=A-1;T<A;C=T++){const R=v[T],D=v[C];R.y>l.y!=D.y>l.y&&l.x<(D.x-R.x)*(l.y-R.y)/(D.y-R.y)+R.x&&(p=!p),_=Math.min(_,Fa(l,R,D))}}return(p?1:-1)*Math.sqrt(_)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const gg=Number.POSITIVE_INFINITY,PA=Math.sqrt(2);function e1(t,[e,i]){let n=0,a=0;if(i===gg){e<0&&(e=0);const l=e/PA;switch(t){case"top-right":case"top-left":a=l-7;break;case"bottom-right":case"bottom-left":a=7-l;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(t){case"top-right":case"bottom-right":n=-l;break;case"top-left":case"bottom-left":n=l;break;case"left":n=e;break;case"right":n=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":a=i-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-i}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}}return[n,a]}function yg(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function RA(t,e,i,n,a,l,h,p,_,y,v,T,A,C,R){let D=l.textMaxSize.evaluate(e,{},T);D===void 0&&(D=h);const B=t.layers[0].layout,N=B.get("icon-offset").evaluate(e,{},T),H=i1(i.horizontal)||i.vertical,K=A.name==="globe",Y=Tn,ne=h/Y,ie=t.tilePixelRatio*D/Y,ce=(Ve=t.overscaling,t.zoom>18&&Ve>2&&(Ve>>=1),Math.max(_t/(512*Ve),1)*B.get("symbol-spacing")),me=B.get("text-padding")*t.tilePixelRatio,ye=B.get("icon-padding")*t.tilePixelRatio,Ee=ni(B.get("text-max-angle")),xe=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",De=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",je=B.get("symbol-placement"),Re=ce/2;var Ve;const Me=B.get("icon-text-fit").evaluate(e,{},T),Ne=B.get("icon-text-fit-padding").evaluate(e,{},T),nt=Me!=="none";let Ge;t.hasAnyIconTextFit===!1&&nt&&(t.hasAnyIconTextFit=!0),n&&nt&&(t.allowVerticalPlacement&&i.vertical&&(Ge=Uv(n,i.vertical,Me,Ne,N,ne)),H&&(n=Uv(n,H,Me,Ne,N,ne)));const Mt=(xt,He,Xt)=>{if(He.x<0||He.x>=_t||He.y<0||He.y>=_t)return;let Dt=null;if(K){const{x:At,y:We,z:$t}=A.projectTilePoint(He.x,He.y,Xt);Dt={anchor:new la(At,We,$t,0,void 0),up:A.upVector(Xt,He.x,He.y)}}(function(At,We,$t,mi,Yt,_i,ii,Ai,li,cr,Oi,Ni,Hi,Bi,Ir,rr,Fr,rn,vn,Er,Dr,hn,dn,fn,mr,hs,Ya){const Wn=At.addToLineVertexArray(We,mi);let On,Is,Vd,rm,ib,rb,nb,sb=0,ob=0,ab=0,lb=0,jg=-1,Gg=-1;const Lo={};let cb=ud("");const oc=$t?$t.anchor:We,$g=li.layout.get("icon-text-fit").evaluate(Dr,{},mr)!=="none";let qg=0,Zg=0;if(li._unevaluatedLayout.getValue("text-radial-offset")===void 0?[qg,Zg]=li.layout.get("text-offset").evaluate(Dr,{},mr).map(ds=>ds*Tn):(qg=li.layout.get("text-radial-offset").evaluate(Dr,{},mr)*Tn,Zg=gg),At.allowVerticalPlacement&&Yt.vertical){const ds=Yt.vertical;if(Ir)rb=xg(ds),Ai&&(nb=xg(Ai));else{const fs=li.layout.get("text-rotate").evaluate(Dr,{},mr)+90;Vd=Bp(cr,oc,We,Oi,Ni,Hi,ds,Bi,fs,rr),Ai&&(rm=Bp(cr,oc,We,Oi,Ni,Hi,Ai,rn,fs))}}if(_i){const ds=li.layout.get("icon-rotate").evaluate(Dr,{},mr),fs=Jv(_i,ds,dn,$g),bu=Ai?Jv(Ai,ds,dn,$g):void 0;Is=Bp(cr,oc,We,Oi,Ni,Hi,_i,rn,ds),sb=4*fs.length;const ub=At.iconSizeData;let ac=null;ub.kind==="source"?(ac=[Ys*li.layout.get("icon-size").evaluate(Dr,{},mr)],ac[0]>qa&&pe(`${At.layerIds[0]}: Value for "icon-size" is >= ${Sd}. Reduce your "icon-size".`)):ub.kind==="composite"&&(ac=[Ys*hn.compositeIconSizes[0].evaluate(Dr,{},mr),Ys*hn.compositeIconSizes[1].evaluate(Dr,{},mr)],(ac[0]>qa||ac[1]>qa)&&pe(`${At.layerIds[0]}: Value for "icon-size" is >= ${Sd}. Reduce your "icon-size".`)),At.addSymbols(At.icon,fs,ac,Er,vn,Dr,!1,$t,We,Wn.lineStartIndex,Wn.lineLength,-1,fn,mr,hs,Ya),jg=At.icon.placedSymbolArray.length-1,bu&&(ob=4*bu.length,At.addSymbols(At.icon,bu,ac,Er,vn,Dr,As.vertical,$t,We,Wn.lineStartIndex,Wn.lineLength,-1,fn,mr,hs,Ya),Gg=At.icon.placedSymbolArray.length-1)}for(const ds in Yt.horizontal){const fs=Yt.horizontal[ds];On||(cb=ud(fs.text),Ir?ib=xg(fs):On=Bp(cr,oc,We,Oi,Ni,Hi,fs,Bi,li.layout.get("text-rotate").evaluate(Dr,{},mr),rr));const bu=fs.positionedLines.length===1;if(ab+=t1(At,$t,We,fs,ii,li,Ir,Dr,rr,Wn,Yt.vertical?As.horizontal:As.horizontalOnly,bu?Object.keys(Yt.horizontal):[ds],Lo,jg,hn,fn,mr,hs),bu)break}Yt.vertical&&(lb+=t1(At,$t,We,Yt.vertical,ii,li,Ir,Dr,rr,Wn,As.vertical,["vertical"],Lo,Gg,hn,fn,mr,hs));let Ka=-1;const Hg=(ds,fs)=>ds?Math.max(ds,fs):fs;Ka=Hg(ib,Ka),Ka=Hg(rb,Ka),Ka=Hg(nb,Ka);const XM=Ka>-1?1:0;At.glyphOffsetArray.length>=65535&&pe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Dr.sortKey!==void 0&&At.addToSortKeyRanges(At.symbolInstances.length,Dr.sortKey),At.symbolInstances.emplaceBack(We.x,We.y,oc.x,oc.y,oc.z,Lo.right>=0?Lo.right:-1,Lo.center>=0?Lo.center:-1,Lo.left>=0?Lo.left:-1,Lo.vertical>=0?Lo.vertical:-1,jg,Gg,cb,On!==void 0?On:At.collisionBoxArray.length,On!==void 0?On+1:At.collisionBoxArray.length,Vd!==void 0?Vd:At.collisionBoxArray.length,Vd!==void 0?Vd+1:At.collisionBoxArray.length,Is!==void 0?Is:At.collisionBoxArray.length,Is!==void 0?Is+1:At.collisionBoxArray.length,rm||At.collisionBoxArray.length,rm?rm+1:At.collisionBoxArray.length,Oi,ab,lb,sb,ob,XM,0,qg,Zg,Ka,0,$g?1:0)})(t,He,Dt,xt,i,n,a,Ge,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,me,xe,_,0,ye,De,N,e,l,y,v,T,C,R)};if(je==="line")for(const xt of Hv(e.geometry,0,0,_t,_t)){const He=AA(xt,ce,Ee,i.vertical||H,n,Y,ie,t.overscaling,_t);for(const Xt of He)H&&LA(t,H.text,Re,Xt)||Mt(xt,Xt,T)}else if(je==="line-center"){for(const xt of e.geometry)if(xt.length>1){const He=SA(xt,Ee,i.vertical||H,n,Y,ie);He&&Mt(xt,He,T)}}else if(e.type==="Polygon")for(const xt of rg(e.geometry,0)){const He=IA(xt,16);Mt(xt[0],new la(He.x,He.y,0,0,void 0),T)}else if(e.type==="LineString")for(const xt of e.geometry)Mt(xt,new la(xt[0].x,xt[0].y,0,0,void 0),T);else if(e.type==="Point")for(const xt of e.geometry)for(const He of xt)Mt([He],new la(He.x,He.y,0,0,void 0),T)}const Sd=255,qa=Sd*Ys;function t1(t,e,i,n,a,l,h,p,_,y,v,T,A,C,R,D,B,N){const H=function(ne,ie,ce,me,ye,Ee,xe,De){const je=[];if(ie.positionedLines.length===0)return je;const Re=me.layout.get("text-rotate").evaluate(Ee,{})*Math.PI/180,Ve=function(Mt){const xt=Mt[0],He=Mt[1],Xt=xt*He;return Xt>0?[xt,-He]:Xt<0?[-xt,He]:xt===0?[He,xt]:[He,-xt]}(ce);let Me=Math.abs(ie.top-ie.bottom);for(const Mt of ie.positionedLines)Me-=Mt.lineOffset;const Ne=ie.positionedLines.length,nt=Me/Ne;let Ge=ie.top-ce[1];for(let Mt=0;Mt<Ne;++Mt){const xt=ie.positionedLines[Mt];Ge=MA(ie,nt,Ge,Mt);for(const He of xt.positionedGlyphs){if(!He.rect)continue;const Xt=He.rect||{};let Dt=kv+1,At=!0,We=1,$t=0;if(He.imageName){const Er=xe[He.imageName];if(!Er)continue;if(Er.sdf){pe("SDF images are not supported in formatted text and will be ignored.");continue}At=!1,We=Er.pixelRatio,Dt=us/We}const mi=(ye||De)&&He.vertical,Yt=He.metrics.advance*He.scale/2,_i=He.metrics,ii=He.rect;if(ii===null)continue;De&&ie.verticalizable&&($t=He.imageName?Yt-He.metrics.width*He.scale/2:0);const Ai=ye?[He.x+Yt,He.y]:[0,0];let li=[0,0],cr=[0,0],Oi=!1;ye||(mi?(cr=[He.x+Yt+Ve[0],He.y+Ve[1]-$t],Oi=!0):li=[He.x+Yt+ce[0],He.y+ce[1]-$t]);const Ni=ii.w*He.scale/(We*(He.localGlyph?Ks:1)),Hi=ii.h*He.scale/(We*(He.localGlyph?Ks:1));let Bi,Ir,rr,Fr;if(mi){const Er=He.y-Ge,Dr=new Ue(-Yt,Yt-Er),hn=-Math.PI/2,dn=new Ue(...cr);Bi=new Ue(-Yt+li[0],li[1]),Bi._rotateAround(hn,Dr)._add(dn),Bi.x+=-Er+Yt,Bi.y-=(_i.left-Dt)*He.scale;const fn=He.imageName?_i.advance*He.scale:Tn*He.scale,mr=String.fromCodePoint(He.glyph);aA(mr)?Bi.x+=(1-Dt)*He.scale:lA(mr)?Bi.x+=fn-_i.height*He.scale+(-Dt-1)*He.scale:Bi.x+=He.imageName||_i.width+2*Dt===ii.w&&_i.height+2*Dt===ii.h?(fn-Hi)/2:(fn-(_i.height+2*Dt)*He.scale)/2,Ir=new Ue(Bi.x,Bi.y-Ni),rr=new Ue(Bi.x+Hi,Bi.y),Fr=new Ue(Bi.x+Hi,Bi.y-Ni)}else{const Er=(_i.left-Dt)*He.scale-Yt+li[0],Dr=(-_i.top-Dt)*He.scale+li[1],hn=Er+Ni,dn=Dr+Hi;Bi=new Ue(Er,Dr),Ir=new Ue(hn,Dr),rr=new Ue(Er,dn),Fr=new Ue(hn,dn)}if(Re){let Er;Er=ye?new Ue(0,0):Oi?new Ue(Ve[0],Ve[1]):new Ue(ce[0],ce[1]),Bi._rotateAround(Re,Er),Ir._rotateAround(Re,Er),rr._rotateAround(Re,Er),Fr._rotateAround(Re,Er)}const rn=new Ue(0,0),vn=new Ue(0,0);je.push({tl:Bi,tr:Ir,bl:rr,br:Fr,texPrimary:Xt,texSecondary:void 0,writingMode:ie.writingMode,glyphOffset:Ai,sectionIndex:He.sectionIndex,isSDF:At,pixelOffsetTL:rn,pixelOffsetBR:vn,minFontScaleX:0,minFontScaleY:0})}}return je}(0,n,_,l,h,p,a,t.allowVerticalPlacement),K=t.textSizeData;let Y=null;K.kind==="source"?(Y=[Ys*l.layout.get("text-size").evaluate(p,{},B)],Y[0]>qa&&pe(`${t.layerIds[0]}: Value for "text-size" is >= ${Sd}. Reduce your "text-size".`)):K.kind==="composite"&&(Y=[Ys*R.compositeTextSizes[0].evaluate(p,{},B),Ys*R.compositeTextSizes[1].evaluate(p,{},B)],(Y[0]>qa||Y[1]>qa)&&pe(`${t.layerIds[0]}: Value for "text-size" is >= ${Sd}. Reduce your "text-size".`)),t.addSymbols(t.text,H,Y,_,h,p,v,e,i,y.lineStartIndex,y.lineLength,C,D,B,N,!1);for(const ne of T)A[ne]=t.text.placedSymbolArray.length-1;return 4*H.length}function i1(t){for(const e in t)return t[e];return null}function Bp(t,e,i,n,a,l,h,p,_,y){let v=h.top,T=h.bottom,A=h.left,C=h.right;const R=h.collisionPadding;if(R&&(A-=R[0],v-=R[1],C+=R[2],T+=R[3]),_){const D=new Ue(A,v),B=new Ue(C,v),N=new Ue(A,T),H=new Ue(C,T),K=ni(_);let Y=new Ue(0,0);y&&(Y=new Ue(y[0],y[1])),D._rotateAround(K,Y),B._rotateAround(K,Y),N._rotateAround(K,Y),H._rotateAround(K,Y),A=Math.min(D.x,B.x,N.x,H.x),C=Math.max(D.x,B.x,N.x,H.x),v=Math.min(D.y,B.y,N.y,H.y),T=Math.max(D.y,B.y,N.y,H.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,A,v,C,T,p,n,a,l),t.length-1}function xg(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function LA(t,e,i,n){const a=t.compareText;if(e in a){const l=a[e];for(let h=l.length-1;h>=0;h--)if(n.dist(l[h])<i)return!0}else a[e]=[];return a[e].push(n),!1}function r1(t,e){const i=t.fovAboveCenter,n=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,a=(t._camera.position[2]*t.worldSize-n)/Math.cos(t._pitch),l=Math.sin(i)*a/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),h=Math.sin(t._pitch)*l+a;return Math.min(1.01*h,a*(1/t._horizonShift))}function Ad(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),n=t.x*i,a=(t.x+1)*i,l=t.y*i,h=(t.y+1)*i,p=oi(n),_=oi(a),y=Ii(l),v=Ii(h),T=e.project(p,y),A=e.project(_,y),C=e.project(_,v),R=e.project(p,v);let D=Math.min(T.x,A.x,C.x,R.x),B=Math.min(T.y,A.y,C.y,R.y),N=Math.max(T.x,A.x,C.x,R.x),H=Math.max(T.y,A.y,C.y,R.y);const K=i/16;function Y(ie,ce,me,ye,Ee,xe){const De=(me+Ee)/2,je=(ye+xe)/2,Re=e.project(oi(De),Ii(je)),Ve=Math.max(0,D-Re.x,B-Re.y,Re.x-N,Re.y-H);D=Math.min(D,Re.x),N=Math.max(N,Re.x),B=Math.min(B,Re.y),H=Math.max(H,Re.y),Ve>K&&(Y(ie,Re,me,ye,De,je),Y(Re,ce,De,je,Ee,xe))}Y(T,A,n,l,a,l),Y(A,C,a,l,a,h),Y(C,R,a,h,n,h),Y(R,T,n,h,n,l),D-=K,B-=K,N+=K,H+=K;const ne=1/Math.max(N-D,H-B);return{scale:ne,x:D*ne,y:B*ne,x2:N*ne,y2:H*ne,projection:e}}function n1(t,{x:e,y:i},n=0){return new Ue(((e-n)*t.scale-t.x)*_t,(i*t.scale-t.y)*_t)}const DA=o.a6.identity(new Float32Array(16));class Za{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new ge(0,0)}projectTilePoint(e,i,n){return{x:e,y:i,z:0}}locationPoint(e,i,n=!0){return e._coordinatePoint(e.locationCoordinate(i),n)}pixelsPerMeter(e,i){return ai(1,e)*i}pixelSpaceConversion(e,i,n){return 1}farthestPixelDistance(e){return r1(e,e.pixelsPerMeter)}pointCoordinate(e,i,n,a){const l=e.horizonLineFromTop(!1),h=new Ue(i,Math.max(l,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,a))}pointCoordinate3D(e,i,n){const a=new Ue(i,n);if(e.elevation)return e.elevation.pointCoordinate(a);{const l=this.pointCoordinate(e,a.x,a.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const n=e.horizonLineFromTop();return i.y<n}createInversionMatrix(e,i){return DA}createTileMatrix(e,i,n){let a,l,h;const p=n.canonical,_=o.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const y=Ad(p,this);a=1,l=y.x+n.wrap*y.scale,h=y.y,o.a6.scale(_,_,[a/y.scale,a/y.scale,e.pixelsPerMeter/i])}else a=i/e.zoomScale(p.z),l=(p.x+Math.pow(2,p.z)*n.wrap)*a,h=p.y*a;return o.a6.translate(_,_,[l,h,0]),o.a6.scale(_,_,[a/_t,a/_t,1]),_}upVector(e,i,n){return[0,0,1]}upVectorScale(e,i,n){return{metersToTile:1}}}class zA extends Za{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,n]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(ni(i));this.n=(a+Math.sin(ni(n)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n,c:a,r0:l}=this,h=ni(e-this.center[0]),p=ni(i),_=Math.sqrt(a-2*n*Math.sin(p))/n;return{x:_*Math.sin(h*n),y:_*Math.cos(h*n)-l,z:0}}unproject(e,i){const{n,c:a,r0:l}=this,h=l+i;let p=Math.atan2(e,Math.abs(h))*Math.sign(h);h*n<0&&(p-=Math.PI*Math.sign(e)*Math.sign(h));const _=ni(this.center[0])*n;p=wn(p,-Math.PI-_,Math.PI-_);const y=zt(br(p/n)+this.center[0],-180,180),v=Math.asin(zt((a-(e*e+h*h)*n*n)/(2*n),-1,1)),T=zt(br(v),-xi,xi);return new ge(y,T)}}const Md=1.340264,Id=-.081106,Cd=893e-6,Pd=.003796,Fp=Math.sqrt(3)/2;class kA extends Za{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(Fp*Math.sin(i)),a=n*n,l=a*a*a;return{x:.5*(e*Math.cos(n)/(Fp*(Md+3*Id*a+l*(7*Cd+9*Pd*a)))/Math.PI+.5),y:1-.5*(n*(Md+Id*a+l*(Cd+Pd*a))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let n=i=(2*(1-i)-1)*Math.PI,a=n*n,l=a*a*a;for(let v,T,A,C=0;C<12&&(T=n*(Md+Id*a+l*(Cd+Pd*a))-i,A=Md+3*Id*a+l*(7*Cd+9*Pd*a),v=T/A,n=zt(n-v,-Math.PI/3,Math.PI/3),a=n*n,l=a*a*a,!(Math.abs(v)<1e-12));++C);const h=Fp*e*(Md+3*Id*a+l*(7*Cd+9*Pd*a))/Math.cos(n),p=Math.asin(Math.sin(n)/Fp),_=zt(180*h/Math.PI,-180,180),y=zt(180*p/Math.PI,-xi,xi);return new ge(_,y)}}class OA extends Za{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const n=360*(e-.5),a=zt(360*(.5-i),-xi,xi);return new ge(n,a)}}const pu=Math.PI/2;function Np(t){return Math.tan((pu+t)/2)}class BA extends Za{constructor(e){super(e),this.center=e.center||[0,30];const[i,n]=this.parallels=e.parallels||[30,30];let a=ni(i),l=ni(n);this.southernCenter=a+l<0,this.southernCenter&&(a=-a,l=-l);const h=Math.cos(a),p=Np(a);this.n=a===l?Math.sin(a):Math.log(h/Math.cos(l))/Math.log(Np(l)/p),this.f=h*Math.pow(Np(a),this.n)/this.n}project(e,i){i=ni(i),this.southernCenter&&(i=-i),e=ni(e-this.center[0]);const n=1e-6,{n:a,f:l}=this;l>0?i<-pu+n&&(i=-pu+n):i>pu-n&&(i=pu-n);const h=l/Math.pow(Np(i),a);let p=h*Math.sin(a*e),_=l-h*Math.cos(a*e);return p=.5*(p/Math.PI+.5),_=.5*(_/Math.PI+.5),{x:p,y:this.southernCenter?_:1-_,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n,f:a}=this,l=a-i,h=Math.sign(l),p=Math.sign(n)*Math.sqrt(e*e+l*l);let _=Math.atan2(e,Math.abs(l))*h;l*n<0&&(_-=Math.PI*Math.sign(e)*h);const y=zt(br(_/n)+this.center[0],-180,180),v=zt(br(2*Math.atan(Math.pow(a/p,1/n))-pu),-xi,xi);return new ge(y,this.southernCenter?-v:v)}}class s1 extends Za{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:hi(e),y:Qt(i),z:0}}unproject(e,i){const n=oi(e),a=Ii(i);return new ge(n,a)}}const o1=ni(xi);class FA extends Za{project(e,i){const n=(i=ni(i))*i,a=n*n;return{x:.5*((e=ni(e))*(.8707-.131979*n+a*(a*(.003971*n-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+n*(.015085+a*(.028874*n-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let n=i=(2*(1-i)-1)*Math.PI,a=25,l=0,h=n*n;do{h=n*n;const y=h*h;l=(n*(1.007226+h*(.015085+y*(.028874*h-.044475-.005916*y)))-i)/(1.007226+h*(.045255+y*(.259866*h-.311325-.005916*11*y))),n=zt(n-l,-o1,o1)}while(Math.abs(l)>1e-6&&--a>0);h=n*n;const p=zt(br(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),_=br(n);return new ge(p,_)}}const a1=ni(xi);class NA extends Za{project(e,i){i=ni(i),e=ni(e);const n=Math.cos(i),a=2/Math.PI,l=Math.acos(n*Math.cos(e/2)),h=Math.sin(l)/l,p=.5*(e*a+2*n*Math.sin(e/2)/h)||0,_=.5*(i+Math.sin(i)/h)||0;return{x:.5*(p/Math.PI+.5),y:1-.5*(_/Math.PI+1),z:0}}unproject(e,i){let n=e=(2*e-.5)*Math.PI,a=i=(2*(1-i)-1)*Math.PI,l=25;const h=1e-6;let p=0,_=0;do{const y=Math.cos(a),v=Math.sin(a),T=2*v*y,A=v*v,C=y*y,R=Math.cos(n/2),D=Math.sin(n/2),B=2*R*D,N=D*D,H=1-C*R*R,K=H?1/H:0,Y=H?Math.acos(y*R)*Math.sqrt(1/H):0,ne=.5*(2*Y*y*D+2*n/Math.PI)-e,ie=.5*(Y*v+a)-i,ce=.5*K*(C*N+Y*y*R*A)+1/Math.PI,me=K*(B*T/4-Y*v*D),ye=.125*K*(T*D-Y*v*C*B),Ee=.5*K*(A*R+Y*N*y)+.5,xe=me*ye-Ee*ce;p=(ie*me-ne*Ee)/xe,_=(ne*ye-ie*ce)/xe,n=zt(n-p,-Math.PI,Math.PI),a=zt(a-_,-a1,a1)}while((Math.abs(p)>h||Math.abs(_)>h)&&--l>0);return new ge(br(n),br(a))}}class l1 extends Za{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ni(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:n,cosPhi:a}=this;return{x:ni(e)*a*n+.5,y:-Math.sin(ni(i))/a*n+.5,z:0}}unproject(e,i){const{scale:n,cosPhi:a}=this,l=-(i-.5)/n,h=zt(br((e-.5)/n)/a,-180,180),p=Math.asin(zt(l*a,-1,1)),_=zt(br(p),-xi,xi);return new ge(h,_)}}class VA extends s1{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,n){const a=pd(e,i,n),l=gp(Ro(n));return o.N.transformMat4(a,a,l),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,i){const n=Le(i.lat,i.lng),a=o.N.normalize([],n),l=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,h=ai(1,0)*_t*l;o.N.scaleAndAdd(n,n,a,h);const p=o.a6.identity(new Float64Array(16));return o.a6.multiply(p,e.pixelMatrix,e.globeMatrix),o.N.transformMat4(n,n,p),new Ue(n[0],n[1])}pixelsPerMeter(e,i){return ai(1,0)*i}pixelSpaceConversion(e,i,n){const a=ai(1,e)*i,l=Si(ai(1,45)*i,a,n);return this.pixelsPerMeter(e,i)/l}createTileMatrix(e,i,n){const a=X_(Ro(n.canonical));return o.a6.multiply(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,i){const{center:n}=e,a=gp(Ro(i));return o.a6.rotateY(a,a,ni(n.lng)),o.a6.rotateX(a,a,ni(n.lat)),o.a6.scale(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,i,n,a){return Sx(e,i,n,!0)||new Di(0,0)}pointCoordinate3D(e,i,n){const a=this.pointCoordinate(e,i,n,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,i){return!Sx(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(a,l){const h=a.cameraToCenterDistance,p=a._centerAltitude*l,_=a._camera,y=a._camera.forward(),v=o.N.add([],o.N.scale([],y,-h),[0,0,p]),T=a.worldSize/(2*Math.PI),A=[0,0,-T],C=a.width/a.height,R=Math.tan(a.fovAboveCenter),D=o.N.scale([],_.up(),R),B=o.N.scale([],_.right(),R*C),N=o.N.normalize([],o.N.add([],o.N.add([],y,D),B)),H=[];let K;if(new $_(v,N).closestPointOnSphere(A,T,H)){const Y=o.N.add([],H,A),ne=o.N.sub([],Y,v);K=Math.cos(a.fovAboveCenter)*o.N.length(ne)}else{const Y=o.N.sub([],v,A),ne=o.N.sub([],A,v);o.N.normalize(ne,ne);const ie=o.N.length(Y)-T;K=Math.sqrt(ie*(ie+2*T));const ce=Math.acos(K/(T+ie))-Math.acos(o.N.dot(y,ne));K*=Math.cos(ce)}return 1.01*K}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=Va(e.zoom);if(n>0){const a=r1(e,ai(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),h=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Si(i,a+l*(1-Math.cos(h)),Math.pow(n,10))}return i}upVector(e,i,n){return pd(i,n,e,1)}upVectorScale(e){return{metersToTile:pp(_p(Ro(e)))}}}function c1(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new s1(t);case"equirectangular":return new OA(t);case"naturalEarth":return new FA(t);case"equalEarth":return new kA(t);case"winkelTripel":return new NA(t);case"albers":return i?new l1(t):new zA(t);case"lambertConformalConic":return i?new l1(t):new BA(t);case"globe":return new VA(t)}throw new Error(`Invalid projection name: ${t.name}`)}const UA=Ep.types,jA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Vp(t,e,i,n,a,l,h,p,_,y,v,T,A){const C=p?Math.min(qa,Math.round(p[0])):0,R=p?Math.min(qa,Math.round(p[1])):0;t.emplaceBack(e,i,Math.round(32*n),Math.round(32*a),l,h,(C<<1)+(_?1:0),R,16*y,16*v,256*T,256*A)}function Up(t,e,i){t.emplaceBack(e,i)}function jp(t,e,i,n,a,l,h){t.emplaceBack(e,i,n,a,l,h)}function Gp(t,e,i,n,a){t.emplaceBack(e,i,n,a),t.emplaceBack(e,i,n,a),t.emplaceBack(e,i,n,a),t.emplaceBack(e,i,n,a)}function GA(t){for(const e of t.sections)if(Fh(e.text))return!0;return!1}class vg{constructor(e){this.layoutVertexArray=new Ul,this.indexArray=new sn,this.programConfigurations=e,this.segments=new Br,this.dynamicLayoutVertexArray=new Eo,this.opacityVertexArray=new td,this.placedSymbolArray=new Xf,this.iconTransitioningVertexArray=new Ls,this.globeExtVertexArray=new ed,this.zOffsetVertexArray=new Gl}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,n,a,l){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,KS.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,QS.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,jA,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,tA.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,JS.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,eA.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}wt(vg,"SymbolBuffers");class bg{constructor(e,i,n){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new n,this.segments=new Br,this.collisionVertexArray=new rd,this.collisionVertexArrayExt=new Eo}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,iA.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,rA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}wt(bg,"CollisionBuffers");class $p{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=o.a6.identity([]),this.placementViewportMatrix=o.a6.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ug(this.zoom,i["text-size"]),this.iconSizeData=ug(this.zoom,i["icon-size"]);const n=this.layers[0].layout,a=n.get("symbol-sort-key"),l=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(h=>As[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=n.get("symbol-z-elevate")}createArrays(){this.text=new vg(new j(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new vg(new j(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Jf,this.lineVertexArray=new Hl,this.symbolInstances=new Kf}calculateGlyphDependencies(e,i,n,a,l){for(let h=0;h<e.length;h++){const p=e.codePointAt(h);if(p===void 0)break;if(i[p]=!0,a&&l&&p<=65535){const _=wd[e.charAt(h)];_&&(i[_.charCodeAt(0)]=!0)}}}populate(e,i,n,a){const l=this.layers[0],h=l.layout,p=this.projection.name==="globe",_=h.get("text-font"),y=h.get("text-field"),v=h.get("icon-image"),T=(y.value.kind!=="constant"||y.value.value instanceof gn&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),A=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,C=h.get("symbol-sort-key");if(this.features=[],!T&&!A)return;const R=i.iconDependencies,D=i.glyphDependencies,B=i.availableImages,N=new Cr(this.zoom);for(const{feature:H,id:K,index:Y,sourceLayerIndex:ne}of e){const ie=l._featureFilter.needGeometry,ce=en(H,ie);if(!l._featureFilter.filter(N,ce,n))continue;if(ie||(ce.geometry=an(H,n,a)),p&&H.type!==1&&n.z<=5){const xe=ce.geometry,De=.98078528056,je=(Re,Ve)=>{const Me=pd(Re.x,Re.y,n,1),Ne=pd(Ve.x,Ve.y,n,1);return o.N.dot(Me,Ne)<De};for(let Re=0;Re<xe.length;Re++)xe[Re]=xn(xe[Re],je)}let me,ye;if(T){const xe=l.getValueAndResolveTokens("text-field",ce,n,B),De=gn.factory(xe);GA(De)&&(this.hasRTLText=!0),(!this.hasRTLText||To()==="unavailable"||this.hasRTLText&&es.isParsed())&&(me=oA(De,l,ce))}if(A){const xe=l.getValueAndResolveTokens("icon-image",ce,n,B);ye=xe instanceof Ht?xe:Ht.fromString(xe)}if(!me&&!ye)continue;const Ee=this.sortFeaturesByKey?C.evaluate(ce,{},n):void 0;if(this.features.push({id:K,text:me,icon:ye,index:Y,sourceLayerIndex:ne,geometry:ce.geometry,properties:H.properties,type:UA[H.type],sortKey:Ee}),ye&&(R[ye.namePrimary]=!0,ye.nameSecondary&&(R[ye.nameSecondary]=!0)),me){const xe=_.evaluate(ce,{},n).join(","),De=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(As.vertical)>=0;for(const je of me.sections)if(je.image)R[je.image.namePrimary]=!0;else{const Re=bo(me.toString()),Ve=je.fontStack||xe,Me=D[Ve]=D[Ve]||{};this.calculateGlyphDependencies(je.text,Me,De,this.allowVerticalPlacement,Re)}}}h.get("symbol-placement")==="line"&&(this.features=function(H){const K={},Y={},ne=[];let ie=0;function ce(xe){ne.push(H[xe]),ie++}function me(xe,De,je){const Re=Y[xe];return delete Y[xe],Y[De]=Re,ne[Re].geometry[0].pop(),ne[Re].geometry[0]=ne[Re].geometry[0].concat(je[0]),Re}function ye(xe,De,je){const Re=K[De];return delete K[De],K[xe]=Re,ne[Re].geometry[0].shift(),ne[Re].geometry[0]=je[0].concat(ne[Re].geometry[0]),Re}function Ee(xe,De,je){const Re=je?De[0][De[0].length-1]:De[0][0];return`${xe}:${Re.x}:${Re.y}`}for(let xe=0;xe<H.length;xe++){const De=H[xe],je=De.geometry,Re=De.text?De.text.toString():null;if(!Re){ce(xe);continue}const Ve=Ee(Re,je),Me=Ee(Re,je,!0);if(Ve in Y&&Me in K&&Y[Ve]!==K[Me]){const Ne=ye(Ve,Me,je),nt=me(Ve,Me,ne[Ne].geometry);delete K[Ve],delete Y[Me],Y[Ee(Re,ne[nt].geometry,!0)]=nt,ne[Ne].geometry=null}else Ve in Y?me(Ve,Me,je):Me in K?ye(Ve,Me,je):(ce(xe),K[Ve]=ie-1,Y[Me]=ie-1)}return ne.filter(xe=>xe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((H,K)=>H.sortKey-K.sortKey)}update(e,i,n,a,l){const h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;const p=h?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,p,n,a,l),this.icon.programConfigurations.updatePaintArrays(e,i,p,n,a,l)}updateZOffset(){const e=(l,h,p)=>{n+=h,n>l.length&&l.resize(n);for(let _=-h;_<0;_++)l.emplace(_+n,p)},i=(l,h,p)=>{a+=h,a>l.length&&l.resize(a);for(let _=-h;_<0;_++)l.emplace(_+a,p)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let n=0,a=0;for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l),{numHorizontalGlyphVertices:p,numVerticalGlyphVertices:_,numIconVertices:y}=h,v=h.zOffset,T=y>0;if((p>0||_>0)&&(e(this.text.zOffsetVertexArray,p,v),e(this.text.zOffsetVertexArray,_,v)),T){const{placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:C}=h;A>=0&&i(this.icon.zOffsetVertexArray,y,v),C>=0&&i(this.icon.zOffsetVertexArray,h.numVerticalIconVertices,v)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=c1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const n=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:l}of i)this.lineVertexArray.emplaceBack(a,l);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,i,n,a,l,h,p,_,y,v,T,A,C,R,D,B){const N=e.indexArray,H=e.layoutVertexArray,K=e.globeExtVertexArray,Y=e.segments.prepareSegment(4*i.length,H,N,this.canOverlap?h.sortKey:void 0),ne=this.glyphOffsetArray.length,ie=Y.vertexLength,ce=this.allowVerticalPlacement&&p===As.vertical?Math.PI/2:0,me=h.text&&h.text.sections;for(let Ee=0;Ee<i.length;Ee++){const{tl:xe,tr:De,bl:je,br:Re,texPrimary:Ve,texSecondary:Me,pixelOffsetTL:Ne,pixelOffsetBR:nt,minFontScaleX:Ge,minFontScaleY:Mt,glyphOffset:xt,isSDF:He,sectionIndex:Xt}=i[Ee],Dt=Y.vertexLength,At=xt[1];if(Vp(H,y.x,y.y,xe.x,At+xe.y,Ve.x,Ve.y,n,He,Ne.x,Ne.y,Ge,Mt),Vp(H,y.x,y.y,De.x,At+De.y,Ve.x+Ve.w,Ve.y,n,He,nt.x,Ne.y,Ge,Mt),Vp(H,y.x,y.y,je.x,At+je.y,Ve.x,Ve.y+Ve.h,n,He,Ne.x,nt.y,Ge,Mt),Vp(H,y.x,y.y,Re.x,At+Re.y,Ve.x+Ve.w,Ve.y+Ve.h,n,He,nt.x,nt.y,Ge,Mt),_){const{x:We,y:$t,z:mi}=_.anchor,[Yt,_i,ii]=_.up;jp(K,We,$t,mi,Yt,_i,ii),jp(K,We,$t,mi,Yt,_i,ii),jp(K,We,$t,mi,Yt,_i,ii),jp(K,We,$t,mi,Yt,_i,ii),Gp(e.dynamicLayoutVertexArray,We,$t,mi,ce)}else Gp(e.dynamicLayoutVertexArray,y.x,y.y,y.z,ce);if(B){const We=Me||Ve;Up(e.iconTransitioningVertexArray,We.x,We.y),Up(e.iconTransitioningVertexArray,We.x+We.w,We.y),Up(e.iconTransitioningVertexArray,We.x,We.y+We.h),Up(e.iconTransitioningVertexArray,We.x+We.w,We.y+We.h)}N.emplaceBack(Dt,Dt+1,Dt+2),N.emplaceBack(Dt+1,Dt+2,Dt+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(xt[0]),Ee!==i.length-1&&Xt===i[Ee+1].sectionIndex||e.programConfigurations.populatePaintArrays(H.length,h,h.index,{},C,R,D,me&&me[Xt])}const ye=_?_.anchor:y;e.placedSymbolArray.emplaceBack(ye.x,ye.y,ye.z,y.x,y.y,ne,this.glyphOffsetArray.length-ne,ie,v,T,y.segment,n?n[0]:0,n?n[1]:0,a[0],a[1],p,0,!1,0,A,0)}_commitLayoutVertex(e,i,n,a,l,h,p){e.emplaceBack(i,n,a,l,h,Math.round(p.x),Math.round(p.y))}_addCollisionDebugVertices(e,i,n,a,l,h,p){const _=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),y=_.vertexLength,v=p.tileAnchorX,T=p.tileAnchorY;for(let C=0;C<4;C++)n.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(n.collisionVertexArrayExt,i,e.padding,p.zOffset),this._commitLayoutVertex(n.layoutVertexArray,a,l,h,v,T,new Ue(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,l,h,v,T,new Ue(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,l,h,v,T,new Ue(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,a,l,h,v,T,new Ue(e.x1,e.y2)),_.vertexLength+=4;const A=n.indexArray;A.emplaceBack(y,y+1),A.emplaceBack(y+1,y+2),A.emplaceBack(y+2,y+3),A.emplaceBack(y+3,y),_.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,n,a,l,h){for(let p=a;p<l;p++){const _=n.get(p),y=this.getSymbolInstanceTextSize(e,h,i,p);this._addCollisionDebugVertices(_,y,this.textCollisionBox,_.projectedAnchorX,_.projectedAnchorY,_.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,i,n,a,l,h){for(let p=a;p<l;p++){const _=n.get(p),y=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._addCollisionDebugVertices(_,y,this.iconCollisionBox,_.projectedAnchorX,_.projectedAnchorY,_.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new bg(jl,Cv.members,Ls),this.iconCollisionBox=new bg(jl,Cv.members,Ls);const n=au(this.iconSizeData,e),a=au(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this._addTextDebugCollisionBoxes(a,e,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._addTextDebugCollisionBoxes(a,e,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._addIconDebugCollisionBoxes(n,e,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._addIconDebugCollisionBoxes(n,e,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}}getSymbolInstanceTextSize(e,i,n,a){const l=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:a),h=Pp(this.textSizeData,e,l)/Tn;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,i,n){const a=this.icon.placedSymbolArray.get(n),l=Pp(this.iconSizeData,e,a);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,i,n,a){e.emplaceBack(i,-n,-n,a),e.emplaceBack(i,n,-n,a),e.emplaceBack(i,n,n,a),e.emplaceBack(i,-n,n,a)}_updateTextDebugCollisionBoxes(e,i,n,a,l,h){for(let p=a;p<l;p++){const _=n.get(p),y=this.getSymbolInstanceTextSize(e,h,i,p);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,y,_.padding,h.zOffset)}}_updateIconDebugCollisionBoxes(e,i,n,a,l,h){for(let p=a;p<l;p++){const _=n.get(p),y=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,y,_.padding,h.zOffset)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=au(this.iconSizeData,e),a=au(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this._updateTextDebugCollisionBoxes(a,e,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._updateTextDebugCollisionBoxes(a,e,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._updateIconDebugCollisionBoxes(n,e,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._updateIconDebugCollisionBoxes(n,e,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,n,a,l,h,p,_,y){const v={};if(i<n){const{x1:T,y1:A,x2:C,y2:R,padding:D,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:K,tileAnchorY:Y,featureIndex:ne}=e.get(i);v.textBox={x1:T,y1:A,x2:C,y2:R,padding:D,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:K,tileAnchorY:Y},v.textFeatureIndex=ne}if(a<l){const{x1:T,y1:A,x2:C,y2:R,padding:D,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:K,tileAnchorY:Y,featureIndex:ne}=e.get(a);v.verticalTextBox={x1:T,y1:A,x2:C,y2:R,padding:D,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:K,tileAnchorY:Y},v.verticalTextFeatureIndex=ne}if(h<p){const{x1:T,y1:A,x2:C,y2:R,padding:D,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:K,tileAnchorY:Y,featureIndex:ne}=e.get(h);v.iconBox={x1:T,y1:A,x2:C,y2:R,padding:D,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:K,tileAnchorY:Y},v.iconFeatureIndex=ne}if(_<y){const{x1:T,y1:A,x2:C,y2:R,padding:D,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:K,tileAnchorY:Y,featureIndex:ne}=e.get(_);v.verticalIconBox={x1:T,y1:A,x2:C,y2:R,padding:D,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:K,tileAnchorY:Y},v.verticalIconFeatureIndex=ne}return v}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const n=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const n=e.placedSymbolArray.get(i),a=n.vertexStartIndex+4*n.numGlyphs;for(let l=n.vertexStartIndex;l<a;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),n=Math.cos(e),a=[],l=[],h=[];for(let p=0;p<this.symbolInstances.length;++p){h.push(p);const _=this.symbolInstances.get(p);a.push(0|Math.round(i*_.tileAnchorX+n*_.tileAnchorY)),l.push(_.featureIndex)}return h.sort((p,_)=>a[p]-a[_]||l[_]-l[p]),h}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===i?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const n=this.symbolInstances.get(i);this.featureSortOrder.push(n.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:p,placedIconSymbolIndex:_,verticalPlacedIconSymbolIndex:y}=n;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),l>=0&&l!==a&&this.addIndicesForPlacedSymbol(this.text,l),h>=0&&h!==l&&h!==a&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&this.addIndicesForPlacedSymbol(this.icon,_),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}wt($p,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),$p.addDynamicAttributes=Gp;const $A=new Pr({"symbol-placement":new tt(be.layout_symbol["symbol-placement"]),"symbol-spacing":new tt(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new tt(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gt(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new tt(be.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new tt(be.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new tt(be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new tt(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new tt(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new tt(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gt(be.layout_symbol["icon-size"]),"icon-text-fit":new Gt(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gt(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gt(be.layout_symbol["icon-image"]),"icon-rotate":new Gt(be.layout_symbol["icon-rotate"]),"icon-padding":new tt(be.layout_symbol["icon-padding"]),"icon-keep-upright":new tt(be.layout_symbol["icon-keep-upright"]),"icon-offset":new Gt(be.layout_symbol["icon-offset"]),"icon-anchor":new Gt(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new tt(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new tt(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new tt(be.layout_symbol["text-rotation-alignment"]),"text-field":new Gt(be.layout_symbol["text-field"]),"text-font":new Gt(be.layout_symbol["text-font"]),"text-size":new Gt(be.layout_symbol["text-size"]),"text-max-width":new Gt(be.layout_symbol["text-max-width"]),"text-line-height":new Gt(be.layout_symbol["text-line-height"]),"text-letter-spacing":new Gt(be.layout_symbol["text-letter-spacing"]),"text-justify":new Gt(be.layout_symbol["text-justify"]),"text-radial-offset":new Gt(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new tt(be.layout_symbol["text-variable-anchor"]),"text-anchor":new Gt(be.layout_symbol["text-anchor"]),"text-max-angle":new tt(be.layout_symbol["text-max-angle"]),"text-writing-mode":new tt(be.layout_symbol["text-writing-mode"]),"text-rotate":new Gt(be.layout_symbol["text-rotate"]),"text-padding":new tt(be.layout_symbol["text-padding"]),"text-keep-upright":new tt(be.layout_symbol["text-keep-upright"]),"text-transform":new Gt(be.layout_symbol["text-transform"]),"text-offset":new Gt(be.layout_symbol["text-offset"]),"text-allow-overlap":new tt(be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new tt(be.layout_symbol["text-ignore-placement"]),"text-optional":new tt(be.layout_symbol["text-optional"]),visibility:new tt(be.layout_symbol.visibility)});var wg={paint:new Pr({"icon-opacity":new Gt(be.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Gt(be.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Gt(be.paint_symbol["text-emissive-strength"]),"icon-color":new Gt(be.paint_symbol["icon-color"]),"icon-halo-color":new Gt(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gt(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gt(be.paint_symbol["icon-halo-blur"]),"icon-translate":new tt(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new tt(be.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Gt(be.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Gt(be.paint_symbol["text-opacity"]),"text-color":new Gt(be.paint_symbol["text-color"],{runtimeType:os,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Gt(be.paint_symbol["text-halo-color"]),"text-halo-width":new Gt(be.paint_symbol["text-halo-width"]),"text-halo-blur":new Gt(be.paint_symbol["text-halo-blur"]),"text-translate":new tt(be.paint_symbol["text-translate"]),"text-translate-anchor":new tt(be.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new tt(be.paint_symbol["icon-color-saturation"])}),layout:$A};class u1{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ma,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}wt(u1,"FormatSectionOverride",{omit:["defaultValue"]});class qp extends $n{constructor(e,i,n){super(e,wg,i,n)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const a=[];for(const l of n)a.indexOf(l)<0&&a.push(l);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,n,a){const l=this.layout.get(e).evaluate(i,{},n,a),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||Il(h.value)||!l?l:function(p,_){return _.replace(/{([^{}]+)}/g,(y,v)=>v in p?String(p[v]):"")}(i.properties,l)}createBucket(e){return new $p(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of wg.paint.overridableProperties){if(!qp.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),n=new u1(i),a=new Uc(n,i.property.specification,this.scope,this.options);let l=null;l=i.value.kind==="constant"||i.value.kind==="source"?new Oh("source",a):new Cl("composite",a,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new za(i.property,l,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,n){return!(!this.layout||i.isDataDriven()||n.isDataDriven())&&qp.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const n=e.get("text-field"),a=wg.paint.properties[i];let l=!1;const h=p=>{for(const _ of p)if(a.overrides&&a.overrides.hasOverride(_))return void(l=!0)};if(n.value.kind==="constant"&&n.value.value instanceof gn)h(n.value.value.sections);else if(n.value.kind==="source"){const p=y=>{l||(y instanceof Ns&&Jr(y.value)===ga?h(y.value.sections):y instanceof xa?h(y.sections):y.eachChild(p))},_=n.value;_._styleExpression&&p(_._styleExpression.expression)}return l}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,n=[];return e&&n.push("symbolIcon"),i&&n.push("symbolSDF"),n}getDefaultProgramParams(e,i){return{config:new O(this,i),overrideFog:!1}}}const qA=new Pr({visibility:new tt(be.layout_background.visibility)});var ZA={paint:new Pr({"background-color":new tt(be.paint_background["background-color"]),"background-pattern":new tt(be.paint_background["background-pattern"]),"background-opacity":new tt(be.paint_background["background-opacity"]),"background-emissive-strength":new tt(be.paint_background["background-emissive-strength"])}),layout:qA};const HA=new Pr({visibility:new tt(be.layout_raster.visibility)});var WA={paint:new Pr({"raster-opacity":new tt(be.paint_raster["raster-opacity"]),"raster-color":new Qo(be.paint_raster["raster-color"]),"raster-color-mix":new tt(be.paint_raster["raster-color-mix"]),"raster-color-range":new tt(be.paint_raster["raster-color-range"]),"raster-hue-rotate":new tt(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new tt(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new tt(be.paint_raster["raster-brightness-max"]),"raster-saturation":new tt(be.paint_raster["raster-saturation"]),"raster-contrast":new tt(be.paint_raster["raster-contrast"]),"raster-resampling":new tt(be.paint_raster["raster-resampling"]),"raster-fade-duration":new tt(be.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new tt(be.paint_raster["raster-emissive-strength"]),"raster-array-band":new tt(be.paint_raster["raster-array-band"]),"raster-elevation":new tt(be.paint_raster["raster-elevation"])}),layout:HA},Tg=Ki([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Eg{constructor(e,i,n,a){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(i,a)}update(e,i,n){const{width:a,height:l}=e,{context:h}=this,{gl:p}=h;if(p.bindTexture(p.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA&&(!i||i.premultiply!==!1)),n||this.size&&this.size[0]===a&&this.size[1]===l){const{x:_,y}=n||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)p.texSubImage2D(p.TEXTURE_2D,0,_,y,p.RGBA,p.UNSIGNED_BYTE,e);else{let v=this.format,T=p.UNSIGNED_BYTE;this.format===p.R32F&&(v=p.RED,T=p.FLOAT),p.texSubImage2D(p.TEXTURE_2D,0,_,y,a,l,v,T,e.data)}}else if(this.size=[a,l],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let _=this.format;this.format===p.R8&&(_=p.RED),p.texImage2D(p.TEXTURE_2D,0,this.format,_,p.UNSIGNED_BYTE,e)}else{let _=this.format,y=this.format,v=p.UNSIGNED_BYTE;this.format===p.DEPTH_COMPONENT&&(_=p.DEPTH_COMPONENT16,v=p.UNSIGNED_SHORT),this.format===p.R8&&(y=p.RED),this.format===p.R32F&&(v=p.FLOAT,y=p.RED),p.texImage2D(p.TEXTURE_2D,0,_,a,l,0,y,v,e.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,i,n=!1){const{context:a}=this,{gl:l}=a;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap&&!n?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,n,a){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),i!==this.magFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),this.wrapS=n),a!==this.wrapT&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrapT=a)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Zp{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapS=i)}}function Hp(t,e,i,n,a,l,h,p){const _=[t,e,1,i,n,1,a,l,1],y=[h,p,1],v=o.co.adjoint([],_),[T,A,C]=o.N.transformMat3(y,y,v);return o.co.multiply(_,_,[T,0,0,0,A,0,0,0,C])}function h1(t,e,i,n,a,l,h,p){const _=function(y,v,T,A,C,R,D,B){const N=Hp(0,0,1,0,1,1,0,1),H=Hp(y,v,T,A,C,R,D,B),K=o.co.adjoint([],N);return o.co.multiply(H,H,K)}(t,e,i,n,a,l,h,p);return[_[2]/_[8]/_t,_[5]/_[8]/_t]}function Wp(t){return[t[0],Math.min(Math.max(t[1],-xi),xi)]}class d1 extends pa{constructor(e,i,n,a){super(),this.id=e,this.dispatcher=n,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Vo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=mt(this.map._requestManager.transformRequest(this.url,Vn.Image),(n,a)=>{this._imageRequest=null,this._loaded=!0,n?this.fire(new Vu(n)):a&&(this.image=a instanceof HTMLImageElement?Xe.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Zp(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Vo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Zp||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],n=e[0][1];for(const l of e)l[1]>n&&(n=l[1]),l[1]<i&&(i=l[1]);const a=(n+i)/2;if(a>xi?this.onNorthPole=!0:a<-xi&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const l=e.map(Di.fromLngLat);this.tileID=function(h){let p=1/0,_=1/0,y=-1/0,v=-1/0;for(const D of h)p=Math.min(p,D.x),_=Math.min(_,D.y),y=Math.max(y,D.x),v=Math.max(v,D.y);const T=Math.max(y-p,v-_),A=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),C=Math.pow(2,A);let R=Math.floor((p+y)/2*C);return R>1&&(R-=1),new Ze(A,R,Math.floor((_+v)/2*C))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Vo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const N in this.tiles){const H=this.tiles[N];H.state!=="loaded"&&(H.state="loaded",H.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Ad(new Ze(0,0,0),this.map.transform.projection),n=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(N){const H=N[1].x-N[0].x,K=N[1].y-N[0].y,Y=N[2].x-N[1].x,ne=N[2].y-N[1].y,ie=N[3].x-N[2].x,ce=N[3].y-N[2].y,me=N[0].x-N[3].x,ye=N[0].y-N[3].y,Ee=H*ne-Y*K,xe=Y*ce-ie*ne,De=ie*ye-me*ce,je=me*K-H*ye;return Ee>0&&xe>0&&De>0&&je>0||Ee<0&&xe<0&&De<0&&je<0}(n))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const a=Ad(this.tileID,this.map.transform.projection),[l,h,p,_]=this.coordinates.map(N=>{const H=a.projection.project(N[0],N[1]);return n1(a,H)._round()});this.perspectiveTransform=h1(l.x,l.y,h.x,h.y,p.x,p.y,_.x,_.y);const y=this._boundsArray=new qs;y.emplaceBack(l.x,l.y,0,0),y.emplaceBack(h.x,h.y,_t,0),y.emplaceBack(_.x,_.y,0,_t),y.emplaceBack(p.x,p.y,_t,_t),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(y,Tg.members),this.boundsSegments=Br.simpleSegment(0,0,4,2);const v=[],T=[Wp((A=this.coordinates)[0]),Wp(A[1]),Wp(A[2]),Wp(A[3])];var A;const[C,R,D,B]=function(N){let H=N[0][0],K=H,Y=N[0][1],ne=Y;for(let ie=1;ie<N.length;ie++)N[ie][0]<H?H=N[ie][0]:N[ie][0]>K&&(K=N[ie][0]),N[ie][1]<Y?Y=N[ie][1]:N[ie][1]>ne&&(ne=N[ie][1]);return[H,Y,K-H,ne-Y]}(T);{const N=new qs,[H,K,Y,ne]=function(Ne){let nt=Ne[0].x,Ge=nt,Mt=Ne[0].y,xt=Mt;for(let He=1;He<Ne.length;He++)Ne[He].x<nt?nt=Ne[He].x:Ne[He].x>Ge&&(Ge=Ne[He].x),Ne[He].y<Mt?Mt=Ne[He].y:Ne[He].y>xt&&(xt=Ne[He].y);return[nt,Mt,Ge-nt,xt-Mt]}(n),ie=Ne=>[(Ne.x-H)/Y,(Ne.y-K)/ne],[ce,me,ye,Ee]=n.map(ie),xe=function(Ne,nt,Ge,Mt,xt,He,Xt,Dt){const At=Hp(0,0,1,0,1,1,0,1),We=Hp(Ne,nt,Ge,Mt,xt,He,Xt,Dt),$t=o.co.adjoint([],We);return o.co.multiply(At,At,$t)}(ce[0],ce[1],me[0],me[1],ye[0],ye[1],Ee[0],Ee[1]);this.elevatedGlobePerspectiveTransform=h1(ce[0],ce[1],me[0],me[1],ye[0],ye[1],Ee[0],Ee[1]);const De=(Ne,nt)=>{v.push(Ne.lng);const Ge=Math.round((Ne.lng-C)/D*_t),Mt=Math.round((Ne.lat-R)/B*_t),xt=ie(nt),He=o.N.transformMat3([],[xt[0],xt[1],1],xe),Xt=Math.round(He[0]/He[2]*_t),Dt=Math.round(He[1]/He[2]*_t);N.emplaceBack(Ge,Mt,Xt,Dt)},je=n[3].x-n[0].x,Re=n[3].y-n[0].y,Ve=n[2].x-n[1].x,Me=n[2].y-n[1].y;for(let Ne=0;Ne<65;Ne++){const nt=Ne/64,Ge=[n[0].x+nt*je,n[0].y+nt*Re],Mt=[n[1].x+nt*Ve,n[1].y+nt*Me],xt=Mt[0]-Ge[0],He=Mt[1]-Ge[1];for(let Xt=0;Xt<65;Xt++){const Dt=Xt/64,At={x:Ge[0]+xt*Dt,y:Ge[1]+He*Dt,z:0};De(i.projection.unproject(At.x,At.y),At)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(N,Tg.members)}{this.maxLongitudeTriangleSize=0;let N=[],H=new sn;const K=(Y,ne,ie)=>{H.emplaceBack(Y,ne,ie);const ce=v[Y],me=v[ne],ye=v[ie],Ee=Math.min(Math.min(ce,me),ye),xe=Math.max(Math.max(ce,me),ye)-Ee;xe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=xe),N.push(Ee+xe/2)};for(let Y=0;Y<64;Y++)for(let ne=0;ne<64;ne++){const ie=65*Y+ne,ce=ie+1,me=ie+65,ye=me+1;K(ie,me,ce),K(ce,me,ye)}[N,H]=function(Y,ne){const ie=Array.from({length:Y.length},(ye,Ee)=>Ee);ie.sort((ye,Ee)=>Y[ye]-Y[Ee]);const ce=[],me=new sn;for(let ye=0;ye<ie.length;ye++){const Ee=ie[ye];ce.push(Y[Ee]);const xe=3*Ee,De=xe+1;me.emplaceBack(ne.uint16[xe],ne.uint16[De],ne.uint16[De+1])}return[ce,me]}(N,H),this.elevatedGlobeTrianglesCenterLongitudes=N,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(H)}this.elevatedGlobeSegments=Br.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,D/_t,0,B/_t,0,0,R,C,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,n=i.gl;!this._dirty||this.texture instanceof Zp||(this.texture?this.texture.update(this.image):(this.texture=new Eg(i,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const n=this.elevatedGlobeTrianglesCenterLongitudes;let a=((v,T)=>v+360*Math.round((T-v)/360))(e+180,n[0]);const l=new Br,h=(v,T)=>{l.segments.push({vertexOffset:0,primitiveOffset:v,vertexLength:i.segments[0].vertexLength,primitiveLength:T,sortKey:void 0,vaos:{}})},p=.51*this.maxLongitudeTriangleSize;if(Math.abs(n[0]-a)<=p){const v=Ce(n,0,n.length,a+p);return v===n.length||h(v,ue(n,v+1,n.length,a+360-p)-v),l}a<n[0]&&(a+=360);const _=ue(n,0,n.length,a-p);if(_===n.length)return h(0,n.length),l;h(0,_-0);const y=Ce(n,_+1,n.length,a+p);return y!==n.length&&h(y,n.length-y),l}}const XA=(Math.pow(256,2)-1)/16907520;class f1 extends $n{constructor(e,i,n){super(e,WA,i,n),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(e){return!(e&&e._source instanceof d1&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[n,a]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(n)&&isNaN(a)||n===this._curRampRange[0]&&a===this._curRampRange[1]||(this.colorRamp=md({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:n,end:a}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[n,a])}}const YA=new Pr({visibility:new tt(be["layout_raster-particle"].visibility)});var KA={paint:new Pr({"raster-particle-array-band":new tt(be["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new tt(be["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Qo(be["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new tt(be["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new tt(be["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new tt(be["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new tt(be["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:YA};class p1 extends $n{constructor(e,i,n){super(e,KA,i,n),this._updateColorRamp(),this.onRemove=a=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&a.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=Xe.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isLayerDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=md({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Xe.now()}}class JA extends $n{constructor(e,i){super(e,{},i),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const QA=new Pr({visibility:new tt(be.layout_sky.visibility)});var eM={paint:new Pr({"sky-type":new tt(be.paint_sky["sky-type"]),"sky-atmosphere-sun":new tt(be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new tt(be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new tt(be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new tt(be.paint_sky["sky-gradient-radius"]),"sky-gradient":new Qo(be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new tt(be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new tt(be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new tt(be.paint_sky["sky-opacity"])}),layout:QA};function Sg(t,e,i){const n=[0,0,1],a=o.bi.identity([]);return o.bi.rotateY(a,a,i?-ni(t)+Math.PI:ni(t)),o.bi.rotateX(a,a,-ni(e)),o.N.transformQuat(n,n,a),o.N.normalize(n,n)}var tM={paint:new Pr({})};function m1(t,e){const i=Xp(t.projection,t.zoom,t.width,t.height),n=function(l,h,p,_,y){const v=new ge(p.lng-180*Ha,p.lat),T=new ge(p.lng+180*Ha,p.lat),A=l.project(v.lng,v.lat),C=l.project(T.lng,T.lat),R=-Math.atan2(C.y-A.y,C.x-A.x),D=Di.fromLngLat(p);D.y=zt(D.y,-1+Ha,1-Ha);const B=D.toLngLat(),N=l.project(B.lng,B.lat),H=Di.fromLngLat(B);H.x+=Ha;const K=H.toLngLat(),Y=l.project(K.lng,K.lat),ne=y1(Y.x-N.x,Y.y-N.y,R),ie=Di.fromLngLat(B);ie.y+=Ha;const ce=ie.toLngLat(),me=l.project(ce.lng,ce.lat),ye=y1(me.x-N.x,me.y-N.y,R),Ee=Math.abs(ne.x)/Math.abs(ye.y),xe=o.a6.identity([]);o.a6.rotateZ(xe,xe,-R*(1-(y?0:_)));const De=o.a6.identity([]);return o.a6.scale(De,De,[1,1-(1-Ee)*_,1]),De[4]=-ye.x/ye.y*_,o.a6.rotateZ(De,De,R),o.a6.multiply(De,xe,De),De}(t.projection,0,t.center,i,e),a=_1(t);return o.a6.scale(n,n,[a,a,1]),n}function _1(t){const e=t.projection,i=Xp(t.projection,t.zoom,t.width,t.height),n=g1(e,t.center),a=g1(e,ge.convert(e.center));return Math.pow(2,n*i+(1-i)*a)}function Xp(t,e,i,n,a=1/0){const l=t.range;if(!l)return 0;const h=Math.min(a,Math.max(i,n)),p=Math.log(h/1024)/Math.LN2;return Mn(l[0]+p,l[1]+p,e)}const Ha=1/4e4;function g1(t,e){const i=zt(e.lat,-xi,xi),n=new ge(e.lng-180*Ha,i),a=new ge(e.lng+180*Ha,i),l=t.project(n.lng,i),h=t.project(a.lng,i),p=Di.fromLngLat(n),_=Di.fromLngLat(a),y=h.x-l.x,v=h.y-l.y,T=_.x-p.x,A=_.y-p.y,C=Math.sqrt((T*T+A*A)/(y*y+v*v));return Math.log(C)/Math.LN2}function y1(t,e,i){const n=Math.cos(i),a=Math.sin(i);return{x:t*n-e*a,y:t*a+e*n}}function x1(t,e,i){o.a6.identity(t),o.a6.rotateZ(t,t,ni(e[2])),o.a6.rotateX(t,t,ni(e[0])),o.a6.rotateY(t,t,ni(e[1])),o.a6.scale(t,t,i),o.a6.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Yp(t,e,i,n,a,l,h,p){const _=[i[0]-e[0],i[1]-e[1],0],y=[n[0]-e[0],n[1]-e[1],0];if(o.N.length(_)<1e-12||o.N.length(y)<1e-12)return o.bi.identity(t);const v=o.N.cross([],_,y);o.N.normalize(v,v),o.N.subtract(y,n,e),_[2]=(l-a)*p,y[2]=(h-a)*p;const T=_;return o.N.cross(T,_,y),o.N.normalize(T,T),o.bi.rotationTo(t,v,T)}function Ag(t,e,i=!1){const n=Va(e.zoom),a=function(l,h,p){const _=h.worldSize,y=[l[12],l[13],l[14]],v=Ii(y[1]/_),T=oi(y[0]/_),A=o.a6.identity([]),C=ai(1,v)*_,R=ai(1,0)*_*vi(v,h.zoom),D=1/Y_(_);let B=R*D;if(p){const Y=Xp(h.projection,h.zoom,h.width,h.height,1024);B=D*h.projection.pixelSpaceConversion(h.center.lat,_,Y)}const N=Le(v,T);o.N.add(N,N,o.N.scale([],o.N.normalize([],N),C*B*y[2]));const H=function(Y){const ne=[Y[0],Y[1],Y[2]];let ie=[0,1,0];const ce=o.N.cross([],ie,ne);return o.N.cross(ie,ne,ce),o.N.squaredLength(ie)===0&&(ie=[0,1,0],o.N.cross(ce,ne,ie)),o.N.normalize(ce,ce),o.N.normalize(ie,ie),o.N.normalize(ne,ne),[ce[0],ce[1],ce[2],0,ie[0],ie[1],ie[2],0,ne[0],ne[1],ne[2],0,Y[0],Y[1],Y[2],1]}(N);o.a6.scale(A,A,[B,B,B*C]),o.a6.translate(A,A,[-y[0],-y[1],-y[2]]);const K=o.a6.multiply([],h.globeMatrix,H);return o.a6.multiply(K,K,A),o.a6.multiply(K,K,l),K}(t,e,i);if(n>0){const l=function(h,p){const _=p.worldSize,y=ai(1,0)*_*vi(p.center.lat,p.zoom)/Y_(_),v=ai(1,p.center.lat)*_,T=o.a6.identity([]);return o.a6.rotateY(T,T,ni(p.center.lng)),o.a6.rotateX(T,T,ni(p.center.lat)),o.a6.translate(T,T,[0,0,W]),o.a6.scale(T,T,[y,y,y*v]),o.a6.translate(T,T,[p.point.x-.5*_,p.point.y-.5*_,0]),o.a6.multiply(T,T,h),o.a6.multiply(T,p.globeMatrix,T)}(t,e);return function(h,p,_){const y=(R,D,B)=>{const N=o.N.length(R),H=o.N.length(D),K=oa(R,D,B);return o.N.scale(K,K,1/o.N.length(K)*Si(N,H,B))},v=y([h[0],h[1],h[2]],[p[0],p[1],p[2]],_),T=y([h[4],h[5],h[6]],[p[4],p[5],p[6]],_),A=y([h[8],h[9],h[10]],[p[8],p[9],p[10]],_),C=oa([h[12],h[13],h[14]],[p[12],p[13],p[14]],_);return[v[0],v[1],v[2],0,T[0],T[1],T[2],0,A[0],A[1],A[2],0,C[0],C[1],C[2],1]}(a,l,n)}return a}function v1(t,e,i,n){const a=kr.projectAabbCorners(n,i);let l=Number.MAX_VALUE,h=-1;for(let y=0;y<a.length;++y){const v=a[y];v[0]=(.5*v[0]+.5)*e.width,v[1]=(.5-.5*v[1])*e.height,v[2]<l&&(h=y,l=v[2])}const p=y=>new Ue(a[y][0],a[y][1]);let _;switch(h){case 0:case 6:_=[p(1),p(5),p(4),p(7),p(3),p(2),p(1)];break;case 1:case 7:_=[p(0),p(4),p(5),p(6),p(2),p(3),p(0)];break;case 3:case 5:_=[p(1),p(0),p(4),p(7),p(6),p(2),p(1)];break;default:_=[p(1),p(5),p(6),p(7),p(3),p(0),p(1)]}if(zs(t,_))return l}const iM=Ki([{name:"a_pos_3f",components:3,type:"Float32"}]),rM=Ki([{name:"a_color_3f",components:3,type:"Float32"}]),nM=Ki([{name:"a_color_4f",components:4,type:"Float32"}]),sM=Ki([{name:"a_uv_2f",components:2,type:"Float32"}]),oM=Ki([{name:"a_normal_3f",components:3,type:"Float32"}]),aM=Ki([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),lM=Ki([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class b1{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class w1{constructor(){this.instancedDataArray=new od,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Mg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,i,n,a){this.tileToMeter=bi(n);const l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:h,id:p,index:_,sourceLayerIndex:y}of e){const v=en(h,l);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom),v,n))continue;const T={id:p,sourceLayerIndex:y,index:_,geometry:l?v.geometry:an(h,n,a),properties:h.properties,type:h.type,patterns:{}},A=this.addFeature(T,T.geometry,v);A&&i.featureIndex.insert(h,T.geometry,_,y,this.index,this.instancesPerModel[A].instancedDataArray.length,_t/32)}this.lookup=null}update(e,i,n,a){for(const l in this.instancesPerModel){const h=this.instancesPerModel[l];for(const p in e)h.idToFeaturesIndex.hasOwnProperty(p)&&this.evaluate(h.features[h.idToFeaturesIndex[p]],e[p],h,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const n=this.instancesPerModel[i];for(const a of n.features){const l=this.layers[0],h=a.feature,p=this.canonical,_=l.paint.get("model-rotation").evaluate(h,{},p),y=l.paint.get("model-scale").evaluate(h,{},p),v=l.paint.get("model-translation").evaluate(h,{},p);o.N.exactEquals(a.rotation,_)&&o.N.exactEquals(a.scale,y)&&o.N.exactEquals(a.translation,v)||(this.evaluate(a,a.featureStates,n,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const n=this.instancesPerModel[i];n.instancedDataArray.length<0||n.instancedDataArray.length===0||(n.instancedDataBuffer?n.instancedDataBuffer.updateData(n.instancedDataArray):n.instancedDataBuffer=e.createVertexBuffer(n.instancedDataArray,aM.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}}addFeature(e,i,n){const a=this.layers[0],l=a.layout.get("model-id").evaluate(n,{},this.canonical);if(!l)return pe(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),l;this.instancesPerModel[l]||(this.instancesPerModel[l]=new w1);const h=this.instancesPerModel[l],p=h.instancedDataArray,_=new b1(n,p.length);for(const y of i)for(const v of y){if(v.x<0||v.x>=_t||v.y<0||v.y>=_t)continue;const T=(this.lookupDim-1)/_t,A=this.lookupDim*(v.y*T|0)+v.x*T|0;if(this.lookup){if(this.lookup[A]!==0)continue;this.lookup[A]=1}this.instanceCount++;const C=p.length;p.resize(C+1),h.instancesEvaluatedElevation.push(0),p.float32[16*C]=v.x,p.float32[16*C+1]=v.y}return _.instancedDataCount=h.instancedDataArray.length-_.instancedDataOffset,_.instancedDataCount>0&&(e.id&&(h.idToFeaturesIndex[e.id]=h.features.length),h.features.push(_),this.evaluate(_,{},h,!1)),l}evaluate(e,i,n,a){const l=this.layers[0],h=e.feature,p=this.canonical,_=e.rotation=l.paint.get("model-rotation").evaluate(h,i,p),y=e.scale=l.paint.get("model-scale").evaluate(h,i,p),v=e.translation=l.paint.get("model-translation").evaluate(h,i,p),T=l.paint.get("model-color").evaluate(h,i,p);T.a=l.paint.get("model-color-mix-intensity").evaluate(h,i,p);const A=[];this.maxVerticalOffset<v[2]&&(this.maxVerticalOffset=v[2]),this.maxScale=Math.max(Math.max(this.maxScale,y[0]),Math.max(y[1],y[2])),x1(A,_,y);const C=Math.round(100*T.a)+T.b/1.05;for(let R=0;R<e.instancedDataCount;++R){const D=e.instancedDataOffset+R,B=16*D,N=n.instancedDataArray.float32;let H=0;a&&(H=N[B+6]-n.instancesEvaluatedElevation[D]);const K=0|N[B+1];N[B]=(0|N[B])+T.r/1.05,N[B+1]=K+T.g/1.05,N[B+2]=C,N[B+3]=1/(p.z>10?this.tileToMeter:bi(p,K)),N[B+4]=v[0],N[B+5]=v[1],N[B+6]=v[2]+H,N[B+7]=A[0],N[B+8]=A[1],N[B+9]=A[2],N[B+10]=A[4],N[B+11]=A[5],N[B+12]=A[6],N[B+13]=A[8],N[B+14]=A[9],N[B+15]=A[10],n.instancesEvaluatedElevation[D]=v[2]}}}wt(Mg,"ModelBucket",{omit:["layers"]}),wt(w1,"PerModelAttributes"),wt(b1,"ModelFeature");const cM=new Pr({visibility:new tt(be.layout_model.visibility),"model-id":new Gt(be.layout_model["model-id"])});var uM={paint:new Pr({"model-opacity":new tt(be.paint_model["model-opacity"]),"model-rotation":new Gt(be.paint_model["model-rotation"]),"model-scale":new Gt(be.paint_model["model-scale"]),"model-translation":new Gt(be.paint_model["model-translation"]),"model-color":new Gt(be.paint_model["model-color"]),"model-color-mix-intensity":new Gt(be.paint_model["model-color-mix-intensity"]),"model-type":new tt(be.paint_model["model-type"]),"model-cast-shadows":new tt(be.paint_model["model-cast-shadows"]),"model-receive-shadows":new tt(be.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new tt(be.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Gt(be.paint_model["model-emissive-strength"]),"model-roughness":new Gt(be.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Gt(be.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new tt(be.paint_model["model-cutoff-fade-range"])}),layout:cM};const rc=64,mu={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function T1(t,e,i,n,a,l,h,p,_,y=!1){const v=i.zoom,T=i.project(n),A=vi(n.lat,v),C=1/A;o.a6.identity(t),o.a6.translate(t,t,[T.x+h[0]*C,T.y+h[1]*C,h[2]]);let R=1,D=1;const B=i.worldSize;if(y){if(i.projection.name==="mercator"){let Y=0;i.elevation&&(Y=i.elevation.getAtPointOrZero(new Di(T.x/B,T.y/B),0));const ne=o.a7.transformMat4([],[T.x,T.y,Y,1],i.projMatrix)[3]/i.cameraToCenterDistance;R=ne,D=ne*vi(i.center.lat,v)}else if(i.projection.name==="globe"){const Y=Ag(t,i),ne=o.a6.multiply([],i.projMatrix,Y),ie=[0,0,0,1];o.a7.transformMat4(ie,ie,ne);const ce=ie[3]/i.cameraToCenterDistance,me=Va(v),ye=i.projection.pixelsPerMeter(n.lat,B)*vi(n.lat,v),Ee=i.projection.pixelsPerMeter(i.center.lat,B)*vi(i.center.lat,v);R=ce/Si(ye,Rr(i.center.lat),me),D=ce*A/ye,R*=Ee,D*=Ee}}else R=C;o.a6.scale(t,t,[R,R,D]);const N=[...t],H=e.orientation,K=[];if(x1(K,[H[0]+a[0],H[1]+a[1],H[2]+a[2]],l),o.a6.multiply(t,N,K),p&&i.elevation){let Y=0;const ne=[];if(_&&i.elevation){Y=function(me,ye,Ee,xe,De){const je=ye.elevation;if(!je)return 0;const Re=kr.projectAabbCorners(Ee,xe),Ve=ai(1,De.lat)*ye.worldSize,Me=function($t,mi){const Yt=[0,0,1],_i=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ii of _i){const Ai=$t[ii.corners[0]],li=$t[ii.corners[1]],cr=$t[ii.corners[2]],Oi=[li[0]-Ai[0],li[1]-Ai[1],mi*(li[2]-Ai[2])],Ni=o.N.cross(Oi,Oi,[cr[0]-Ai[0],cr[1]-Ai[1],mi*(cr[2]-Ai[2])]);o.N.normalize(Ni,Ni),ii.dotProductWithUp=o.N.dot(Ni,Yt)}return _i.sort((ii,Ai)=>ii.dotProductWithUp-Ai.dotProductWithUp),_i[0].corners}(Re,Ve),Ne=Re[Me[0]],nt=Re[Me[1]],Ge=Re[Me[2]],Mt=Re[Me[3]],xt=je.getAtPointOrZero(new Di(Ne[0]/ye.worldSize,Ne[1]/ye.worldSize),0),He=je.getAtPointOrZero(new Di(nt[0]/ye.worldSize,nt[1]/ye.worldSize),0),Xt=je.getAtPointOrZero(new Di(Ge[0]/ye.worldSize,Ge[1]/ye.worldSize),0),Dt=je.getAtPointOrZero(new Di(Mt[0]/ye.worldSize,Mt[1]/ye.worldSize),0),At=(xt+Dt)/2,We=(He+Xt)/2;return At>We?He<Xt?Yp(me,nt,Mt,Ne,He,Dt,xt,Ve):Yp(me,Ge,Ne,Mt,Xt,xt,Dt,Ve):xt<Dt?Yp(me,Ne,nt,Ge,xt,He,Xt,Ve):Yp(me,Mt,Ge,nt,Dt,Xt,He,Ve),Math.max(At,We)}(ne,i,e.aabb,t,n);const ie=o.a6.fromQuat([],ne),ce=o.a6.multiply([],ie,K);o.a6.multiply(t,N,ce)}else Y=i.elevation.getAtPointOrZero(new Di(T.x/B,T.y/B),0);Y!==0&&(t[14]+=Y)}}function Rd(t,e,i=!1){t.uploaded||(t.gfxTexture=new Eg(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function hM(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,iM.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,oM.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,sM.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?rM:nM).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,lM.members,!0)),t.segments=Br.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const n=t.material;n.pbrMetallicRoughness.baseColorTexture&&Rd(n.pbrMetallicRoughness.baseColorTexture,e),n.pbrMetallicRoughness.metallicRoughnessTexture&&Rd(n.pbrMetallicRoughness.metallicRoughnessTexture,e),n.normalTexture&&Rd(n.normalTexture,e),n.occlusionTexture&&Rd(n.occlusionTexture,e,i),n.emissionTexture&&Rd(n.emissionTexture,e)}function Ig(t,e,i){if(t.meshes)for(const n of t.meshes)hM(n,e,i);if(t.children)for(const n of t.children)Ig(n,e,i)}function Kp(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)Kp(e)}function Cg(t){if(t.meshes)for(const i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const i of t.children)Cg(i)}class dM{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class fM{constructor(){this.tasks={},this.taskQueue=[],Wt(["process"],this),this.invoker=new dM(this.process),this.nextId=0}add(e,i){const n=this.nextId++,a=function({type:l,isSymbolTile:h,zoom:p}){return p=p||0,l==="message"?0:l!=="maybePrepare"||h?l!=="parseTile"||h?l==="parseTile"&&h?300-p:l==="maybePrepare"&&h?400-p:500:200-p:100-p}(i);if(a===0){Tt();try{e()}finally{}return null}return this.tasks[n]={fn:e,metadata:i,priority:a,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){Tt();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let a=0;a<this.taskQueue.length;a++){const l=this.tasks[this.taskQueue[a]];l.priority<i&&(i=l.priority,e=a)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class E1{constructor(e,i,n){this.target=e,this.parent=i,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Wt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new fM}send(e,i,n,a,l=!1,h){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=h,this.callbacks[p]=n);const _=new Set;return this.target.postMessage({id:p,type:e,hasCallback:!!n,targetMapId:a,mustQueue:l,sourceMapId:this.mapId,data:vo(i,_)},_),{cancel:()=>{n&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const i=e.data,n=i.id;if(n&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const a=this.cancelCallbacks[n];delete this.cancelCallbacks[n],a&&a.cancel()}else if(i.mustQueue||Tt()){const a=this.callbacks[n],l=this.scheduler.add(()=>this.processTask(n,i),a&&a.metadata||{type:"message"});l&&(this.cancelCallbacks[n]=l)}else this.processTask(n,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const n=this.callbacks[e];delete this.callbacks[e],n&&(i.error?n(Ko(i.error)):n(null,Ko(i.data)))}else{const n=new Set,a=i.hasCallback?(h,p)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:h?vo(h):null,data:vo(p,n)},n)}:h=>{},l=Ko(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,l,a);else if(this.parent.getWorkerSource){const h=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,h[0],l.source,l.scope)[h[1]](l,a)}else a(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class _u{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Kn();const n=this.workerPool.acquire(this.id);for(let a=0;a<n.length;a++){const l=new _u.Actor(n[a],i,this.id);l.name=`Worker ${a}`,this.actors.push(l)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,n){Wr(this.actors,(a,l)=>{a.send(e,i,l)},n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}_u.Actor=E1;var Ld={workerUrl:"",workerClass:null,workerParams:void 0};function pM(){return Ld.workerClass!=null?new Ld.workerClass:new self.Worker(Ld.workerUrl,Ld.workerParams)}const Pg="mapboxgl_preloaded_worker_pool";class Dd{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Dd.workerCount;)this.workers.push(new pM);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Pg]}numActive(){return Object.keys(this.active).length}}let zd;function Jp(){return zd||(zd=new Dd),zd}Dd.workerCount=2;let Qp,Rg,Js,gu,Lg,yu=null;function S1(){return Tt()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Rg||se.DRACO_URL}function A1(){if(Tt()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(gu)return gu;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return gu=WebAssembly.validate(t)?se.MESHOPT_SIMD_URL:se.MESHOPT_URL,gu}const em={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},mM={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},kd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function M1(t,e,i){const n=i.json.bufferViews.length,a=i.buffers.length;e.bufferView=n,i.json.bufferViews[n]={buffer:a,byteLength:t.byteLength},i.buffers[a]=t}const Dg="KHR_draco_mesh_compression";function _M(t,e){const i=t.extensions&&t.extensions[Dg];if(!i)return;const n=new Js.Decoder,a=R1(e,i.bufferView),l=new Js.Mesh;if(!n.DecodeArrayToMesh(a,a.byteLength,l))throw new Error("Failed to decode Draco mesh");const h=e.json.accessors[t.indices],p=em[h.componentType],_=h.count*p.BYTES_PER_ELEMENT,y=Js._malloc(_);p===Uint16Array?n.GetTrianglesUInt16Array(l,_,y):n.GetTrianglesUInt32Array(l,_,y),M1(Js.memory.buffer.slice(y,y+_),h,e),Js._free(y);for(const v of Object.keys(i.attributes)){const T=n.GetAttributeByUniqueId(l,i.attributes[v]),A=e.json.accessors[t.attributes[v]],C=mM[A.componentType],R=A.count*kd[A.type]*em[A.componentType].BYTES_PER_ELEMENT,D=Js._malloc(R);n.GetAttributeDataArrayForAllPoints(l,T,Js[C],R,D),M1(Js.memory.buffer.slice(D,D+R),A,e),Js._free(D)}n.destroy(),l.destroy(),delete t.extensions[Dg]}const tm="EXT_meshopt_compression";function gM(t,e){if(!t.extensions||!t.extensions[tm])return;const i=t.extensions[tm],n=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),a=new Uint8Array(i.count*i.byteStride);Lg.decodeGltfBuffer(a,i.count,i.byteStride,n,i.mode,i.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=a.buffer,delete t.extensions[tm]}const I1=1179937895,C1=new TextDecoder("utf8");function P1(t,e){return new URL(t,e).href}function yM(t,e,i,n){return fetch(P1(t.uri,n)).then(a=>a.arrayBuffer()).then(a=>{e.buffers[i]=a})}function R1(t,e){const i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function xM(t,e,i,n){if(t.uri){const a=P1(t.uri,n);return fetch(a).then(l=>l.blob()).then(l=>createImageBitmap(l)).then(l=>{e.images[i]=l})}if(t.bufferView!==void 0){const a=R1(e,t.bufferView),l=new Blob([a],{type:t.mimeType});return createImageBitmap(l).then(h=>{e.images[i]=h})}}function L1(t,e=0,i){const n={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===I1){const v=new Uint32Array(t,e);let T=2;const A=(v[T++]>>2)-3,C=v[T++]>>2;if(T++,n.json=JSON.parse(C1.decode(v.subarray(T,T+C))),T+=C,T<A){const R=v[T++];T++;const D=e+(T<<2);n.buffers[0]=t.slice(D,D+R)}}else n.json=JSON.parse(C1.decode(new Uint8Array(t,e)));const{buffers:a,images:l,meshes:h,extensionsUsed:p,bufferViews:_}=n.json;let y=Promise.resolve();if(a){const v=[];for(let T=0;T<a.length;T++){const A=a[T];A.uri?v.push(yM(A,n,T,i)):n.buffers[T]||(n.buffers[T]=null)}y=Promise.all(v)}return y.then(()=>{const v=[],T=p&&p.includes(Dg),A=p&&p.includes(tm);if(T&&v.push(function(){if(!Js)return Qp||(Qp=function(C){let R,D=null;function B(){R=new Uint8Array(D.buffer)}function N(){throw new Error("Unexpected Draco error.")}const H={a:{a:N,d:function(K,Y,ne){return R.copyWithin(K,Y,Y+ne)},c:function(K){const Y=R.length,ne=Math.max(K>>>0,Math.ceil(1.2*Y)),ie=Math.ceil((ne-Y)/65536);try{return D.grow(ie),B(),!0}catch{return!1}},b:N}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(C,H):C.then(K=>K.arrayBuffer()).then(K=>WebAssembly.instantiate(K,H))).then(K=>{const{Rb:Y,Qb:ne,P:ie,T:ce,X:me,Ja:ye,La:Ee,Qa:xe,Va:De,Wa:je,eb:Re,jb:Ve,f:Me,e:Ne,yb:nt,zb:Ge,Ab:Mt,Bb:xt,Db:He,Gb:Xt}=K.instance.exports;D=Ne;const Dt=(()=>{let At=0,We=0,$t=0,mi=0;return Yt=>{$t&&(Y(mi),Y(At),We+=$t,$t=At=0),At||(We+=128,At=ne(We));const _i=Yt.length+7&-8;let ii=At;_i>=We&&($t=_i,ii=mi=ne(_i));for(let Ai=0;Ai<Yt.length;Ai++)R[ii+Ai]=Yt[Ai];return ii}})();return B(),Me(),{memory:Ne,_free:Y,_malloc:ne,Mesh:class{constructor(){this.ptr=ie()}destroy(){ce(this.ptr)}},Decoder:class{constructor(){this.ptr=ye()}destroy(){Ve(this.ptr)}DecodeArrayToMesh(At,We,$t){const mi=Dt(At),Yt=Ee(this.ptr,mi,We,$t.ptr);return!!me(Yt)}GetAttributeByUniqueId(At,We){return{ptr:xe(this.ptr,At.ptr,We)}}GetTrianglesUInt16Array(At,We,$t){De(this.ptr,At.ptr,We,$t)}GetTrianglesUInt32Array(At,We,$t){je(this.ptr,At.ptr,We,$t)}GetAttributeDataArrayForAllPoints(At,We,$t,mi,Yt){Re(this.ptr,At.ptr,We.ptr,$t,mi,Yt)}},DT_INT8:nt(),DT_UINT8:Ge(),DT_INT16:Mt(),DT_UINT16:xt(),DT_UINT32:He(),DT_FLOAT32:Xt()}})}(fetch(S1())),Qp.then(C=>{Js=C,Qp=void 0}))}()),A&&v.push(function(){if(Lg)return;const C=function(R){let D;const B=WebAssembly.instantiateStreaming(R,{}).then(K=>{D=K.instance,D.exports.__wasm_call_ctors()}),N={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},H={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:B,supported:!0,decodeGltfBuffer(K,Y,ne,ie,ce,me){(function(ye,Ee,xe,De,je,Re,Ve){const Me=ye.exports.sbrk,Ne=De+3&-4,nt=Me(Ne*je),Ge=Me(Re.length),Mt=new Uint8Array(ye.exports.memory.buffer);Mt.set(Re,Ge);const xt=Ee(nt,De,je,Ge,Re.length);if(xt===0&&Ve&&Ve(nt,Ne,je),xe.set(Mt.subarray(nt,nt+De*je)),Me(nt-Me(0)),xt!==0)throw new Error(`Malformed buffer data: ${xt}`)})(D,D.exports[H[ce]],K,Y,ne,ie,D.exports[N[me]])}}}(fetch(A1()));return C.ready.then(()=>{Lg=C})}()),l)for(let C=0;C<l.length;C++)v.push(xM(l[C],n,C,i));return(v.length?Promise.all(v):Promise.resolve()).then(()=>{if(T&&h)for(const{primitives:C}of h)for(const R of C)_M(R,n);if(A&&h&&_)for(const C of _)gM(C,n);return n})})}class D1{constructor(e,i,n){if(this.triangleCount=i.length/3,this.min=new Ue(0,0),this.max=new Ue(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||n===0)return;const a=e.map(v=>v.x),l=e.map(v=>v.y);this.min=new Ue(Math.min(...a),Math.min(...l)),this.max=new Ue(Math.max(...a),Math.max(...l));const h=this.max.sub(this.min);h.x=Math.max(h.x,1),h.y=Math.max(h.y,1);const p=Math.max(h.x,h.y)/n;this.cellsX=Math.max(1,Math.ceil(h.x/p)),this.cellsY=Math.max(1,Math.ceil(h.y/p)),this.xScale=1/p,this.yScale=1/p;const _=[];for(let v=0;v<this.triangleCount;v++){const T=e[i[3*v+0]].sub(this.min),A=e[i[3*v+1]].sub(this.min),C=e[i[3*v+2]].sub(this.min),R=Wa(Math.floor(Math.min(T.x,A.x,C.x)),this.xScale,this.cellsX),D=Wa(Math.floor(Math.max(T.x,A.x,C.x)),this.xScale,this.cellsX),B=Wa(Math.floor(Math.min(T.y,A.y,C.y)),this.yScale,this.cellsY),N=Wa(Math.floor(Math.max(T.y,A.y,C.y)),this.yScale,this.cellsY),H=new Ue(0,0),K=new Ue(0,0),Y=new Ue(0,0),ne=new Ue(0,0);for(let ie=B;ie<=N;++ie){H.y=K.y=ie*p,Y.y=ne.y=(ie+1)*p;for(let ce=R;ce<=D;++ce)H.x=Y.x=ce*p,K.x=ne.x=(ce+1)*p,(I_(T,A,C,H,K,ne)||I_(T,A,C,H,ne,Y))&&_.push({cellIdx:ie*this.cellsX+ce,triIdx:v})}}if(_.length===0)return;_.sort((v,T)=>v.cellIdx-T.cellIdx||v.triIdx-T.triIdx);let y=0;for(;y<_.length;){const v=_[y].cellIdx,T={start:this.payload.length,len:0};for(;y<_.length&&_[y].cellIdx===v;)++T.len,this.payload.push(_[y++].triIdx);this.cells[v]=T}}query(e,i,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let _=0;_<this.lookup.length;_++)this.lookup[_]=0;const a=Wa(e.x-this.min.x,this.xScale,this.cellsX),l=Wa(i.x-this.min.x,this.xScale,this.cellsX),h=Wa(e.y-this.min.y,this.yScale,this.cellsY),p=Wa(i.y-this.min.y,this.yScale,this.cellsY);for(let _=h;_<=p;_++)for(let y=a;y<=l;y++){const v=this.cells[_*this.cellsX+y];if(v)for(let T=0;T<v.len;T++){const A=this.payload[v.start+T],C=Math.floor(A/8),R=1<<A%8;if(!(this.lookup[C]&R)&&(this.lookup[C]|=R,n.push(A),n.length===this.triangleCount))return}}}}function Wa(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}function nc(t,e){const i=t.json.bufferViews[e.bufferView],n=em[e.componentType];return new n(t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==kd[e.type]*n.BYTES_PER_ELEMENT?i.byteStride/n.BYTES_PER_ELEMENT:kd[e.type]))}function zg(t,e,i,n){const a=em[e.componentType],l=function(v){switch(v){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(a),h=t.json.bufferViews[e.bufferView],p=h.byteStride?h.byteStride/a.BYTES_PER_ELEMENT:kd[e.type],_=i.float32,y=_.length/i.capacity;for(let v=0,T=0;v<e.count*p;v+=p,T+=y)for(let A=0;A<y;A++)_[T+A]=n[v+A]*l;i._trim()}function vM(t,e,i){const n=t.indices,a=t.attributes,l={};l.indexArray=new sn;const h=e.json.accessors[n],p=h.count/3;l.indexArray.reserve(p);const _=nc(e,h);for(let A=0;A<p;A++)l.indexArray.emplaceBack(_[3*A],_[3*A+1],_[3*A+2]);l.indexArray._trim(),l.vertexArray=new ea;const y=e.json.accessors[a.POSITION];l.vertexArray.reserve(y.count);const v=nc(e,y);for(let A=0;A<y.count;A++)l.vertexArray.emplaceBack(v[3*A],v[3*A+1],v[3*A+2]);if(l.vertexArray._trim(),l.aabb=new kr(y.min,y.max),l.centroid=function(A,C){const R=[0,0,0],D=A.length;if(D>0){for(let B=0;B<D;B++){const N=3*A[B];R[0]+=C[N],R[1]+=C[N+1],R[2]+=C[N+2]}R[0]/=D,R[1]/=D,R[2]/=D}return R}(_,v),a.COLOR_0!==void 0){const A=e.json.accessors[a.COLOR_0],C=kd[A.type],R=nc(e,A);l.colorArray=C===3?new ea:new Eo,l.colorArray.resize(A.count),zg(e,A,l.colorArray,R)}if(a.NORMAL!==void 0){l.normalArray=new ea;const A=e.json.accessors[a.NORMAL];l.normalArray.resize(A.count);const C=nc(e,A);zg(e,A,l.normalArray,C)}if(a.TEXCOORD_0!==void 0&&i.length>0){l.texcoordArray=new ql;const A=e.json.accessors[a.TEXCOORD_0];l.texcoordArray.resize(A.count);const C=nc(e,A);zg(e,A,l.texcoordArray,C)}if(a._FEATURE_ID_RGBA4444!==void 0){const A=e.json.accessors[a._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(l.featureData=nc(e,A))}a._FEATURE_RGBA4444!==void 0&&(l.featureData=new Uint32Array(nc(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer));const T=t.material;return l.material=function(A,C){const{emissiveFactor:R=[0,0,0],alphaMode:D="OPAQUE",alphaCutoff:B=.5,normalTexture:N,occlusionTexture:H,emissiveTexture:K,doubleSided:Y}=A,{baseColorFactor:ne=[1,1,1,1],metallicFactor:ie=1,roughnessFactor:ce=1,baseColorTexture:me,metallicRoughnessTexture:ye}=A.pbrMetallicRoughness||{},Ee=H?C[H.index]:void 0;if(H&&H.extensions&&H.extensions.KHR_texture_transform&&Ee){const xe=H.extensions.KHR_texture_transform;Ee.offsetScale=[xe.offset[0],xe.offset[1],xe.scale[0],xe.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new $r(...ne),metallicFactor:ie,roughnessFactor:ce,baseColorTexture:me?C[me.index]:void 0,metallicRoughnessTexture:ye?C[ye.index]:void 0},doubleSided:Y,emissiveFactor:R,alphaMode:D,alphaCutoff:B,normalTexture:N?C[N.index]:void 0,occlusionTexture:Ee,emissionTexture:K?C[K.index]:void 0,defined:A.defined===void 0}}(T!==void 0?e.json.materials[T]:{defined:!1},i),l}function z1(t,e,i){const{matrix:n,rotation:a,translation:l,scale:h,mesh:p,extras:_,children:y}=t,v={};if(v.matrix=n||o.a6.fromRotationTranslationScale([],a||[0,0,0,1],l||[0,0,0],h||[1,1,1]),p!==void 0){v.meshes=i[p];const T=v.anchor=[0,0];for(const A of v.meshes){const{min:C,max:R}=A.aabb;T[0]+=C[0]+R[0],T[1]+=C[1]+R[1]}T[0]=Math.floor(T[0]/v.meshes.length/2),T[1]=Math.floor(T[1]/v.meshes.length/2)}if(_&&(_.id&&(v.id=_.id),_.lights&&(v.lights=function(T){if(!T.length)return[];const A=function(N){const H=atob(N),K=new Uint8Array(H.length);for(let Y=0;Y<H.length;Y++)K[Y]=H.codePointAt(Y);return K}(T),C=[],R=A.length/24,D=new Uint16Array(A.buffer),B=new Float32Array(A.buffer);for(let N=0;N<R;N++){const H=D[2*N*6]/30,K=D[2*N*6+1]/30,Y=D[2*N*6+10]/100,ne=B[6*N+1],ie=B[6*N+2],ce=B[6*N+3],me=B[6*N+4],ye=ce-ne,Ee=me-ie,xe=Math.hypot(ye,Ee);C.push({pos:[ne+.5*ye,ie+.5*Ee,K],normal:[Ee/xe,-ye/xe,0],width:xe,height:H,depth:Y,points:[ne,ie,ce,me]})}return C}(_.lights))),y){const T=[];for(const A of y)T.push(z1(e.json.nodes[A],e,i));v.children=T}return v}function bM(t){if(t.vertices.length===0||t.indices.length===0)return null;const[e,i]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let h=1;h<t.vertices.length;++h){const p=t.vertices[h];e.x=Math.min(e.x,p.x),e.y=Math.min(e.y,p.y),i.x=Math.max(i.x,p.x),i.y=Math.max(i.y,p.y)}const n=Math.ceil(Math.max(i.x-e.x,i.y-e.y)/256),a=Math.max(8,n),l=new D1(t.vertices,t.indices,a);return{vertices:t.vertices,indices:t.indices,grid:l,min:e,max:i}}function wM(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const n=[];for(const h of i){if(!Array.isArray(h)||h.length!==2)continue;const p=h[0],_=h[1];typeof p=="number"&&typeof _=="number"&&n.push(new Ue(p,_))}if(n.length<3)return null;n.length>1&&n[n.length-1].equals(n[0])&&n.pop();let a=0;for(let h=0;h<n.length;h++){const p=n[h],_=n[(h+1)%n.length],y=n[(h+2)%n.length];a+=(p.x-_.x)*(y.y-_.y)-(y.x-_.x)*(p.y-_.y)}a>0&&n.reverse();const l=wp(n.flatMap(h=>[h.x,h.y]),[]);return l.length===0?null:{vertices:n,indices:l}}function TM(t){const e=[],i=[];let n=0;for(const a of t){n=e.length;const l=a.vertexArray.float32,h=a.indexArray.uint16;for(let p=0;p<a.vertexArray.length;p++)e.push(new Ue(l[3*p+0],l[3*p+1]));for(let p=0;p<3*a.indexArray.length;p++)i.push(h[p]+n)}if(i.length%3!=0)return null;for(let a=0;a<i.length;a+=3){const l=e[i[a+0]],h=e[i[a+1]],p=e[i[a+2]];(l.x-h.x)*(p.y-h.y)-(p.x-h.x)*(l.y-h.y)>0&&([i[a+1],i[a+2]]=[i[a+2],i[a+1]])}return{vertices:e,indices:i}}function k1(t){const e=function(_,y){const v=[],T=WebGL2RenderingContext;if(_.json.textures)for(const A of _.json.textures){const C={magFilter:T.LINEAR,minFilter:T.NEAREST,wrapS:T.REPEAT,wrapT:T.REPEAT};A.sampler!==void 0&&Object.assign(C,_.json.samplers[A.sampler]),v.push({image:y[A.source],sampler:C,uploaded:!1})}return v}(t,t.images),i=function(_,y){const v=[];for(const T of _.json.meshes){const A=[];for(const C of T.primitives)A.push(vM(C,_,y));v.push(A)}return v}(t,e),{scenes:n,scene:a,nodes:l}=t.json,h=n?n[a||0].nodes:l,p=[];for(const _ of h)p.push(z1(l[_],t,i));return function(_,y,v){const T={},A=new Set;for(let C=0;C<_.length;C++){const R=v[y[C]];if(!R.extras)continue;const D=R.extras["mapbox:footprint:version"],B=R.extras["mapbox:footprint:id"];(D||B)&&A.add(C),D==="1.0.0"&&B&&(T[B]=C)}for(let C=0;C<_.length;C++){if(A.has(C))continue;const R=_[C],D=v[y[C]];if(!D.extras)continue;let B=null;R.id in T&&(B=TM(_[T[R.id]].meshes)),B||(B=wM(D)),B&&(R.footprint=bM(B))}if(A.size>0){const C=Array.from(A.values()).sort((R,D)=>R-D);for(let R=C.length-1;R>=0;R--)_.splice(C[R],1)}}(p,h,t.json.nodes),p}function EM(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,i=t.aabb.min[0]-1,n=t.aabb.min[1]-1,a=rc/(t.aabb.max[0]-i+2),l=rc/(t.aabb.max[1]-n+2);for(let h=0;h<e.length;h+=3){const p=e[h+2],_=(e[h+0]-i)*a|0,y=(e[h+1]-n)*l|0;p>t.heightmap[y*rc+_]&&(t.heightmap[y*rc+_]=p)}}function SM(t,e){const i={};i.indexArray=new sn,i.indexArray.reserve(4*t.length),i.vertexArray=new ea,i.vertexArray.reserve(10*t.length),i.colorArray=new Eo,i.vertexArray.reserve(10*t.length);let n=0;for(const h of t){const p=Math.min(10,Math.max(4,1.3*h.height))*e,_=[-h.normal[1],h.normal[0],0],y=Math.min(.29,.1*h.width/h.depth),v=h.width-2*h.depth*e*(y+.01),T=o.N.scaleAndAdd([],h.pos,_,v/2),A=o.N.scaleAndAdd([],h.pos,_,-v/2),C=[T[0],T[1],T[2]+h.height],R=[A[0],A[1],A[2]+h.height],D=o.N.scaleAndAdd([],h.normal,_,y);o.N.scale(D,D,p);const B=o.N.scaleAndAdd([],h.normal,_,-y);o.N.scale(B,B,p),o.N.add(D,T,D),o.N.add(B,A,B),T[2]+=.1,A[2]+=.1,i.vertexArray.emplaceBack(D[0],D[1],D[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]),i.vertexArray.emplaceBack(T[0],T[1],T[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(T[0],T[1],T[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(D[0],D[1],D[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]);const N=v/p/2;i.colorArray.emplaceBack(-N-y,-1,N,.8),i.colorArray.emplaceBack(N+y,-1,N,.8),i.colorArray.emplaceBack(-N,0,N,1.3),i.colorArray.emplaceBack(N,0,N,1.3),i.colorArray.emplaceBack(N+y,-.8,N,.7),i.colorArray.emplaceBack(N+y,-.8,N,.7),i.colorArray.emplaceBack(0,0,N,1.3),i.colorArray.emplaceBack(0,0,N,1.3),i.colorArray.emplaceBack(N+y,-1.2,N,.8),i.colorArray.emplaceBack(N+y,-1.2,N,.8),i.indexArray.emplaceBack(6+n,4+n,8+n),i.indexArray.emplaceBack(7+n,9+n,5+n),i.indexArray.emplaceBack(0+n,1+n,2+n),i.indexArray.emplaceBack(1+n,3+n,2+n),n+=10}const a={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=$r.white,a.pbrMetallicRoughness=l,i.material=a,i.aabb=new kr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}wt(D1,"TriangleGridIndex");class O1{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const n=e[i];this._stringToNumber[n]=i,this._numberToString[i]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const AM=["tile","layer","source","sourceLayer","state"];class B1{constructor(e,i,n,a,l){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=n,this._y=a,this.properties=e.properties,this.id=l}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of AM)this[i]!==void 0&&(e[i]=this[i]);return e}}class F1{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Gs(_t,16,0),this.featureIndexArray=new ep,this.promoteId=i,this.is3DTile=!1}insert(e,i,n,a,l,h=0,p=0){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,a,l,h);const y=this.grid;for(let v=0;v<i.length;v++){const T=i[v],A=[1/0,1/0,-1/0,-1/0];for(let C=0;C<T.length;C++){const R=T[C];A[0]=Math.min(A[0],R.x),A[1]=Math.min(A[1],R.y),A[2]=Math.max(A[2],R.x),A[3]=Math.max(A[3],R.y)}p!==0&&(A[0]-=p,A[1]-=p,A[2]+=p,A[3]+=p),A[0]<_t&&A[1]<_t&&A[2]>=0&&A[3]>=0&&y.insert(_,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ag(new uu(this.rawTileData)).layers,this.sourceLayerCoder=new O1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,n,a){this.loadVTLayers();const l=e.params||{},h=ts(l.filter),p=e.tileResult,_=e.transform,y=p.bufferedTilespaceBounds,v=this.grid.query(y.min.x,y.min.y,y.max.x,y.max.y,(R,D,B,N)=>s0(p.bufferedTilespaceGeometry,R,D,B,N));v.sort(MM);let T=null;_.elevation&&v.length>0&&(T=su.create(_.elevation,this.tileID));const A={};let C;for(let R=0;R<v.length;R++){const D=v[R];if(D===C)continue;C=D;const B=this.featureIndexArray.get(D);let N=null;if(this.is3DTile){const H=this.bucketLayerIDs[0][0],K=i[H];if(K.type!=="model")continue;const{queryFeature:Y,intersectionZ:ne}=K.queryIntersectsMatchingFeature(p,B.featureIndex,h,_);Y&&this.appendToResult(A,H,B.featureIndex,Y,ne)}else this.loadMatchingFeature(A,B,h,l.layers,l.availableImages,i,n,a,(H,K,Y,ne=0)=>(N||(N=an(H,this.tileID.canonical,e.tileTransform)),K.queryIntersectsFeature(p,H,Y,N,this.z,e.transform,e.pixelPosMatrix,T,ne)))}return A}loadMatchingFeature(e,i,n,a,l,h,p,_,y){const{featureIndex:v,bucketIndex:T,sourceLayerIndex:A,layoutVertexArrayOffset:C}=i,R=this.bucketLayerIDs[T];if(a&&!function(H,K){for(let Y=0;Y<H.length;Y++)if(K.indexOf(H[Y])>=0)return!0;return!1}(a,R))return;const D=this.sourceLayerCoder.decode(A),B=this.vtLayers[D].feature(v);if(n.needGeometry){const H=en(B,!0);if(!n.filter(new Cr(this.tileID.overscaledZ),H,this.tileID.canonical))return}else if(!n.filter(new Cr(this.tileID.overscaledZ),B))return;const N=this.getId(B,D);for(let H=0;H<R.length;H++){const K=R[H];if(a&&a.indexOf(K)<0)continue;const Y=h[K];if(!Y)continue;let ne={};N!==void 0&&_&&(ne=_.getState(Y.sourceLayer||"_geojsonTileLayer",N));const ie=!y||y(B,Y,ne,C);if(!ie)continue;const ce=new B1(B,this.z,this.x,this.y,N),me=dr({},p[K]);me.paint=N1(me.paint,Y.paint,B,ne,l),me.layout=N1(me.layout,Y.layout,B,ne,l),ce.layer=me,this.appendToResult(e,K,v,ce,ie)}}appendToResult(e,i,n,a,l){let h=e[i];h===void 0&&(h=e[i]=[]),h.push({featureIndex:n,feature:a,intersectionZ:l})}lookupSymbolFeatures(e,i,n,a,l,h,p,_){const y={};this.loadVTLayers();const v=ts(l);for(const T of e)this.loadMatchingFeature(y,{bucketIndex:n,sourceLayerIndex:a,featureIndex:T,layoutVertexArrayOffset:0},v,h,p,_,i);return y}loadFeature(e){const{featureIndex:i,sourceLayerIndex:n}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(n),l=this.vtFeatures[a];if(l[i])return l[i];const h=this.vtLayers[a].feature(i);return l[i]=h,h}hasLayer(e){for(const i of this.bucketLayerIDs)for(const n of i)if(e===n)return!0;return!1}getId(e,i){let n=e.id;if(this.promoteId){const a=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];a!=null&&(n=e.properties[a]),typeof n=="boolean"&&(n=Number(n))}return n}}function N1(t,e,i,n,a){return qt(t,(l,h)=>{const p=e instanceof Dl?e.get(h):null;return p&&p.evaluate?p.evaluate(i,n,a):p})}function MM(t,e){return e-t}wt(F1,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const kg=new Float32Array(262144),sc=new Uint8Array(262144);function V1(t){let e=0;if(t.meshes)for(const i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(const i of t.children)e=Math.max(e,V1(i));return e}function U1(t,e,i){if(t.meshes)for(const n of t.meshes)n.aabb.min[0]!==1/0&&i.insert(e,n.aabb.min[0],n.aabb.min[1],n.aabb.max[0],n.aabb.max[1]);if(t.children)for(const n of t.children)U1(n,e,i)}const j1=["","wall","door","roof","window","lamp","logo"];class G1{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:V1(e)}}}getLocalBounds(){if(!this.node.meshes)return new kr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new kr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const n of this.node.meshes)this.node.lightMeshIndex!==e&&i.encapsulate(n.aabb),e++;this.aabb=i}return this.aabb}}class im{constructor(e,i,n,a,l,h){this.id=i,this.modelTraits|=mu.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,n&&(this.modelTraits|=mu.HasMapboxMeshFeatures),a&&(this.modelTraits|=mu.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=l,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const p of e)this.nodesInfo.push(new G1(p)),U1(p,h.featureIndexArray.length,h.grid),h.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,h.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const n of i){const a=n.node;this.uploaded?this.updatePbrBuffer(a):Ig(a,e,!0)}for(const n of i)Kp(n.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const n of e.meshes)n.pbrBuffer&&(n.pbrBuffer.updateData(n.featureArray),i=!0);return i}needsReEvaluation(e,i,n){const a=e.transform.projectionOptions,l=e.style.getBrightness(),h=this.brightness!==l;return!!(!this.uploaded||this.dirty||a.name!==this.projection.name||Od(n.paint.get("model-color").value,h)||Od(n.paint.get("model-color-mix-intensity").value,h)||Od(n.paint.get("model-roughness").value,h)||Od(n.paint.get("model-emissive-strength").value,h)||Od(n.paint.get("model-height-based-emissive-strength-multiplier").value,h))&&(this.projection=a,this.brightness=l,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const n=this.getNodesInfo(),a=this.id.canonical;for(const l of n){const h=l.feature;l.evaluatedScale=i.paint.get("model-scale").evaluate(h,{},a)}}evaluate(e){const i=this.getNodesInfo();for(const n of i){if(!n.node.meshes)continue;const a=n.feature,l=n.node.meshes&&n.node.meshes[0].featureData,h=n.evaluatedColor[2],p=n.evaluatedRMEA[2],_=this.id.canonical;if(n.hasTranslucentParts=!1,l){for(let y=0;y<j1.length;y++){const v=j1[y];v.length&&(a.properties.part=v);const T=e.paint.get("model-color").evaluate(a,{},_),A=e.paint.get("model-color-mix-intensity").evaluate(a,{},_);n.evaluatedColor[y]=[T.r,T.g,T.b,A],n.evaluatedRMEA[y][0]=e.paint.get("model-roughness").evaluate(a,{},_),n.evaluatedRMEA[y][2]=e.paint.get("model-emissive-strength").evaluate(a,{},_),n.evaluatedRMEA[y][3]=T.a,n.emissionHeightBasedParams[y]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,{},_),!n.hasTranslucentParts&&T.a<1&&(n.hasTranslucentParts=!0)}delete a.properties.part,CM(n,h!==n.evaluatedColor[2]||p!==n.evaluatedRMEA[2],this.modelTraits)}else n.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(a,{},_);n.evaluatedScale=e.paint.get("model-scale").evaluate(a,{},_),this.updatePbrBuffer(n.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,n,a){const l=e.findDEMTileFor(n);if(l&&(l.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;const h=su.create(e,n,l);if(!h)return;this.modelTraits&mu.HasMapboxMeshFeatures&&this.updateDEM(e,h,n,a);for(const p of this.getNodesInfo()){const _=p.node;if(!_.footprint||!_.footprint.vertices||!_.footprint.vertices.length)continue;const y=_.footprint.vertices;let v=h.getElevationAt(y[0].x,y[0].y,!0,!0);for(let T=1;T<y.length;T++)v=Math.min(v,h.getElevationAt(y[T].x,y[T].y,!0,!0));_.elevation=v}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,n,a){let l=i._dem._modifiedForSources[a];if(l===void 0&&(i._dem._modifiedForSources[a]=[],l=i._dem._modifiedForSources[a]),l.includes(n.canonical))return;const h=i._dem.dim;l.push(n.canonical);let p=!1;for(const _ of this.getNodesInfo()){const y=_.node;if(!y.footprint||!y.footprint.grid)continue;const v=y.footprint.grid,T=i.tileCoordToPixel(v.min.x,v.min.y),A=i.tileCoordToPixel(v.max.x,v.max.y),C=Math.min(Math.min(h-A.y,T.x),Math.min(T.y,h-A.x));if(C<0)continue;const R=zt(C,2,5);let D=Math.max(0,T.x-R),B=Math.max(0,T.y-R),N=Math.min(A.x+R,h-1),H=Math.min(A.y+R,h-1);for(let ie=B;ie<=H;++ie)for(let ce=D;ce<=N;++ce)sc[ie*h+ce]=255;let K=0,Y=0;for(let ie=0;ie<v.cellsY;++ie)for(let ce=0;ce<v.cellsX;++ce){if(!v.cells[ie*v.cellsX+ce])continue;const me=i.tileCoordToPixel(v.min.x+ce/v.xScale,v.min.y+ie/v.yScale),ye=i.tileCoordToPixel(v.min.x+(ce+1)/v.xScale,v.min.y+(ie+1)/v.yScale);for(let Ee=me.y;Ee<=Math.min(ye.y+1,h-1);++Ee)for(let xe=me.x;xe<=Math.min(ye.x+1,h-1);++xe)sc[Ee*h+xe]===255&&(sc[Ee*h+xe]=0,K+=i.getElevationAtPixel(xe,Ee),Y++)}const ne=K/Y;D=Math.max(1,T.x-R),B=Math.max(1,T.y-R),N=Math.min(A.x+R,h-2),H=Math.min(A.y+R,h-2),p=!0;for(let ie=B;ie<=H;++ie)for(let ce=D;ce<=N;++ce)sc[ie*h+ce]===0&&(kg[ie*h+ce]=i._dem.set(ce,ie,ne));for(let ie=1;ie<R;++ie){D=Math.max(1,T.x-ie),B=Math.max(1,T.y-ie),N=Math.min(A.x+ie,h-2),H=Math.min(A.y+ie,h-2);for(let ce=B;ce<=H;++ce)for(let me=D;me<=N;++me){const ye=ce*h+me;if(sc[ye]===255){let Ee=0,xe=0,De=-1,je=-1;for(let Re=-1;Re<=1;++Re)for(let Ve=-1;Ve<=1;++Ve){const Me=(ce+Re)*h+me+Ve;if(sc[Me]>=ie)continue;const Ne=kg[Me],nt=Math.abs(Ne);nt>xe&&(Ee=Ne,xe=nt,De=Ve,je=Re)}if(xe>.1){const Re=1-(ie+.5*Math.abs(De*je))/R;let Ve=i._dem.get(me,ce)+Ee*Re;const Me=i._dem.get(me+De,ce+je),Ne=i._dem.get(me-De,ce-je,!0);(Ve-Me)*(Ve-Ne)>0&&(Ve=(Me+Ne)/2),kg[ye]=i._dem.set(me,ce,Ve),sc[ye]=ie}}}}}p&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Xe.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)Kp(i.node),Cg(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const n=i.getReplacementRegionsForTile(e.toUnwrapped()),a=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){const h=a[l].node;a[l].hiddenByReplacement=!!h.footprint&&!n.find(p=>p.footprint===h.footprint)}}getHeightAtTileCoord(e,i){const n=this.getNodesInfo(),a=[];for(let l=0;l<this.nodesInfo.length;l++){const h=n[l],p=h.node.meshes[0];if(e<p.aabb.min[0]||i<p.aabb.min[1]||e>p.aabb.max[0]||i>p.aabb.max[1])continue;const _=(e-p.aabb.min[0])/(p.aabb.max[0]-p.aabb.min[0])*rc|0,y=Math.min(63,(i-p.aabb.min[1])/(p.aabb.max[1]-p.aabb.min[1])*rc|0)*rc+Math.min(63,_);if(!(p.heightmap[y]<0&&h.node.footprint))return h.hiddenByReplacement?void 0:{height:p.heightmap[y],maxHeight:h.feature.properties.height,hidden:!1,verticalScale:h.evaluatedScale[2]};if(h.node.footprint.grid.query(new Ue(e,i),new Ue(e,i),a),a.length>0)return{height:void 0,maxHeight:h.feature.properties.height,hidden:h.hiddenByReplacement,verticalScale:h.evaluatedScale[2]}}}}function Od(t,e){return!t.isLightConstant&&e}function IM(t,e,i,n,a,l,h,p){let _=(61440&e|(61440&e)>>4)>>8,y=(3840&e|(3840&e)>>4)>>4,v=240&e|(240&e)>>4;i[3]>0&&(_=Si(_,255*i[0],i[3]),y=Si(y,255*i[1],i[3]),v=Si(v,255*i[2],i[3]));const T=_<<8|y,A=v<<8|Math.floor(255*n[3]),C=function(ie){const ce=zt(ie,0,2);return Math.min(Math.round(.5*ce*255),255)}(n[2])<<8|15*n[0]<<4|15*n[1],R=zt(a[0],0,1),D=zt(a[1],0,1),B=zt(a[2],0,1),N=zt(a[3],0,1);let H,K,Y,ne;if(R!==D&&h!==l&&D!==R){const ie=h-l;K=1/(ie*(D-R)),Y=-(l+ie*R)/(ie*(D-R));const ce=zt(a[4],-1,1);ne=Math.pow(10,ce),H=255*B<<8|255*N}else H=65535,K=0,Y=1,ne=1;if(t.emplaceBack(T,A,C,H,K,Y,ne),p){const ie=p.length;p.clear();for(let ce=0;ce<ie;ce++)p.emplaceBack(T,A,C,H,K,Y,ne)}}function CM(t,e,i){const n=t.node;let a=0;const l=i&mu.HasMeshoptCompression;for(const h of n.meshes){if(n.lights&&n.lightMeshIndex===a||!h.featureData)continue;h.featureArray=new Zl,h.featureArray.reserve(h.featureData.length);let p=e;for(const _ of h.featureData){const y=l?65535&_:_>>16&65535,v=l?_>>16&65535:65535&_,T=(15&v)<8?15&v:0,A=t.evaluatedRMEA[T],C=t.evaluatedColor[T],R=t.emissionHeightBasedParams[T];let D;if(p&&T===2&&n.lights&&(D=new Zl,D.resize(10*n.lights.length)),IM(h.featureArray,y,C,A,R,h.aabb.min[2],h.aabb.max[2],D),D&&p){p=!1;const B=n.meshes[n.lightMeshIndex];B.featureArray=D,B.featureArray._trim()}}h.featureArray._trim(),a++}}function $1(t,e,i,n){const a=1<<t.z;e.lat=Ii((n/_t+t.y)/a),e.lng=oi((i/_t+t.x)/a)}wt(im,"Tiled3dModelBucket",{omit:["layers"]}),wt(G1,"Tiled3dModelFeature");const PM={circle:class extends $n{constructor(t,e,i){super(t,wE,e,i)}createBucket(t){return new Hn(t)}queryRadius(t){const e=t;return iu("circle-radius",this,e)+iu("circle-stroke-width",this,e)+cp(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,n,a,l,h,p){const _=a0(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),y=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return zx(t,n,l,h,p,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",_,y)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const i=Dx(this);return{config:new O(this,e),defines:i,overrideFog:!1}}},heatmap:class extends $n{createBucket(t){return new Ox(t)}constructor(t,e,i){super(t,QE,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=md({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return iu("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,n,a,l,h,p){const _=this.paint.get("heatmap-radius").evaluate(e,i);return zx(t,n,l,h,p,!0,!0,new Ue(0,0),_)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new O(this,e),overrideFog:!1}:{}}},hillshade:class extends $n{constructor(t,e,i){super(t,tS,e,i)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends $n{constructor(t,e,i){super(t,mS,e,i)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e){return{config:new O(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new og(t)}queryRadius(){return cp(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,n,a,l){return!t.queryGeometry.isAboveHorizon&&ta(o0(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends $n{constructor(t,e,i){super(t,GS,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Cp(t)}queryRadius(){return cp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,i,n,a,l,h,p,_){const y=a0(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),v=this.paint.get("fill-extrusion-height").evaluate(e,i),T=this.paint.get("fill-extrusion-base").evaluate(e,i),A=[0,0],C=p&&l.elevation,R=l.elevation?l.elevation.exaggeration():1,D=t.tile.getBucket(this);if(C&&D instanceof Cp){const Y=D.centroidVertexArray,ne=_+1;ne<Y.length&&(A[0]=Y.geta_centroid_pos0(ne),A[1]=Y.geta_centroid_pos1(ne))}if(A[0]===0&&A[1]===1)return!1;l.projection.name==="globe"&&(n=gv([n],[new Ue(0,0),new Ue(_t,_t)],t.tileID.canonical).map(Y=>Y.polygon).flat());const B=C?p:null,[N,H]=function(Y,ne,ie,ce,me,ye,Ee,xe,De,je,Re){return Y.projection.name==="globe"?function(Ve,Me,Ne,nt,Ge,Mt,xt,He,Xt,Dt,At){const We=[],$t=[],mi=Ve.projection.upVectorScale(At,Ve.center.lat,Ve.worldSize).metersToTile,Yt=[0,0,0,1],_i=[0,0,0,1],ii=(li,cr,Oi,Ni)=>{li[0]=cr,li[1]=Oi,li[2]=Ni,li[3]=1},Ai=_v();Ne>0&&(Ne+=Ai),nt+=Ai;for(const li of Me){const cr=[],Oi=[];for(const Ni of li){const Hi=Ni.x+Ge.x,Bi=Ni.y+Ge.y,Ir=Ve.projection.projectTilePoint(Hi,Bi,At),rr=Ve.projection.upVector(At,Ni.x,Ni.y);let Fr=Ne,rn=nt;if(xt){const vn=xv(Hi,Bi,Ne,nt,xt,He,Xt,Dt);Fr+=vn.base,rn+=vn.top}Ne!==0?ii(Yt,Ir.x+rr[0]*mi*Fr,Ir.y+rr[1]*mi*Fr,Ir.z+rr[2]*mi*Fr):ii(Yt,Ir.x,Ir.y,Ir.z),ii(_i,Ir.x+rr[0]*mi*rn,Ir.y+rr[1]*mi*rn,Ir.z+rr[2]*mi*rn),o.N.transformMat4(Yt,Yt,Mt),o.N.transformMat4(_i,_i,Mt),cr.push(new ou(Yt[0],Yt[1],Yt[2])),Oi.push(new ou(_i[0],_i[1],_i[2]))}We.push(cr),$t.push(Oi)}return[We,$t]}(Y,ne,ie,ce,me,ye,Ee,xe,De,je,Re):Ee?function(Ve,Me,Ne,nt,Ge,Mt,xt,He,Xt){const Dt=[],At=[],We=[0,0,0,1];for(const $t of Ve){const mi=[],Yt=[];for(const _i of $t){const ii=_i.x+nt.x,Ai=_i.y+nt.y,li=xv(ii,Ai,Me,Ne,Mt,xt,He,Xt);We[0]=ii,We[1]=Ai,We[2]=li.base,We[3]=1,o.a7.transformMat4(We,We,Ge),We[3]=Math.max(We[3],1e-5);const cr=new ou(We[0]/We[3],We[1]/We[3],We[2]/We[3]);We[0]=ii,We[1]=Ai,We[2]=li.top,We[3]=1,o.a7.transformMat4(We,We,Ge),We[3]=Math.max(We[3],1e-5);const Oi=new ou(We[0]/We[3],We[1]/We[3],We[2]/We[3]);mi.push(cr),Yt.push(Oi)}Dt.push(mi),At.push(Yt)}return[Dt,At]}(ne,ie,ce,me,ye,Ee,xe,De,je):function(Ve,Me,Ne,nt,Ge){const Mt=[],xt=[],He=Ge[8]*Me,Xt=Ge[9]*Me,Dt=Ge[10]*Me,At=Ge[11]*Me,We=Ge[8]*Ne,$t=Ge[9]*Ne,mi=Ge[10]*Ne,Yt=Ge[11]*Ne;for(const _i of Ve){const ii=[],Ai=[];for(const li of _i){const cr=li.x+nt.x,Oi=li.y+nt.y,Ni=Ge[0]*cr+Ge[4]*Oi+Ge[12],Hi=Ge[1]*cr+Ge[5]*Oi+Ge[13],Bi=Ge[2]*cr+Ge[6]*Oi+Ge[14],Ir=Ge[3]*cr+Ge[7]*Oi+Ge[15],rr=Ni+He,Fr=Hi+Xt,rn=Bi+Dt,vn=Math.max(Ir+At,1e-5),Er=Ni+We,Dr=Hi+$t,hn=Bi+mi,dn=Math.max(Ir+Yt,1e-5);ii.push(new ou(rr/vn,Fr/vn,rn/vn)),Ai.push(new ou(Er/dn,Dr/dn,hn/dn))}Mt.push(ii),xt.push(Ai)}return[Mt,xt]}(ne,ie,ce,me,ye)}(l,n,T,v,y,h,B,A,R,l.center.lat,t.tileID.canonical),K=t.queryGeometry;return function(Y,ne,ie){let ce=1/0;ta(ie,ne)&&(ce=yv(ie,ne[0]));for(let me=0;me<ne.length;me++){const ye=ne[me],Ee=Y[me];for(let xe=0;xe<ye.length-1;xe++){const De=ye[xe],je=[De,ye[xe+1],Ee[xe+1],Ee[xe],De];zs(ie,je)&&(ce=Math.min(ce,yv(ie,je)))}}return ce!==1/0&&ce}(N,H,K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends $n{constructor(t,e,i){super(t,bv,e,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof El,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Mv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new cg(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const i=Sv(this);return{config:new O(this,e),defines:i,overrideFog:!1}}queryRadius(t){const e=t,i=Iv(iu("line-width",this,e),iu("line-gap-width",this,e)),n=iu("line-offset",this,e);return i/2+Math.abs(n)+cp(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,n,a,l){if(t.queryGeometry.isAboveHorizon)return!1;const h=o0(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),p=t.pixelToTileUnitsFactor/2*Iv(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),_=this.paint.get("line-offset").evaluate(e,i);return _&&(n=function(y,v){const T=[],A=new Ue(0,0);for(let C=0;C<y.length;C++){const R=y[C],D=[];for(let B=0;B<R.length;B++){const N=R[B],H=R[B+1],K=B===0?A:N.sub(R[B-1])._unit()._perp(),Y=B===R.length-1?A:H.sub(N)._unit()._perp(),ne=K._add(Y)._unit();ne._mult(1/(ne.x*Y.x+ne.y*Y.y)),D.push(ne._mult(v)._add(N))}T.push(D)}return T}(n,_*t.pixelToTileUnitsFactor)),function(y,v,T){for(let A=0;A<v.length;A++){const C=v[A];if(y.length>=3){for(let R=0;R<C.length;R++)if(Hs(y,C[R]))return!0}if(Kl(y,C,T))return!0}return!1}(h,n,p)}isTileClipped(){return!0}},symbol:qp,background:class extends $n{constructor(t,e,i){super(t,ZA,e,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:f1,"raster-particle":p1,sky:class extends $n{constructor(t,e,i){super(t,eM,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=md({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const n=this.paint.get("sky-atmosphere-sun"),a=!n,l=t.style.light,h=l.properties.get("position");return a&&l.properties.get("anchor")==="viewport"&&pe("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?Sg(h.azimuthal,90-h.polar,e):Sg(n[0],90-n[1],e)}const i=this.paint.get("sky-gradient-center");return Sg(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends $n{constructor(t,e,i){super(t,tM,e)}},model:class extends $n{constructor(t,e,i){super(t,uM,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Mg(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof im?_t-1:0}queryIntersectsFeature(t,e,i,n,a,l){if(!this.modelManager)return!1;const h=this.modelManager,p=t.tile.getBucket(this);if(!(p&&p instanceof Mg))return!1;const _=p;for(const y in _.instancesPerModel){const v=_.instancesPerModel[y];if(v.idToFeaturesIndex.hasOwnProperty(e.id)){const T=v.features[v.idToFeaturesIndex[e.id]],A=h.getModel(y,this.scope);if(!A)return!1;let C=o.a6.create();const R=new ge(0,0),D=_.canonical;let B=Number.MAX_VALUE;for(let N=0;N<T.instancedDataCount;++N){const H=16*(T.instancedDataOffset+N),K=v.instancedDataArray.float32,Y=[K[H+4],K[H+5],K[H+6]];$1(D,R,K[H],0|K[H+1]),T1(C,A,l,R,T.rotation,T.scale,Y,!1,!1,!1),l.projection.name==="globe"&&(C=Ag(C,l));const ne=o.a6.multiply([],l.projMatrix,C),ie=t.queryGeometry,ce=v1(ie.isPointQuery()?ie.screenBounds:ie.screenGeometry,l,ne,A.aabb);ce!=null&&(B=Math.min(ce,B))}return B!==Number.MAX_VALUE&&B}}return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Cl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,i,n){const a=t.tile,l=a.getBucket(this);let h=null,p=Number.MAX_VALUE;if(!(l&&l instanceof im))return{queryFeature:h,intersectionZ:p};const _=l.getNodesInfo()[e];if(_.hiddenByReplacement||!_.node.meshes||!i.filter(new Cr(a.tileID.overscaledZ),_.feature,a.tileID.canonical))return{queryFeature:h,intersectionZ:p};const y=_.node,v=n.calculatePosMatrix(a.tileID.toUnwrapped(),n.worldSize),T=_.evaluatedScale;let A=0;n.elevation&&y.elevation&&(A=y.elevation*n.elevation.exaggeration()),o.a6.translate(v,v,[(y.anchor?y.anchor[0]:0)*(T[0]-1),(y.anchor?y.anchor[1]:0)*(T[1]-1),A]),o.a6.scale(v,v,T),o.a6.multiply(v,v,y.matrix);const C=t.queryGeometry,R=C.isPointQuery()?C.screenBounds:C.screenGeometry,D=function(N){const H=o.a6.multiply([],v,N.matrix),K=o.a6.multiply(H,n.expandedFarZProjMatrix,H);for(let Y=0;Y<N.meshes.length;++Y){const ne=N.meshes[Y];if(Y===N.lightMeshIndex)continue;const ie=v1(R,n,K,ne.aabb);ie!=null&&(p=Math.min(ie,p))}if(N.children)for(const Y of N.children)D(Y)};if(D(y),p===Number.MAX_VALUE)return{queryFeature:h,intersectionZ:p};const B=new ge(0,0);return $1(a.tileID.canonical,B,_.node.anchor[0],_.node.anchor[1]),h={type:"Feature",geometry:{type:"Point",coordinates:[B.lng,B.lat]},properties:_.feature.properties,id:_.feature.id,state:{},layer:this.serialize()},{queryFeature:h,intersectionZ:p}}}},ui={read:function(t,e){return t.readFields(ui._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,i){t===1?e.header_length=i.readFixed32():t===2?e.x=i.readVarint():t===3?e.y=i.readVarint():t===4?e.z=i.readVarint():t===5&&e.layers.push(ui.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};ui.Filter.read=function(t,e){return t.readFields(ui.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},ui.Filter._readField=function(t,e,i){t===1?(e.delta_filter=ui.Filter.Delta.read(i,i.readVarint()+i.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=ui.Filter.Zigzag.read(i,i.readVarint()+i.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=ui.Filter.BitShuffle.read(i,i.readVarint()+i.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=ui.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),e.filter="byteshuffle_filter")},ui.Filter.Delta={},ui.Filter.Delta.read=function(t,e){return t.readFields(ui.Filter.Delta._readField,{block_size:0},e)},ui.Filter.Delta._readField=function(t,e,i){t===1&&(e.block_size=i.readVarint())},ui.Filter.Zigzag={},ui.Filter.Zigzag.read=function(t,e){return t.readFields(ui.Filter.Zigzag._readField,{},e)},ui.Filter.Zigzag._readField=function(t,e,i){},ui.Filter.BitShuffle={},ui.Filter.BitShuffle.read=function(t,e){return t.readFields(ui.Filter.BitShuffle._readField,{},e)},ui.Filter.BitShuffle._readField=function(t,e,i){},ui.Filter.ByteShuffle={},ui.Filter.ByteShuffle.read=function(t,e){return t.readFields(ui.Filter.ByteShuffle._readField,{},e)},ui.Filter.ByteShuffle._readField=function(t,e,i){},ui.Codec={},ui.Codec.read=function(t,e){return t.readFields(ui.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},ui.Codec._readField=function(t,e,i){t===1?(e.gzip_data=ui.Codec.GzipData.read(i,i.readVarint()+i.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=ui.Codec.JpegImage.read(i,i.readVarint()+i.pos),e.codec="jpeg_image"):t===3?(e.webp_image=ui.Codec.WebpImage.read(i,i.readVarint()+i.pos),e.codec="webp_image"):t===4&&(e.png_image=ui.Codec.PngImage.read(i,i.readVarint()+i.pos),e.codec="png_image")},ui.Codec.GzipData={},ui.Codec.GzipData.read=function(t,e){return t.readFields(ui.Codec.GzipData._readField,{},e)},ui.Codec.GzipData._readField=function(t,e,i){},ui.Codec.JpegImage={},ui.Codec.JpegImage.read=function(t,e){return t.readFields(ui.Codec.JpegImage._readField,{},e)},ui.Codec.JpegImage._readField=function(t,e,i){},ui.Codec.WebpImage={},ui.Codec.WebpImage.read=function(t,e){return t.readFields(ui.Codec.WebpImage._readField,{},e)},ui.Codec.WebpImage._readField=function(t,e,i){},ui.Codec.PngImage={},ui.Codec.PngImage.read=function(t,e){return t.readFields(ui.Codec.PngImage._readField,{},e)},ui.Codec.PngImage._readField=function(t,e,i){},ui.DataIndexEntry={},ui.DataIndexEntry.read=function(t,e){return t.readFields(ui.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},ui.DataIndexEntry._readField=function(t,e,i){t===1?e.first_byte=i.readFixed64():t===2?e.last_byte=i.readFixed64():t===3?e.filters.push(ui.Filter.read(i,i.readVarint()+i.pos)):t===4?e.codec=ui.Codec.read(i,i.readVarint()+i.pos):t===5?e.offset=i.readFloat():t===6?e.scale=i.readFloat():t===7&&e.bands.push(i.readString())},ui.Layer={},ui.Layer.read=function(t,e){return t.readFields(ui.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},ui.Layer._readField=function(t,e,i){t===1?e.version=i.readVarint():t===2?e.name=i.readString():t===3?e.units=i.readString():t===4?e.tilesize=i.readVarint():t===5?e.buffer=i.readVarint():t===6?e.pixel_format=i.readVarint():t===7&&e.data_index.push(ui.DataIndexEntry.read(i,i.readVarint()+i.pos))};const Qs={read:function(t,e){return t.readFields(Qs._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,i){t===2?(e.uint32_values=Qs.Uint32Values.read(i,i.readVarint()+i.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=Qs.Fixed32Values.read(i,i.readVarint()+i.pos),e.values="fixed32_values")},Uint32Values:{}};Qs.Uint32Values.read=function(t,e){return t.readFields(Qs.Uint32Values._readField,{values:[]},e)},Qs.Uint32Values._readField=function(t,e,i){t===1&&(e.readValuesInto=function(n){if(n.type!==2)throw new Error(`Unsupported pbf type "${n.type}"`);const a=function(h){return h.type===2?h.readVarint()+h.pos:h.pos+1}(n),l=n.pos;return n.pos=a,function(h){n.pos=l;let p=0;for(;n.pos<a;){const _=n.readVarint();h[p++]=_}return h}}(i))},Qs.Fixed32Values={},Qs.Fixed32Values.read=function(t,e){return t.readFields(Qs.Fixed32Values._readField,{values:[]},e)},Qs.Fixed32Values._readField=function(t,e,i){throw new Error("Not implemented")};/**
 * tiny-lru
 *
 * @copyright 2023 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.2.5
 */class RM{constructor(e=0,i=0,n=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=n,this.size=0,this.ttl=i}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const i=this.items[e];delete this.items[e],this.size--,i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.first===i&&(this.first=i.next),this.last===i&&(this.last=i.prev)}return this}entries(e=this.keys()){return e.map(i=>[i,this.get(i)])}evict(e=!1){if(e||this.size>0){const i=this.first;delete this.items[i.key],--this.size==0?(this.first=null,this.last=null):(this.first=i.next,this.first.prev=null)}return this}expiresAt(e){let i;return this.has(e)&&(i=this.items[e].expiry),i}get(e){let i;if(this.has(e)){const n=this.items[e];this.ttl>0&&n.expiry<=Date.now()?this.delete(e):(i=n.value,this.set(e,i,!0))}return i}has(e){return e in this.items}keys(){const e=[];let i=this.first;for(;i!==null;)e.push(i.key),i=i.next;return e}set(e,i,n=!1,a=this.resetTtl){let l;if(n||this.has(e)){if(l=this.items[e],l.value=i,n===!1&&a&&(l.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==l){const h=this.last,p=l.next,_=l.prev;this.first===l&&(this.first=l.next),l.next=null,l.prev=this.last,h.next=l,_!==null&&(_.next=p),p!==null&&(p.prev=_)}}else this.max>0&&this.size===this.max&&this.evict(!0),l=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:i},++this.size==1?this.first=l:this.last.next=l;return this.last=l,this}values(e=this.keys()){return e.map(i=>this.get(i))}}function LM(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let n=2;n>=1;n--){const a=n===1?1:0,l=n===2?1:0;for(let h=0;h<e[0];h++){const p=e[1]*h;for(let _=a;_<e[1];_++){const y=e[2]*(_+p);for(let v=l;v<e[2];v++){const T=e[3]*(v+y);for(let A=0;A<e[3];A++){const C=T+A;t[C]+=t[C-i]}}}}i*=e[n]}return t}function DM(t){for(let e=0,i=t.length;e<i;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function zM(t,e){switch(e){case"uint32":return t;case"uint16":for(let i=0;i<t.length;i+=2){const n=t[i],a=t[i+1];t[i]=(240&n)>>4|(61440&n)>>8|(240&a)<<4|61440&a,t[i+1]=15&n|(3840&n)>>4|(15&a)<<8|(3840&a)<<4}return t;case"uint8":for(let i=0;i<t.length;i+=4){const n=t[i],a=t[i+1],l=t[i+2],h=t[i+3];t[i+0]=(192&n)>>6|(192&a)>>4|(192&l)>>2|192&h,t[i+1]=(48&n)>>4|(48&a)>>2|48&l|(48&h)<<2,t[i+2]=(12&n)>>2|12&a|(12&l)<<2|(12&h)<<4,t[i+3]=3&n|(3&a)<<2|(3&l)<<4|(3&h)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Xa extends Error{constructor(e){super(e),this.name="MRTError"}}var Ms=Uint8Array,xu=Uint16Array,kM=Int32Array,q1=new Ms([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Z1=new Ms([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),OM=new Ms([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),H1=function(t,e){for(var i=new xu(31),n=0;n<31;++n)i[n]=e+=1<<t[n-1];var a=new kM(i[30]);for(n=1;n<30;++n)for(var l=i[n];l<i[n+1];++l)a[l]=l-i[n]<<5|n;return{b:i,r:a}},W1=H1(q1,2),X1=W1.b,BM=W1.r;X1[28]=258,BM[258]=28;for(var FM=H1(Z1,0).b,Og=new xu(32768),qr=0;qr<32768;++qr){var vu=(43690&qr)>>1|(21845&qr)<<1;Og[qr]=((65280&(vu=(61680&(vu=(52428&vu)>>2|(13107&vu)<<2))>>4|(3855&vu)<<4))>>8|(255&vu)<<8)>>1}var Bd=function(t,e,i){for(var n=t.length,a=0,l=new xu(e);a<n;++a)t[a]&&++l[t[a]-1];var h,p=new xu(e);for(a=1;a<e;++a)p[a]=p[a-1]+l[a-1]<<1;if(i){h=new xu(1<<e);var _=15-e;for(a=0;a<n;++a)if(t[a])for(var y=a<<4|t[a],v=e-t[a],T=p[t[a]-1]++<<v,A=T|(1<<v)-1;T<=A;++T)h[Og[T]>>_]=y}else for(h=new xu(n),a=0;a<n;++a)t[a]&&(h[a]=Og[p[t[a]-1]++]>>15-t[a]);return h},Fd=new Ms(288);for(qr=0;qr<144;++qr)Fd[qr]=8;for(qr=144;qr<256;++qr)Fd[qr]=9;for(qr=256;qr<280;++qr)Fd[qr]=7;for(qr=280;qr<288;++qr)Fd[qr]=8;var Y1=new Ms(32);for(qr=0;qr<32;++qr)Y1[qr]=5;var NM=Bd(Fd,9,1),VM=Bd(Y1,5,1),Bg=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},eo=function(t,e,i){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(7&e)&i},Fg=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},UM=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],to=function(t,e,i){var n=new Error(e||UM[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,to),!i)throw n;return n},jM=new Ms(0),GM=typeof TextDecoder<"u"&&new TextDecoder;try{GM.decode(jM,{stream:!0})}catch{}const $M={gzip_data:"gzip"},qM={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},ZM={uint32:1,uint16:2,uint8:4},HM={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class K1{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const i=new Uint8Array(e),n=new DataView(e);if(i[0]!==13)throw new Xa("File is not a valid MRT.");return n.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),n=this.getHeaderLength(e);if(i.length<n)throw new Xa(`Expected header with length >= ${n} but got buffer of length ${i.length}`);const a=new uu(i.subarray(0,n)),l=ui.read(a);if(!isNaN(this.x)&&(this.x!==l.x||this.y!==l.y||this.z!==l.z))throw new Xa(`Invalid attempt to parse header ${l.z}/${l.x}/${l.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=l.x,this.y=l.y,this.z=l.z;for(const h of l.layers)this.layers[h.name]=new WM(h,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],n=this.getLayer(e.layerName);for(let a=0;a<n.dataIndex.length;a++){const l=n.dataIndex[a],h=l.first_byte-e.firstByte,p=l.last_byte+1-e.firstByte;if(a<e.firstBlock||a>e.lastBlock||n._blocksInProgress.has(a))continue;const _={layerName:n.name,firstByte:h,lastByte:p,pixelFormat:n.pixelFormat,blockIndex:a,blockShape:[l.bands.length].concat(n.bandShape),buffer:n.buffer,codec:l.codec.codec,filters:l.filters.map(y=>y.filter)};n._blocksInProgress.add(a),i.push(_)}return new J1(i,()=>{i.forEach(a=>n._blocksInProgress.delete(a.blockIndex))},(a,l)=>{if(i.forEach(h=>n._blocksInProgress.delete(h.blockIndex)),a)throw a;l.forEach(h=>{this.getLayer(h.layerName).processDecodedData(h)})})}}class WM{constructor({version:e,name:i,units:n,tilesize:a,pixel_format:l,buffer:h,data_index:p},_){if(this.version=e,this.version!==1)throw new Xa(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=n,this.tileSize=a,this.buffer=h,this.pixelFormat=qM[l],this.dataIndex=p,this.bandShape=[a+2*h,a+2*h,ZM[this.pixelFormat]],this._decodedBlocks=function(y=1e3,v=0,T=!1){if(isNaN(y)||y<0)throw new TypeError("Invalid max value");if(isNaN(v)||v<0)throw new TypeError("Invalid ttl value");if(typeof T!="boolean")throw new TypeError("Invalid resetTtl value");return new RM(y,v,T)}(_?_.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.set(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[n,a]of this.dataIndex.entries()){for(const[l,h]of a.bands.entries())if(h===e)return{bandIndex:i+l,blockIndex:n,blockBandIndex:l};i+=a.bands.length}break;case"number":for(const[n,a]of this.dataIndex.entries()){if(e>=i&&e<i+a.bands.length)return{bandIndex:e,blockIndex:n,blockBandIndex:e-i};i+=a.bands.length}break;default:throw new Xa(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Xa(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,n=-1/0,a=1/0,l=-1/0;for(const h of e){const{blockIndex:p}=this.getBlockForBand(h);if(p<0)throw new Xa(`Invalid band: ${JSON.stringify(h)}`);const _=this.dataIndex[p];a=Math.min(a,p),l=Math.max(l,p),i=Math.min(i,_.first_byte),n=Math.max(n,_.last_byte)}return{layerName:this.name,firstByte:i,lastByte:n,firstBlock:a,lastBlock:l}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:n}=this.getBlockForBand(e),a=this._decodedBlocks.get(i.toString());if(!a)throw new Xa(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const l=this.dataIndex[i],h=this.bandShape.reduce((y,v)=>y*v,1),p=n*h,_=a.subarray(p,p+h);return{data:_,bytes:new Uint8Array(_.buffer).subarray(_.byteOffset,_.byteOffset+_.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:l.offset,scale:l.scale}}}class J1{constructor(e,i,n){this.tasks=e,this._onCancel=i,this._onComplete=n,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}K1.performDecoding=function(t,e){return Promise.all(e.tasks.map(i=>{const{layerName:n,firstByte:a,lastByte:l,pixelFormat:h,blockShape:p,blockIndex:_,filters:y,codec:v}=i,T=new Uint8Array(t).subarray(a,l+1),A=new Uint32Array(p[0]*p[1]*p[2]);let C;if(v!=="gzip_data")throw new Error(`Unhandled codec: ${v}`);return C=function(R,D){if(!globalThis.DecompressionStream&&D==="gzip_data")return Promise.resolve(((K=function(ie){ie[0]==31&&ie[1]==139&&ie[2]==8||to(6,"invalid gzip data");var ce=ie[3],me=10;4&ce&&(me+=2+(ie[10]|ie[11]<<8));for(var ye=(ce>>3&1)+(ce>>4&1);ye>0;ye-=!ie[me++]);return me+(2&ce)}(H=R))+8>H.length&&to(6,"invalid gzip data"),function(ie,ce,me,ye){var Ee=ie.length;if(!Ee||ce.f&&!ce.l)return me||new Ms(0);var xe=!me,De=xe||ce.i!=2,je=ce.i;xe&&(me=new Ms(3*Ee));var Re=function(Wn){var On=me.length;if(Wn>On){var Is=new Ms(Math.max(2*On,Wn));Is.set(me),me=Is}},Ve=ce.f||0,Me=ce.p||0,Ne=ce.b||0,nt=ce.l,Ge=ce.d,Mt=ce.m,xt=ce.n,He=8*Ee;do{if(!nt){Ve=eo(ie,Me,1);var Xt=eo(ie,Me+1,3);if(Me+=3,!Xt){var Dt=ie[(Oi=4+((Me+7)/8|0))-4]|ie[Oi-3]<<8,At=Oi+Dt;if(At>Ee){je&&to(0);break}De&&Re(Ne+Dt),me.set(ie.subarray(Oi,At),Ne),ce.b=Ne+=Dt,ce.p=Me=8*At,ce.f=Ve;continue}if(Xt==1)nt=NM,Ge=VM,Mt=9,xt=5;else if(Xt==2){var We=eo(ie,Me,31)+257,$t=eo(ie,Me+10,15)+4,mi=We+eo(ie,Me+5,31)+1;Me+=14;for(var Yt=new Ms(mi),_i=new Ms(19),ii=0;ii<$t;++ii)_i[OM[ii]]=eo(ie,Me+3*ii,7);Me+=3*$t;var Ai=Bg(_i),li=(1<<Ai)-1,cr=Bd(_i,Ai,1);for(ii=0;ii<mi;){var Oi,Ni=cr[eo(ie,Me,li)];if(Me+=15&Ni,(Oi=Ni>>4)<16)Yt[ii++]=Oi;else{var Hi=0,Bi=0;for(Oi==16?(Bi=3+eo(ie,Me,3),Me+=2,Hi=Yt[ii-1]):Oi==17?(Bi=3+eo(ie,Me,7),Me+=3):Oi==18&&(Bi=11+eo(ie,Me,127),Me+=7);Bi--;)Yt[ii++]=Hi}}var Ir=Yt.subarray(0,We),rr=Yt.subarray(We);Mt=Bg(Ir),xt=Bg(rr),nt=Bd(Ir,Mt,1),Ge=Bd(rr,xt,1)}else to(1);if(Me>He){je&&to(0);break}}De&&Re(Ne+131072);for(var Fr=(1<<Mt)-1,rn=(1<<xt)-1,vn=Me;;vn=Me){var Er=(Hi=nt[Fg(ie,Me)&Fr])>>4;if((Me+=15&Hi)>He){je&&to(0);break}if(Hi||to(2),Er<256)me[Ne++]=Er;else{if(Er==256){vn=Me,nt=null;break}var Dr=Er-254;Er>264&&(Dr=eo(ie,Me,(1<<(fn=q1[ii=Er-257]))-1)+X1[ii],Me+=fn);var hn=Ge[Fg(ie,Me)&rn],dn=hn>>4;if(hn||to(3),Me+=15&hn,rr=FM[dn],dn>3){var fn=Z1[dn];rr+=Fg(ie,Me)&(1<<fn)-1,Me+=fn}if(Me>He){je&&to(0);break}De&&Re(Ne+131072);var mr=Ne+Dr;if(Ne<rr){var hs=0-rr,Ya=Math.min(rr,mr);for(hs+Ne<0&&to(3);Ne<Ya;++Ne)me[Ne]=ye[hs+Ne]}for(;Ne<mr;++Ne)me[Ne]=me[Ne-rr]}}ce.l=nt,ce.p=vn,ce.b=Ne,ce.f=Ve,nt&&(Ve=1,ce.m=Mt,ce.d=Ge,ce.n=xt)}while(!Ve);return Ne!=me.length&&xe?function(Wn,On,Is){return(On==null||On<0)&&(On=0),(Is==null||Is>Wn.length)&&(Is=Wn.length),new Ms(Wn.subarray(On,Is))}(me,0,Ne):me.subarray(0,Ne)}(H.subarray(K,-8),{i:2},new Ms(((B=H)[(N=B.length)-4]|B[N-3]<<8|B[N-2]<<16|B[N-1]<<24)>>>0),void 0)));var B,N,H,K;const Y=$M[D];if(!Y)throw new Error(`Unhandled codec: ${D}`);const ne=new globalThis.DecompressionStream(Y);return new Response(new Blob([R]).stream().pipeThrough(ne)).arrayBuffer().then(ie=>new Uint8Array(ie))}(T,v).then(R=>{const D=Qs.read(new uu(R));if(D.values==="uint32_values")return D.uint32_values.readValuesInto(A),new HM[h](A.buffer);throw new Error(`Unhandled numeric data "${D.values}"`)}),C.then(R=>{for(let D=y.length-1;D>=0;D--)switch(y[D]){case"delta_filter":LM(R,p);break;case"zigzag_filter":DM(R);break;case"bitshuffle_filter":zM(R,h);break;default:throw new Error(`Unhandled filter "${y[D]}"`)}return{layerName:n,blockIndex:_,data:R}}).catch(R=>{throw R})}))},wt(J1,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const Q1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ng{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,n]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const a=n>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);const l=Q1[15&n];if(!l)throw new Error("Unrecognized array type.");const[h]=new Uint16Array(e,2,1),[p]=new Uint32Array(e,4,1);return new Ng(p,h,l,e)}constructor(e,i=64,n=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const l=Q1.indexOf(this.ArrayType),h=2*e*this.ArrayType.BYTES_PER_ELEMENT,p=e*this.IndexArrayType.BYTES_PER_ELEMENT,_=(8-p%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${n}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+p+_,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+h+p+_),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+p+_,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=i,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Vg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:h,nodeSize:p}=this,_=[0,l.length-1,0],y=[];for(;_.length;){const v=_.pop()||0,T=_.pop()||0,A=_.pop()||0;if(T-A<=p){for(let B=A;B<=T;B++){const N=h[2*B],H=h[2*B+1];N>=e&&N<=n&&H>=i&&H<=a&&y.push(l[B])}continue}const C=A+T>>1,R=h[2*C],D=h[2*C+1];R>=e&&R<=n&&D>=i&&D<=a&&y.push(l[C]),(v===0?e<=R:i<=D)&&(_.push(A),_.push(C-1),_.push(1-v)),(v===0?n>=R:a>=D)&&(_.push(C+1),_.push(T),_.push(1-v))}return y}within(e,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:l,nodeSize:h}=this,p=[0,a.length-1,0],_=[],y=n*n;for(;p.length;){const v=p.pop()||0,T=p.pop()||0,A=p.pop()||0;if(T-A<=h){for(let B=A;B<=T;B++)tb(l[2*B],l[2*B+1],e,i)<=y&&_.push(a[B]);continue}const C=A+T>>1,R=l[2*C],D=l[2*C+1];tb(R,D,e,i)<=y&&_.push(a[C]),(v===0?e-n<=R:i-n<=D)&&(p.push(A),p.push(C-1),p.push(1-v)),(v===0?e+n>=R:i+n>=D)&&(p.push(C+1),p.push(T),p.push(1-v))}return _}}function Vg(t,e,i,n,a,l){if(a-n<=i)return;const h=n+a>>1;eb(t,e,h,n,a,l),Vg(t,e,i,n,h-1,1-l),Vg(t,e,i,h+1,a,1-l)}function eb(t,e,i,n,a,l){for(;a>n;){if(a-n>600){const y=a-n+1,v=i-n+1,T=Math.log(y),A=.5*Math.exp(2*T/3),C=.5*Math.sqrt(T*A*(y-A)/y)*(v-y/2<0?-1:1);eb(t,e,i,Math.max(n,Math.floor(i-v*A/y+C)),Math.min(a,Math.floor(i+(y-v)*A/y+C)),l)}const h=e[2*i+l];let p=n,_=a;for(Nd(t,e,n,i),e[2*a+l]>h&&Nd(t,e,n,a);p<_;){for(Nd(t,e,p,_),p++,_--;e[2*p+l]<h;)p++;for(;e[2*_+l]>h;)_--}e[2*n+l]===h?Nd(t,e,n,_):(_++,Nd(t,e,_,a)),_<=i&&(n=_+1),i<=_&&(a=_-1)}}function Nd(t,e,i,n){Ug(t,i,n),Ug(e,2*i,2*n),Ug(e,2*i+1,2*n+1)}function Ug(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function tb(t,e,i,n){const a=t-i,l=e-n;return a*a+l*l}o.$=n1,o.A=Vc,o.B=Dh,o.C=Mi,o.D=be,o.E=pa,o.F=Pr,o.G=tt,o.H=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Ke(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Si(t.x,e.x,i),y:Si(t.y,e.y,i),z:Si(t.z,e.z,i),azimuthal:Si(t.azimuthal,e.azimuthal,i),polar:Si(t.polar,e.polar,i)}}},o.I=mg,o.J=$s,o.K=Cr,o.L=Di,o.M=class{constructor(t,e,i,n){this.id=t,this.position=e!=null?new ge(e[0],e[1]):new ge(0,0),this.orientation=i??[0,0,0],this.nodes=n,this.uploaded=!1,this.aabb=new kr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(o.a6.multiply(t.matrix,e,t.matrix),t.meshes)for(const i of t.meshes){const n=kr.applyTransform(i.aabb,t.matrix);this.aabb.encapsulate(n)}if(t.children)for(const i of t.children)this._applyTransformations(i,t.matrix)}computeBoundsAndApplyParent(){const t=o.a6.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,i,n,a,l,h=!1){T1(this.matrix,this,t.transform,this.position,e,i,n,a,l,h)}upload(t){if(!this.uploaded){for(const e of this.nodes)Ig(e,t);for(const e of this.nodes)Kp(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)Cg(t)}},o.O=Mn,o.P=Ue,o.Q=Dl,o.R=Vn,o.S=Va,o.T=Eg,o.U=Si,o.V=_t,o.W=ff,o.X=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([i,n]){const a=Ke([1,i,n]);return{x:a.x,y:a.y,z:a.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Si(t.x,e.x,i),y:Si(t.y,e.y,i),z:Si(t.z,e.z,i)}}},o.Y=function(t,e,i=0,n=!0){const a=new Ue(i,i),l=t.sub(a),h=e.add(a),p=[l,new Ue(h.x,l.y),h,new Ue(l.x,h.y)];return n&&p.push(l.clone()),p},o.Z=Cl,o._=function(t,e){const i=[];for(let n=0;n<t.length;n++){const a=wn(n-1,-1,t.length-1),l=wn(n+1,-1,t.length-1),h=t[n],p=t[l],_=t[a].sub(h).unit(),y=p.sub(h).unit(),v=y.angleWithSep(_.x,_.y),T=_.add(y).unit().mult(-1*e/Math.sin(v/2));i.push(h.add(T))}return i},o.a=Vu,o.a$=function(t){const e=[];for(const i in t)e.push(t[i]);return e},o.a0=s0,o.a1=function(t,e,i=0){return o.N.fromValues(((e.x-i)*t.scale-t.x)*_t,(e.y*t.scale-t.y)*_t,ur(e.z,e.y))},o.a2=$_,o.a3=wv,o.a4=function(t){let e=1/0,i=1/0,n=-1/0,a=-1/0;for(const l of t)e=Math.min(e,l.x),i=Math.min(i,l.y),n=Math.max(n,l.x),a=Math.max(a,l.y);return{min:new Ue(e,i),max:new Ue(n,a)}},o.a5=hi,o.a8=Hs,o.a9=Gi,o.aA=Rf,o.aB=Br,o.aC=Kn,o.aD=Hf,o.aE=$p,o.aF=function(){es.isLoading()||es.isLoaded()||To()!=="deferred"||qh()},o.aG=ts,o.aH=en,o.aI=B1,o.aJ=Vt,o.aK=cg,o.aL=og,o.aM=an,o.aN=ws,o.aO=sd,o.aP=Ex,o.aQ=wp,o.aR=Tg,o.aS=function(t,e){const i=Va(e.zoom);if(i===0)return Ro(t);const n=mp(t),a=W_(n),l=hi(n.getWest())*e.worldSize,h=hi(n.getEast())*e.worldSize,p=Qt(n.getNorth())*e.worldSize,_=Qt(n.getSouth())*e.worldSize,y=[l,p,0],v=[h,p,0],T=[l,_,0],A=[h,_,0],C=o.a6.invert([],e.globeMatrix);return o.N.transformMat4(y,y,C),o.N.transformMat4(v,v,C),o.N.transformMat4(T,T,C),o.N.transformMat4(A,A,C),a[0]=oa(a[0],T,i),a[1]=oa(a[1],A,i),a[2]=oa(a[2],v,i),a[3]=oa(a[3],y,i),kr.fromPoints(a)},o.aT=gp,o.aU=pd,o.aV=oa,o.aW=zn,o.aX=GE,o.aY=Wt,o.aZ=K1,o.a_=Fe,o.aa=zt,o.ab=W,o.ac=function(t,e){const i={};for(let n=0;n<e.length;n++){const a=e[n];a in t&&(i[a]=t[a])}return i},o.ad=Ae,o.ae=Qt,o.af=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,n){const a=this.entries[t]=this.entries[t]||{callbacks:[]};if(a.result){const[l,h]=a.result;return this.scheduler?this.scheduler.add(()=>{n(l,h)},e):n(l,h),()=>{}}return a.callbacks.push(n),a.cancel||(a.cancel=i((l,h)=>{a.result=[l,h];for(const p of a.callbacks)this.scheduler?this.scheduler.add(()=>{p(l,h)},e):p(l,h);setTimeout(()=>delete this.entries[t],3e3)})),()=>{a.result||(a.callbacks=a.callbacks.filter(l=>l!==n),a.callbacks.length||(a.cancel(),delete this.entries[t]))}}},o.ag=Kh,o.ah=function(t,e,i){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},a=>{const l=Fe(t.request,(h,p,_,y)=>{h?a(h):p&&a(null,{vectorTile:i?void 0:new ag(new uu(p)),rawData:p,cacheControl:_,expires:y})});return()=>{l.cancel(),a()}},e)},o.ai=function(t){Yi++,Yi>It&&(t.getActor().send("enforceCacheSizeLimit",ke),Yi=0)},o.aj=Kr,o.ak=Oe,o.al=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.am=Je,o.an=f1,o.ao=p1,o.ap=d1,o.aq=function(t,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let n=0;n<t.length;n++){const a=document.createElement("source");Ye(t[n])||(i.crossOrigin="Anonymous"),a.src=t[n],i.appendChild(a)}return{cancel:()=>{}}},o.ar=Zp,o.as=Ad,o.at=oi,o.au=Ii,o.av=qs,o.aw=sn,o.ax=$r,o.ay=Ki,o.az=ea,o.b=Vo,o.b$=jf,o.b0=function(t,e){const i=[];for(const n in t)n in e||i.push(n);return i},o.b1=Wr,o.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.b3=function(t,e){const{x:i,y:n}=t.point,a=Px(i,n,t.worldSize/t._pixelsPerMercatorPixel,0,0);return o.a6.multiply(a,a,X_(Ro(e)))},o.b5=au,o.b6=As,o.b7=Pp,o.b8=function(t,e,i,n,a){const l=5*e+2;t.float32[l+0]=i,t.float32[l+1]=n,t.float32[l+2]=a},o.b9=Gp,o.bA=Xp,o.bB=m1,o.bC=function(t){const e=m1(t,!0);return o.b4.invert([],[e[0],e[1],e[4],e[5]])},o.bD=q_,o.bE=function(t){const{x:e,y:i}=t.point,{lng:n,lat:a}=t._center;return Px(e,i,t.worldSize,n,a)},o.bF=br,o.bG=Q,o.bH=function(t){const e=Math.round((t+45+360)%360/90)%4;return ss[e]},o.bI=45,o.bJ=kt,o.bK=u,o.bL=Mo,o.bM=lp,o.bN=Cn,o.bO=Qc,o.bP=c,o.bQ=function(t,e,i){const n=Math.sqrt(t*t+e*e+i*i),a=n>0?Math.acos(i/n)*Hr:0;let l=t!==0||e!==0?Math.atan2(-e,-t)*Hr+90:0;return l<0&&(l+=360),[n,l,a]},o.bR=bi,o.bS=kr,o.bT=Ke,o.bU=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},o.bV=function(t){return t({pluginStatus:Gn,pluginURL:wo}),$h.on("pluginStateChange",t),t},o.bW=_u,o.bX=Jp,o.bY=du,o.bZ=_g,o.b_=Gr,o.ba=Hv,o.bb=zs,o.bc=Tn,o.bd=e1,o.be=yg,o.bf=pg,o.bg=Ng,o.bh=wn,o.bj=ni,o.bk=te,o.bl=ai,o.bm=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},o.bn=ge,o.bo=c1,o.bp=Qe,o.bq=Z_,o.br=_1,o.bs=Ze,o.bt=Mx,o.bu=function(t,e,i,n,a,l,h,p,_){if(_.name==="globe")return Mx(t,e,new Ze(i,n,a),!1);const y=Ad({z:i,x:n,y:a},_);return new kr([(l+y.x/y.scale)*e,e*(y.y/y.scale),h],[(l+y.x2/y.scale)*e,e*(y.y2/y.scale),p])},o.bv=function(t,e,i){let n=0;for(let a=0;a<2;++a){const l=i?i[a]:0;t[a]>l&&(n+=(t[a]-l)*(t[a]-l)),e[a]<l&&(n+=(l-e[a])*(l-e[a]))}return n},o.bw=xi,o.bx=$,o.by=function(t){const e=o.a6.identity(new Float64Array(16));o.a6.multiply(e,t.pixelMatrix,t.globeMatrix);const i=[0,fe,0],n=[0,Te,0];return o.N.transformMat4(i,i,e),o.N.transformMat4(n,n,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!K_(t,new ge(t.center.lat,90)),n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!K_(t,new ge(t.center.lat,-90))]},o.bz=function(t,e){const{scale:i}=t.tileTransform,n=i*_t/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return o.b4.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[n,n])},o.c=k1,o.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.c0=Ie,o.c1=tr,o.c2=function(t,e,i){return t.type==="custom"?new JA(t,e):new PM[t.type](t,e,i)},o.c3=function(t){const e=t.indexOf(Zc);return e>=0?t.slice(0,e):t},o.c4=function(t){return t.indexOf(Zc)>=0},o.c5=function(t){const e=t.indexOf(Zc);return e>=0?t.slice(e+1):""},o.c6=function(t){const e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.c7=Ui,o.c8=$h,o.c9=ze,o.cA=Sv,o.cB=(t,e,i,n,a,l)=>{const h=t.transform;return{u_matrix:Ev(t,e,i,n),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:h.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_image:0,u_tile_units_to_pixels:Tv(e,h),u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:l}},o.cC=(t,e,i,n,a,l,h)=>{const p=t.transform,_=p.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:Ev(t,e,i,n),u_pixels_to_tile_units:_,u_device_pixel_ratio:l,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:Av(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Tv(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:h,u_emissive_strength:i.paint.get("line-emissive-strength")}},o.cD=Xr,o.cE=md,o.cF=_v,o.cG=Ct,o.cH=Cp,o.cI=Ga,o.cJ=450,o.cK=7,o.cL=XA,o.cM=256,o.cN=X_,o.cO=Ao,o.cP=nd,o.cQ=function(t,e,i,n,a){return zt((t-e)/(i-e)*(a-n)+n,n,a)},o.cR=vi,o.cS=Ag,o.cT=[1,1,1],o.cU=su,o.cV=mu,o.cW=Ls,o.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const e=Xx(new Ue(0,0),new Ue(_t,_t),t),i=[];for(const n of this._activeRegions){if(n.hiddenByOverlap||!Wx(e,n))continue;const a=CS(n.min,n.max,t);i.push({min:a.min,max:a.max,sourceId:this._sourceIds[n.priority],footprint:n.footprint,footprintTileId:n.tileId})}return i}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const n of e.cache.getVisibleCoordinates()){const a=e.cache.getTile(n).buckets[e.layer];if(a)for(const l of a.getNodesInfo()){const h=l.node;h.footprint&&i.push({footprint:h.footprint,id:n.toUnwrapped()})}}return i}})))}_addSource(t){const e=t.getFootprints();if(e.length!==0){for(const i of e){if(!i.footprint)continue;const n=Xx(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:n.min,max:n.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Ap(e.min,i.min)||Ap(e.max,i.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,i=0;for(;!t&&e!==this._activeRegions.length;){const n=this._activeRegions[e],a=this._prevRegions[i];t=n.priority!==a.priority||!Hx(n,a),++e,++i}}if(t){++this._updateTime;const e=i=>{const n=this._activeRegions;if(i>=n.length)return i;const a=n[i].priority;for(;i<n.length&&n[i].priority===a;)++i;return i};if(this._sourceIds.length>1){let i=0,n=e(i);for(;i!==n;){let a=i;const l=i;for(;a!==n;){const h=this._activeRegions[a];h.hiddenByOverlap=!1;for(let p=0;p<l;p++){const _=this._activeRegions[p];if(!_.hiddenByOverlap&&Wx(h,_)&&(h.hiddenByOverlap=Kx(h.footprint,h.tileId,_.footprint,_.tileId),h.hiddenByOverlap))break}++a}i=n,n=e(i)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},o.cY=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const i=new ws,n=new sn,a=[],l=t+1+2,h=e[0]+1,p=e[0]+1+(1+e.length),_=(y,v,T)=>{let A=y===l-1?y-2:y===0?y:y-1;return A+=T?24575:0,[A,v]};for(let y=0;y<l;++y)i.emplaceBack(..._(y,0,!0));for(let y=0;y<h;++y)for(let v=0;v<l;++v)i.emplaceBack(..._(v,y,(v===0||v===l-1)&&!0));for(let y=0;y<e.length;++y){const v=e[y];for(let T=0;T<l;++T)i.emplaceBack(..._(T,v,!0))}for(let y=0;y<e.length;++y){const v=n.length,T=e[y]+1+2,A=new sn;for(let D=0;D<T-1;D++){const B=D===T-2,N=B?l*(p-e.length+y-D):l;for(let H=0;H<l-1;H++){const K=D*l+H;D===0||B||H===0||H===l-2?(A.emplaceBack(K+1,K,K+N),A.emplaceBack(K+N,K+N+1,K+1)):(n.emplaceBack(K+1,K,K+N),n.emplaceBack(K+N,K+N+1,K+1))}}const C=Br.simpleSegment(0,v,i.length,n.length-v);for(let D=0;D<A.uint16.length;D+=3)n.emplaceBack(A.uint16[D],A.uint16[D+1],A.uint16[D+2]);const R=Br.simpleSegment(0,v,i.length,n.length-v);a.push({withoutSkirts:C,withSkirts:R})}return{vertices:i,indices:n,segments:a}}_createGrid(t){const e=this._fillGridMeshWithLods(ae,le);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Ex.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new sn;for(let h=0;h<=ae;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new Ao,n=new Ao,a=new Ao,l=new Ao;this._poleSegments=[];for(let h=0,p=0;h<Q;h++){const _=360/(1<<h);i.emplaceBack(0,-W,0,.5,0),n.emplaceBack(0,-W,0,.5,1),a.emplaceBack(0,-W,0,.5,.5),l.emplaceBack(0,-W,0,.5,.5);for(let y=0;y<=ae;y++){let v=y/ae,T=0;const A=Si(0,_,v),[C,R,D]=_e(ZE,HE,A,W);i.emplaceBack(C,R,D,v,T),n.emplaceBack(C,R,D,v,1-T);const B=ni(A);v=.5+.5*Math.sin(B),T=.5+.5*Math.cos(B),a.emplaceBack(C,R,D,v,T),l.emplaceBack(C,R,D,v,1-T)}this._poleSegments.push(Br.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,fp,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(n,fp,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(a,fp,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(l,fp,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},o.cZ=function(t){return lo.has(t)},o.c_=Vi,o.ca=r,o.cb=class extends Zs{constructor(t){super(t),this.current=f}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let n=0;n<9;n++)if(i[n]!==this.current[n]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.cc=lt,o.cd=function(t,e,i){const n=Va(i.zoom),a=t.style.map._antialias,l=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return n===0&&!a&&!l},o.ce=function(t){const e=t.pixelsPerMeter,i=e/ai(1,t.center.lat),n=o.a6.identity(new Float64Array(16));return o.a6.translate(n,n,[t.point.x,t.point.y,0]),o.a6.scale(n,n,[i,i,e]),Float32Array.from(n)},o.cf=mp,o.cg=function(t){const e=xi-5;t=zt(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(ni(t))),3);return Math.round(i*(le.length-1))},o.ch=function(t,e,i,n){const a=e.getNorth(),l=e.getSouth(),h=e.getWest(),p=e.getEast(),_=1<<t.z,y=p-h,v=a-l,T=y/ae,A=-v/le[i],C=[0,T,0,A,0,0,a,h,0];if(t.z>0){const R=180/n;o.co.multiply(C,C,[R/y+1,0,0,0,R/v+1,0,-.5*R/T,.5*R/A,1])}return C[2]=_,C[5]=t.x,C[8]=t.y,C},o.ci=Ro,o.cj=function(t,e,i){const n=o.a6.identity(new Float64Array(16)),a=(e/(1<<t)-.5)*Math.PI*2;return o.a6.rotateY(n,i.globeMatrix,a),Float32Array.from(n)},o.ck=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,n=1<<i,a=Math.floor(t.x),l=Math.floor((t.x-a)*n),h=Math.floor(t.y*n),p=this.findDEMTileFor(new Je(i,a,i,l,h));return!(!p||!p.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const n=this._source();if(!n||t.y<0||t.y>1)return e;const a=n.getSource().maxzoom,l=1<<a,h=Math.floor(t.x),p=t.x-h,_=new Je(a,h,a,Math.floor(p*l),Math.floor(t.y*l)),y=this.findDEMTileFor(_);if(!y||!y.dem)return e;const v=y.dem,T=1<<y.tileID.canonical.z,A=(p*T-y.tileID.canonical.x)*v.dim,C=(t.y*T-y.tileID.canonical.y)*v.dim,R=Math.floor(A),D=Math.floor(C);return(i?this.exaggeration():1)*Si(Si(v.get(R,D),v.get(R,D+1),C-D),Si(v.get(R+1,D),v.get(R+1,D+1),C-D),A-R)}getAtTileOffset(t,e,i){const n=1<<t.canonical.z;return this.getAtPointOrZero(new Di(t.wrap+(t.canonical.x+e/_t)/n,(t.canonical.y+i/_t)/n))}getAtTileOffsetFunc(t,e,i,n){return a=>{const l=this.getAtTileOffset(t,a.x,a.y),h=n.upVector(t.canonical,a.x,a.y),p=n.upVectorScale(t.canonical,e,i).metersToTile;return o.N.scale(h,h,l*p),h}}getForTilePoints(t,e,i,n){if(this.isUsingMockSource())return!1;const a=su.create(this,t,n);return!!a&&(e.forEach(l=>{l[2]=this.exaggeration()*a.getElevationAt(l[0],l[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,n=e.tileID,a=1<<t.canonical.z-n.canonical.z;let l=t.canonical.x/a-n.canonical.x,h=t.canonical.y/a-n.canonical.y,p=0;for(let _=0;_<t.canonical.z-n.canonical.z&&!i.leaves[p];_++){l*=2,h*=2;const y=2*Math.floor(h)+Math.floor(l);p=i.childOffsets[p]+y,l%=1,h%=1}return{min:this.exaggeration()*i.minimums[p],max:this.exaggeration()*i.maximums[p]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,i=Number.MAX_VALUE,n=Number.MIN_VALUE;for(const a of t){const l=this.getMinMaxForTile(a.tileID);l&&(i=Math.min(i,l.min),n=Math.max(n,l.max),e=!0)}return e?{min:i,max:n}:null}},o.cl=pp,o.cm=Nx,o.cn=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},o.cp=Cx,o.cq=256,o.cr=function(t,e){const i=[0,0,0],n=gp(Ro(e.canonical));return o.N.transformMat4(i,i,n),o.N.transformMat4(i,i,t),i},o.cs=t=>({u_camera_to_center_distance:new Cn(t),u_extrude_scale:new x(t),u_device_pixel_ratio:new Cn(t),u_matrix:new u(t),u_inv_rot_matrix:new u(t),u_merc_center:new Mo(t),u_tile_id:new lp(t),u_zoom_transition:new Cn(t),u_up_dir:new lp(t),u_emissive_strength:new Cn(t)}),o.ct=t=>({u_matrix:new u(t),u_pixels_to_tile_units:new x(t),u_device_pixel_ratio:new Cn(t),u_units_to_pixels:new Mo(t),u_dash_image:new Qc(t),u_gradient_image:new Qc(t),u_image_height:new Cn(t),u_texsize:new Mo(t),u_tile_units_to_pixels:new Cn(t),u_alpha_discard_threshold:new Cn(t),u_trim_offset:new Mo(t),u_emissive_strength:new Cn(t)}),o.cu=t=>({u_matrix:new u(t),u_texsize:new Mo(t),u_pixels_to_tile_units:new x(t),u_device_pixel_ratio:new Cn(t),u_image:new Qc(t),u_units_to_pixels:new Mo(t),u_tile_units_to_pixels:new Cn(t),u_alpha_discard_threshold:new Cn(t),u_trim_offset:new Mo(t)}),o.cv=Xc,o.cw=nA,o.cx=sA,o.cy=Dx,o.cz=(t,e,i,n,a,l)=>{const h=t.transform,p=h.projection.name==="globe";let _;if(l.paint.get("circle-pitch-alignment")==="map")if(p){const v=Cx(h.zoom,e.canonical)*h._pixelsPerMercatorPixel;_=Float32Array.from([v,0,0,v])}else _=h.calculatePixelsToTileUnitsMatrix(i);else _=new Float32Array([h.pixelsToGLUnits[0],0,0,h.pixelsToGLUnits[1]]);const y={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(h.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Xe.devicePixelRatio,u_extrude_scale:_,u_inv_rot_matrix:WE,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(p){y.u_inv_rot_matrix=n,y.u_merc_center=a,y.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],y.u_zoom_transition=Va(h.zoom);const v=a[0]*_t,T=a[1]*_t;y.u_up_dir=h.projection.upVector(new Ze(0,0,0),v,T)}return y},o.d=mt,o.d0=Fi,o.d1=ki,o.d2=Le,o.d3=function([t,e,i]){const n=Math.hypot(t,e,i),a=Math.atan2(t,i),l=.5*Math.PI-Math.acos(-e/n);return new ge(br(a),br(l))},o.d4=Pe,o.d5=se,o.d6=K_,o.d7=Rx,o.d8=function(t){const e=[0,0,0],i=o.a6.identity(new Float64Array(16));return o.a6.multiply(i,t.pixelMatrix,t.globeMatrix),o.N.transformMat4(e,e,i),new Ue(e[0],e[1])},o.d9=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(i){if(we==null){const n=i.navigator?i.navigator.userAgent:null;we=!!i.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return we}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.dA=Ks,o.dB=O1,o.dC=F1,o.dD=vv,o.dE=qt,o.dF=Xv,o.dG=function(t,e,i,n,a,l,h,p,_,y,v){t.createArrays(),t.tilePixelRatio=_t/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const T=t.layers[0].layout,A=t.layers[0]._unevaluatedLayout._values,C={};if(t.textSizeData.kind==="composite"){const{minZoom:N,maxZoom:H}=t.textSizeData;C.compositeTextSizes=[A["text-size"].possiblyEvaluate(new Cr(N),p),A["text-size"].possiblyEvaluate(new Cr(H),p)]}if(t.iconSizeData.kind==="composite"){const{minZoom:N,maxZoom:H}=t.iconSizeData;C.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new Cr(N),p),A["icon-size"].possiblyEvaluate(new Cr(H),p)]}C.layoutTextSize=A["text-size"].possiblyEvaluate(new Cr(_+1),p),C.layoutIconSize=A["icon-size"].possiblyEvaluate(new Cr(_+1),p),C.textMaxSize=A["text-size"].possiblyEvaluate(new Cr(18),p);const R=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",D=T.get("text-size");let B=!1;for(const N of t.features)if(N.icon&&N.icon.nameSecondary){B=!0;break}for(const N of t.features){const H=T.get("text-font").evaluate(N,{},p).join(","),K=D.evaluate(N,{},p),Y=C.layoutTextSize.evaluate(N,{},p),ne=(C.layoutIconSize.evaluate(N,{},p),{horizontal:{},vertical:void 0}),ie=N.text;let ce,me=[0,0];if(ie){const xe=ie.toString(),De=T.get("text-letter-spacing").evaluate(N,{},p)*Tn,je=T.get("text-line-height").evaluate(N,{},p)*Tn,Re=b_(xe)?De:0,Ve=T.get("text-anchor").evaluate(N,{},p),Me=T.get("text-variable-anchor");if(!Me){const xt=T.get("text-radial-offset").evaluate(N,{},p);me=xt?e1(Ve,[xt*Tn,gg]):T.get("text-offset").evaluate(N,{},p).map(He=>He*Tn)}let Ne=R?"center":T.get("text-justify").evaluate(N,{},p);const nt=T.get("symbol-placement")==="point",Ge=nt?T.get("text-max-width").evaluate(N,{},p)*Tn:1/0,Mt=xt=>{t.allowVerticalPlacement&&bo(xe)&&(ne.vertical=fg(ie,e,i,a,H,Ge,je,Ve,xt,Re,me,As.vertical,!0,Y,K))};if(!R&&Me){const xt=Ne==="auto"?Me.map(Xt=>yg(Xt)):[Ne];let He=!1;for(let Xt=0;Xt<xt.length;Xt++){const Dt=xt[Xt];if(!ne.horizontal[Dt])if(He)ne.horizontal[Dt]=ne.horizontal[0];else{const At=fg(ie,e,i,a,H,Ge,je,"center",Dt,Re,me,As.horizontal,!1,Y,K);At&&(ne.horizontal[Dt]=At,He=At.positionedLines.length===1)}}Mt("left")}else{if(Ne==="auto"&&(Ne=yg(Ve)),nt||T.get("text-writing-mode").indexOf("horizontal")>=0||!bo(xe)){const xt=fg(ie,e,i,a,H,Ge,je,Ve,Ne,Re,me,As.horizontal,!1,Y,K);xt&&(ne.horizontal[Ne]=xt)}Mt(nt?"left":Ne)}}let ye=!1;if(N.icon&&N.icon.namePrimary){const xe=n[N.icon.namePrimary];xe&&(ce=EA(a[N.icon.namePrimary],N.icon.nameSecondary?a[N.icon.nameSecondary]:void 0,T.get("icon-offset").evaluate(N,{},p),T.get("icon-anchor").evaluate(N,{},p)),ye=xe.sdf,t.sdfIcons===void 0?t.sdfIcons=xe.sdf:t.sdfIcons!==xe.sdf&&pe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xe.pixelRatio!==t.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Ee=i1(ne.horizontal)||ne.vertical;t.iconsInText||(t.iconsInText=!!Ee&&Ee.iconsInText),(Ee||ce)&&RA(t,N,ne,ce,n,C,Y,0,me,ye,h,p,y,v,B)}l&&t.generateCollisionDebugBuffers(_,t.collisionBoxArray)},o.dH=ag,o.dI=uu,o.dJ=Mp,o.dK=Jt,o.dL=Ep,o.dM=Tp,o.dN=vr,o.dO=Pv,o.dP=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==I1){const i=new Uint32Array(t,0,7),[,,n,a,l,h]=i;e=i.byteLength+a+l+h+l,(n!==t.byteLength||e>=t.byteLength)&&pe("Invalid b3dm header information.")}return L1(t,e)},o.dQ=function(t,e){const i=k1(t);for(const n of i){for(const a of n.meshes)EM(a);n.lights&&(n.lightMeshIndex=n.meshes.length,n.meshes.push(SM(n.lights,e)))}return i},o.dR=im,o.dS=E1,o.dT=es,o.dU=function(t){sr(),ht&&ht.then(e=>{e.keys().then(i=>{for(let n=0;n<i.length-t;n++)e.delete(i[n])})})},o.da=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",rt,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Ie(t))return t;const i=Kt(t);return i.params.push(`sdk=js-${re}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Ie(t))return t;const i=Kt(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeModelURL(t,e){if(!Ie(t))return t;const i=Kt(t);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,n){if(!Ie(t))return t;const a=Kt(t);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),i&&a.params.push(`language=${i}`),n&&a.params.push(`worldview=${n}`),this._makeAPIURL(a,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,n){const a=Kt(t);return Ie(t)?(a.path=`/styles/v1${a.path}/sprite${e}${i}`,this._makeAPIURL(a,this._customAccessToken||n)):(a.path+=`${e}${i}`,Ei(a))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ie(t))return t;const n=Kt(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&n.authority!=="raster"&&i===512?"@2x":""}${$i.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${se.RASTER_URL_PREFIX}${n.path}`:n.authority==="rasterarrays"?n.path=`/${se.RASTERARRAYS_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${se.TILE_URL_VERSION}${n.path}`);const a=this._customAccessToken||function(l){for(const h of l){const p=h.match(/^access_token=(.*)$/);if(p)return p[1]}return null}(n.params)||se.ACCESS_TOKEN;return se.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,a)}canonicalizeTileURL(t,e){const i=Kt(t);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let n="mapbox://";i.path.match(/^\/raster\/v1\//)?n+=`raster/${i.path.replace(`/${se.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?n+=`rasterarrays/${i.path.replace(`/${se.RASTERARRAYS_URL_PREFIX}/`,"")}`:n+=`tiles/${i.path.replace(`/${se.TILE_URL_VERSION}/`,"")}`;let a=i.params;return e&&(a=a.filter(l=>!l.match(/^access_token=/))),a.length&&(n+=`?${a.join("&")}`),n}canonicalizeTileset(t,e){const i=!!e&&Ie(e),n=[];for(const a of t.tiles||[])Se(a)?n.push(this.canonicalizeTileURL(a,i)):n.push(a);return n}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=Kt(se.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,t.protocol==="http"){const a=t.params.indexOf("secure");a>=0&&t.params.splice(a,1)}if(n.path!=="/"&&(t.path=`${n.path}${t.path}`),!se.REQUIRE_ACCESS_TOKEN)return Ei(t);if(e=e||se.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(a=>a.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Ei(t)}},o.db=function(t,e){e?lo.add(t):lo.delete(t)},o.dc=$i,o.dd=_s,o.de=dl,o.df=yt,o.dg=ji,o.dh=function(t){lo.delete(t)},o.di=_n,o.dj=mn,o.dk=re,o.dl=function(t,e){ke=t,It=e},o.dm=function(t,e,i=!1){if(Gn===Nh||Gn===Vh||Gn===Uh)throw new Error("setRTLTextPlugin cannot be called multiple times.");wo=Xe.resolveURL(t),Gn=Nh,jh=e,Gh(),i||qh()},o.dn=To,o.dp=function(){Jp().acquire(Pg)},o.dq=function(){const t=zd;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(Pg),zd=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.dr=Dd,o.ds=function(t){const e=fi();if(!e)return;const i=e.delete(St);t&&i.catch(t).then(()=>t())},o.dt=Ld,o.du=S1,o.dv=function(t){Rg=Xe.resolveURL(t),yu||(yu=new _u(Jp(),new pa)),yu.broadcast("setDracoUrl",Rg)},o.dw=A1,o.dx=function(t){gu=Xe.resolveURL(t),yu||(yu=new _u(Jp(),new pa)),yu.broadcast("setMeshoptUrl",gu)},o.dy=wt,o.dz=Ua,o.e=dr,o.f=Xe,o.g=function(t,e){return ze(dr(t,{type:"json"}),e)},o.h=Ss,o.i=va,o.j=Gu,o.k=Nc,o.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>L1(e,0,t))},o.m=zf,o.n=Il,o.o=kl,o.p=Wv,o.q=Gc,o.r=jc,o.s=zh,o.t=wl,o.u=zl,o.v=yn,o.w=pe,o.x=Sa,o.z=Wh}),V(["./shared"],function(o){function re(we){const q=we?we.url.toString():void 0;return q?performance.getEntriesByName(q):[]}function oe(we){if(typeof we=="number"||typeof we=="boolean"||typeof we=="string"||we==null)return JSON.stringify(we);if(Array.isArray(we)){let te="[";for(const ue of we)te+=`${oe(ue)},`;return`${te}]`}let q="{";for(const te of Object.keys(we).sort())q+=`${te}:${oe(we[te])},`;return`${q}}`}function se(we){let q="";for(const te of o.b2)q+=`/${oe(we[te])}`;return q}class Se{constructor(q){this.keyCache={},this._layers={},this._layerConfigs={},q&&this.replace(q)}replace(q,te){this._layerConfigs={},this._layers={},this.update(q,[],te)}update(q,te,ue){this._options=ue;for(const Oe of q)this._layerConfigs[Oe.id]=Oe,(this._layers[Oe.id]=o.c2(Oe,this.scope,this._options)).compileFilter(),this.keyCache[Oe.id]&&delete this.keyCache[Oe.id];for(const Oe of te)delete this.keyCache[Oe],delete this._layerConfigs[Oe],delete this._layers[Oe];this.familiesBySource={};const Ce=function(Oe,Xe){const St={};for(let It=0;It<Oe.length;It++){const ht=Xe&&Xe[Oe[It].id]||se(Oe[It]);Xe&&(Xe[Oe[It].id]=ht);let bt=St[ht];bt||(bt=St[ht]=[]),bt.push(Oe[It])}const ke=[];for(const It in St)ke.push(St[It]);return ke}(o.a$(this._layerConfigs),this.keyCache);for(const Oe of Ce){const Xe=Oe.map(fi=>this._layers[fi.id]),St=Xe[0];if(St.visibility==="none")continue;const ke=St.source||"";let It=this.familiesBySource[ke];It||(It=this.familiesBySource[ke]={});const ht=St.sourceLayer||"_geojsonTileLayer";let bt=It[ht];bt||(bt=It[ht]=[]),bt.push(Xe)}}}const Ie=1*o.dA;class qe{constructor(q){const te={},ue=[];for(const St in q){const ke=q[St],It=te[St]={};for(const ht in ke.glyphs){const bt=ke.glyphs[+ht];if(!bt||bt.bitmap.width===0||bt.bitmap.height===0)continue;const fi=bt.metrics.localGlyph?Ie:1,sr={x:0,y:0,w:bt.bitmap.width+2*fi,h:bt.bitmap.height+2*fi};ue.push(sr),It[ht]=sr}}const{w:Ce,h:Oe}=o.p(ue),Xe=new o.dz({width:Ce||1,height:Oe||1});for(const St in q){const ke=q[St];for(const It in ke.glyphs){const ht=ke.glyphs[+It];if(!ht||ht.bitmap.width===0||ht.bitmap.height===0)continue;const bt=te[St][It],fi=ht.metrics.localGlyph?Ie:1;o.dz.copy(ht.bitmap,Xe,{x:0,y:0},{x:bt.x+fi,y:bt.y+fi},ht.bitmap)}}this.image=Xe,this.positions=te}}o.dy(qe,"GlyphAtlas");class at{constructor(q){this.tileID=new o.am(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.tileZoom=q.tileZoom,this.uid=q.uid,this.zoom=q.zoom,this.canonical=q.tileID.canonical,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.scope=q.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=q.showCollisionBoxes,this.collectResourceTiming=!!q.collectResourceTiming,this.promoteId=q.promoteId,this.isSymbolTile=q.isSymbolTile,this.tileTransform=o.as(q.tileID.canonical,q.projection),this.projection=q.projection,this.brightness=q.brightness,this.extraShadowCaster=!!q.extraShadowCaster}parse(q,te,ue,Ce,Oe){this.status="parsing",this.data=q,this.collisionBoxArray=new o.aD;const Xe=new o.dB(Object.keys(q.layers).sort()),St=new o.dC(this.tileID,this.promoteId);St.bucketLayerIDs=[];const ke={},It=new o.dD(256,256),ht={featureIndex:St,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:It,availableImages:ue,brightness:this.brightness},bt=te.familiesBySource[this.source];for(const ir in bt){const fr=q.layers[ir];if(!fr)continue;let nn=!1,gr=!1,Ln=!1;for(const Yr of bt[ir])Yr[0].type==="symbol"?nn=!0:gr=!0,Yr[0].is3D()&&Yr[0].type!=="model"&&(Ln=!0);if(this.extraShadowCaster&&!Ln||this.isSymbolTile===!0&&!nn||this.isSymbolTile===!1&&!gr)continue;fr.version===1&&o.w(`Vector tile source "${this.source}" layer "${ir}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const In=Xe.encode(ir),Vn=[];for(let Yr=0;Yr<fr.length;Yr++){const Gr=fr.feature(Yr),ze=St.getId(Gr,ir);Vn.push({feature:Gr,id:ze,index:Yr,sourceLayerIndex:In})}for(const Yr of bt[ir]){const Gr=Yr[0];(!this.extraShadowCaster||Gr.is3D()&&Gr.type!=="model")&&(this.isSymbolTile!==void 0&&Gr.type==="symbol"!==this.isSymbolTile||Gr.minzoom&&this.zoom<Math.floor(Gr.minzoom)||Gr.maxzoom&&this.zoom>=Gr.maxzoom||Gr.visibility!=="none"&&(Ft(Yr,this.zoom,ht.brightness,ue),(ke[Gr.id]=Gr.createBucket({index:St.bucketLayerIDs.length,layers:Yr,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:In,sourceID:this.source,projection:this.projection.spec})).populate(Vn,ht,this.tileID.canonical,this.tileTransform),St.bucketLayerIDs.push(Yr.map(ze=>ze.id))))}}let fi,sr,wr,or;It.trim();const Yi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},$i=()=>{if(fi)return this.status="done",Oe(fi);if(this.extraShadowCaster)this.status="done",Oe(null,{buckets:o.a$(ke).filter(ir=>!ir.isEmpty()),featureIndex:St,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ht.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(sr&&wr&&or){const ir=new qe(sr),fr=new o.dF(wr,or);for(const nn in ke){const gr=ke[nn];gr instanceof o.aE?(Ft(gr.layers,this.zoom,ht.brightness,ue),o.dG(gr,sr,ir.positions,wr,fr.iconPositions,this.showCollisionBoxes,ue,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):gr.hasPattern&&(gr instanceof o.aK||gr instanceof o.aL||gr instanceof o.cH)&&(Ft(gr.layers,this.zoom,ht.brightness,ue),gr.addFeatures(ht,this.tileID.canonical,fr.patternPositions,ue,this.tileTransform,this.brightness))}this.status="done",Oe(null,{buckets:o.a$(ke).filter(nn=>!nn.isEmpty()),featureIndex:St,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ir.image,lineAtlas:It,imageAtlas:fr,brightness:ht.brightness})}};if(!this.extraShadowCaster){const ir=o.dE(ht.glyphDependencies,gr=>Object.keys(gr).map(Number));Object.keys(ir).length?Ce.send("getGlyphs",{uid:this.uid,stacks:ir,scope:this.scope},(gr,Ln)=>{fi||(fi=gr,sr=Ln,$i())},void 0,!1,Yi):sr={};const fr=Object.keys(ht.iconDependencies);fr.length?Ce.send("getImages",{icons:fr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(gr,Ln)=>{fi||(fi=gr,wr=Ln,$i())},void 0,!1,Yi):wr={};const nn=Object.keys(ht.patternDependencies);nn.length?Ce.send("getImages",{icons:nn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(gr,Ln)=>{fi||(fi=gr,or=Ln,$i())},void 0,!1,Yi):or={}}$i()}}function Ft(we,q,te,ue){const Ce=new o.K(q,{brightness:te});for(const Oe of we)Oe.recalculate(Ce,ue)}class Nt extends o.E{constructor(q,te,ue,Ce,Oe,Xe){super(),this.actor=q,this.layerIndex=te,this.availableImages=ue,this.loadVectorData=Oe||o.ah,this.loading={},this.loaded={},this.deduped=new o.af(q.scheduler),this.isSpriteLoaded=Ce,this.scheduler=q.scheduler,this.brightness=Xe}loadTile(q,te){const ue=q.uid,Ce=q&&q.request,Oe=Ce&&Ce.collectResourceTiming,Xe=this.loading[ue]=new at(q);Xe.abort=this.loadVectorData(q,(St,ke)=>{const It=!this.loading[ue];if(delete this.loading[ue],It||St||!ke)return Xe.status="done",It||(this.loaded[ue]=Xe),te(St);const ht=ke.rawData,bt={};ke.expires&&(bt.expires=ke.expires),ke.cacheControl&&(bt.cacheControl=ke.cacheControl),Xe.vectorTile=ke.vectorTile||new o.dH(new o.dI(ht));const fi=()=>{Xe.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.actor,(sr,wr)=>{if(sr||!wr)return te(sr);const or={};if(Oe){const Yi=re(Ce);Yi.length>0&&(or.resourceTiming=JSON.parse(JSON.stringify(Yi)))}te(null,o.e({rawTileData:ht.slice(0)},wr,bt,or))})};this.isSpriteLoaded?fi():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(fi,{type:"parseTile",isSymbolTile:q.isSymbolTile,zoom:q.tileZoom}):fi()}),this.loaded=this.loaded||{},this.loaded[ue]=Xe})}reloadTile(q,te){const ue=this.loaded,Ce=q.uid,Oe=this;if(ue&&ue[Ce]){const Xe=ue[Ce];Xe.showCollisionBoxes=q.showCollisionBoxes,Xe.projection=q.projection,Xe.brightness=q.brightness,Xe.tileTransform=o.as(q.tileID.canonical,q.projection),Xe.extraShadowCaster=q.extraShadowCaster;const St=(ke,It)=>{const ht=Xe.reloadCallback;ht&&(delete Xe.reloadCallback,Xe.parse(Xe.vectorTile,Oe.layerIndex,this.availableImages,Oe.actor,ht)),te(ke,It)};Xe.status==="parsing"?Xe.reloadCallback=St:Xe.status==="done"&&(Xe.vectorTile?Xe.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.actor,St):St())}else te(null,void 0)}abortTile(q,te){const ue=q.uid,Ce=this.loading[ue];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[ue]),te()}removeTile(q,te){const ue=this.loaded,Ce=q.uid;ue&&ue[Ce]&&delete ue[Ce],te()}}class ri{loadTile(q,te){const{uid:ue,encoding:Ce,rawImageData:Oe,padding:Xe}=q,St=ImageBitmap&&Oe instanceof ImageBitmap?this.getImageData(Oe,Xe):Oe;te(null,new o.dJ(ue,St,Ce,Xe<1))}getImageData(q,te){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);const ue=this.offscreenCanvasContext.getImageData(-te,-te,q.width+2*te,q.height+2*te);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ue}}class Jt{decodeRasterArray({task:q,buffer:te},ue){o.aZ.performDecoding(te,q).then(Ce=>{ue(null,Ce)},Ce=>{ue(Ce)})}}function Xi(we,q){if(we.length!==0){er(we[0],q);for(var te=1;te<we.length;te++)er(we[te],!q)}}function er(we,q){for(var te=0,ue=0,Ce=0,Oe=we.length,Xe=Oe-1;Ce<Oe;Xe=Ce++){var St=(we[Ce][0]-we[Xe][0])*(we[Xe][1]+we[Ce][1]),ke=te+St;ue+=Math.abs(te)>=Math.abs(St)?te-ke+St:St-ke+te,te=ke}te+ue>=0!=!!q&&we.reverse()}var wi=o.dK(function we(q,te){var ue,Ce=q&&q.type;if(Ce==="FeatureCollection")for(ue=0;ue<q.features.length;ue++)we(q.features[ue],te);else if(Ce==="GeometryCollection")for(ue=0;ue<q.geometries.length;ue++)we(q.geometries[ue],te);else if(Ce==="Feature")we(q.geometry,te);else if(Ce==="Polygon")Xi(q.coordinates,te);else if(Ce==="MultiPolygon")for(ue=0;ue<q.coordinates.length;ue++)Xi(q.coordinates[ue],te);return q});const vr=o.dL.prototype.toGeoJSON;let zi=class{constructor(we){this._feature=we,this.extent=o.V,this.type=we.type,this.properties=we.tags,"id"in we&&!isNaN(we.id)&&(this.id=parseInt(we.id,10))}loadGeometry(){if(this._feature.type===1){const we=[];for(const q of this._feature.geometry)we.push([new o.P(q[0],q[1])]);return we}{const we=[];for(const q of this._feature.geometry){const te=[];for(const ue of q)te.push(new o.P(ue[0],ue[1]));we.push(te)}return we}}toGeoJSON(we,q,te){return vr.call(this,we,q,te)}},Ue=class{constructor(we){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.V,this.length=we.length,this._features=we}feature(we){return new zi(this._features[we])}};var Sr={exports:{}},Hr=o.dN,ni=o.dM.VectorTileFeature,br=ss;function ss(we,q){this.options=q||{},this.features=we,this.length=we.length}function lt(we,q){this.id=typeof we.id=="number"?we.id:void 0,this.type=we.type,this.rawGeometry=we.type===1?[we.geometry]:we.geometry,this.properties=we.tags,this.extent=q||4096}ss.prototype.feature=function(we){return new lt(this.features[we],this.options.extent)},lt.prototype.loadGeometry=function(){var we=this.rawGeometry;this.geometry=[];for(var q=0;q<we.length;q++){for(var te=we[q],ue=[],Ce=0;Ce<te.length;Ce++)ue.push(new Hr(te[Ce][0],te[Ce][1]));this.geometry.push(ue)}return this.geometry},lt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var we=this.geometry,q=1/0,te=-1/0,ue=1/0,Ce=-1/0,Oe=0;Oe<we.length;Oe++)for(var Xe=we[Oe],St=0;St<Xe.length;St++){var ke=Xe[St];q=Math.min(q,ke.x),te=Math.max(te,ke.x),ue=Math.min(ue,ke.y),Ce=Math.max(Ce,ke.y)}return[q,ue,te,Ce]},lt.prototype.toGeoJSON=ni.prototype.toGeoJSON;var Vi=o.dO,Fi=br;function zt(we){var q=new Vi;return function(te,ue){for(var Ce in te.layers)ue.writeMessage(3,Mn,te.layers[Ce])}(we,q),q.finish()}function Mn(we,q){var te;q.writeVarintField(15,we.version||1),q.writeStringField(1,we.name||""),q.writeVarintField(5,we.extent||4096);var ue={keys:[],values:[],keycache:{},valuecache:{}};for(te=0;te<we.length;te++)ue.feature=we.feature(te),q.writeMessage(2,wn,ue);var Ce=ue.keys;for(te=0;te<Ce.length;te++)q.writeStringField(3,Ce[te]);var Oe=ue.values;for(te=0;te<Oe.length;te++)q.writeMessage(4,Ps,Oe[te])}function wn(we,q){var te=we.feature;te.id!==void 0&&q.writeVarintField(1,te.id),q.writeMessage(2,Wr,we),q.writeVarintField(3,te.type),q.writeMessage(4,Kn,te)}function Wr(we,q){var te=we.feature,ue=we.keys,Ce=we.values,Oe=we.keycache,Xe=we.valuecache;for(var St in te.properties){var ke=te.properties[St],It=Oe[St];if(ke!==null){It===void 0&&(ue.push(St),Oe[St]=It=ue.length-1),q.writeVarint(It);var ht=typeof ke;ht!=="string"&&ht!=="boolean"&&ht!=="number"&&(ke=JSON.stringify(ke));var bt=ht+":"+ke,fi=Xe[bt];fi===void 0&&(Ce.push(ke),Xe[bt]=fi=Ce.length-1),q.writeVarint(fi)}}}function dr(we,q){return(q<<3)+(7&we)}function Nn(we){return we<<1^we>>31}function Kn(we,q){for(var te=we.loadGeometry(),ue=we.type,Ce=0,Oe=0,Xe=te.length,St=0;St<Xe;St++){var ke=te[St],It=1;ue===1&&(It=ke.length),q.writeVarint(dr(1,It));for(var ht=ue===3?ke.length-1:ke.length,bt=0;bt<ht;bt++){bt===1&&ue!==1&&q.writeVarint(dr(2,ht-1));var fi=ke[bt].x-Ce,sr=ke[bt].y-Oe;q.writeVarint(Nn(fi)),q.writeVarint(Nn(sr)),Ce+=fi,Oe+=sr}ue===3&&q.writeVarint(dr(7,1))}}function Ps(we,q){var te=typeof we;te==="string"?q.writeStringField(1,we):te==="boolean"?q.writeBooleanField(7,we):te==="number"&&(we%1!=0?q.writeDoubleField(3,we):we<0?q.writeSVarintField(6,we):q.writeVarintField(5,we))}Sr.exports=zt,Sr.exports.fromVectorTileJs=zt,Sr.exports.fromGeojsonVt=function(we,q){q=q||{};var te={};for(var ue in we)te[ue]=new Fi(we[ue].features,q),te[ue].name=ue,te[ue].version=q.version,te[ue].extent=q.extent;return zt({layers:te})},Sr.exports.GeoJSONWrapper=Fi;var Xr=o.dK(Sr.exports);const it={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:we=>we},Wt=Math.fround||(Bt=new Float32Array(1),we=>(Bt[0]=+we,Bt[0]));var Bt;const qt=3,Ui=5,tr=6;class de{constructor(q){this.options=Object.assign(Object.create(it),q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(q){const{log:te,minZoom:ue,maxZoom:Ce}=this.options;te&&console.time("total time");const Oe=`prepare ${q.length} points`;te&&console.time(Oe),this.points=q;const Xe=[];for(let ke=0;ke<q.length;ke++){const It=q[ke];if(!It.geometry)continue;const[ht,bt]=It.geometry.coordinates,fi=Wt(ot(ht)),sr=Wt(Ke(bt));Xe.push(fi,sr,1/0,ke,-1,1),this.options.reduce&&Xe.push(0)}let St=this.trees[Ce+1]=this._createTree(Xe);te&&console.timeEnd(Oe);for(let ke=Ce;ke>=ue;ke--){const It=+Date.now();St=this.trees[ke]=this._createTree(this._cluster(St,ke)),te&&console.log("z%d: %d clusters in %dms",ke,St.numItems,+Date.now()-It)}return te&&console.timeEnd("total time"),this}getClusters(q,te){let ue=((q[0]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,q[1]));let Oe=q[2]===180?180:((q[2]+180)%360+360)%360-180;const Xe=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)ue=-180,Oe=180;else if(ue>Oe){const bt=this.getClusters([ue,Ce,180,Xe],te),fi=this.getClusters([-180,Ce,Oe,Xe],te);return bt.concat(fi)}const St=this.trees[this._limitZoom(te)],ke=St.range(ot(ue),Ke(Xe),ot(Oe),Ke(Ce)),It=St.data,ht=[];for(const bt of ke){const fi=this.stride*bt;ht.push(It[fi+Ui]>1?pe(It,fi,this.clusterProps):this.points[It[fi+qt]])}return ht}getChildren(q){const te=this._getOriginId(q),ue=this._getOriginZoom(q),Ce="No cluster with the specified id.",Oe=this.trees[ue];if(!Oe)throw new Error(Ce);const Xe=Oe.data;if(te*this.stride>=Xe.length)throw new Error(Ce);const St=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),ke=Oe.within(Xe[te*this.stride],Xe[te*this.stride+1],St),It=[];for(const ht of ke){const bt=ht*this.stride;Xe[bt+4]===q&&It.push(Xe[bt+Ui]>1?pe(Xe,bt,this.clusterProps):this.points[Xe[bt+qt]])}if(It.length===0)throw new Error(Ce);return It}getLeaves(q,te,ue){const Ce=[];return this._appendLeaves(Ce,q,te=te||10,ue=ue||0,0),Ce}getTile(q,te,ue){const Ce=this.trees[this._limitZoom(q)],Oe=Math.pow(2,q),{extent:Xe,radius:St}=this.options,ke=St/Xe,It=(ue-ke)/Oe,ht=(ue+1+ke)/Oe,bt={features:[]};return this._addTileFeatures(Ce.range((te-ke)/Oe,It,(te+1+ke)/Oe,ht),Ce.data,te,ue,Oe,bt),te===0&&this._addTileFeatures(Ce.range(1-ke/Oe,It,1,ht),Ce.data,Oe,ue,Oe,bt),te===Oe-1&&this._addTileFeatures(Ce.range(0,It,ke/Oe,ht),Ce.data,-1,ue,Oe,bt),bt.features.length?bt:null}getClusterExpansionZoom(q){let te=this._getOriginZoom(q)-1;for(;te<=this.options.maxZoom;){const ue=this.getChildren(q);if(te++,ue.length!==1)break;q=ue[0].properties.cluster_id}return te}_appendLeaves(q,te,ue,Ce,Oe){const Xe=this.getChildren(te);for(const St of Xe){const ke=St.properties;if(ke&&ke.cluster?Oe+ke.point_count<=Ce?Oe+=ke.point_count:Oe=this._appendLeaves(q,ke.cluster_id,ue,Ce,Oe):Oe<Ce?Oe++:q.push(St),q.length===ue)break}return Oe}_createTree(q){const te=new o.bg(q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ue=0;ue<q.length;ue+=this.stride)te.add(q[ue],q[ue+1]);return te.finish(),te.data=q,te}_addTileFeatures(q,te,ue,Ce,Oe,Xe){for(const St of q){const ke=St*this.stride,It=te[ke+Ui]>1;let ht,bt,fi;if(It)ht=Be(te,ke,this.clusterProps),bt=te[ke],fi=te[ke+1];else{const or=this.points[te[ke+qt]];ht=or.properties;const[Yi,$i]=or.geometry.coordinates;bt=ot(Yi),fi=Ke($i)}const sr={type:1,geometry:[[Math.round(this.options.extent*(bt*Oe-ue)),Math.round(this.options.extent*(fi*Oe-Ce))]],tags:ht};let wr;wr=It||this.options.generateId?te[ke+qt]:this.points[te[ke+qt]].id,wr!==void 0&&(sr.id=wr),Xe.features.push(sr)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(Math.floor(+q),this.options.maxZoom+1))}_cluster(q,te){const{radius:ue,extent:Ce,reduce:Oe,minPoints:Xe}=this.options,St=ue/(Ce*Math.pow(2,te)),ke=q.data,It=[],ht=this.stride;for(let bt=0;bt<ke.length;bt+=ht){if(ke[bt+2]<=te)continue;ke[bt+2]=te;const fi=ke[bt],sr=ke[bt+1],wr=q.within(ke[bt],ke[bt+1],St),or=ke[bt+Ui];let Yi=or;for(const $i of wr){const ir=$i*ht;ke[ir+2]>te&&(Yi+=ke[ir+Ui])}if(Yi>or&&Yi>=Xe){let $i,ir=fi*or,fr=sr*or,nn=-1;const gr=(bt/ht<<5)+(te+1)+this.points.length;for(const Ln of wr){const In=Ln*ht;if(ke[In+2]<=te)continue;ke[In+2]=te;const Vn=ke[In+Ui];ir+=ke[In]*Vn,fr+=ke[In+1]*Vn,ke[In+4]=gr,Oe&&($i||($i=this._map(ke,bt,!0),nn=this.clusterProps.length,this.clusterProps.push($i)),Oe($i,this._map(ke,In)))}ke[bt+4]=gr,It.push(ir/Yi,fr/Yi,1/0,gr,-1,Yi),Oe&&It.push(nn)}else{for(let $i=0;$i<ht;$i++)It.push(ke[bt+$i]);if(Yi>1)for(const $i of wr){const ir=$i*ht;if(!(ke[ir+2]<=te)){ke[ir+2]=te;for(let fr=0;fr<ht;fr++)It.push(ke[ir+fr])}}}}return It}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,te,ue){if(q[te+Ui]>1){const Xe=this.clusterProps[q[te+tr]];return ue?Object.assign({},Xe):Xe}const Ce=this.points[q[te+qt]].properties,Oe=this.options.map(Ce);return ue&&Oe===Ce?Object.assign({},Oe):Oe}}function pe(we,q,te){return{type:"Feature",id:we[q+qt],properties:Be(we,q,te),geometry:{type:"Point",coordinates:[(ue=we[q],360*(ue-.5)),Tt(we[q+1])]}};var ue}function Be(we,q,te){const ue=we[q+Ui],Ce=ue>=1e4?`${Math.round(ue/1e3)}k`:ue>=1e3?Math.round(ue/100)/10+"k":ue,Oe=we[q+tr],Xe=Oe===-1?{}:Object.assign({},te[Oe]);return Object.assign(Xe,{cluster:!0,cluster_id:we[q+qt],point_count:ue,point_count_abbreviated:Ce})}function ot(we){return we/360+.5}function Ke(we){const q=Math.sin(we*Math.PI/180),te=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return te<0?0:te>1?1:te}function Tt(we){const q=(180-360*we)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}var Vt={exports:{}};Vt.exports=function(){function we(ze,Fe,Ye,st){for(var et,pt=st,mt=Ye-Fe>>1,rt=Ye-Fe,yt=ze[Fe],ct=ze[Fe+1],Kt=ze[Ye],Ei=ze[Ye+1],Ot=Fe+3;Ot<Ye;Ot+=3){var ar=q(ze[Ot],ze[Ot+1],yt,ct,Kt,Ei);if(ar>pt)et=Ot,pt=ar;else if(ar===pt){var Ar=Math.abs(Ot-mt);Ar<rt&&(et=Ot,rt=Ar)}}pt>st&&(et-Fe>3&&we(ze,Fe,et,st),ze[et+2]=pt,Ye-et>3&&we(ze,et,Ye,st))}function q(ze,Fe,Ye,st,et,pt){var mt=et-Ye,rt=pt-st;if(mt!==0||rt!==0){var yt=((ze-Ye)*mt+(Fe-st)*rt)/(mt*mt+rt*rt);yt>1?(Ye=et,st=pt):yt>0&&(Ye+=mt*yt,st+=rt*yt)}return(mt=ze-Ye)*mt+(rt=Fe-st)*rt}function te(ze,Fe,Ye,st){var et={id:ze===void 0?null:ze,type:Fe,geometry:Ye,tags:st,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(pt){var mt=pt.geometry,rt=pt.type;if(rt==="Point"||rt==="MultiPoint"||rt==="LineString")ue(pt,mt);else if(rt==="Polygon"||rt==="MultiLineString")for(var yt=0;yt<mt.length;yt++)ue(pt,mt[yt]);else if(rt==="MultiPolygon")for(yt=0;yt<mt.length;yt++)for(var ct=0;ct<mt[yt].length;ct++)ue(pt,mt[yt][ct])}(et),et}function ue(ze,Fe){for(var Ye=0;Ye<Fe.length;Ye+=3)ze.minX=Math.min(ze.minX,Fe[Ye]),ze.minY=Math.min(ze.minY,Fe[Ye+1]),ze.maxX=Math.max(ze.maxX,Fe[Ye]),ze.maxY=Math.max(ze.maxY,Fe[Ye+1])}function Ce(ze,Fe,Ye,st){if(Fe.geometry){var et=Fe.geometry.coordinates,pt=Fe.geometry.type,mt=Math.pow(Ye.tolerance/((1<<Ye.maxZoom)*Ye.extent),2),rt=[],yt=Fe.id;if(Ye.promoteId?yt=Fe.properties[Ye.promoteId]:Ye.generateId&&(yt=st||0),pt==="Point")Oe(et,rt);else if(pt==="MultiPoint")for(var ct=0;ct<et.length;ct++)Oe(et[ct],rt);else if(pt==="LineString")Xe(et,rt,mt,!1);else if(pt==="MultiLineString"){if(Ye.lineMetrics){for(ct=0;ct<et.length;ct++)Xe(et[ct],rt=[],mt,!1),ze.push(te(yt,"LineString",rt,Fe.properties));return}St(et,rt,mt,!1)}else if(pt==="Polygon")St(et,rt,mt,!0);else{if(pt!=="MultiPolygon"){if(pt==="GeometryCollection"){for(ct=0;ct<Fe.geometry.geometries.length;ct++)Ce(ze,{id:yt,geometry:Fe.geometry.geometries[ct],properties:Fe.properties},Ye,st);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ct=0;ct<et.length;ct++){var Kt=[];St(et[ct],Kt,mt,!0),rt.push(Kt)}}ze.push(te(yt,pt,rt,Fe.properties))}}function Oe(ze,Fe){Fe.push(ke(ze[0])),Fe.push(It(ze[1])),Fe.push(0)}function Xe(ze,Fe,Ye,st){for(var et,pt,mt=0,rt=0;rt<ze.length;rt++){var yt=ke(ze[rt][0]),ct=It(ze[rt][1]);Fe.push(yt),Fe.push(ct),Fe.push(0),rt>0&&(mt+=st?(et*ct-yt*pt)/2:Math.sqrt(Math.pow(yt-et,2)+Math.pow(ct-pt,2))),et=yt,pt=ct}var Kt=Fe.length-3;Fe[2]=1,we(Fe,0,Kt,Ye),Fe[Kt+2]=1,Fe.size=Math.abs(mt),Fe.start=0,Fe.end=Fe.size}function St(ze,Fe,Ye,st){for(var et=0;et<ze.length;et++){var pt=[];Xe(ze[et],pt,Ye,st),Fe.push(pt)}}function ke(ze){return ze/360+.5}function It(ze){var Fe=Math.sin(ze*Math.PI/180),Ye=.5-.25*Math.log((1+Fe)/(1-Fe))/Math.PI;return Ye<0?0:Ye>1?1:Ye}function ht(ze,Fe,Ye,st,et,pt,mt,rt){if(st/=Fe,pt>=(Ye/=Fe)&&mt<st)return ze;if(mt<Ye||pt>=st)return null;for(var yt=[],ct=0;ct<ze.length;ct++){var Kt=ze[ct],Ei=Kt.geometry,Ot=Kt.type,ar=et===0?Kt.minX:Kt.minY,Ar=et===0?Kt.maxX:Kt.maxY;if(ar>=Ye&&Ar<st)yt.push(Kt);else if(!(Ar<Ye||ar>=st)){var hr=[];if(Ot==="Point"||Ot==="MultiPoint")bt(Ei,hr,Ye,st,et);else if(Ot==="LineString")fi(Ei,hr,Ye,st,et,!1,rt.lineMetrics);else if(Ot==="MultiLineString")wr(Ei,hr,Ye,st,et,!1);else if(Ot==="Polygon")wr(Ei,hr,Ye,st,et,!0);else if(Ot==="MultiPolygon")for(var Kr=0;Kr<Ei.length;Kr++){var mn=[];wr(Ei[Kr],mn,Ye,st,et,!0),mn.length&&hr.push(mn)}if(hr.length){if(rt.lineMetrics&&Ot==="LineString"){for(Kr=0;Kr<hr.length;Kr++)yt.push(te(Kt.id,Ot,hr[Kr],Kt.tags));continue}Ot!=="LineString"&&Ot!=="MultiLineString"||(hr.length===1?(Ot="LineString",hr=hr[0]):Ot="MultiLineString"),Ot!=="Point"&&Ot!=="MultiPoint"||(Ot=hr.length===3?"Point":"MultiPoint"),yt.push(te(Kt.id,Ot,hr,Kt.tags))}}}return yt.length?yt:null}function bt(ze,Fe,Ye,st,et){for(var pt=0;pt<ze.length;pt+=3){var mt=ze[pt+et];mt>=Ye&&mt<=st&&(Fe.push(ze[pt]),Fe.push(ze[pt+1]),Fe.push(ze[pt+2]))}}function fi(ze,Fe,Ye,st,et,pt,mt){for(var rt,yt,ct=sr(ze),Kt=et===0?Yi:$i,Ei=ze.start,Ot=0;Ot<ze.length-3;Ot+=3){var ar=ze[Ot],Ar=ze[Ot+1],hr=ze[Ot+2],Kr=ze[Ot+3],mn=ze[Ot+4],ji=et===0?ar:Ar,Jn=et===0?Kr:mn,_s=!1;mt&&(rt=Math.sqrt(Math.pow(ar-Kr,2)+Math.pow(Ar-mn,2))),ji<Ye?Jn>Ye&&(yt=Kt(ct,ar,Ar,Kr,mn,Ye),mt&&(ct.start=Ei+rt*yt)):ji>st?Jn<st&&(yt=Kt(ct,ar,Ar,Kr,mn,st),mt&&(ct.start=Ei+rt*yt)):or(ct,ar,Ar,hr),Jn<Ye&&ji>=Ye&&(yt=Kt(ct,ar,Ar,Kr,mn,Ye),_s=!0),Jn>st&&ji<=st&&(yt=Kt(ct,ar,Ar,Kr,mn,st),_s=!0),!pt&&_s&&(mt&&(ct.end=Ei+rt*yt),Fe.push(ct),ct=sr(ze)),mt&&(Ei+=rt)}var _n=ze.length-3;ar=ze[_n],Ar=ze[_n+1],hr=ze[_n+2],(ji=et===0?ar:Ar)>=Ye&&ji<=st&&or(ct,ar,Ar,hr),_n=ct.length-3,pt&&_n>=3&&(ct[_n]!==ct[0]||ct[_n+1]!==ct[1])&&or(ct,ct[0],ct[1],ct[2]),ct.length&&Fe.push(ct)}function sr(ze){var Fe=[];return Fe.size=ze.size,Fe.start=ze.start,Fe.end=ze.end,Fe}function wr(ze,Fe,Ye,st,et,pt){for(var mt=0;mt<ze.length;mt++)fi(ze[mt],Fe,Ye,st,et,pt,!1)}function or(ze,Fe,Ye,st){ze.push(Fe),ze.push(Ye),ze.push(st)}function Yi(ze,Fe,Ye,st,et,pt){var mt=(pt-Fe)/(st-Fe);return ze.push(pt),ze.push(Ye+(et-Ye)*mt),ze.push(1),mt}function $i(ze,Fe,Ye,st,et,pt){var mt=(pt-Ye)/(et-Ye);return ze.push(Fe+(st-Fe)*mt),ze.push(pt),ze.push(1),mt}function ir(ze,Fe){for(var Ye=[],st=0;st<ze.length;st++){var et,pt=ze[st],mt=pt.type;if(mt==="Point"||mt==="MultiPoint"||mt==="LineString")et=fr(pt.geometry,Fe);else if(mt==="MultiLineString"||mt==="Polygon"){et=[];for(var rt=0;rt<pt.geometry.length;rt++)et.push(fr(pt.geometry[rt],Fe))}else if(mt==="MultiPolygon")for(et=[],rt=0;rt<pt.geometry.length;rt++){for(var yt=[],ct=0;ct<pt.geometry[rt].length;ct++)yt.push(fr(pt.geometry[rt][ct],Fe));et.push(yt)}Ye.push(te(pt.id,mt,et,pt.tags))}return Ye}function fr(ze,Fe){var Ye=[];Ye.size=ze.size,ze.start!==void 0&&(Ye.start=ze.start,Ye.end=ze.end);for(var st=0;st<ze.length;st+=3)Ye.push(ze[st]+Fe,ze[st+1],ze[st+2]);return Ye}function nn(ze,Fe){if(ze.transformed)return ze;var Ye,st,et,pt=1<<ze.z,mt=ze.x,rt=ze.y;for(Ye=0;Ye<ze.features.length;Ye++){var yt=ze.features[Ye],ct=yt.geometry,Kt=yt.type;if(yt.geometry=[],Kt===1)for(st=0;st<ct.length;st+=2)yt.geometry.push(gr(ct[st],ct[st+1],Fe,pt,mt,rt));else for(st=0;st<ct.length;st++){var Ei=[];for(et=0;et<ct[st].length;et+=2)Ei.push(gr(ct[st][et],ct[st][et+1],Fe,pt,mt,rt));yt.geometry.push(Ei)}}return ze.transformed=!0,ze}function gr(ze,Fe,Ye,st,et,pt){return[Math.round(Ye*(ze*st-et)),Math.round(Ye*(Fe*st-pt))]}function Ln(ze,Fe,Ye,st,et){for(var pt=Fe===et.maxZoom?0:et.tolerance/((1<<Fe)*et.extent),mt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ye,y:st,z:Fe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},rt=0;rt<ze.length;rt++){mt.numFeatures++,In(mt,ze[rt],pt,et);var yt=ze[rt].minX,ct=ze[rt].minY,Kt=ze[rt].maxX,Ei=ze[rt].maxY;yt<mt.minX&&(mt.minX=yt),ct<mt.minY&&(mt.minY=ct),Kt>mt.maxX&&(mt.maxX=Kt),Ei>mt.maxY&&(mt.maxY=Ei)}return mt}function In(ze,Fe,Ye,st){var et=Fe.geometry,pt=Fe.type,mt=[];if(pt==="Point"||pt==="MultiPoint")for(var rt=0;rt<et.length;rt+=3)mt.push(et[rt]),mt.push(et[rt+1]),ze.numPoints++,ze.numSimplified++;else if(pt==="LineString")Vn(mt,et,ze,Ye,!1,!1);else if(pt==="MultiLineString"||pt==="Polygon")for(rt=0;rt<et.length;rt++)Vn(mt,et[rt],ze,Ye,pt==="Polygon",rt===0);else if(pt==="MultiPolygon")for(var yt=0;yt<et.length;yt++){var ct=et[yt];for(rt=0;rt<ct.length;rt++)Vn(mt,ct[rt],ze,Ye,!0,rt===0)}if(mt.length){var Kt=Fe.tags||null;if(pt==="LineString"&&st.lineMetrics){for(var Ei in Kt={},Fe.tags)Kt[Ei]=Fe.tags[Ei];Kt.mapbox_clip_start=et.start/et.size,Kt.mapbox_clip_end=et.end/et.size}var Ot={geometry:mt,type:pt==="Polygon"||pt==="MultiPolygon"?3:pt==="LineString"||pt==="MultiLineString"?2:1,tags:Kt};Fe.id!==null&&(Ot.id=Fe.id),ze.features.push(Ot)}}function Vn(ze,Fe,Ye,st,et,pt){var mt=st*st;if(st>0&&Fe.size<(et?mt:st))Ye.numPoints+=Fe.length/3;else{for(var rt=[],yt=0;yt<Fe.length;yt+=3)(st===0||Fe[yt+2]>mt)&&(Ye.numSimplified++,rt.push(Fe[yt]),rt.push(Fe[yt+1])),Ye.numPoints++;et&&function(ct,Kt){for(var Ei=0,Ot=0,ar=ct.length,Ar=ar-2;Ot<ar;Ar=Ot,Ot+=2)Ei+=(ct[Ot]-ct[Ar])*(ct[Ot+1]+ct[Ar+1]);if(Ei>0===Kt)for(Ot=0,ar=ct.length;Ot<ar/2;Ot+=2){var hr=ct[Ot],Kr=ct[Ot+1];ct[Ot]=ct[ar-2-Ot],ct[Ot+1]=ct[ar-1-Ot],ct[ar-2-Ot]=hr,ct[ar-1-Ot]=Kr}}(rt,pt),ze.push(rt)}}function Yr(ze,Fe){var Ye=(Fe=this.options=function(et,pt){for(var mt in pt)et[mt]=pt[mt];return et}(Object.create(this.options),Fe)).debug;if(Ye&&console.time("preprocess data"),Fe.maxZoom<0||Fe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Fe.promoteId&&Fe.generateId)throw new Error("promoteId and generateId cannot be used together.");var st=function(et,pt){var mt=[];if(et.type==="FeatureCollection")for(var rt=0;rt<et.features.length;rt++)Ce(mt,et.features[rt],pt,rt);else Ce(mt,et.type==="Feature"?et:{geometry:et},pt);return mt}(ze,Fe);this.tiles={},this.tileCoords=[],Ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Fe.indexMaxZoom,Fe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(st=function(et,pt){var mt=pt.buffer/pt.extent,rt=et,yt=ht(et,1,-1-mt,mt,0,-1,2,pt),ct=ht(et,1,1-mt,2+mt,0,-1,2,pt);return(yt||ct)&&(rt=ht(et,1,-mt,1+mt,0,-1,2,pt)||[],yt&&(rt=ir(yt,1).concat(rt)),ct&&(rt=rt.concat(ir(ct,-1)))),rt}(st,Fe)).length&&this.splitTile(st,0,0,0),Ye&&(st.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Gr(ze,Fe,Ye){return 32*((1<<ze)*Ye+Fe)+ze}return Yr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Yr.prototype.splitTile=function(ze,Fe,Ye,st,et,pt,mt){for(var rt=[ze,Fe,Ye,st],yt=this.options,ct=yt.debug;rt.length;){st=rt.pop(),Ye=rt.pop(),Fe=rt.pop(),ze=rt.pop();var Kt=1<<Fe,Ei=Gr(Fe,Ye,st),Ot=this.tiles[Ei];if(!Ot&&(ct>1&&console.time("creation"),Ot=this.tiles[Ei]=Ln(ze,Fe,Ye,st,yt),this.tileCoords.push({z:Fe,x:Ye,y:st}),ct)){ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Fe,Ye,st,Ot.numFeatures,Ot.numPoints,Ot.numSimplified),console.timeEnd("creation"));var ar="z"+Fe;this.stats[ar]=(this.stats[ar]||0)+1,this.total++}if(Ot.source=ze,et){if(Fe===yt.maxZoom||Fe===et)continue;var Ar=1<<et-Fe;if(Ye!==Math.floor(pt/Ar)||st!==Math.floor(mt/Ar))continue}else if(Fe===yt.indexMaxZoom||Ot.numPoints<=yt.indexMaxPoints)continue;if(Ot.source=null,ze.length!==0){ct>1&&console.time("clipping");var hr,Kr,mn,ji,Jn,_s,_n=.5*yt.buffer/yt.extent,dl=.5-_n,lo=.5+_n,fa=1+_n;hr=Kr=mn=ji=null,Jn=ht(ze,Kt,Ye-_n,Ye+lo,0,Ot.minX,Ot.maxX,yt),_s=ht(ze,Kt,Ye+dl,Ye+fa,0,Ot.minX,Ot.maxX,yt),ze=null,Jn&&(hr=ht(Jn,Kt,st-_n,st+lo,1,Ot.minY,Ot.maxY,yt),Kr=ht(Jn,Kt,st+dl,st+fa,1,Ot.minY,Ot.maxY,yt),Jn=null),_s&&(mn=ht(_s,Kt,st-_n,st+lo,1,Ot.minY,Ot.maxY,yt),ji=ht(_s,Kt,st+dl,st+fa,1,Ot.minY,Ot.maxY,yt),_s=null),ct>1&&console.timeEnd("clipping"),rt.push(hr||[],Fe+1,2*Ye,2*st),rt.push(Kr||[],Fe+1,2*Ye,2*st+1),rt.push(mn||[],Fe+1,2*Ye+1,2*st),rt.push(ji||[],Fe+1,2*Ye+1,2*st+1)}}},Yr.prototype.getTile=function(ze,Fe,Ye){var st=this.options,et=st.extent,pt=st.debug;if(ze<0||ze>24)return null;var mt=1<<ze,rt=Gr(ze,Fe=(Fe%mt+mt)%mt,Ye);if(this.tiles[rt])return nn(this.tiles[rt],et);pt>1&&console.log("drilling down to z%d-%d-%d",ze,Fe,Ye);for(var yt,ct=ze,Kt=Fe,Ei=Ye;!yt&&ct>0;)ct--,Kt=Math.floor(Kt/2),Ei=Math.floor(Ei/2),yt=this.tiles[Gr(ct,Kt,Ei)];return yt&&yt.source?(pt>1&&console.log("found parent tile z%d-%d-%d",ct,Kt,Ei),pt>1&&console.time("drilling down"),this.splitTile(yt.source,ct,Kt,Ei,ze,Fe,Ye),pt>1&&console.timeEnd("drilling down"),this.tiles[rt]?nn(this.tiles[rt],et):null):null},function(ze,Fe){return new Yr(ze,Fe)}}();var ft=o.dK(Vt.exports);function Lt(we,q){const te=we.tileID.canonical;if(!this._geoJSONIndex)return q(null,null);const ue=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!ue)return q(null,null);const Ce=new Ue(ue.features);let Oe=Xr(Ce);Oe.byteOffset===0&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),q(null,{vectorTile:Ce,rawData:Oe.buffer})}class gt extends Nt{constructor(q,te,ue,Ce,Oe,Xe){super(q,te,ue,Ce,Lt,Xe),Oe&&(this.loadGeoJSON=Oe)}loadData(q,te){const ue=q&&q.request,Ce=ue&&ue.collectResourceTiming;this.loadGeoJSON(q,(Oe,Xe)=>{if(Oe||!Xe)return te(Oe);if(typeof Xe!="object")return te(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));{wi(Xe,!0);try{if(q.filter){const ke=o.r(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ke.result==="error")throw new Error(ke.value.map(ht=>`${ht.key}: ${ht.message}`).join(", "));Xe={type:"FeatureCollection",features:Xe.features.filter(ht=>ke.value.evaluate({zoom:0},ht))}}this._geoJSONIndex=q.cluster?new de(function({superclusterOptions:ke,clusterProperties:It}){if(!It||!ke)return ke;const ht={},bt={},fi={accumulated:null,zoom:0},sr={properties:null},wr=Object.keys(It);for(const or of wr){const[Yi,$i]=It[or],ir=o.r($i),fr=o.r(typeof Yi=="string"?[Yi,["accumulated"],["get",or]]:Yi);ht[or]=ir.value,bt[or]=fr.value}return ke.map=or=>{sr.properties=or;const Yi={};for(const $i of wr)Yi[$i]=ht[$i].evaluate(fi,sr);return Yi},ke.reduce=(or,Yi)=>{sr.properties=Yi;for(const $i of wr)fi.accumulated=or[$i],or[$i]=bt[$i].evaluate(fi,sr)},ke}(q)).load(Xe.features):ft(Xe,q.geojsonVtOptions)}catch(ke){return te(ke)}this.loaded={};const St={};if(Ce){const ke=re(ue);ke&&(St.resourceTiming={},St.resourceTiming[q.source]=JSON.parse(JSON.stringify(ke)))}te(null,St)}})}reloadTile(q,te){const ue=this.loaded;return ue&&ue[q.uid]?super.reloadTile(q,te):this.loadTile(q,te)}loadGeoJSON(q,te){if(q.request)o.g(q.request,te);else{if(typeof q.data!="string")return te(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));try{return te(null,JSON.parse(q.data))}catch{return te(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(q,te){try{te(null,this._geoJSONIndex.getClusterExpansionZoom(q.clusterId))}catch(ue){te(ue)}}getClusterChildren(q,te){try{te(null,this._geoJSONIndex.getChildren(q.clusterId))}catch(ue){te(ue)}}getClusterLeaves(q,te){try{te(null,this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset))}catch(ue){te(ue)}}}class jt{constructor(q,te){this.tileID=new o.am(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.tileZoom=q.tileZoom,this.uid=q.uid,this.zoom=q.zoom,this.canonical=q.tileID.canonical,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=q.projection,this.brightness=te}parse(q,te,ue,Ce){this.status="parsing";const Oe=new o.am(ue.tileID.overscaledZ,ue.tileID.wrap,ue.tileID.canonical.z,ue.tileID.canonical.x,ue.tileID.canonical.y),Xe={},St=te.familiesBySource[ue.source],ke=new o.dC(Oe,ue.promoteId);return ke.bucketLayerIDs=[],ke.is3DTile=!0,o.dP(q).then(It=>{if(!It)return Ce(new Error("Could not parse tile"));const ht=o.dQ(It,1/o.bR(ue.tileID.canonical)),bt=It.json.extensionsUsed&&It.json.extensionsUsed.includes("MAPBOX_mesh_features")||It.json.asset.extras&&It.json.asset.extras.MAPBOX_mesh_features,fi=It.json.extensionsUsed&&It.json.extensionsUsed.includes("EXT_meshopt_compression"),sr=new o.K(this.zoom,{brightness:this.brightness});for(const wr in St)for(const or of St[wr]){const Yi=or[0];ke.bucketLayerIDs.push(or.map(ir=>ir.id)),Yi.recalculate(sr,[]);const $i=new o.dR(ht,Oe,bt,fi,this.brightness,ke);bt||($i.needsUpload=!0),Xe[Yi.fqid]=$i,$i.evaluate(Yi)}this.status="done",Ce(null,{buckets:Xe,featureIndex:ke})}).catch(It=>Ce(new Error(It.message)))}}class si{constructor(q,te,ue,Ce,Oe,Xe){this.actor=q,this.layerIndex=te,this.brightness=Xe,this.loading={},this.loaded={}}loadTile(q,te){const ue=q.uid,Ce=this.loading[ue]=new jt(q,this.brightness);o.a_(q.request,(Oe,Xe)=>{const St=!this.loading[ue];return delete this.loading[ue],St||Oe?(Ce.status="done",St||(this.loaded[ue]=Ce),te(Oe)):Xe&&Xe.byteLength!==0?void Ce.parse(Xe,this.layerIndex,q,(ke,It)=>{Ce.status="done",this.loaded=this.loaded||{},this.loaded[ue]=Ce,ke||!It?te(ke):te(null,It)}):(Ce.status="done",this.loaded[ue]=Ce,te())})}reloadTile(q,te){const ue=this.loaded,Ce=q.uid;if(ue&&ue[Ce]){const Oe=ue[Ce];Oe.projection=q.projection,Oe.brightness=q.brightness;const Xe=(St,ke)=>{Oe.reloadCallback&&(delete Oe.reloadCallback,this.loadTile(q,te)),te(St,ke)};Oe.status==="parsing"?Oe.reloadCallback=Xe:Oe.status==="done"&&this.loadTile(q,te)}}abortTile(q,te){const ue=q.uid;this.loading[ue]&&delete this.loading[ue],te()}removeTile(q,te){const ue=this.loaded,Ce=q.uid;ue&&ue[Ce]&&delete ue[Ce],te()}}class ei{constructor(q){this.self=q,this.actor=new o.dS(q,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.bo({name:"mercator"}),this.workerSourceTypes={vector:Nt,geojson:gt,"batched-model":si},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(te,ue)=>{if(this.workerSourceTypes[te])throw new Error(`Worker source with name "${te}" already registered.`);this.workerSourceTypes[te]=ue},this.self.registerRTLTextPlugin=te=>{if(o.dT.isParsed())throw new Error("RTL text plugin already registered.");o.dT.applyArabicShaping=te.applyArabicShaping,o.dT.processBidirectionalText=te.processBidirectionalText,o.dT.processStyledBidirectionalText=te.processStyledBidirectionalText}}clearCaches(q,te,ue){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q],delete this.rasterArrayWorkerSource,ue()}checkIfReady(q,te,ue){ue()}setReferrer(q,te){this.referrer=te}spriteLoaded(q,{scope:te,isLoaded:ue}){if(this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={}),this.isSpriteLoaded[q][te]=ue,this.workerSources[q]&&this.workerSources[q][te])for(const Ce in this.workerSources[q][te]){const Oe=this.workerSources[q][te][Ce];for(const Xe in Oe)Oe[Xe]instanceof Nt&&(Oe[Xe].isSpriteLoaded=ue,Oe[Xe].fire(new o.b("isSpriteLoaded")))}}setImages(q,{scope:te,images:ue},Ce){if(this.availableImages[q]||(this.availableImages[q]={}),this.availableImages[q][te]=ue,this.workerSources[q]&&this.workerSources[q][te]){for(const Oe in this.workerSources[q][te]){const Xe=this.workerSources[q][te][Oe];for(const St in Xe)Xe[St].availableImages=ue}Ce()}else Ce()}setProjection(q,te){this.projections[q]=o.bo(te)}setBrightness(q,te,ue){this.brightness=te,ue()}setLayers(q,te,ue){this.getLayerIndex(q,te.scope).replace(te.layers,te.options),ue()}updateLayers(q,te,ue){this.getLayerIndex(q,te.scope).update(te.layers,te.removedIds,te.options),ue()}loadTile(q,te,ue){te.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,te.type,te.source,te.scope).loadTile(te,ue)}loadDEMTile(q,te,ue){this.getDEMWorkerSource(q,te.source,te.scope).loadTile(te,ue)}decodeRasterArray(q,te,ue){this.getRasterArrayWorkerSource().decodeRasterArray(te,ue)}reloadTile(q,te,ue){te.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,te.type,te.source,te.scope).reloadTile(te,ue)}abortTile(q,te,ue){this.getWorkerSource(q,te.type,te.source,te.scope).abortTile(te,ue)}removeTile(q,te,ue){this.getWorkerSource(q,te.type,te.source,te.scope).removeTile(te,ue)}removeSource(q,te,ue){if(!(this.workerSources[q]&&this.workerSources[q][te.scope]&&this.workerSources[q][te.scope][te.type]&&this.workerSources[q][te.scope][te.type][te.source]))return;const Ce=this.workerSources[q][te.scope][te.type][te.source];delete this.workerSources[q][te.scope][te.type][te.source],Ce.removeSource!==void 0?Ce.removeSource(te,ue):ue()}loadWorkerSource(q,te,ue){try{this.self.importScripts(te.url),ue()}catch(Ce){ue(Ce.toString())}}syncRTLPluginState(q,te,ue){try{o.dT.setState(te);const Ce=o.dT.getPluginURL();if(o.dT.isLoaded()&&!o.dT.isParsed()&&Ce!=null){this.self.importScripts(Ce);const Oe=o.dT.isParsed();ue(Oe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ce}`),Oe)}}catch(Ce){ue(Ce.toString())}}setDracoUrl(q,te){this.dracoUrl=te}getAvailableImages(q,te){this.availableImages[q]||(this.availableImages[q]={});let ue=this.availableImages[q][te];return ue||(ue=[]),ue}getLayerIndex(q,te){this.layerIndexes[q]||(this.layerIndexes[q]={});let ue=this.layerIndexes[q][te];return ue||(ue=this.layerIndexes[q][te]=new Se,ue.scope=te),ue}getWorkerSource(q,te,ue,Ce){if(this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][Ce]||(this.workerSources[q][Ce]={}),this.workerSources[q][Ce][te]||(this.workerSources[q][Ce][te]={}),this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={}),!this.workerSources[q][Ce][te][ue]){const Oe={send:(Xe,St,ke,It,ht,bt)=>{this.actor.send(Xe,St,ke,q,ht,bt)},scheduler:this.actor.scheduler};this.workerSources[q][Ce][te][ue]=new this.workerSourceTypes[te](Oe,this.getLayerIndex(q,Ce),this.getAvailableImages(q,Ce),this.isSpriteLoaded[q][Ce],void 0,this.brightness)}return this.workerSources[q][Ce][te][ue]}getDEMWorkerSource(q,te,ue){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][ue]||(this.demWorkerSources[q][ue]={}),this.demWorkerSources[q][ue][te]||(this.demWorkerSources[q][ue][te]=new ri),this.demWorkerSources[q][ue][te]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Jt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(q,te){o.dU(te)}getWorkerPerformanceMetrics(q,te,ue){ue(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ei(self)),ei}),V(["./shared"],function(o){function re(c,r){if(Array.isArray(c)){if(!Array.isArray(r)||c.length!==r.length)return!1;for(let s=0;s<c.length;s++)if(!re(c[s],r[s]))return!1;return!0}if(typeof c=="object"&&c!==null&&r!==null){if(typeof r!="object"||Object.keys(c).length!==Object.keys(r).length)return!1;for(const s in c)if(!re(c[s],r[s]))return!1;return!0}return c===r}var oe=se;function se(c){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var u,f,m=new Blob([""],{type:"text/javascript"}),x=URL.createObjectURL(m);try{f=new Worker(x),u=!0}catch{u=!1}return f&&f.terminate(),URL.revokeObjectURL(x),u}()?function(){var u=document.createElement("canvas");u.width=u.height=1;var f=u.getContext("2d");if(!f)return!1;var m=f.getImageData(0,0,1,1);return m&&m.width===u.width}()?(Se[s=r&&r.failIfMajorPerformanceCaveat]===void 0&&(Se[s]=function(u){var f,m=function(x){var b=document.createElement("canvas"),E=Object.create(se.webGLContextAttributes);return E.failIfMajorPerformanceCaveat=x,b.getContext("webgl2",E)}(u);if(!m)return!1;try{f=m.createShader(m.VERTEX_SHADER)}catch{return!1}return!(!f||m.isContextLost())&&(m.shaderSource(f,"void main() {}"),m.compileShader(f),m.getShaderParameter(f,m.COMPILE_STATUS)===!0)}(s)),Se[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var s}(c)}var Se={};function Ie(c,r,s){const u=document.createElement(c);return r!=null&&(u.className=r),s&&s.appendChild(u),u}function qe(c,r,s){const u=document.createElementNS("http://www.w3.org/2000/svg",c);for(const f of Object.keys(r))u.setAttributeNS(null,f,String(r[f]));return s&&s.appendChild(u),u}se.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const at=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ft=at&&at.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Nt;function ri(){at&&Ft&&(Nt=at[Ft],at[Ft]="none")}function Jt(){at&&Ft&&(at[Ft]=Nt)}function Xi(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",Xi,!0)}function er(){window.addEventListener("click",Xi,!0),window.setTimeout(()=>{window.removeEventListener("click",Xi,!0)},0)}function wi(c,r){const s=c.getBoundingClientRect();return Ue(c,s,r)}function vr(c,r){const s=c.getBoundingClientRect(),u=[];for(let f=0;f<r.length;f++)u.push(Ue(c,s,r[f]));return u}function zi(c){return window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function Ue(c,r,s){const u=c.offsetWidth===r.width?1:c.offsetWidth/r.width;return new o.P((s.clientX-r.left)*u,(s.clientY-r.top)*u)}class Sr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,s){this._updatedSourceCaches[r]=s,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const s=r.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(r.id),this.setDirty()}removeLayer(r){const s=r.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][r.id]=r,this._updatedLayers[s].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const s in this._updatedLayers)r[s]=r[s]||{},r[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)r[s]=r[s]||{},r[s].removedIds=Object.keys(this._removedLayers[s]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(r){this._updatedImages.add(r),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class Hr extends o.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.numModelsLoading={}}loadModel(r,s){return o.l(this.requestManager.transformRequest(s,o.R.Model).url).then(u=>{if(!u)return;const f=o.c(u),m=new o.M(r,void 0,void 0,f);return m.computeBoundsAndApplyParent(),m}).catch(u=>{this.fire(new o.a(new Error(`Could not load model ${r} from ${s}: ${u.message}`)))})}load(r,s){this.models[s]||(this.models[s]={});const u=Object.keys(r);this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+u.length;const f=[];for(const m of u)f.push(this.loadModel(m,r[m]));Promise.allSettled(f).then(m=>{for(let x=0;x<m.length;x++){const{status:b,value:E}=m[x];b==="fulfilled"&&E&&(this.models[s][u[x]]=E)}this.numModelsLoading[s]-=u.length,this.fire(new o.b("data",{dataType:"style"}))}).catch(m=>{this.fire(new o.a(new Error(`Could not load models: ${m.message}`)))})}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,s){return!!this.getModel(r,s)}getModel(r,s){return this.models[s]||(this.models[s]={}),this.models[s][r]}addModel(r,s,u){this.models[u]||(this.models[u]={}),this.hasModel(r,u)&&this.removeModel(r,u),this.load({[r]:this.requestManager.normalizeModelURL(s)},u)}addModels(r,s){const u={};for(const f in r)u[f]=this.requestManager.normalizeModelURL(r[f]);this.load(u,s)}removeModel(r,s){this.models[s]||(this.models[s]={});const u=this.models[s][r];delete this.models[s][r],u.destroy()}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,s){this.models[s]||(this.models[s]={});for(const u in this.models[s])this.models[s][u].upload(r.context)}}class ni{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,s,u){const f=String(s);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][f]=this.stateChanges[r][f]||{},o.e(this.stateChanges[r][f],u),this.deletedStates[r]===null){this.deletedStates[r]={};for(const m in this.state[r])m!==f&&(this.deletedStates[r][m]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][f]===null){this.deletedStates[r][f]={};for(const m in this.state[r][f])u[m]||(this.deletedStates[r][f][m]=null)}else for(const m in u)this.deletedStates[r]&&this.deletedStates[r][f]&&this.deletedStates[r][f][m]===null&&delete this.deletedStates[r][f][m]}removeFeatureState(r,s,u){if(this.deletedStates[r]===null)return;const f=String(s);if(this.deletedStates[r]=this.deletedStates[r]||{},u&&s!==void 0)this.deletedStates[r][f]!==null&&(this.deletedStates[r][f]=this.deletedStates[r][f]||{},this.deletedStates[r][f][u]=null);else if(s!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][f])for(u in this.deletedStates[r][f]={},this.stateChanges[r][f])this.deletedStates[r][f][u]=null;else this.deletedStates[r][f]=null;else this.deletedStates[r]=null}getState(r,s){const u=String(s),f=o.e({},(this.state[r]||{})[u],(this.stateChanges[r]||{})[u]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const m=this.deletedStates[r][s];if(m===null)return{};for(const x in m)delete f[x]}return f}initializeTileState(r,s){r.setFeatureState(this.state,s)}coalesceChanges(r,s){const u={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const m={};for(const x in this.stateChanges[f])this.state[f][x]||(this.state[f][x]={}),o.e(this.state[f][x],this.stateChanges[f][x]),m[x]=this.state[f][x];u[f]=m}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const m={};if(this.deletedStates[f]===null)for(const x in this.state[f])m[x]={},this.state[f][x]={};else for(const x in this.deletedStates[f]){if(this.deletedStates[f][x]===null)this.state[f][x]={};else if(this.state[f][x])for(const b of Object.keys(this.deletedStates[f][x]))delete this.state[f][x][b];m[x]=this.state[f][x]}u[f]=u[f]||{},o.e(u[f],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const f in r)r[f].setFeatureState(u,s)}}function br(c){const{userImage:r}=c;return!!(r&&r.render&&r.render())&&(c.data.replace(new Uint8Array(r.data.buffer)),!0)}class ss extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(r){this.images[r]={},this.loaded[r]=!1,this.updatedImages[r]={},this.patterns[r]={},this.callbackDispatchedThisFrame[r]={},this.atlasImage[r]=new o.h({width:1,height:1})}isLoaded(){for(const r in this.loaded)if(!this.loaded[r])return!1;return!0}setLoaded(r,s){if(this.loaded[s]!==r&&(this.loaded[s]=r,r)){for(const{ids:u,callback:f}of this.requestors)this._notify(u,s,f);this.requestors=[]}}hasImage(r,s){return!!this.getImage(r,s)}getImage(r,s){return this.images[s][r]}addImage(r,s,u){this._validate(r,u)&&(this.images[s][r]=u)}_validate(r,s){let u=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.a(new Error(`Image "${r}" has invalid "stretchX" value`))),u=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.a(new Error(`Image "${r}" has invalid "stretchY" value`))),u=!1),this._validateContent(s.content,s)||(this.fire(new o.a(new Error(`Image "${r}" has invalid "content" value`))),u=!1),u}_validateStretch(r,s){if(!r)return!0;let u=0;for(const f of r){if(f[0]<u||f[1]<f[0]||s<f[1])return!1;u=f[1]}return!0}_validateContent(r,s){return!(r&&(r.length!==4||r[0]<0||s.data.width<r[0]||r[1]<0||s.data.height<r[1]||r[2]<0||s.data.width<r[2]||r[3]<0||s.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,s,u){u.version=this.images[s][r].version+1,this.images[s][r]=u,this.updatedImages[s][r]=!0}removeImage(r,s){const u=this.images[s][r];delete this.images[s][r],delete this.patterns[s][r],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(r){return Object.keys(this.images[r])}getImages(r,s,u){let f=!0;const m=!!this.loaded[s];if(!m)for(const x of r)this.images[s][x]||(f=!1);m||f?this._notify(r,s,u):this.requestors.push({ids:r,scope:s,callback:u})}getUpdatedImages(r){return this.updatedImages[r]}_notify(r,s,u){const f={};for(const m of r){this.images[s][m]||this.fire(new o.b("styleimagemissing",{id:m}));const x=this.images[s][m];x?f[m]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:o.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,f)}getPixelSize(r){const{width:s,height:u}=this.atlasImage[r];return{width:s,height:u}}getPattern(r,s){const u=this.patterns[s][r],f=this.getImage(r,s);if(!f)return null;if(u&&u.position.version===f.version)return u.position;if(u)u.position.version=f.version;else{const m={w:f.data.width+2,h:f.data.height+2,x:0,y:0},x=new o.I(m,f);this.patterns[s][r]={bin:m,position:x}}return this._updatePatternAtlas(s),this.patterns[s][r].position}bind(r,s){const u=r.gl;let f=this.atlasTexture[s];f?this.dirty&&(f.update(this.atlasImage[s]),this.dirty=!1):(f=new o.T(r,this.atlasImage[s],u.RGBA),this.atlasTexture[s]=f),f.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(r){const s=[];for(const x in this.patterns[r])s.push(this.patterns[r][x].bin);const{w:u,h:f}=o.p(s),m=this.atlasImage[r];m.resize({width:u||1,height:f||1});for(const x in this.patterns[r]){const{bin:b}=this.patterns[r][x],E=b.x+1,M=b.y+1,I=this.images[r][x].data,P=I.width,z=I.height;o.h.copy(I,m,{x:0,y:0},{x:E,y:M},{width:P,height:z}),o.h.copy(I,m,{x:0,y:z-1},{x:E,y:M-1},{width:P,height:1}),o.h.copy(I,m,{x:0,y:0},{x:E,y:M+z},{width:P,height:1}),o.h.copy(I,m,{x:P-1,y:0},{x:E-1,y:M},{width:1,height:z}),o.h.copy(I,m,{x:0,y:0},{x:E+P,y:M},{width:1,height:z})}this.dirty=!0}beginFrame(){for(const r in this.images)this.callbackDispatchedThisFrame[r]={}}dispatchRenderCallbacks(r,s){for(const u of r){if(this.callbackDispatchedThisFrame[s][u])continue;this.callbackDispatchedThisFrame[s][u]=!0;const f=this.images[s][u];br(f)&&this.updateImage(u,s,f)}}}class lt{constructor(r,s,u,f){this.message=(r?`${r}: `:"")+u,f&&(this.identifier=f),s!=null&&s.__line__&&(this.line=s.__line__)}}class Vi extends lt{}function Fi(c){const r=c.key,s=c.value,u=c.valueSpec||{},f=c.objectElementValidators||{},m=c.style,x=c.styleSpec;let b=[];const E=o.i(s);if(E!=="object")return[new lt(r,s,`object expected, ${E} found`)];for(const M in s){const I=M.split(".")[0];let P;f[I]?P=f[I]:u[I]?P=ft:f["*"]?P=f["*"]:u["*"]&&(P=ft),P?b=b.concat(P({key:(r&&`${r}.`)+M,value:s[M],valueSpec:u[I]||u["*"],style:m,styleSpec:x,object:s,objectKey:M},s)):b.push(new Vi(r,s[M],`unknown property "${M}"`))}for(const M in u)f[M]||u[M].required&&u[M].default===void 0&&s[M]===void 0&&b.push(new lt(r,s,`missing required property "${M}"`));return b}function zt(c){const r=c.value,s=c.valueSpec,u=c.style,f=c.styleSpec,m=c.key,x=c.arrayElementValidator||ft;if(o.i(r)!=="array")return[new lt(m,r,`array expected, ${o.i(r)} found`)];if(s.length&&r.length!==s.length)return[new lt(m,r,`array length ${s.length} expected, length ${r.length} found`)];if(s["min-length"]&&r.length<s["min-length"])return[new lt(m,r,`array length at least ${s["min-length"]} expected, length ${r.length} found`)];let b={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};f.$version<7&&(b.function=s.function),o.i(s.value)==="object"&&(b=s.value);let E=[];for(let M=0;M<r.length;M++)E=E.concat(x({array:r,arrayIndex:M,value:r[M],valueSpec:b,style:u,styleSpec:f,key:`${m}[${M}]`},!0));return E}function Mn(c){const r=c.key,s=c.value,u=c.valueSpec;let f=o.i(s);if(f==="number"&&s!=s&&(f="NaN"),f!=="number")return[new lt(r,s,`number expected, ${f} found`)];if("minimum"in u){let m=u.minimum;if(o.i(u.minimum)==="array"&&(m=u.minimum[c.arrayIndex]),s<m)return[new lt(r,s,`${s} is less than the minimum value ${m}`)]}if("maximum"in u){let m=u.maximum;if(o.i(u.maximum)==="array"&&(m=u.maximum[c.arrayIndex]),s>m)return[new lt(r,s,`${s} is greater than the maximum value ${m}`)]}return[]}function wn(c){const r=c.valueSpec,s=o.u(c.value.type);let u,f,m,x={};const b=s!=="categorical"&&c.value.property===void 0,E=!b,M=o.i(c.value.stops)==="array"&&o.i(c.value.stops[0])==="array"&&o.i(c.value.stops[0][0])==="object",I=Fi({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(O){if(s==="identity")return[new lt(O.key,O.value,'identity function may not have a "stops" property')];let j=[];const U=O.value;return j=j.concat(zt({key:O.key,value:U,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:P})),o.i(U)==="array"&&U.length===0&&j.push(new lt(O.key,U,"array must have at least one stop")),j},default:function(O){return ft({key:O.key,value:O.value,valueSpec:r,style:O.style,styleSpec:O.styleSpec})}}});return s==="identity"&&b&&I.push(new lt(c.key,c.value,'missing required property "property"')),s==="identity"||c.value.stops||I.push(new lt(c.key,c.value,'missing required property "stops"')),s==="exponential"&&c.valueSpec.expression&&!o.s(c.valueSpec)&&I.push(new lt(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(E&&!o.k(c.valueSpec)?I.push(new lt(c.key,c.value,"property functions not supported")):b&&!o.m(c.valueSpec)&&I.push(new lt(c.key,c.value,"zoom functions not supported"))),s!=="categorical"&&!M||c.value.property!==void 0||I.push(new lt(c.key,c.value,'"property" property is required')),I;function P(O){let j=[];const U=O.value,G=O.key;if(o.i(U)!=="array")return[new lt(G,U,`array expected, ${o.i(U)} found`)];if(U.length!==2)return[new lt(G,U,`array length 2 expected, length ${U.length} found`)];if(M){if(o.i(U[0])!=="object")return[new lt(G,U,`object expected, ${o.i(U[0])} found`)];if(U[0].zoom===void 0)return[new lt(G,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new lt(G,U,"object stop key must have value")];const F=o.u(U[0].zoom);if(typeof F!="number")return[new lt(G,U[0].zoom,"stop zoom values must be numbers")];if(m&&m>F)return[new lt(G,U[0].zoom,"stop zoom values must appear in ascending order")];F!==m&&(m=F,f=void 0,x={}),j=j.concat(Fi({key:`${G}[0]`,value:U[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:Mn,value:z}}))}else j=j.concat(z({key:`${G}[0]`,value:U[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},U));return o.n(o.o(U[1]))?j.concat([new lt(`${G}[1]`,U[1],"expressions are not allowed in function stops.")]):j.concat(ft({key:`${G}[1]`,value:U[1],valueSpec:r,style:O.style,styleSpec:O.styleSpec}))}function z(O,j){const U=o.i(O.value),G=o.u(O.value),F=O.value!==null?O.value:j;if(u){if(U!==u)return[new lt(O.key,F,`${U} stop domain type must match previous stop domain type ${u}`)]}else u=U;if(U!=="number"&&U!=="string"&&U!=="boolean"&&typeof G!="number"&&typeof G!="string"&&typeof G!="boolean")return[new lt(O.key,F,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&s!=="categorical"){let Z=`number expected, ${U} found`;return o.k(r)&&s===void 0&&(Z+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new lt(O.key,F,Z)]}return s!=="categorical"||U!=="number"||typeof G=="number"&&isFinite(G)&&Math.floor(G)===G?s!=="categorical"&&U==="number"&&typeof G=="number"&&typeof f=="number"&&f!==void 0&&G<f?[new lt(O.key,F,"stop domain values must appear in ascending order")]:(f=G,s==="categorical"&&G in x?[new lt(O.key,F,"stop domain values must be unique")]:(x[G]=!0,[])):[new lt(O.key,F,`integer expected, found ${String(G)}`)]}}function Wr(c){const r=(c.expressionContext==="property"?o.q:o.r)(o.o(c.value),c.valueSpec);if(r.result==="error")return r.value.map(u=>new lt(`${c.key}${u.key}`,c.value,u.message));const s=r.value.expression||r.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!s.outputDefined())return[new lt(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!o.t(s))return[new lt(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return dr(s,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!o.v(s,["zoom","feature-state"]))return[new lt(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!o.x(s))return[new lt(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function dr(c,r){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const f of r.valueSpec.expression.parameters)s.delete(f);if(s.size===0)return[];const u=[];return c instanceof o.C&&s.has(c.name)?[new lt(r.key,r.value,`["${c.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(c.eachChild(f=>{u.push(...dr(f,r))}),u)}function Nn(c){const r=c.key,s=c.value,u=c.valueSpec,f=[];return Array.isArray(u.values)?u.values.indexOf(o.u(s))===-1&&f.push(new lt(r,s,`expected one of [${u.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(u.values).indexOf(o.u(s))===-1&&f.push(new lt(r,s,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(s)} found`)),f}function Kn(c){return o.z(o.o(c.value))?Wr(o.j({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):Ps(c)}function Ps(c){const r=c.value,s=c.key;if(o.i(r)!=="array")return[new lt(s,r,`array expected, ${o.i(r)} found`)];const u=c.styleSpec;let f,m=[];if(r.length<1)return[new lt(s,r,"filter array must have at least 1 element")];switch(m=m.concat(Nn({key:`${s}[0]`,value:r[0],valueSpec:u.filter_operator,style:c.style,styleSpec:c.styleSpec})),o.u(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&o.u(r[1])==="$type"&&m.push(new lt(s,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&m.push(new lt(s,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(f=o.i(r[1]),f!=="string"&&m.push(new lt(`${s}[1]`,r[1],`string expected, ${f} found`)));for(let x=2;x<r.length;x++)f=o.i(r[x]),o.u(r[1])==="$type"?m=m.concat(Nn({key:`${s}[${x}]`,value:r[x],valueSpec:u.geometry_type,style:c.style,styleSpec:c.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&m.push(new lt(`${s}[${x}]`,r[x],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let x=1;x<r.length;x++)m=m.concat(Ps({key:`${s}[${x}]`,value:r[x],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":f=o.i(r[1]),r.length!==2?m.push(new lt(s,r,`filter array for "${r[0]}" operator must have 2 elements`)):f!=="string"&&m.push(new lt(`${s}[1]`,r[1],`string expected, ${f} found`))}return m}function Xr(c,r){const s=c.key,u=c.style,f=c.layer,m=c.styleSpec,x=c.value,b=c.objectKey,E=m[`${r}_${c.layerType}`];if(!E)return[];const M=b.match(/^(.*)-transition$/);if(r==="paint"&&M&&E[M[1]]&&E[M[1]].transition)return ft({key:s,value:x,valueSpec:m.transition,style:u,styleSpec:m});const I=c.valueSpec||E[b];if(!I)return[new Vi(s,x,`unknown property "${b}"`)];let P;if(o.i(x)==="string"&&o.k(I)&&!I.tokens&&(P=/^{([^}]+)}$/.exec(x))){const O=`\`{ "type": "identity", "property": ${P?JSON.stringify(P[1]):'"_"'} }\``;return[new lt(s,x,`"${b}" does not support interpolation syntax
Use an identity property function instead: ${O}.`)]}const z=[];if(c.layerType==="symbol")b!=="text-field"||!u||u.glyphs||u.imports||z.push(new lt(s,x,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&o.A(o.o(x))&&o.u(x.type)==="identity"&&z.push(new lt(s,x,'"text-font" does not support identity functions'));else if(c.layerType==="model"&&r==="paint"&&f&&f.layout&&f.layout.hasOwnProperty("model-id")&&o.k(I)&&(o.B(I)||o.m(I))){const O=o.q(o.o(x),I),j=O.value.expression||O.value._styleExpression.expression;j&&!o.v(j,["measure-light"])&&(b==="model-emissive-strength"&&o.x(j)&&o.t(j)||z.push(new lt(s,x,`${b} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return z.concat(ft({key:c.key,value:x,valueSpec:I,style:u,styleSpec:m,expressionContext:"property",propertyType:r,propertyKey:b}))}function it(c){return Xr(c,"paint")}function Wt(c){return Xr(c,"layout")}function Bt(c){let r=[];const s=c.value,u=c.key,f=c.style,m=c.styleSpec;s.type||s.ref||r.push(new lt(u,s,'either "type" or "ref" is required'));let x=o.u(s.type);const b=o.u(s.ref);if(s.id){const E=o.u(s.id);for(let M=0;M<c.arrayIndex;M++){const I=f.layers[M];o.u(I.id)===E&&r.push(new lt(u,s.id,`duplicate layer id "${s.id}", previously used at line ${I.id.__line__}`))}}if("ref"in s){let E;["type","source","source-layer","filter","layout"].forEach(M=>{M in s&&r.push(new lt(u,s[M],`"${M}" is prohibited for ref layers`))}),f.layers.forEach(M=>{o.u(M.id)===b&&(E=M)}),E?E.ref?r.push(new lt(u,s.ref,"ref cannot reference another ref layer")):x=o.u(E.type):typeof b=="string"&&r.push(new lt(u,s.ref,`ref layer "${b}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(s.source){const E=f.sources&&f.sources[s.source],M=E&&o.u(E.type);E?M==="vector"&&x==="raster"?r.push(new lt(u,s.source,`layer "${s.id}" requires a raster source`)):M==="raster"&&x!=="raster"?r.push(new lt(u,s.source,`layer "${s.id}" requires a vector source`)):M!=="vector"||s["source-layer"]?M==="raster-dem"&&x!=="hillshade"?r.push(new lt(u,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="raster-array"||["raster","raster-particle"].includes(x)?x!=="line"||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||M==="geojson"&&E.lineMetrics?x==="raster-particle"&&M!=="raster-array"&&r.push(new lt(u,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):r.push(new lt(u,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new lt(u,s.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new lt(u,s,`layer "${s.id}" must specify a "source-layer"`)):r.push(new lt(u,s.source,`source "${s.source}" not found`))}else r.push(new lt(u,s,'missing required property "source"'));return r=r.concat(Fi({key:u,value:s,valueSpec:m.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ft({key:`${u}.type`,value:s.type,valueSpec:m.layer.type,style:c.style,styleSpec:c.styleSpec,object:s,objectKey:"type"}),filter:E=>Kn(o.j({layerType:x},E)),layout:E=>Fi({layer:s,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":M=>Wt(o.j({layerType:x},M))}}),paint:E=>Fi({layer:s,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":M=>it(o.j({layerType:x,layer:s},M))}})}})),r}function qt(c){const r=c.value,s=c.key,u=o.i(r);return u!=="string"?[new lt(s,r,`string expected, ${u} found`)]:[]}const Ui={promoteId:function({key:c,value:r}){if(o.i(r)==="string")return qt({key:c,value:r});{const s=[];for(const u in r)s.push(...qt({key:`${c}.${u}`,value:r[u]}));return s}}};function tr(c){const r=c.value,s=c.key,u=c.styleSpec,f=c.style;if(!r.type)return[new lt(s,r,'"type" is required')];const m=o.u(r.type);let x=[];switch(["vector","raster","raster-dem","raster-array"].includes(m)&&(r.url||r.tiles||x.push(new Vi(s,r,'Either "url" or "tiles" is required.'))),m){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(Fi({key:s,value:r,valueSpec:u[`source_${m.replace("-","_")}`],style:c.style,styleSpec:u,objectElementValidators:Ui})),x;case"geojson":if(x=Fi({key:s,value:r,valueSpec:u.source_geojson,style:f,styleSpec:u,objectElementValidators:Ui}),r.cluster)for(const b in r.clusterProperties){const[E,M]=r.clusterProperties[b],I=typeof E=="string"?[E,["accumulated"],["get",b]]:E;x.push(...Wr({key:`${s}.${b}.map`,value:M,expressionContext:"cluster-map"})),x.push(...Wr({key:`${s}.${b}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return x;case"video":return Fi({key:s,value:r,valueSpec:u.source_video,style:f,styleSpec:u});case"image":return Fi({key:s,value:r,valueSpec:u.source_image,style:f,styleSpec:u});case"canvas":return[new lt(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Nn({key:`${s}.type`,value:r.type,valueSpec:{values:de(u)},style:f,styleSpec:u})}}function de(c){return c.source.reduce((r,s)=>{const u=c[s];return u.type.type==="enum"&&(r=r.concat(Object.keys(u.type.values))),r},[])}function pe(c){const r=c.value;let s=[];if(!r)return s;const u=o.i(r);return u!=="string"?(s=s.concat([new lt(c.key,r,`string expected, "${u}" found`)]),s):(function(f){const m=f.indexOf("://")===-1;try{return new URL(f,m?"http://example.com":void 0),!0}catch{return!1}}(r)||(s=s.concat([new lt(c.key,r,`invalid url "${r}"`)])),s)}function Be(c){const r=c.value,s=c.styleSpec,u=s.light,f=c.style;let m=[];const x=o.i(r);if(r===void 0)return m;if(x!=="object")return m=m.concat([new lt("light",r,`object expected, ${x} found`)]),m;for(const b in r){const E=b.match(/^(.*)-transition$/);m=m.concat(E&&u[E[1]]&&u[E[1]].transition?ft({key:b,value:r[b],valueSpec:s.transition,style:f,styleSpec:s}):u[b]?ft({key:b,value:r[b],valueSpec:u[b],style:f,styleSpec:s}):[new lt(b,r[b],`unknown property "${b}"`)])}return m}function ot(c){const r=c.value;let s=[];if(!r)return s;const u=o.i(r);if(u!=="object")return s=s.concat([new lt("light-3d",r,`object expected, ${u} found`)]),s;const f=c.styleSpec,m=f["light-3d"],x=c.key,b=c.style,E=c.style.lights;for(const P of["type","id"])if(!(P in r))return s=s.concat([new lt("light-3d",r,`missing property ${P} on light`)]),s;if(r.type&&E)for(let P=0;P<c.arrayIndex;P++){const z=o.u(r.type),O=E[P];o.u(O.type)===z&&s.push(new lt(x,r.id,`duplicate light type "${r.type}", previously defined at line ${O.id.__line__}`))}const M=`properties_light_${r.type}`;if(!(M in f))return s=s.concat([new lt("light-3d",r,`Invalid light type ${r.type}`)]),s;const I=f[M];for(const P in r)if(P==="properties"){const z=r[P],O=o.i(z);if(O!=="object")return s=s.concat([new lt("properties",z,`object expected, ${O} found`)]),s;for(const j in z)s=s.concat(I[j]?ft({key:j,value:z[j],valueSpec:I[j],style:b,styleSpec:f}):[new Vi(c.key,z[j],`unknown property "${j}"`)])}else{const z=P.match(/^(.*)-transition$/);s=s.concat(z&&m[z[1]]&&m[z[1]].transition?ft({key:P,value:r[P],valueSpec:f.transition,style:b,styleSpec:f}):m[P]?ft({key:P,value:r[P],valueSpec:m[P],style:b,styleSpec:f}):[new Vi(P,r[P],`unknown property "${P}"`)])}return s}function Ke(c){const r=c.value,s=c.key,u=c.style,f=c.styleSpec,m=f.terrain;let x=[];const b=o.i(r);if(r===void 0||b==="null")return x;if(b!=="object")return x=x.concat([new lt("terrain",r,`object expected, ${b} found`)]),x;for(const E in r){const M=E.match(/^(.*)-transition$/);x=x.concat(M&&m[M[1]]&&m[M[1]].transition?ft({key:E,value:r[E],valueSpec:f.transition,style:u,styleSpec:f}):m[E]?ft({key:E,value:r[E],valueSpec:m[E],style:u,styleSpec:f}):[new Vi(E,r[E],`unknown property "${E}"`)])}if(r.source){const E=u.sources&&u.sources[r.source],M=E&&o.u(E.type);E?M!=="raster-dem"&&x.push(new lt(s,r.source,`terrain cannot be used with a source of type ${String(M)}, it only be used with a "raster-dem" source type`)):x.push(new lt(s,r.source,`source "${r.source}" not found`))}else x.push(new lt(s,r,'terrain is missing required property "source"'));return x}function Tt(c){const r=c.value,s=c.style,u=c.styleSpec,f=u.fog;let m=[];const x=o.i(r);if(r===void 0)return m;if(x!=="object")return m=m.concat([new lt("fog",r,`object expected, ${x} found`)]),m;for(const b in r){const E=b.match(/^(.*)-transition$/);m=m.concat(E&&f[E[1]]&&f[E[1]].transition?ft({key:b,value:r[b],valueSpec:u.transition,style:s,styleSpec:u}):f[b]?ft({key:b,value:r[b],valueSpec:f[b],style:s,styleSpec:u}):[new Vi(b,r[b],`unknown property "${b}"`)])}return m}const Vt={"*":()=>[],array:zt,boolean:function(c){const r=c.value,s=c.key,u=o.i(r);return u!=="boolean"?[new lt(s,r,`boolean expected, ${u} found`)]:[]},number:Mn,color:function(c){const r=c.key,s=c.value,u=o.i(s);return u!=="string"?[new lt(r,s,`color expected, ${u} found`)]:o.y(s)===null?[new lt(r,s,`color expected, "${s}" found`)]:[]},enum:Nn,filter:Kn,function:wn,layer:Bt,object:Fi,source:tr,model:pe,light:Be,"light-3d":ot,terrain:Ke,fog:Tt,string:qt,formatted:function(c){return qt(c).length===0?[]:Wr(c)},resolvedImage:function(c){return qt(c).length===0?[]:Wr(c)},projection:function(c){const r=c.value,s=c.styleSpec,u=s.projection,f=c.style;let m=[];const x=o.i(r);if(x==="object")for(const b in r)m=m.concat(ft({key:b,value:r[b],valueSpec:u[b],style:f,styleSpec:s}));else x!=="string"&&(m=m.concat([new lt("projection",r,`object or string expected, ${x} found`)]));return m},import:function(c){const{value:r,styleSpec:s}=c,{data:u,...f}=r;Object.defineProperty(f,"__line__",{value:r.__line__,enumerable:!1});let m=Fi(o.j({},c,{value:f,valueSpec:s.import}));return o.u(f.id)===""&&m.push(new lt(`${c.key}.id`,f,"import id can't be an empty string")),u&&(m=m.concat(gt(u,s,{key:`${c.key}.data`}))),m}};function ft(c,r=!1){const s=c.value,u=c.valueSpec,f=c.styleSpec;if(u.expression&&o.A(o.u(s)))return wn(c);if(u.expression&&o.n(o.o(s)))return Wr(c);if(u.type&&Vt[u.type]){const m=Vt[u.type](c);return r===!0&&m.length>0&&o.i(c.value)==="array"?Wr(c):m}return Fi(o.j({},c,{valueSpec:u.type?f[u.type]:u}))}function Lt(c){const r=c.value,s=c.key,u=qt(c);return u.length||(r.indexOf("{fontstack}")===-1&&u.push(new lt(s,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&u.push(new lt(s,r,'"glyphs" url must include a "{range}" token'))),u}function gt(c,r=o.D,s={}){return ft({key:s.key||"",value:c,valueSpec:r.$root,styleSpec:r,style:c,objectElementValidators:{glyphs:Lt,"*":()=>[]}})}function jt(c,r=o.D){return ke(gt(c,r))}const si=c=>ke(tr(c)),ei=c=>ke(Be(c)),we=c=>ke(ot(c)),q=c=>ke(Ke(c)),te=c=>ke(Tt(c)),ue=c=>ke(Bt(c)),Ce=c=>ke(Kn(c)),Oe=c=>ke(it(c)),Xe=c=>ke(Wt(c)),St=c=>ke(pe(c));function ke(c){return c.slice().sort((r,s)=>r.line&&s.line?r.line-s.line:0)}function It(c,r){let s=!1;if(r&&r.length)for(const u of r)u instanceof Vi?o.w(u.message):(c.fire(new o.a(new Error(u.message))),s=!0);return s}const ht=new o.F({anchor:new o.G(o.D.light.anchor),position:new o.H(o.D.light.position),color:new o.G(o.D.light.color),intensity:new o.G(o.D.light.intensity)});class bt extends o.E{constructor(r,s="flat"){super(),this._transitionable=new o.J(ht),this.setLight(r,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,s,u={}){this._validate(ei,r,u)||(this._transitionable.setTransitionOrValue(r),this.id=s)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,s,u){return(!u||u.validate!==!1)&&It(this,r.call(jt,o.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.D})))}}const fi=new o.F({source:new o.G(o.D.terrain.source),exaggeration:new o.G(o.D.terrain.exaggeration)});let sr=class extends o.E{constructor(c,r,s,u){super(),this.scope=s,this._transitionable=new o.J(fi,s,u),this._transitionable.setTransitionOrValue(c,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(c,r){this._transitionable.setTransitionOrValue(c,r)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}getExaggeration(c){return this._transitioning.possiblyEvaluate(new o.K(c)).get("exaggeration")}isZoomDependent(){const c=this._transitionable._values.exaggeration;return c!=null&&c.value!=null&&c.value.expression!=null&&c.value.expression instanceof o.Z}};const wr=45,or=65,Yi=.05;function $i(c,r,s,u){const f=o.O(wr,or,s),[m,x]=ir(c,u);let b=1-Math.min(1,Math.exp((r-m)/(x-m)*-6));return b*=b*b,b=Math.min(1,1.00747*b),b*f*c.alpha}function ir(c,r){const s=.5/Math.tan(.5*r);return[c.range[0]+s,c.range[1]+s]}function fr(c,r,s,u,f){const m=o.N.transformMat4([],[r,s,u],f.mercatorFogMatrix);return $i(c,o.N.length(m),f.pitch,f._fov)}function nn(c,r,s,u,f,m,x){const b=[[s,u,0],[f,u,0],[f,m,0],[s,m,0]];let E=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(const I of b){const P=o.N.transformMat4([],I,r),z=o.N.length(P);E=Math.min(E,z),M=Math.max(M,z)}return[$i(c,E,x.pitch,x._fov),$i(c,M,x.pitch,x._fov)]}const gr=new o.F({range:new o.G(o.D.fog.range),color:new o.G(o.D.fog.color),"high-color":new o.G(o.D.fog["high-color"]),"space-color":new o.G(o.D.fog["space-color"]),"horizon-blend":new o.G(o.D.fog["horizon-blend"]),"star-intensity":new o.G(o.D.fog["star-intensity"]),"vertical-range":new o.G(o.D.fog["vertical-range"])});class Ln extends o.E{constructor(r,s,u,f){super(),this._transitionable=new o.J(gr,u,new Map(f)),this.set(r,f),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new o.Q(gr)}get state(){const r=this._transform,s=r.projection.name==="globe",u=o.S(r.zoom),f=this.properties.get("range"),m=[.5,3];return{range:s?[o.U(m[0],f[0],u),o.U(m[1],f[1],u)]:f,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,s,u={}){if(this._validate(te,r,u))return;const f=o.e({},r);for(const m of Object.keys(o.D.fog))f[m]===void 0&&(f[m]=o.D.fog[m].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.O(wr,or,r))*s.a}getOpacityAtLatLng(r,s){return this._transform.projection.supportsFog?function(u,f,m){const x=o.L.fromLngLat(f),b=m.elevation?m.elevation.getAtPointOrZero(x):0;return fr(u,x.x,x.y,b,m)}(this.state,r,s):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(r.toUnwrapped());return nn(this.state,s,0,0,o.V,o.V,this._transform)}getOpacityForBounds(r,s,u,f,m){return this._transform.projection.supportsFog?nn(this.state,r,s,u,f,m,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?ir(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const u of s){const f=r.points[u];let m;if(f[2]>=0)m=f;else{const x=r.points[u-4];m=o.W(x,f,x[2]/(x[2]-f[2]))}if(fr(this.state,m[0],m[1],0,this._transform)>=Yi)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,s,u){return(!u||u.validate!==!1)&&It(this,r.call(jt,o.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.D})))}}class In extends o.E{constructor(r,s,u,f){super(),this.scope=u,this._options=r,this.properties=new o.Q(s),this._transitionable=new o.J(s,u,new Map(f)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,s){this._options=r,this._transitionable.setTransitionOrValue(r.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const Vn=new o.F({color:new o.G(o.D.properties_light_ambient.color),intensity:new o.G(o.D.properties_light_ambient.intensity)}),Yr=new o.F({direction:new o.X(o.D.properties_light_directional.direction),color:new o.G(o.D.properties_light_directional.color),intensity:new o.G(o.D.properties_light_directional.intensity),"cast-shadows":new o.G(o.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new o.G(o.D.properties_light_directional["shadow-intensity"])});class Gr{constructor(r,s,u,f){this.screenBounds=r,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(r,s){let u,f;if(r instanceof o.P||typeof r[0]=="number"){const m=o.P.convert(r);u=[m],f=s.isPointAboveHorizon(m)}else{const m=o.P.convert(r[0]),x=o.P.convert(r[1]);u=[m,x],f=o.Y(m,x).every(b=>s.isPointAboveHorizon(b))}return new Gr(u,s.getCameraPoint(),f,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.Y(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const s=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],f=o.Y(s,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<u.x?f.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?f[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(f[3]=this.cameraPoint)),o._(f,r)}bufferedCameraGeometryGlobe(r){const s=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],f=o.Y(s,u,r),m=this.cameraPoint.clone();switch(3*((m.y>s.y)+(m.y>u.y))+((m.x>s.x)+(m.x>u.x))){case 0:f[0]=m,f[4]=m.clone();break;case 1:f.splice(1,0,m);break;case 2:f[1]=m;break;case 3:f.splice(4,0,m);break;case 5:f.splice(2,0,m);break;case 6:f[3]=m;break;case 7:f.splice(3,0,m);break;case 8:f[2]=m}return f}containsTile(r,s,u,f=0){const m=r.queryPadding/s._pixelsPerMercatorPixel+1,x=u?this._bufferedCameraMercator(m,s):this._bufferedScreenMercator(m,s);let b=r.tileID.wrap+(x.unwrapped?f:0);const E=x.polygon.map(G=>o.$(r.tileTransform,G,b));if(!o.a0(E,0,0,o.V,o.V))return;b=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?f:0);const M=this.screenGeometryMercator.polygon.map(G=>o.a1(r.tileTransform,G,b)),I=M.map(G=>new o.P(G[0],G[1])),P=s.getFreeCameraOptions().position||new o.L(0,0,0),z=o.a1(r.tileTransform,P,b),O=M.map(G=>{const F=o.N.sub(G,G,z);return o.N.normalize(F,F),new o.a2(z,F)}),j=o.a3(r,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:I,tilespaceRays:O,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(U=o.a4(E),U.min.x=o.aa(U.min.x,0,o.V),U.min.y=o.aa(U.min.y,0,o.V),U.max.x=o.aa(U.max.x,0,o.V),U.max.y=o.aa(U.max.y,0,o.V),U),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:j};var U}_bufferedScreenMercator(r,s){const u=Ye(r);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let f;return f=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),s):{polygon:this.bufferedScreenGeometry(r).map(m=>s.pointCoordinate3D(m)),unwrapped:!0},this._screenRaycastCache[u]=f,f}}_bufferedCameraMercator(r,s){const u=Ye(r);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let f;return f=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),s):{polygon:this.bufferedCameraGeometry(r).map(m=>s.pointCoordinate3D(m)),unwrapped:!0},this._cameraRaycastCache[u]=f,f}}_projectAndResample(r,s){const u=function(m,x){const b=o.a6.multiply([],x.pixelMatrix,x.globeMatrix),E=[0,-o.ab,0,1],M=[0,o.ab,0,1],I=[0,0,0,1];o.a7.transformMat4(E,E,b),o.a7.transformMat4(M,M,b),o.a7.transformMat4(I,I,b);const P=new o.P(E[0]/E[3],E[1]/E[3]),z=new o.P(M[0]/M[3],M[1]/M[3]),O=o.a8(m,P)&&E[3]<I[3],j=o.a8(m,z)&&M[3]<I[3];if(!O&&!j)return null;const U=function(ee,ae,le){for(let fe=1;fe<ee.length;fe++){const Te=Fe(ae.pointCoordinate3D(ee[fe-1]).x),_e=Fe(ae.pointCoordinate3D(ee[fe]).x);if(le<0){if(Te<_e)return{idx:fe,t:-Te/(_e-1-Te)}}else if(_e<Te)return{idx:fe,t:(1-Te)/(_e+1-Te)}}return null}(m,x,O?-1:1);if(!U)return null;const{idx:G,t:F}=U;let Z=G>1?ze(m.slice(0,G),x):[],J=G<m.length?ze(m.slice(G),x):[];Z=Z.map(ee=>new o.P(Fe(ee.x),ee.y)),J=J.map(ee=>new o.P(Fe(ee.x),ee.y));const W=[...Z];W.length===0&&W.push(J[J.length-1]);const Q=o.U(W[W.length-1].y,(J.length===0?Z[0]:J[0]).y,F);let $;return $=O?[new o.P(0,Q),new o.P(0,0),new o.P(1,0),new o.P(1,Q)]:[new o.P(1,Q),new o.P(1,1),new o.P(0,1),new o.P(0,Q)],W.push(...$),J.length===0?W.push(Z[0]):W.push(...J),{polygon:W.map(ee=>new o.L(ee.x,ee.y)),unwrapped:!1}}(r,s);if(u)return u;const f=function(m,x){let b=!1,E=-1/0,M=0;for(let P=0;P<m.length-1;P++)m[P].x>E&&(E=m[P].x,M=P);for(let P=0;P<m.length-1;P++){const z=(M+P)%(m.length-1),O=m[z],j=m[z+1];Math.abs(O.x-j.x)>.5&&(O.x<j.x?(O.x+=1,z===0&&(m[m.length-1].x+=1)):(j.x+=1,z+1===m.length-1&&(m[0].x+=1)),b=!0)}const I=o.a5(x.center.lng);return b&&I<Math.abs(I-1)&&m.forEach(P=>{P.x-=1}),{polygon:m,unwrapped:b}}(ze(r,s).map(m=>new o.P(Fe(m.x),m.y)),s);return{polygon:f.polygon.map(m=>new o.L(m.x,m.y)),unwrapped:f.unwrapped}}}function ze(c,r){return o.a9(c,s=>{const u=r.pointCoordinate3D(s);s.x=u.x,s.y=u.y},1/256)}function Fe(c){return c<0?1+c%1:c%1}function Ye(c){return 100*c|0}function st(c,r,s,u,f){const m=function(x,b){if(x)return f(x);if(b){c.url&&b.tiles&&c.tiles&&delete c.tiles;const E=o.ac(o.e(b,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(E.vectorLayers=b.vector_layers,E.vectorLayerIds=E.vectorLayers.map(M=>M.id)),b.raster_layers&&(E.rasterLayers=b.raster_layers,E.rasterLayerIds=E.rasterLayers.map(M=>M.id)),E.tiles=r.canonicalizeTileset(E,c.url),f(null,E)}};return c.url?o.g(r.transformRequest(r.normalizeSourceURL(c.url,null,s,u),o.R.Source),m):o.f.frame(()=>m(null,c))}class et{constructor(r,s,u){this.bounds=o.ad.convert(this.validateBounds(r)),this.minzoom=s||0,this.maxzoom=u||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const s=Math.pow(2,r.z),u=Math.floor(o.a5(this.bounds.getWest())*s),f=Math.floor(o.ae(this.bounds.getNorth())*s),m=Math.ceil(o.a5(this.bounds.getEast())*s),x=Math.ceil(o.ae(this.bounds.getSouth())*s);return r.x>=u&&r.x<m&&r.y>=f&&r.y<x}}class pt extends o.E{constructor(r,s,u,f){if(super(),this.id=r,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.ac(s,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f),this._tileWorkers={},this._deduped=new o.af}load(r){this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map._worldview;this._tileJSONRequest=st(this._options,this.map._requestManager,s,u,(f,m)=>{this._tileJSONRequest=null,this._loaded=!0,f?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new o.a(f))):m&&(o.e(this,m),m.bounds&&(this.tileBounds=new et(m.bounds,this.minzoom,this.maxzoom)),o.aj(m.tiles,this.map._requestManager._customAccessToken),this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))),r&&r(f)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=o.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.e({},this._options)}loadTile(r,s){const u=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(u,o.R.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster};if(f.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=s:r.request=r.actor.send("reloadTile",f,m.bind(this));else if(r.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",f,m.bind(this),void 0,!0);else{const x=o.ah.call({deduped:this._deduped},f,(b,E)=>{b||!E?m.call(this,b):(f.data={cacheControl:E.cacheControl,expires:E.expires,rawData:E.rawData.slice(0)},r.actor&&r.actor.send("loadTile",f,m.bind(this),void 0,!0))},!0);r.request={cancel:x}}function m(x,b){return delete r.request,r.aborted?s(null):x&&x.status!==404?s(x):(b&&b.resourceTiming&&(r.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&b&&r.setExpiryData(b),r.loadVectorData(b,this.map.painter),o.ai(this.dispatcher),s(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class mt extends o.E{constructor(r,s,u,f){super(),this.id=r,this.dispatcher=u,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},s),o.e(this,o.ac(s,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"})),this._tileJSONRequest=st(this._options,this.map._requestManager,null,null,(s,u)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new o.a(s)):u&&(o.e(this,u),u.bounds&&(this.tileBounds=new et(u.bounds,this.minzoom,this.maxzoom)),o.aj(u.tiles),this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))),r&&r(s)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=o.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,s){const u=o.f.devicePixelRatio>=2,f=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);r.request=o.d(this.map._requestManager.transformRequest(f,o.R.Tile),(m,x,b,E)=>(delete r.request,r.aborted?(r.state="unloaded",s(null)):m?(r.state="errored",s(m)):x?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:b,expires:E}),r.setTexture(x,this.map.painter),r.state="loaded",o.ai(this.dispatcher),void s(null)):s(null)))}abortTile(r,s){r.request&&(r.request.cancel(),delete r.request),s()}unloadTile(r,s){r.texture&&r.texture instanceof o.T?(r.destroy(!0),r.texture&&r.texture instanceof o.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class rt extends mt{constructor(r,s,u,f){super(r,s,u,f),this.type="raster-array",this.maxzoom=22,this._options=o.e({type:"raster-array"},s)}triggerRepaint(r){const s=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);s&&s.enabled&&u&&s._clearRenderCacheForTile(u.id,r.tileID),this.map.triggerRepaint()}loadTile(r,s){const u=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),f=this.map._requestManager.transformRequest(u,o.R.Tile);r.requestParams=f,r.actor||(r.actor=this.dispatcher.getActor()),r.request=r.fetchHeader(void 0,(m,x,b,E)=>{if(delete r.request,r.aborted)return r.state="unloaded",s(null);if(m)return m.code===20?void 0:(r.state="errored",s(m));this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:b,expires:E}),r.state="empty",s(null)})}unloadTile(r){const s=r.texture;s&&s instanceof o.T?(r.destroy(!0),this.map.painter.saveTileTexture(s)):(r.destroy(),r.flushQueues(),r._isHeaderLoaded=!1,delete r._mrt,delete r.textureDescriptor),r.fbo&&(r.fbo.destroy(),delete r.fbo),delete r.request,delete r.requestParams,delete r.neighboringTiles,r.state="unloaded"}prepareTile(r,s,u){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBand(s,u,(f,m)=>{if(f)return r.state="errored",this.fire(new o.a(f)),void this.triggerRepaint(r);m&&(r.setTexture(m,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:m})=>m===r),u=s&&s.fields,f=u&&u.bands&&u.bands;return f?f[0]:0}getTextureDescriptor(r,s,u){if(!r)return;const f=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!f)return;let m=null;s instanceof o.an?m=s.paint.get("raster-array-band"):s instanceof o.ao&&(m=s.paint.get("raster-particle-array-band"));const x=m||this.getInitialBand(f);if(x!=null)if(r.textureDescriptor){if(!r.updateNeeded(f,x)||u)return Object.assign({},r.textureDescriptor,{texture:r.texture})}else this.prepareTile(r,f,x)}}const yt=32,ct=33,Kt=new Uint16Array(8184);for(let c=0;c<2046;c++){let r=c+2,s=0,u=0,f=0,m=0,x=0,b=0;for(1&r?f=m=x=yt:s=u=b=yt;(r>>=1)>1;){const M=s+f>>1,I=u+m>>1;1&r?(f=s,m=u,s=x,u=b):(s=f,u=m,f=x,m=b),x=M,b=I}const E=4*c;Kt[E+0]=s,Kt[E+1]=u,Kt[E+2]=f,Kt[E+3]=m}const Ei=new Uint16Array(2178),Ot=new Uint8Array(1089),ar=new Uint16Array(1089);function Ar(c){return c===0?-.03125:c===32?.03125:0}class hr{constructor(r,s,u,f){this.id=hr.uniqueIdxCounter,hr.uniqueIdxCounter++,this.context=r;const m=r.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||f||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=hr.uniqueIdxCounter,hr.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}hr.uniqueIdxCounter=0;const Kr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class mn{constructor(r,s,u,f,m,x){this.length=s.length,this.attributes=u,this.itemSize=s.bytesPerElement,this.dynamicDraw=f,this.instanceCount=x,this.context=r;const b=r.gl;this.buffer=b.createBuffer(),r.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||m||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,s){for(let u=0;u<this.attributes.length;u++){const f=s.attributes[this.attributes[u].name];f!==void 0&&r.enableVertexAttribArray(f)}}setVertexAttribPointers(r,s,u){for(let f=0;f<this.attributes.length;f++){const m=this.attributes[f],x=s.attributes[m.name];x!==void 0&&r.vertexAttribPointer(x,m.components,r[Kr[m.type]],!1,this.itemSize,m.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(r,s,u){for(let f=0;f<this.attributes.length;f++){const m=s.attributes[this.attributes[f].name];m!==void 0&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(m,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ji{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jn extends ji{getDefault(){return o.ax.transparent}set(r){const s=this.current;(r.r!==s.r||r.g!==s.g||r.b!==s.b||r.a!==s.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class _s extends ji{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class _n extends ji{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class dl extends ji{getDefault(){return[!0,!0,!0,!0]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class lo extends ji{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class fa extends ji{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Nu extends ji{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const s=this.current;(r.func!==s.func||r.ref!==s.ref||r.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Vo extends ji{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Vu extends ji{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=r,this.dirty=!1}}class pa extends ji{getDefault(){return[0,1]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class df extends ji{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=r,this.dirty=!1}}class xc extends ji{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Uu extends ji{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.BLEND):s.disable(s.BLEND),this.current=r,this.dirty=!1}}class vc extends ji{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class ju extends ji{getDefault(){return o.ax.transparent}set(r){const s=this.current;(r.r!==s.r||r.g!==s.g||r.b!==s.b||r.a!==s.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Un extends ji{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class $r extends ji{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=r,this.dirty=!1}}class Si extends ji{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class ff extends ji{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let bc=class extends ji{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}};class Gu extends ji{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class r_ extends ji{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Rs extends ji{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class $u extends ji{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class n_ extends ji{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class ma extends ji{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class vt extends ji{getDefault(){return null}set(r){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class qi extends ji{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class Zi extends ji{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class os extends ji{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class _a extends ji{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Ri extends ji{constructor(r,s){super(r),this.context=r,this.parent=s}getDefault(){return null}}class wc extends Ri{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class ga extends Ri{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class fl extends Ri{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class jn extends ga{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Vr{constructor(r,s,u,f,m){this.context=r,this.width=s,this.height=u;const x=this.framebuffer=r.gl.createFramebuffer();f&&(this.colorAttachment=new wc(r,x)),m&&(this.depthAttachmentType=m,this.depthAttachment=m==="renderbuffer"?new ga(r,x):new fl(r,x))}destroy(){const r=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&r.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&r.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&r.deleteTexture(s)}r.deleteFramebuffer(this.framebuffer)}}class Zt{constructor(r,s,u){this.func=r,this.mask=s,this.range=u}}Zt.ReadOnly=!1,Zt.ReadWrite=!0,Zt.disabled=new Zt(519,Zt.ReadOnly,[0,1]);const Uo=7680;class ti{constructor(r,s,u,f,m,x){this.test=r,this.ref=s,this.mask=u,this.fail=f,this.depthFail=m,this.pass=x}}ti.disabled=new ti({func:519,mask:0},0,0,Uo,Uo,Uo);const co=771;class gi{constructor(r,s,u,f){this.blendFunction=r,this.blendColor=s,this.mask=u,this.blendEquation=f}}gi.Replace=[1,0,1,0],gi.disabled=new gi(gi.Replace,o.ax.transparent,[!1,!1,!1,!1]),gi.unblended=new gi(gi.Replace,o.ax.transparent,[!0,!0,!0,!0]),gi.alphaBlended=new gi([1,co,1,co],o.ax.transparent,[!0,!0,!0,!0]),gi.multiply=new gi([774,0,774,0],o.ax.transparent,[!0,!0,!0,!0]);const ya=1029,gn=2305;class Ht{constructor(r,s,u){this.enable=r,this.mode=s,this.frontFace=u}}Ht.disabled=new Ht(!1,ya,gn),Ht.backCCW=new Ht(!0,ya,gn),Ht.backCW=new Ht(!0,ya,2304),Ht.frontCW=new Ht(!0,1028,2304),Ht.frontCCW=new Ht(!0,1028,gn);class pf{constructor(r,s){this.gl=r,this.clearColor=new Jn(this),this.clearDepth=new _s(this),this.clearStencil=new _n(this),this.colorMask=new dl(this),this.depthMask=new lo(this),this.stencilMask=new fa(this),this.stencilFunc=new Nu(this),this.stencilOp=new Vo(this),this.stencilTest=new Vu(this),this.depthRange=new pa(this),this.depthTest=new df(this),this.depthFunc=new xc(this),this.blend=new Uu(this),this.blendFunc=new vc(this),this.blendColor=new ju(this),this.blendEquation=new Un(this),this.cullFace=new $r(this),this.cullFaceSide=new Si(this),this.frontFace=new ff(this),this.program=new bc(this),this.activeTexture=new Gu(this),this.viewport=new r_(this),this.bindFramebuffer=new Rs(this),this.bindRenderbuffer=new $u(this),this.bindTexture=new n_(this),this.bindVertexBuffer=new ma(this),this.bindElementBuffer=new vt(this),this.bindVertexArrayOES=new qi(this),this.pixelStoreUnpack=new Zi(this),this.pixelStoreUnpackPremultiplyAlpha=new os(this),this.pixelStoreUnpackFlipY=new _a(this),this.options=s?{...s}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,s,u){return new hr(this,r,s,u)}createVertexBuffer(r,s,u,f,m){return new mn(this,r,s,u,f,m)}createRenderbuffer(r,s,u){const f=this.gl,m=f.createRenderbuffer();return this.bindRenderbuffer.set(m),f.renderbufferStorage(f.RENDERBUFFER,r,s,u),this.bindRenderbuffer.set(null),m}createFramebuffer(r,s,u,f){return new Vr(this,r,s,u,f)}clear({color:r,depth:s,stencil:u,colorMask:f}){const m=this.gl;let x=0;r&&(x|=m.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set(f||[!0,!0,!0,!0])),s!==void 0&&(x|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),u!==void 0&&(x|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),m.clear(x)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){re(r.blendFunction,gi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var jo=o.ay([{name:"a_pos",type:"Float32",components:3}]);class Jr{constructor(r,s,u,f){const m={width:u[0],height:u[1],data:null},x=r.gl;this.targetColorTexture=new o.T(r,m,x.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new o.T(r,m,x.RGBA,{useMipmap:!1}),this.context=r,this.setNumParticles(s,f),this.lastInvalidatedAt=0}setNumParticles(r,s){if(this.numParticles===s)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());const u=new o.az;u.reserve(Math.round(s));const f=o.aA(r.key);for(let m=0;m<s;m++)u.emplaceBack(f(),f(),f());this.particleVertices0=this.context.createVertexBuffer(u,jo.members,!0),this.particleVertices1=this.context.createVertexBuffer(u,jo.members,!0),this.particleSegment=o.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=s}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=o.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}const as={type:2,extent:o.V,loadGeometry:()=>[[new o.P(0,0),new o.P(o.V+1,0),new o.P(o.V+1,o.V+1),new o.P(0,o.V+1),new o.P(0,0)]]};class uo{constructor(r,s,u,f,m){this.tileID=r,this.uid=o.aC(),this.uses=0,this.tileSize=s,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,f&&f.style&&(this._lastUpdatedBrightness=f.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(r){const s=r+this.timeAdded;s<o.f.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,s,u){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(f,m){const x={};if(!m)return x;for(const b of f){const E=b.layerIds.map(M=>m.getLayer(M)).filter(Boolean);if(E.length!==0){b.layers=E,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(M=>E.filter(I=>I.id===M)[0]));for(const M of E)x[M.fqid]=b}}return x}(r.buckets,s.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const m=this.buckets[f];if(m instanceof o.aE){if(this.hasSymbolBuckets=!0,!u)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const m=this.buckets[f];if(m instanceof o.aE&&m.hasRTLText){this.hasRTLText=!0,o.aF();break}}this.queryPadding=0;for(const f in this.buckets){const m=this.buckets[f],x=s.style.getOwnLayer(f);if(!x)continue;const b=x.queryRadius(m);this.queryPadding=Math.max(this.queryPadding,b)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new o.aD}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.fqid]}upload(r){for(const f in this.buckets){const m=this.buckets[f];m.uploadPending()&&m.upload(r)}const s=r.gl,u=this.imageAtlas;if(u&&!u.uploaded){const f=!!Object.keys(u.patternPositions).length;this.imageAtlasTexture=new o.T(r,u.image,s.RGBA,{useMipmap:f}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(r,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(r,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(r,s,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,u),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const f=s.style.getBrightness();(this._lastUpdatedBrightness||f)&&(this._lastUpdatedBrightness&&f&&Math.abs(this._lastUpdatedBrightness-f)<.001||(this._lastUpdatedBrightness=f,this.updateBuckets(void 0,s)))}queryRenderedFeatures(r,s,u,f,m,x,b,E){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:b,transform:x,params:m,tileTransform:this.tileTransform},r,s,u):{}}querySourceFeatures(r,s){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const f=u.loadVTLayers(),m=s?s.sourceLayer:"",x=f._geojsonTileLayer||f[m];if(!x)return;const b=o.aG(s&&s.filter),{z:E,x:M,y:I}=this.tileID.canonical,P={z:E,x:M,y:I};for(let z=0;z<x.length;z++){const O=x.feature(z);if(b.needGeometry){const G=o.aH(O,!0);if(!b.filter(new o.K(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!b.filter(new o.K(this.tileID.overscaledZ),O))continue;const j=u.getId(O,m),U=new o.aI(O,E,M,I,j);U.tile=P,r.push(U)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const r in this.buckets)if(this.buckets[r].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const s=this.expirationTime;if(r.cacheControl){const u=o.aJ(r.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const u=Date.now();let f=!1;if(this.expirationTime>u)f=!1;else if(s)if(this.expirationTime<s)f=!0;else{const m=this.expirationTime-s;m?this.expirationTime=u+Math.max(m,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,s){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(r).length!==0&&s&&this.updateBuckets(r,s)}updateBuckets(r,s){if(!this.latestFeatureIndex)return;const u=this.latestFeatureIndex.loadVTLayers(),f=s.style.listImages(),m=s.style.getBrightness();for(const x in this.buckets){if(!s.style.hasLayer(x))continue;const b=this.buckets[x],E=b.layers[0].sourceLayer||"_geojsonTileLayer",M=u[E];let I={};if(r&&(I=r[E],!M||!I||Object.keys(I).length===0))continue;if(b.update(I,M,f,this.imageAtlas&&this.imageAtlas.patternPositions||{},m),b instanceof o.aK||b instanceof o.aL){const z=s.style.getOwnSourceCache(b.layers[0].source);s._terrain&&s._terrain.enabled&&z&&b.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(z.id,this.tileID)}const P=s&&s.style&&s.style.getOwnLayer(x);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=o.f.now()+r}setTexture(r,s){const u=s.context,f=u.gl;this.texture=this.texture||s.getTileTexture(r.width),this.texture&&this.texture instanceof o.T?this.texture.update(r,{useMipmap:!0}):(this.texture=new o.T(u,r,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(r,s){const u={};for(const f of s)u[f]=!0;this.dependencies[r]=u}hasDependency(r,s){for(const u of r){const f=this.dependencies[u];if(f){for(const m of s)if(f[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const u=o.aM(as,this.tileID.canonical,this.tileTransform)[0],f=new o.aN,m=new o.aO;for(let x=0;x<u.length;x++){const{x:b,y:E}=u[x];f.emplaceBack(b,E),m.emplaceBack(x)}m.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(m),this._tileDebugBuffer=r.createVertexBuffer(f,o.aP.members),this._tileDebugSegments=o.aB.simpleSegment(0,0,f.length,m.length)}_makeTileBoundsBuffers(r,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const u=o.aM(as,this.tileID.canonical,this.tileTransform)[0];let f,m;if(this.isRaster){const x=function(b,E){const M=o.as(b,E),I=Math.pow(2,b.z);for(let G=0;G<ct;G++)for(let F=0;F<ct;F++){const Z=o.at((b.x+(F+Ar(F))/yt)/I),J=o.au((b.y+(G+Ar(G))/yt)/I),W=E.project(Z,J),Q=G*ct+F;Ei[2*Q+0]=Math.round((W.x*M.scale-M.x)*o.V),Ei[2*Q+1]=Math.round((W.y*M.scale-M.y)*o.V)}Ot.fill(0),ar.fill(0);for(let G=2045;G>=0;G--){const F=4*G,Z=Kt[F+0],J=Kt[F+1],W=Kt[F+2],Q=Kt[F+3],$=Z+W>>1,ee=J+Q>>1,ae=$+ee-J,le=ee+Z-$,fe=J*ct+Z,Te=Q*ct+W,_e=ee*ct+$,Le=Math.hypot((Ei[2*fe+0]+Ei[2*Te+0])/2-Ei[2*_e+0],(Ei[2*fe+1]+Ei[2*Te+1])/2-Ei[2*_e+1])>=16;Ot[_e]=Ot[_e]||(Le?1:0),G<1022&&(Ot[_e]=Ot[_e]||Ot[(J+le>>1)*ct+(Z+ae>>1)]||Ot[(Q+le>>1)*ct+(W+ae>>1)])}const P=new o.av,z=new o.aw;let O=0;function j(G,F){const Z=F*ct+G;return ar[Z]===0&&(P.emplaceBack(Ei[2*Z+0],Ei[2*Z+1],G*o.V/yt,F*o.V/yt),ar[Z]=++O),ar[Z]-1}function U(G,F,Z,J,W,Q){const $=G+Z>>1,ee=F+J>>1;if(Math.abs(G-W)+Math.abs(F-Q)>1&&Ot[ee*ct+$])U(W,Q,G,F,$,ee),U(Z,J,W,Q,$,ee);else{const ae=j(G,F),le=j(Z,J),fe=j(W,Q);z.emplaceBack(ae,le,fe)}}return U(0,0,yt,yt,yt,0),U(yt,yt,0,0,0,yt),{vertices:P,indices:z}}(this.tileID.canonical,s);f=x.vertices,m=x.indices}else{f=new o.av,m=new o.aw;for(const{x:b,y:E}of u)f.emplaceBack(b,E,0,0);const x=o.aQ(f.int16,void 0,4);for(let b=0;b<x.length;b+=3)m.emplaceBack(x[b],x[b+1],x[b+2])}this._tileBoundsBuffer=r.createVertexBuffer(f,o.aR.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(m),this._tileBoundsSegments=o.aB.simpleSegment(0,0,f.length,m.length)}_makeGlobeTileDebugBuffers(r,s){const u=s.projection;if(!u||u.name!=="globe"||s.freezeTileCoverage)return;const f=this.tileID.canonical,m=o.aS(f,s),x=o.aT(m),b=o.S(s.zoom);let E;b>0&&(E=o.a6.invert(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,f,s,x,E,b),this._makeGlobeTileDebugTextBuffer(r,f,s,x,E,b)}_globePoint(r,s,u,f,m,x,b){let E=o.aU(r,s,u);if(x){const M=1<<u.z,I=o.a5(f.center.lng),P=o.ae(f.center.lat),z=(u.x+.5)/M-I;let O=0;z>.5?O=-1:z<-.5&&(O=1);let j=(r/o.V+u.x)/M+O,U=(s/o.V+u.y)/M;j=(j-I)*f._pixelsPerMercatorPixel+I,U=(U-P)*f._pixelsPerMercatorPixel+P;const G=[j*f.worldSize,U*f.worldSize,0];o.N.transformMat4(G,G,x),E=o.aV(E,G,b)}return o.N.transformMat4(E,E,m)}_makeGlobeTileDebugBorderBuffer(r,s,u,f,m,x){const b=new o.aN,E=new o.aO,M=new o.aW,I=(z,O,j,U,G)=>{const F=(j-z)/(G-1),Z=(U-O)/(G-1),J=b.length;for(let W=0;W<G;W++){const Q=z+W*F,$=O+W*Z;b.emplaceBack(Q,$);const ee=this._globePoint(Q,$,s,u,f,m,x);M.emplaceBack(ee[0],ee[1],ee[2]),E.emplaceBack(J+W)}},P=o.V;I(0,0,P,0,16),I(P,0,P,P,16),I(P,P,0,P,16),I(0,P,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(E),this._tileDebugBuffer=r.createVertexBuffer(b,o.aP.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(M,o.aX.members),this._tileDebugSegments=o.aB.simpleSegment(0,0,b.length,E.length)}_makeGlobeTileDebugTextBuffer(r,s,u,f,m,x){const b=o.V/4,E=new o.aN,M=new o.aw,I=new o.aW,P=25;M.reserve(32),E.reserve(P),I.reserve(P);const z=(O,j)=>P*O+j;for(let O=0;O<P;O++){const j=O*b;for(let U=0;U<P;U++){const G=U*b;E.emplaceBack(G,j);const F=this._globePoint(G,j,s,u,f,m,x);I.emplaceBack(F[0],F[1],F[2])}}for(let O=0;O<4;O++)for(let j=0;j<4;j++){const U=z(O,j),G=z(O,j+1),F=z(O+1,j),Z=z(O+1,j+1);M.emplaceBack(U,G,F),M.emplaceBack(F,G,Z)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(M),this._tileDebugTextBuffer=r.createVertexBuffer(E,o.aP.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(I,o.aX.members),this._tileDebugTextSegments=o.aB.simpleSegment(0,0,P,32)}destroy(r=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const Ns={vector:pt,raster:mt,"raster-dem":class extends mt{constructor(c,r,s,u){super(c,r,s,u),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(c,r){const s=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(f,m){f&&(c.state="errored",r(f)),m&&(c.dem=m,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",r(null))}c.request=o.d(this.map._requestManager.transformRequest(s,o.R.Tile),(function(f,m,x,b){if(delete c.request,c.aborted)c.state="unloaded",r(null);else if(f)c.state="errored",r(f);else if(m){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:x,expires:b});const E=ImageBitmap&&m instanceof ImageBitmap&&o.ak(),M=1-(m.width-o.al(m.width))/2;M<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const I=E?m:o.f.getImageData(m,M),P={uid:c.uid,coord:c.tileID,source:this.id,scope:this.scope,rawImageData:I,encoding:this.encoding,padding:M};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",P,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(c){const r=c.canonical,s=Math.pow(2,r.z),u=(r.x-1+s)%s,f=r.x===0?c.wrap-1:c.wrap,m=(r.x+1+s)%s,x=r.x+1===s?c.wrap+1:c.wrap,b={};return b[new o.am(c.overscaledZ,f,r.z,u,r.y).key]={backfilled:!1},b[new o.am(c.overscaledZ,x,r.z,m,r.y).key]={backfilled:!1},r.y>0&&(b[new o.am(c.overscaledZ,f,r.z,u,r.y-1).key]={backfilled:!1},b[new o.am(c.overscaledZ,c.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},b[new o.am(c.overscaledZ,x,r.z,m,r.y-1).key]={backfilled:!1}),r.y+1<s&&(b[new o.am(c.overscaledZ,f,r.z,u,r.y+1).key]={backfilled:!1},b[new o.am(c.overscaledZ,c.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},b[new o.am(c.overscaledZ,x,r.z,m,r.y+1).key]={backfilled:!1}),b}},"raster-array":rt,geojson:class extends o.E{constructor(c,r,s,u){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(u),this._data=r.data,this._options=o.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const f=o.V/this.tileSize;this.workerOptions=o.e({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*f,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*f,extent:o.V,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.V,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*f,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}getClusterExpansionZoom(c,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id,scope:this.scope},r),this}getClusterChildren(c,r){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id,scope:this.scope},r),this}getClusterLeaves(c,r,s,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:c,limit:r,offset:s},u),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.b("dataloading",{dataType:"source"})),this._loaded=!1;const c=o.e({},this.workerOptions);c.scope=this.scope;const r=this._data;typeof r=="string"?(c.request=this.map._requestManager.transformRequest(o.f.resolveURL(r),o.R.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(s,u)=>{if(this._loaded=!0,this._pendingLoad=null,s)this.fire(new o.a(s));else{const f={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&u&&u.resourceTiming&&u.resourceTiming[this.id]&&(f.resourceTiming=u.resourceTiming[this.id]),this.fire(new o.b("data",f)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,r){const s=c.actor?"reloadTile":"loadTile";c.actor=this.actor;const u={type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:o.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};c.request=this.actor.send(s,u,(f,m)=>(delete c.request,c.destroy(),c.aborted?r(null):f?r(f):(c.loadVectorData(m,this.map.painter,s==="reloadTile"),r(null))),void 0,s==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.ap{constructor(c,r,s,u){super(c,r,s,u),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const r of c.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.R.Source).url);o.aq(this.urls,(r,s)=>{this._loaded=!0,r?this.fire(new o.a(r)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const r=this.video.seekable;c<r.start(0)||c>r.end(0)?this.fire(new o.a(new lt(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,r=c.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(c,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.ap,model:class extends o.E{constructor(c,r,s,u){super(),this.id=c,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){const c=[];for(const r in this._options.models){const s=this._options.models[r],u=o.l(this.map._requestManager.transformRequest(s.uri,o.R.Model).url).then(f=>{if(!f)return;const m=o.c(f),x=new o.M(r,s.position,s.orientation,m);x.computeBoundsAndApplyParent(),this.models.push(x)}).catch(f=>{this.fire(new o.a(new Error(`Could not load model ${r} from ${s.uri}: ${f.message}`)))});c.push(u)}return Promise.allSettled(c).then(()=>{this._loaded=!0,this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this.fire(new o.a(new Error(`Could not load models: ${r.message}`)))})}onAdd(c){this.map=c,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(c,r){}serialize(){return{type:"model"}}},"batched-model":class extends o.E{constructor(c,r,s,u){super(),this.type="batched-model",this.id=c,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(c){this.map=c,this.load()}load(c){this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map._worldview;this._tileJSONRequest=st(this._options,this.map._requestManager,r,s,(u,f)=>{this._tileJSONRequest=null,this._loaded=!0,u?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new o.a(u))):f&&(o.e(this,f),f.bounds&&(this.tileBounds=new et(f.bounds,this.minzoom,this.maxzoom)),o.aj(f.tiles,this.map._requestManager._customAccessToken),this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))),c&&c(u)})}hasTransition(){return!1}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loaded(){return this._loaded}loadTile(c,r){const s=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(s,o.R.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(c.actor&&c.state!=="expired")if(c.state==="loading")c.reloadCallback=r;else{if(c.buckets){const m=Object.values(c.buckets);for(const x of m)x.dirty=!0;return void(c.state="loaded")}c.request=c.actor.send("reloadTile",u,f.bind(this))}else c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",u,f.bind(this),void 0,!0);function f(m,x){return c.aborted?r(null):m&&m.status!==404?r(m):(x&&(x.resourceTiming&&(c.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&c.setExpiryData(x),c.buckets={...c.buckets,...x.buckets},x.featureIndex&&(c.latestFeatureIndex=x.featureIndex)),c.state="loaded",void r(null))}}serialize(){return o.e({},this._options)}},canvas:class extends o.ap{constructor(c,r,s,u){super(c,r,s,u),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(m=>typeof m!="number"))||this.fire(new o.a(new lt(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.a(new lt(`sources.${c}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.a(new lt(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.a(new lt(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.a(new lt(`sources.${c}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?!c&&!this._playing||this.texture instanceof o.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends o.E{constructor(c,r,s,u){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=r,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new et(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),o.e(this,o.ac(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:r,y:s,z:u}=c.canonical;return this._implementation.hasTile({x:r,y:s,z:u})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,r){const{x:s,y:u,z:f}=c.tileID.canonical,m=new AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:s,y:u,z:f},{signal:m.signal})).then((function(x){return delete c.request,c.aborted?(c.state="unloaded",r(null)):x===void 0?(c.state="errored",r(null)):x===null?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",r(null)):function(b){return b instanceof ImageData||b instanceof HTMLCanvasElement||b instanceof ImageBitmap||b instanceof HTMLImageElement}(x)?(this.loadTileData(c,x),c.state="loaded",void r(null)):(c.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.code!==20&&(c.state="errored",r(x))}),c.request.cancel=()=>m.abort()}loadTileData(c,r){c.setTexture(r,this._map.painter)}unloadTile(c,r){if(c.texture&&c.texture instanceof o.T?(c.destroy(!0),c.texture&&c.texture instanceof o.T&&this._map.painter.saveTileTexture(c.texture)):c.destroy(),this._implementation.unloadTile){const{x:s,y:u,z:f}=c.tileID.canonical;this._implementation.unloadTile({x:s,y:u,z:f})}r()}abortTile(c,r){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){const c=o.ag(this.id,this.scope);this._map.style.clearSource(c)}_update(){this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))}}},Qr=function(c,r,s,u){const f=new Ns[r.type](c,r,s,u);if(f.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${f.id}`);return o.aY(["load","abort","unload","serialize","prepare"],f),f};function qu(c,r){const s=o.a6.identity([]);return o.a6.scale(s,s,[.5*c.width,.5*-c.height,1]),o.a6.translate(s,s,[1,-1,0]),o.a6.multiply(s,s,c.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(s)}function Zu(c,r,s,u,f,m,x,b=!1){const E=c.tilesIn(u,x,b);E.sort(xa);const M=[];for(const P of E)M.push({wrappedTileID:P.tile.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(r,s,c._state,P,f,m,qu(c.transform,P.tile.tileID),b)});const I=function(P){const z={},O={};for(const j of P){const U=j.queryResults,G=j.wrappedTileID,F=O[G]=O[G]||{};for(const Z in U){const J=U[Z],W=F[Z]=F[Z]||{},Q=z[Z]=z[Z]||[];for(const $ of J)W[$.featureIndex]||(W[$.featureIndex]=!0,Q.push($))}}return z}(M);for(const P in I)I[P].forEach(z=>{const O=z.feature,j=O.layer;j&&j.type!=="background"&&j.type!=="sky"&&j.type!=="slot"&&(O.source=j.source,j["source-layer"]&&(O.sourceLayer=j["source-layer"]),O.state=O.id!==void 0?c.getFeatureState(j["source-layer"],O.id):{})});return I}function Vs(c,r){const s=c.getRenderableIds().map(m=>c.getTileByID(m)),u=[],f={};for(let m=0;m<s.length;m++){const x=s[m],b=x.tileID.canonical.key;f[b]||(f[b]=!0,x.querySourceFeatures(u,r))}return u}function xa(c,r){const s=c.tileID,u=r.tileID;return s.overscaledZ-u.overscaledZ||s.canonical.y-u.canonical.y||s.wrap-u.wrap||s.canonical.x-u.canonical.x}class Go extends uo{constructor(r,s,u,f,m){super(r,s,u,f,m),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(r,s){const u=s.context,f=u.gl;this.texture=this.texture||s.getTileTexture(r.width),this.texture&&this.texture instanceof o.T?this.texture.update(r,{useMipmap:!1,premultiply:!1}):this.texture=new o.T(u,r,f.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(r=16384,s){const u=this._mrt=new o.aZ(30),f=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=o.a_(f,(m,x,b,E)=>{if(m)s(m);else try{const M=u.getHeaderLength(x);if(M>r)return void(this.request=this.fetchHeader(M,s));u.parseHeader(x),this._isHeaderLoaded=!0;let I=0;for(const P of Object.values(u.layers))I=Math.max(I,P.dataIndex[P.dataIndex.length-1].last_byte);x.byteLength>=I&&(this.entireBuffer=x),s(null,this.entireBuffer||x,b,E)}catch(M){s(M)}}),this.request}fetchBand(r,s,u){const f=this._mrt;if(!this._isHeaderLoaded||!f)return void u(new Error("Tile header is not ready"));const m=this.actor;if(!m)return void u(new Error("Can't fetch tile band without an actor"));let x;const b=(P,z)=>{x.complete(P,z),P?u(P):(this.updateTextureDescriptor(r,s),u(null,this.textureDescriptor&&this.textureDescriptor.img))},E=(P,z)=>{if(P)return u(P);const O=m.send("decodeRasterArray",{buffer:z,task:x},b,void 0,!0);this._workQueue.push(()=>{O&&O.cancel(),x.cancel()})},M=f.getLayer(r);if(!M)return void u(new Error(`Unknown sourceLayer "${r}"`));if(M.hasDataForBand(s))return this.updateTextureDescriptor(r,s),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const I=M.getDataRange([s]);if(x=f.createDecodingTask(I),!x||x.tasks.length)if(this.flushQueues(),this.entireBuffer)E(null,this.entireBuffer.slice(I.firstByte,I.lastByte+1));else{const P=Object.assign({},this.requestParams,{headers:{Range:`bytes=${I.firstByte}-${I.lastByte}`}}),z=o.a_(P,E);this._fetchQueue.push(()=>{z.cancel(),x.cancel()})}else u(null)}updateNeeded(r,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==r)&&this.state!=="errored"}updateTextureDescriptor(r,s){if(!this._mrt)return;const u=this._mrt.getLayer(r);if(!u||!u.hasBand(s)||!u.hasDataForBand(s))return;const{bytes:f,tileSize:m,buffer:x,offset:b,scale:E}=u.getBandView(s),M=m+2*x,I={data:f,width:M,height:M},P=this.texture;P&&P instanceof o.T&&P.update(I,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:r,band:s,img:I,buffer:x,offset:b,tileSize:m,format:u.pixelFormat,mix:[E,256*E,65536*E,16777216*E]}}}class va{constructor(r,s){this.max=r,this.onRemove=s,this.reset()}reset(){for(const r in this.data)for(const s of this.data[r])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(r,s,u){const f=r.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const m={value:s,timeout:void 0};if(u!==void 0&&(m.timeout=setTimeout(()=>{this.remove(r,m)},u)),this.data[f].push(m),this.order.push(f),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const s=this.data[r].shift();return s.timeout&&clearTimeout(s.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),s.value}getByKey(r){const s=this.data[r];return s?s[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,s){if(!this.has(r))return this;const u=r.wrapped().key,f=s===void 0?0:this.data[u].indexOf(s),m=this.data[u][f];return this.data[u].splice(f,1),m.timeout&&clearTimeout(m.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(m.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(r){const s=[];for(const u in this.data)for(const f of this.data[u])r(f.value)||s.push(f);for(const u of s)this.remove(u.value.tileID,u)}}class gs extends o.E{constructor(r,s,u){super(),this.id=r,this._onlySymbols=u,s.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new va(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new ni,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const s=this._tiles[r];if(s.state!=="errored"&&(s.state!=="loaded"||!s.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,s){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,s)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const u=this._tiles[s];u.upload(r),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return o.a$(this._tiles).map(r=>r.tileID).sort(Tc).map(r=>r.key)}getRenderableIds(r,s){const u=[];for(const f in this._tiles)this._isIdRenderable(+f,r,s)&&u.push(this._tiles[f]);return r?u.sort((f,m)=>{const x=f.tileID,b=m.tileID,E=new o.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),M=new o.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-b.overscaledZ||M.y-E.y||M.x-E.x}).map(f=>f.tileID.key):u.map(f=>f.tileID).sort(Tc).map(f=>f.key)}hasRenderableParent(r){const s=this.findLoadedParent(r,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(r,s,u){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(s||!this._tiles[r].holdingForFade())&&(u||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,s){const u=this._tiles[r];u&&(u.state!=="loading"&&(u.state=s),this._loadTile(u,this._tileLoaded.bind(this,u,r,s)))}_tileLoaded(r,s,u,f){if(f)if(r.state="errored",f.status!==404)this._source.fire(new o.a(f,{tile:r}));else{if(!(r.tileID.key in this._loadedParentTiles))return void this._source.fire(new o.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform)}else r.timeAdded=o.f.now(),u==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(s,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new o.b("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const s=this.getRenderableIds();for(let f=0;f<s.length;f++){const m=s[f];if(r.neighboringTiles&&r.neighboringTiles[m]){const x=this.getTileByID(m);u(r,x),u(x,r)}}function u(f,m){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let x=m.tileID.canonical.x-f.tileID.canonical.x;const b=m.tileID.canonical.y-f.tileID.canonical.y,E=Math.pow(2,f.tileID.canonical.z),M=m.tileID.key;x===0&&b===0||Math.abs(b)>1||(Math.abs(x)>1&&(Math.abs(x+E)===1?x+=E:Math.abs(x-E)===1&&(x-=E)),m.dem&&f.dem&&(f.dem.backfillBorder(m.dem,x,b),f.neighboringTiles&&f.neighboringTiles[M]&&(f.neighboringTiles[M].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,s,u,f){for(const m in this._tiles){let x=this._tiles[m];if(f[m]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>u)continue;let b=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const M=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[M.key],x&&x.hasData()&&(b=M)}let E=b;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),r[E.key]){f[b.key]=b;break}}}findLoadedParent(r,s){if(r.key in this._loadedParentTiles){const u=this._loadedParentTiles[r.key];return u&&u.tileID.overscaledZ>=s?u:null}for(let u=r.overscaledZ-1;u>=s;u--){const f=r.scaledTo(u),m=this._getLoadedTile(f);if(m)return m}}_getLoadedTile(r){const s=this._tiles[r.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,s){s=s||this._source.tileSize;const u=Math.ceil(r.width/s)+1,f=Math.ceil(r.height/s)+1,m=Math.floor(u*f*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(b)}handleWrapJump(r){const s=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,s){const u={};for(const f in this._tiles){const m=this._tiles[f];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+s),u[m.tileID.key]=m}this._tiles=u;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(r,s,u,f){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let m;if(this.updateCacheSize(r,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)m=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new o.am(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y));else if(this.tileCoverLift!==0){const E=r.clone();E.tileCoverLift=this.tileCoverLift,m=E.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&r.projection.name==="globe"&&(m.push(new o.am(1,0,1,0,0)),m.push(new o.am(1,0,1,1,0)),m.push(new o.am(1,0,1,0,1)),m.push(new o.am(1,0,1,1,1)))}else m=r.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(m=m.filter(E=>this._source.hasTile(E)));else m=[];if(m.length>0&&this.castsShadows&&f&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Us(this._source.type)){const E=r.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),M=Math.min(E,this._source.maxzoom),I=r.extendTileCoverForShadows(m,f,M);for(const P of I)this._shadowCasterTiles[P.key]=!0,m.push(P)}const x=this._updateRetainedTiles(m);if(Us(this._source.type)&&m.length!==0){const E={},M={},I=Object.keys(x);for(const z of I){const O=x[z],j=this._tiles[z];if(!j||j.fadeEndTime&&j.fadeEndTime<=o.f.now())continue;const U=this.findLoadedParent(O,Math.max(O.overscaledZ-gs.maxOverzooming,this._source.minzoom));U&&(this._addTile(U.tileID),E[U.tileID.key]=U.tileID),M[z]=O}const P=m[m.length-1].overscaledZ;for(const z in this._tiles){const O=this._tiles[z];if(x[z]||!O.hasData())continue;let j=O.tileID;for(;j.overscaledZ>P;){j=j.scaledTo(j.overscaledZ-1);const U=this._tiles[j.key];if(U&&U.hasData()&&M[j.key]){x[z]=O.tileID;break}}}for(const z in E)x[z]||(this._coveredTiles[z]=!0,x[z]=E[z])}for(const E in x)this._tiles[E].clearFadeHold();const b=o.b0(this._tiles,x);for(const E of b){const M=this._tiles[E];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(+E)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const s={};if(r.length===0)return s;const u={},f=r.reduce((M,I)=>Math.min(M,I.overscaledZ),1/0),m=r[0].overscaledZ,x=Math.max(m-gs.maxOverzooming,this._source.minzoom),b=Math.max(m+gs.maxUnderzooming,this._source.minzoom),E={};for(const M of r){const I=this._addTile(M);s[M.key]=M,I.hasData()||f<this._source.maxzoom&&(E[M.key]=M)}this._retainLoadedChildren(E,f,b,s);for(const M of r){let I=this._tiles[M.key];if(I.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const z=M.children(this._source.maxzoom)[0],O=this.getTile(z);if(O&&O.hasData()){s[z.key]=z;continue}}else{const z=M.children(this._source.maxzoom);if(s[z[0].key]&&s[z[1].key]&&s[z[2].key]&&s[z[3].key])continue}let P=I.wasRequested();for(let z=M.overscaledZ-1;z>=x;--z){const O=M.scaledTo(z);if(u[O.key]||(u[O.key]=!0,I=this.getTile(O),!I&&P&&(I=this._addTile(O)),I&&(s[O.key]=O,P=I.wasRequested(),I.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const s=[];let u,f=this._tiles[r].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){u=this._loadedParentTiles[f.key];break}s.push(f.key);const m=f.scaledTo(f.overscaledZ-1);if(u=this._getLoadedTile(m),u)break;f=m}for(const m of s)this._loadedParentTiles[m]=u}}_addTile(r){let s=this._tiles[r.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),s;s=this._cache.getAndRemove(r),s&&(this._setTileReloadTimer(r.key,s),s.tileID=r,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,s)));const u=!!s;if(!u){const f=this.map?this.map.painter:null,m=this._source.tileSize*r.overscaleFactor();s=this._source.type==="raster-array"?new Go(r,m,this.transform.tileZoom,f,this._isRaster):new uo(r,m,this.transform.tileZoom,f,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,r.key,s.state))}return s?(s.uses++,this._tiles[r.key]=s,u||this._source.fire(new o.b("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(r,s){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const u=s.getExpiryTimeout();u&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},u))}_removeTile(r){const s=this._tiles[r];s&&(s.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,s,u){const f=[],m=this.transform;if(!m)return f;const x=m.projection.name==="globe",b=o.a5(m.center.lng);for(const E in this._tiles){const M=this._tiles[E];if(u&&M.clearQueryDebugViz(),M.holdingForFade())continue;let I;if(x){const P=M.tileID.canonical;if(P.z===0){const z=[Math.abs(o.aa(b,...pl(P,-1))-b),Math.abs(o.aa(b,...pl(P,1))-b)];I=[0,2*z.indexOf(Math.min(...z))-1]}else{const z=[Math.abs(o.aa(b,...pl(P,-1))-b),Math.abs(o.aa(b,...pl(P,0))-b),Math.abs(o.aa(b,...pl(P,1))-b)];I=[z.indexOf(Math.min(...z))-1]}}else I=[0];for(const P of I){const z=r.containsTile(M,m,s,P);z&&f.push(z)}}return f}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,s){const u=this.getRenderableIds(r,s).map(m=>this._tiles[m].tileID),f=this.transform.projection.name==="globe";for(const m of u)m.projMatrix=this.transform.calculateProjMatrix(m.toUnwrapped()),m.expandedProjMatrix=f?this.transform.calculateProjMatrix(m.toUnwrapped(),!1,!0):m.projMatrix;return u}sortCoordinatesByDistance(r){const s=r.slice(),u=this.transform._camera.position,f=this.transform._camera.forward(),m={};for(const x of s){const b=1/(1<<x.canonical.z);m[x.key]=((x.canonical.x+.5)*b+x.wrap-u[0])*f[0]+((x.canonical.y+.5)*b-u[1])*f[1]-u[2]*f[2]}return s.sort((x,b)=>m[x.key]-m[b.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(Us(this._source.type))for(const r in this._tiles){const s=this._tiles[r];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=o.f.now())return!0}return!1}setFeatureState(r,s,u){this._state.updateState(r=r||"_geojsonTileLayer",s,u)}removeFeatureState(r,s,u){this._state.removeFeatureState(r=r||"_geojsonTileLayer",s,u)}getFeatureState(r,s){return this._state.getState(r=r||"_geojsonTileLayer",s)}setDependencies(r,s,u){const f=this._tiles[r];f&&f.setDependencies(s,u)}reloadTilesForDependencies(r,s){for(const u in this._tiles)this._tiles[u].hasDependency(r,s)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(r,s))}_preloadTiles(r,s){if(!this._sourceLoaded){const E=()=>{this._sourceLoaded&&(this._source.off("data",E),this._preloadTiles(r,s))};return void this._source.on("data",E)}const u=new Map,f=Array.isArray(r)?r:[r],m=this.map.painter.terrain,x=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const E of f){const M=E.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const I of M)u.set(I.key,I);this.usedForTerrain&&E.updateElevation(!1)}const b=Array.from(u.values());o.b1(b,(E,M)=>{const I=new uo(E,this._source.tileSize*E.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(I,P=>{this._source.type==="raster-dem"&&I.dem&&this._backfillDEM(I),M(P,I)})},s)}}function Tc(c,r){const s=Math.abs(2*c.wrap)-+(c.wrap<0),u=Math.abs(2*r.wrap)-+(r.wrap<0);return c.overscaledZ-r.overscaledZ||u-s||r.canonical.y-c.canonical.y||r.canonical.x-c.canonical.x}function Us(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function pl(c,r){const s=1<<c.z;return[c.x/s+r,(c.x+1)/s+r]}gs.maxOverzooming=10,gs.maxUnderzooming=3;class mf{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const r=!1,s=!1;for(const u in this.style._mergedLayers){const f=this.style._mergedLayers[u];if(f.type==="fill-extrusion")this.layers.push({layer:f,visible:r,visibilityChanged:s});else if(f.type==="model"){const m=this.style.getLayerSource(f);m&&m.type==="batched-model"&&this.layers.push({layer:f,visible:r,visibilityChanged:s})}}}onNewFrame(r){this.layersGotHidden=!1;for(const s of this.layers){const u=s.layer;let f=!1;u.type==="fill-extrusion"?f=!u.isHidden(r)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="model"&&(f=!u.isHidden(r)&&u.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!f&&s.visible,s.visible=f}}updateZOffset(r,s){this.currentBuildingBuckets=[];for(const f of this.layers){const m=f.layer,x=this.style.getLayerSourceCache(m);let b=1;m.type==="fill-extrusion"&&(b=f.visible?m.paint.get("fill-extrusion-vertical-scale"):0);let E=x?x.getTile(s):null;if(!E&&x&&s.canonical.z>x.getSource().minzoom){let M=s.scaledTo(Math.min(x.getSource().maxzoom,s.overscaledZ-1));for(;M.overscaledZ>=x.getSource().minzoom&&(E=x.getTile(M),!E&&M.overscaledZ!==0);)M=M.scaledTo(M.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:E?E.getBucket(m):null,tileID:E?E.tileID:s,verticalScale:b})}r.hasAnyZOffset=!1;let u=!1;for(let f=0;f<r.symbolInstances.length;f++){const m=r.symbolInstances.get(f),x=m.zOffset,b=this._getHeightAtTileOffset(s,m.tileAnchorX,m.tileAnchorY);m.zOffset=b!==Number.NEGATIVE_INFINITY?b:x,u||x===m.zOffset||(u=!0),r.hasAnyZOffset||m.zOffset===0||(r.hasAnyZOffset=!0)}u&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,s,u,f){let m=s,x=u;if(r.canonical.z!==f.canonical.z){const b=f.canonical,E=1/(1<<r.canonical.z-b.z);m=(s+r.canonical.x*o.V)*E-b.x*o.V|0,x=(u+r.canonical.y*o.V)*E-b.y*o.V|0}return{tileX:m,tileY:x}}_getHeightAtTileOffset(r,s,u){let f,m;for(let x=0;x<this.layers.length;++x){if(this.layers[x].layer.type!=="fill-extrusion")continue;const{bucket:b,tileID:E,verticalScale:M}=this.currentBuildingBuckets[x];if(!b)continue;const{tileX:I,tileY:P}=this._mapCoordToOverlappingTile(r,s,u,E),z=b.getHeightAtTileCoord(I,P);z&&z.height!==void 0&&(z.hidden?f=z.height:m=Math.max(z.height*M,m||0))}if(m!==void 0)return m;for(let x=0;x<this.layers.length;++x){const b=this.layers[x];if(b.layer.type!=="model"||!b.visible)continue;const{bucket:E,tileID:M}=this.currentBuildingBuckets[x];if(!E)continue;const{tileX:I,tileY:P}=this._mapCoordToOverlappingTile(r,s,u,M),z=E.getHeightAtTileCoord(I,P);if(z&&!z.hidden)return z.height===void 0&&f!==void 0?Math.min(z.maxHeight,f)*z.verticalScale:(z.height||0)*z.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function $o(c,r){const s={};for(const u in c)u!=="ref"&&(s[u]=c[u]);return o.b2.forEach(u=>{u in r&&(s[u]=r[u])}),s}function _f(c){c=c.slice();const r=Object.create(null);for(let s=0;s<c.length;s++)r[c[s].id]=c[s];for(let s=0;s<c.length;s++)"ref"in c[s]&&(c[s]=$o(c[s],r[c[s].ref]));return c}const Mi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function ml(c,r,s){s.push({command:Mi.addSource,args:[c,r[c]]})}function Hu(c,r,s){r.push({command:Mi.removeSource,args:[c]}),s[c]=!0}function s_(c,r,s,u){Hu(c,s,u),ml(c,r,s)}function o_(c,r,s){let u;for(u in c[s])if(c[s].hasOwnProperty(u)&&u!=="data"&&!re(c[s][u],r[s][u]))return!1;for(u in r[s])if(r[s].hasOwnProperty(u)&&u!=="data"&&!re(c[s][u],r[s][u]))return!1;return!0}function ho(c,r,s,u,f,m){let x;for(x in r=r||{},c=c||{})c.hasOwnProperty(x)&&(re(c[x],r[x])||s.push({command:m,args:[u,x,r[x],f]}));for(x in r)r.hasOwnProperty(x)&&!c.hasOwnProperty(x)&&(re(c[x],r[x])||s.push({command:m,args:[u,x,r[x],f]}))}function fo(c){return c.id}function Ec(c,r){return c[r.id]=r,c}class ba{constructor(r,s){this.reset(r,s)}reset(r,s){this.points=r||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.aa(r,0,1);let s=1,u=this._distances[s];const f=r*this.paddedLength+this.padding;for(;u<f&&s<this._distances.length;)u=this._distances[++s];const m=s-1,x=this._distances[m],b=u-x,E=b>0?(f-x)/b:0;return this.points[m].mult(1-E).add(this.points[s].mult(E))}}class Wu{constructor(r,s,u){const f=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(r/u),this.yCellCount=Math.ceil(s/u);for(let x=0;x<this.xCellCount*this.yCellCount;x++)f.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=s,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,s,u,f,m){this._forEachCell(s,u,f,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(m)}insertCircle(r,s,u,f){this._forEachCell(s-f,u-f,s+f,u+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(s),this.circles.push(u),this.circles.push(f)}_insertBoxCell(r,s,u,f,m,x){this.boxCells[m].push(x)}_insertCircleCell(r,s,u,f,m,x){this.circleCells[m].push(x)}_query(r,s,u,f,m,x){if(u<0||r>this.width||f<0||s>this.height)return!m&&[];const b=[];if(r<=0&&s<=0&&this.width<=u&&this.height<=f){if(m)return!0;for(let E=0;E<this.boxKeys.length;E++)b.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const M=this.circles[3*E],I=this.circles[3*E+1],P=this.circles[3*E+2];b.push({key:this.circleKeys[E],x1:M-P,y1:I-P,x2:M+P,y2:I+P})}return x?b.filter(x):b}return this._forEachCell(r,s,u,f,this._queryCell,b,{hitTest:m,seenUids:{box:{},circle:{}}},x),m?b.length>0:b}_queryCircle(r,s,u,f,m){const x=r-u,b=r+u,E=s-u,M=s+u;if(b<0||x>this.width||M<0||E>this.height)return!f&&[];const I=[];return this._forEachCell(x,E,b,M,this._queryCellCircle,I,{hitTest:f,circle:{x:r,y:s,radius:u},seenUids:{box:{},circle:{}}},m),f?I.length>0:I}query(r,s,u,f,m){return this._query(r,s,u,f,!1,m)}hitTest(r,s,u,f,m){return this._query(r,s,u,f,!0,m)}hitTestCircle(r,s,u,f){return this._queryCircle(r,s,u,!0,f)}_queryCell(r,s,u,f,m,x,b,E){const M=b.seenUids,I=this.boxCells[m];if(I!==null){const z=this.bboxes;for(const O of I)if(!M.box[O]){M.box[O]=!0;const j=4*O;if(r<=z[j+2]&&s<=z[j+3]&&u>=z[j+0]&&f>=z[j+1]&&(!E||E(this.boxKeys[O]))){if(b.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[O],x1:z[j],y1:z[j+1],x2:z[j+2],y2:z[j+3]})}}}const P=this.circleCells[m];if(P!==null){const z=this.circles;for(const O of P)if(!M.circle[O]){M.circle[O]=!0;const j=3*O;if(this._circleAndRectCollide(z[j],z[j+1],z[j+2],r,s,u,f)&&(!E||E(this.circleKeys[O]))){if(b.hitTest)return x.push(!0),!0;{const U=z[j],G=z[j+1],F=z[j+2];x.push({key:this.circleKeys[O],x1:U-F,y1:G-F,x2:U+F,y2:G+F})}}}}}_queryCellCircle(r,s,u,f,m,x,b,E){const M=b.circle,I=b.seenUids,P=this.boxCells[m];if(P!==null){const O=this.bboxes;for(const j of P)if(!I.box[j]){I.box[j]=!0;const U=4*j;if(this._circleAndRectCollide(M.x,M.y,M.radius,O[U+0],O[U+1],O[U+2],O[U+3])&&(!E||E(this.boxKeys[j])))return x.push(!0),!0}}const z=this.circleCells[m];if(z!==null){const O=this.circles;for(const j of z)if(!I.circle[j]){I.circle[j]=!0;const U=3*j;if(this._circlesCollide(O[U],O[U+1],O[U+2],M.x,M.y,M.radius)&&(!E||E(this.circleKeys[j])))return x.push(!0),!0}}}_forEachCell(r,s,u,f,m,x,b,E){const M=this._convertToXCellCoord(r),I=this._convertToYCellCoord(s),P=this._convertToXCellCoord(u),z=this._convertToYCellCoord(f);for(let O=M;O<=P;O++)for(let j=I;j<=z;j++)if(m.call(this,r,s,u,f,this.xCellCount*j+O,x,b,E))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,s,u,f,m,x){const b=f-r,E=m-s,M=u+x;return M*M>b*b+E*E}_circleAndRectCollide(r,s,u,f,m,x,b){const E=(x-f)/2,M=Math.abs(r-(f+E));if(M>E+u)return!1;const I=(b-m)/2,P=Math.abs(s-(m+I));if(P>I+u)return!1;if(M<=E||P<=I)return!0;const z=M-E,O=P-I;return z*z+O*O<=u*u}}const js={unknown:0,flipRequired:1,flipNotRequired:2},po=Math.tan(85*Math.PI/180);function _l(c,r,s,u,f,m,x){const b=o.a6.create();if(s)if(m.name==="globe"){const E=o.b3(f,r);o.a6.multiply(b,b,E)}else{const E=o.b4.invert([],x);b[0]=E[0],b[1]=E[1],b[4]=E[2],b[5]=E[3],u||o.a6.rotateZ(b,b,f.angle)}else o.a6.multiply(b,f.labelPlaneMatrix,c);return b}function Xu(c,r,s,u,f,m,x){const b=_l(c,r,s,u,f,m,x);return m.name==="globe"&&s||(b[2]=b[6]=b[10]=b[14]=0),b}function Yu(c,r,s,u,f,m,x){if(s){if(m.name==="globe"){const b=_l(c,r,s,u,f,m,x);return o.a6.invert(b,b),o.a6.multiply(b,c,b),b}{const b=o.a6.clone(c),E=o.a6.identity([]);return E[0]=x[0],E[1]=x[1],E[4]=x[2],E[5]=x[3],o.a6.multiply(b,b,E),u||o.a6.rotateZ(b,b,-f.angle),b}}return f.glCoordMatrix}function ls(c,r,s,u){const f=[c,r,s,1];s?o.a7.transformMat4(f,f,u):ih(f,f,u);const m=f[3];return f[0]/=m,f[1]/=m,f[2]/=m,f}function gf(c,r){return Math.min(.5+c/r*.5,1.5)}function Ku(c,r){const s=c[0]/c[3],u=c[1]/c[3];return s>=-r[0]&&s<=r[0]&&u>=-r[1]&&u<=r[1]}function Ju(c,r,s,u,f,m,x,b,E,M){const I=s.transform,P=u?c.textSizeData:c.iconSizeData,z=o.b5(P,s.transform.zoom),O=I.projection.name==="globe",j=[256/s.width*2+1,256/s.height*2+1],U=u?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;U.clear();let G=null;O&&(G=u?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const F=c.lineVertexArray,Z=u?c.text.placedSymbolArray:c.icon.placedSymbolArray,J=s.transform.width/s.transform.height;let W,Q=!1;for(let $=0;$<Z.length;$++){const ee=Z.get($),{numGlyphs:ae,writingMode:le}=ee;if(le!==o.b6.vertical||Q||W===o.b6.horizontal||(Q=!0),W=le,(ee.hidden||le===o.b6.vertical)&&!Q){mo(ae,U);continue}Q=!1;const fe=new o.P(ee.tileAnchorX,ee.tileAnchorY);let{x:Te,y:_e,z:Le}=I.projection.projectTilePoint(fe.x,fe.y,M.canonical);if(E){const[dt,Ct,Ut]=E(fe);Te+=dt,_e+=Ct,Le+=Ut}const Pe=[Te,_e,Le,1];if(o.a7.transformMat4(Pe,Pe,r),!Ku(Pe,j)){mo(ae,U);continue}const $e=Pe[3],ge=gf(s.transform.getCameraToCenterDistance(I.projection),$e),Ae=o.b7(P,z,ee),he=x?Ae/ge:Ae*ge,ve=ls(Te,_e,Le,f);if(ve[3]<=0){mo(ae,U);continue}let Ze={};const Qe=x?null:E,Je=th(ee,he,!1,b,r,f,m,c.glyphOffsetArray,F,U,G,ve,fe,Ze,J,Qe,I.projection,M,x);Q=Je.useVertical,Qe&&Je.needsFlipping&&(Ze={}),(Je.notEnoughRoom||Q||Je.needsFlipping&&th(ee,he,!0,b,r,f,m,c.glyphOffsetArray,F,U,G,ve,fe,Ze,J,Qe,I.projection,M,x).notEnoughRoom)&&mo(ae,U)}u?(c.text.dynamicLayoutVertexBuffer.updateData(U),G&&c.text.globeExtVertexBuffer&&c.text.globeExtVertexBuffer.updateData(G)):(c.icon.dynamicLayoutVertexBuffer.updateData(U),G&&c.icon.globeExtVertexBuffer&&c.icon.globeExtVertexBuffer.updateData(G))}function Qu(c,r,s,u,f,m,x,b,E,M,I,P,z,O,j,U){const{lineStartIndex:G,glyphStartIndex:F,segment:Z}=b,J=F+b.numGlyphs,W=G+b.lineLength,Q=r.getoffsetX(F),$=r.getoffsetX(J-1),ee=gl(c*Q,s,u,f,m,x,Z,G,W,E,M,I,P,z,!0,O,j,U);if(!ee)return null;const ae=gl(c*$,s,u,f,m,x,Z,G,W,E,M,I,P,z,!0,O,j,U);return ae?{first:ee,last:ae}:null}function eh(c,r,s,u){return c===o.b6.horizontal&&Math.abs(u)>Math.abs(s)?{useVertical:!0}:c===o.b6.vertical?u>0?{needsFlipping:!0}:null:r!==js.unknown&&function(f,m){return f===0||Math.abs(m/f)>po}(s,u)?r===js.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function th(c,r,s,u,f,m,x,b,E,M,I,P,z,O,j,U,G,F,Z){const J=r/24,W=c.lineOffsetX*J,Q=c.lineOffsetY*J,{lineStartIndex:$,glyphStartIndex:ee,numGlyphs:ae,segment:le,writingMode:fe,flipState:Te}=c,_e=$+c.lineLength,Le=Pe=>{if(I){const[he,ve,Ze]=Pe.up,Qe=M.length;o.b8(I,Qe+0,he,ve,Ze),o.b8(I,Qe+1,he,ve,Ze),o.b8(I,Qe+2,he,ve,Ze),o.b8(I,Qe+3,he,ve,Ze)}const[$e,ge,Ae]=Pe.point;o.b9(M,$e,ge,Ae,Pe.angle)};if(ae>1){const Pe=Qu(J,b,W,Q,s,P,z,c,E,m,O,U,!1,G,F,Z);if(!Pe)return{notEnoughRoom:!0};if(u&&!s){let[$e,ge,Ae]=Pe.first.point,[he,ve,Ze]=Pe.last.point;[$e,ge]=ls($e,ge,Ae,x),[he,ve]=ls(he,ve,Ze,x);const Qe=eh(fe,Te,(he-$e)*j,ve-ge);if(c.flipState=Qe&&Qe.needsFlipping?js.flipRequired:js.flipNotRequired,Qe)return Qe}Le(Pe.first);for(let $e=ee+1;$e<ee+ae-1;$e++){const ge=gl(J*b.getoffsetX($e),W,Q,s,P,z,le,$,_e,E,m,O,U,!1,!1,G,F,Z);if(!ge)return M.length-=4*($e-ee),{notEnoughRoom:!0};Le(ge)}Le(Pe.last)}else{if(u&&!s){const $e=ls(z.x,z.y,0,f),ge=$+le+1,Ae=new o.P(E.getx(ge),E.gety(ge)),he=ls(Ae.x,Ae.y,0,f),ve=he[3]>0?he:Sc(z,Ae,$e,1,f,void 0,G,F.canonical),Ze=eh(fe,Te,(ve[0]-$e[0])*j,ve[1]-$e[1]);if(c.flipState=Ze&&Ze.needsFlipping?js.flipRequired:js.flipNotRequired,Ze)return Ze}const Pe=gl(J*b.getoffsetX(ee),W,Q,s,P,z,le,$,_e,E,m,O,U,!1,!1,G,F,Z);if(!Pe)return{notEnoughRoom:!0};Le(Pe)}return{}}function wa(c,r,s,u,f){const{x:m,y:x,z:b}=u.projectTilePoint(c.x,c.y,r);if(!f)return ls(m,x,b,s);const[E,M,I]=f(c);return ls(m+E,x+M,b+I,s)}function Sc(c,r,s,u,f,m,x,b){const E=wa(c.sub(r)._unit()._add(c),b,f,x,m);return o.N.sub(E,s,E),o.N.normalize(E,E),o.N.scaleAndAdd(E,s,E,u)}function gl(c,r,s,u,f,m,x,b,E,M,I,P,z,O,j,U,G,F){const Z=u?c-r:c+r;let J=Z>0?1:-1,W=0;u&&(J*=-1,W=Math.PI),J<0&&(W+=Math.PI);let Q=b+x+(J>0?0:1)|0,$=f,ee=f,ae=0,le=0;const fe=Math.abs(Z),Te=[],_e=[];let Le=m,Pe=Le;const $e=()=>Sc(Pe,Le,ee,fe-ae+1,I,z,U,G.canonical);for(;ae+le<=fe;){if(Q+=J,Q<b||Q>=E)return null;if(ee=$,Pe=Le,Te.push(ee),O&&_e.push(Pe),Le=new o.P(M.getx(Q),M.gety(Q)),$=P[Q],!$){const Ct=wa(Le,G.canonical,I,U,z);$=Ct[3]>0?P[Q]=Ct:$e()}ae+=le,le=o.N.distance(ee,$)}j&&z&&(P[Q]&&($=$e(),le=o.N.distance(ee,$)),P[Q]=$);const ge=(fe-ae)/le,Ae=Le.sub(Pe)._mult(ge)._add(Pe),he=o.N.sub([],$,ee),ve=o.N.scaleAndAdd([],ee,he,ge);let Ze=[0,0,1],Qe=he[0],Je=he[1];if(F&&(Ze=U.upVector(G.canonical,Ae.x,Ae.y),Ze[0]!==0||Ze[1]!==0||Ze[2]!==1)){const Ct=[Ze[2],0,-Ze[0]],Ut=o.N.cross([],Ze,Ct);o.N.normalize(Ct,Ct),o.N.normalize(Ut,Ut),Qe=o.N.dot(he,Ct),Je=o.N.dot(he,Ut)}if(s){const Ct=o.N.cross([],Ze,he);o.N.normalize(Ct,Ct),o.N.scaleAndAdd(ve,ve,Ct,s*J)}const dt=W+Math.atan2(Je,Qe);return Te.push(ve),O&&_e.push(Ae),{point:ve,angle:dt,path:Te,tilePath:_e,up:Ze}}function mo(c,r){const s=r.length,u=s+4*c;r.resize(u),r.float32.fill(-1/0,4*s,4*u)}function ih(c,r,s){const u=r[0],f=r[1];return c[0]=s[0]*u+s[4]*f+s[12],c[1]=s[1]*u+s[5]*f+s[13],c[3]=s[3]*u+s[7]*f+s[15],c}const cs=100;class _t{constructor(r,s,u=new Wu(r.width+200,r.height+200,25),f=new Wu(r.width+200,r.height+200,25)){this.transform=r,this.grid=u,this.ignoredGrid=f,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+cs,this.screenBottomBoundary=r.height+cs,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=s}placeCollisionBox(r,s,u,f,m,x,b,E){let M=u.projectedAnchorX,I=u.projectedAnchorY,P=u.projectedAnchorZ;const z=u.elevation,O=u.tileID,j=r.getProjection();if(z&&O){const[$,ee,ae]=j.upVector(O.canonical,u.tileAnchorX,u.tileAnchorY),le=j.upVectorScale(O.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;M+=$*z*le,I+=ee*z*le,P+=ae*z*le}const U=this.projectAndGetPerspectiveRatio(b,M,I,P,u.tileID,j.name==="globe"||!!z||this.transform.pitch>0,j),G=x*U.perspectiveRatio,F=(u.x1*s+f.x-u.padding)*G+U.point.x,Z=(u.y1*s+f.y-u.padding)*G+U.point.y,J=(u.x2*s+f.x+u.padding)*G+U.point.x,W=(u.y2*s+f.y+u.padding)*G+U.point.y,Q=U.perspectiveRatio<=.55||U.occluded;return!this.isInsideGrid(F,Z,J,W)||!m&&this.grid.hitTest(F,Z,J,W,E)||Q?{box:[],offscreen:!1,occluded:U.occluded}:{box:[F,Z,J,W],offscreen:this.isOffscreen(F,Z,J,W),occluded:!1}}placeCollisionCircles(r,s,u,f,m,x,b,E,M,I,P,z,O,j,U){const G=[],F=this.transform.elevation,Z=r.getProjection(),J=F?F.getAtTileOffsetFunc(U,this.transform.center.lat,this.transform.worldSize,Z):null,W=new o.P(u.tileAnchorX,u.tileAnchorY);let{x:Q,y:$,z:ee}=Z.projectTilePoint(W.x,W.y,U.canonical);if(J){const[Ae,he,ve]=J(W);Q+=Ae,$+=he,ee+=ve}const ae=Z.name==="globe",le=this.projectAndGetPerspectiveRatio(b,Q,$,ee,U,ae||!!F||this.transform.pitch>0,Z),{perspectiveRatio:fe}=le,Te=(P?x/fe:x*fe)/o.bc,_e=ls(Q,$,ee,E),Le=le.signedDistanceFromCamera>0?Qu(Te,m,u.lineOffsetX*Te,u.lineOffsetY*Te,!1,_e,W,u,f,E,{},F&&!P?J:null,P&&!!F,Z,U,P):null;let Pe=!1,$e=!1,ge=!0;if(Le&&!le.occluded){const Ae=.5*O*fe+j,he=new o.P(-100,-100),ve=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Ze=new ba,{first:Qe,last:Je}=Le,dt=Qe.path.length;let Ct=[];for(let kt=dt-1;kt>=1;kt--)Ct.push(Qe.path[kt]);for(let kt=1;kt<Je.path.length;kt++)Ct.push(Je.path[kt]);const Ut=2.5*Ae;M&&(Ct=Ct.map(([kt,hi,Qt],ai)=>(J&&!ae&&(Qt=J(ai<dt-1?Qe.tilePath[dt-1-ai]:Je.tilePath[ai-dt+2])[2]),ls(kt,hi,Qt,M))),Ct.some(kt=>kt[3]<=0)&&(Ct=[]));let Rt=[];if(Ct.length>0){let kt=1/0,hi=-1/0,Qt=1/0,ai=-1/0;for(const oi of Ct)kt=Math.min(kt,oi[0]),Qt=Math.min(Qt,oi[1]),hi=Math.max(hi,oi[0]),ai=Math.max(ai,oi[1]);hi>=he.x&&kt<=ve.x&&ai>=he.y&&Qt<=ve.y&&(Rt=[Ct.map(oi=>new o.P(oi[0],oi[1]))],(kt<he.x||hi>ve.x||Qt<he.y||ai>ve.y)&&(Rt=o.ba(Rt,he.x,he.y,ve.x,ve.y)))}for(const kt of Rt){Ze.reset(kt,.25*Ae);let hi=0;hi=Ze.length<=.5*Ae?1:Math.ceil(Ze.paddedLength/Ut)+1;for(let Qt=0;Qt<hi;Qt++){const ai=Qt/Math.max(hi-1,1),oi=Ze.lerp(ai),Ii=oi.x+cs,ur=oi.y+cs;G.push(Ii,ur,Ae,0);const xi=Ii-Ae,Rr=ur-Ae,vi=Ii+Ae,ki=ur+Ae;if(ge=ge&&this.isOffscreen(xi,Rr,vi,ki),$e=$e||this.isInsideGrid(xi,Rr,vi,ki),!s&&this.grid.hitTestCircle(Ii,ur,Ae,z)&&(Pe=!0,!I))return{circles:[],offscreen:!1,collisionDetected:Pe,occluded:!1}}}}return{circles:!I&&Pe||!$e?[]:G,offscreen:ge,collisionDetected:Pe,occluded:le.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let u=1/0,f=1/0,m=-1/0,x=-1/0;for(const I of r){const P=new o.P(I.x+cs,I.y+cs);u=Math.min(u,P.x),f=Math.min(f,P.y),m=Math.max(m,P.x),x=Math.max(x,P.y),s.push(P)}const b=this.grid.query(u,f,m,x).concat(this.ignoredGrid.query(u,f,m,x)),E={},M={};for(const I of b){const P=I.key;if(E[P.bucketInstanceId]===void 0&&(E[P.bucketInstanceId]={}),E[P.bucketInstanceId][P.featureIndex])continue;const z=[new o.P(I.x1,I.y1),new o.P(I.x2,I.y1),new o.P(I.x2,I.y2),new o.P(I.x1,I.y2)];o.bb(s,z)&&(E[P.bucketInstanceId][P.featureIndex]=!0,M[P.bucketInstanceId]===void 0&&(M[P.bucketInstanceId]=[]),M[P.bucketInstanceId].push(P.featureIndex))}return M}insertCollisionBox(r,s,u,f,m){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:f,collisionGroupID:m},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,s,u,f,m){const x=s?this.ignoredGrid:this.grid,b={bucketInstanceId:u,featureIndex:f,collisionGroupID:m};for(let E=0;E<r.length;E+=4)x.insertCircle(b,r[E],r[E+1],r[E+2])}projectAndGetPerspectiveRatio(r,s,u,f,m,x,b){const E=[s,u,f,1];let M=!1;f||this.transform.pitch>0?(o.a7.transformMat4(E,E,r),this.fogState&&m&&b.name!=="globe"&&(M=function(z,O,j,U,G,F){const Z=F.calculateFogTileMatrix(G),J=[O,j,U];return o.N.transformMat4(J,J,Z),$i(z,o.N.length(J),F.pitch,F._fov)}(this.fogState,s,u,f,m.toUnwrapped(),this.transform)>.9)):ih(E,E,r);const I=E[3];return{point:new o.P((E[0]/I+1)/2*this.transform.width+cs,(-E[1]/I+1)/2*this.transform.height+cs),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(b)/I*.5,1.5),signedDistanceFromCamera:I,occluded:x&&E[2]>I||M}}isOffscreen(r,s,u,f){return u<cs||r>=this.screenRightBoundary||f<cs||s>this.screenBottomBoundary}isInsideGrid(r,s,u,f){return u>=0&&r<this.gridRightBoundary&&f>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const r=o.a6.identity([]);return o.a6.translate(r,r,[-100,-100,0]),r}}function Ac(c,r,s){const u=r.createTileMatrix(c,c.worldSize,s.toUnwrapped());return o.a6.multiply(new Float32Array(16),c.projMatrix,u)}function rh(c,r,s){if(r.projection.name===s.projection.name)return c.projMatrix;const u=s.clone();return u.setProjection(r.projection),Ac(u,r.getProjection(),c)}function yl(c,r,s){return r.name===s.projection.name?c.projMatrix:Ac(s,r,c)}class nh{constructor(r,s,u,f){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?s:-s))):f&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class _o{constructor(r,s,u,f,m,x=!1){this.text=new nh(r?r.text:null,s,u,m),this.icon=new nh(r?r.icon:null,s,f,m),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ys{constructor(r,s,u,f=!1){this.text=r,this.icon=s,this.skipFade=u,this.clipped=f}}class sh{constructor(){this.invProjMatrix=o.a6.create(),this.viewportMatrix=o.a6.create(),this.circles=[]}}class qo{constructor(r,s,u,f,m){this.bucketInstanceId=r,this.featureIndex=s,this.sourceLayerIndex=u,this.bucketIndex=f,this.tileID=m}}class Mc{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const s=++this.maxGroupID;this.collisionGroups[r]={ID:s,predicate:u=>u.collisionGroupID===s}}return this.collisionGroups[r]}}function Zo(c,r,s,u,f){const{horizontalAlign:m,verticalAlign:x}=o.bf(c),b=-(m-.5)*r,E=-(x-.5)*s,M=o.bd(c,u);return new o.P(b+M[0]*f,E+M[1]*f)}function oh(c,r,s,u,f){const m=new o.P(c,r);return s&&m._rotate(u?f:-f),m}class a_{constructor(r,s,u,f,m,x){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new _t(this.transform,m),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Mc(u),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,s,u,f){const m=u.getBucket(s),x=u.latestFeatureIndex;if(!m||!x||s.fqid!==m.layerIds[0])return;const b=m.layers[0].layout,E=u.collisionBoxArray,M=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),I=u.tileSize/o.V,P=u.tileID.toUnwrapped();this.transform.setProjection(m.projection);const z=(O=u.tileID,j=m.getProjection(),U=this.transform,j.name===this.projection?U.calculateProjMatrix(O.toUnwrapped()):Ac(U,j,O));var O,j,U;const G=b.get("text-pitch-alignment")==="map",F=b.get("text-rotation-alignment")==="map";s.compileFilter();const Z=s.dynamicFilter(),J=s.dynamicFilterNeedsFeature(),W=this.transform.calculatePixelsToTileUnitsMatrix(u),Q=Xu(z,u.tileID.canonical,G,F,this.transform,m.getProjection(),W);let $=null;if(G){const le=Yu(z,u.tileID.canonical,G,F,this.transform,m.getProjection(),W);$=o.a6.multiply([],this.transform.labelPlaneMatrix,le)}let ee=null;Z&&u.latestFeatureIndex&&(ee={unwrappedTileID:P,dynamicFilter:Z,dynamicFilterNeedsFeature:J,featureIndex:u.latestFeatureIndex}),this.retainedQueryData[m.bucketInstanceId]=new qo(m.bucketInstanceId,x,m.sourceLayerIndex,m.index,u.tileID);const ae={bucket:m,layout:b,posMatrix:z,textLabelPlaneMatrix:Q,labelToScreenMatrix:$,clippingData:ee,scale:M,textPixelRatio:I,holdingForFade:u.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:o.b5(m.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.b5(m.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(f)for(const le of m.sortKeyRanges){const{sortKey:fe,symbolInstanceStart:Te,symbolInstanceEnd:_e}=le;r.push({sortKey:fe,symbolInstanceStart:Te,symbolInstanceEnd:_e,parameters:ae})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:ae})}attemptAnchorPlacement(r,s,u,f,m,x,b,E,M,I,P,z,O,j,U,G,F,Z){const{textOffset0:J,textOffset1:W,crossTileID:Q}=z,$=[J,W],ee=Zo(r,u,f,$,m),ae=this.collisionIndex.placeCollisionBox(j,m,s,oh(ee.x,ee.y,x,b,this.transform.angle),P,E,M,I.predicate);if(G){const le=j.getSymbolInstanceIconSize(Z,this.transform.zoom,z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(j,le,G,oh(ee.x,ee.y,x,b,this.transform.angle),P,E,M,I.predicate).box.length===0)return}if(ae.box.length>0){let le;return this.prevPlacement&&this.prevPlacement.variableOffsets[Q]&&this.prevPlacement.placements[Q]&&this.prevPlacement.placements[Q].text&&(le=this.prevPlacement.variableOffsets[Q].anchor),this.variableOffsets[Q]={textOffset:$,width:u,height:f,anchor:r,textScale:m,prevAnchor:le},this.markUsedJustification(j,r,z,U),j.allowVerticalPlacement&&(this.markUsedOrientation(j,U,z),this.placedOrientations[Q]=U),{shift:ee,placedGlyphBoxes:ae}}}placeLayerBucketPart(r,s,u,f){const{bucket:m,layout:x,posMatrix:b,textLabelPlaneMatrix:E,labelToScreenMatrix:M,clippingData:I,textPixelRatio:P,holdingForFade:z,collisionBoxArray:O,partiallyEvaluatedTextSize:j,partiallyEvaluatedIconSize:U,collisionGroup:G}=r.parameters,F=x.get("text-optional"),Z=x.get("icon-optional"),J=x.get("text-allow-overlap"),W=x.get("icon-allow-overlap"),Q=x.get("text-rotation-alignment")==="map",$=x.get("text-pitch-alignment")==="map",ee=x.get("symbol-z-order")==="viewport-y",ae=x.get("symbol-z-elevate");this.transform.setProjection(m.projection);let le=J&&(W||!m.hasIconData()||Z),fe=W&&(J||!m.hasTextData()||F);!m.collisionArrays&&O&&m.deserializeCollisionBoxes(O),u&&f&&m.updateCollisionDebugBuffers(this.transform.zoom,O);const Te=(_e,Le,Pe)=>{const{crossTileID:$e,numVerticalGlyphVertices:ge}=_e;if(I){const vi={zoom:this.transform.zoom,pitch:this.transform.pitch};let ki=null;if(I.dynamicFilterNeedsFeature){const bi=this.retainedQueryData[m.bucketInstanceId];ki=I.featureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:bi.bucketIndex,sourceLayerIndex:bi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,I.dynamicFilter)(vi,ki,this.retainedQueryData[m.bucketInstanceId].tileID.canonical,new o.P(_e.tileAnchorX,_e.tileAnchorY),this.transform.calculateDistanceTileData(I.unwrappedTileID)))return this.placements[$e]=new ys(!1,!1,!1,!0),void s.add($e)}if(s.has($e))return;if(z)return void(this.placements[$e]=new ys(!1,!1,!1));let Ae=!1,he=!1,ve=!0,Ze=!1,Qe=!1,Je=null,dt={box:null,offscreen:null,occluded:null},Ct={box:null,offscreen:null,occluded:null},Ut=null,Rt=null,kt=null,hi=0,Qt=0,ai=0;Pe.textFeatureIndex?hi=Pe.textFeatureIndex:_e.useRuntimeCollisionCircles&&(hi=_e.featureIndex),Pe.verticalTextFeatureIndex&&(Qt=Pe.verticalTextFeatureIndex);const oi=vi=>{vi.tileID=this.retainedQueryData[m.bucketInstanceId].tileID;const ki=this.transform.elevation;vi.elevation=_e.zOffset+(ki?ki.getAtTileOffset(vi.tileID,vi.tileAnchorX,vi.tileAnchorY):0)},Ii=Pe.textBox;if(Ii){oi(Ii);const vi=bi=>{let Di=o.b6.horizontal;if(m.allowVerticalPlacement&&!bi&&this.prevPlacement){const pr=this.prevPlacement.placedOrientations[$e];pr&&(this.placedOrientations[$e]=pr,Di=pr,this.markUsedOrientation(m,Di,_e))}return Di},ki=(bi,Di)=>{if(m.allowVerticalPlacement&&ge>0&&Pe.verticalTextBox){for(const pr of m.writingModes)if(pr===o.b6.vertical?(dt=Di(),Ct=dt):dt=bi(),dt&&dt.box&&dt.box.length)break}else dt=bi()};if(x.get("text-variable-anchor")){let bi=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[$e]){const Gi=this.prevPlacement.variableOffsets[$e];bi.indexOf(Gi.anchor)>0&&(bi=bi.filter(on=>on!==Gi.anchor),bi.unshift(Gi.anchor))}const Di=(Gi,on,xn)=>{const qn=m.getSymbolInstanceTextSize(j,_e,this.transform.zoom,Le),Ds=(Gi.x2-Gi.x1)*qn+2*Gi.padding,Zn=(Gi.y2-Gi.y1)*qn+2*Gi.padding,an=_e.hasIconTextFit&&!W?on:null;an&&oi(an);let en={box:[],offscreen:!1,occluded:!1};const Pn=J?2*bi.length:bi.length;for(let kn=0;kn<Pn;++kn){const Hn=this.attemptAnchorPlacement(bi[kn%bi.length],Gi,Ds,Zn,qn,Q,$,P,b,G,kn>=bi.length,_e,Le,m,xn,an,j,U);if(Hn&&(en=Hn.placedGlyphBoxes,en&&en.box&&en.box.length)){Ae=!0,Je=Hn.shift;break}}return en};ki(()=>Di(Ii,Pe.iconBox,o.b6.horizontal),()=>{const Gi=Pe.verticalTextBox;return Gi&&oi(Gi),m.allowVerticalPlacement&&!(dt&&dt.box&&dt.box.length)&&ge>0&&Gi?Di(Gi,Pe.verticalIconBox,o.b6.vertical):{box:null,offscreen:null,occluded:null}}),dt&&(Ae=dt.box,ve=dt.offscreen,Ze=dt.occluded);const pr=vi(!(!dt||!dt.box));if(!Ae&&this.prevPlacement){const Gi=this.prevPlacement.variableOffsets[$e];Gi&&(this.variableOffsets[$e]=Gi,this.markUsedJustification(m,Gi.anchor,_e,pr))}}else{const bi=(Di,pr)=>{const Gi=m.getSymbolInstanceTextSize(j,_e,this.transform.zoom,Le),on=this.collisionIndex.placeCollisionBox(m,Gi,Di,new o.P(0,0),J,P,b,G.predicate);return on&&on.box&&on.box.length&&(this.markUsedOrientation(m,pr,_e),this.placedOrientations[$e]=pr),on};ki(()=>bi(Ii,o.b6.horizontal),()=>{const Di=Pe.verticalTextBox;return m.allowVerticalPlacement&&ge>0&&Di?(oi(Di),bi(Di,o.b6.vertical)):{box:null,offscreen:null,occluded:null}}),vi(!!(dt&&dt.box&&dt.box.length))}}if(Ut=dt,Ae=Ut&&Ut.box&&Ut.box.length>0,ve=Ut&&Ut.offscreen,Ze=Ut&&Ut.occluded,_e.useRuntimeCollisionCircles){const vi=m.text.placedSymbolArray.get(_e.centerJustifiedTextSymbolIndex>=0?_e.centerJustifiedTextSymbolIndex:_e.verticalPlacedTextSymbolIndex),ki=o.b7(m.textSizeData,j,vi),bi=x.get("text-padding");Rt=this.collisionIndex.placeCollisionCircles(m,J,vi,m.lineVertexArray,m.glyphOffsetArray,ki,b,E,M,u,$,G.predicate,_e.collisionCircleDiameter*ki/o.bc,bi,this.retainedQueryData[m.bucketInstanceId].tileID),Ae=J||Rt.circles.length>0&&!Rt.collisionDetected,ve=ve&&Rt.offscreen,Ze=Rt.occluded}if(Pe.iconFeatureIndex&&(ai=Pe.iconFeatureIndex),Pe.iconBox){const vi=ki=>{oi(ki);const bi=_e.hasIconTextFit&&Je?oh(Je.x,Je.y,Q,$,this.transform.angle):new o.P(0,0),Di=m.getSymbolInstanceIconSize(U,this.transform.zoom,_e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(m,Di,ki,bi,W,P,b,G.predicate)};Ct&&Ct.box&&Ct.box.length&&Pe.verticalIconBox?(kt=vi(Pe.verticalIconBox),he=kt.box.length>0):(kt=vi(Pe.iconBox),he=kt.box.length>0),ve=ve&&kt.offscreen,Qe=kt.occluded}const ur=F||_e.numHorizontalGlyphVertices===0&&ge===0,xi=Z||_e.numIconVertices===0;if(ur||xi?xi?ur||(he=he&&Ae):Ae=he&&Ae:he=Ae=he&&Ae,Ae&&Ut&&Ut.box&&this.collisionIndex.insertCollisionBox(Ut.box,x.get("text-ignore-placement"),m.bucketInstanceId,Ct&&Ct.box&&Qt?Qt:hi,G.ID),he&&kt&&this.collisionIndex.insertCollisionBox(kt.box,x.get("icon-ignore-placement"),m.bucketInstanceId,ai,G.ID),Rt&&(Ae&&this.collisionIndex.insertCollisionCircles(Rt.circles,x.get("text-ignore-placement"),m.bucketInstanceId,hi,G.ID),u)){const vi=m.bucketInstanceId;let ki=this.collisionCircleArrays[vi];ki===void 0&&(ki=this.collisionCircleArrays[vi]=new sh);for(let bi=0;bi<Rt.circles.length;bi+=4)ki.circles.push(Rt.circles[bi+0]),ki.circles.push(Rt.circles[bi+1]),ki.circles.push(Rt.circles[bi+2]),ki.circles.push(Rt.collisionDetected?1:0)}const Rr=m.projection.name!=="globe";le=le&&(Rr||!Ze),fe=fe&&(Rr||!Qe),this.placements[$e]=new ys(Ae||le,he||fe,ve||m.justReloaded),s.add($e)};if(ae&&this.buildingIndex&&(this.buildingIndex.updateZOffset(m,this.retainedQueryData[m.bucketInstanceId].tileID),m.updateZOffset()),ee){const _e=m.getSortedSymbolIndexes(this.transform.angle);for(let Le=_e.length-1;Le>=0;--Le){const Pe=_e[Le];Te(m.symbolInstances.get(Pe),Pe,m.collisionArrays[Pe])}m.hasAnyZOffset&&o.w(`${m.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(m.hasAnyZOffset){const _e=m.getSortedIndexesByZOffset();for(let Le=0;Le<_e.length;++Le){const Pe=_e[Le];Te(m.symbolInstances.get(Pe),Pe,m.collisionArrays[Pe])}}else for(let _e=r.symbolInstanceStart;_e<r.symbolInstanceEnd;_e++)Te(m.symbolInstances.get(_e),_e,m.collisionArrays[_e]);if(u&&m.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[m.bucketInstanceId];o.a6.invert(_e.invProjMatrix,b),_e.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(r,s,u,f){const{leftJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:E,crossTileID:M}=u,I=o.be(s),P=f===o.b6.vertical?E:I==="left"?m:I==="center"?x:I==="right"?b:-1;m>=0&&(r.text.placedSymbolArray.get(m).crossTileID=P>=0&&m!==P?0:M),x>=0&&(r.text.placedSymbolArray.get(x).crossTileID=P>=0&&x!==P?0:M),b>=0&&(r.text.placedSymbolArray.get(b).crossTileID=P>=0&&b!==P?0:M),E>=0&&(r.text.placedSymbolArray.get(E).crossTileID=P>=0&&E!==P?0:M)}markUsedOrientation(r,s,u){const f=s===o.b6.horizontal||s===o.b6.horizontalOnly?s:0,m=s===o.b6.vertical?s:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:M}=u,I=r.text.placedSymbolArray;x>=0&&(I.get(x).placedOrientation=f),b>=0&&(I.get(b).placedOrientation=f),E>=0&&(I.get(E).placedOrientation=f),M>=0&&(I.get(M).placedOrientation=m)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let u=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const f=s?s.symbolFadeChange(r):1,m=s?s.opacities:{},x=s?s.variableOffsets:{},b=s?s.placedOrientations:{};for(const E in this.placements){const M=this.placements[E],I=m[E];I?(this.opacities[E]=new _o(I,f,M.text,M.icon,null,M.clipped),u=u||M.text!==I.text.placed||M.icon!==I.icon.placed):(this.opacities[E]=new _o(null,f,M.text,M.icon,M.skipFade,M.clipped),u=u||M.text||M.icon)}for(const E in m){const M=m[E];if(!this.opacities[E]){const I=new _o(M,f,!1,!1);I.isHidden()||(this.opacities[E]=I,u=u||M.text.placed||M.icon.placed)}}for(const E in x)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=x[E]);for(const E in b)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=b[E]);u?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:r)}updateLayerOpacities(r,s){const u=new Set;for(const f of s){const m=f.getBucket(r);m&&f.latestFeatureIndex&&r.fqid===m.layerIds[0]&&(this.updateBucketOpacities(m,u,f.collisionBoxArray),m.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(m,f.tileID),m.updateZOffset()))}}updateBucketOpacities(r,s,u){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const f=r.layers[0].layout,m=!!r.layers[0].dynamicFilter(),x=new _o(null,0,!1,!1,!0),b=f.get("text-allow-overlap"),E=f.get("icon-allow-overlap"),M=f.get("text-variable-anchor"),I=f.get("text-rotation-alignment")==="map",P=f.get("text-pitch-alignment")==="map",z=new _o(null,0,b&&(E||!r.hasIconData()||f.get("icon-optional")),E&&(b||!r.hasTextData()||f.get("text-optional")),!0);!r.collisionArrays&&u&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(u);const O=(U,G,F)=>{for(let Z=0;Z<G/4;Z++)U.opacityVertexArray.emplaceBack(F)};let j=0;for(let U=0;U<r.symbolInstances.length;U++){const G=r.symbolInstances.get(U),{numHorizontalGlyphVertices:F,numVerticalGlyphVertices:Z,crossTileID:J,numIconVertices:W}=G,Q=s.has(J);let $=this.opacities[J];Q?$=x:$||($=z,this.opacities[J]=$),s.add(J);const ee=F>0||Z>0,ae=W>0,le=this.placedOrientations[J],fe=le===o.b6.vertical,Te=le===o.b6.horizontal||le===o.b6.horizontalOnly;if(!ee&&!ae||$.isHidden()||j++,ee){const _e=vf($.text);O(r.text,F,fe?xl:_e),O(r.text,Z,Te?xl:_e);const Le=$.text.isHidden(),{leftJustifiedTextSymbolIndex:Pe,centerJustifiedTextSymbolIndex:$e,rightJustifiedTextSymbolIndex:ge,verticalPlacedTextSymbolIndex:Ae}=G,he=r.text.placedSymbolArray,ve=Le||fe?1:0;Pe>=0&&(he.get(Pe).hidden=ve),$e>=0&&(he.get($e).hidden=ve),ge>=0&&(he.get(ge).hidden=ve),Ae>=0&&(he.get(Ae).hidden=Le||Te?1:0);const Ze=this.variableOffsets[J];Ze&&this.markUsedJustification(r,Ze.anchor,G,le);const Qe=this.placedOrientations[J];Qe&&(this.markUsedJustification(r,"left",G,Qe),this.markUsedOrientation(r,Qe,G))}if(ae){const _e=vf($.icon),{placedIconSymbolIndex:Le,verticalPlacedIconSymbolIndex:Pe}=G,$e=r.icon.placedSymbolArray,ge=$.icon.isHidden()?1:0;Le>=0&&(O(r.icon,W,fe?xl:_e),$e.get(Le).hidden=ge),Pe>=0&&(O(r.icon,G.numVerticalIconVertices,Te?xl:_e),$e.get(Pe).hidden=ge)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const _e=r.collisionArrays[U];if(_e){let Le=new o.P(0,0),Pe=!0;if(_e.textBox||_e.verticalTextBox){if(M){const ge=this.variableOffsets[J];ge?(Le=Zo(ge.anchor,ge.width,ge.height,ge.textOffset,ge.textScale),I&&Le._rotate(P?this.transform.angle:-this.transform.angle)):Pe=!1}m&&(Pe=!$.clipped),_e.textBox&&Ta(r.textCollisionBox.collisionVertexArray,$.text.placed,!Pe||fe,Le.x,Le.y),_e.verticalTextBox&&Ta(r.textCollisionBox.collisionVertexArray,$.text.placed,!Pe||Te,Le.x,Le.y)}const $e=Pe&&!!(!Te&&_e.verticalIconBox);_e.iconBox&&Ta(r.iconCollisionBox.collisionVertexArray,$.icon.placed,$e,G.hasIconTextFit?Le.x:0,G.hasIconTextFit?Le.y:0),_e.verticalIconBox&&Ta(r.iconCollisionBox.collisionVertexArray,$.icon.placed,!$e,G.hasIconTextFit?Le.x:0,G.hasIconTextFit?Le.y:0)}}}if(r.fullyClipped=j===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const U=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=U.invProjMatrix,r.placementViewportMatrix=U.viewportMatrix,r.collisionCircleArray=U.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,s){const u=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*u>r}setStale(){this.stale=!0}}function Ta(c,r,s,u,f){c.emplaceBack(r?1:0,s?1:0,u||0,f||0),c.emplaceBack(r?1:0,s?1:0,u||0,f||0),c.emplaceBack(r?1:0,s?1:0,u||0,f||0),c.emplaceBack(r?1:0,s?1:0,u||0,f||0)}const l_=Math.pow(2,25),yf=Math.pow(2,24),xf=Math.pow(2,17),ah=Math.pow(2,16),c_=Math.pow(2,9),u_=Math.pow(2,8),h_=Math.pow(2,1);function vf(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const r=c.placed?1:0,s=Math.floor(127*c.opacity);return s*l_+r*yf+s*xf+r*ah+s*c_+r*u_+s*h_+r}const xl=0;class d_{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,s,u,f,m){const x=this._bucketParts;for(;this._currentTileIndex<r.length;)if(s.getBucketParts(x,f,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((b,E)=>b.sortKey-E.sortKey));this._currentPartIndex<x.length;){const b=x[this._currentPartIndex];if(s.placeLayerBucketPart(b,this._seenCrossTileIDs,u,b.symbolInstanceStart===0),this._currentPartIndex++,m())return!0}return!1}}class Ic{constructor(r,s,u,f,m,x,b,E,M){this.placement=new a_(r,m,x,b,E,M),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(r,s,u,f){const m=o.f.now(),x=()=>{const b=o.f.now()-m;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){const b=s[r[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=E)&&(!b.maxzoom||b.maxzoom>E)){const M=b,I=M.layout.get("symbol-z-elevate"),P=this._inProgressLayer=this._inProgressLayer||new d_(M),z=o.ag(b.source,b.scope);if(P.continuePlacement(I?f[z]:u[z],this.placement,this._showCollisionBoxes,b,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const lh=512/o.V/2;class bf{constructor(r,s,u){this.tileID=r,this.bucketInstanceId=u,this.index=new o.bg(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const f=r.canonical.x*o.V,m=r.canonical.y*o.V;for(let x=0;x<s.length;x++){const{key:b,crossTileID:E,tileAnchorX:M,tileAnchorY:I}=s.get(x),P=Math.floor((f+M)*lh),z=Math.floor((m+I)*lh);this.index.add(P,z),this.keys.push(b),this.crossTileIDs.push(E)}this.index.finish()}findMatches(r,s,u){const f=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),m=lh/Math.pow(2,s.canonical.z-this.tileID.canonical.z),x=s.canonical.x*o.V,b=s.canonical.y*o.V;for(let E=0;E<r.length;E++){const M=r.get(E);if(M.crossTileID)continue;const{key:I,tileAnchorX:P,tileAnchorY:z}=M,O=Math.floor((x+P)*m),j=Math.floor((b+z)*m),U=this.index.range(O-f,j-f,O+f,j+f);for(const G of U){const F=this.crossTileIDs[G];if(this.keys[G]===I&&!u.has(F)){u.add(F),M.crossTileID=F;break}}}}}class ch{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Cc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const s=Math.round((r-this.lng)/360);if(s!==0)for(const u in this.indexes){const f=this.indexes[u],m={};for(const x in f){const b=f[x];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+s),m[b.tileID.key]=b}this.indexes[u]=m}this.lng=r}addBucket(r,s,u){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let m=0;m<s.symbolInstances.length;m++)s.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const f=this.usedCrossTileIDs[r.overscaledZ];for(const m in this.indexes){const x=this.indexes[m];if(Number(m)>r.overscaledZ)for(const b in x){const E=x[b];E.tileID.isChildOf(r)&&E.findMatches(s.symbolInstances,r,f)}else{const b=x[r.scaledTo(Number(m)).key];b&&b.findMatches(s.symbolInstances,r,f)}}for(let m=0;m<s.symbolInstances.length;m++){const x=s.symbolInstances.get(m);x.crossTileID||(x.crossTileID=u.generate(),f.add(x.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new bf(r,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(r,s){for(const u of s.crossTileIDs)this.usedCrossTileIDs[r].delete(u)}removeStaleBuckets(r){let s=!1;for(const u in this.indexes){const f=this.indexes[u];for(const m in f)r[f[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,f[m]),delete f[m],s=!0)}return s}}class uh{constructor(){this.layerIndexes={},this.crossTileIDs=new ch,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,s,u,f){let m=this.layerIndexes[r.fqid];m===void 0&&(m=this.layerIndexes[r.fqid]=new Cc);let x=!1;const b={};f.name!=="globe"&&m.handleWrapJump(u);for(const E of s){const M=E.getBucket(r);M&&r.fqid===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(E.tileID,M,this.crossTileIDs)&&(x=!0),b[M.bucketInstanceId]=!0)}return m.removeStaleBuckets(b)&&(x=!0),x}pruneUnusedLayers(r){const s={};r.forEach(u=>{s[u]=!0});for(const u in this.layerIndexes)s[u]||delete this.layerIndexes[u]}}class Ho{constructor(r=0,s=0,u=0,f=0){if(isNaN(r)||r<0||isNaN(s)||s<0||isNaN(u)||u<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=s,this.left=u,this.right=f}interpolate(r,s,u){return s.top!=null&&r.top!=null&&(this.top=o.U(r.top,s.top,u)),s.bottom!=null&&r.bottom!=null&&(this.bottom=o.U(r.bottom,s.bottom,u)),s.left!=null&&r.left!=null&&(this.left=o.U(r.left,s.left,u)),s.right!=null&&r.right!=null&&(this.right=o.U(r.right,s.right,u)),this}getCenter(r,s){const u=o.aa((this.left+r-this.right)/2,0,r),f=o.aa((this.top+s-this.bottom)/2,0,s);return new o.P(u,f)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Ho(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Pc(c,r){const s=o.bk(c,3);o.a6.fromQuat(c,r),o.bm(c,3,s)}function vl(c,r){const s=o.bi.identity([]);return o.bi.rotateZ(s,s,-r),o.bi.rotateX(s,s,-c),s}function hh(c,r){const s=[c[0],c[1],0],u=[r[0],r[1],0];if(o.N.length(s)>=1e-15){const x=o.N.normalize([],s);o.N.scale(u,x,o.N.dot(u,x)),r[0]=u[0],r[1]=u[1]}const f=o.N.cross([],r,c);if(o.N.len(f)<1e-15)return null;const m=Math.atan2(-f[1],f[0]);return vl(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),m)}class bl{constructor(r,s){this.position=r,this.orientation=s}get position(){return this._position}set position(r){if(r){const s=r instanceof o.L?r:new o.L(r[0],r[1],r[2]);this._renderWorldCopies&&(s.x=o.bh(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(r,s){if(this.orientation=null,!this.position)return;const u=this.position,f=this._elevation?this._elevation.getAtPointOrZero(o.L.fromLngLat(r)):0,m=o.L.fromLngLat(r,f),x=[m.x-u.x,m.y-u.y,m.z-u.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=hh(x,s)}setPitchBearing(r,s){this.orientation=vl(o.bj(r),o.bj(-s))}}class Ea{constructor(r,s){this._transform=o.a6.identity([]),this.orientation=s,this.position=r}get mercatorPosition(){const r=this.position;return new o.L(r[0],r[1],r[2])}get position(){const r=o.bk(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var s;r&&o.bm(this._transform,3,[(s=r)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.bi.identity([]),r&&Pc(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,s){this._orientation=vl(r,s),Pc(this._transform,this._orientation)}forward(){const r=o.bk(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.bk(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.bk(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,s){const u=new Float64Array(16);return o.a6.invert(u,this.getWorldToCamera(r,s)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,s,u){const f=this.position;o.N.scale(f,f,-r);const m=new Float64Array(16);return o.a6.fromScaling(m,[u,u,u]),o.a6.translate(m,m,f),m[10]*=s,m}getWorldToCamera(r,s){const u=new Float64Array(16),f=new Float64Array(4),m=this.position;return o.bi.conjugate(f,this._orientation),o.N.scale(m,m,-r),o.a6.fromQuat(u,f),o.a6.translate(u,u,m),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=s,u[9]*=s,u[10]*=s,u[11]*=s,u}getCameraToClipPerspective(r,s,u,f){const m=new Float64Array(16);return o.a6.perspective(m,r,s,u,f),m}getCameraToClipOrthographic(r,s,u,f,m,x){const b=new Float64Array(16);return o.a6.ortho(b,r,s,u,f,m,x),b}getDistanceToElevation(r,s=!1){const u=r===0?0:o.bl(r,s?o.au(this.position[1]):this.position[1]),f=this.forward();return(u-this.position[2])/f[2]}clone(){return new Ea([...this.position],[...this.orientation])}}const Sa=(c,r,s)=>(1-s)*c+s*r,wl=c=>c*c*c*c*c;class Tl{constructor(r,s,u,f,m,x,b){this.tileSize=512,this._renderWorldCopies=m===void 0||m,this._minZoom=r||0,this._maxZoom=s||22,this._minPitch=u??0,this._maxPitch=f??60,this.setProjection(x),this.setMaxBounds(b),this.width=0,this.height=0,this._center=new o.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ho,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ea,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const r=new Tl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,s=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(r||u)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return o.ac(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=o.bo(this.projectionOptions);const u=!re(s,this.getProjection());return u&&this._calcMatrices(),this.mercatorFromTransition=!1,u}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.bo({name:"mercator"});const s=r!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bh(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const s=-r*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=o.b4.create(),o.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const s=o.aa(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=o.bj(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const s=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let f=0,m=0;for(let x=0;x<s.length;x++){const b=new o.P(s[x][0]*this.width,u+s[x][1]*(this.height-u)),E=r.pointCoordinate(b);if(!E)continue;const M=1/Math.hypot(E[0]-this._camera.position[0],E[1]-this._camera.position[1]);f+=E[3]*M,m+=M}return m===0?NaN:f/m}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*s,f=this._mercatorZfromZoom(r),m=this._mercatorZfromZoom(this._maxZoom),x=Math.max(f-u,m);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let u;u=r.z<this._camera.position[2]?[s.x,s.y,s.z]:[r.x,r.y,r.z];const f=o.N.length(o.N.sub([],this._camera.position,u));return o.aa(this._zoomFromMercatorZ(f),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let s=!1;if(r.orientation&&!o.bi.exactEquals(r.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(r.orientation)),r.position){const u=[r.position.x,r.position.y,r.position.z];o.N.exactEquals(u,this._camera.position)||(this._setCameraPosition(u),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,s=new bl;return s.position=new o.L(r[0],r[1],r[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(r){if(!o.bi.length(r))return!1;o.bi.normalize(r,r);const s=o.N.transformQuat([],[0,0,-1],r),u=o.N.transformQuat([],[0,-1,0],r);if(u[2]<0)return!1;const f=hh(s,u);return!!f&&(this._camera.orientation=f,!0)}_setCameraPosition(r){const s=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,f=this.cameraToCenterDistance;r[2]=o.aa(r[2],f/u,f/s),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,s,u){this._unmodified=!1,this._edgeInsets.interpolate(r,s,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const s=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(r){const s=[new o.bp(0,r)];if(this.renderWorldCopies){const u=this.pointCoordinate(new o.P(0,0)),f=this.pointCoordinate(new o.P(this.width,0)),m=this.pointCoordinate(new o.P(this.width,this.height)),x=this.pointCoordinate(new o.P(0,this.height)),b=Math.floor(Math.min(u.x,f.x,m.x,x.x)),E=Math.floor(Math.max(u.x,f.x,m.x,x.x)),M=1;for(let I=b-M;I<=E+M;I++)I!==0&&s.push(new o.bp(I,r))}return s}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(r,s,u){let f=[];if(s[0]===0&&s[1]===0)return f;for(const x of r){const b=x.canonical,E=x.overscaledZ,M=x.wrap,I=1<<b.z,P=b.x+1<I,z=b.x>0,O=b.y+1<I,j=b.y>0,U=x.wrap-(z?0:1),G=x.wrap+(P?0:1),F=z?b.x-1:I-1,Z=P?b.x+1:0;s[0]<0?(f.push(new o.am(E,G,b.z,Z,b.y)),s[1]<0&&O&&(f.push(new o.am(E,M,b.z,b.x,b.y+1)),f.push(new o.am(E,G,b.z,Z,b.y+1))),s[1]>0&&j&&(f.push(new o.am(E,M,b.z,b.x,b.y-1)),f.push(new o.am(E,G,b.z,Z,b.y-1)))):s[0]>0?(f.push(new o.am(E,U,b.z,F,b.y)),s[1]<0&&O&&(f.push(new o.am(E,M,b.z,b.x,b.y+1)),f.push(new o.am(E,U,b.z,F,b.y+1))),s[1]>0&&j&&(f.push(new o.am(E,M,b.z,b.x,b.y-1)),f.push(new o.am(E,U,b.z,F,b.y-1)))):s[1]<0&&O?f.push(new o.am(E,M,b.z,b.x,b.y+1)):j&&f.push(new o.am(E,M,b.z,b.x,b.y-1))}if(f.length>1){f.sort((E,M)=>E.overscaledZ-M.overscaledZ||E.wrap-M.wrap||E.canonical.z-M.canonical.z||E.canonical.x-M.canonical.x||E.canonical.y-M.canonical.y);let x=0,b=0;for(;b<f.length;)f[b].equals(f[x])?++b:f[++x]=f[b++];f.length=x+1}const m=[];for(const x of f)f.some(b=>x.isChildOf(b))||m.push(x);return f=m.filter(x=>!r.some(b=>!!(x.overscaledZ<u&&b.isChildOf(x))||x.equals(b)||x.isChildOf(b))),f}coveringTiles(r){let s=this.coveringZoomLevel(r);const u=s,f=this.elevation&&this.elevation.exaggeration(),m=f&&!r.isTerrainDEM,x=this.projection.name==="mercator";if(r.minzoom!==void 0&&s<r.minzoom)return[];r.maxzoom!==void 0&&s>r.maxzoom&&(s=r.maxzoom);const b=this.locationCoordinate(this.center),E=this.center.lat,M=1<<s,I=[M*b.x,M*b.y,0],P=this.projection.name==="globe",z=!P,O=o.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,z),j=P?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=M*o.bl(1,this.center.lat),G=this._camera.position[2]/o.bl(1,this.center.lat),F=[M*j.x,M*j.y,G*(z?1:U)],Z=P||f,J=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),W=this.isLODDisabled(!0)?s:0;let Q;if(this._elevation&&r.isTerrainDEM)Q=1e4*this._elevation.exaggeration();else if(this._elevation){const he=this._elevation.getMinMaxForVisibleTiles();Q=he?he.max:this._centerAltitude}else Q=this._centerAltitude;const $=r.isTerrainDEM?-Q:this._elevation?this._elevation.getMinElevationBelowMSL():0,ee=this.projection.isReprojectedInTileSpace?o.br(this):1,ae=he=>{const Ze=new o.L(he.x+25e-6,he.y,he.z),Qe=new o.L(he.x,he.y+25e-6,he.z),Je=he.toLngLat(),dt=Ze.toLngLat(),Ct=Qe.toLngLat(),Ut=this.locationCoordinate(Je),Rt=this.locationCoordinate(dt),kt=this.locationCoordinate(Ct),hi=Math.hypot(Rt.x-Ut.x,Rt.y-Ut.y),Qt=Math.hypot(kt.x-Ut.x,kt.y-Ut.y);return Math.sqrt(hi*Qt)*ee/25e-6},le=he=>{const ve=Q,Ze=$;return{aabb:o.bu(this,M,0,0,0,he,Ze,ve,this.projection),zoom:0,x:0,y:0,minZ:Ze,maxZ:ve,wrap:he,fullyVisible:!1}},fe=[];let Te=[];const _e=s,Le=r.reparseOverscaled?u:s,Pe=he=>he*he,$e=Pe((G-this._centerAltitude)*U),ge=he=>{if(!this._elevation||!he.tileID||!x)return;const ve=this._elevation.getMinMaxForTile(he.tileID),Ze=he.aabb;ve?(Ze.min[2]=ve.min,Ze.max[2]=ve.max,Ze.center[2]=(Ze.min[2]+Ze.max[2])/2):(he.shouldSplit=Ae(he),he.shouldSplit||(Ze.min[2]=Ze.max[2]=Ze.center[2]=this._centerAltitude))},Ae=he=>{if(he.zoom<W)return!0;if(he.zoom===_e)return!1;if(he.shouldSplit!=null)return he.shouldSplit;const ve=he.aabb.distanceX(F),Ze=he.aabb.distanceY(F);let Qe=$e,Je=1;if(P){Qe=Pe(he.aabb.distanceZ(F));const Ut=Math.pow(2,he.zoom),Rt=o.au((he.y+1)/Ut),kt=o.au(he.y/Ut),hi=Math.min(Math.max(E,Rt),kt),Qt=o.bJ(hi)/o.bJ(E);if(Je=hi===E?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Qt/this._mercatorScaleRatio),this.zoom<=o.bG&&he.zoom===_e-1&&Qt>=.9)return!0}else if(m&&(Qe=Pe(he.aabb.distanceZ(F)*U)),this.projection.isReprojectedInTileSpace&&u<=5){const Ut=Math.pow(2,he.zoom),Rt=ae(new o.L((he.x+.5)/Ut,(he.y+.5)/Ut));Je=Rt>.85?1:Rt}const dt=ve*ve+Ze*Ze+Qe,Ct=Pe((1<<_e-he.zoom)*J*Je*((Ut,Rt)=>{if(Rt*Pe(.707)<Ut)return 1;const kt=Math.sqrt(Rt/Ut);return kt/(1.4144271570014144+(Math.pow(1.1,kt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Qe,$e),dt));return dt<Ct};if(this.renderWorldCopies)for(let he=1;he<=3;he++)fe.push(le(-he)),fe.push(le(he));for(fe.push(le(0));fe.length>0;){const he=fe.pop(),ve=he.x,Ze=he.y;let Qe=he.fullyVisible;const Je=()=>this.projection.name==="globe"&&(he.y===0||he.y===(1<<he.zoom)-1);if(!Qe){let dt=Z?he.aabb.intersects(O):he.aabb.intersectsFlat(O);if(dt===0&&Je()){const Ct=new o.bs(he.zoom,ve,Ze);dt=o.bt(this,M,Ct,!0).intersects(O)}if(dt===0)continue;Qe=dt===2}if(he.zoom!==_e&&Ae(he))for(let dt=0;dt<4;dt++){const Ct=(ve<<1)+dt%2,Ut=(Ze<<1)+(dt>>1),Rt={aabb:x?he.aabb.quadrant(dt):o.bu(this,M,he.zoom+1,Ct,Ut,he.wrap,he.minZ,he.maxZ,this.projection),zoom:he.zoom+1,x:Ct,y:Ut,wrap:he.wrap,fullyVisible:Qe,tileID:void 0,shouldSplit:void 0,minZ:he.minZ,maxZ:he.maxZ};m&&!P&&(Rt.tileID=new o.am(he.zoom+1===_e?Le:he.zoom+1,he.wrap,he.zoom+1,Ct,Ut),ge(Rt)),fe.push(Rt)}else{const dt=he.zoom===_e?Le:he.zoom;if(r.minzoom&&r.minzoom>dt)continue;if(!Qe){let kt=Z?he.aabb.intersectsPrecise(O):he.aabb.intersectsPreciseFlat(O);if(kt===0&&Je()){const hi=new o.bs(he.zoom,ve,Ze);kt=o.bt(this,M,hi,!0).intersectsPrecise(O)}if(kt===0)continue}const Ct=I[0]-(.5+ve+(he.wrap<<he.zoom))*(1<<s-he.zoom),Ut=I[1]-.5-Ze,Rt=he.tileID?he.tileID:new o.am(dt,he.wrap,he.zoom,ve,Ze);Te.push({tileID:Rt,distanceSq:Ct*Ct+Ut*Ut})}}if(this.fogCullDistSq){const he=this.fogCullDistSq,ve=this.horizonLineFromTop();Te=Te.filter(Ze=>{const Qe=[0,0,0,1],Je=[o.V,o.V,0,1],dt=this.calculateFogTileMatrix(Ze.tileID.toUnwrapped());o.a7.transformMat4(Qe,Qe,dt),o.a7.transformMat4(Je,Je,dt);const Ct=o.a7.min([],Qe,Je),Ut=o.a7.max([],Qe,Je),Rt=o.bv(Ct,Ut);if(Rt===0)return!0;let kt=!1;const hi=this._elevation;if(hi&&Rt>he&&ve!==0){const Qt=this.calculateProjMatrix(Ze.tileID.toUnwrapped());let ai;r.isTerrainDEM||(ai=hi.getMinMaxForTile(Ze.tileID)),ai||(ai={min:$,max:Q});const oi=o.bH(this.rotation),Ii=[oi[0]*o.V,oi[1]*o.V,ai.max];o.N.transformMat4(Ii,Ii,Qt),kt=(1-Ii[1])*this.height*.5<ve}return Rt<he||kt})}return Te.sort((he,ve)=>he.distanceSq-ve.distanceSq).map(he=>he.tileID)}resize(r,s){this.width=r,this.height=s,this.pixelsToGLUnits=[2/r,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const s=o.aa(r.lat,-o.bw,o.bw),u=this.projection.project(r.lng,s);return new o.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,s){let u,f;const m=this.centerPoint;if(this.projection.name==="globe"){const b=this.worldSize;u=(s.x-m.x)/b,f=(s.y-m.y)/b}else{const b=this.pointCoordinate(s),E=this.pointCoordinate(m);u=b.x-E.x,f=b.y-E.y}const x=this.locationCoordinate(r);this.setLocation(new o.L(x.x-u,x.y-f))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,s){const u=s?o.bl(s,r.lat):void 0,f=this.projection.project(r.lng,r.lat);return new o.L(f.x,f.y,u)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,s){const u=s??this._centerAltitude,f=[r.x,r.y,0,1],m=[r.x,r.y,1,1];o.a7.transformMat4(f,f,this.pixelMatrixInverse),o.a7.transformMat4(m,m,this.pixelMatrixInverse);const x=m[3];o.a7.scale(f,f,1/f[3]),o.a7.scale(m,m,1/x);const b=f[2],E=m[2];return{p0:f,p1:m,t:b===E?0:(u-b)/(E-b)}}screenPointToMercatorRay(r){const s=[r.x,r.y,0,1],u=[r.x,r.y,1,1];return o.a7.transformMat4(s,s,this.pixelMatrixInverse),o.a7.transformMat4(u,u,this.pixelMatrixInverse),o.a7.scale(s,s,1/s[3]),o.a7.scale(u,u,1/u[3]),s[2]=o.bl(s[2],this._center.lat)*this.worldSize,u[2]=o.bl(u[2],this._center.lat)*this.worldSize,o.a7.scale(s,s,1/this.worldSize),o.a7.scale(u,u,1/this.worldSize),new o.a2([s[0],s[1],s[2]],o.N.normalize([],o.N.sub([],u,s)))}rayIntersectionCoordinate(r){const{p0:s,p1:u,t:f}=r,m=o.bl(s[2],this._center.lat),x=o.bl(u[2],this._center.lat);return new o.L(o.U(s[0],u[0],f)/this.worldSize,o.U(s[1],u[1],f)/this.worldSize,o.U(m,x,f))}pointCoordinate(r,s=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,s)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let s=this.projection.pointCoordinate3D(this,r.x,r.y);if(s)return new o.L(s[0],s[1],s[2]);let u=0,f=this.horizonLineFromTop();if(r.y>f)return this.pointCoordinate(r);const m=.02*f,x=r.clone();for(let b=0;b<10&&f-u>m;b++){x.y=o.U(u,f,.66);const E=this.projection.pointCoordinate3D(this,x.x,x.y);E?(f=x.y,s=E):u=x.y}return s?new o.L(s[0],s[1],s[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=o.bx)return!this.isPointAboveHorizon(r);const s=this.pointCoordinate(r);return s.y>=0&&s.y<=1}_coordinatePoint(r,s){const u=s&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,f=[r.x*this.worldSize,r.y*this.worldSize,u+r.toAltitude(),1];return o.a7.transformMat4(f,f,this.pixelMatrix),f[3]>0?new o.P(f[0]/f[3],f[1]/f[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:s}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,f=this.width-this._edgeInsets.right,m=this.pointLocation3D(new o.P(s,r)),x=this.pointLocation3D(new o.P(f,r)),b=this.pointLocation3D(new o.P(f,u)),E=this.pointLocation3D(new o.P(s,u));let M=Math.min(m.lng,x.lng,b.lng,E.lng),I=Math.max(m.lng,x.lng,b.lng,E.lng),P=Math.min(m.lat,x.lat,b.lat,E.lat),z=Math.max(m.lat,x.lat,b.lat,E.lat);const O=Math.pow(2,-this.zoom)/16*270,j=this.projection.name==="globe"?1:4,U=(G,F,Z,J,W)=>{const Q=(G+Z)/2,$=(F+J)/2,ee=new o.P(Q,$),{lng:ae,lat:le}=this.pointLocation3D(ee),fe=Math.max(0,M-ae,P-le,ae-I,le-z);M=Math.min(M,ae),I=Math.max(I,ae),P=Math.min(P,le),z=Math.max(z,le),(W<j||fe>O)&&(U(G,F,Q,$,W+1),U(Q,$,Z,J,W+1))};if(U(s,r,f,r,1),U(f,r,f,u,1),U(f,u,s,u,1),U(s,u,s,r,1),this.projection.name==="globe"){const[G,F]=o.by(this);G?(z=90,I=180,M=-180):F&&(P=-90,I=180,M=-180)}return new o.ad(new o.bn(M,P),new o.bn(I,z))}_getBoundsRectangular(r,s){const{top:u,left:f}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,b=new o.P(f,u),E=new o.P(x,u),M=new o.P(x,m),I=new o.P(f,m);let P=this.pointCoordinate(b,r),z=this.pointCoordinate(E,r);const O=this.pointCoordinate(M,s),j=this.pointCoordinate(I,s),U=(G,F)=>(F.y-G.y)/(F.x-G.x);return P.y>1&&z.y>=0?P=new o.L((1-j.y)/U(j,P)+j.x,1):P.y<0&&z.y<=1&&(P=new o.L(-j.y/U(j,P)+j.x,0)),z.y>1&&P.y>=0?z=new o.L((1-O.y)/U(O,z)+O.x,1):z.y<0&&P.y<=1&&(z=new o.L(-O.y/U(O,z)+O.x,0)),new o.ad().extend(this.coordinateLocation(P)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(O))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=r.visibleDemTiles.reduce((u,f)=>{if(f.dem){const m=f.dem.tree;u.min=Math.min(u.min,m.minimums[0]),u.max=Math.max(u.max,m.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*r.exaggeration(),s.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-s*(1-this._horizonShift);return r?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.bw,this.maxLat=o.bw,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.a5(this.minLng)*this.tileSize,this.worldMaxX=o.a5(this.maxLng)*this.tileSize,this.worldMinY=o.ae(this.maxLat)*this.tileSize,this.worldMaxY=o.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,s){return this.projection.createTileMatrix(this,s,r)}calculateDistanceTileData(r){const s=r.key,u=this._distanceTileDataCache;if(u[s])return u[s];const f=r.canonical,m=1/this.height,x=this.cameraWorldSize,b=x/this.zoomScale(f.z),E=(f.x+Math.pow(2,f.z)*r.wrap)*b,M=f.y*b,I=this.point;I.x*=x/this.worldSize,I.y*=x/this.worldSize;const P=this.angle,z=Math.sin(-P),O=-Math.cos(-P);return u[s]={bearing:[z,O],center:[(I.x-E)*m,(I.y-M)*m],scale:b/o.V*m},u[s]}calculateFogTileMatrix(r){const s=r.key,u=this._fogTileMatrixCache;if(u[s])return u[s];const f=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return o.a6.multiply(f,this.worldToFogMatrix,f),u[s]=new Float32Array(f),u[s]}calculateProjMatrix(r,s=!1,u=!1){const f=r.key;let m;if(m=u?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,m[f])return m[f];const x=this.calculatePosMatrix(r,this.worldSize);let b;return b=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,o.a6.multiply(x,b,x),m[f]=new Float32Array(x),m[f]}calculatePixelsToTileUnitsMatrix(r){const s=r.tileID.key,u=this._pixelsToTileUnitsCache;if(u[s])return u[s];const f=o.bz(r,this);return u[s]=f,u[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,s=o.a6.fromScaling([],[r,r,r]);return o.a6.multiply(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const s=o.bl(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(s),f=this._camera.forward(),m=o.bl(1,this._center.lat);u[2]/=m,f[2]/=m,o.N.normalize(f,f);const x=r.raycast(u,f,r.exaggeration());if(x){const b=o.N.scaleAndAdd([],u,f,x),E=new o.L(b[0],b[1],o.bl(b[2],o.au(b[1]))),M=(E.z+o.N.length([E.x-u[0],E.y-u[1],E.z-u[2]*m]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(M),this._centerAltitude=E.toAltitude(),this._center=this.coordinateLocation(E),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const s=this._elevation,u=o.bl(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(u),m=s.getAtPointOrZero(new o.L(...f)),x=this.pixelsPerMeter/this.worldSize*m,b=this._minimumHeightOverTerrain(),E=f[2]-x;if(E<=b)if(E<0||r){const M=this.locationCoordinate(this._center,this._centerAltitude),I=[f[0],f[1],M.z-f[2]],P=o.N.length(I);I[2]-=(b-E)/this._pixelsPerMercatorPixel;const z=o.N.length(I);if(z===0)return;o.N.scale(I,I,P/z*this._pixelsPerMercatorPixel),this._camera.position=[f[0],f[1],M.z*this._pixelsPerMercatorPixel-I[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const z=this.center;return z.lat=o.aa(z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(z.lng=o.aa(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}const s=this._unmodified,{x:u,y:f}=this.point;let m=0,x=u,b=f;const E=this.width/2,M=this.height/2,I=this.worldMinY*this.scale,P=this.worldMaxY*this.scale;if(f-M<I&&(b=I+M),f+M>P&&(b=P-M),P-I<this.height&&(m=Math.max(m,this.height/(P-I)),b=(P+I)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const z=this.worldMinX*this.scale,O=this.worldMaxX*this.scale,j=this.worldSize/2-(z+O)/2;x=(u+j+this.worldSize)%this.worldSize-j,x-E<z&&(x=z+E),x+E>O&&(x=O-E),O-z<this.width&&(m=Math.max(m,this.width/(O-z)),x=(O+z)/2)}x===u&&b===f||(this.center=this.unproject(new o.P(x,b))),m&&(this.zoom+=this.scaleZoom(m)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,s=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.bl(1,this.center.lat)/o.bl(1,o.bI));const f=o.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,f),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const m=this.projection.zAxisUnit==="meters"?u:1,x=this._camera.getWorldToCamera(this.worldSize,m);let b;const E=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(E[8]=2*-r.x/this.width,E[9]=2*r.y/this.height,this.isOrthographic){let le=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),fe=le*this.aspect,Te=-fe,_e=-le;fe-=r.x,Te-=r.x,le+=r.y,_e+=r.y,b=this._camera.getCameraToClipOrthographic(Te,fe,_e,le,this._nearZ,this._farZ),((Le,Pe,$e,ge)=>{for(let Ae=0;Ae<16;Ae++)Le[Ae]=Sa(Pe[Ae],$e[Ae],ge)})(b,b,E,wl(this.pitch>=15?1:this.pitch/15))}else b=E;const M=o.a6.mul([],E,x);let I=o.a6.mul([],b,x);if(this.projection.isReprojectedInTileSpace){const le=this.locationCoordinate(this.center),fe=o.a6.identity([]);o.a6.translate(fe,fe,[le.x*this.worldSize,le.y*this.worldSize,0]),o.a6.multiply(fe,fe,o.bB(this)),o.a6.translate(fe,fe,[-le.x*this.worldSize,-le.y*this.worldSize,0]),o.a6.multiply(I,I,fe),o.a6.multiply(M,M,fe),this.inverseAdjustmentMatrix=o.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.a6.scale([],I,[this.worldSize,this.worldSize,this.worldSize/m,1]),this.projMatrix=I,this.invProjMatrix=o.a6.invert(new Float64Array(16),this.projMatrix),s){const le=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);le[8]=2*-r.x/this.width,le[9]=2*r.y/this.height,this.expandedFarZProjMatrix=o.a6.mul([],le,x)}else this.expandedFarZProjMatrix=this.projMatrix;const P=o.a6.invert([],b);this.frustumCorners=o.bD.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const z=new Float32Array(16);o.a6.identity(z),o.a6.scale(z,z,[1,-1,1]),o.a6.rotateX(z,z,this._pitch),o.a6.rotateZ(z,z,this.angle);const O=o.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.a6.clone(O);const j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;O[8]=2*-r.x/this.width,O[9]=2*(r.y+j)/this.height,this.skyboxMatrix=o.a6.multiply(z,O,z);const U=this.point,G=U.x,F=U.y,Z=this.width%2/2,J=this.height%2/2,W=Math.cos(this.angle),Q=Math.sin(this.angle),$=G-Math.round(G)+W*Z+Q*J,ee=F-Math.round(F)+W*J+Q*Z,ae=new Float64Array(I);if(o.a6.translate(ae,ae,[$>.5?$-1:$,ee>.5?ee-1:ee,0]),this.alignedProjMatrix=ae,I=o.a6.create(),o.a6.scale(I,I,[this.width/2,-this.height/2,1]),o.a6.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=o.a6.create(),o.a6.scale(I,I,[1,-1,1]),o.a6.translate(I,I,[-1,-1,0]),o.a6.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=o.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,M),this._calcFogMatrices(),this._distanceTileDataCache={},I=o.a6.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=I,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.bE(this);const le=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.N.transformMat4(le,le,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=I;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,u=this._camera.position,f=1/this.height/this._pixelsPerMercatorPixel,m=[r,r,s];o.N.scale(m,m,f),o.N.scale(u,u,-1),o.N.multiply(u,u,m);const x=o.a6.create();o.a6.translate(x,x,u),o.a6.scale(x,x,m),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,s,f)}_computeCameraPosition(r){const s=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),f=this.point,m=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-r/this.worldSize*this._centerAltitude;return[f.x/this.worldSize-u[0]*m,f.y/this.worldSize-u[1]*m,r/this.worldSize*this._centerAltitude-u[2]*m]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],f=r[2];let m=1;this.projection.wrap&&(this.center=this.center.wrap()),f>0&&(m=Math.min((s-u)/f,1)),this._camera.position=o.N.scaleAndAdd([],this._camera.position,r,m),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,s=this._camera.forward(),{pitch:u,bearing:f}=this._camera.getPitchBearing(),m=o.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.bj(this._maxPitch)),b=Math.max((r[2]-m)/Math.cos(u),x),E=this._zoomFromMercatorZ(b);o.N.scaleAndAdd(r,r,s,b),this._pitch=o.aa(u,o.bj(this.minPitch),o.bj(this.maxPitch)),this.angle=o.bh(f,-Math.PI,Math.PI),this._setZoom(o.aa(E,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.L(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let s=0,u=o.bx,f=0,m=1/0;for(;u-s>1e-6&&u>s;){const x=s+.5*(u-s),b=this.tileSize*Math.pow(2,x),E=this.getCameraToCenterDistance(this.projection,x,b),M=this.scaleZoom(E/(r*this.tileSize)),I=Math.abs(x-M);I<m&&(m=I,f=x),x<M?s=x:u=x}return f}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,s){const u=Math.min(r.x,s.x),f=Math.max(r.x,s.x),m=Math.min(r.y,s.y),x=Math.max(r.y,s.y);if(m<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const b=[new o.P(u,m),new o.P(f,x),new o.P(u,x),new o.P(f,m)],E=this.renderWorldCopies?-3:0,M=this.renderWorldCopies?4:1;for(const I of b){const P=this.pointRayIntersection(I);if(P.t<0)return!0;const z=this.rayIntersectionCoordinate(P);if(z.x<E||z.y<0||z.x>M||z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(r,s){const u=o.N.length(o.N.sub([],this._camera.position,r)),f=this._zoomFromMercatorZ(u)+s;return u-this._mercatorZfromZoom(f)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([s,u,f],m){const x=[s,u,f,1];o.a7.transformMat4(x,x,m);const b=x[3]=Math.max(x[3],1e-6);return x[0]/=b,x[1]/=b,x[2]/=b,x}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,r))}}getCameraToCenterDistance(r,s=this.zoom,u=this.worldSize){const f=o.bA(r,s,this.width,this.height,1024),m=r.pixelSpaceConversion(this.center.lat,u,f);let x=.5/Math.tan(.5*this._fov)*this.height*m;return this.isOrthographic&&(x=Sa(1,x,wl(this.pitch>=15?1:this.pitch/15))),x}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.a6.multiply(r,r,this.globeMatrix),r}getFrustum(r){return o.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}const yn={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},go=(c,r)=>{if(r>0&&c.terrain&&o.w("Cutoff is currently disabled on terrain"),r<=0||c.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=c.transform,u=Math.max(Math.abs(s._zoom-(c.minCutoffZoom-1)),1),f=s.isLODDisabled(!1)?o.O(60,45,s.pitch):o.O(30,15,s.pitch),m=s._farZ-s._nearZ,x=r*s.height,b=((1-(E=f))*s.cameraToCenterDistance+E*(s._farZ+x))*u;var E;return{shouldRenderCutoff:f<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(b-s._nearZ)/m,(b-x-s._nearZ)/m]}}},Dn={cascadeCount:2,shadowMapResolution:2048};class dh{constructor(r,s){this.aabb=r,this.lastCascade=s}}class wf{add(r,s){const u=this.receivers[r.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],s.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],s.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],s.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],s.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],s.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],s.max[2])):this.receivers[r.key]=new dh(s,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,s,u){const f=o.bS.fromPoints(r.points);let m=0;for(const x in this.receivers){const b=this.receivers[x];if(!b||!f.intersectsAabb(b.aabb))continue;b.aabb.min=f.closestPoint(b.aabb.min),b.aabb.max=f.closestPoint(b.aabb.max);const E=b.aabb.getCorners();for(let M=0;M<u.length;M++){let I=!0;for(const P of E){const z=[P[0]*s,P[1]*s,P[2]];if(o.N.transformMat4(z,z,u[M].matrix),z[0]<-1||z[0]>1||z[1]<-1||z[1]>1){I=!1;break}}if(b.lastCascade=M,m=Math.max(m,M),I)break}}return m+1}}class fh{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new wf,this._depthMode=new Zt(r.context.gl.LEQUAL,Zt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,r.tp.registerParameter(Dn,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(Dn,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,s){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const f=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||f<=0||(this._shadowLayerCount=u.style.order.reduce((j,U)=>{const G=u.style._mergedLayers[U];return j+(G.hasShadowPass()&&!G.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const m=u.context,x=Dn.shadowMapResolution,b=Dn.shadowMapResolution;if(this._cascades.length===0||Dn.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let j=0;j<Dn.cascadeCount;++j){const U=u._shadowMapDebug,G=m.gl,F=m.createFramebuffer(x,b,U,"texture"),Z=new o.T(m,{width:x,height:b,data:null},G.DEPTH_COMPONENT);if(F.depthAttachment.set(Z.texture),U){const J=new o.T(m,{width:x,height:b,data:null},G.RGBA);F.colorAttachment.set(J.texture)}this._cascades.push({framebuffer:F,texture:Z,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.bq,scale:0})}}this.shadowDirection=Rc(s);let E=0;if(r.elevation){const j=r.elevation,U=[1e4,-1e4];j.visibleDemTiles.filter(G=>G.dem).forEach(G=>{const F=G.dem.tree;U[0]=Math.min(U[0],F.minimums[0]),U[1]=Math.max(U[1],F.maximums[0])}),U[0]!==1e4&&(E=(U[1]-U[0])*j.exaggeration())}const M=1.5*r.cameraToCenterDistance,I=3*M,P=new Float64Array(16);for(let j=0;j<this._cascades.length;++j){const U=this._cascades[j];let G=r.height/50,F=1;Dn.cascadeCount===1?F=I:j===0?F=M:(G=M,F=I);const[Z,J]=Tf(r,this.shadowDirection,G,F,Dn.shadowMapResolution,E);U.scale=r.scale,U.matrix=Z,U.boundingSphereRadius=J,o.a6.invert(P,U.matrix),U.frustum=o.bq.fromInvProjectionMatrix(P,1,0,!0),U.far=F}const z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[z].far,this._cascades[z].far],this._uniformValues.u_shadow_intensity=f,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Dn.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Dn.shadowMapResolution,this._uniformValues.u_shadowmap_0=yn.ShadowMap0,this._uniformValues.u_shadowmap_1=yn.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const O=u.transform.elevation;for(const j of this._groundShadowTiles){let U={min:0,max:0};if(O){const G=O.getMinMaxForTile(j);G&&(U=G)}this.addShadowReceiver(j.toUnwrapped(),U.min,U.max)}}get enabled(){return this._enabled}set enabled(r){this._enabled=r}drawShadowPass(r,s){if(!this._enabled)return;const u=this.painter,f=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),f.viewport.set([0,0,Dn.shadowMapResolution,Dn.shadowMapResolution]);for(let m=0;m<this._numCascadesToRender;++m){u.currentShadowCascade=m,f.bindFramebuffer.set(this._cascades[m].framebuffer.framebuffer),f.clear({color:o.ax.white,depth:1});for(const x of r.order){const b=r._mergedLayers[x];if(!b.hasShadowPass()||b.isHidden(u.transform.zoom))continue;const E=r.getLayerSourceCache(b),M=E?s[E.id]:void 0;(b.type==="model"||M&&M.length)&&u.renderLayer(u,E,b,M)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const r=this.painter,s=r.style,u=r.context,f=s.directionalLight,m=s.ambientLight;if(!f||!m)return;const x=[],b=go(r,r.longestCutoffRange);b.shouldRenderCutoff&&x.push("RENDER_CUTOFF");const E=El(f,m),M=new Zt(u.gl.LEQUAL,Zt.ReadOnly,r.depthRangeFor3D);for(const I of this._groundShadowTiles){const P=I.toUnwrapped(),z=r.isTileAffectedByFog(I),O=r.getOrCreateProgram("groundShadow",{defines:x,overrideFog:z});this.setupShadows(P,O),r.uploadCommonUniforms(u,O,P,null,b);const j={u_matrix:r.transform.calculateProjMatrix(P),u_ground_shadow_factor:E};O.draw(r,u.gl.TRIANGLES,M,ti.disabled,gi.multiply,Ht.disabled,j,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,{},r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?gi.unblended:gi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const s=this.painter.transform,u=s.calculatePosMatrix(r,s.worldSize);return o.a6.multiply(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(r){return o.a6.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,s,u,f=0){if(!this._enabled)return;const m=this.painter.transform,x=this.painter.context,b=x.gl,E=this._uniformValues,M=new Float64Array(16),I=m.calculatePosMatrix(r,m.worldSize);for(let P=0;P<this._cascades.length;P++)o.a6.multiply(M,this._cascades[P].matrix,I),E[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),x.activeTexture.set(b.TEXTURE0+yn.ShadowMap0+P),this._cascades[P].texture.bind(b.NEAREST,b.CLAMP_TO_EDGE);if(this.useNormalOffset=!!u,this.useNormalOffset){const P=o.bR(r.canonical),z=2/m.tileSize*o.V/Dn.shadowMapResolution,O=z*this._cascades[0].boundingSphereRadius,j=z*this._cascades[this._cascades.length-1].boundingSphereRadius,U=(u==="vector-tile"?1:3)/Math.pow(2,f-r.canonical.z-(1-m.zoom+Math.floor(m.zoom)));E.u_shadow_normal_offset=[P,O*U,j*U],E.u_shadow_bias=[6e-5,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(x,E)}setupShadowsFromMatrix(r,s,u=!1){if(!this._enabled)return;const f=this.painter.context,m=f.gl,x=this._uniformValues,b=new Float64Array(16);for(let E=0;E<Dn.cascadeCount;E++)o.a6.multiply(b,this._cascades[E].matrix,r),x[E===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(b),f.activeTexture.set(m.TEXTURE0+yn.ShadowMap0+E),this._cascades[E].texture.bind(m.NEAREST,m.CLAMP_TO_EDGE);this.useNormalOffset=u,u?(x.u_shadow_normal_offset=[1,5,5],x.u_shadow_bias=[6e-5,.0012,.012]):x.u_shadow_bias=[36e-5,.0012,.012],s.setShadowUniformValues(f,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,s,u,f){if(f[2]>=0)return{};const m=function(E,M,I){const P=I/(1<<E.canonical.z);return new o.bS([E.canonical.x*P+E.wrap*I,E.canonical.y*P+E.wrap*I,0],[(E.canonical.x+1)*P+E.wrap*I,(E.canonical.y+1)*P+E.wrap*I,M])}(r,s,u).getCorners(),x=s/-f[2];f[0]<0?(o.N.add(m[0],m[0],[f[0]*x,0,0]),o.N.add(m[3],m[3],[f[0]*x,0,0])):f[0]>0&&(o.N.add(m[1],m[1],[f[0]*x,0,0]),o.N.add(m[2],m[2],[f[0]*x,0,0])),f[1]<0?(o.N.add(m[0],m[0],[0,f[1]*x,0]),o.N.add(m[1],m[1],[0,f[1]*x,0])):f[1]>0&&(o.N.add(m[2],m[2],[0,f[1]*x,0]),o.N.add(m[3],m[3],[0,f[1]*x,0]));const b={};return b.vertices=m,b.planes=[Wo(m[1],m[0],m[4]),Wo(m[2],m[1],m[5]),Wo(m[3],m[2],m[6]),Wo(m[0],m[3],m[7])],b}addShadowReceiver(r,s,u){this._receivers.add(r,o.bS.fromTileIdAndHeight(r,s,u))}getMaxCascadeForTile(r){const s=this._receivers.get(r);return s&&s.lastCascade?s.lastCascade:0}}function Wo(c,r,s){const u=o.N.sub([],s,r),f=o.N.sub([],c,r),m=o.N.cross([],u,f),x=o.N.length(m);return x===0?[0,0,1,0]:(o.N.scale(m,m,1/x),[m[0],m[1],m[2],-o.N.dot(m,r)])}function Rc(c){const r=c.properties.get("direction"),s=o.bQ(r.x,r.y,r.z);s[2]=o.aa(s[2],0,75);const u=o.bT([s[0],s[1],s[2]]);return o.N.fromValues(u.x,u.y,u.z)}function El(c,r){const s=c.properties.get("color"),u=c.properties.get("intensity"),f=c.properties.get("direction"),m=[f.x,f.y,f.z],x=r.properties.get("color"),b=r.properties.get("intensity"),E=Math.max(o.N.dot([0,0,1],m),0),M=[0,0,0];o.N.scale(M,x.toArray01Linear().slice(0,3),b);const I=[0,0,0];return o.N.scale(I,s.toArray01Linear().slice(0,3),E*u),o.bU([M[0]>0?M[0]/(M[0]+I[0]):0,M[1]>0?M[1]/(M[1]+I[1]):0,M[2]>0?M[2]/(M[2]+I[2]):0])}function Tf(c,r,s,u,f,m){const x=c.zoom,b=c.scale,E=c.worldSize,M=1/E,I=c.aspect,P=Math.sqrt(1+I*I)*Math.tan(.5*c.fovX),z=P*P,O=u-s,j=u+s;let U,G;z>O/j?(U=u,G=u*P):(U=.5*j*(1+z),G=.5*Math.sqrt(O*O+2*(u*u+s*s)*z+j*j*z*z));const F=c.projection.pixelsPerMeter(c.center.lat,E),Z=c._camera.getCameraToWorldMercator(),J=[0,0,-U*M];o.N.transformMat4(J,J,Z);let W=G*M;const Q=c._edgeInsets;if(!(Q.left===0&&Q.top===0&&Q.right===0&&Q.bottom===0||Q.left===Q.right&&Q.top===Q.bottom)){const Qe=c._camera.getWorldToCamera(c.worldSize,c.projection.zAxisUnit==="meters"?F:1),Je=c._camera.getCameraToClipPerspective(c._fov,c.width/c.height,s,u);Je[8]=2*-c.centerOffset.x/c.width,Je[9]=2*c.centerOffset.y/c.height;const dt=new Float64Array(16);o.a6.mul(dt,Je,Qe);const Ct=new Float64Array(16);o.a6.invert(Ct,dt);const Ut=o.bq.fromInvProjectionMatrix(Ct,E,x,!0);for(const Rt of Ut.points){const kt=(($=Rt)[0]/=b,$[1]/=b,$[2]=o.bl($[2],c._center.lat),$);W=Math.max(W,o.N.len(o.N.subtract([],J,kt)))}}var $;W*=f/(f-1);const ee=Math.acos(r[2]),ae=Math.atan2(-r[0],-r[1]),le=new Ea;le.position=J,le.setPitchBearing(ee,ae);const fe=le.getWorldToCamera(E,F),Te=W*E,_e=Math.min(c._mercatorZfromZoom(17)*E*-2,-2*Te),Le=le.getCameraToClipOrthographic(-Te,Te,-Te,Te,_e,(Te+m*F)/r[2]),Pe=new Float64Array(16);o.a6.multiply(Pe,Le,fe);const $e=o.N.fromValues(Math.floor(1e6*J[0])/1e6*E,Math.floor(1e6*J[1])/1e6*E,0),ge=.5*f,Ae=[0,0,0];o.N.transformMat4(Ae,$e,Pe),o.N.scale(Ae,Ae,ge);const he=[Math.floor(Ae[0]),Math.floor(Ae[1]),Math.floor(Ae[2])],ve=[0,0,0];o.N.sub(ve,Ae,he),o.N.scale(ve,ve,-1/ge);const Ze=new Float64Array(16);return o.a6.identity(Ze),o.a6.translate(Ze,Ze,ve),o.a6.multiply(Pe,Ze,Pe),[Pe,Te]}const yo=(c,r)=>It(c,r&&r.filter(s=>s.identifier!=="source.canvas")),Ef=o.ac(Mi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Aa=o.ac(Mi,["setCenter","setZoom","setBearing","setPitch"]),ph={version:8,layers:[],sources:{}},Sf={duration:300,delay:0},f_=new Set(["fill","line","background","hillshade","raster"]);class xs extends o.E{constructor(r,s={}){super(),this.map=r,this.scope=s.scope||"",this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=o.e({},Sf),this._buildingIndex=new mf(this),this.crossTileSymbolIndex=new uh,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new Sr,this.dispatcher=s.dispatcher?s.dispatcher:new o.bW(o.bX(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new ss,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new o.bY(r._requestManager,s.localFontFamily?o.bZ.all:s.localIdeographFontFamily?o.bZ.ideographs:o.bZ.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new Hr(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this.dispatcher.broadcast("setReferrer",o.b_());const u=this;this._rtlTextPluginCallback=xs.registerForPluginStateChange(f=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(m,x)=>{if(o.b$(m),x&&x.every(b=>b))for(const b in u._sourceCaches){const E=u._sourceCaches[b],M=E.getSource().type;M!=="vector"&&M!=="geojson"||E.reload()}})}),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const m=this.getOwnSource(f.sourceId);if(m&&m.vectorLayerIds)for(const x in this._layers){const b=this._layers[x];b.source===m.id&&this._validateLayer(b)}})}loadURL(r,s={}){this.fire(new o.b("dataloading",{dataType:"style"}));const u=typeof s.validate=="boolean"?s.validate:!o.c0(r);r=this.map._requestManager.normalizeStyleURL(r,s.accessToken),this.resolvedImports.add(r);const f=this.importsCache.get(r);if(f)return this._load(f,u);const m=this.map._requestManager.transformRequest(r,o.R.Style);this._request=o.g(m,(x,b)=>{if(this._request=null,x)this.fire(new o.a(x));else if(b)return this.importsCache.set(r,b),this._load(b,u)})}loadJSON(r,s={}){this.fire(new o.b("dataloading",{dataType:"style"})),this._request=o.f.frame(()=>{this._request=null,this._load(r,s.validate!==!1)})}loadEmpty(){this.fire(new o.b("dataloading",{dataType:"style"})),this._load(ph,!1)}_loadImports(r,s,u){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const f=[];for(const m of r){const x=this._createFragmentStyle(m),b=new Promise(I=>{x.once("style.import.load",I),x.once("error",I)}).then(()=>this.mergeAll());if(f.push(b),this.resolvedImports.has(m.url)){x.loadEmpty();continue}const E=m.data||this.importsCache.get(m.url);E?x.loadJSON(E,{validate:s}):m.url?x.loadURL(m.url,{validate:s}):x.loadEmpty();const M={style:x,id:m.id,config:m.config};if(u){const I=this.fragments.findIndex(({id:P})=>P===u);this.fragments=this.fragments.slice(0,I).concat(M).concat(this.fragments.slice(I))}else this.fragments.push(M)}return Promise.allSettled(f)}_createFragmentStyle(r){const s=this.scope?o.ag(r.id,this.scope):r.id,u=new xs(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:r.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return u.setEventedParent(this.map,{style:u}),u}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const r=this.isRootStyle();this._shouldPrecompile=r,this.fire(new o.b(r?"style.load":"style.import.load"))}_load(r,s){const u=r.schema;if(this.isRootStyle()&&(r.fragment||u&&r.fragment!==!1)){const x=o.e({},ph,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(x,s)}if(this.setConfig(this._config,u),s&&yo(this,jt(r)))return;this._loaded=!0,this.stylesheet=o.c1(r);for(const x in r.sources)this.addSource(x,r.sources[x],{validate:!1,isInitialLoad:!0});r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(r.glyphs,this.scope);const f=_f(this.stylesheet.layers);if(this._order=f.map(x=>x.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const x=this.stylesheet.lights[0];this.light=new bt(x.properties,x.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new bt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const x of f){const b=o.c2(x,this.scope,this.options);b.isConfigDependent&&this._configDependentLayers.add(b.fqid),b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize();const E=this.getOwnLayerSourceCache(b),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();E&&b.canCastShadows()&&M&&(E.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const m=this.stylesheet.terrain;m&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(m,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.b("data",{dataType:"style"})),r.imports?this._loadImports(r.imports,s).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let r,s,u,f,m,x,b,E;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(M=>{if(M.stylesheet){if(M.light!=null&&(r=M.light),M.stylesheet.lights)for(const I of M.stylesheet.lights)I.type==="ambient"&&M.ambientLight!=null&&(s=M.ambientLight),I.type==="directional"&&M.directionalLight!=null&&(u=M.directionalLight);f=this._prioritizeTerrain(f,M.terrain,M.stylesheet.terrain),M.stylesheet.fog&&M.fog!=null&&(m=M.fog),M.stylesheet.camera!=null&&(E=M.stylesheet.camera),M.stylesheet.projection!=null&&(x=M.stylesheet.projection),M.stylesheet.transition!=null&&(b=M.stylesheet.transition)}}),this.light=r,this.ambientLight=s,this.directionalLight=u,this.fog=m,f===null?delete this.terrain:this.terrain=f,this.camera=E||{"camera-projection":"perspective"},this.projection=x||{name:"mercator"},this.transition=o.e({},Sf,b),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){const s=u=>{for(const f of u.fragments)s(f.style);r(u)};s(this)}_prioritizeTerrain(r,s,u){const f=r&&r.drapeRenderMode===0;return u===null?s&&s.drapeRenderMode===0?s:f?r:null:s!=null&&(!r||f||s&&s.drapeRenderMode===1)?s:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{r=this._prioritizeTerrain(r,s.terrain,s.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(r=s.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){const r={},s={},u={};this.forEachFragmentStyle(f=>{for(const m in f._sourceCaches){const x=o.ag(m,f.scope);r[x]=f._sourceCaches[m]}for(const m in f._otherSourceCaches){const x=o.ag(m,f.scope);s[x]=f._otherSourceCaches[m]}for(const m in f._symbolSourceCaches){const x=o.ag(m,f.scope);u[x]=f._symbolSourceCaches[m]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=u}mergeLayers(){const r={},s=[],u={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(m=>{for(const x of m._order){const b=m._layers[x];if(b.type==="slot"){const E=o.c3(x);if(r[E])continue;r[E]=[]}b.slot&&r[b.slot]?r[b.slot].push(b):s.push(b)}}),this._mergedOrder=[];const f=(m=[])=>{for(const x of m)if(x.type==="slot"){const b=o.c3(x.id);r[b]&&f(r[b])}else{const b=o.ag(x.id,x.scope);this._mergedOrder.push(b),u[b]=x,x.is3D()&&(this._has3DLayers=!0),x.type==="circle"&&(this._hasCircleLayers=!0),x.type==="symbol"&&(this._hasSymbolLayers=!0)}};f(s),this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=o.e({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(s,u,f){let m,x,b;const E=o.f.devicePixelRatio>1?"@2x":"";let M=o.g(u.transformRequest(u.normalizeSpriteURL(s,E,".json"),o.R.SpriteJSON),(z,O)=>{M=null,b||(b=z,m=O,P())}),I=o.d(u.transformRequest(u.normalizeSpriteURL(s,E,".png"),o.R.SpriteImage),(z,O)=>{I=null,b||(b=z,x=O,P())});function P(){if(b)f(b);else if(m&&x){const z=o.f.getImageData(x),O={};for(const j in m){const{width:U,height:G,x:F,y:Z,sdf:J,pixelRatio:W,stretchX:Q,stretchY:$,content:ee}=m[j],ae=new o.h({width:U,height:G});o.h.copy(z,ae,{x:F,y:Z},{x:0,y:0},{width:U,height:G}),O[j]={data:ae,pixelRatio:W,sdf:J,stretchX:Q,stretchY:$,content:ee}}f(null,O)}}return{cancel(){M&&(M.cancel(),M=null),I&&(I.cancel(),I=null)}}}(r,this.map._requestManager,(s,u)=>{if(this._spriteRequest=null,s)this.fire(new o.a(s));else if(u)for(const f in u)this.imageManager.addImage(f,this.scope,u[f]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.b("data",{dataType:"style"}))})}_validateLayer(r){const s=this.getOwnSource(r.source);if(!s)return;const u=r.sourceLayer;u&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(u)===-1)&&this.fire(new o.a(new Error(`Source layer "${u}" does not exist on source "${s.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,s)=>{const u=this.fragments[s];return u&&u.style&&(r.data=u.style.serialize()),r})}_serializeSources(){const r={};for(const s in this._sourceCaches){const u=this._sourceCaches[s].getSource();r[u.id]||(r[u.id]=u.serialize())}return r}_serializeLayers(r){const s=[];for(const u of r){const f=this._layers[u];f&&f.type!=="custom"&&s.push(f.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&(typeof r.isLayerDraped=="function"?r.isLayerDraped(this.getLayerSourceCache(r)):f_.has(r.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const s=this.getOwnLayer(r);if(s)return s;this.fire(new o.a(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const s=this.getOwnSource(r);if(s)return s;this.fire(new o.a(new Error(`The source '${r}' does not exist in the map's style.`)))}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const s=this.calculateLightsBrightness();r.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s));const u=this._changes.isDirty();if(this._changes.isDirty()){const m=this._changes.getLayerUpdatesByScope();for(const x in m){const{updatedIds:b,removedIds:E}=m[x];(b||E)&&this._updateWorkerLayers(x,b,E)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._changes.reset()}const f={};for(const m in this._mergedSourceCaches){const x=this._mergedSourceCaches[m];f[m]=x.used,x.used=!1,x.tileCoverLift=0}for(const m of this._mergedOrder){const x=this._mergedLayers[m];if(x.recalculate(r,this._availableImages),!x.isHidden(r.zoom)){const b=this.getLayerSourceCache(x);b&&(b.used=!0,b.tileCoverLift=Math.max(b.tileCoverLift,x.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let b=x.minzoom||0;b<(x.maxzoom||25.5);b++){const E=this.map.painter;if(E){const M=x.getProgramIds();if(!M)continue;for(const I of M){const P=x.getDefaultProgramParams(I,r.zoom);P&&(E.style=this,this.fog&&(E._fogVisible=!0,P.overrideFog=!0,E.getOrCreateProgram(I,P)),E._fogVisible=!1,P.overrideFog=!1,E.getOrCreateProgram(I,P),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(P.overrideRtt=!0,E.getOrCreateProgram(I,P)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const m in f){const x=this._mergedSourceCaches[m];f[m]!==x.used&&x.getSource().fire(new o.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new o.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=this._changes.getUpdatedImages();if(r.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],r);this._changes.resetUpdatedImages()}}_updateWorkerLayers(r,s,u){const f=this.getFragmentStyle(r);f&&this.dispatcher.broadcast("updateLayers",{layers:s?f._serializeLayers(s):[],scope:r,removedIds:u||[],options:f.options})}setState(r){if(this._checkLoaded(),yo(this,jt(r)))return!1;(r=o.c1(r)).layers=_f(r.layers);const s=function(f,m){if(!f)return[{command:Mi.setStyle,args:[m]}];let x=[];try{if(!re(f.version,m.version))return[{command:Mi.setStyle,args:[m]}];re(f.center,m.center)||x.push({command:Mi.setCenter,args:[m.center]}),re(f.zoom,m.zoom)||x.push({command:Mi.setZoom,args:[m.zoom]}),re(f.bearing,m.bearing)||x.push({command:Mi.setBearing,args:[m.bearing]}),re(f.pitch,m.pitch)||x.push({command:Mi.setPitch,args:[m.pitch]}),re(f.sprite,m.sprite)||x.push({command:Mi.setSprite,args:[m.sprite]}),re(f.glyphs,m.glyphs)||x.push({command:Mi.setGlyphs,args:[m.glyphs]}),re(f.imports,m.imports)||function(P=[],z=[],O){z=z||[];const j=(P=P||[]).map(fo),U=z.map(fo),G=P.reduce(Ec,{}),F=z.reduce(Ec,{}),Z=j.slice();let J,W,Q,$;for(J=0,W=0;J<j.length;J++)Q=j[J],F.hasOwnProperty(Q)?W++:(O.push({command:Mi.removeImport,args:[Q]}),Z.splice(Z.indexOf(Q,W),1));for(J=0,W=0;J<U.length;J++)Q=U[U.length-1-J],Z[Z.length-1-J]!==Q&&(G.hasOwnProperty(Q)?(O.push({command:Mi.removeImport,args:[Q]}),Z.splice(Z.lastIndexOf(Q,Z.length-W),1)):W++,$=Z[Z.length-J],O.push({command:Mi.addImport,args:[F[Q],$]}),Z.splice(Z.length-J,0,Q));for(const ee of z){const ae=G[ee.id];ae&&!re(ae,ee)&&O.push({command:Mi.updateImport,args:[ee.id,ee]})}}(f.imports,m.imports,x),re(f.transition,m.transition)||x.push({command:Mi.setTransition,args:[m.transition]}),re(f.light,m.light)||x.push({command:Mi.setLight,args:[m.light]}),re(f.fog,m.fog)||x.push({command:Mi.setFog,args:[m.fog]}),re(f.projection,m.projection)||x.push({command:Mi.setProjection,args:[m.projection]}),re(f.lights,m.lights)||x.push({command:Mi.setLights,args:[m.lights]}),re(f.camera,m.camera)||x.push({command:Mi.setCamera,args:[m.camera]});const b={},E=[];(function(P,z,O,j){let U;for(U in z=z||{},P=P||{})P.hasOwnProperty(U)&&(z.hasOwnProperty(U)||Hu(U,O,j));for(U in z){if(!z.hasOwnProperty(U))continue;const G=z[U];P.hasOwnProperty(U)?re(P[U],G)||(P[U].type==="geojson"&&G.type==="geojson"&&o_(P,z,U)?O.push({command:Mi.setGeoJSONSourceData,args:[U,G.data]}):s_(U,z,O,j)):ml(U,z,O)}})(f.sources,m.sources,E,b);const M=[];f.layers&&f.layers.forEach(P=>{P.source&&b[P.source]?x.push({command:Mi.removeLayer,args:[P.id]}):M.push(P)});let I=f.terrain;I&&b[I.source]&&(x.push({command:Mi.setTerrain,args:[void 0]}),I=void 0),x=x.concat(E),re(I,m.terrain)||x.push({command:Mi.setTerrain,args:[m.terrain]}),function(P,z,O){z=z||[];const j=(P=P||[]).map(fo),U=z.map(fo),G=P.reduce(Ec,{}),F=z.reduce(Ec,{}),Z=j.slice(),J=Object.create(null);let W,Q,$,ee,ae,le,fe;for(W=0,Q=0;W<j.length;W++)$=j[W],F.hasOwnProperty($)?Q++:(O.push({command:Mi.removeLayer,args:[$]}),Z.splice(Z.indexOf($,Q),1));for(W=0,Q=0;W<U.length;W++)$=U[U.length-1-W],Z[Z.length-1-W]!==$&&(G.hasOwnProperty($)?(O.push({command:Mi.removeLayer,args:[$]}),Z.splice(Z.lastIndexOf($,Z.length-Q),1)):Q++,le=Z[Z.length-W],O.push({command:Mi.addLayer,args:[F[$],le]}),Z.splice(Z.length-W,0,$),J[$]=!0);for(W=0;W<U.length;W++)if($=U[W],ee=G[$],ae=F[$],!J[$]&&!re(ee,ae))if(re(ee.source,ae.source)&&re(ee["source-layer"],ae["source-layer"])&&re(ee.type,ae.type)){for(fe in ho(ee.layout,ae.layout,O,$,null,Mi.setLayoutProperty),ho(ee.paint,ae.paint,O,$,null,Mi.setPaintProperty),re(ee.slot,ae.slot)||O.push({command:Mi.setSlot,args:[$,ae.slot]}),re(ee.filter,ae.filter)||O.push({command:Mi.setFilter,args:[$,ae.filter]}),re(ee.minzoom,ae.minzoom)&&re(ee.maxzoom,ae.maxzoom)||O.push({command:Mi.setLayerZoomRange,args:[$,ae.minzoom,ae.maxzoom]}),ee)ee.hasOwnProperty(fe)&&fe!=="layout"&&fe!=="paint"&&fe!=="filter"&&fe!=="metadata"&&fe!=="minzoom"&&fe!=="maxzoom"&&fe!=="slot"&&(fe.indexOf("paint.")===0?ho(ee[fe],ae[fe],O,$,fe.slice(6),Mi.setPaintProperty):re(ee[fe],ae[fe])||O.push({command:Mi.setLayerProperty,args:[$,fe,ae[fe]]}));for(fe in ae)ae.hasOwnProperty(fe)&&!ee.hasOwnProperty(fe)&&fe!=="layout"&&fe!=="paint"&&fe!=="filter"&&fe!=="metadata"&&fe!=="minzoom"&&fe!=="maxzoom"&&fe!=="slot"&&(fe.indexOf("paint.")===0?ho(ee[fe],ae[fe],O,$,fe.slice(6),Mi.setPaintProperty):re(ee[fe],ae[fe])||O.push({command:Mi.setLayerProperty,args:[$,fe,ae[fe]]}))}else O.push({command:Mi.removeLayer,args:[$]}),le=Z[Z.lastIndexOf($)+1],O.push({command:Mi.addLayer,args:[ae,le]})}(M,m.layers,x)}catch(b){console.warn("Unable to compute style diff:",b),x=[{command:Mi.setStyle,args:[m]}]}return x}(this.serialize(),r).filter(f=>!(f.command in Aa));if(s.length===0)return!1;const u=s.filter(f=>!(f.command in Ef));if(u.length>0)throw new Error(`Unimplemented: ${u.map(f=>f.command).join(", ")}.`);return s.forEach(f=>{this[f.command].apply(this,f.args)}),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(r,s){return this.getImage(r)?this.fire(new o.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,this.scope,s),this._afterImageUpdated(r),this)}updateImage(r,s){this.imageManager.updateImage(r,this.scope,s)}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._afterImageUpdated(r),this):this.fire(new o.a(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(r),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new o.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(r,s,u={}){return this._checkLoaded(),this._validate(St,`models.${r}`,s,null,u)||(this.modelManager.addModel(r,s,this.scope),this._changes.setDirty()),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope),this):this.fire(new o.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,s,u={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(si,`sources.${r}`,s,null,u))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const f=Qr(r,s,this.dispatcher,this);f.scope=this.scope,f.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(f.id),source:f.serialize(),sourceId:f.id}));const m=x=>{const b=(x?"symbol:":"other:")+f.id,E=o.ag(b,this.scope),M=this._sourceCaches[b]=new gs(E,f,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[f.id]=M,M.onAdd(this.map)};m(!1),s.type!=="vector"&&s.type!=="geojson"||m(!0),f.onAdd&&f.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const s=this.getOwnSource(r);if(!s)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===r)return this.fire(new o.a(new Error(`Source "${r}" cannot be removed while layer "${f}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new o.a(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const u=this.getOwnSourceCaches(r);for(const f of u){const m=o.c3(f.id);delete this._sourceCaches[m],this._changes.discardSourceCacheUpdate(f.id),f.fire(new o.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:f.getSource().id})),f.setEventedParent(null),f.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,s){this._checkLoaded(),this.getOwnSource(r).setData(s),this._changes.setDirty()}getOwnSource(r){const s=this.getOwnSourceCache(r);return s&&s.getSource()}getOwnSources(){const r=[];for(const s in this._otherSourceCaches){const u=this.getOwnSourceCache(s);u&&r.push(u.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const s in r){const u=r[s]._tiles;for(const f in u){const m=u[f];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const f of r){if(this._validate(we,"lights",f))return;switch(f.type){case"ambient":if(this.ambientLight){const m=this.ambientLight;m.set(f),m.updateTransitions(s)}else this.ambientLight=new In(f,Vn,this.scope,this.options);break;case"directional":if(this.directionalLight){const m=this.directionalLight;m.set(f),m.updateTransitions(s)}else this.directionalLight=new In(f,Yr,this.scope,this.options)}}const u=new o.K(this.z||0,s);this.ambientLight&&this.ambientLight.recalculate(u),this.directionalLight&&this.directionalLight.recalculate(u),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,s=this.ambientLight;if(!r||!s)return;const u=P=>.2126*(P[0]<=.03928?P[0]/12.92:Math.pow((P[0]+.055)/1.055,2.4))+.7152*(P[1]<=.03928?P[1]/12.92:Math.pow((P[1]+.055)/1.055,2.4))+.0722*(P[2]<=.03928?P[2]/12.92:Math.pow((P[2]+.055)/1.055,2.4)),f=r.properties.get("color").toArray01(),m=r.properties.get("intensity"),x=r.properties.get("direction"),b=1-o.bQ(x.x,x.y,x.z)[2]/90,E=u(f)*m*b,M=s.properties.get("color").toArray01(),I=s.properties.get("intensity");return(E+u(M)*I)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(!r)return this;if(o.c4(r)){const s=o.c5(r),u=this.fragments.find(({id:m})=>m===s);if(!u)throw new Error(`Style import not found: ${r}`);const f=o.c3(r);return u.style.getFragmentStyle(f)}{const s=this.fragments.find(({id:u})=>u===r);if(!s)throw new Error(`Style import not found: ${r}`);return s.style}}getConfigProperty(r,s){const u=this.getFragmentStyle(r);if(!u)return null;const f=o.ag(s,u.scope),m=u.options.get(f),x=m?m.value||m.default:null;return x?x.serialize():null}setConfigProperty(r,s,u){const f=o.r(u);if(f.result!=="success")return void yo(this,f.value);const m=f.value.expression,x=this.getFragmentStyle(r);if(!x)return;const b=o.ag(s,x.scope),E=x.options.get(b);E&&(this.options.set(b,{...E,value:m}),this.updateConfigDependencies())}setConfig(r,s){if(this._config=r,r||s)if(s)for(const u in s){let f,m;const x=o.r(s[u].default);if(x.result==="success"&&(f=x.value.expression),r&&r[u]!==void 0){const z=o.r(r[u]);z.result==="success"&&(m=z.value.expression)}const{minValue:b,maxValue:E,stepValue:M,type:I,values:P}=s[u];if(f){const z=o.ag(u,this.scope);this.options.set(z,{default:f,value:m,minValue:b,maxValue:E,stepValue:M,type:I,values:P})}else this.fire(new o.a(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new o.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const r of this._configDependentLayers){const s=this.getLayer(r);s&&(s.possiblyEvaluateVisibility(),this._updateLayer(s))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(r,s,u={}){this._checkLoaded();const f=r.id;if(this._layers[f])return void this.fire(new o.a(new Error(`Layer with id "${f}" already exists on this map`)));let m;if(r.type==="custom"){if(yo(this,o.c6(r)))return;m=o.c2(r,this.scope,this.options)}else{if(typeof r.source=="object"&&(this.addSource(f,r.source),r=o.c1(r),r=o.e(r,{source:f})),this._validate(ue,`layers.${f}`,r,{arrayIndex:-1},u))return;m=o.c2(r,this.scope,this.options),this._validateLayer(m),m.setEventedParent(this,{layer:{id:f}}),this._serializedLayers[m.id]=m.serialize()}m.isConfigDependent&&this._configDependentLayers.add(m.fqid);let x=this._order.length;if(s){const I=this._order.indexOf(s);if(I===-1)return void this.fire(new o.a(new Error(`Layer with id "${s}" does not exist on this map.`)));m.slot===this._layers[s].slot?x=I:o.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,f),this._layerOrderChanged=!0,this._layers[f]=m;const b=this.getOwnLayerSourceCache(m),E=!!this.directionalLight&&this.directionalLight.shadowsEnabled();b&&m.canCastShadows()&&E&&(b.castsShadows=!0);const M=this._changes.getRemovedLayer(m);if(M&&m.source&&b&&m.type!=="custom"){this._changes.discardLayerRemoval(m);const I=o.ag(m.source,m.scope);M.type!==m.type?this._changes.updateSourceCache(I,"clear"):(this._changes.updateSourceCache(I,"reload"),b.pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map),m.scope=this.scope,this.mergeLayers()}moveLayer(r,s){this._checkLoaded();const u=this._checkLayer(r);if(!u||r===s)return;const f=this._order.indexOf(r);this._order.splice(f,1);let m=this._order.length;if(s){const x=this._order.indexOf(s);if(x===-1)return void this.fire(new o.a(new Error(`Layer with id "${s}" does not exist on this map.`)));u.slot===this._layers[s].slot?m=x:o.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(m,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const s=this._checkLayer(r);if(!s)return;s.setEventedParent(null);const u=this._order.indexOf(r);this._order.splice(u,1),delete this._layers[r],delete this._serializedLayers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const f=this.getOwnLayerSourceCache(s);if(f&&f.castsShadows){let m=!1;for(const x in this._layers)if(this._layers[x].source===s.source&&this._layers[x].canCastShadows()){m=!0;break}f.castsShadows=m}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const s in this._layers)if(this._layers[s].type===r)return!0;return!1}setLayerZoomRange(r,s,u){this._checkLoaded();const f=this._checkLayer(r);f&&(f.minzoom===s&&f.maxzoom===u||(s!=null&&(f.minzoom=s),u!=null&&(f.maxzoom=u),this._updateLayer(f)))}setSlot(r,s){this._checkLoaded();const u=this._checkLayer(r);u&&u.slot!==s&&(u.slot=s,this._updateLayer(u))}setFilter(r,s,u={}){this._checkLoaded();const f=this._checkLayer(r);if(f&&!re(f.filter,s))return s==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(Ce,`layers.${f.id}.filter`,s,{layerType:f.type},u)||(f.filter=o.c1(s),this._updateLayer(f)))}getFilter(r){const s=this._checkLayer(r);if(s)return o.c1(s.filter)}setLayoutProperty(r,s,u,f={}){this._checkLoaded();const m=this._checkLayer(r);if(m&&!re(m.getLayoutProperty(s),u)){if(u!=null&&(!f||f.validate!==!1)&&yo(m,Xe.call(jt,{key:`layers.${r}.layout.${s}`,layerType:m.type,objectKey:s,value:u,styleSpec:o.D,style:{glyphs:!0,sprite:!0}})))return;m.setLayoutProperty(s,u),m.isConfigDependent&&this._configDependentLayers.add(m.fqid),this._updateLayer(m)}}getLayoutProperty(r,s){const u=this._checkLayer(r);if(u)return u.getLayoutProperty(s)}setPaintProperty(r,s,u,f={}){this._checkLoaded();const m=this._checkLayer(r);if(!m||re(m.getPaintProperty(s),u)||u!=null&&(!f||f.validate!==!1)&&yo(m,Oe.call(jt,{key:`layers.${r}.paint.${s}`,layerType:m.type,objectKey:s,value:u,styleSpec:o.D})))return;const x=m.setPaintProperty(s,u);m.isConfigDependent&&this._configDependentLayers.add(m.fqid),x&&this._updateLayer(m),this._changes.updatePaintProperties(m)}getPaintProperty(r,s){const u=this._checkLayer(r);if(u)return u.getPaintProperty(s)}setFeatureState(r,s){this._checkLoaded();const u=r.source,f=r.sourceLayer,m=this._checkSource(u);if(!m)return;const x=m.type;if(x==="geojson"&&f)return void this.fire(new o.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!f)return void this.fire(new o.a(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.a(new Error("The feature id parameter must be provided.")));const b=this.getOwnSourceCaches(u);for(const E of b)E.setFeatureState(f,r.id,s)}removeFeatureState(r,s){this._checkLoaded();const u=r.source,f=this._checkSource(u);if(!f)return;const m=f.type,x=m==="vector"?r.sourceLayer:void 0;if(m==="vector"&&!x)return void this.fire(new o.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.a(new Error("A feature id is required to remove its specific state property.")));const b=this.getOwnSourceCaches(u);for(const E of b)E.removeFeatureState(x,r.id,s)}getFeatureState(r){this._checkLoaded();const s=r.source,u=r.sourceLayer,f=this._checkSource(s);if(f){if(f.type!=="vector"||u)return r.id===void 0&&this.fire(new o.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(u,r.id);this.fire(new o.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=o.e({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return o.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),s=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return o.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateLayer(r){this._changes.updateLayer(r);const s=this.getLayerSourceCache(r),u=o.ag(r.source,r.scope),f=this._changes.getUpdatedSourceCaches();r.source&&!f[u]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),s.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const s=b=>this._mergedLayers[b].type==="fill-extrusion"||this._mergedLayers[b].type==="model",u=this.order,f={},m=[];for(let b=u.length-1;b>=0;b--){const E=u[b];if(s(E)){f[E]=b;for(const M of r){const I=M[E];if(I)for(const P of I)m.push(P)}}}m.sort((b,E)=>E.intersectionZ-b.intersectionZ);const x=[];for(let b=u.length-1;b>=0;b--){const E=u[b];if(s(E))for(let M=m.length-1;M>=0;M--){const I=m[M].feature;if(f[I.layer.id]<b)break;x.push(I),m.pop()}else for(const M of r){const I=M[E];if(I)for(const P of I)x.push(P.feature)}}return x}queryRenderedFeatures(r,s,u){s&&s.filter&&this._validate(Ce,"queryRenderedFeatures.filter",s.filter,null,s),s.scope=this.scope,s.availableImages=this._availableImages,s.serializedLayers=this._serializedLayers;const f={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.a(new Error("parameters.layers must be an Array."))),[];for(const M of s.layers){const I=this._mergedLayers[M];if(!I)return this.fire(new o.a(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];f[I.source]=!0}}const m=[],x=s.serializedLayers||{},b=s&&s.layers?s.layers.some(M=>{const I=this.getLayer(M);return I&&I.is3D()}):this.has3DLayers(),E=Gr.createFromScreenPoints(r,u);for(const M in this._mergedSourceCaches){const I=this._mergedSourceCaches[M].getSource();if(!I||I.scope!==s.scope)continue;const P=this._mergedSourceCaches[M].getSource().id;s.layers&&!f[P]||m.push(Zu(this._mergedSourceCaches[M],this._mergedLayers,x,E,s,u,b,!!this.map._showQueryGeometry))}return this.placement&&m.push(function(M,I,P,z,O,j,U){const G={},F=j.queryRenderedSymbols(z),Z=[];for(const J of Object.keys(F).map(Number))Z.push(U[J]);Z.sort(xa);for(const J of Z){const W=J.featureIndex.lookupSymbolFeatures(F[J.bucketInstanceId],I,J.bucketIndex,J.sourceLayerIndex,O.filter,O.layers,O.availableImages,M);for(const Q in W){const $=G[Q]=G[Q]||[],ee=W[Q];ee.sort((ae,le)=>{const fe=J.featureSortOrder;if(fe){const Te=fe.indexOf(ae.featureIndex);return fe.indexOf(le.featureIndex)-Te}return le.featureIndex-ae.featureIndex});for(const ae of ee)$.push(ae)}}for(const J in G)G[J].forEach(W=>{const Q=W.feature,$=P(M[J]);if(!$)return;const ee=$.getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=ee});return G}(this._mergedLayers,x,this.getLayerSourceCache.bind(this),E.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(r,s){s&&s.filter&&this._validate(Ce,"querySourceFeatures.filter",s.filter,null,s);const u=this.getOwnSourceCaches(r);let f=[];for(const m of u)f=f.concat(Vs(m,s));return f}addSourceType(r,s,u){return xs.getSourceType(r)?u(new Error(`A source type called "${r}" already exists.`)):(xs.setSourceType(r,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:s.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,s,u={}){this._checkLoaded();const f=this.light.getLight();let m=!1;for(const b in r)if(!re(r[b],f[b])){m=!0;break}if(!m)return;const x=this._getTransitionParameters();this.light.setLight(r,s,u),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,s=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()&&s!==0||delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let u=r;const f=r.source==null;if(s===1){if(typeof u.source=="object"){const b="terrain-dem-src";this.addSource(b,u.source),u=o.c1(u),u=o.e(u,{source:b})}const m=o.e({},u),x={};if(this.terrain&&f){m.source=this.terrain.get().source;const b=this.terrain?this.getFragmentStyle(this.terrain.scope):null;b&&(x.style=b.serialize())}if(this._validate(q,"terrain",m,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!f||this.terrain&&s!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,s),this.fire(new o.b("data",{dataType:"style"}))}else{const m=this.terrain,x=m.get();for(const b of Object.keys(o.D.terrain))!u.hasOwnProperty(b)&&o.D.terrain[b].default&&(u[b]=o.D.terrain[b].default);for(const b in r)if(!re(r[b],x[b])){m.set(r,this.options),this.stylesheet.terrain=r;const E=this._getTransitionParameters({duration:0});m.updateTransitions(E),this.fire(new o.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const s=this.fog=new Ln(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const u=this._getTransitionParameters({duration:0});s.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!re(s.get(),r)){s.set(r,this.options),this.stylesheet.fog=s.get();const u=this._getTransitionParameters({duration:0});s.updateTransitions(u)}}else this._createFog(r);this._markersNeedUpdate=!0}_getTransitionParameters(r){return{now:o.f.now(),transition:o.e(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],s=[];for(const u in this._mergedLayers)this.isLayerDraped(this._mergedLayers[u])?r.push(u):s.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...s)}_createTerrain(r,s){const u=this.terrain=new sr(r,s,this.scope,this.options);s===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const f=this._getTransitionParameters({duration:0});u.updateTransitions(f)}_force3DLayerUpdate(){for(const r in this._layers){const s=this._layers[r];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const s=this._layers[r];s.type==="symbol"&&this._updateLayer(s)}}_validate(r,s,u,f,m={}){if(m&&m.validate===!1)return!1;const x=o.e({},this.serialize());return yo(this,r.call(jt,o.e({key:s,style:x,value:u,styleSpec:o.D},f)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(r){const s=this.getSourceCaches(r);for(const u of s)u.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}reloadSource(r){const s=this.getSourceCaches(r);for(const u of s)u.resume(),u.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}updateSources(r){let s;this.directionalLight&&(s=Rc(this.directionalLight));for(const u in this._mergedSourceCaches)this._mergedSourceCaches[u].update(r,void 0,void 0,s)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const s=this._sourceCaches[r];s.resume(),s.reload()}}_updatePlacement(r,s,u,f,m=!1){let x=!1,b=!1;const E={},M={};for(const I of this._mergedOrder){const P=this._mergedLayers[I];if(P.type!=="symbol")continue;const z=o.ag(P.source,P.scope);let O=E[z];if(!O){const U=this.getLayerSourceCache(P);if(!U)continue;const G=U.getRenderableIds(!0).map(F=>U.getTileByID(F));M[z]=G.slice(),O=E[z]=G.sort((F,Z)=>Z.tileID.overscaledZ-F.tileID.overscaledZ||(F.tileID.isLessThan(Z.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(P,O,r.center.lng,r.projection);x=x||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),m=m||this._layerOrderChanged||u===0,this._layerOrderChanged&&this.fire(new o.b("neworder")),(m||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.f.now(),r.zoom))&&(this.pauseablePlacement=new Ic(r,this._mergedOrder,m,s,u,f,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,E,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.f.now()),b=!0),x&&this.pauseablePlacement.placement.setStale()),b||x){this._buildingIndex.onNewFrame(r.zoom);for(const I of this._mergedOrder){const P=this._mergedLayers[I];P.type==="symbol"&&this.placement.updateLayerOpacities(P,E[o.ag(P.source,P.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.f.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,s){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:m})=>m===r.id)!==-1)return this.fire(new o.a(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!s)return u.push(r),this._loadImports([r],!0),this;const f=u.findIndex(({id:m})=>m===s);return f===-1?this.fire(new o.a(new Error(`Import with id "${s}" does not exist on this map.`))):(this.stylesheet.imports=u.slice(0,f).concat(r).concat(u.slice(f)),this._loadImports([r],!0,s),this)}updateImport(r,s){this._checkLoaded();const u=this.stylesheet.imports||[],f=this.getImportIndex(r);return f===-1?this:typeof s=="string"?(this.setImportUrl(r,s),this):(s.url&&s.url!==u[f].url&&this.setImportUrl(r,s.url),re(s.config,u[f].config)||this.setImportConfig(r,s.config),re(s.data,u[f].data)||this.setImportData(r,s.data),this)}moveImport(r,s){this._checkLoaded();let u=this.stylesheet.imports||[];const f=this.getImportIndex(r);if(f===-1)return this;const m=this.getImportIndex(s);if(m===-1)return this;const x=u[f],b=this.fragments[f];return u=u.filter(({id:E})=>E!==r),this.fragments=this.fragments.filter(({id:E})=>E!==r),this.stylesheet.imports=u.slice(0,m).concat(x).concat(u.slice(m)),this.fragments=this.fragments.slice(0,m).concat(b).concat(this.fragments.slice(m)),this.mergeLayers(),this}setImportUrl(r,s){this._checkLoaded();const u=this.stylesheet.imports||[],f=this.getImportIndex(r);if(f===-1)return this;u[f].url=s;const m=this.fragments[f];return m.style=this._createFragmentStyle(u[f]),m.style.on("style.import.load",()=>this.mergeAll()),m.style.loadURL(s),this}setImportData(r,s){this._checkLoaded();const u=this.getImportIndex(r),f=this.stylesheet.imports||[];return u===-1?this:s?(this.fragments[u].style.setState(s),this._reloadImports(),this):(delete f[u].data,this.setImportUrl(r,f[u].url))}setImportConfig(r,s){this._checkLoaded();const u=this.getImportIndex(r),f=this.stylesheet.imports||[];if(u===-1)return this;s?f[u].config=s:delete f[u].config;const m=this.fragments[u],x=m.style.stylesheet&&m.style.stylesheet.schema;return m.config=s,m.style.setConfig(s,x),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const s=this.stylesheet.imports||[],u=this.getImportIndex(r);return u===-1||(s.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports()),this}getImportIndex(r){const s=(this.stylesheet.imports||[]).findIndex(u=>u.id===r);return s===-1&&this.fire(new o.a(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),s}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const s in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[s];u&&r.push(u.getSource())}return r}getSource(r,s){const u=this.getSourceCache(r,s);return u&&u.getSource()}getLayerSource(r){const s=this.getLayerSourceCache(r);return s&&s.getSource()}getSourceCache(r,s){const u=o.ag(r,s);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(r){const s=o.ag(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(r){const s=[];return this._mergedOtherSourceCaches[r]&&s.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&s.push(this._mergedSymbolSourceCaches[r]),s}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const s in r){const u=r[s];u==="reload"?this.reloadSource(s):u==="clear"&&this.clearSource(s)}}updateLayers(r){const s=this._changes.getUpdatedPaintProperties();for(const u of s){const f=this.getLayer(u);f&&f.updateTransitions(r)}}getImages(r,s,u){this.imageManager.getImages(s.icons,s.scope,u),this._updateTilesForChangedImages();const f=m=>{m&&m.setDependencies(s.tileID.key,s.type,s.icons)};f(this._otherSourceCaches[s.source]),f(this._symbolSourceCaches[s.source])}getGlyphs(r,s,u){this.glyphManager.getGlyphs(s.stacks,s.scope,u)}getResource(r,s,u){return o.c9(s,u)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const s=[];return this._otherSourceCaches[r]&&s.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&s.push(this._symbolSourceCaches[r]),s}_isSourceCacheLoaded(r){const s=this.getOwnSourceCaches(r);return s.length===0?(this.fire(new o.a(new Error(`There is no source with ID '${r}'`))),!1):s.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}xs.getSourceType=function(c){return Ns[c]},xs.setSourceType=function(c,r){Ns[c]=r},xs.registerForPluginStateChange=o.bV;var Lc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Dc=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,zc=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,kc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",mh=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,_h=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Af=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ma=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Ia=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);
#ifdef DATA_FORMAT_UINT32
vec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;
#else
vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));
#endif
return velocity/max(u_max_speed,length(velocity));}
#endif`,gh=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Sl=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Ca=[];xo(Lc,Ca),xo(zc,Ca),xo(Dc,Ca);const Qn={"_prelude_fog.vertex.glsl":_h,"_prelude_terrain.vertex.glsl":mh,"_prelude_shadow.vertex.glsl":gh,"_prelude_fog.fragment.glsl":Af,"_prelude_shadow.fragment.glsl":Sl,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ma,"_prelude_raster_particle.glsl":Ia},Pa={};Li("",mh),Li(Af,_h),Li(Sl,gh),Li(Ma,""),Li(Ia,"");const yh=Li(Dc,zc),Oc=Lc;var xh={background:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Li("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Li(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Li(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Li("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Li("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Li("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Li(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Li(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Li(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Li(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
vec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Li("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`precision highp float;
#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}`),rasterParticleTexture:Li("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Li("void main() {}",`#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);
#ifdef DATA_FORMAT_UINT32
vec2 dp=vec2(0);
#else
vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;
#endif
vec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(
vec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)
);}`),symbolIcon:Li(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:Li(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Li(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Li("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Li(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,kc),skyboxGradient:Li(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,kc),skyboxCapture:Li(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Li(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Li(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Li(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function xo(c,r){const s=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of s)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const f=u.split(" ");for(const m of f)r.includes(m)||r.push(m)}}function Li(c,r){const s=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let f=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);f&&(f=f.map(M=>{const I=M.split(" ");return I[I.length-1]}),f=[...new Set(f)]);const m={},x=[],b=[];if(c=c.replace(s,(M,I)=>(b.push(I),"")),(r=r.replace(s,(M,I)=>(x.push(I),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let E=[...Ca];xo(c,E),xo(r,E);for(const M of[...x,...b])Qn[M]||console.error(`Undefined include: ${M}`),Pa[M]||(Pa[M]=[],xo(Qn[M],Pa[M])),E=[...E,...Pa[M]];return{fragmentSource:c=c.replace(u,(M,I,P,z,O)=>(m[O]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${P} ${z} ${O};
#else
uniform ${P} ${z} u_${O};
#endif
`:I==="initialize"?`
#ifdef HAS_UNIFORM_u_${O}
    ${P} ${z} ${O} = u_${O};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${P} ${z} ${O};
#endif
`:I==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(u,(M,I,P,z,O)=>{const j=z==="float"?"vec2":z,U=O.match(/color/)?"color":j;return I==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${O}
in ${P} ${z} a_${O};
#endif
`:m[O]?I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${P} ${j} a_${O};
out ${P} ${z} ${O};
#else
uniform ${P} ${z} u_${O};
#endif
`:I==="initialize"?U==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${P} ${z} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${U}(a_${O}, u_${O}_t);
#else
    ${P} ${z} ${O} = u_${O};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${P} ${z} a_${O};
    out ${P} ${z} ${O};
#endif
`:I==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${O} = a_${O};
#endif
`:void 0:I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${P} ${j} a_${O};
#else
uniform ${P} ${z} u_${O};
#endif
`:I==="define-instanced"?U==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${O}0;
in vec4 a_${O}1;
in vec4 a_${O}2;
in vec4 a_${O}3;
#else
uniform ${P} ${z} u_${O};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${P} ${j} a_${O};
#else
uniform ${P} ${z} u_${O};
#endif
`:I==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${P} ${z} ${O} = a_${O};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${P} ${z} ${O} = a_${O};
#else
    ${P} ${z} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${P} ${z} ${O} = unpack_mix_${U}(a_${O}, u_${O}_t);
#else
    ${P} ${z} ${O} = u_${O};
#endif
`}),staticAttributes:f,usedDefines:E,vertexIncludes:x,fragmentIncludes:b}}class vh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,s,u,f,m,x,b,E){this.context=r;let M=this.boundPaintVertexBuffers.length!==f.length;for(let P=0;!M&&P<f.length;P++)this.boundPaintVertexBuffers[P]!==f[P]&&(M=!0);let I=this.boundDynamicVertexBuffers.length!==b.length;for(let P=0;!I&&P<b.length;P++)this.boundDynamicVertexBuffers[P]!==b[P]&&(I=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==u||M||I||this.boundIndexBuffer!==m||this.boundVertexOffset!==x)this.freshBind(s,u,f,m,x,b,E);else{r.bindVertexArrayOES.set(this.vao);for(const P of b)P&&(P.bind(),E&&P.instanceCount&&P.setVertexAttribDivisor(r.gl,s,E));m&&m.dynamicDraw&&m.bind()}}freshBind(r,s,u,f,m,x,b){const E=r.numAttributes,M=this.context,I=M.gl;this.vao&&this.destroy(),this.vao=M.gl.createVertexArray(),M.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=f,this.boundVertexOffset=m,this.boundDynamicVertexBuffers=x,s.enableAttributes(I,r),s.bind(),s.setVertexAttribPointers(I,r,m);for(const P of u)P.enableAttributes(I,r),P.bind(),P.setVertexAttribPointers(I,r,m);for(const P of x)P&&(P.enableAttributes(I,r),P.bind(),P.setVertexAttribPointers(I,r,m),b&&P.instanceCount&&P.setVertexAttribDivisor(I,r,b));f&&f.bind(),M.currentNumAttributes=E}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function p_(c,r){const s=Math.pow(2,r.canonical.z),u=r.canonical.y;return[new o.L(0,u/s).toLngLat().lat,new o.L(0,(u+1)/s).toLngLat().lat]}function Bc(c,r,s,u,f,m,x){const b=c.context,E=b.gl,M=s.hillshadeFBO;if(!M)return;c.prepareDrawTile();const I=c.isTileAffectedByFog(r),P=c.getOrCreateProgram("hillshade",{overrideFog:I});b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,M.colorAttachment.get());const z=((G,F,Z,J)=>{const W=Z.paint.get("hillshade-shadow-color"),Q=Z.paint.get("hillshade-highlight-color"),$=Z.paint.get("hillshade-accent-color"),ee=Z.paint.get("hillshade-emissive-strength");let ae=o.bj(Z.paint.get("hillshade-illumination-direction"));if(Z.paint.get("hillshade-illumination-anchor")==="viewport")ae-=G.transform.angle;else if(G.style&&G.style.enable3dLights()&&G.style.directionalLight){const fe=G.style.directionalLight.properties.get("direction"),Te=o.bQ(fe.x,fe.y,fe.z);ae=o.bj(Te[1])}const le=!G.options.moving;return{u_matrix:J||G.transform.calculateProjMatrix(F.tileID.toUnwrapped(),le),u_image:0,u_latrange:p_(0,F.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),ae],u_shadow:W,u_highlight:Q,u_emissive_strength:ee,u_accent:$}})(c,s,u,c.terrain?r.projMatrix:null);c.uploadCommonUniforms(b,P,r.toUnwrapped());const{tileBoundsBuffer:O,tileBoundsIndexBuffer:j,tileBoundsSegments:U}=c.getTileBoundsBuffers(s);P.draw(c,E.TRIANGLES,f,m,x,Ht.disabled,z,u.id,O,j,U)}function Mf(c,r,s){if(!r.needsDEMTextureUpload)return;const u=c.context,f=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||c.getTileTexture(s.stride);const m=s.getPixels();r.demTexture?r.demTexture.update(m,{premultiply:!1}):r.demTexture=new o.T(u,m,f.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function bh(c,r,s){const u=c.context,f=u.gl;if(!r.dem)return;const m=r.dem;if(u.activeTexture.set(f.TEXTURE1),Mf(c,r,m),!r.demTexture)return;r.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE);const x=m.dim;u.activeTexture.set(f.TEXTURE0);let b=r.hillshadeFBO;if(!b){const z=new o.T(u,{width:x,height:x,data:null},f.RGBA);z.bind(f.LINEAR,f.CLAMP_TO_EDGE),b=r.hillshadeFBO=u.createFramebuffer(x,x,!0,"renderbuffer"),b.colorAttachment.set(z.texture)}u.bindFramebuffer.set(b.framebuffer),u.viewport.set([0,0,x,x]);const{tileBoundsBuffer:E,tileBoundsIndexBuffer:M,tileBoundsSegments:I}=c.getMercatorTileBoundsBuffers(),P=[];c.linearFloatFilteringSupported()&&P.push("TERRAIN_DEM_FLOAT_FORMAT"),c.getOrCreateProgram("hillshadePrepare",{defines:P}).draw(c,f.TRIANGLES,Zt.disabled,ti.disabled,gi.unblended,Ht.disabled,((z,O)=>{const j=O.stride,U=o.a6.create();return o.a6.ortho(U,0,o.V,-o.V,0,0,1),o.a6.translate(U,U,[0,-o.V,0]),{u_matrix:U,u_image:1,u_dimension:[j,j],u_zoom:z.overscaledZ}})(r.tileID,m),s.id,E,M,I),r.needsHillshadePrepare=!1}const If=c=>({u_matrix:new o.bK(c),u_image0:new o.bO(c),u_skirt_height:new o.bN(c),u_ground_shadow_factor:new o.bM(c)}),Fc=(c,r,s)=>({u_matrix:c,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:s}),Cf=(c,r,s,u,f,m,x,b,E,M,I,P,z,O,j,U)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:s,u_zoom_transition:f,u_merc_center:m,u_image0:0,u_frustum_tl:x,u_frustum_tr:b,u_frustum_br:E,u_frustum_bl:M,u_globe_pos:I,u_globe_radius:P,u_viewport:z,u_grid_matrix:U?Float32Array.from(U):new Float32Array(9),u_skirt_height:O,u_far_z_cutoff:j});function Al(c,r){return c!=null&&r!=null&&!(!c.hasData()||!r.hasData())&&c.demTexture!=null&&r.demTexture!=null&&c.tileID.key!==r.tileID.key}const Ra=new class{constructor(){this.operations={}}newMorphing(c,r,s,u,f){if(c in this.operations){const m=this.operations[c];m.to.tileID.key!==s.tileID.key&&(m.queued=s)}else this.operations[c]={startTime:u,phase:0,duration:f,from:r,to:s,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const r=this.operations[c];return{from:r.from,to:r.to,phase:r.phase}}update(c){for(const r in this.operations){const s=this.operations[r];for(s.phase=(c-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,c)){delete this.operations[r];break}}}_nextOp(c,r){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=r,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},wh={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Th(c,r,s){if(r===0)return 0;const u=r<1&&s===514?.25/r:1;return 6*Math.pow(1.5,22-c)*Math.max(r,1)*u}function La(c,r){const s=1<<c.z;return!r&&(c.x===0||c.x===s-1)||c.y===0||c.y===s-1}const Eh=c=>({u_matrix:c});function Sh(c,r,s,u,f){if(f>0){const m=o.f.now(),x=(m-c.timeAdded)/f,b=r?(m-r.timeAdded)/f:-1,E=s.getSource(),M=u.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),I=!r||Math.abs(r.tileID.overscaledZ-M)>Math.abs(c.tileID.overscaledZ-M),P=I&&c.refreshedUponExpiration?1:o.aa(I?x:1-b,0,1);return c.refreshedUponExpiration&&x>=1&&(c.refreshedUponExpiration=!1),r?{opacity:1,mix:1-P}:{opacity:P,mix:0}}return{opacity:1,mix:0}}class m_ extends gs{constructor(r){const s={type:"raster-dem",maxzoom:r.transform.maxZoom},u=new o.bW(o.bX(),null),f=Qr("mock-dem",s,u,r.style);super("mock-dem",f,!1),f.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,s){r.state="loaded",s(null)}}class __ extends gs{constructor(r){const s=Qr("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new o.bW(o.bX(),null),r.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,s,u){if(r.freezeTileCoverage)return;this.transform=r;const f=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((m,x)=>{if(m[x.key]="",!this._tiles[x.key]){const b=new uo(x,this._source.tileSize*x.overscaleFactor(),r.tileZoom);b.state="loaded",this._tiles[x.key]=b}return m},{});for(const m in this._tiles)m in f||(this.freeFBO(m),this._tiles[m].unloadVectorData(),delete this._tiles[m])}freeFBO(r){const s=this.proxyCachedFBO[r];if(s!==void 0){const u=Object.values(s);this.renderCachePool.push(...u),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Pf extends o.am{constructor(r,s,u){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=s,this.projMatrix=u}}class g_ extends o.ck{constructor(r,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,f,m]=function(E){const M=new o.aN,I=new o.aw,P=131;M.reserve(17161),I.reserve(33800);const z=o.V/128,O=o.V+z/2,j=O+z;for(let G=-z;G<j;G+=z)for(let F=-z;F<j;F+=z){const Z=F<0||F>O||G<0||G>O?24575:0,J=o.aa(Math.round(F),0,o.V),W=o.aa(Math.round(G),0,o.V);M.emplaceBack(J+Z,W)}const U=(G,F)=>{const Z=F*P+G;I.emplaceBack(Z+1,Z,Z+P),I.emplaceBack(Z+P,Z+P+1,Z+1)};for(let G=1;G<129;G++)for(let F=1;F<129;F++)U(F,G);return[0,129].forEach(G=>{for(let F=0;F<130;F++)U(F,G),U(G,F)}),[M,I,32768]}(),x=r.context;this.gridBuffer=x.createVertexBuffer(u,o.aP.members),this.gridIndexBuffer=x.createIndexBuffer(f),this.gridSegments=o.aB.simpleSegment(0,0,u.length,f.length),this.gridNoSkirtSegments=o.aB.simpleSegment(0,0,u.length,m),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new __(s.map),this.orthoMatrix=o.a6.create(),o.a6.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.V,0,o.V,0,1);const b=x.gl;this._overlapStencilMode=new ti({func:b.GEQUAL,mask:255},0,255,b.KEEP,b.KEEP,b.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new m_(s.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,s,u){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const f=r.terrain.properties,m=r.terrain.drapeRenderMode===0,x=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.f.now();const b=r.terrain&&r.terrain.scope,E=f.get("source"),M=m?this._mockSourceCache:r.getSourceCache(E,b);if(!M)return void o.w(`Couldn't find terrain source "${E}".`);if(this.sourceCache=M,this._exaggeration=x?this.calculateExaggeration(s):f.get("exaggeration"),!s.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;const I=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const P=this.getScaledDemTileSize();this.sourceCache.update(s,P,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,I(),this._initializing=!0),I(),s.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(r){const s=this._previousCameraAltitude,u=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=u;const f=s!=null?u-s:Number.MAX_VALUE;if(Math.abs(f)<2)return this._exaggeration;const m=r.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(m);let b=m-this._previousZoom;const E=this._previousUpdateTimestamp;let M=m;this._evaluationZoom!=null&&(M=this._evaluationZoom,Math.abs(m-M)>.5&&(b=.5*(m-M+b)),b*f<0&&(M+=b)),this._evaluationZoom=M;const I=x.getExaggeration(M),P=I===x.getExaggeration(Math.max(0,M-.1));if(P&&Math.abs(I-this._exaggeration)<.01)return I;let z=Math.min(.1,.00375*(this._updateTimestamp-E));return(P||I<.1||Math.abs(b)<1e-4)&&(z=Math.min(.2,4*z)),o.U(this._exaggeration,I,z)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(o.L.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const f=this.proxyCoords=s.getIds().map(E=>{const M=s.getTileByID(E).tileID;return M.projMatrix=u.calculateProjMatrix(M.toUnwrapped()),M});(function(E,M){const I=M.transform.pointCoordinate(M.transform.getCameraPoint()),P=new o.P(I.x,I.y);E.sort((z,O)=>{if(O.overscaledZ-z.overscaledZ)return O.overscaledZ-z.overscaledZ;const j=new o.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),U=new o.P(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),G=P.mult(1<<z.canonical.z);return G.x-=.5,G.y-=.5,G.distSqr(j)-G.distSqr(U)})})(f,this.painter);const m=this.proxyToSource||{};this.proxyToSource={},f.forEach(E=>{this.proxyToSource[E.key]={}}),this.terrainTileForTile={};const x=this._style._mergedSourceCaches;for(const E in x){const M=x[E];if(!M.used||(M!==this.sourceCache&&this.resetTileLookupCache(M.id),this._setupProxiedCoordsForOrtho(M,r[E],m),M.usedForTerrain))continue;const I=r[E];M.getSource().reparseOverscaled&&this._assignTerrainTiles(I)}this.proxiedCoords[s.id]=f.map(E=>new Pf(E,E.key,this.orthoMatrix)),this._assignTerrainTiles(f),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(m),this.renderingToTexture=!1;const b={};this._visibleDemTiles=[];for(const E of this.proxyCoords){const M=this.terrainTileForTile[E.key];if(!M)continue;const I=M.tileID.key;I in b||(this._visibleDemTiles.push(M),b[I]=I)}}_assignTerrainTiles(r){this._initializing||r.forEach(s=>{if(this.terrainTileForTile[s.key])return;const u=this._findTileCoveringTileID(s,this.sourceCache);u&&(this.terrainTileForTile[s.key]=u)})}_prepareDEMTextures(){const r=this.painter.context,s=r.gl;for(const u in this.terrainTileForTile){const f=this.terrainTileForTile[u],m=f.dem;!m||f.demTexture&&!f.needsDEMTextureUpload||(r.activeTexture.set(s.TEXTURE1),Mf(this.painter,f,m))}}_prepareDemTileUniforms(r,s,u,f){if(!s||s.demTexture==null)return!1;const m=r.tileID.canonical,x=Math.pow(2,s.tileID.canonical.z-m.z),b=f||"";return u[`u_dem_tl${b}`]=[m.x*x%1,m.y*x%1],u[`u_dem_scale${b}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,s=r.gl;if(!this._emptyDepthBufferTexture){const u=new o.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.T(r,u,s.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const s=this._visibleDemTiles.reduce((u,f)=>{if(!f.dem)return u;const m=f.dem.tree.minimums[0];return m>0&&r++,u+m},0);return r?s/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,s=r.gl;r.activeTexture.set(s.TEXTURE2);const u=this._getLoadedAreaMinimum(),[f,m]=(()=>{const b=new o.cm({width:1,height:1},new Float32Array([u]));return[s.R32F,b]})();this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(m,{premultiply:!1}):x=this._emptyDEMTexture=new o.T(r,m,f,{premultiply:!1}),x}setupElevationDraw(r,s,u){const f=this.painter.context,m=f.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};x.u_exaggeration=this.exaggeration();let b=null,E=null,M=1;if(u&&u.morphing&&this._useVertexMorphing){const z=u.morphing.srcDemTile,O=u.morphing.dstDemTile;M=u.morphing.phase,z&&O&&(this._prepareDemTileUniforms(r,z,x,"_prev")&&(E=z),this._prepareDemTileUniforms(r,O,x)&&(b=O))}const I=z=>z&&z.demTexture&&this.painter.linearFloatFilteringSupported()?m.LINEAR:m.NEAREST,P=z=>{x.u_dem_size=z.size[0]===1?1:z.size[0]-2};if(E&&b)f.activeTexture.set(m.TEXTURE2),b.demTexture.bind(I(b),m.CLAMP_TO_EDGE),f.activeTexture.set(m.TEXTURE4),E.demTexture.bind(I(E),m.CLAMP_TO_EDGE),b.demTexture&&P(b.demTexture),x.u_dem_lerp=M;else{b=this.terrainTileForTile[r.tileID.key],f.activeTexture.set(m.TEXTURE2);const z=this._prepareDemTileUniforms(r,b,x)?b.demTexture:this.emptyDEMTexture;z.bind(I(b),m.CLAMP_TO_EDGE),P(z)}if(f.activeTexture.set(m.TEXTURE3),u&&u.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),this._depthFBO&&(x.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),x.u_depth_size_inv=[1,1]),u&&u.useMeterToDem&&b){const z=(1<<b.tileID.canonical.z)*o.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=z}if(u&&u.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),s.setTerrainUniformValues(f,x),this.painter.transform.projection.name==="globe"){const z=this.globeUniformValues(this.painter.transform,r.tileID.canonical,u&&u.useDenormalizedUpVectorScale);s.setGlobeUniformValues(f,z)}}globeUniformValues(r,s,u){const f=r.projection;return{u_tile_tl_up:f.upVector(s,0,0),u_tile_tr_up:f.upVector(s,o.V,0),u_tile_br_up:f.upVector(s,o.V,o.V),u_tile_bl_up:f.upVector(s,0,o.V),u_tile_up_scale:u?o.cl(1):f.upVectorScale(s,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const s=this.painter,u=this.painter.context;r.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(f,m,x,b,E){if(f.transform.projection.name==="globe")(function(M,I,P,z,O){const j=M.context,U=j.gl;let G,F;const Z=M.transform,J=o.cd(M,j,Z),W=(Le,Pe)=>{if(F===Pe)return;const $e=[wh[Pe],"PROJECTION_GLOBE_VIEW"];J&&$e.push("CUSTOM_ANTIALIASING");const ge=M.isTileAffectedByFog(Le);G=M.getOrCreateProgram("globeRaster",{defines:$e,overrideFog:ge}),F=Pe},Q=M.colorModeForRenderPass(),$=new Zt(U.LEQUAL,Zt.ReadWrite,M.depthRangeFor3D);Ra.update(O);const ee=o.ce(Z),ae=[o.a5(Z.center.lng),o.ae(Z.center.lat)],le=M.globeSharedBuffers,fe=[Z.width*o.f.devicePixelRatio,Z.height*o.f.devicePixelRatio],Te=Float32Array.from(Z.globeMatrix),_e={useDenormalizedUpVectorScale:!0};{const Le=M.transform,Pe=Th(Le.zoom,I.exaggeration(),I.sourceCache._source.tileSize);F=-1;const $e=U.TRIANGLES;for(const ge of z){const Ae=P.getTile(ge),he=ti.disabled,ve=I.prevTerrainTileForTile[ge.key],Ze=I.terrainTileForTile[ge.key];Al(ve,Ze)&&Ra.newMorphing(ge.key,ve,Ze,O,250),j.activeTexture.set(U.TEXTURE0),Ae.texture&&Ae.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const Qe=Ra.getMorphValuesForProxy(ge.key),Je=Qe?1:0;Qe&&o.j(_e,{morphing:{srcDemTile:Qe.from,dstDemTile:Qe.to,phase:o.cc(Qe.phase)}});const dt=o.cf(ge.canonical),Ct=o.cg(dt.getCenter().lat),Ut=o.ch(ge.canonical,dt,Ct,Le.worldSize/Le._pixelsPerMercatorPixel),Rt=o.aT(o.ci(ge.canonical)),kt=Cf(Le.expandedFarZProjMatrix,Te,ee,Rt,o.S(Le.zoom),ae,Le.frustumCorners.TL,Le.frustumCorners.TR,Le.frustumCorners.BR,Le.frustumCorners.BL,Le.globeCenterInViewSpace,Le.globeRadius,fe,Pe,Le._farZ,Ut);if(W(ge,Je),G&&(I.setupElevationDraw(Ae,G,_e),M.uploadCommonUniforms(j,G,ge.toUnwrapped()),le)){const[hi,Qt,ai]=le.getGridBuffers(Ct,Pe!==0);G.draw(M,$e,$,he,Q,Ht.backCCW,kt,"globe_raster",hi,Qt,ai)}}}if(le&&(M.renderDefaultNorthPole||M.renderDefaultSouthPole)){const Le=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];J&&Le.push("CUSTOM_ANTIALIASING"),G=M.getOrCreateProgram("globeRaster",{defines:Le});for(const Pe of z){const{x:$e,y:ge,z:Ae}=Pe.canonical,he=ge===0,ve=ge===(1<<Ae)-1,[Ze,Qe,Je,dt]=le.getPoleBuffers(Ae,!1);if(dt&&(he||ve)){const Ct=P.getTile(Pe);j.activeTexture.set(U.TEXTURE0),Ct.texture&&Ct.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let Ut=o.cj(Ae,$e,Z);const Rt=o.aT(o.ci(Pe.canonical)),kt=(hi,Qt)=>hi.draw(M,U.TRIANGLES,$,ti.disabled,Q,Ht.disabled,Cf(Z.expandedFarZProjMatrix,Ut,Ut,Rt,0,ae,Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.globeCenterInViewSpace,Z.globeRadius,fe,0,Z._farZ),"globe_pole_raster",Qt,Je,dt);I.setupElevationDraw(Ct,G,_e),M.uploadCommonUniforms(j,G,Pe.toUnwrapped()),he&&M.renderDefaultNorthPole&&kt(G,Ze),ve&&M.renderDefaultSouthPole&&(Ut=o.a6.scale(o.a6.create(),Ut,[1,-1,1]),kt(G,Qe))}}}})(f,m,x,b,E);else{const M=f.context,I=M.gl;let P,z;const O=f.shadowRenderer,j=go(f,f.longestCutoffRange),U=Q=>{if(z===Q)return;const $=[];$.push(wh[Q]),j.shouldRenderCutoff&&$.push("RENDER_CUTOFF"),P=f.getOrCreateProgram("terrainRaster",{defines:$}),z=Q},G=f.colorModeForRenderPass(),F=new Zt(I.LEQUAL,Zt.ReadWrite,f.depthRangeFor3D);Ra.update(E);const Z=f.transform,J=Th(Z.zoom,m.exaggeration(),m.sourceCache._source.tileSize);let W=[0,0,0];if(O){const Q=f.style.directionalLight,$=f.style.ambientLight;Q&&$&&(W=El(Q,$))}{z=-1;const Q=I.TRIANGLES,[$,ee]=[m.gridIndexBuffer,m.gridSegments];for(const ae of b){const le=x.getTile(ae),fe=ti.disabled,Te=m.prevTerrainTileForTile[ae.key],_e=m.terrainTileForTile[ae.key];Al(Te,_e)&&Ra.newMorphing(ae.key,Te,_e,E,250),M.activeTexture.set(I.TEXTURE0),le.texture&&le.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE);const Le=Ra.getMorphValuesForProxy(ae.key),Pe=Le?1:0;let $e;Le&&($e={morphing:{srcDemTile:Le.from,dstDemTile:Le.to,phase:o.cc(Le.phase)}});const ge=Fc(ae.projMatrix,La(ae.canonical,Z.renderWorldCopies)?J/10:J,W);if(U(Pe),!P)continue;m.setupElevationDraw(le,P,$e);const Ae=ae.toUnwrapped();O&&O.setupShadows(Ae,P),f.uploadCommonUniforms(M,P,Ae,null,j),P.draw(f,Q,F,fe,G,Ht.backCCW,ge,"terrain_raster",m.gridBuffer,$,ee)}}}}(s,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const s=this.painter,u=this.painter.context,f=this.proxySourceCache,m=this.proxiedCoords[f.id],x=this._drapedRenderBatches.shift(),b=s.style.order,E=[];let M=0;for(const I of m){const P=f.getTileByID(I.proxyTileKey),z=f.proxyCachedFBO[I.key]?f.proxyCachedFBO[I.key][r]:void 0,O=z!==void 0?f.renderCache[z]:this.pool[M++],j=z!==void 0;if(P.texture=O.tex,j&&!O.dirty){E.push(P.tileID);continue}let U;u.bindFramebuffer.set(O.fb.framebuffer),this.renderedToTile=!1,O.dirty&&(u.clear({color:o.ax.transparent,stencil:0}),O.dirty=!1);for(let G=x.start;G<=x.end;++G){const F=s.style._mergedLayers[b[G]];if(F.isHidden(s.transform.zoom))continue;const Z=s.style.getLayerSourceCache(F),J=Z?this.proxyToSource[I.key][Z.id]:[I];if(!J)continue;const W=J;u.viewport.set([0,0,O.fb.width,O.fb.height]),U!==(Z?Z.id:null)&&(this._setupStencil(O,J,F,Z),U=Z?Z.id:null),s.renderLayer(s,Z,F,W)}if(this._drapedRenderBatches.length===0)for(const G of this._pendingGroundEffectLayers){const F=s.style._mergedLayers[b[G]];if(F.isHidden(s.transform.zoom))continue;const Z=s.style.getLayerSourceCache(F),J=Z?this.proxyToSource[I.key][Z.id]:[I];if(!J)continue;const W=J;u.viewport.set([0,0,O.fb.width,O.fb.height]),U!==(Z?Z.id:null)&&(this._setupStencil(O,J,F,Z),U=Z?Z.id:null),s.renderLayer(s,Z,F,W)}this.renderedToTile?(O.dirty=!0,E.push(P.tileID)):j||--M,M===5&&(M=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,s.width,s.height]),x.end+1}postRender(){}isLayerOrderingCorrect(r){const s=r.order.length;let u=-1,f=s;for(let m=0;m<s;++m)this._style.isLayerDraped(r._mergedLayers[r.order[m]])?u=Math.max(u,m):f=Math.min(f,m);return f>u}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{r=Math.min(r,s.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,s,u){if(!this._visibleDemTiles)return null;const f=this._visibleDemTiles.filter(m=>m.dem).map(m=>{const x=m.tileID,b=1<<x.overscaledZ,{x:E,y:M}=x.canonical,I=E/b,P=(E+1)/b,z=M/b,O=(M+1)/b;return{minx:I,miny:z,maxx:P,maxy:O,t:m.dem.tree.raycastRoot(I,z,P,O,r,s,u),tile:m}});f.sort((m,x)=>(m.t!==null?m.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(const m of f){if(m.t==null)return null;const x=m.tile.dem.tree.raycast(m.minx,m.miny,m.maxx,m.maxy,r,s,u);if(x!=null)return x}return null}_createFBO(){const r=this.painter.context,s=r.gl,u=this.drapeBufferSize;r.activeTexture.set(s.TEXTURE0);const f=new o.T(r,{width:u[0],height:u[1],data:null},s.RGBA);f.bind(s.LINEAR,s.CLAMP_TO_EDGE);const m=r.createFramebuffer(u[0],u[1],!0,null);return m.colorAttachment.set(f.texture),m.depthAttachment=new jn(r,m.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,m.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):m.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:m,tex:f,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const s=this._style._mergedLayers[r],u=s.isHidden(this.painter.transform.zoom);return s.type==="custom"?!u&&s.shouldRedrape():!u&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const u of this._style.getSources())if(u instanceof pt){r=!0;break}if(!r)return;const s={};for(let u=0;u<this._style.order.length;++u){const f=this._style._mergedLayers[this._style.order[u]],m=this._style.getLayerSourceCache(f);if(m&&!s[m.id]&&!f.isHidden(this.painter.transform.zoom)&&f.type==="line"&&f.widthExpression()instanceof o.Z){s[m.id]=!0;for(const x of this.proxyCoords){const b=this.proxyToSource[x.key][m.id];if(b)for(const E of b)this._clearRenderCacheForTile(m.id,E)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof mt){r=!0;break}if(!r)return;const s={};for(let u=0;u<this._style.order.length;++u){const f=this._style._mergedLayers[this._style.order[u]],m=this._style.getLayerSourceCache(f);if(!m||s[m.id]||f.isHidden(this.painter.transform.zoom)||f.type!=="raster")continue;const x=f.paint.get("raster-fade-duration");for(const b of this.proxyCoords){const E=this.proxyToSource[b.key][m.id];if(E)for(const M of E){const I=Sh(m.getTile(M),m.findLoadedParent(M,0),m,this.painter.transform,x);(I.opacity!==1||I.mix!==0)&&this._clearRenderCacheForTile(m.id,M)}}}}_setupDrapedRenderBatches(){const r=this._style.order,s=r.length;if(s===0)return;const u=[];this._pendingGroundEffectLayers=[];let f,m=0,x=this._style._mergedLayers[r[m]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++m<s;)x=this._style._mergedLayers[r[m]];for(;m<s;++m){const b=this._style._mergedLayers[r[m]];b.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(b)?f===void 0&&(f=m):(b.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(m),f!==void 0&&(u.push({start:f,end:m-1}),f=void 0)))}if(f!==void 0&&u.push({start:f,end:m-1}),u.length!==0){const b=u[u.length-1];this._pendingGroundEffectLayers.every(E=>E>b.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(r){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const x=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let b=0;b<x.length;++b){const E=Object.values(x[b]);s.renderCachePool.push(...E)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,f=this._tilesDirty;for(let x=u.length-1;x>=0;x--){const b=u[x];if(s.getTileByID(b.key),s.proxyCachedFBO[b.key]!==void 0){const E=r[b.key],M=this.proxyToSource[b.key];let I=0;for(const P in M){const z=M[P],O=E[P];if(!O||O.length!==z.length||z.some((j,U)=>j!==O[U]||f[P]&&f[P].hasOwnProperty(j.key))){I=-1;break}++I}for(const P in s.proxyCachedFBO[b.key])s.renderCache[s.proxyCachedFBO[b.key][P]].dirty=I<0||I!==Object.values(E).length}}const m=[...this._drapedRenderBatches];m.sort((x,b)=>b.end-b.start-(x.end-x.start));for(const x of m)for(const b of u){if(s.proxyCachedFBO[b.key])continue;let E=s.renderCachePool.pop();E===void 0&&s.renderCache.length<50&&(E=s.renderCache.length,s.renderCache.push(this._createFBO())),E!==void 0&&(s.proxyCachedFBO[b.key]={},s.proxyCachedFBO[b.key][x.start]=E,s.renderCache[E].dirty=!0)}this._tilesDirty={}}_setupStencil(r,s,u,f){if(!f||!this._sourceTilesOverlap[f.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const m=this.painter.context,x=m.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let b;if(u.isTileClipped())b=s.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);b=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+b>255&&(m.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=b,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):ti.disabled}_renderTileClippingMasks(r,s){const u=this.painter,f=this.painter.context,m=f.gl;u._tileClippingMaskIDs={},f.setColorMode(gi.disabled),f.setDepthMode(Zt.disabled);const x=u.getOrCreateProgram("clippingMask");for(const b of r){const E=u._tileClippingMaskIDs[b.key]=--s;x.draw(u,m.TRIANGLES,Zt.disabled,new ti({func:m.ALWAYS,mask:0},E,255,m.KEEP,m.KEEP,m.REPLACE),gi.disabled,Ht.disabled,Eh(b.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(r){const s=this.painter.transform;if(r.x<0||r.x>s.width||r.y<0||r.y>s.height)return null;const u=[r.x,r.y,1,1];o.a7.transformMat4(u,u,s.pixelMatrixInverse),o.a7.scale(u,u,1/u[3]),u[0]/=s.worldSize,u[1]/=s.worldSize;const f=s._camera.position,m=o.bl(1,s.center.lat),x=[f[0],f[1],f[2]/m,0],b=o.N.subtract([],u.slice(0,3),x);o.N.normalize(b,b);const E=this.raycast(x,b,this._exaggeration);return E!==null&&E?(o.N.scaleAndAdd(x,x,b,E),x[3]=x[2],x[2]*=m,x):null}drawDepth(){const r=this.painter,s=r.context,u=this.proxySourceCache,f=Math.ceil(r.width),m=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===f&&this._depthFBO.height===m||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const x=s.gl,b=s.createFramebuffer(f,m,!0,"renderbuffer");s.activeTexture.set(x.TEXTURE0);const E=new o.T(s,{width:f,height:m,data:null},x.RGBA);E.bind(x.NEAREST,x.CLAMP_TO_EDGE),b.colorAttachment.set(E.texture);const M=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,f,m);b.depthAttachment.set(M),this._depthFBO=b,this._depthTexture=E}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,f,m]),function(x,b,E,M){if(x.transform.projection.name==="globe")return;const I=x.context,P=I.gl;I.clear({depth:1});const z=x.getOrCreateProgram("terrainDepth"),O=new Zt(P.LESS,Zt.ReadWrite,x.depthRangeFor3D);for(const j of M){const U=E.getTile(j),G=Fc(j.projMatrix,0,[0,0,0]);b.setupElevationDraw(U,z),z.draw(x,P.TRIANGLES,O,ti.disabled,gi.unblended,Ht.backCCW,G,"terrain_depth",b.gridBuffer,b.gridIndexBuffer,b.gridNoSkirtSegments)}}(r,this,u,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,s,u){if(r.getSource()instanceof o.ap)return this._setupProxiedCoordsForImageSource(r,s,u);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const f=this.proxiedCoords[r.id]=[],m=this.proxyCoords;for(let E=0;E<m.length;E++){const M=m[E],I=this._findTileCoveringTileID(M,r);if(I){const P=this._createProxiedId(M,I,u[M.key]&&u[M.key][r.id]);f.push(P),this.proxyToSource[M.key][r.id]=[P]}}let x=!1;const b=new Set;for(let E=0;E<s.length;E++){const M=r.getTile(s[E]);if(!M||!M.hasData())continue;const I=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(I&&I.tileID.canonical.z!==M.tileID.canonical.z){const P=this.proxyToSource[I.tileID.key][r.id],z=this._createProxiedId(I.tileID,M,u[I.tileID.key]&&u[I.tileID.key][r.id]);P?P.splice(P.length-1,0,z):this.proxyToSource[I.tileID.key][r.id]=[z];const O=this.proxyToSource[I.tileID.key][r.id];b.has(O)||b.add(O),f.push(z),x=!0}}if(this._sourceTilesOverlap[r.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(const E of b)E.sort((M,I)=>I.overscaledZ-M.overscaledZ)}_setupProxiedCoordsForImageSource(r,s,u){if(!r.getSource().loaded())return;const f=this.proxiedCoords[r.id]=[],m=this.proxyCoords,x=r.getSource(),b=x.tileID;if(!b)return;const E=new o.P(b.x,b.y)._div(1<<b.z),M=x.coordinates.map(o.L.fromLngLat).reduce((P,z)=>(P.min.x=Math.min(P.min.x,z.x-E.x),P.min.y=Math.min(P.min.y,z.y-E.y),P.max.x=Math.max(P.max.x,z.x-E.x),P.max.y=Math.max(P.max.y,z.y-E.y),P),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),I=(P,z)=>{const O=P.wrap+P.canonical.x/(1<<P.canonical.z),j=P.canonical.y/(1<<P.canonical.z),U=o.V/(1<<P.canonical.z),G=z.wrap+z.canonical.x/(1<<z.canonical.z),F=z.canonical.y/(1<<z.canonical.z);return O+U<G+M.min.x||O>G+M.max.x||j+U<F+M.min.y||j>F+M.max.y};for(let P=0;P<m.length;P++){const z=m[P];for(let O=0;O<s.length;O++){const j=r.getTile(s[O]);if(!j||!j.hasData()||I(z,j.tileID))continue;const U=this._createProxiedId(z,j,u[z.key]&&u[z.key][r.id]),G=this.proxyToSource[z.key][r.id];G?G.push(U):this.proxyToSource[z.key][r.id]=[U],f.push(U)}}}_createProxiedId(r,s,u){let f=this.orthoMatrix;if(u){const m=u.find(x=>x.key===s.tileID.key);if(m)return m}if(s.tileID.key!==r.key){const m=r.canonical.z-s.tileID.canonical.z;let x,b,E;f=o.a6.create();const M=s.tileID.wrap-r.wrap<<r.overscaledZ;m>0?(x=o.V>>m,b=x*((s.tileID.canonical.x<<m)-r.canonical.x+M),E=x*((s.tileID.canonical.y<<m)-r.canonical.y)):(x=o.V<<-m,b=o.V*(s.tileID.canonical.x-(r.canonical.x+M<<-m)),E=o.V*(s.tileID.canonical.y-(r.canonical.y<<-m))),o.a6.ortho(f,0,x,0,x,0,1),o.a6.translate(f,f,[b,E,0])}return new Pf(s.tileID,r.key,f)}_findTileCoveringTileID(r,s){let u=s.getTile(r);if(u&&u.hasData())return u;const f=this._findCoveringTileCache[s.id],m=f[r.key];if(u=m?s.getTileByID(m):null,u&&u.hasData()||m===null)return u;let x=u?u.tileID:r,b=x.overscaledZ;const E=s.getSource().minzoom,M=[];if(!m){const P=s.getSource().maxzoom;if(r.canonical.z>=P){const z=r.canonical.z-P;s.getSource().reparseOverscaled?(b=Math.max(r.canonical.z+2,s.transform.tileZoom),x=new o.am(b,r.wrap,P,r.canonical.x>>z,r.canonical.y>>z)):z!==0&&(b=P,x=new o.am(b,r.wrap,P,r.canonical.x>>z,r.canonical.y>>z))}x.key!==r.key&&(M.push(x.key),u=s.getTile(x))}const I=P=>{M.forEach(z=>{f[z]=P}),M.length=0};for(b-=1;b>=E&&(!u||!u.hasData());b--){u&&I(u.tileID.key);const P=x.calculateScaledKey(b);if(u=s.getTileByID(P),u&&u.hasData())break;const z=f[P];if(z===null)break;z===void 0?M.push(P):u=s.getTileByID(z)}return I(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,s){let u=this._tilesDirty[r];u||(u=this._tilesDirty[r]={}),u[s.key]=!0}}function Ah(c,r,s){const u=function(b,E,M){const I=o.N.dot(E,b),P=o.N.dot(M,[.2126,.7152,.0722]),z=(j,U,G)=>(1-G)*j+G*U,O=z(1-.3*Math.min(P,1),1,Math.min(I+1,1));return z(.92,1,Math.asin(o.aa(E[2],-1,1))/Math.PI+.5)*O}(c,[0,0,1],r),f=[0,0,0];o.N.scale(f,s.slice(0,3),u);const m=[0,0,0];o.N.scale(m,r.slice(0,3),c[2]);const x=[0,0,0];return o.N.add(x,f,m),o.bU(x)}const Mh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Rf=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Ih{static cacheKey(r,s,u,f){let m=`${s}${f?f.cacheKey:""}`;for(const x of u)r.usedDefines.includes(x)&&(m+=`/${x}`);return m}constructor(r,s,u,f,m,x,b){const E=r.gl;this.program=E.createProgram(),this.configuration=f,this.name=s,this.fixedDefines=[...x];const M=f?f.getBinderAttributes():[],I=(u.staticAttributes||[]).concat(M);let P=f?f.defines():[];P=P.concat(x.map(F=>`#define ${F}`));const z=`#version 300 es
`;let O=z+P.concat("precision mediump float;",Oc,yh.fragmentSource).join(`
`);for(const F of u.fragmentIncludes)O+=`
${Qn[F]}`;O+=`
${u.fragmentSource}`;let j=z+P.concat("precision highp float;",Oc,yh.vertexSource).join(`
`);for(const F of u.vertexIncludes)j+=`
${Qn[F]}`;j+=`
${u.vertexSource}`;const U=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(U,O),E.compileShader(U),E.attachShader(this.program,U);const G=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(G,j),E.compileShader(G),E.attachShader(this.program,G),this.attributes={},this.numAttributes=I.length;for(let F=0;F<this.numAttributes;F++)if(I[F]){const Z=I[F].startsWith("a_")?I[F]:`a_${I[F]}`;E.bindAttribLocation(this.program,F,Z),this.attributes[Z]=F}b&&b.shaderVaryings.length>0&&E.transformFeedbackVaryings(this.program,b.shaderVaryings,b.bufferMode),E.linkProgram(this.program),E.deleteShader(G),E.deleteShader(U),this.fixedUniforms=m(r),this.binderUniforms=f?f.getUniforms(r):[],x.includes("TERRAIN")&&(this.terrainUniforms=(F=>({u_dem:new o.bO(F),u_dem_prev:new o.bO(F),u_dem_tl:new o.bL(F),u_dem_scale:new o.bN(F),u_dem_tl_prev:new o.bL(F),u_dem_scale_prev:new o.bN(F),u_dem_size:new o.bN(F),u_dem_lerp:new o.bN(F),u_exaggeration:new o.bN(F),u_depth:new o.bO(F),u_depth_size_inv:new o.bL(F),u_meter_to_dem:new o.bN(F),u_label_plane_matrix_inv:new o.bK(F)}))(r)),x.includes("GLOBE")&&(this.globeUniforms=(F=>({u_tile_tl_up:new o.bM(F),u_tile_tr_up:new o.bM(F),u_tile_br_up:new o.bM(F),u_tile_bl_up:new o.bM(F),u_tile_up_scale:new o.bN(F)}))(r)),x.includes("FOG")&&(this.fogUniforms=(F=>({u_fog_matrix:new o.bK(F),u_fog_range:new o.bL(F),u_fog_color:new o.bP(F),u_fog_horizon_blend:new o.bN(F),u_fog_vertical_limit:new o.bL(F),u_fog_temporal_offset:new o.bN(F),u_frustum_tl:new o.bM(F),u_frustum_tr:new o.bM(F),u_frustum_br:new o.bM(F),u_frustum_bl:new o.bM(F),u_globe_pos:new o.bM(F),u_globe_radius:new o.bN(F),u_globe_transition:new o.bN(F),u_is_globe:new o.bO(F),u_viewport:new o.bL(F)}))(r)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(F=>({u_cutoff_params:new o.bP(F)}))(r)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(F=>({u_lighting_ambient_color:new o.bM(F),u_lighting_directional_dir:new o.bM(F),u_lighting_directional_color:new o.bM(F),u_ground_radiance:new o.bM(F)}))(r)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(F=>({u_light_matrix_0:new o.bK(F),u_light_matrix_1:new o.bK(F),u_fade_range:new o.bL(F),u_shadow_normal_offset:new o.bM(F),u_shadow_intensity:new o.bN(F),u_shadow_texel_size:new o.bN(F),u_shadow_map_resolution:new o.bN(F),u_shadow_direction:new o.bM(F),u_shadow_bias:new o.bM(F),u_shadowmap_0:new o.bO(F),u_shadowmap_1:new o.bO(F)}))(r))}}setTerrainUniformValues(r,s){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const f in s)u[f]&&u[f].set(this.program,f,s[f])}}setGlobeUniformValues(r,s){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const f in s)u[f]&&u[f].set(this.program,f,s[f])}}setFogUniformValues(r,s){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const f in s)u[f].set(this.program,f,s[f])}}setCutoffUniformValues(r,s){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const f in s)u[f].set(this.program,f,s[f])}}setLightsUniformValues(r,s){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const f in s)u[f].set(this.program,f,s[f])}}setShadowUniformValues(r,s){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;r.program.set(this.program);for(const f in s)u[f].set(this.program,f,s[f])}_drawDebugWireframe(r,s,u,f,m,x,b,E,M,I){const P=r.options.wireframe;if(P.terrain===!1&&P.layers2D===!1&&P.layers3D===!1)return;const z=r.context;if(!(!(!P.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!P.layers2D||r._terrain&&r._terrain.renderingToTexture||!Mh.includes(this.name))||!(!P.layers3D||!Rf.includes(this.name))))return;const O=z.gl,j=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,m,z);if(!j)return;const U=[...this.fixedDefines];U.push("DEBUG_WIREFRAME");const G=r.getOrCreateProgram(this.name,{config:this.configuration,defines:U});z.program.set(G.program);const F=(W,Q,$)=>{if(Q[W]&&$[W])for(const ee in Q[W])$[W][ee]&&$[W][ee].set($.program,ee,Q[W][ee].current)};M&&M.setUniforms(G.program,z,G.binderUniforms,b,{zoom:E}),F("fixedUniforms",this,G),F("terrainUniforms",this,G),F("globeUniforms",this,G),F("fogUniforms",this,G),F("lightsUniforms",this,G),F("shadowUniforms",this,G),j.bind(),z.setColorMode(new gi([O.ONE,O.ONE_MINUS_SRC_ALPHA,O.ZERO,O.ONE],o.ax.transparent,[!0,!0,!0,!1])),z.setDepthMode(new Zt(s.func===O.LESS?O.LEQUAL:s.func,Zt.ReadOnly,s.range)),z.setStencilMode(ti.disabled);const Z=3*x.primitiveLength*2,J=3*x.primitiveOffset*2*2;I&&I>1?O.drawElementsInstanced(O.LINES,Z,O.UNSIGNED_SHORT,J,I):O.drawElements(O.LINES,Z,O.UNSIGNED_SHORT,J),m.bind(),z.program.set(this.program),z.setDepthMode(s),z.setStencilMode(u),z.setColorMode(f)}draw(r,s,u,f,m,x,b,E,M,I,P,z,O,j,U,G,F){const Z=r.context,J=Z.gl;if(this.failedToCreate)return;Z.program.set(this.program),Z.setDepthMode(u),Z.setStencilMode(f),Z.setColorMode(m),Z.setCullFace(x);for(const ee of Object.keys(this.fixedUniforms))this.fixedUniforms[ee].set(this.program,ee,b[ee]);j&&j.setUniforms(this.program,Z,this.binderUniforms,z,{zoom:O});const W={[J.POINTS]:1,[J.LINES]:2,[J.TRIANGLES]:3,[J.LINE_STRIP]:1}[s],Q=F&&F.length>0;if(Q){for(const ee of F)J.bindBufferBase(J.TRANSFORM_FEEDBACK_BUFFER,ee.targetIndex,ee.buffer.buffer);J.beginTransformFeedback(s)}const $=G&&G>0?1:void 0;for(const ee of P.get()){const ae=ee.vaos||(ee.vaos={});(ae[E]||(ae[E]=new vh)).bind(Z,this,M,j?j.getPaintVertexBuffers():[],I,ee.vertexOffset,U||[],$),G&&G>1?J.drawElementsInstanced(s,ee.primitiveLength*W,J.UNSIGNED_SHORT,ee.primitiveOffset*W*2,G):I?J.drawElements(s,ee.primitiveLength*W,J.UNSIGNED_SHORT,ee.primitiveOffset*W*2):J.drawArrays(s,ee.vertexOffset,ee.vertexLength),s===J.TRIANGLES&&I&&this._drawDebugWireframe(r,u,f,m,I,ee,z,O,j,G)}Q&&J.endTransformFeedback()}}function Ch(c,r){const s=Math.pow(2,r.tileID.overscaledZ),u=r.tileSize*Math.pow(2,c.transform.tileZoom)/s,f=u*(r.tileID.canonical.x+r.tileID.wrap*s),m=u*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.a3(r,1,c.transform.tileZoom),u_pixel_coord_upper:[f>>16,m>>16],u_pixel_coord_lower:[65535&f,65535&m]}}const Lf=o.a6.create(),Ph=(c,r,s,u,f,m,x,b,E,M,I,P,z,O,j,U)=>{const G=r.style.light,F=G.properties.get("position"),Z=[F.x,F.y,F.z],J=o.co.create();G.properties.get("anchor")==="viewport"&&(o.co.fromRotation(J,-r.transform.angle),o.N.transformMat3(Z,Z,J));const W=G.properties.get("color"),Q=r.transform,$={u_matrix:c,u_lightpos:Z,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[W.r,W.g,W.b],u_vertical_gradient:+s,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Lf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:f,u_edge_radius:m,u_flood_light_color:P,u_vertical_scale:z,u_flood_light_intensity:O,u_ground_shadow_factor:j,u_emissive_strength:U};return Q.projection.name==="globe"&&($.u_tile_id=[x.canonical.x,x.canonical.y,1<<x.canonical.z],$.u_zoom_transition=E,$.u_inv_rot_matrix=I,$.u_merc_center=M,$.u_up_dir=Q.projection.upVector(new o.bs(0,0,0),M[0]*o.V,M[1]*o.V),$.u_height_lift=b),$},Rh=(c,r,s)=>({u_matrix:c,u_edge_radius:r,u_vertical_scale:s}),Xo=(c,r,s,u,f,m,x,b,E,M,I,P,z,O)=>{const j=Ph(c,r,s,u,f,m,x,E,M,I,P,z,O,1,[0,0,0],0),U={u_height_factor:-Math.pow(2,x.overscaledZ)/b.tileSize/8};return o.e(j,Ch(r,b),U)},Da=(c,r)=>({u_matrix:c,u_emissive_strength:r}),Lh=(c,r,s,u)=>o.e(Da(c,r),Ch(s,u)),Yo=(c,r,s)=>({u_matrix:c,u_world:s,u_emissive_strength:r}),Df=(c,r,s,u,f)=>o.e(Lh(c,r,s,u),{u_world:f}),Nc=(c,r,s,u)=>{const f=o.V/s.tileSize;return{u_matrix:c,u_camera_to_center_distance:r.getCameraToCenterDistance(u),u_extrude_scale:[r.pixelsToGLUnits[0]/f,r.pixelsToGLUnits[1]/f]}},Dh=(c,r,s=1)=>({u_matrix:c,u_color:r,u_overlay:0,u_overlay_scale:s}),zf=o.a6.create(),zh=(c,r,s,u,f,m,x)=>{const b=c.transform,E=b.projection.name==="globe",M=E?o.cp(b.zoom,r.canonical)*b._pixelsPerMercatorPixel:o.a3(s,1,m),I={u_matrix:r.projMatrix,u_extrude_scale:M,u_intensity:x,u_inv_rot_matrix:zf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){I.u_inv_rot_matrix=u,I.u_merc_center=f,I.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],I.u_zoom_transition=o.S(b.zoom);const P=f[0]*o.V,z=f[1]*o.V;I.u_up_dir=b.projection.upVector(new o.bs(0,0,0),P,z)}return I};function Vc(c,[r,s,u,f],[m,x]){if(m===x)return[0,0,0,0];const b=255*(c-1)/(c*(x-m));return[r*b,s*b,u*b,f*b]}function kf(c,r,[s,u]){return s===u?0:.5/c+(r-s)*(c-1)/(c*(u-s))}const kh=(c,r,s,u,f,m,x,b,E,M,I,P,z,O,j,U,G,F,Z,J,W)=>{return{u_matrix:c,u_normalize_matrix:r,u_globe_matrix:s,u_merc_matrix:u,u_grid_matrix:f,u_tl_parent:m,u_scale_parent:M,u_fade_t:I.mix,u_opacity:I.opacity*P.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:P.paint.get("raster-brightness-min"),u_brightness_high:P.paint.get("raster-brightness-max"),u_saturation_factor:($=P.paint.get("raster-saturation"),$>0?1-1/(1.001-$):-$),u_contrast_factor:(Q=P.paint.get("raster-contrast"),Q>0?1/(1-Q):1+Q),u_spin_weights:Ml(P.paint.get("raster-hue-rotate")),u_perspective_transform:z,u_raster_elevation:O,u_zoom_transition:x,u_merc_center:b,u_cutoff_params:E,u_colorization_mix:Vc(o.cq,U,F),u_colorization_offset:kf(o.cq,G,F),u_color_ramp:j,u_texture_offset:[J/(Z+2*J),Z/(Z+2*J)],u_texture_res:[Z+2*J,Z+2*J],u_emissive_strength:W};var Q,$};function Ml(c){c*=Math.PI/180;const r=Math.sin(c),s=Math.cos(c);return[(2*s+1)/3,(-Math.sqrt(3)*r-s+1)/3,(Math.sqrt(3)*r-s+1)/3]}const y_=(c,r,s,u,f,m,x,b,E,M,I,P)=>({u_matrix:c,u_normalize_matrix:r,u_globe_matrix:s,u_merc_matrix:u,u_grid_matrix:f,u_tl_parent:m,u_scale_parent:M,u_fade_t:I.mix,u_opacity:I.opacity,u_image0:0,u_image1:1,u_raster_elevation:P,u_zoom_transition:x,u_merc_center:b,u_cutoff_params:E}),x_=(c,r,s,u,f,m,x,b)=>({u_tile_offset:c,u_velocity:r,u_color_ramp:u,u_velocity_res:s,u_max_speed:f,u_texture_offset:m,u_data_scale:x,u_data_offset:b}),Of=(c,r,s,u,f,m,x,b)=>({u_velocity:c,u_velocity_res:r,u_max_speed:s,u_speed_factor:u,u_lifetime_delta:f,u_rand_seed:Math.random(),u_texture_offset:m,u_data_scale:x,u_data_offset:b}),Bf=o.a6.create(),Uc=(c,r,s,u,f,m,x,b,E,M,I,P,z,O,j,U,G,F)=>{const Z=f.transform,J={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Z.getCameraToCenterDistance(U),u_rotate_symbol:+s,u_aspect_ratio:Z.width/Z.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:m,u_label_plane_matrix:x,u_coord_matrix:b,u_is_text:+E,u_pitch_with_map:+u,u_texsize:M,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Bf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Bf,u_up_vector:[0,-1,0],u_icon_transition:F||0,u_icon_saturation:G};return U.name==="globe"&&(J.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],J.u_zoom_transition=P,J.u_inv_rot_matrix=O,J.u_merc_center=z,J.u_camera_forward=Z._camera.forward(),J.u_ecef_origin=o.cr(Z.globeMatrix,I.toUnwrapped()),J.u_tile_matrix=Float32Array.from(Z.globeMatrix),J.u_up_vector=j),J},Il=(c,r,s,u,f,m,x,b,E,M,I,P,z,O,j,U,G)=>o.e(Uc(c,r,s,u,f,m,x,b,E,M,P,z,O,j,U,G,1),{u_gamma_scale:u?f.transform.getCameraToCenterDistance(G)*Math.cos(f.terrain?0:f.transform._pitch):1,u_device_pixel_ratio:o.f.devicePixelRatio,u_is_halo:+I,undefined:void 0}),jc=(c,r,s,u,f,m,x,b,E,M,I,P,z,O,j,U)=>o.e(Il(c,r,s,u,f,m,x,b,!0,E,!0,I,P,z,O,j,U),{u_texsize_icon:M,u_texture_icon:1}),Oh=(c,r,s,u)=>({u_matrix:c,u_emissive_strength:r,u_opacity:s,u_color:u}),Cl=(c,r,s,u,f,m,x)=>o.e(function(b,E,M,I){const P=M.imageManager.getPattern(b.toString(),E),{width:z,height:O}=M.imageManager.getPixelSize(E),j=Math.pow(2,I.tileID.overscaledZ),U=I.tileSize*Math.pow(2,M.transform.tileZoom)/j,G=U*(I.tileID.canonical.x+I.tileID.wrap*j),F=U*I.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[z,O],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/o.a3(I,1,M.transform.tileZoom),u_pixel_coord_upper:[G>>16,F>>16],u_pixel_coord_lower:[65535&G,65535&F]}}(f,m,u,x),{u_matrix:c,u_emissive_strength:r,u_opacity:s}),Gc=(c,r,s,u,f,m,x,b,E,M,I,P,z=[0,0,0],O)=>{const j=u.style.light,U=j.properties.get("position"),G=[-U.x,-U.y,U.z],F=o.co.create();j.properties.get("anchor")==="viewport"&&(o.co.fromRotation(F,-u.transform.angle),o.N.transformMat3(G,G,F));const Z=M.alphaMode==="MASK",J=j.properties.get("color"),W=P.paint.get("model-ambient-occlusion-intensity"),Q=P.paint.get("model-color").constantOr(o.ax.white),$=P.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:c,u_lighting_matrix:r,u_normal_matrix:s,u_lightpos:G,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_camera_pos:z,u_opacity:f,u_baseTextureIsAlpha:0,u_alphaMask:+Z,u_alphaCutoff:M.alphaCutoff,u_baseColorFactor:[m.r,m.g,m.b,m.a],u_emissiveFactor:[x[0],x[1],x[2],1],u_metallicFactor:b,u_roughnessFactor:E,u_baseColorTexture:yn.BaseColor,u_metallicRoughnessTexture:yn.MetallicRoughness,u_normalTexture:yn.Normal,u_occlusionTexture:yn.Occlusion,u_emissionTexture:yn.Emission,u_color_mix:[Q.r,Q.g,Q.b,$],u_aoIntensity:W,u_emissive_strength:I,u_occlusionTextureTransform:O||[0,0,0,0]}},Pl=new Float32Array(16),Rl=(c,r=Pl,s=Pl)=>({u_matrix:c,u_instance:r,u_node_matrix:s}),v_={fillExtrusion:c=>({u_matrix:new o.bK(c),u_lightpos:new o.bM(c),u_lightintensity:new o.bN(c),u_lightcolor:new o.bM(c),u_vertical_gradient:new o.bN(c),u_opacity:new o.bN(c),u_edge_radius:new o.bN(c),u_ao:new o.bL(c),u_tile_id:new o.bM(c),u_zoom_transition:new o.bN(c),u_inv_rot_matrix:new o.bK(c),u_merc_center:new o.bL(c),u_up_dir:new o.bM(c),u_height_lift:new o.bN(c),u_flood_light_color:new o.bM(c),u_vertical_scale:new o.bN(c),u_flood_light_intensity:new o.bN(c),u_ground_shadow_factor:new o.bM(c),u_emissive_strength:new o.bN(c)}),fillExtrusionDepth:c=>({u_matrix:new o.bK(c),u_edge_radius:new o.bN(c),u_vertical_scale:new o.bN(c)}),fillExtrusionPattern:c=>({u_matrix:new o.bK(c),u_lightpos:new o.bM(c),u_lightintensity:new o.bN(c),u_lightcolor:new o.bM(c),u_vertical_gradient:new o.bN(c),u_height_factor:new o.bN(c),u_edge_radius:new o.bN(c),u_ao:new o.bL(c),u_tile_id:new o.bM(c),u_zoom_transition:new o.bN(c),u_inv_rot_matrix:new o.bK(c),u_merc_center:new o.bL(c),u_up_dir:new o.bM(c),u_height_lift:new o.bN(c),u_image:new o.bO(c),u_texsize:new o.bL(c),u_pixel_coord_upper:new o.bL(c),u_pixel_coord_lower:new o.bL(c),u_tile_units_to_pixels:new o.bN(c),u_opacity:new o.bN(c)}),fillExtrusionGroundEffect:c=>({u_matrix:new o.bK(c),u_opacity:new o.bN(c),u_ao_pass:new o.bN(c),u_meter_to_tile:new o.bN(c),u_ao:new o.bL(c),u_flood_light_intensity:new o.bN(c),u_flood_light_color:new o.bM(c),u_attenuation:new o.bN(c),u_edge_radius:new o.bN(c),u_fb:new o.bO(c),u_fb_size:new o.bN(c)}),fill:c=>({u_matrix:new o.bK(c),u_emissive_strength:new o.bN(c)}),fillPattern:c=>({u_matrix:new o.bK(c),u_emissive_strength:new o.bN(c),u_image:new o.bO(c),u_texsize:new o.bL(c),u_pixel_coord_upper:new o.bL(c),u_pixel_coord_lower:new o.bL(c),u_tile_units_to_pixels:new o.bN(c)}),fillOutline:c=>({u_matrix:new o.bK(c),u_emissive_strength:new o.bN(c),u_world:new o.bL(c)}),fillOutlinePattern:c=>({u_matrix:new o.bK(c),u_emissive_strength:new o.bN(c),u_world:new o.bL(c),u_image:new o.bO(c),u_texsize:new o.bL(c),u_pixel_coord_upper:new o.bL(c),u_pixel_coord_lower:new o.bL(c),u_tile_units_to_pixels:new o.bN(c)}),circle:o.cs,collisionBox:c=>({u_matrix:new o.bK(c),u_camera_to_center_distance:new o.bN(c),u_extrude_scale:new o.bL(c)}),collisionCircle:c=>({u_matrix:new o.bK(c),u_inv_matrix:new o.bK(c),u_camera_to_center_distance:new o.bN(c),u_viewport_size:new o.bL(c)}),debug:c=>({u_color:new o.ca(c),u_matrix:new o.bK(c),u_overlay:new o.bO(c),u_overlay_scale:new o.bN(c)}),clippingMask:c=>({u_matrix:new o.bK(c)}),heatmap:c=>({u_extrude_scale:new o.bN(c),u_intensity:new o.bN(c),u_matrix:new o.bK(c),u_inv_rot_matrix:new o.bK(c),u_merc_center:new o.bL(c),u_tile_id:new o.bM(c),u_zoom_transition:new o.bN(c),u_up_dir:new o.bM(c)}),heatmapTexture:c=>({u_image:new o.bO(c),u_color_ramp:new o.bO(c),u_opacity:new o.bN(c)}),hillshade:c=>({u_matrix:new o.bK(c),u_image:new o.bO(c),u_latrange:new o.bL(c),u_light:new o.bL(c),u_shadow:new o.ca(c),u_highlight:new o.ca(c),u_emissive_strength:new o.bN(c),u_accent:new o.ca(c)}),hillshadePrepare:c=>({u_matrix:new o.bK(c),u_image:new o.bO(c),u_dimension:new o.bL(c),u_zoom:new o.bN(c)}),line:o.ct,linePattern:o.cu,raster:c=>({u_matrix:new o.bK(c),u_normalize_matrix:new o.bK(c),u_globe_matrix:new o.bK(c),u_merc_matrix:new o.bK(c),u_grid_matrix:new o.cb(c),u_tl_parent:new o.bL(c),u_scale_parent:new o.bN(c),u_fade_t:new o.bN(c),u_opacity:new o.bN(c),u_image0:new o.bO(c),u_image1:new o.bO(c),u_brightness_low:new o.bN(c),u_brightness_high:new o.bN(c),u_saturation_factor:new o.bN(c),u_contrast_factor:new o.bN(c),u_spin_weights:new o.bM(c),u_perspective_transform:new o.bL(c),u_raster_elevation:new o.bN(c),u_zoom_transition:new o.bN(c),u_merc_center:new o.bL(c),u_cutoff_params:new o.bP(c),u_colorization_mix:new o.bP(c),u_colorization_offset:new o.bN(c),u_color_ramp:new o.bO(c),u_texture_offset:new o.bL(c),u_texture_res:new o.bL(c),u_emissive_strength:new o.bN(c)}),rasterParticle:c=>({u_matrix:new o.bK(c),u_normalize_matrix:new o.bK(c),u_globe_matrix:new o.bK(c),u_merc_matrix:new o.bK(c),u_grid_matrix:new o.cb(c),u_tl_parent:new o.bL(c),u_scale_parent:new o.bN(c),u_fade_t:new o.bN(c),u_opacity:new o.bN(c),u_image0:new o.bO(c),u_image1:new o.bO(c),u_raster_elevation:new o.bN(c),u_zoom_transition:new o.bN(c),u_merc_center:new o.bL(c),u_cutoff_params:new o.bP(c)}),rasterParticleTexture:c=>({u_texture:new o.bO(c),u_opacity:new o.bN(c)}),rasterParticleDraw:c=>({u_tile_offset:new o.bL(c),u_velocity:new o.bO(c),u_color_ramp:new o.bO(c),u_velocity_res:new o.bL(c),u_max_speed:new o.bN(c),u_texture_offset:new o.bL(c),u_data_scale:new o.bP(c),u_data_offset:new o.bN(c)}),rasterParticleUpdate:c=>({u_velocity:new o.bO(c),u_velocity_res:new o.bL(c),u_max_speed:new o.bN(c),u_speed_factor:new o.bN(c),u_lifetime_delta:new o.bN(c),u_rand_seed:new o.bN(c),u_texture_offset:new o.bL(c),u_data_scale:new o.bP(c),u_data_offset:new o.bN(c)}),symbolIcon:c=>({u_is_size_zoom_constant:new o.bO(c),u_is_size_feature_constant:new o.bO(c),u_size_t:new o.bN(c),u_size:new o.bN(c),u_camera_to_center_distance:new o.bN(c),u_rotate_symbol:new o.bO(c),u_aspect_ratio:new o.bN(c),u_fade_change:new o.bN(c),u_matrix:new o.bK(c),u_label_plane_matrix:new o.bK(c),u_coord_matrix:new o.bK(c),u_is_text:new o.bO(c),u_pitch_with_map:new o.bO(c),u_texsize:new o.bL(c),u_tile_id:new o.bM(c),u_zoom_transition:new o.bN(c),u_inv_rot_matrix:new o.bK(c),u_merc_center:new o.bL(c),u_camera_forward:new o.bM(c),u_tile_matrix:new o.bK(c),u_up_vector:new o.bM(c),u_ecef_origin:new o.bM(c),u_texture:new o.bO(c),u_icon_transition:new o.bN(c),u_icon_saturation:new o.bN(c)}),symbolSDF:c=>({u_is_size_zoom_constant:new o.bO(c),u_is_size_feature_constant:new o.bO(c),u_size_t:new o.bN(c),u_size:new o.bN(c),u_camera_to_center_distance:new o.bN(c),u_rotate_symbol:new o.bO(c),u_aspect_ratio:new o.bN(c),u_fade_change:new o.bN(c),u_matrix:new o.bK(c),u_label_plane_matrix:new o.bK(c),u_coord_matrix:new o.bK(c),u_is_text:new o.bO(c),u_pitch_with_map:new o.bO(c),u_texsize:new o.bL(c),u_texture:new o.bO(c),u_gamma_scale:new o.bN(c),u_device_pixel_ratio:new o.bN(c),u_tile_id:new o.bM(c),u_zoom_transition:new o.bN(c),u_inv_rot_matrix:new o.bK(c),u_merc_center:new o.bL(c),u_camera_forward:new o.bM(c),u_tile_matrix:new o.bK(c),u_up_vector:new o.bM(c),u_ecef_origin:new o.bM(c),u_is_halo:new o.bO(c)}),symbolTextAndIcon:c=>({u_is_size_zoom_constant:new o.bO(c),u_is_size_feature_constant:new o.bO(c),u_size_t:new o.bN(c),u_size:new o.bN(c),u_camera_to_center_distance:new o.bN(c),u_rotate_symbol:new o.bO(c),u_aspect_ratio:new o.bN(c),u_fade_change:new o.bN(c),u_matrix:new o.bK(c),u_label_plane_matrix:new o.bK(c),u_coord_matrix:new o.bK(c),u_is_text:new o.bO(c),u_pitch_with_map:new o.bO(c),u_texsize:new o.bL(c),u_texsize_icon:new o.bL(c),u_texture:new o.bO(c),u_texture_icon:new o.bO(c),u_gamma_scale:new o.bN(c),u_device_pixel_ratio:new o.bN(c),u_is_halo:new o.bO(c)}),background:c=>({u_matrix:new o.bK(c),u_emissive_strength:new o.bN(c),u_opacity:new o.bN(c),u_color:new o.ca(c)}),backgroundPattern:c=>({u_matrix:new o.bK(c),u_emissive_strength:new o.bN(c),u_opacity:new o.bN(c),u_image:new o.bO(c),u_pattern_tl:new o.bL(c),u_pattern_br:new o.bL(c),u_texsize:new o.bL(c),u_pattern_size:new o.bL(c),u_pixel_coord_upper:new o.bL(c),u_pixel_coord_lower:new o.bL(c),u_tile_units_to_pixels:new o.bN(c)}),terrainRaster:If,terrainDepth:If,skybox:c=>({u_matrix:new o.bK(c),u_sun_direction:new o.bM(c),u_cubemap:new o.bO(c),u_opacity:new o.bN(c),u_temporal_offset:new o.bN(c)}),skyboxGradient:c=>({u_matrix:new o.bK(c),u_color_ramp:new o.bO(c),u_center_direction:new o.bM(c),u_radius:new o.bN(c),u_opacity:new o.bN(c),u_temporal_offset:new o.bN(c)}),skyboxCapture:c=>({u_matrix_3f:new o.cb(c),u_sun_direction:new o.bM(c),u_sun_intensity:new o.bN(c),u_color_tint_r:new o.bP(c),u_color_tint_m:new o.bP(c),u_luminance:new o.bN(c)}),globeRaster:c=>({u_proj_matrix:new o.bK(c),u_globe_matrix:new o.bK(c),u_normalize_matrix:new o.bK(c),u_merc_matrix:new o.bK(c),u_zoom_transition:new o.bN(c),u_merc_center:new o.bL(c),u_image0:new o.bO(c),u_grid_matrix:new o.cb(c),u_skirt_height:new o.bN(c),u_far_z_cutoff:new o.bN(c),u_frustum_tl:new o.bM(c),u_frustum_tr:new o.bM(c),u_frustum_br:new o.bM(c),u_frustum_bl:new o.bM(c),u_globe_pos:new o.bM(c),u_globe_radius:new o.bN(c),u_viewport:new o.bL(c)}),globeAtmosphere:c=>({u_frustum_tl:new o.bM(c),u_frustum_tr:new o.bM(c),u_frustum_br:new o.bM(c),u_frustum_bl:new o.bM(c),u_horizon:new o.bN(c),u_transition:new o.bN(c),u_fadeout_range:new o.bN(c),u_color:new o.bP(c),u_high_color:new o.bP(c),u_space_color:new o.bP(c),u_temporal_offset:new o.bN(c),u_horizon_angle:new o.bN(c)}),model:c=>({u_matrix:new o.bK(c),u_lighting_matrix:new o.bK(c),u_normal_matrix:new o.bK(c),u_lightpos:new o.bM(c),u_lightintensity:new o.bN(c),u_lightcolor:new o.bM(c),u_camera_pos:new o.bM(c),u_opacity:new o.bN(c),u_baseColorFactor:new o.bP(c),u_emissiveFactor:new o.bP(c),u_metallicFactor:new o.bN(c),u_roughnessFactor:new o.bN(c),u_baseTextureIsAlpha:new o.bO(c),u_alphaMask:new o.bO(c),u_alphaCutoff:new o.bN(c),u_baseColorTexture:new o.bO(c),u_metallicRoughnessTexture:new o.bO(c),u_normalTexture:new o.bO(c),u_occlusionTexture:new o.bO(c),u_emissionTexture:new o.bO(c),u_color_mix:new o.bP(c),u_aoIntensity:new o.bN(c),u_emissive_strength:new o.bN(c),u_occlusionTextureTransform:new o.bP(c)}),modelDepth:c=>({u_matrix:new o.bK(c),u_instance:new o.bK(c),u_node_matrix:new o.bK(c)}),groundShadow:c=>({u_matrix:new o.bK(c),u_ground_shadow_factor:new o.bM(c)}),stars:c=>({u_matrix:new o.bK(c),u_up:new o.bM(c),u_right:new o.bM(c),u_intensity_multiplier:new o.bN(c)})};let vs;function bs(c,r,s,u,f,m,x){const b=c.context,E=b.gl,M=c.transform,I=c.getOrCreateProgram("collisionBox"),P=[];let z=0,O=0;for(let W=0;W<u.length;W++){const Q=u[W],$=r.getTile(Q),ee=$.getBucket(s);if(!ee)continue;const ae=rh(Q,ee,M);let le=ae;f[0]===0&&f[1]===0||(le=c.translatePosMatrix(ae,$,f,m));const fe=x?ee.textCollisionBox:ee.iconCollisionBox,Te=ee.collisionCircleArray;if(Te.length>0){const _e=o.a6.create(),Le=le;o.a6.mul(_e,ee.placementInvProjMatrix,M.glCoordMatrix),o.a6.mul(_e,_e,ee.placementViewportMatrix),P.push({circleArray:Te,circleOffset:O,transform:Le,invTransform:_e,projection:ee.getProjection()}),z+=Te.length/4,O=z}fe&&(c.terrain&&c.terrain.setupElevationDraw($,I),I.draw(c,E.LINES,Zt.disabled,ti.disabled,c.colorModeForRenderPass(),Ht.disabled,Nc(le,M,$,ee.getProjection()),s.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,null,M.zoom,null,[fe.collisionVertexBuffer,fe.collisionVertexBufferExt]))}if(!x||!P.length)return;const j=c.getOrCreateProgram("collisionCircle"),U=new o.cv;U.resize(4*z),U._trim();let G=0;for(const W of P)for(let Q=0;Q<W.circleArray.length/4;Q++){const $=4*Q,ee=W.circleArray[$+0],ae=W.circleArray[$+1],le=W.circleArray[$+2],fe=W.circleArray[$+3];U.emplace(G++,ee,ae,le,fe,0),U.emplace(G++,ee,ae,le,fe,1),U.emplace(G++,ee,ae,le,fe,2),U.emplace(G++,ee,ae,le,fe,3)}(!vs||vs.length<2*z)&&(vs=function(W){const Q=2*W,$=new o.aw;$.resize(Q),$._trim();for(let ee=0;ee<Q;ee++){const ae=6*ee;$.uint16[ae+0]=4*ee+0,$.uint16[ae+1]=4*ee+1,$.uint16[ae+2]=4*ee+2,$.uint16[ae+3]=4*ee+2,$.uint16[ae+4]=4*ee+3,$.uint16[ae+5]=4*ee+0}return $}(z));const F=b.createIndexBuffer(vs,!0),Z=b.createVertexBuffer(U,o.cw.members,!0);for(const W of P){const Q={u_matrix:W.transform,u_inv_matrix:W.invTransform,u_camera_to_center_distance:(J=M).getCameraToCenterDistance(W.projection),u_viewport_size:[J.width,J.height]};j.draw(c,E.TRIANGLES,Zt.disabled,ti.disabled,c.colorModeForRenderPass(),Ht.disabled,Q,s.id,Z,F,o.aB.simpleSegment(0,2*W.circleOffset,W.circleArray.length,W.circleArray.length/2),null,M.zoom)}var J;Z.destroy(),F.destroy()}const Gs=o.a6.create();function Ll(c){const r=c._camera.getWorldToCamera(c.worldSize,1),s=o.a6.multiply([],r,c.globeMatrix);o.a6.invert(s,s);const u=[0,0,0],f=[0,1,0,0];return o.a7.transformMat4(f,f,s),u[0]=f[0],u[1]=f[1],u[2]=f[2],o.N.normalize(u,u),u}function wt({width:c,height:r,anchor:s,textOffset:u,textScale:f},m){const{horizontalAlign:x,verticalAlign:b}=o.bf(s),E=-(x-.5)*c,M=-(b-.5)*r,I=o.bd(s,u);return new o.P((E/f+I[0])*m,(M/f+I[1])*m)}function Ff(c,r,s,u,f,m,x,b,E,M,I){const P=c.text.placedSymbolArray,z=c.text.dynamicLayoutVertexArray,O=c.icon.dynamicLayoutVertexArray,j={},U=c.getProjection(),G=yl(b,U,m),F=m.elevation,Z=U.upVectorScale(b.canonical,m.center.lat,m.worldSize).metersToTile;z.clear();for(let J=0;J<P.length;J++){const W=P.get(J),{tileAnchorX:Q,tileAnchorY:$,numGlyphs:ee}=W,ae=W.hidden||!W.crossTileID||c.allowVerticalPlacement&&!W.placedOrientation?null:u[W.crossTileID];if(ae){let le=0,fe=0,Te=0;if(F){const Ze=F?F.getAtTileOffset(b,Q,$):0,[Qe,Je,dt]=U.upVector(b.canonical,Q,$);le=Ze*Qe*Z,fe=Ze*Je*Z,Te=Ze*dt*Z}let[_e,Le,Pe,$e]=ls(W.projectedAnchorX+le,W.projectedAnchorY+fe,W.projectedAnchorZ+Te,s?G:x);const ge=gf(m.getCameraToCenterDistance(U),$e);let Ae=f.evaluateSizeForFeature(c.textSizeData,M,W)*ge/o.bc;s&&(Ae*=c.tilePixelRatio/E);const he=wt(ae,Ae);s?({x:_e,y:Le,z:Pe}=U.projectTilePoint(Q+he.x,$+he.y,b.canonical),[_e,Le,Pe]=ls(_e+le,Le+fe,Pe+Te,x)):(r&&he._rotate(-m.angle),_e+=he.x,Le+=he.y,Pe=0);const ve=c.allowVerticalPlacement&&W.placedOrientation===o.b6.vertical?Math.PI/2:0;for(let Ze=0;Ze<ee;Ze++)o.b9(z,_e,Le,Pe,ve);I&&W.associatedIconIndex>=0&&(j[W.associatedIconIndex]={x:_e,y:Le,z:Pe,angle:ve})}else mo(ee,z)}if(I){O.clear();const J=c.icon.placedSymbolArray;for(let W=0;W<J.length;W++){const Q=J.get(W),{numGlyphs:$}=Q,ee=j[W];if(Q.hidden||!ee)mo($,O);else{const{x:ae,y:le,z:fe,angle:Te}=ee;for(let _e=0;_e<$;_e++)o.b9(O,ae,le,fe,Te)}}c.icon.dynamicLayoutVertexBuffer.updateData(O)}c.text.dynamicLayoutVertexBuffer.updateData(z)}function $c(c,r,s,u,f,m,x={}){const b=s.paint.get("icon-translate"),E=s.paint.get("text-translate"),M=s.paint.get("icon-translate-anchor"),I=s.paint.get("text-translate-anchor"),P=s.layout.get("icon-rotation-alignment"),z=s.layout.get("text-rotation-alignment"),O=s.layout.get("icon-pitch-alignment"),j=s.layout.get("text-pitch-alignment"),U=s.layout.get("icon-keep-upright"),G=s.layout.get("text-keep-upright"),F=s.paint.get("icon-color-saturation"),Z=c.context,J=Z.gl,W=c.transform,Q=P==="map",$=z==="map",ee=O==="map",ae=j==="map",le=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let fe=!1;const Te=c.depthModeForSublayer(0,Zt.ReadOnly),_e=[o.a5(W.center.lng),o.ae(W.center.lat)],Le=s.layout.get("text-variable-anchor"),Pe=W.projection.name==="globe",$e=[],ge=[0,-1,0];for(const Ae of u){const he=r.getTile(Ae),ve=he.getBucket(s);if(!ve||ve.projection.name==="mercator"&&Pe||ve.fullyClipped)continue;const Ze=ve.projection.name==="globe",Qe=Ze?o.S(W.zoom):0,Je=yl(Ae,ve.getProjection(),W),dt=W.calculatePixelsToTileUnitsMatrix(he),Ct=Le&&ve.hasTextData(),Ut=ve.hasIconTextFit()&&Ct&&ve.hasIconData(),Rt=ve.getProjection().createInversionMatrix(W,Ae.canonical),kt=()=>{const Rr=Q&&s.layout.get("symbol-placement")!=="point",vi=[],ki=Rr||Ut,bi=s.paint.get("icon-image-cross-fade").constantOr(0);c.terrainRenderModeElevated()&&ee&&vi.push("PITCH_WITH_MAP_TERRAIN"),Ze&&(vi.push("PROJECTION_GLOBE_VIEW"),ki&&vi.push("PROJECTED_POS_ON_VIEWPORT")),bi>0&&vi.push("ICON_TRANSITION"),ve.icon.zOffsetVertexBuffer&&vi.push("Z_OFFSET"),F<1&&vi.push("SATURATION");const Di=ve.icon.programConfigurations.get(s.id),pr=c.getOrCreateProgram(ve.sdfIcons?"symbolSDF":"symbolIcon",{config:Di,defines:vi});let Gi;const on=he.imageAtlasTexture?he.imageAtlasTexture.size:[0,0],xn=ve.iconSizeData,qn=o.b5(xn,W.zoom),Ds=ee||W.pitch!==0,Zn=_l(Je,he.tileID.canonical,ee,Q,W,ve.getProjection(),dt),an=Yu(Je,he.tileID.canonical,ee,Q,W,ve.getProjection(),dt),en=c.translatePosMatrix(an,he,b,M,!0),Pn=c.translatePosMatrix(Je,he,b,M),kn=ki?Gs:Zn,Hn=Q&&!ee&&!Rr;let zs=ge;!Pe&&!W.mercatorFromTransition||Q||(zs=Ll(W));const Io=Ze?zs:ge;Gi=ve.sdfIcons&&!ve.iconsInText?Il(xn.kind,qn,Hn,ee,c,Pn,kn,en,!1,on,!0,Ae,Qe,_e,Rt,Io,ve.getProjection()):Uc(xn.kind,qn,Hn,ee,c,Pn,kn,en,!1,on,Ae,Qe,_e,Rt,Io,ve.getProjection(),F,bi);const ta=he.imageAtlasTexture?he.imageAtlasTexture:null,Kl=s.layout.get("icon-size").constantOr(0)!==1||ve.iconsNeedLinear,Jl=ve.sdfIcons||c.options.rotating||c.options.zooming||Kl||Ds?J.LINEAR:J.NEAREST,dd=ve.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,Ql=c.terrain&&ee&&Rr?o.a6.invert(o.a6.create(),Zn):Gs;if(Rr&&ve.icon){const Fa=W.elevation,eu=Fa?Fa.getAtTileOffsetFunc(Ae,W.center.lat,W.worldSize,ve.getProjection()):null,Hs=Xu(Je,he.tileID.canonical,ee,Q,W,ve.getProjection(),dt);Ju(ve,Je,c,!1,Hs,an,ee,U,eu,Ae)}return{program:pr,buffers:ve.icon,uniformValues:Gi,atlasTexture:ta,atlasTextureIcon:null,atlasInterpolation:Jl,atlasInterpolationIcon:null,isSDF:ve.sdfIcons,hasHalo:dd,tile:he,labelPlaneMatrixInv:Ql}},hi=()=>{const Rr=$&&s.layout.get("symbol-placement")!=="point",vi=[],ki=Rr||Le||Ut;c.terrainRenderModeElevated()&&ae&&vi.push("PITCH_WITH_MAP_TERRAIN"),Ze&&(vi.push("PROJECTION_GLOBE_VIEW"),ki&&vi.push("PROJECTED_POS_ON_VIEWPORT")),ve.text.zOffsetVertexBuffer&&vi.push("Z_OFFSET");const bi=ve.text.programConfigurations.get(s.id),Di=c.getOrCreateProgram(ve.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:bi,defines:vi});let pr,Gi=[0,0],on=null;const xn=ve.textSizeData;ve.iconsInText&&(Gi=he.imageAtlasTexture?he.imageAtlasTexture.size:[0,0],on=he.imageAtlasTexture?he.imageAtlasTexture:null,pr=ae||W.pitch!==0||c.options.rotating||c.options.zooming||xn.kind==="composite"||xn.kind==="camera"?J.LINEAR:J.NEAREST);const qn=he.glyphAtlasTexture?he.glyphAtlasTexture.size:[0,0],Ds=o.b5(xn,W.zoom),Zn=_l(Je,he.tileID.canonical,ae,$,W,ve.getProjection(),dt),an=Yu(Je,he.tileID.canonical,ae,$,W,ve.getProjection(),dt),en=c.translatePosMatrix(an,he,E,I,!0),Pn=c.translatePosMatrix(Je,he,E,I),kn=ki?Gs:Zn,Hn=$&&!ae&&!Rr;let zs=ge;!Pe&&!W.mercatorFromTransition||$||(zs=Ll(W));const Io=Ze?zs:ge;let ta;ta=ve.iconsInText?jc(xn.kind,Ds,Hn,ae,c,Pn,kn,en,qn,Gi,Ae,Qe,_e,Rt,Io,ve.getProjection()):Il(xn.kind,Ds,Hn,ae,c,Pn,kn,en,!0,qn,!0,Ae,Qe,_e,Rt,Io,ve.getProjection());const Kl=he.glyphAtlasTexture?he.glyphAtlasTexture:null,Jl=J.LINEAR,dd=s.paint.get("text-halo-width").constantOr(1)!==0,Ql=c.terrain&&ae&&Rr?o.a6.invert(o.a6.create(),Zn):Gs;if(Rr&&ve.text){const Fa=W.elevation,eu=Fa?Fa.getAtTileOffsetFunc(Ae,W.center.lat,W.worldSize,ve.getProjection()):null,Hs=Xu(Je,he.tileID.canonical,ae,$,W,ve.getProjection(),dt);Ju(ve,Je,c,!0,Hs,an,ae,G,eu,Ae)}return{program:Di,buffers:ve.text,uniformValues:ta,atlasTexture:Kl,atlasTextureIcon:on,atlasInterpolation:Jl,atlasInterpolationIcon:pr,isSDF:!0,hasHalo:dd,tile:he,labelPlaneMatrixInv:Ql}},Qt=ve.icon.segments.get().length,ai=ve.text.segments.get().length,oi=Qt&&!x.onlyText?kt():null,Ii=ai&&!x.onlyIcons?hi():null,ur=s.paint.get("icon-opacity").constantOr(1),xi=s.paint.get("text-opacity").constantOr(1);if(le&&ve.canOverlap){fe=!0;const Rr=ur&&!x.onlyText?ve.icon.segments.get():[],vi=xi&&!x.onlyIcons?ve.text.segments.get():[];for(const ki of Rr)$e.push({segments:new o.aB([ki]),sortKey:ki.sortKey,state:oi});for(const ki of vi)$e.push({segments:new o.aB([ki]),sortKey:ki.sortKey,state:Ii})}else x.onlyText||$e.push({segments:ur?ve.icon.segments:new o.aB([]),sortKey:0,state:oi}),x.onlyIcons||$e.push({segments:xi?ve.text.segments:new o.aB([]),sortKey:0,state:Ii})}fe&&$e.sort((Ae,he)=>Ae.sortKey-he.sortKey);for(const Ae of $e){const he=Ae.state;if(he)if(c.terrain&&c.terrain.setupElevationDraw(he.tile,he.program,{useDepthForOcclusion:W.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:he.labelPlaneMatrixInv}),Z.activeTexture.set(J.TEXTURE0),he.atlasTexture&&he.atlasTexture.bind(he.atlasInterpolation,J.CLAMP_TO_EDGE,!0),he.atlasTextureIcon&&(Z.activeTexture.set(J.TEXTURE1),he.atlasTextureIcon&&he.atlasTextureIcon.bind(he.atlasInterpolationIcon,J.CLAMP_TO_EDGE,!0)),c.uploadCommonLightUniforms(c.context,he.program),he.hasHalo){const ve=he.uniformValues;ve.u_is_halo=1,vo(he.buffers,Ae.segments,s,c,he.program,Te,f,m,ve,2),ve.u_is_halo=0}else{if(he.isSDF){const ve=he.uniformValues;he.hasHalo&&(ve.u_is_halo=1,vo(he.buffers,Ae.segments,s,c,he.program,Te,f,m,ve,1)),ve.u_is_halo=0}vo(he.buffers,Ae.segments,s,c,he.program,Te,f,m,he.uniformValues,1)}}}function vo(c,r,s,u,f,m,x,b,E,M){const I=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.iconTransitioningVertexBuffer,c.globeExtVertexBuffer,c.zOffsetVertexBuffer];f.draw(u,u.context.gl.TRIANGLES,m,x,b,Ht.disabled,E,s.id,c.layoutVertexBuffer,c.indexBuffer,r,s.paint,u.transform.zoom,c.programConfigurations.get(s.id),I,M)}function Ko(c,r,s,u,f,m,x){const b=c.context.gl,E=s.paint.get("fill-pattern"),M=E&&E.constantOr(1);let I,P,z,O,j;x?(P=M&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=b.LINES):(P=M?"fillPattern":"fill",I=b.TRIANGLES);for(const U of u){const G=r.getTile(U);if(M&&!G.patternsLoaded())continue;const F=G.getBucket(s);if(!F)continue;c.prepareDrawTile();const Z=F.programConfigurations.get(s.id),J=c.isTileAffectedByFog(U),W=c.getOrCreateProgram(P,{config:Z,overrideFog:J});M&&(c.context.activeTexture.set(b.TEXTURE0),G.imageAtlasTexture&&G.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),Z.updatePaintBuffers());const Q=E.constantOr(null);if(Q&&G.imageAtlas){const ae=G.imageAtlas.patternPositions[Q.toString()];ae&&Z.setConstantPatternPositions(ae)}const $=c.translatePosMatrix(U.projMatrix,G,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor")),ee=s.paint.get("fill-emissive-strength");if(x){O=F.indexBuffer2,j=F.segments2;const ae=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[b.drawingBufferWidth,b.drawingBufferHeight];z=P==="fillOutlinePattern"&&M?Df($,ee,c,G,ae):Yo($,ee,ae)}else O=F.indexBuffer,j=F.segments,z=M?Lh($,ee,c,G):Da($,ee);c.uploadCommonUniforms(c.context,W,U.toUnwrapped()),W.draw(c,I,f,c.stencilModeForClipping(U),m,Ht.disabled,z,s.id,F.layoutVertexBuffer,O,j,s.paint,c.transform.zoom,Z,void 0)}}function Pt(c,r,s,u,f,m,x,b){s.resetLayerRenderingStats(c);const E=c.context,M=E.gl,I=c.transform,P=s.paint.get("fill-extrusion-pattern"),z=P.constantOr(1),O=s.paint.get("fill-extrusion-opacity"),j=c.style.enable3dLights(),U=s.paint.get(j&&!z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),G=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),U],F=s.layout.get("fill-extrusion-edge-radius"),Z=F>0&&!s.paint.get("fill-extrusion-rounded-roof"),J=Z?0:F,W=I.projection.name==="globe"?o.cF():0,Q=I.projection.name==="globe",$=Q?o.S(I.zoom):0,ee=[o.a5(I.center.lng),o.ae(I.center.lat)],ae=s.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),le=s.paint.get("fill-extrusion-flood-light-intensity"),fe=s.paint.get("fill-extrusion-vertical-scale"),Te=go(c,s.paint.get("fill-extrusion-cutoff-fade-range")),_e=s.paint.get("fill-extrusion-emissive-strength"),Le=[];let Pe;Q&&Le.push("PROJECTION_GLOBE_VIEW"),G[0]>0&&Le.push("FAUX_AO"),Z&&Le.push("ZERO_ROOF_RADIUS"),b&&Le.push("HAS_CENTROID"),le>0&&Le.push("FLOOD_LIGHT"),Te.shouldRenderCutoff&&Le.push("RENDER_CUTOFF");const $e=c.renderPass==="shadow",ge=c.shadowRenderer,Ae=$e&&!!ge;c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!0);let he=[0,0,0];if(ge){const Qe=c.style.directionalLight,Je=c.style.ambientLight;Qe&&Je&&(he=El(Qe,Je)),Pe=Le.concat(["SHADOWS_SINGLE_CASCADE"])}const ve=Ae?"fillExtrusionDepth":z?"fillExtrusionPattern":"fillExtrusion",Ze=s.getLayerRenderingStats();for(const Qe of u){const Je=r.getTile(Qe),dt=Je.getBucket(s);if(!dt||dt.projection.name!==I.projection.name)continue;let Ct=!1;ge&&(Ct=ge.getMaxCascadeForTile(Qe.toUnwrapped())===0);const Ut=c.isTileAffectedByFog(Qe),Rt=dt.programConfigurations.get(s.id),kt=c.getOrCreateProgram(ve,{config:Rt,defines:Ct?Pe:Le,overrideFog:Ut});if(c.terrain&&c.terrain.setupElevationDraw(Je,kt,{useMeterToDem:!0}),!dt.centroidVertexBuffer){const ur=kt.attributes.a_centroid_pos;ur!==void 0&&M.vertexAttrib2f(ur,0,0)}!$e&&ge&&ge.setupShadows(Je.tileID.toUnwrapped(),kt,"vector-tile",Je.tileID.overscaledZ),z&&(c.context.activeTexture.set(M.TEXTURE0),Je.imageAtlasTexture&&Je.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Rt.updatePaintBuffers());const hi=P.constantOr(null);if(hi&&Je.imageAtlas){const ur=Je.imageAtlas.patternPositions[hi.toString()];ur&&Rt.setConstantPatternPositions(ur)}const Qt=s.paint.get("fill-extrusion-vertical-gradient");let ai;if($e&&ge){if(Vf(Je.tileID,dt,c))continue;const ur=ge.calculateShadowPassMatrixFromTile(Je.tileID.toUnwrapped());ai=Rh(ur,J,fe)}else{const ur=c.translatePosMatrix(Qe.expandedProjMatrix,Je,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),xi=I.projection.createInversionMatrix(I,Qe.canonical);ai=z?Xo(ur,c,Qt,O,G,J,Qe,Je,W,$,ee,xi,ae,fe):Ph(ur,c,Qt,O,G,J,Qe,W,$,ee,xi,ae,fe,le,he,_e)}c.uploadCommonUniforms(E,kt,Qe.toUnwrapped(),null,Te);let oi=dt.segments;if(I.projection.name==="mercator"&&!$e&&(oi=dt.getVisibleSegments(Je.tileID,c.terrain,c.transform.getFrustum(0)),!oi.get().length))continue;if(Ze)if($e)for(const ur of oi.get())Ze.numRenderedVerticesInShadowPass+=ur.primitiveLength;else for(const ur of oi.get())Ze.numRenderedVerticesInTransparentPass+=ur.primitiveLength;const Ii=[];(c.terrain||b)&&Ii.push(dt.centroidVertexBuffer),Q&&Ii.push(dt.layoutVertexExtBuffer),kt.draw(c,E.gl.TRIANGLES,f,m,x,Ht.backCCW,ai,s.id,dt.layoutVertexBuffer,dt.indexBuffer,oi,s.paint,c.transform.zoom,Rt,Ii)}c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!1)}function bo(c,r,s,u,f,m,x,b,E,M,I,P,z,O,j,U,G,F,Z){const J=c.context,W=J.gl,Q=c.transform,$=c.transform.zoom,ee=[],ae=go(c,s.paint.get("fill-extrusion-cutoff-fade-range"));M==="clear"?(ee.push("CLEAR_SUBPASS"),Z&&(ee.push("CLEAR_FROM_TEXTURE"),J.activeTexture.set(W.TEXTURE0),Z.bind(W.LINEAR,W.CLAMP_TO_EDGE))):M==="sdf"&&ee.push("SDF_SUBPASS"),G&&ee.push("HAS_CENTROID"),ae.shouldRenderCutoff&&ee.push("RENDER_CUTOFF");const le=s.layout.get("fill-extrusion-edge-radius"),fe=(Te,_e,Le,Pe,$e)=>{const ge=_e.programConfigurations.get(s.id),Ae=c.isTileAffectedByFog(Te),he=c.getOrCreateProgram("fillExtrusionGroundEffect",{config:ge,defines:ee,overrideFog:Ae}),ve=((Qe,Je,dt,Ct,Ut,Rt,kt,hi,Qt,ai,oi)=>({u_matrix:Je,u_opacity:dt,u_ao_pass:Ct?1:0,u_meter_to_tile:Ut,u_ao:Rt,u_flood_light_intensity:kt,u_flood_light_color:hi,u_attenuation:Qt,u_edge_radius:ai,u_fb:0,u_fb_size:oi}))(0,Pe,I,E,$e,[P,z*$e],O,j,U,$>=17?0:le*$e,Z?Z.size[0]:0),Ze=[];G&&Ze.push(_e.hiddenByLandmarkVertexBuffer),c.uploadCommonUniforms(J,he,Te.toUnwrapped(),null,ae),he.draw(c,J.gl.TRIANGLES,f,m,x,b,ve,s.id,_e.vertexBuffer,_e.indexBuffer,Le,s.paint,$,ge,Ze)};for(const Te of u){const _e=r.getTile(Te),Le=_e.getBucket(s);if(!Le||Le.projection.name!==Q.projection.name||!Le.groundEffect||Le.groundEffect&&!Le.groundEffect.hasData())continue;const Pe=Le.groundEffect,$e=1/Le.tileToMeter;{const ge=c.translatePosMatrix(Te.projMatrix,_e,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ae=Pe.getDefaultSegment();fe(Te,Pe,Ae,ge,$e)}if(F)for(let ge=0;ge<4;ge++){const Ae=o.cG[ge](Te),he=r.getTile(Ae);if(!he)continue;const ve=he.getBucket(s);if(!ve||ve.projection.name!==Q.projection.name||!ve.groundEffect||ve.groundEffect&&!ve.groundEffect.hasData())continue;const Ze=ve.groundEffect;let Qe,Je;ge===0?(Qe=[-o.V,0,0],Je=1):ge===1?(Qe=[o.V,0,0],Je=0):ge===2?(Qe=[0,-o.V,0],Je=3):(Qe=[0,o.V,0],Je=2);const dt=Ze.regionSegments[Je];if(!dt)continue;const Ct=new Float32Array(16);o.a6.translate(Ct,Te.projMatrix,Qe),fe(Te,Ze,dt,c.translatePosMatrix(Ct,_e,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),$e)}}}function b_(c,r,s,u,f,m,x){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const b=m?m.findDEMTileFor(s):null;if(!(b&&b.dem||x))return;const E=F=>new o.P(Math.ceil((F+o.cJ)*o.cK),0),M=F=>{const Z=r.getSource().minzoom,J=Q=>{const $=r.getTileByID(Q);if($&&$.hasData())return $.getBucket(f)},W=[0,-1,1];for(const Q of W){if(F.overscaledZ+Q<Z)continue;const $=J(F.calculateScaledKey(F.overscaledZ+Q));if($)return $}},I=[0,0,0],P=(F,Z)=>(I[0]=Math.min(F.min.y,Z.min.y),I[1]=Math.max(F.max.y,Z.max.y),I[2]=o.V-Z.min.x>F.max.x?Z.min.x-o.V:F.max.x,I),z=(F,Z)=>(I[0]=Math.min(F.min.x,Z.min.x),I[1]=Math.max(F.max.x,Z.max.x),I[2]=o.V-Z.min.y>F.max.y?Z.min.y-o.V:F.max.y,I),O=[(F,Z)=>P(F,Z),(F,Z)=>P(Z,F),(F,Z)=>z(F,Z),(F,Z)=>z(Z,F)],j=(F,Z,J,W,Q,$,ee)=>{if(!m)return 0;const ae=[[$?J:F,$?F:J,0],[$?J:Z,$?Z:J,0]],le=ee<0?o.V+ee:ee,fe=[$?le:(F+Z)/2,$?(F+Z)/2:le,0];return J===0&&ee<0||J!==0&&ee>0?m.getForTilePoints(Q,[fe],!0,W):ae.push(fe),m.getForTilePoints(s,ae,!0,b),Math.max(ae[0][2],ae[1][2],fe[2])/m.exaggeration()};for(let F=0;F<4;F++){const Z=u.borderFeatureIndices[F];if(Z.length===0)continue;const J=o.cG[F](s),W=M(J);if(!(W&&W instanceof o.cH)||u.borderDoneWithNeighborZ[F]===W.canonical.z)continue;W.centroidVertexArray.length===0&&W.createCentroidsBuffer();const Q=m?m.findDEMTileFor(J):null;if(!(Q&&Q.dem||x))continue;const $=(F<2?1:5)-F,ee=W.borderDoneWithNeighborZ[$]!==u.canonical.z,ae=W.borderFeatureIndices[$];let le=0;if(u.canonical.z!==W.canonical.z){for(const fe of Z)u.showCentroid(u.featuresOnBorder[fe]);if(ee)for(const fe of ae)W.showCentroid(W.featuresOnBorder[fe]);u.borderDoneWithNeighborZ[F]=W.canonical.z,W.borderDoneWithNeighborZ[$]=u.canonical.z}for(const fe of Z){const Te=u.featuresOnBorder[fe],_e=u.centroidData[Te.centroidDataIndex],Le=Te.borders[F];let Pe;for(;le<ae.length;){Pe=W.featuresOnBorder[ae[le]];const $e=Pe.borders[$];if($e[1]>Le[0]+3||$e[0]>Le[0]-3)break;W.showCentroid(Pe),le++}if(Pe&&le<ae.length){const $e=le;let ge=0;for(;!(Pe.borders[$][0]>Le[1]-3)&&(ge++,++le!==ae.length);)Pe=W.featuresOnBorder[ae[le]];if(Pe=W.featuresOnBorder[ae[$e]],ge>1){const ve=Pe.borders[$];Math.abs(Le[0]-ve[0])<3&&Math.abs(Le[1]-ve[1])<3&&(ge=1,le=$e+1)}else if(ge===0){u.showCentroid(Te);continue}const Ae=W.centroidData[Pe.centroidDataIndex];x&&ge===1&&(((U=_e).flags|(G=Ae).flags)&o.cI?(U.flags|=o.cI,G.flags|=o.cI):(U.flags&=~o.cI,G.flags&=~o.cI));const he=Te.intersectsCount()>1||Pe.intersectsCount()>1;if(ge>1)le=$e,_e.centroidXY=Ae.centroidXY=new o.P(0,0);else if(Q&&Q.dem&&!he){const ve=O[F](_e,Ae),Ze=F%2?o.V-1:0,Qe=j(ve[0],Math.min(o.V-1,ve[1]),Ze,Q,J,F<2,ve[2]);_e.centroidXY=Ae.centroidXY=E(Qe)}else he?_e.centroidXY=Ae.centroidXY=new o.P(0,0):(_e.centroidXY=u.encodeBorderCentroid(Te),Ae.centroidXY=W.encodeBorderCentroid(Pe));u.writeCentroidToBuffer(_e),W.writeCentroidToBuffer(Ae)}else u.showCentroid(Te)}u.borderDoneWithNeighborZ[F]=W.canonical.z,W.borderDoneWithNeighborZ[$]=u.canonical.z}var U,G;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(c)}const w_=[1,0,0],Bh=[0,1,0],Nf=[0,0,1];function Vf(c,r,s){const u=s.transform,f=s.shadowRenderer;if(!f)return!0;const m=c.toUnwrapped(),x=u.tileSize*f._cascades[s.currentShadowCascade].scale;let b=r.maxHeight;if(u.elevation){const U=u.elevation.getMinMaxForTile(c);U&&(b+=U.max)}const E=[...f.shadowDirection];E[2]=-E[2];const M=f.computeSimplifiedTileShadowVolume(m,b,x,E);if(!M)return!1;const I=[w_,Bh,Nf,E,[E[0],0,E[2]],[0,E[1],E[2]]],P=u.projection.name==="globe",z=u.scaleZoom(x),O=o.bq.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,z,!P),j=f.getCurrentCascadeFrustum();return O.intersectsPrecise(M.vertices,M.planes,I)===0||j.intersectsPrecise(M.vertices,M.planes,I)===0}function Uf(c){return[c[0]*o.cL,c[1]*o.cL,c[2]*o.cL,0]}function Fh(c,r,s,u,f,m,x,b,E){const M=u.getSource(),I=s.globeSharedBuffers;if(!I)return;let P,z,O;if(r&&(P=u.getTile(r)),M instanceof o.ap?(z=M.texture,O=o.cj(0,0,s.transform)):P&&r&&(z=P.texture,O=o.cj(r.canonical.z,r.canonical.x,s.transform)),!z||!O)return;c||(O=o.a6.scale(o.a6.create(),O,[1,-1,1]));const j=s.context,U=j.gl,G=f.paint.get("raster-resampling")==="nearest"?U.NEAREST:U.LINEAR,F=s.colorModeForDrapableLayerRenderPass(m),Z=x.defines;Z.push("GLOBE_POLES");const J=new Zt(U.LEQUAL,Zt.ReadWrite,s.depthRangeFor3D),W=Float32Array.from(s.transform.expandedFarZProjMatrix),Q=Float32Array.from(o.aT(o.ci(new o.bs(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),j.activeTexture.set(U.TEXTURE0),z.bind(G,U.CLAMP_TO_EDGE),j.activeTexture.set(U.TEXTURE1),z.bind(G,U.CLAMP_TO_EDGE),z.useMipmap&&j.extTextureFilterAnisotropic&&s.transform.pitch>20&&U.texParameterf(U.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const[$,ee,ae,le]=r?I.getPoleBuffers(r.canonical.z,!1):I.getPoleBuffers(0,!0),fe=f.paint.get("raster-elevation");let Te;c?(Te=$,s.renderDefaultNorthPole=fe!==0):(Te=ee,s.renderDefaultSouthPole=fe!==0);const _e=Uf(x.mix),Le=(($e,ge,Ae,he,ve,Ze,Qe,Je,dt,Ct,Ut,Rt,kt)=>kh($e,ge,Ae,new Float32Array(16),new Float32Array(9),[0,0],he,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ze,[0,0],Je,2,Ct,Ut,Rt,1,0,kt))(W,Q,O,o.S(s.transform.zoom),0,f,0,fe,0,_e,x.offset,x.range,m),Pe=s.getOrCreateProgram("raster",{defines:Z});s.uploadCommonUniforms(j,Pe,null),Pe.draw(s,U.TRIANGLES,J,E,F,b,Le,f.id,Te,ae,le)}function Nh(c){const r=c._nearZ,s=c.projection.farthestPixelDistance(c),u=s-r,f=.2*c.height,m=r+f;return[r,s,(m-f-r)/u,(m-r)/u]}function Vh(c,r,s,u){if(c)return r instanceof rt&&c instanceof Go?r.getTextureDescriptor(c,s,!0):{texture:c.texture,mix:Uf(u.mix),offset:u.offset,buffer:0,tileSize:1}}function Uh(c,r,s){if(!c)return null;const u=r.getTextureDescriptor(c,s,!0);if(!u)return null;let{texture:f,mix:m,offset:x,tileSize:b,buffer:E,format:M}=u;if(!f||!M)return null;let I=!1;return M==="uint32"&&(I=!0,m[3]=0,m=Vc(o.cM,m,[0,s.paint.get("raster-particle-max-speed")]),x=kf(o.cM,x,[0,s.paint.get("raster-particle-max-speed")])),{texture:f,textureOffset:[E/(b+2*E),b/(b+2*E)],tileSize:b,scalarData:I,scale:m,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[M]]}}function jh(c){const r=c._nearZ,s=c.projection.farthestPixelDistance(c),u=s-r,f=.2*c.height,m=r+f;return[r,s,(m-f-r)/u,(m-r)/u]}const Gn=new o.ax(1,0,0,1),wo=new o.ax(0,1,0,1),jf=new o.ax(0,0,1,1),Gh=new o.ax(1,0,1,1),$h=new o.ax(0,1,1,1);function To(c,r,s,u,f,m,x){const b=c.context,E=c.transform,M=b.gl,I=E.projection.name==="globe",P=I?["PROJECTION_GLOBE_VIEW"]:[];let z=o.a6.clone(s.projMatrix);if(I&&o.S(E.zoom)>0){const _e=o.aS(s.canonical,E),Le=o.cN(_e);z=o.a6.multiply(new Float32Array(16),E.globeMatrix,Le),o.a6.multiply(z,E.projMatrix,z)}const O=o.a6.create();O[12]+=2*f/(o.f.devicePixelRatio*E.width),O[13]+=2*m/(o.f.devicePixelRatio*E.height),o.a6.multiply(z,O,z);const j=c.getOrCreateProgram("debug",{defines:P}),U=r.getTileByID(s.key);c.terrain&&c.terrain.setupElevationDraw(U,j);const G=Zt.disabled,F=ti.disabled,Z=c.colorModeForRenderPass(),J="$debug";b.activeTexture.set(M.TEXTURE0),c.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),I?U._makeGlobeTileDebugBuffers(c.context,E):U._makeDebugTileBoundsBuffers(c.context,E.projection);const W=U._tileDebugBuffer||c.debugBuffer,Q=U._tileDebugIndexBuffer||c.debugIndexBuffer,$=U._tileDebugSegments||c.debugSegments;if(j.draw(c,M.LINE_STRIP,G,F,Z,Ht.disabled,Dh(z,u),J,W,Q,$,null,null,null,[U._globeTileDebugBorderBuffer]),x){const _e=U.latestRawTileData,Le=Math.floor((_e&&_e.byteLength||0)/1024);let Pe=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Pe+=` => ${s.overscaledZ}`),Pe+=` ${U.state}`,Pe+=` ${Le}kb`,function($e,ge){$e.initDebugOverlayCanvas();const Ae=$e.debugOverlayCanvas,he=$e.context.gl,ve=$e.debugOverlayCanvas.getContext("2d");ve.clearRect(0,0,Ae.width,Ae.height),ve.shadowColor="white",ve.shadowBlur=2,ve.lineWidth=1.5,ve.strokeStyle="white",ve.textBaseline="top",ve.font="bold 36px Open Sans, sans-serif",ve.fillText(ge,5,5),ve.strokeText(ge,5,5),$e.debugOverlayTexture.update(Ae),$e.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)}(c,Pe)}const ee=r.getTile(s).tileSize,ae=512/Math.min(ee,512)*(s.overscaledZ/E.zoom)*.5,le=U._tileDebugTextBuffer||c.debugBuffer,fe=U._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,Te=U._tileDebugTextSegments||c.debugSegments;j.draw(c,M.TRIANGLES,G,F,gi.alphaBlended,Ht.disabled,Dh(z,o.ax.transparent,ae),J,le,fe,Te,null,null,null,[U._globeTileDebugTextBuffer])}function qh(c,r,s,u){Cr(c,0,r+s/2,c.transform.width,s,u)}function es(c,r,s,u){Cr(c,r-s/2,0,s,c.transform.height,u)}function Cr(c,r,s,u,f,m){const x=c.context,b=x.gl;b.enable(b.SCISSOR_TEST),b.scissor(r*o.f.devicePixelRatio,s*o.f.devicePixelRatio,u*o.f.devicePixelRatio,f*o.f.devicePixelRatio),x.clear({color:m}),b.disable(b.SCISSOR_TEST)}const qc=o.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Zh}=qc;function $s(c,r,s,u){c.emplaceBack(r,s,u)}class Hh{constructor(r){this.vertexArray=new o.az,this.indices=new o.aw,$s(this.vertexArray,-1,-1,1),$s(this.vertexArray,1,-1,1),$s(this.vertexArray,-1,1,1),$s(this.vertexArray,1,1,1),$s(this.vertexArray,-1,-1,-1),$s(this.vertexArray,1,-1,-1),$s(this.vertexArray,-1,1,-1),$s(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Zh),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.aB.simpleSegment(0,0,36,12)}}function Jo(c,r,s,u,f,m){const x=c.context.gl,b=r.paint.get("sky-atmosphere-color"),E=r.paint.get("sky-atmosphere-halo-color"),M=r.paint.get("sky-atmosphere-sun-intensity"),I=((P,z,O,j,U)=>({u_matrix_3f:P,u_sun_direction:z,u_sun_intensity:O,u_color_tint_r:[j.r,j.g,j.b,j.a],u_color_tint_m:[U.r,U.g,U.b,U.a],u_luminance:5e-5}))(o.co.fromMat4(o.co.create(),u),f,M,b,E);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+m,r.skyboxTexture,0),s.draw(c,x.TRIANGLES,Zt.disabled,ti.disabled,gi.unblended,Ht.frontCW,I,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const T_=o.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class za{constructor(r){const s=new o.cO;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const u=new o.aw;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(s,T_.members),this.indexBuffer=r.createIndexBuffer(u),this.segments=o.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Dl=o.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class tt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Gt{constructor(r){this.colorModeAlphaBlendedWriteRGB=new gi([1,co,1,co],o.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new gi([1,0,1,0],o.ax.transparent,[!1,!1,!1,!0]),this.params=new tt,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){const s=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new za(s);const u=this.params.sizeRange,f=this.params.intensityRange,m=function(I){const P=o.aA(30),z=[];for(let O=0;O<I;++O){const j=2*Math.PI*P(),U=Math.acos(1-2*P())-.5*Math.PI;z.push(o.N.fromValues(Math.cos(U)*Math.cos(j),Math.cos(U)*Math.sin(j),Math.sin(U)))}return z}(this.params.starsCount),x=o.aA(300),b=new o.cP,E=new o.aw;let M=0;for(let I=0;I<m.length;++I){const P=o.N.scale([],m[I],200),z=Math.max(0,1+.01*u*(1*x()-.5)),O=Math.max(0,1+.01*f*(1*x()-.5));b.emplaceBack(P[0],P[1],P[2],-1,-1,z,O),b.emplaceBack(P[0],P[1],P[2],1,-1,z,O),b.emplaceBack(P[0],P[1],P[2],1,1,z,O),b.emplaceBack(P[0],P[1],P[2],-1,1,z,O),E.emplaceBack(M+0,M+1,M+2),E.emplaceBack(M+0,M+2,M+3),M+=4}this.starsVx=s.createVertexBuffer(b,Dl.members),this.starsIdx=s.createIndexBuffer(E),this.starsSegments=o.aB.simpleSegment(0,0,b.length,E.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,s){const u=r.context,f=u.gl,m=r.transform,x=new Zt(f.LEQUAL,Zt.ReadOnly,[0,1]),b=o.S(m.zoom),E=s.properties.get("color").toArray01(),M=s.properties.get("high-color").toArray01(),I=s.properties.get("space-color").toArray01PremultipliedAlpha(),P=5e-4,z=o.cQ(s.properties.get("horizon-blend"),0,1,P,.25),O=o.cd(r,u,m)&&z===P?m.worldSize/(2*Math.PI*1.025)-1:m.globeRadius,j=r.frameCounter/1e3%1,U=o.N.length(m.globeCenterInViewSpace),G=Math.sqrt(Math.pow(U,2)-Math.pow(O,2)),F=Math.acos(G/U),Z=J=>{const W=m.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];J&&W.push("ALPHA_PASS");const Q=r.getOrCreateProgram("globeAtmosphere",{defines:W}),$=((ae,le,fe,Te,_e,Le,Pe,$e,ge,Ae,he,ve)=>({u_frustum_tl:ae,u_frustum_tr:le,u_frustum_br:fe,u_frustum_bl:Te,u_horizon:_e,u_transition:Le,u_fadeout_range:Pe,u_color:$e,u_high_color:ge,u_space_color:Ae,u_temporal_offset:he,u_horizon_angle:ve}))(m.frustumCorners.TL,m.frustumCorners.TR,m.frustumCorners.BR,m.frustumCorners.BL,m.frustumCorners.horizon,b,z,E,M,I,j,F);r.uploadCommonUniforms(u,Q);const ee=this.atmosphereBuffer;ee&&Q.draw(r,f.TRIANGLES,x,ti.disabled,J?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ht.backCW,$,J?"atmosphere_glow_alpha":"atmosphere_glow",ee.vertexBuffer,ee.indexBuffer,ee.segments)};Z(!1),Z(!0)}drawStars(r,s){const u=o.aa(s.properties.get("star-intensity"),0,1);if(u===0)return;const f=r.context,m=f.gl,x=r.transform,b=r.getOrCreateProgram("stars"),E=o.bi.identity([]);o.bi.rotateX(E,E,-x._pitch),o.bi.rotateZ(E,E,-x.angle),o.bi.rotateX(E,E,o.bj(x._center.lat)),o.bi.rotateY(E,E,-o.bj(x._center.lng));const M=o.a6.fromQuat(new Float32Array(16),E),I=o.a6.multiply([],x.starsProjMatrix,M),P=o.co.fromMat4([],M),z=o.co.invert([],P),O=[0,1,0];o.N.transformMat3(O,O,z),o.N.scale(O,O,this.params.sizeMultiplier);const j=[1,0,0];o.N.transformMat3(j,j,z),o.N.scale(j,j,this.params.sizeMultiplier);const U=(G=O,F=j,Z=u,{u_matrix:Float32Array.from(I),u_up:G,u_right:F,u_intensity_multiplier:Z});var G,F,Z;r.uploadCommonUniforms(f,b),this.starsVx&&this.starsIdx&&b.draw(r,m.TRIANGLES,Zt.disabled,ti.disabled,this.colorModeAlphaBlendedWriteRGB,Ht.disabled,U,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Qo(c,r){const s=[...c],u=r.cameraWorldSizeForFog/r.worldSize,f=o.a6.identity([]);return o.a6.scale(f,f,[u,u,1]),o.a6.multiply(s,f,s),o.a6.multiply(s,r.worldToFogMatrix,s),s}function Pr(c,r,s,u){const f=s.material,m=u.context,{baseColorTexture:x,metallicRoughnessTexture:b}=f.pbrMetallicRoughness,{normalTexture:E,occlusionTexture:M,emissionTexture:I}=f;function P(z,O,j){if(z&&(c.push(O),m.activeTexture.set(m.gl.TEXTURE0+j),z.gfxTexture)){const{minFilter:U,magFilter:G,wrapS:F,wrapT:Z}=z.sampler;z.gfxTexture.bindExtraParam(U,G,F,Z)}}P(x,"HAS_TEXTURE_u_baseColorTexture",yn.BaseColor),P(b,"HAS_TEXTURE_u_metallicRoughnessTexture",yn.MetallicRoughness),P(E,"HAS_TEXTURE_u_normalTexture",yn.Normal),P(M,"HAS_TEXTURE_u_occlusionTexture",yn.Occlusion),P(I,"HAS_TEXTURE_u_emissionTexture",yn.Emission),s.texcoordBuffer&&(c.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(s.texcoordBuffer)),s.colorBuffer&&(c.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(s.colorBuffer)),s.normalBuffer&&(c.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(s.normalBuffer)),s.pbrBuffer&&(c.push("HAS_ATTRIBUTE_a_pbr"),c.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(s.pbrBuffer)),f.alphaMode!=="OPAQUE"&&f.alphaMode!=="MASK"||c.push("UNPREMULT_TEXTURE_IN_SHADER"),f.defined||c.push("DIFFUSE_SHADED"),c.push("USE_STANDARD_DERIVATIVES")}function zl(c,r,s,u,f,m){const x=s.paint.get("model-opacity"),b=r.context,E=new Zt(r.context.gl.LEQUAL,Zt.ReadWrite,r.depthRangeFor3D),M=r.transform,I=c.mesh,P=I.material,z=P.pbrMetallicRoughness,O=r.style.fog;let j;j=r.transform.projection.zAxisUnit==="pixels"?[...c.nodeModelMatrix]:o.a6.multiply([],u.zScaleMatrix,c.nodeModelMatrix),o.a6.multiply(j,u.negCameraPosMatrix,j);const U=o.a6.invert([],j);o.a6.transpose(U,U);const G=s.paint.get("model-emissive-strength").constantOr(0),F=Gc(new Float32Array(c.worldViewProjection),new Float32Array(j),new Float32Array(U),r,x,z.baseColorFactor,P.emissiveFactor,z.metallicFactor,z.roughnessFactor,P,G,s),Z={defines:[]},J=[];Pr(Z.defines,J,I,r);const W=r.shadowRenderer;W&&(W.useNormalOffset=!1);let Q=null;if(O){const ae=Qo(c.nodeModelMatrix,r.transform);if(Q=new Float32Array(ae),M.projection.name!=="globe"){const le=I.aabb.min,fe=I.aabb.max,[Te,_e]=O.getOpacityForBounds(ae,le[0],le[1],fe[0],fe[1]);Z.overrideFog=Te>=Yi||_e>=Yi}}const $=go(r,s.paint.get("model-cutoff-fade-range"));$.shouldRenderCutoff&&Z.defines.push("RENDER_CUTOFF");const ee=r.getOrCreateProgram("model",Z);r.uploadCommonUniforms(b,ee,null,Q,$),r.renderPass!=="shadow"&&W&&W.setupShadowsFromMatrix(c.nodeModelMatrix,ee),ee.draw(r,b.gl.TRIANGLES,E,f,m,I.material.doubleSided?Ht.disabled:Ht.backCCW,F,s.id,I.vertexBuffer,I.indexBuffer,I.segments,s.paint,r.transform.zoom,void 0,J)}function kl(c,r,s,u,f,m,x){let b;b=c.projection.name==="globe"?o.cS(s,c):[...s],o.a6.multiply(b,b,r.matrix);const E=o.a6.multiply([],u,b);if(r.meshes)for(const M of r.meshes){if(M.material.alphaMode!=="BLEND"){x.push({mesh:M,depth:0,modelIndex:f,worldViewProjection:E,nodeModelMatrix:b});continue}const I=o.N.transformMat4([],M.centroid,E);I[2]>0&&m.push({mesh:M,depth:I[2],modelIndex:f,worldViewProjection:E,nodeModelMatrix:b})}if(r.children)for(const M of r.children)kl(c,M,s,u,f,m,x)}function be(c,r,s,u){const f=s.shadowRenderer;if(!f)return;const m=f.getShadowPassDepthMode(),x=f.getShadowPassColorMode(),b=f.calculateShadowPassMatrixFromMatrix(r),E=Rl(b);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,m,ti.disabled,x,Ht.backCCW,E,u.id,c.vertexBuffer,c.indexBuffer,c.segments,u.paint,s.transform.zoom,void 0,void 0)}function Wh(c,r,s){const u=r.updateZoomBasedPaintProperties(),f=function(m,x,b){let E,M,I,P=m.terrain?m.terrain.exaggeration():0;if(m.terrain&&P>0){const z=m.terrain,O=z.findDEMTileFor(b);O&&O.dem?E=o.cU.create(z,b,O):P=0}if(P===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),P===x.validForExaggeration&&(P===0||E&&E._demTile&&E._demTile.tileID===x.validForDEMTile.id&&E._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(const z in x.instancesPerModel){const O=x.instancesPerModel[z];for(let j=0;j<O.instancedDataArray.length;++j){const U=(E?P*E.getElevationAt(0|O.instancedDataArray.float32[16*j],0|O.instancedDataArray.float32[16*j+1],!0,!0):0)+O.instancesEvaluatedElevation[j];O.instancedDataArray.float32[16*j+6]=U,M=M?Math.min(x.terrainElevationMin,U):U,I=I?Math.max(x.terrainElevationMax,U):U}}return x.terrainElevationMin=M||0,x.terrainElevationMax=I||0,x.validForExaggeration=P,x.validForDEMTile=E&&E._demTile?{id:E._demTile.tileID,timestamp:E._dem._timestamp}:{id:void 0,timestamp:0},!0}(c,r,s);(u||f)&&(r.uploaded=!1,r.upload(c.context))}const ts={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.bS([0,0,0],[o.V,o.V,0])};function Gf(c,r){const s=1<<c.canonical.z,u=r.getFreeCameraOptions().position,f=r.elevation,m=c.canonical.x/s,x=(c.canonical.x+1)/s,b=c.canonical.y/s,E=(c.canonical.y+1)/s;let M=r._centerAltitude;if(f){const O=f.getMinMaxForTile(c);O&&O.max>M&&(M=O.max)}const I=o.aa(u.x,m,x)-u.x,P=o.aa(u.y,b,E)-u.y,z=o.bl(M,r.center.lat)-u.z;return r._zoomFromMercatorZ(Math.sqrt(I*I+P*P+z*z))}function Xh(c,r,s,u,f,m,x){const b=c.context,E=c.renderPass==="shadow",M=c.shadowRenderer,I=E&&M?M.getShadowPassDepthMode():new Zt(b.gl.LEQUAL,Zt.ReadWrite,c.depthRangeFor3D),P=c.isTileAffectedByFog(m);if(s.meshes)for(const z of s.meshes){const O=["MODEL_POSITION_ON_GPU"],j=[];let U,G,F;u.instancedDataArray.length>20&&O.push("INSTANCED_ARRAYS");const Z=go(c,r.paint.get("model-cutoff-fade-range"));if(Z.shouldRenderCutoff&&O.push("RENDER_CUTOFF"),E&&M)U=c.getOrCreateProgram("modelDepth",{defines:O}),G=Rl(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(s.matrix)),F=M.getShadowPassColorMode();else{Pr(O,j,z,c),U=c.getOrCreateProgram("model",{defines:O,overrideFog:P});const W=z.material,Q=W.pbrMetallicRoughness,$=r.paint.get("model-opacity"),ee=r.paint.get("model-emissive-strength").constantOr(0);G=Gc(m.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),c,$,Q.baseColorFactor,W.emissiveFactor,Q.metallicFactor,Q.roughnessFactor,W,ee,r,f),M&&(x.shadowUniformsInitialized?U.setShadowUniformValues(b,M.getShadowUniformValues()):(M.setupShadows(m.toUnwrapped(),U,"model-tile",m.overscaledZ),x.shadowUniformsInitialized=!0)),F=Z.shouldRenderCutoff||$<1||W.alphaMode!=="OPAQUE"?gi.alphaBlended:gi.unblended}c.uploadCommonUniforms(b,U,m.toUnwrapped(),null,Z);const J=z.material.doubleSided?Ht.disabled:Ht.backCCW;if(u.instancedDataArray.length>20)j.push(u.instancedDataBuffer),U.draw(c,b.gl.TRIANGLES,I,ti.disabled,F,J,G,r.id,z.vertexBuffer,z.indexBuffer,z.segments,r.paint,c.transform.zoom,void 0,j,u.instancedDataArray.length);else{const W=E?"u_instance":"u_normal_matrix";for(let Q=0;Q<u.instancedDataArray.length;++Q)G[W]=new Float32Array(u.instancedDataArray.arrayBuffer,64*Q,16),U.draw(c,b.gl.TRIANGLES,I,ti.disabled,F,J,G,r.id,z.vertexBuffer,z.indexBuffer,z.segments,r.paint,c.transform.zoom,void 0,j)}}if(s.children)for(const z of s.children)Xh(c,r,z,u,f,m,x)}const ka=[1,-1,1];function E_(c,r,s,u){if(!s.modelManager)return!0;const f=s.modelManager;if(!s.shadowRenderer)return!0;const m=s.shadowRenderer,x=r.aabb;let b=!0,E=c.maxHeight;if(E===0){let I=0;for(const P in c.instancesPerModel){const z=f.getModel(P,u);z?I=Math.max(I,Math.max(Math.max(z.aabb.max[0],z.aabb.max[1]),z.aabb.max[2])):b=!1}E=c.maxScale*I*1.41+c.maxVerticalOffset,b&&(c.maxHeight=E)}x.max[2]=E,x.min[2]+=c.terrainElevationMin,x.max[2]+=c.terrainElevationMax,o.N.transformMat4(x.min,x.min,r.tileMatrix),o.N.transformMat4(x.max,x.max,r.tileMatrix);const M=x.intersects(m.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(c.isInsideFirstShadowMapFrustum=M===2),M===0}class S_{}class $f{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,s,u){{const P=this._storage.get(s.id);if(P)return P.lastUsedFrameIdx=r,P.buf}const f=u.gl,m=f.getBufferParameter(f.ELEMENT_ARRAY_BUFFER,f.BUFFER_SIZE),x=new ArrayBuffer(m),b=new Int16Array(x);f.getBufferSubData(f.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));const E=new o.cW;for(let P=0;P<m/2;P+=3){const z=b[P],O=b[P+1],j=b[P+2];E.emplaceBack(z,O),E.emplaceBack(O,j),E.emplaceBack(j,z)}const M=u.bindVertexArrayOES.current,I=new S_;return I.buf=new hr(u,E),I.lastUsedFrameIdx=r,this._storage.set(s.id,I),u.bindVertexArrayOES.set(M),I.buf}update(r){for(const[s,u]of this._storage)r-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(s))}destroy(){for(const[r,s]of this._storage)s.buf.destroy(),this._storage.delete(r)}}class Ol{registerParameter(r,s,u,f,m){}registerButton(r,s,u){}}const Bl={symbol:function(c,r,s,u,f){if(c.renderPass!=="translucent")return;const m=ti.disabled,x=c.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(M,I,P,z,O,j,U){const G=I.transform,F=O==="map",Z=j==="map";for(const J of M){const W=z.getTile(J),Q=W.getBucket(P);if(!Q||!Q.text||!Q.text.segments.get().length)continue;const $=o.b5(Q.textSizeData,G.zoom),ee=yl(J,Q.getProjection(),G),ae=G.calculatePixelsToTileUnitsMatrix(W),le=_l(ee,W.tileID.canonical,Z,F,G,Q.getProjection(),ae),fe=Q.hasIconTextFit()&&Q.hasIconData();if($){const Te=Math.pow(2,G.zoom-W.tileID.overscaledZ);Ff(Q,F,Z,U,o.cx,G,le,J,Te,$,fe)}}}(u,c,s,r,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),f);const b=s.paint.get("icon-opacity").constantOr(1)!==0,E=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(b||E)?$c(c,r,s,u,m,x):(b&&$c(c,r,s,u,m,x,{onlyIcons:!0}),E&&$c(c,r,s,u,m,x,{onlyText:!0})),r.map.showCollisionBoxes&&(bs(c,r,s,u,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),bs(c,r,s,u,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(c,r,s,u){if(c.renderPass!=="translucent")return;const f=s.paint.get("circle-opacity"),m=s.paint.get("circle-stroke-width"),x=s.paint.get("circle-stroke-opacity"),b=s.layout.get("circle-sort-key").constantOr(1)!==void 0,E=s.paint.get("circle-emissive-strength");if(f.constantOr(1)===0&&(m.constantOr(1)===0||x.constantOr(1)===0))return;const M=c.context,I=M.gl,P=c.transform,z=c.depthModeForSublayer(0,Zt.ReadOnly),O=ti.disabled,j=c.colorModeForDrapableLayerRenderPass(E),U=P.projection.name==="globe",G=[o.a5(P.center.lng),o.ae(P.center.lat)],F=[];for(let J=0;J<u.length;J++){const W=u[J],Q=r.getTile(W),$=Q.getBucket(s);if(!$||$.projection.name!==P.projection.name)continue;const ee=$.programConfigurations.get(s.id),ae=o.cy(s),le=c.isTileAffectedByFog(W);U&&ae.push("PROJECTION_GLOBE_VIEW");const fe=c.getOrCreateProgram("circle",{config:ee,defines:ae,overrideFog:le}),Te=$.layoutVertexBuffer,_e=$.globeExtVertexBuffer,Le=$.indexBuffer,Pe=P.projection.createInversionMatrix(P,W.canonical),$e={programConfiguration:ee,program:fe,layoutVertexBuffer:Te,globeExtVertexBuffer:_e,indexBuffer:Le,uniformValues:o.cz(c,W,Q,Pe,G,s),tile:Q};if(b){const ge=$.segments.get();for(const Ae of ge)F.push({segments:new o.aB([Ae]),sortKey:Ae.sortKey,state:$e})}else F.push({segments:$.segments,sortKey:0,state:$e})}b&&F.sort((J,W)=>J.sortKey-W.sortKey);const Z={useDepthForOcclusion:P.depthOcclusionForSymbolsAndCircles};for(const J of F){const{programConfiguration:W,program:Q,layoutVertexBuffer:$,globeExtVertexBuffer:ee,indexBuffer:ae,uniformValues:le,tile:fe}=J.state,Te=J.segments;c.terrain&&c.terrain.setupElevationDraw(fe,Q,Z),c.uploadCommonUniforms(M,Q,fe.tileID.toUnwrapped()),Q.draw(c,I.TRIANGLES,z,O,j,Ht.disabled,le,s.id,$,ae,Te,s.paint,P.zoom,W,[ee])}},heatmap:function(c,r,s,u){if(s.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const f=c.context,m=f.gl,x=ti.disabled,b=new gi([m.ONE,m.ONE,m.ONE,m.ONE],o.ax.transparent,[!0,!0,!0,!0]);(function(O,j,U,G){const F=O.gl,Z=j.width*G,J=j.height*G;O.activeTexture.set(F.TEXTURE1),O.viewport.set([0,0,Z,J]);let W=U.heatmapFbo;if(!W||W&&(W.width!==Z||W.height!==J)){W&&W.destroy();const Q=F.createTexture();F.bindTexture(F.TEXTURE_2D,Q),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),W=U.heatmapFbo=O.createFramebuffer(Z,J,!0,null),function($,ee,ae,le,fe,Te){const _e=$.gl;_e.texImage2D(_e.TEXTURE_2D,0,$.extRenderToTextureHalfFloat?_e.RGBA16F:_e.RGBA,fe,Te,0,_e.RGBA,$.extRenderToTextureHalfFloat?_e.HALF_FLOAT:_e.UNSIGNED_BYTE,null),le.colorAttachment.set(ae)}(O,0,Q,W,Z,J)}else F.bindTexture(F.TEXTURE_2D,W.colorAttachment.get()),O.bindFramebuffer.set(W.framebuffer)})(f,c,s,c.transform.projection.name==="globe"?.5:.25),f.clear({color:o.ax.transparent});const E=c.transform,M=E.projection.name==="globe",I=M?["PROJECTION_GLOBE_VIEW"]:[],P=M?Ht.frontCCW:Ht.disabled,z=[o.a5(E.center.lng),o.ae(E.center.lat)];for(let O=0;O<u.length;O++){const j=u[O];if(r.hasRenderableParent(j))continue;const U=r.getTile(j),G=U.getBucket(s);if(!G||G.projection.name!==E.projection.name)continue;const F=c.isTileAffectedByFog(j),Z=G.programConfigurations.get(s.id),J=c.getOrCreateProgram("heatmap",{config:Z,defines:I,overrideFog:F}),{zoom:W}=c.transform;c.terrain&&c.terrain.setupElevationDraw(U,J),c.uploadCommonUniforms(f,J,j.toUnwrapped());const Q=E.projection.createInversionMatrix(E,j.canonical);J.draw(c,m.TRIANGLES,Zt.disabled,x,b,P,zh(c,j,U,Q,z,W,s.paint.get("heatmap-intensity")),s.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,s.paint,c.transform.zoom,Z,M?[G.globeExtVertexBuffer]:null)}f.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(f,m){const x=f.context,b=x.gl,E=m.heatmapFbo;if(!E)return;x.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,E.colorAttachment.get()),x.activeTexture.set(b.TEXTURE1);let M=m.colorRampTexture;M||(M=m.colorRampTexture=new o.T(x,m.colorRamp,b.RGBA)),M.bind(b.LINEAR,b.CLAMP_TO_EDGE),f.getOrCreateProgram("heatmapTexture").draw(f,b.TRIANGLES,Zt.disabled,ti.disabled,f.colorModeForRenderPass(),Ht.disabled,((I,P,z,O)=>({u_image:0,u_color_ramp:1,u_opacity:P.paint.get("heatmap-opacity")}))(0,m),m.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,m.paint,f.transform.zoom)}(c,s))},line:function(c,r,s,u){if(c.renderPass!=="translucent")return;const f=s.paint.get("line-opacity"),m=s.paint.get("line-width");if(f.constantOr(1)===0||m.constantOr(1)===0)return;const x=s.paint.get("line-emissive-strength"),b=c.depthModeForSublayer(0,Zt.ReadOnly),E=c.colorModeForDrapableLayerRenderPass(x),M=c.terrain&&c.terrain.renderingToTexture?1:o.f.devicePixelRatio,I=s.paint.get("line-dasharray"),P=I.constantOr(1),z=s.layout.get("line-cap"),O=s.paint.get("line-pattern"),j=O.constantOr(1),U=s.paint.get("line-pattern").constantOr(1),G=s.paint.get("line-opacity").constantOr(1)!==1;let F=!U&&G;const Z=s.paint.get("line-gradient"),J=j?"linePattern":"line",W=c.context,Q=W.gl,$=o.cA(s);c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(F=!1);for(const ee of u){const ae=r.getTile(ee);if(j&&!ae.patternsLoaded())continue;const le=ae.getBucket(s);if(!le)continue;c.prepareDrawTile();const fe=le.programConfigurations.get(s.id),Te=c.isTileAffectedByFog(ee),_e=c.getOrCreateProgram(J,{config:fe,defines:$,overrideFog:Te}),Le=O.constantOr(null);if(Le&&ae.imageAtlas){const Qe=ae.imageAtlas.patternPositions[Le.toString()];Qe&&fe.setConstantPatternPositions(Qe)}const Pe=I.constantOr(null),$e=z.constantOr(null);if(!j&&Pe&&$e&&ae.lineAtlas){const Qe=ae.lineAtlas.getDash(Pe,$e);Qe&&fe.setConstantPatternPositions(Qe)}let[ge,Ae]=s.paint.get("line-trim-offset");($e==="round"||$e==="square")&&ge!==Ae&&(ge===0&&(ge-=1),Ae===1&&(Ae+=1));const he=c.terrain?ee.projMatrix:null,ve=j?o.cB(c,ae,s,he,M,[ge,Ae]):o.cC(c,ae,s,he,le.lineClipsArray.length,M,[ge,Ae]);if(Z){const Qe=le.gradients[s.id];let Je=Qe.texture;if(s.gradientVersion!==Qe.version){let dt=256;if(s.stepInterpolant){const Ct=r.getSource().maxzoom,Ut=ee.canonical.z===Ct?Math.ceil(1<<c.transform.maxZoom-ee.canonical.z):1;dt=o.aa(o.cD(le.maxLineLength/o.V*1024*Ut),256,W.maxTextureSize)}Qe.gradient=o.cE({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:dt,image:Qe.gradient||void 0,clips:le.lineClipsArray}),Qe.texture?Qe.texture.update(Qe.gradient):Qe.texture=new o.T(W,Qe.gradient,Q.RGBA),Qe.version=s.gradientVersion,Je=Qe.texture}W.activeTexture.set(Q.TEXTURE1),Je.bind(s.stepInterpolant?Q.NEAREST:Q.LINEAR,Q.CLAMP_TO_EDGE)}P&&(W.activeTexture.set(Q.TEXTURE0),ae.lineAtlasTexture&&ae.lineAtlasTexture.bind(Q.LINEAR,Q.REPEAT),fe.updatePaintBuffers()),j&&(W.activeTexture.set(Q.TEXTURE0),ae.imageAtlasTexture&&ae.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),fe.updatePaintBuffers()),c.uploadCommonUniforms(W,_e,ee.toUnwrapped());const Ze=Qe=>{_e.draw(c,Q.TRIANGLES,b,Qe,E,Ht.disabled,ve,s.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,s.paint,c.transform.zoom,fe,[le.layoutVertexBuffer2])};if(F){const Qe=c.stencilModeForClipping(ee).ref;Qe===0&&c.terrain&&W.clear({stencil:0});const Je={func:Q.EQUAL,mask:255};ve.u_alpha_discard_threshold=.8,Ze(new ti(Je,Qe,255,Q.KEEP,Q.KEEP,Q.INVERT)),ve.u_alpha_discard_threshold=0,Ze(new ti(Je,Qe,255,Q.KEEP,Q.KEEP,Q.KEEP))}else Ze(c.stencilModeForClipping(ee))}F&&(c.resetStencilClippingMasks(),c.terrain&&W.clear({stencil:0}))},fill:function(c,r,s,u){const f=s.paint.get("fill-color"),m=s.paint.get("fill-opacity");if(m.constantOr(1)===0)return;const x=s.paint.get("fill-emissive-strength"),b=c.colorModeForDrapableLayerRenderPass(x),E=s.paint.get("fill-pattern"),M=c.opaquePassEnabledForLayer()&&!E.constantOr(1)&&f.constantOr(o.ax.transparent).a===1&&m.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===M){const I=c.depthModeForSublayer(1,c.renderPass==="opaque"?Zt.ReadWrite:Zt.ReadOnly);Ko(c,r,s,u,I,b,!1)}if(c.renderPass==="translucent"&&s.paint.get("fill-antialias")){const I=c.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,Zt.ReadOnly);Ko(c,r,s,u,I,b,!0)}},"fill-extrusion":function(c,r,s,u){const f=s.paint.get("fill-extrusion-opacity"),m=c.context,x=m.gl,b=c.terrain,E=b&&b.renderingToTexture;if(f===0)return;const M=c.conflationActive&&c.layerUsedInConflation(s,r.getSource());if(M&&function(I,P,z,O){for(const j of O){const U=P.getTile(j).getBucket(z);U&&(U.updateReplacement(j,I.replacementSource),U.uploadCentroid(I.context))}}(c,r,s,u),b||M)for(const I of u){const P=r.getTile(I).getBucket(s);P&&b_(c.context,r,I,P,s,b,M)}if(c.renderPass==="shadow"&&c.shadowRenderer){const I=c.shadowRenderer;if(b&&f<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.Z)return;const P=I.getShadowPassDepthMode(),z=I.getShadowPassColorMode();Pt(c,r,s,u,P,ti.disabled,z,M)}else if(c.renderPass==="translucent"){const I=!s.paint.get("fill-extrusion-pattern").constantOr(1),P=s.paint.get("fill-extrusion-color").constantOr(o.ax.white);if(!E&&P.a!==0){const z=new Zt(c.context.gl.LEQUAL,Zt.ReadWrite,c.depthRangeFor3D);f===1&&I?Pt(c,r,s,u,z,ti.disabled,gi.unblended,M):(Pt(c,r,s,u,z,ti.disabled,gi.disabled,M),Pt(c,r,s,u,z,c.stencilModeFor3D(),c.colorModeForRenderPass(),M),c.resetStencilClippingMasks())}if(c.style.enable3dLights()&&I&&(!b&&c.transform.projection.name!=="globe"||E)){const z=s.paint.get("fill-extrusion-opacity"),O=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),j=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),U=s.paint.get("fill-extrusion-flood-light-intensity"),G=s.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),F=O>0&&j>0,Z=U>0,J=(Q,$,ee)=>(1-ee)*Q+ee*$,W=Q=>{const $=c.depthModeForSublayer(1,Zt.ReadOnly,x.LEQUAL,!0),ee=s.paint.get(Q?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ae=J(.1,3,ee),le=c._showOverdrawInspector;if(!le){const fe=new ti({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Te=new gi([x.ONE,x.ONE,x.ONE,x.ONE],o.ax.transparent,[!1,!1,!1,!0],x.MIN);bo(c,r,s,u,$,fe,Te,Ht.disabled,Q,"sdf",z,O,j,U,G,ae,M,!1)}{const fe=le?ti.disabled:new ti({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Te=le?c.colorModeForRenderPass():new gi([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],o.ax.transparent,[!0,!0,!0,!0]);bo(c,r,s,u,$,fe,Te,Ht.disabled,Q,"color",z,O,j,U,G,ae,M,!1)}};if(E){const Q=($,ee,ae)=>{const le=c.depthModeForSublayer(1,Zt.ReadOnly,x.LEQUAL,!1),fe=s.paint.get($?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Te=J(.1,3,fe);{const _e=new gi([x.ONE,x.ONE,x.ONE,x.ONE],o.ax.transparent,[!1,!1,!1,!0]);bo(c,r,s,u,le,ti.disabled,_e,Ht.disabled,$,"clear",z,O,j,U,G,Te,M,ee)}{const _e=new ti({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Le=new gi([x.ONE,x.ONE,x.ONE,x.ONE],o.ax.transparent,[!1,!1,!1,!0],x.MIN);bo(c,r,s,u,le,_e,Le,Ht.disabled,$,"sdf",z,O,j,U,G,Te,M,ee)}{const _e=$?x.ZERO:x.ONE_MINUS_DST_ALPHA,Le=new ti({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Pe=new gi([_e,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],o.ax.transparent,[!0,!0,!0,!0]);bo(c,r,s,u,le,Le,Pe,Ht.disabled,$,"color",z,O,j,U,G,Te,M,ee)}{const _e=new gi([x.ONE,x.ONE,x.ONE,$?x.ZERO:x.ONE],o.ax.transparent,[!1,!1,!1,!0],$?x.FUNC_ADD:x.MAX);bo(c,r,s,u,le,ti.disabled,_e,Ht.disabled,$,"clear",z,O,j,U,G,Te,M,ee,ae)}};if(F||Z){let $;if(c.prepareDrawTile(),b){const ee=b.drapeBufferSize[0],ae=b.drapeBufferSize[1];$=b.framebufferCopyTexture,$&&(!$||$.size[0]===ee&&$.size[1]===ae)||($&&$.destroy(),$=b.framebufferCopyTexture=new o.T(m,new o.h({width:ee,height:ae}),x.RGBA)),$.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexImage2D(x.TEXTURE_2D,0,x.RGBA,0,0,ee,ae,0)}F&&Q(!0,!1,$),Z&&Q(!1,!0,$)}}else F&&W(!0),Z&&W(!1)}}},hillshade:function(c,r,s,u){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent"||c.style.disableElevatedTerrain)return;const f=c.context,m=c.terrain&&c.terrain.renderingToTexture,[x,b]=c.renderPass!=="translucent"||m?[{},u]:c.stencilConfigForOverlap(u);for(const E of b){const M=r.getTile(E);if(M.needsHillshadePrepare&&c.renderPass==="offscreen")bh(c,M,s);else if(c.renderPass==="translucent"){const I=c.depthModeForSublayer(0,Zt.ReadOnly),P=s.paint.get("hillshade-emissive-strength"),z=c.colorModeForDrapableLayerRenderPass(P),O=m&&c.terrain?c.terrain.stencilModeForRTTOverlap(E):x[E.overscaledZ];Bc(c,E,M,s,I,O,z)}}f.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,r,s,u,f,m){if(c.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const x=c.transform.projection.name==="globe",b=s.paint.get("raster-elevation")!==0,E=b&&x;if(c.renderElevatedRasterBackface&&!E)return;const M=c.context,I=M.gl,P=r.getSource(),z=function($,ee,ae,le){const fe=ee.paint.get("raster-color"),Te=$.type==="raster-array",_e=[],Le=ee.paint.get("raster-resampling"),Pe=ee.paint.get("raster-color-mix");let $e=ee.paint.get("raster-color-range");const ge=[Pe[0],Pe[1],Pe[2],0],Ae=Pe[3];let he=Le==="nearest"?le.NEAREST:le.LINEAR;if(Te&&(_e.push("RASTER_ARRAY"),fe||_e.push("RASTER_COLOR"),Le==="linear"&&_e.push("RASTER_ARRAY_LINEAR"),he=le.NEAREST,!$e&&$.rasterLayers)){const ve=$.rasterLayers.find(({id:Ze})=>Ze===ee.sourceLayer);ve&&ve.fields&&ve.fields.range&&($e=ve.fields.range)}if($e=$e||[0,1],fe){_e.push("RASTER_COLOR"),ae.activeTexture.set(le.TEXTURE2),ee.updateColorRamp($e);let ve=ee.colorRampTexture;ve||(ve=ee.colorRampTexture=new o.T(ae,ee.colorRamp,le.RGBA)),ve.bind(le.LINEAR,le.CLAMP_TO_EDGE)}return{mix:ge,range:$e,offset:Ae,defines:_e,resampling:he}}(P,s,M,I);if(P instanceof o.ap&&!u.length&&!x)return;const O=s.paint.get("raster-emissive-strength"),j=c.colorModeForDrapableLayerRenderPass(O),U=c.terrain&&c.terrain.renderingToTexture,G=!c.options.moving,F=s.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;if(P instanceof o.ap&&!u.length&&(P.onNorthPole||P.onSouthPole)){const $=b?c.stencilModeFor3D():ti.disabled;return void Fh(!!P.onNorthPole,null,c,r,s,O,z,Ht.disabled,$)}if(!u.length)return;const[Z,J]=P instanceof o.ap||U?[{},u]:c.stencilConfigForOverlap(u),W=J[J.length-1].overscaledZ;E&&z.defines.push("PROJECTION_GLOBE_VIEW"),b&&z.defines.push("RENDER_CUTOFF");const Q=($,ee,ae)=>{for(const le of $){const fe=le.toUnwrapped(),Te=r.getTile(le);if(U&&(!Te||!Te.hasData()))continue;M.activeTexture.set(I.TEXTURE0);const _e=Vh(Te,P,s,z);if(!_e||!_e.texture)continue;const{texture:Le,mix:Pe,offset:$e,tileSize:ge,buffer:Ae}=_e;let he,ve;U?(he=Zt.disabled,ve=le.projMatrix):b?(he=new Zt(I.LEQUAL,Zt.ReadWrite,c.depthRangeFor3D),ve=x?Float32Array.from(c.transform.expandedFarZProjMatrix):c.transform.calculateProjMatrix(fe,G)):(he=c.depthModeForSublayer(le.overscaledZ-W,s.paint.get("raster-opacity")===1?Zt.ReadWrite:Zt.ReadOnly,I.LESS),ve=c.transform.calculateProjMatrix(fe,G));const Ze=c.terrain&&U?c.terrain.stencilModeForRTTOverlap(le):Z[le.overscaledZ],Qe=m?0:s.paint.get("raster-fade-duration");Te.registerFadeDuration(Qe);const Je=r.findLoadedParent(le,0),dt=Sh(Te,Je,r,c.transform,Qe);let Ct,Ut;c.terrain&&c.terrain.prepareDrawTile(),M.activeTexture.set(I.TEXTURE0),Le.bind(F,I.CLAMP_TO_EDGE),M.activeTexture.set(I.TEXTURE1),Je?(Je.texture&&Je.texture.bind(F,I.CLAMP_TO_EDGE),Ct=Math.pow(2,Je.tileID.overscaledZ-Te.tileID.overscaledZ),Ut=[Te.tileID.canonical.x*Ct%1,Te.tileID.canonical.y*Ct%1]):Le.bind(F,I.CLAMP_TO_EDGE),Le.useMipmap&&M.extTextureFilterAnisotropic&&c.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const Rt=c.transform;let kt;const hi=b?Nh(Rt):[0,0,0,0];let Qt,ai,oi,Ii,ur,xi=0;if(E&&P instanceof o.ap&&P.coordinates.length>3)Qt=Float32Array.from(o.aT(o.ci(new o.bs(0,0,0)))),ai=Float32Array.from(Rt.globeMatrix),oi=Float32Array.from(o.ce(Rt)),Ii=[o.a5(Rt.center.lng),o.ae(Rt.center.lat)],kt=P.elevatedGlobePerspectiveTransform,ur=P.elevatedGlobeGridMatrix||new Float32Array(9);else if(E){const bi=o.cf(le.canonical);xi=o.cg(bi.getCenter().lat),Qt=Float32Array.from(o.aT(o.ci(le.canonical))),ai=Float32Array.from(Rt.globeMatrix),oi=Float32Array.from(o.ce(Rt)),Ii=[o.a5(Rt.center.lng),o.ae(Rt.center.lat)],kt=[0,0],ur=Float32Array.from(o.ch(le.canonical,bi,xi,Rt.worldSize/Rt._pixelsPerMercatorPixel))}else kt=P instanceof o.ap?P.perspectiveTransform:[0,0],Qt=new Float32Array(16),ai=new Float32Array(9),oi=new Float32Array(16),Ii=[0,0],ur=new Float32Array(9);const Rr=kh(ve,Qt,ai,oi,ur,Ut||[0,0],o.S(c.transform.zoom),Ii,hi,Ct||1,dt,s,kt,b?s.paint.get("raster-elevation"):0,2,Pe,$e,z.range,ge,Ae,O),vi=c.isTileAffectedByFog(le),ki=c.getOrCreateProgram("raster",{defines:z.defines,overrideFog:vi});if(c.uploadCommonUniforms(M,ki,fe),P instanceof o.ap){const bi=P.elevatedGlobeVertexBuffer,Di=P.elevatedGlobeIndexBuffer;if(U||!x)P.boundsBuffer&&P.boundsSegments&&ki.draw(c,I.TRIANGLES,he,ti.disabled,j,Ht.disabled,Rr,s.id,P.boundsBuffer,c.quadTriangleIndexBuffer,P.boundsSegments);else if(bi&&Di){const pr=Rt.zoom<=o.bG?P.elevatedGlobeSegments:P.getSegmentsForLongitude(Rt.center.lng);pr&&ki.draw(c,I.TRIANGLES,he,ti.disabled,j,ee,Rr,s.id,bi,Di,pr)}}else if(E){he=new Zt(I.LEQUAL,Zt.ReadOnly,c.depthRangeFor3D);const bi=c.globeSharedBuffers;if(bi){const[Di,pr,Gi]=bi.getGridBuffers(xi,!1);ki.draw(c,I.TRIANGLES,he,ae||Ze,c.colorModeForRenderPass(),ee,Rr,s.id,Di,pr,Gi)}}else{const{tileBoundsBuffer:bi,tileBoundsIndexBuffer:Di,tileBoundsSegments:pr}=c.getTileBoundsBuffers(Te);ki.draw(c,I.TRIANGLES,he,Ze,j,Ht.disabled,Rr,s.id,bi,Di,pr)}}if(!(P instanceof o.ap)&&E)for(const le of $){const fe=le.canonical.y===(1<<le.canonical.z)-1;le.canonical.y===0&&Fh(!0,le,c,r,s,O,z,ee,ae||ti.disabled),fe&&Fh(!1,le,c,r,s,O,z,ee===Ht.frontCW?Ht.backCW:Ht.frontCW,ae||ti.disabled)}};E?Q(J,c.renderElevatedRasterBackface?Ht.backCW:Ht.frontCW,c.stencilModeFor3D()):Q(J,Ht.disabled,void 0),c.resetStencilClippingMasks()},"raster-particle":function(c,r,s,u,f,m){c.renderPass==="offscreen"&&function(x,b,E,M){if(!M.length)return;const I=x.context,P=I.gl,z=b.getSource();if(!(z instanceof rt))return;const O=[];for(const G of M){const F=b.getTile(G);if(!(F instanceof Go))continue;const Z=Uh(F,z,E);if(!Z)continue;const J=[Z.tileSize,Z.tileSize];let W=E.tileFramebuffer;W||(W=E.tileFramebuffer=I.createFramebuffer(J[0],J[1],!0,null));let Q=F.rasterParticleState;const $=E.paint.get("raster-particle-count");Q||(Q=F.rasterParticleState=new Jr(I,G,J,$));const ee=Q.update(E.lastInvalidatedAt);Q.numParticles!==$&&Q.setNumParticles(G,$);const ae=Q.targetColorTexture;Q.targetColorTexture=Q.backgroundColorTexture,Q.backgroundColorTexture=ae;const le=Q.particleVertices0;Q.particleVertices0=Q.particleVertices1,Q.particleVertices1=le,O.push([G,Z,Q,ee])}if(O.length===0)return;const j=o.f.now(),U=E.previousDrawTimestamp?.001*(j-E.previousDrawTimestamp):.0167;if(E.previousDrawTimestamp=j,E.hasColorMap()){I.activeTexture.set(P.TEXTURE0+2);let G=E.colorRampTexture;G||(G=E.colorRampTexture=new o.T(I,E.colorRamp,P.RGBA)),G.bind(P.LINEAR,P.CLAMP_TO_EDGE)}I.bindFramebuffer.set(E.tileFramebuffer.framebuffer),I.activeTexture.set(P.TEXTURE0),function(G,F,Z){const J=G.context,W=J.gl,Q=F.tileFramebuffer;J.activeTexture.set(W.TEXTURE0);const $={u_texture:0,u_opacity:1.05*(ae=F.paint.get("raster-particle-fade-opacity-factor"))/(ae+.05)},ee=G.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ae;for(const le of Z){const[,,fe,Te]=le;Q.colorAttachment.set(fe.targetColorTexture.texture),J.viewport.set([0,0,Q.width,Q.height]),J.clear({color:o.ax.transparent}),Te&&(fe.backgroundColorTexture.bind(W.NEAREST,W.CLAMP_TO_EDGE),ee.draw(G,W.TRIANGLES,Zt.disabled,ti.disabled,gi.alphaBlended,Ht.disabled,$,F.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments))}}(x,E,O),function(G,F,Z,J){const W=G.context.gl,Q=Z.tileFramebuffer,$=G.transform.projection.name==="globe",ee=Z.paint.get("raster-particle-max-speed");for(const ae of J){const[le,fe,Te]=ae;fe.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Q.colorAttachment.set(Te.targetColorTexture.texture);const _e=G.getOrCreateProgram("rasterParticleDraw",{defines:fe.defines,overrideFog:!1}),Le=fe.scalarData?[]:[0,1,2,3].map(ge=>o.cG[ge](le));Le.push(le);const Pe=le.canonical.x,$e=le.canonical.y;for(const ge of Le){const Ae=F.getTile($?ge.wrapped():ge);if(!Ae)continue;const he=Ae.rasterParticleState;if(!he)continue;const ve=x_([ge.canonical.x+(1<<ge.canonical.z)*(ge.wrap-le.wrap)-Pe,ge.canonical.y-$e],0,fe.texture.size,2,ee,fe.textureOffset,fe.scale,fe.offset);_e.draw(G,W.POINTS,Zt.disabled,ti.disabled,gi.alphaBlended,Ht.disabled,ve,Z.id,he.particleVertices0,void 0,he.particleSegment)}}}(x,b,E,O),function(G,F,Z,J){const W=G.context.gl;let Q=F.transformFeedbackObject;Q||(Q=F.transformFeedbackObject=W.createTransformFeedback()),W.bindTransformFeedback(W.TRANSFORM_FEEDBACK,F.transformFeedbackObject);const $=F.paint.get("raster-particle-max-speed"),ee=J*F.paint.get("raster-particle-speed-factor")*.3,ae=(le=F.paint.get("raster-particle-reset-rate-factor"),Math.pow(le,6));var le;for(const fe of Z){const[,Te,_e]=fe;Te.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const Le=Of(0,Te.texture.size,$,ee,ae,Te.textureOffset,Te.scale,Te.offset);G.getOrCreateProgram("rasterParticleUpdate",{defines:Te.defines,transformFeedback:{bufferMode:W.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(G,W.POINTS,Zt.disabled,ti.disabled,gi.disabled,Ht.disabled,Le,F.id,_e.particleVertices0,void 0,_e.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:_e.particleVertices1,targetIndex:0}])}W.bindTransformFeedback(W.TRANSFORM_FEEDBACK,null)}(x,E,O,U)}(c,r,s,u),c.renderPass==="translucent"&&(function(x,b,E,M,I){const P=x.context,z=P.gl,O=!x.options.moving,j=x.transform.projection.name==="globe";if(!M.length)return;const[U,G]=x.stencilConfigForOverlap(M),F=[];j&&F.push("PROJECTION_GLOBE_VIEW");for(const Z of G){const J=Z.toUnwrapped(),W=b.getTile(Z);if(!W.rasterParticleState)continue;const Q=W.rasterParticleState,$=100;W.registerFadeDuration($);const ee=b.findLoadedParent(Z,0),ae=Sh(W,ee,b,x.transform,$);let le,fe;x.terrain&&x.terrain.prepareDrawTile(),P.activeTexture.set(z.TEXTURE0),Q.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),P.activeTexture.set(z.TEXTURE1),ee&&ee.rasterParticleState?(ee.rasterParticleState.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),le=Math.pow(2,ee.tileID.overscaledZ-W.tileID.overscaledZ),fe=[W.tileID.canonical.x*le%1,W.tileID.canonical.y*le%1]):Q.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const Te=j?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(J,O),_e=x.transform,Le=jh(_e),Pe=o.cf(Z.canonical),$e=o.cg(Pe.getCenter().lat);let ge,Ae,he,ve,Ze;j?(ge=Float32Array.from(o.aT(o.ci(Z.canonical))),Ae=Float32Array.from(_e.globeMatrix),he=Float32Array.from(o.ce(_e)),ve=[o.a5(_e.center.lng),o.ae(_e.center.lat)],Ze=Float32Array.from(o.ch(Z.canonical,Pe,$e,_e.worldSize/_e._pixelsPerMercatorPixel))):(ge=new Float32Array(16),Ae=new Float32Array(9),he=new Float32Array(16),ve=[0,0],Ze=new Float32Array(9));const Qe=y_(Te,ge,Ae,he,Ze,fe||[0,0],o.S(x.transform.zoom),ve,Le,le||1,ae,250),Je=x.isTileAffectedByFog(Z),dt=x.getOrCreateProgram("rasterParticle",{defines:F,overrideFog:Je});if(x.uploadCommonUniforms(P,dt,J),j){const Ct=new Zt(z.LEQUAL,Zt.ReadWrite,x.depthRangeFor3D),Ut=0,Rt=x.globeSharedBuffers;if(Rt){const[kt,hi,Qt]=Rt.getGridBuffers($e,Ut!==0);dt.draw(x,z.TRIANGLES,Ct,ti.disabled,gi.alphaBlended,Ht.backCCW,Qe,E.id,kt,hi,Qt)}}else{const Ct=x.depthModeForSublayer(0,Zt.ReadOnly),Ut=U[Z.overscaledZ],{tileBoundsBuffer:Rt,tileBoundsIndexBuffer:kt,tileBoundsSegments:hi}=x.getTileBoundsBuffers(W);dt.draw(x,z.TRIANGLES,Ct,Ut,gi.alphaBlended,Ht.disabled,Qe,E.id,Rt,kt,hi)}}x.resetStencilClippingMasks()}(c,r,s,u),c.style.map.triggerRepaint())},background:function(c,r,s,u){const f=s.paint.get("background-color"),m=s.paint.get("background-opacity"),x=s.paint.get("background-emissive-strength");if(m===0)return;const b=c.context,E=b.gl,M=c.transform,I=M.tileSize,P=s.paint.get("background-pattern");if(c.isPatternMissing(P,s.scope))return;const z=!P&&f.a===1&&m===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==z)return;const O=ti.disabled,j=c.depthModeForSublayer(0,z==="opaque"?Zt.ReadWrite:Zt.ReadOnly),U=c.colorModeForDrapableLayerRenderPass(x),G=P?"backgroundPattern":"background";let F,Z=u;Z||(F=c.getBackgroundTiles(),Z=Object.values(F).map(J=>J.tileID)),P&&(b.activeTexture.set(E.TEXTURE0),c.imageManager.bind(c.context,s.scope));for(const J of Z){const W=c.isTileAffectedByFog(J),Q=c.getOrCreateProgram(G,{overrideFog:W}),$=J.toUnwrapped(),ee=u?J.projMatrix:c.transform.calculateProjMatrix($);c.prepareDrawTile();const ae=r?r.getTile(J):F?F[J.key]:new uo(J,I,M.zoom,c),le=P?Cl(ee,x,m,c,P,s.scope,{tileID:J,tileSize:I}):Oh(ee,x,m,f);c.uploadCommonUniforms(b,Q,$);const{tileBoundsBuffer:fe,tileBoundsIndexBuffer:Te,tileBoundsSegments:_e}=c.getTileBoundsBuffers(ae);Q.draw(c,E.TRIANGLES,j,O,U,Ht.disabled,le,s.id,fe,Te,_e)}},sky:function(c,r,s){const u=c._atmosphere?o.S(c.transform.zoom):1,f=s.paint.get("sky-opacity")*u;if(f===0)return;const m=c.context,x=s.paint.get("sky-type"),b=new Zt(m.gl.LEQUAL,Zt.ReadOnly,[0,1]),E=c.frameCounter/1e3%1;x==="atmosphere"?c.renderPass==="offscreen"?s.needsSkyboxCapture(c)&&(function(M,I,P,z){const O=M.context,j=O.gl;let U=I.skyboxFbo;if(!U){U=I.skyboxFbo=O.createFramebuffer(32,32,!0,null),I.skyboxGeometry=new Hh(O),I.skyboxTexture=O.gl.createTexture(),j.bindTexture(j.TEXTURE_CUBE_MAP,I.skyboxTexture),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR);for(let J=0;J<6;++J)j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+J,0,j.RGBA,32,32,0,j.RGBA,j.UNSIGNED_BYTE,null)}O.bindFramebuffer.set(U.framebuffer),O.viewport.set([0,0,32,32]);const G=I.getCenter(M,!0),F=M.getOrCreateProgram("skyboxCapture"),Z=new Float64Array(16);o.a6.identity(Z),o.a6.rotateY(Z,Z,.5*-Math.PI),Jo(M,I,F,Z,G,0),o.a6.identity(Z),o.a6.rotateY(Z,Z,.5*Math.PI),Jo(M,I,F,Z,G,1),o.a6.identity(Z),o.a6.rotateX(Z,Z,.5*-Math.PI),Jo(M,I,F,Z,G,2),o.a6.identity(Z),o.a6.rotateX(Z,Z,.5*Math.PI),Jo(M,I,F,Z,G,3),o.a6.identity(Z),Jo(M,I,F,Z,G,4),o.a6.identity(Z),o.a6.rotateY(Z,Z,Math.PI),Jo(M,I,F,Z,G,5),O.viewport.set([0,0,M.width,M.height])}(c,s),s.markSkyboxValid(c)):c.renderPass==="sky"&&function(M,I,P,z,O){const j=M.context,U=j.gl,G=M.transform,F=M.getOrCreateProgram("skybox");j.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_CUBE_MAP,I.skyboxTexture);const Z=((J,W,Q,$,ee)=>({u_matrix:J,u_sun_direction:W,u_cubemap:0,u_opacity:$,u_temporal_offset:ee}))(G.skyboxMatrix,I.getCenter(M,!1),0,z,O);M.uploadCommonUniforms(j,F),F.draw(M,U.TRIANGLES,P,ti.disabled,M.colorModeForRenderPass(),Ht.backCW,Z,"skybox",I.skyboxGeometry.vertexBuffer,I.skyboxGeometry.indexBuffer,I.skyboxGeometry.segment)}(c,s,b,f,E):x==="gradient"&&c.renderPass==="sky"&&function(M,I,P,z,O){const j=M.context,U=j.gl,G=M.transform,F=M.getOrCreateProgram("skyboxGradient");I.skyboxGeometry||(I.skyboxGeometry=new Hh(j)),j.activeTexture.set(U.TEXTURE0);let Z=I.colorRampTexture;Z||(Z=I.colorRampTexture=new o.T(j,I.colorRamp,U.RGBA)),Z.bind(U.LINEAR,U.CLAMP_TO_EDGE);const J=((W,Q,$,ee,ae)=>({u_matrix:W,u_color_ramp:0,u_center_direction:Q,u_radius:o.bj($),u_opacity:ee,u_temporal_offset:ae}))(G.skyboxMatrix,I.getCenter(M,!1),I.paint.get("sky-gradient-radius"),z,O);M.uploadCommonUniforms(j,F),F.draw(M,U.TRIANGLES,P,ti.disabled,M.colorModeForRenderPass(),Ht.backCW,J,"skyboxGradient",I.skyboxGeometry.vertexBuffer,I.skyboxGeometry.indexBuffer,I.skyboxGeometry.segment)}(c,s,b,f,E)},debug:function(c,r,s,u,f,m){for(let x=0;x<s.length;x++)if(f){const M=new o.ax(u.r*.8,u.g*.8,u.b*.8,1);To(c,r,s[x],u,-1,-1,m),To(c,r,s[x],u,-1,1,m),To(c,r,s[x],u,1,1,m),To(c,r,s[x],u,1,-1,m),To(c,r,s[x],M,0,0,m)}else To(c,r,s[x],u,0,0,m)},custom:function(c,r,s,u){const f=c.context,m=s.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||c.renderPass==="offscreen")&&s.isLayerDraped(r)){if(c.renderPass==="offscreen"){const x=m.prerender;if(x){if(c.setCustomLayerDefaults(),f.setColorMode(c.colorModeForRenderPass()),c.transform.projection.name==="globe"){const b=c.transform.pointMerc;x.call(m,f.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),o.S(c.transform.zoom),[b.x,b.y],c.transform.pixelsPerMeterRatio)}else x.call(m,f.gl,c.transform.customLayerMatrix());f.setDirty(),c.setBaseState()}}else if(c.renderPass==="translucent"){if(c.terrain&&c.terrain.renderingToTexture){const b=m.renderToTile;if(b){const E=u[0].canonical,M=new o.L(E.x+u[0].wrap*(1<<E.z),E.y,E.z);f.setDepthMode(Zt.disabled),f.setStencilMode(ti.disabled),f.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),b.call(m,f.gl,M),f.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),f.setColorMode(c.colorModeForRenderPass()),f.setStencilMode(ti.disabled);const x=m.renderingMode==="3d"?new Zt(c.context.gl.LEQUAL,Zt.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,Zt.ReadOnly);if(f.setDepthMode(x),c.transform.projection.name==="globe"){const b=c.transform.pointMerc;m.render(f.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),o.S(c.transform.zoom),[b.x,b.y],c.transform.pixelsPerMeterRatio)}else m.render(f.gl,c.transform.customLayerMatrix());f.setDirty(),c.setBaseState(),f.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(c,r,s,u){if(c.renderPass==="opaque")return;const f=s.paint.get("model-opacity");if(f===0)return;const m=s.paint.get("model-cast-shadows");if(c.renderPass==="shadow"&&(!m||c.terrain&&f<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof o.Z))return;const x=c.shadowRenderer,b=s.paint.get("model-receive-shadows");x&&(x.useNormalOffset=!0,b||(x.enabled=!1));const E=()=>{x&&(x.useNormalOffset=!0,b||(x.enabled=!0))},M=r.getSource();if(c.renderPass==="light-beam"&&M.type!=="batched-model")return;if(M.type==="vector"||M.type==="geojson")return function(F,Z,J,W){const Q=F.transform;if(Q.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${Q.projection.name} projection is not yet implemented`);const $=Q.getFreeCameraOptions().position;if(!F.modelManager)return;const ee=F.modelManager;J.modelManager=ee;const ae=F.shadowRenderer;if(!J._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const le=J._unevaluatedLayout._values["model-id"],fe={...J.layout.get("model-id").parameters};for(const Te of W){const _e=Z.getTile(Te).getBucket(J);if(!_e||_e.projection.name!==Q.projection.name)continue;const Le=Gf(Te,Q);fe.zoom=Le;const Pe=le.possiblyEvaluate(fe);if(Wh(F,_e,Te),ts.shadowUniformsInitialized=!1,ts.useSingleShadowCascade=!!ae&&ae.getMaxCascadeForTile(Te.toUnwrapped())===0,F.renderPass==="shadow"&&ae){if(F.currentShadowCascade===1&&_e.isInsideFirstShadowMapFrustum)continue;const Ae=Q.calculatePosMatrix(Te.toUnwrapped(),Q.worldSize);if(ts.tileMatrix.set(Ae),ts.shadowTileMatrix=Float32Array.from(ae.calculateShadowPassMatrixFromMatrix(Ae)),ts.aabb.min.fill(0),ts.aabb.max[0]=ts.aabb.max[1]=o.V,ts.aabb.max[2]=0,E_(_e,ts,F,J.scope))continue}const $e=1<<Te.canonical.z,ge=[(($.x-Te.wrap)*$e-Te.canonical.x)*o.V,($.y*$e-Te.canonical.y)*o.V,$.z*$e*o.V];for(let Ae in _e.instancesPerModel){const he=_e.instancesPerModel[Ae];he.features.length>0&&(Ae=Pe.evaluate(he.features[0].feature,{}));const ve=ee.getModel(Ae,J.scope);if(ve&&ve.uploaded)for(const Ze of ve.nodes)Xh(F,J,Ze,he,ge,Te,ts)}}}(c,r,s,u),void E();if(!M.loaded())return;if(M.type==="batched-model")return function(F,Z,J,W){J.resetLayerRenderingStats(F);const Q=F.context,$=F.transform,ee=F.style.fog,ae=F.shadowRenderer;if($.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${$.projection.name} projection is not yet implemented`);const le=F.transform.getFreeCameraOptions().position,fe=o.N.scale([],[le.x,le.y,le.z],F.transform.worldSize);o.N.negate(fe,fe);const Te=o.a6.identity([]),_e=o.cR($.center.lat,$.zoom),Le=o.a6.fromScaling([],[1,1,1/_e]);o.a6.translate(Te,Te,fe);const Pe=J.paint.get("model-opacity"),$e=new Zt(Q.gl.LEQUAL,Zt.ReadWrite,F.depthRangeFor3D),ge=new Zt(Q.gl.LEQUAL,Zt.ReadOnly,F.depthRangeFor3D),Ae=new o.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),he=F.renderPass==="shadow",ve=he&&ae?ae.getCurrentCascadeFrustum():$.getFrustum($.scaleZoom($.worldSize)),Ze=J.getLayerRenderingStats(),Qe=function(Je,dt){for(const Ct of W){const Ut=Z.getTile(Ct).getBucket(J);if(!Ut||!Ut.uploaded)continue;let Rt=!1;ae&&(Rt=ae.getMaxCascadeForTile(Ct.toUnwrapped())===0);const kt=$.calculatePosMatrix(Ct.toUnwrapped(),$.worldSize),hi=Ut.modelTraits;for(const Qt of Ut.getNodesInfo()){if(Qt.hiddenByReplacement||!Qt.node.meshes)continue;const ai=Qt.evaluatedScale,oi=Qt.node;let Ii=0;if(F.terrain&&oi.elevation&&(Ii=oi.elevation*F.terrain.exaggeration()),ai[0]<=1&&ai[1]<=1&&ai[2]<=1&&(()=>{const pr=Qt.getLocalBounds();return Ae.min=[...pr.min],Ae.max=[...pr.max],Ae.min[2]+=Ii,Ae.max[2]+=Ii,o.N.transformMat4(Ae.min,Ae.min,kt),o.N.transformMat4(Ae.max,Ae.max,kt),Ae})().intersects(ve)===0)continue;const ur=F.renderPass==="light-beam",xi=[...kt];o.a6.translate(xi,xi,[(oi.anchor?oi.anchor[0]:0)*(ai[0]-1),(oi.anchor?oi.anchor[1]:0)*(ai[1]-1),Ii]),o.N.exactEquals(ai,o.cT)||o.a6.scale(xi,xi,ai),o.a6.multiply(xi,xi,oi.matrix);const Rr=o.a6.multiply([],Le,xi);o.a6.multiply(Rr,Te,Rr);const vi=o.a6.invert([],Rr);o.a6.transpose(vi,vi),o.a6.scale(vi,vi,ka);const ki=o.a6.multiply([],$.expandedFarZProjMatrix,xi),bi=hi&o.cV.HasMapboxMeshFeatures,Di=bi?0:Qt.evaluatedRMEA[0][2];for(let pr=0;pr<oi.meshes.length;++pr){const Gi=oi.meshes[pr],on=pr===oi.lightMeshIndex;if(on){if(!ur&&!F.terrain&&F.shadowRenderer){F.currentLayer<F.firstLightBeamLayer&&(F.firstLightBeamLayer=F.currentLayer);continue}}else if(ur)continue;const xn={defines:[]},qn=[];if(Pr(xn.defines,qn,Gi,F),bi||xn.defines.push("DIFFUSE_SHADED"),Rt&&xn.defines.push("SHADOWS_SINGLE_CASCADE"),Ze&&(he?Ze.numRenderedVerticesInShadowPass+=Gi.vertexArray.length:Ze.numRenderedVerticesInTransparentPass+=Gi.vertexArray.length),he){be(Gi,xi,F,J);continue}let Ds=null;if(ee){const Hn=Qo(xi,F.transform);if(Ds=new Float32Array(Hn),$.projection.name!=="globe"){const zs=Gi.aabb.min,Io=Gi.aabb.max,[ta,Kl]=ee.getOpacityForBounds(Hn,zs[0],zs[1],Io[0],Io[1]);xn.overrideFog=ta>=Yi||Kl>=Yi}}const Zn=Gi.material;let an;Zn.occlusionTexture&&Zn.occlusionTexture.offsetScale&&(an=Zn.occlusionTexture.offsetScale,xn.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!he&&ae&&(ae.useNormalOffset=!!Gi.normalBuffer);const en=F.getOrCreateProgram("model",xn);!he&&ae&&ae.setupShadowsFromMatrix(xi,en,ae.useNormalOffset),F.uploadCommonUniforms(Q,en,Ct.toUnwrapped(),Ds);const Pn=Zn.pbrMetallicRoughness;Pn.metallicFactor=.9,Pn.roughnessFactor=.5;const kn=Gc(new Float32Array(ki),new Float32Array(Rr),new Float32Array(vi),F,Pe,Pn.baseColorFactor,Zn.emissiveFactor,Pn.metallicFactor,Pn.roughnessFactor,Zn,Di,J,[0,0,0],an);en.draw(F,Q.gl.TRIANGLES,dt&&!on?$e:ge,ti.disabled,Je?on||Pe<1||Qt.hasTranslucentParts?gi.alphaBlended:gi.unblended:gi.disabled,Ht.backCCW,kn,J.id,Gi.vertexBuffer,Gi.indexBuffer,Gi.segments,J.paint,F.transform.zoom,void 0,qn)}}}};(function(Je,dt,Ct,Ut){const Rt=Je.terrain?Je.terrain.exaggeration():0,kt=Je.transform.zoom;for(const hi of Ut){const Qt=dt.getTile(hi).getBucket(Ct);Qt&&(Je.conflationActive&&Qt.updateReplacement(hi,Je.replacementSource),Qt.evaluateScale(Je,Ct),Je.terrain&&Rt>0&&Qt.elevationUpdate(Je.terrain,Rt,hi,Ct.source),Qt.needsReEvaluation(Je,kt,Ct)&&Qt.evaluate(Ct))}})(F,Z,J,W),Pe===1?Qe(!0,!0):(Qe(!1,!0),Qe(!0,!1))}(c,r,s,u),void E();const I=M.getModels(),P=[],z=c.transform.getFreeCameraOptions().position,O=o.N.scale([],[z.x,z.y,z.z],c.transform.worldSize);o.N.negate(O,O);const j=[],U=[];let G=0;for(const F of I){const Z=s.paint.get("model-rotation").constantOr(null),J=s.paint.get("model-scale").constantOr(null),W=s.paint.get("model-translation").constantOr(null);F.computeModelMatrix(c,Z,J,W,!0,!0,!1);const Q=o.a6.identity([]),$=o.cR(F.position.lat,c.transform.zoom),ee=o.a6.fromScaling([],[1,1,1/$]);o.a6.translate(Q,Q,O),P.push({zScaleMatrix:ee,negCameraPosMatrix:Q});for(const ae of F.nodes)kl(c.transform,ae,F.matrix,c.transform.expandedFarZProjMatrix,G,j,U);G++}if(j.sort((F,Z)=>Z.depth-F.depth),c.renderPass!=="shadow"){if(f===1)for(const F of U)zl(F,c,s,P[F.modelIndex],ti.disabled,c.colorModeForRenderPass());else{for(const F of U)zl(F,c,s,P[F.modelIndex],ti.disabled,gi.disabled);for(const F of U)zl(F,c,s,P[F.modelIndex],c.stencilModeFor3D(),c.colorModeForRenderPass());c.resetStencilClippingMasks()}for(const F of j)zl(F,c,s,P[F.modelIndex],ti.disabled,c.colorModeForRenderPass());E()}else{for(const F of U)be(F.mesh,F.nodeModelMatrix,c,s);for(const F of j)be(F.mesh,F.nodeModelMatrix,c,s);E()}}},Yh={model:function(c,r,s){const u=c.scope,f=r.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,u));if(f.type==="batched-model")return;const m=f.getModels();for(const x of m)x.upload(s.context)},raster:function(c,r,s){const u=r.getSource();if(!(u instanceof rt&&u.loaded()))return;const f=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!f)return;const m=c.paint.get("raster-array-band")||u.getInitialBand(f);if(m==null)return;const x=r.getIds().map(b=>r.getTileByID(b));for(const b of x)b.updateNeeded(f,m)&&u.prepareTile(b,f,m)},"raster-particle":function(c,r,s){const u=r.getSource();if(!(u instanceof rt&&u.loaded()))return;const f=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!f)return;const m=c.paint.get("raster-particle-array-band")||u.getInitialBand(f);if(m==null)return;const x=r.getIds().map(b=>r.getTileByID(b));for(const b of x)b.updateNeeded(f,m)&&u.prepareTile(b,f,m)}};class qf{constructor(r,s,u,f){this.context=new pf(r,s),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=f,this._debugParams={showTerrainProxyTiles:!1},f.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=gs.maxUnderzooming+gs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new fh(this),this._wireframeDebugCache=new $f,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(r,s){const u=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new g_(this,r));const f=this._terrain;this.transform.elevation=u?f:null,f.update(r,this.transform,s),this.transform.elevation&&!f.enabled&&(this.transform.elevation=null)}_updateFog(r){const s=r.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,f]=s.getFovAdjustedRange(this.transform._fov);if(u>f)return void(this.transform.fogCullDistSq=null);const m=u+.78*(f-u);this.transform.fogCullDistSq=m*m}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,s){if(this.width=r*o.f.devicePixelRatio,this.height=s*o.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const r=this.context,s=new o.aN;s.emplaceBack(0,0),s.emplaceBack(o.V,0),s.emplaceBack(0,o.V),s.emplaceBack(o.V,o.V),this.tileExtentBuffer=r.createVertexBuffer(s,o.aP.members),this.tileExtentSegments=o.aB.simpleSegment(0,0,4,2);const u=new o.aN;u.emplaceBack(0,0),u.emplaceBack(o.V,0),u.emplaceBack(0,o.V),u.emplaceBack(o.V,o.V),this.debugBuffer=r.createVertexBuffer(u,o.aP.members),this.debugSegments=o.aB.simpleSegment(0,0,4,5);const f=new o.aN;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(-1,1),f.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(f,o.aP.members),this.viewportSegments=o.aB.simpleSegment(0,0,4,2);const m=new o.av;m.emplaceBack(0,0,0,0),m.emplaceBack(o.V,0,o.V,0),m.emplaceBack(0,o.V,0,o.V),m.emplaceBack(o.V,o.V,o.V,o.V),this.mercatorBoundsBuffer=r.createVertexBuffer(m,o.aR.members),this.mercatorBoundsSegments=o.aB.simpleSegment(0,0,4,2);const x=new o.aw;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(x);const b=new o.aO;for(const M of[0,1,3,2,0])b.emplaceBack(M);this.debugIndexBuffer=r.createIndexBuffer(b),this.emptyTexture=new o.T(r,new o.h({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=o.a6.create();const E=this.context.gl;this.stencilClearMode=new ti({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,Zt.disabled,this.stencilClearMode,gi.disabled,Ht.disabled,Eh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,s,u){if(!s||this.currentStencilSource===s.id||!r.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let b=!1;for(const E of u)if(this._tileClippingMaskIDs[E.key]===void 0){b=!0;break}if(!b)return}this.currentStencilSource=s.id;const f=this.context,m=f.gl;this.nextStencilID+u.length>256&&this.clearStencil(),f.setColorMode(gi.disabled),f.setDepthMode(Zt.disabled);const x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of u){const E=s.getTile(b),M=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,{tileBoundsBuffer:I,tileBoundsIndexBuffer:P,tileBoundsSegments:z}=this.getTileBoundsBuffers(E);x.draw(this,m.TRIANGLES,Zt.disabled,new ti({func:m.ALWAYS,mask:0},M,255,m.KEEP,m.KEEP,m.REPLACE),gi.disabled,Ht.disabled,Eh(b.projMatrix),"$clipping",I,P,z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,s=this.context.gl;return new ti({func:s.NOTEQUAL,mask:255},r,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const s=this.context.gl;return new ti({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(r){const s=this.context.gl,u=r.sort((x,b)=>b.overscaledZ-x.overscaledZ),f=u[u.length-1].overscaledZ,m=u[0].overscaledZ-f+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const x={};for(let b=0;b<m;b++)x[b+f]=new ti({func:s.GEQUAL,mask:255},b+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=m,[x,u]}return[{[f]:ti.disabled},u]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new gi([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new o.ax(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?gi.unblended:gi.alphaBlended}colorModeForDrapableLayerRenderPass(r){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new gi([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new o.ax(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,s,u,f=!1){if(!this.opaquePassEnabledForLayer()&&!f)return Zt.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Zt(u||this.context.gl.LEQUAL,s,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,s){this._wireframeDebugCache.update(this.frameCounter),this.style=r,this.options=s;const u=this.style._mergedLayers,f=this.style.order,m=f.map($=>u[$]),x=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.f.now()),this.imageManager.beginFrame();let b=0,E=!1;for(const $ in x){const ee=x[$];ee.used&&(ee.prepare(this.context),ee.getSource().usedInConflation&&++b)}for(const $ of m)$.isHidden(this.transform.zoom)||this.prepareLayer($);const M={},I={},P={},z={},O={};for(const $ in x){const ee=x[$];M[$]=ee.getVisibleCoordinates(),I[$]=M[$].slice().reverse(),P[$]=ee.getVisibleCoordinates(!0).reverse(),z[$]=ee.getShadowCasterCoordinates(),O[$]=ee.sortCoordinatesByDistance(M[$])}const j=$=>{const ee=this.style.getLayerSourceCache($);return ee&&ee.used?ee.getSource():null};if(b){const $=[];for(const ee of m)this.layerUsedInConflation(ee,j(ee))&&$.push(ee);if($&&$.length>1){const ee=[];for(const ae of $){const le=this.style.getLayerSourceCache(ae);le&&le.used&&le.getSource().usedInConflation&&ee.push({layer:ae.fqid,cache:le})}this.replacementSource.setSources(ee),E=!0}}E||this.replacementSource.clear(),this.conflationActive=E,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const $ of m){const ee=$.cutoffRange();if(this.longestCutoffRange=Math.max(ee,this.longestCutoffRange),ee>0){const ae=j($);ae&&(this.minCutoffZoom=Math.max(ae.minzoom,this.minCutoffZoom)),$.minzoom&&(this.minCutoffZoom=Math.max($.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let $=0;$<m.length;$++)if(m[$].is3D()){this.opaquePassCutoff=$;break}const U=this.style&&this.style.fog;U?(this._fogVisible=U.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=U.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(P),this.opaquePassCutoff=0);const G=this._shadowRenderer;if(G){G.updateShadowParameters(this.transform,this.style.directionalLight);for(const $ in x)for(const ee of M[$]){let ae={min:0,max:0};this.terrain&&(ae=this.terrain.getMinMaxForTile(ee)||ae),G.addShadowReceiver(ee.toUnwrapped(),ae.min,ae.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Gt(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!o.cZ(this.context.gl))return;this.renderPass="offscreen";for(const $ of m){const ee=r.getLayerSourceCache($);if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const ae=ee?I[ee.id]:void 0;($.type==="custom"||$.type==="raster"||$.type==="raster-particle"||$.isSky()||ae&&ae.length)&&this.renderLayer(this,ee,$,ae)}this.depthRangeFor3D=[0,1-(m.length+2)*this.numSublayers*this.depthEpsilon];const F=this.terrain;F&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&F.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,z)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Z=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),J=(()=>{if(s.showOverdrawInspector)return o.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!Z){const $=this.style.fog.properties.get("color").toArray01();return new o.ax(...$)}if(this.style.fog&&this.transform.projection.supportsFog&&Z){const $=this.style.fog.properties.get("space-color").toArray01();return new o.ax(...$)}return o.ax.transparent})();if(this.context.clear({color:J,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Z&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const $=m[this.currentLayer],ee=r.getLayerSourceCache($);if($.isSky())continue;const ae=ee?($.is3D()?O:I)[ee.id]:void 0;this._renderTileClippingMasks($,ee,ae),this.renderLayer(this,ee,$,ae)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Z&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.S(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const $=m[this.currentLayer],ee=r.getLayerSourceCache($);$.isSky()&&this.renderLayer(this,ee,$,ee?I[ee.id]:void 0)}function W($,ee){let ae;return ee&&(ae=($.type==="symbol"?P:$.is3D()?O:I)[ee.id]),ae}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<f.length;){const $=m[this.currentLayer];if($.type==="raster"){const ee=r.getLayerSourceCache($);this.renderLayer(this,ee,$,W($,ee))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Q=0;for(G&&(Q=G.getShadowCastingLayerCount());this.currentLayer<f.length;){const $=m[this.currentLayer],ee=r.getLayerSourceCache($);if($.isSky())++this.currentLayer;else if(F&&this.style.isLayerDraped($)){if($.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=F.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks($,ee,ee?M[ee.id]:void 0),this.renderLayer(this,ee,$,W($,ee)),!F&&G&&Q>0&&$.hasShadowPass()&&--Q==0&&(G.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ae=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ae;this.currentLayer++){const le=m[this.currentLayer];if(!le.hasLightBeamPass())continue;const fe=r.getLayerSourceCache(le);this.renderLayer(this,fe,le,fe?I[fe.id]:void 0)}this.currentLayer=ae,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let $=null;m.forEach(ee=>{const ae=r.getLayerSourceCache(ee);ae&&!ee.isHidden(this.transform.zoom)&&ae.getVisibleCoordinates().length&&(!$||$.getSource().maxzoom<ae.getSource().maxzoom)&&($=ae)}),$&&this.options.showTileBoundaries&&Bl.debug(this,$,$.getVisibleCoordinates(),o.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Bl.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function($){const ee=$.transform.padding;qh($,$.transform.height-(ee.top||0),3,Gn),qh($,ee.bottom||0,3,wo),es($,ee.left||0,3,jf),es($,$.transform.width-(ee.right||0),3,Gh);const ae=$.transform.centerPoint;(function(le,fe,Te,_e){Cr(le,fe-1,Te-10,2,20,_e),Cr(le,fe-10,Te-1,20,2,_e)})($,ae.x,$.transform.height-ae.y,$h)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),E||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:s}=this.transform.projection,u=!s||!s.includes(r.type);if(Yh[r.type]&&(u||this.terrain&&r.type==="custom")){const f=this.style.getLayerSourceCache(r);Yh[r.type](r,f,this)}this.gpuTimingEnd()}renderLayer(r,s,u,f){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||f&&f.length)&&(this.id=u.id,this.gpuTimingStart(u),(!r.transform.projection.unsupportedLayers||!r.transform.projection.unsupportedLayers.includes(u.type)||r.terrain&&u.type==="custom")&&Bl[u.type](r,s,u,f,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,u=this.context.gl;let f=this.gpuTimers[r.id];f||(f=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:u.createQuery()}),f.calls++,u.beginQuery(s.TIME_ELAPSED_EXT,f.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,s=this.context.gl,u=s.createQuery();this.deferredRenderGpuTimeQueries.push(u),s.beginQuery(r.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const s={};for(const u in r){const f=r[u],m=this.context.extTimerQuery,x=m.getQueryParameter(f.query,this.context.gl.QUERY_RESULT)/1e6;m.deleteQueryEXT(f.query),s[u]=x}return s}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.extTimerQuery,u=this.context.gl;let f=0;for(const m of r)f+=s.getQueryParameter(m,u.QUERY_RESULT)/1e6,s.deleteQueryEXT(m);return f}translatePosMatrix(r,s,u,f,m){if(!u[0]&&!u[1])return r;const x=m?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(x){const M=Math.sin(x),I=Math.cos(x);u=[u[0]*I-u[1]*M,u[0]*M+u[1]*I]}const b=[m?u[0]:o.a3(s,u[0],this.transform.zoom),m?u[1]:o.a3(s,u[1],this.transform.zoom),0],E=new Float32Array(16);return o.a6.translate(E,r,b),E}saveTileTexture(r){const s=r.size[0],u=this._tileTextures[s];u?u.push(r):this._tileTextures[s]=[r]}getTileTexture(r){const s=this._tileTextures[r];return s&&s.length>0?s.pop():null}isPatternMissing(r,s){return r===null||r!==void 0&&!this.imageManager.getPattern(r.toString(),s)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,s,u){const f=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,m=this.terrain&&this.terrain.exaggeration()===0,x=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):f||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT"),m&&x.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||f||s!==void 0&&!s||x.push("FOG","FOG_DITHERING"),f&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(r,s){this.cache=this.cache||{};const u=s&&s.defines||[],f=s&&s.config,m=s&&s.transformFeedback,x=this.currentGlobalDefines(r,s&&s.overrideFog,s&&s.overrideRtt).concat(u),b=Ih.cacheKey(xh[r],r,x,f);return this.cache[b]||(this.cache[b]=new Ih(this.context,r,xh[r],f,v_[r],x,m)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,s){if(this.style.enable3dLights()){const u=this.style.directionalLight,f=this.style.ambientLight;if(u&&f){const m=((x,b)=>{const E=x.properties.get("direction"),M=x.properties.get("color").toArray01(),I=x.properties.get("intensity"),P=b.properties.get("color").toArray01(),z=b.properties.get("intensity"),O=[E.x,E.y,E.z],j=o.cn(P,z),U=o.cn(M,I);return{u_lighting_ambient_color:j,u_lighting_directional_dir:O,u_lighting_directional_color:U,u_ground_radiance:Ah(O,U,j)}})(u,f);s.setLightsUniformValues(r,m)}}}uploadCommonUniforms(r,s,u,f,m){if(this.uploadCommonLightUniforms(r,s),this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const b=x.getOpacity(this.transform.pitch),E=((M,I,P,z,O,j,U,G,F,Z,J,W)=>{const Q=M.transform,$=I.properties.get("color").toArray01();$[3]=z;const ee=M.frameCounter/1e3%1,[ae,le]=I.properties.get("vertical-range");return{u_fog_matrix:P?Q.calculateFogTileMatrix(P):W||M.identityMat,u_fog_range:I.getFovAdjustedRange(Q._fov),u_fog_color:$,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ae,le),le],u_fog_temporal_offset:ee,u_frustum_tl:O,u_frustum_tr:j,u_frustum_br:U,u_frustum_bl:G,u_globe_pos:F,u_globe_radius:Z,u_viewport:J,u_globe_transition:o.S(Q.zoom),u_is_globe:+(Q.projection.name==="globe")}})(this,x,u,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.f.devicePixelRatio,this.transform.height*o.f.devicePixelRatio],f);s.setFogUniformValues(r,E)}m&&s.setCutoffUniformValues(r,m.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,s=r.createTexture();return r.bindTexture(r.TEXTURE_2D,s),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,s=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const f of u)s[f.key]=r[f.key]||new uo(f,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(r,s){return!(!r.is3D()||r.minzoom&&r.minzoom>this.transform.zoom||r.sourceLayer!=="building"&&(!s||s.type!=="batched-model"))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[r.key];return s||(this._cachedTileFogOpacities[r.key]=s=this.style.fog.getOpacityForTile(r)),s[0]>=Yi||s[1]>=Yi}}function Fl(c,r){let s=!1,u=null;const f=()=>{u=null,s&&(c(),u=setTimeout(f,r),s=!1)};return()=>(s=!0,u||f(),u)}class Zc{constructor(r){this._hashName=r&&encodeURIComponent(r),o.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Fl(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const s=Kh(r);if(this._hashName){const u=this._hashName;let f=!1;const m=location.hash.slice(1).split("&").map(x=>{const b=x.split("=")[0];return b===u?(f=!0,`${b}=${s}`):x}).filter(x=>x);return f||m.push(`${u}=${s}`),`#${m.join("&")}`}return`#${s}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let s;return r.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(s=u)}),(s&&s[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(u=>isNaN(u))){const u=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(s[3]||0):r.getBearing();return r.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:u,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Kh(c,r){const s=c.getCenter(),u=Math.round(100*c.getZoom())/100,f=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,f),x=Math.round(s.lng*m)/m,b=Math.round(s.lat*m)/m,E=c.getBearing(),M=c.getPitch();let I=r?`/${x}/${b}/${u}`:`${u}/${b}/${x}`;return(E||M)&&(I+="/"+Math.round(10*E)/10),M&&(I+=`/${Math.round(M)}`),I}const Nl={linearity:.3,easing:o.c_(0,0,.3,1)},$n=o.e({deceleration:2500,maxSpeed:1400},Nl),A_=o.e({deceleration:20,maxSpeed:1400},Nl),Hc=o.e({deceleration:1e3,maxSpeed:360},Nl),Tr=o.e({deceleration:1e3,maxSpeed:90},Nl);class Ki{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.f.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,s=o.f.now();for(;r.length>0&&s-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)s.zoom+=m.zoomDelta||0,s.bearing+=m.bearingDelta||0,s.pitch+=m.pitchDelta||0,m.panDelta&&s.pan._add(m.panDelta),m.around&&(s.around=m.around),m.pinchAround&&(s.pinchAround=m.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(s.pan.mag()){const m=ws(s.pan.mag(),u,o.e({},$n,r||{}));f.offset=s.pan.mult(m.amount/s.pan.mag()),f.center=this._map.transform.center,Vl(f,m)}if(s.zoom){const m=ws(s.zoom,u,A_);f.zoom=this._map.transform.zoom+m.amount,Vl(f,m)}if(s.bearing){const m=ws(s.bearing,u,Hc);f.bearing=this._map.transform.bearing+o.aa(m.amount,-179,179),Vl(f,m)}if(s.pitch){const m=ws(s.pitch,u,Tr);f.pitch=this._map.transform.pitch+m.amount,Vl(f,m)}if(f.zoom||f.bearing){const m=s.pinchAround===void 0?s.around:s.pinchAround;f.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),f.noMoveStart=!0,f}}function Vl(c,r){(!c.duration||c.duration<r.duration)&&(c.duration=r.duration,c.easing=r.easing)}function ws(c,r,s){const{maxSpeed:u,linearity:f,deceleration:m}=s,x=o.aa(c*f/(r/1e3),-u,u),b=Math.abs(x)/(m*f);return{easing:s.easing,duration:1e3*b,amount:x*(b/2)}}class zn extends o.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,u,f={}){const m=wi(s.getCanvasContainer(),u),x=s.unproject(m);super(r,o.e({point:m,lngLat:x,originalEvent:u},f)),this._defaultPrevented=!1,this.target=s}}class qs extends o.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,u){const f=r==="touchend"?u.changedTouches:u.touches,m=vr(s.getCanvasContainer(),f),x=m.map(E=>s.unproject(E)),b=m.reduce((E,M,I,P)=>E.add(M.div(P.length)),new o.P(0,0));super(r,{points:m,point:b,lngLats:x,lngLat:s.unproject(b),originalEvent:u}),this._defaultPrevented=!1}}class Jh extends o.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,u){super(r,{originalEvent:u}),this._defaultPrevented=!1}}class Qh{constructor(r,s){this._map=r,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Jh(r.type,this._map,r))}mousedown(r,s){return this._mousedownPos=s,this._firePreventable(new zn(r.type,this._map,r))}mouseup(r){this._map.fire(new zn(r.type,this._map,r))}preclick(r){const s=o.e({},r);s.type="preclick",this._map.fire(new zn(s.type,this._map,s))}click(r,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(r),this._map.fire(new zn(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new zn(r.type,this._map,r))}mouseover(r){this._map.fire(new zn(r.type,this._map,r))}mouseout(r){this._map.fire(new zn(r.type,this._map,r))}touchstart(r){return this._firePreventable(new qs(r.type,this._map,r))}touchmove(r){this._map.fire(new qs(r.type,this._map,r))}touchend(r){this._map.fire(new qs(r.type,this._map,r))}touchcancel(r){this._map.fire(new qs(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eo{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new zn(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new zn(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class So{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,s){this.isEnabled()&&r.shiftKey&&r.button===0&&(ri(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(r,s){if(!this._active)return;const u=s,f=this._startPos,m=this._lastPos;if(!f||!m||m.equals(u)||!this._box&&u.dist(f)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=Ie("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const x=Math.min(f.x,u.x),b=Math.max(f.x,u.x),E=Math.min(f.y,u.y),M=Math.max(f.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${E}px)`,this._box.style.width=b-x+"px",this._box.style.height=M-E+"px")})}mouseupWindow(r,s){if(!this._active)return;const u=this._startPos,f=s;if(u&&r.button===0){if(this.reset(),er(),u.x!==f.x||u.y!==f.y)return this._map.fire(new o.b("boxzoomend",{originalEvent:r})),{cameraAnimation:m=>m.fitScreenCoordinates(u,f,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Jt(),delete this._startPos,delete this._lastPos}_fireEvent(r,s){return this._map.fire(new o.b(r,{originalEvent:s}))}}function Oa(c,r){const s={};for(let u=0;u<c.length;u++)s[c[u].identifier]=r[u];return s}class Wc{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,s,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),u.length===this.numTouches&&(this.centroid=function(f){const m=new o.P(0,0);for(const x of f)m._add(x);return m.div(f.length)}(s),this.touches=Oa(u,s)))}touchmove(r,s,u){if(this.aborted||!this.centroid)return;const f=Oa(u,s);for(const m in this.touches){const x=f[m];(!x||x.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(r,s,u){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class Ul{constructor(r){this.singleTap=new Wc(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,s,u){this.singleTap.touchstart(r,s,u)}touchmove(r,s,u){this.singleTap.touchmove(r,s,u)}touchend(r,s,u){const f=this.singleTap.touchend(r,s,u);if(f){const m=r.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(f)<30;if(m&&x||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class ed{constructor(){this._zoomIn=new Ul({numTouches:1,numTaps:2}),this._zoomOut=new Ul({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,s,u){this._zoomIn.touchstart(r,s,u),this._zoomOut.touchstart(r,s,u)}touchmove(r,s,u){this._zoomIn.touchmove(r,s,u),this._zoomOut.touchmove(r,s,u)}touchend(r,s,u){const f=this._zoomIn.touchend(r,s,u),m=this._zoomOut.touchend(r,s,u);return f?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(f)},{originalEvent:r})}):m?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(m)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const td={0:1,2:2};class Ls{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,s){return!1}_move(r,s){return{}}mousedown(r,s){if(this._lastPoint)return;const u=zi(r);this._correctButton(r,u)&&(this._lastPoint=s,this._eventButton=u)}mousemoveWindow(r,s){const u=this._lastPoint;if(u){if(r.preventDefault(),this._eventButton!=null&&function(f,m){const x=td[m];return f.buttons===void 0||(f.buttons&x)!==x}(r,this._eventButton))this.reset();else if(this._moved||!(s.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(u,s)}}mouseupWindow(r){this._lastPoint&&zi(r)===this._eventButton&&(this._moved&&er(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class id extends Ls{mousedown(r,s){super.mousedown(r,s),this._lastPoint&&(this._active=!0)}_correctButton(r,s){return s===0&&!r.ctrlKey}_move(r,s){return{around:s,panDelta:s.sub(r)}}}class jl extends Ls{_correctButton(r,s){return s===0&&r.ctrlKey||s===2}_move(r,s){const u=.8*(s.x-r.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(r){r.preventDefault()}}class Xc extends Ls{_correctButton(r,s){return s===0&&r.ctrlKey||s===2}_move(r,s){const u=-.5*(s.y-r.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(r){r.preventDefault()}}class rd{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),o.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(r,s,u){return this._calculateTransform(r,s,u)}touchmove(r,s,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!o.c$())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,s,u)}}touchend(r,s,u){this._calculateTransform(r,s,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,s,u){u.length>0&&(this._active=!0);const f=Oa(u,s),m=new o.P(0,0),x=new o.P(0,0);let b=0;for(const M in f){const I=f[M],P=this._touches[M];P&&(m._add(I),x._add(I.sub(P)),b++,f[M]=I)}if(this._touches=f,b<this._minTouches||!x.mag())return;const E=x.div(b);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(b),panDelta:E}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ie("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class sn{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,s,u){return{}}touchstart(r,s,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([s[0],s[1]]))}touchmove(r,s,u){const f=this._firstTwoTouches;if(!f)return;r.preventDefault();const[m,x]=f,b=Ba(u,s,m),E=Ba(u,s,x);if(!b||!E)return;const M=this._aroundCenter?null:b.add(E).div(2);return this._move([b,E],M,r)}touchend(r,s,u){if(!this._firstTwoTouches)return;const[f,m]=this._firstTwoTouches,x=Ba(u,s,f),b=Ba(u,s,m);x&&b||(this._active&&er(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ba(c,r,s){for(let u=0;u<c.length;u++)if(c[u].identifier===s)return r[u]}function Yc(c,r){return Math.log(c/r)/Math.LN2}class Gl extends sn{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,s){const u=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Yc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Yc(this._distance,u),pinchAround:s}}}function Ao(c,r){return 180*c.angleWith(r)/Math.PI}class nd extends sn{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,s){const u=this._vector;if(this._vector=r[0].sub(r[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ao(this._vector,u),pinchAround:s}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const s=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const f=Ao(r,u);return Math.abs(f)<s}}function $l(c){return Math.abs(c.y)>Math.abs(c.x)}class sd extends sn{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,$l(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,s,u){const f=this._lastPoints;if(!f)return;const m=r[0].sub(f[0]),x=r[1].sub(f[1]);return this._map._cooperativeGestures&&!o.c$()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(m,x,u.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(m.y+x.y)/2*-.5})}gestureBeginsVertically(r,s,u){if(this._valid!==void 0)return this._valid;const f=r.mag()>=2,m=s.mag()>=2;if(!f&&!m)return;if(!f||!m)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const x=r.y>0==s.y>0;return $l(r)&&$l(s)&&x}}const ea={panStep:100,bearingStep:15,pitchStep:10};class ql{constructor(){const r=ea;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let s=0,u=0,f=0,m=0,x=0;switch(r.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:r.shiftKey?u=-1:(r.preventDefault(),m=-1);break;case 39:r.shiftKey?u=1:(r.preventDefault(),m=1);break;case 38:r.shiftKey?f=1:(r.preventDefault(),x=-1);break;case 40:r.shiftKey?f=-1:(r.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(u=0,f=0),{cameraAnimation:b=>{const E=b.getZoom();b.easeTo({duration:300,easeId:"keyboardHandler",easing:od,zoom:s?Math.round(E)+s*(r.shiftKey?2:1):E,bearing:b.getBearing()+u*this._bearingStep,pitch:b.getPitch()+f*this._pitchStep,offset:[-m*this._panStep,-x*this._panStep],center:b.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function od(c){return c*(2-c)}const Zl=4.000244140625,ad=1/450;class Zf{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ad,o.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.c$()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const u=o.f.now(),f=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,s!==0&&s%Zl==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(f*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),r.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=r,this._delta-=s,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=wi(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>Zl?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&I!==0&&(I=1/I);const P=s(),z=Math.pow(2,P),O=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(O*I))),this._type==="wheel"&&(this._startZoom=P,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:s(),f=this._startZoom,m=this._easing;let x,b=!1;if(this._type==="wheel"&&f&&m){const M=Math.min((o.f.now()-this._lastWheelEventTime)/200,1),I=m(M);x=o.U(f,u,I),M<1?this._frameId||(this._frameId=!0):b=!0}else x=u,b=!0;this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let E=x-s();return E*this._lastDelta<0&&(E=0),{noInertia:!0,needsRenderFrame:!b,zoomDelta:E,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let s=o.d0;if(this._prevEase){const u=this._prevEase,f=(o.f.now()-u.start)/u.duration,m=u.easing(f+.01)-u.easing(f),x=.27/Math.sqrt(m*m+1e-4)*.01,b=Math.sqrt(.0729-x*x);s=o.c_(x,b,.25,1)}return this._prevEase={start:o.f.now(),duration:r,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ie("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Hf{constructor(r,s){this._clickZoom=r,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wf{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,s){return r.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(r.shiftKey?-1:1),around:u.unproject(s)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xf{constructor(){this._tap=new Ul({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,s,u){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=s[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(r,s,u))}touchmove(r,s,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const f=s[0],m=f.y-this._swipePoint.y;return this._swipePoint=f,r.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(r,s,u)}touchend(r,s,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(r,s,u)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yf{constructor(r,s,u){this._el=r,this._mousePan=s,this._touchPan=u}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Kf{constructor(r,s,u){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=s,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Jf{constructor(r,s,u,f){this._el=r,this._touchZoom=s,this._touchRotate=u,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Hl=c=>c.zoom||c.drag||c.pitch||c.rotate;class Qf extends o.b{}class ep{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,s){const u=o.N.sub([],s,r);this.radius=o.N.length(u[2]<0?o.N.div([],u,this.constants):[u[0],u[1],0])}projectRay(r){o.N.div(r,r,this.constants),o.N.normalize(r,r),o.N.mul(r,r,this.constants);const s=o.N.scale([],r,this.radius);if(s[2]>0){const u=o.N.scale([],[0,0,1],o.N.dot(s,[0,0,1])),f=o.N.scale([],o.N.normalize([],[s[0],s[1],0]),this.radius),m=o.N.add([],s,o.N.scale([],o.N.sub([],o.N.add([],f,u),s),2));s[0]=m[0],s[1]=m[1]}return s}}function Wl(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class M_{constructor(r,s){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ki(r),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ep,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),o.aY(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,m,x]of this._listeners){const b=f===document?this.handleWindowEvent:this.handleEvent;f.addEventListener(m,b,x)}}destroy(){for(const[r,s,u]of this._listeners){const f=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(s,f,u)}}_addDefaultHandlers(r){const s=this._map,u=s.getCanvasContainer();this._add("mapEvent",new Qh(s,r));const f=s.boxZoom=new So(s,r);this._add("boxZoom",f);const m=new ed,x=new Wf;s.doubleClickZoom=new Hf(x,m),this._add("tapZoom",m),this._add("clickZoom",x);const b=new Xf;this._add("tapDragZoom",b);const E=s.touchPitch=new sd(s);this._add("touchPitch",E);const M=new jl(r),I=new Xc(r);s.dragRotate=new Kf(r,M,I),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]);const P=new id(r),z=new rd(s,r);s.dragPan=new Yf(u,P,z),this._add("mousePan",P),this._add("touchPan",z,["touchZoom","touchRotate"]);const O=new nd,j=new Gl;s.touchZoomRotate=new Jf(u,j,O,b),this._add("touchRotate",O,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Eo(s));const U=s.scrollZoom=new Zf(s,this);this._add("scrollZoom",U,["mousePan"]);const G=s.keyboard=new ql;this._add("keyboard",G);for(const F of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[F]&&s[F].enable(r[F])}_add(r,s,u){this._handlers.push({handlerName:r,handler:s,allowed:u}),this._handlersById[r]=s}stop(r){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Hl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,s,u){for(const f in r)if(f!==u&&(!s||s.indexOf(f)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const s=[];for(const u of r)this._el.contains(u.target)&&s.push(u);return s}handleEvent(r,s){this._updatingCamera=!0;const u=r.type==="renderFrame",f=u?void 0:r,m={needsRenderFrame:!1},x={},b={},E=r.touches?this._getMapTouches(r.touches):void 0,M=E?vr(this._el,E):u?void 0:wi(this._el,r);for(const{handlerName:z,handler:O,allowed:j}of this._handlers){if(!O.isEnabled())continue;let U;this._blockedByActive(b,j,z)?O.reset():O[s||r.type]&&(U=O[s||r.type](r,M,E),this.mergeHandlerResult(m,x,U,z,f),U&&U.needsRenderFrame&&this._triggerRenderFrame()),(U||O.isActive())&&(b[z]=O)}const I={};for(const z in this._previousActiveHandlers)b[z]||(I[z]=f);this._previousActiveHandlers=b,(Object.keys(I).length||Wl(m))&&(this._changes.push([m,x,I]),this._triggerRenderFrame()),(Object.keys(b).length||Wl(m))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:P}=m;P&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],P(this._map))}mergeHandlerResult(r,s,u,f,m){if(!u)return;o.e(r,u);const x={handlerName:f,originalEvent:u.originalEvent||m};u.zoomDelta!==void 0&&(s.zoom=x),u.panDelta!==void 0&&(s.drag=x),u.pitchDelta!==void 0&&(s.pitch=x),u.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const r={},s={},u={};for(const[f,m,x]of this._changes)f.panDelta&&(r.panDelta=(r.panDelta||new o.P(0,0))._add(f.panDelta)),f.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(r.around=f.around),f.aroundCoord!==void 0&&(r.aroundCoord=f.aroundCoord),f.pinchAround!==void 0&&(r.pinchAround=f.pinchAround),f.noInertia&&(r.noInertia=f.noInertia),o.e(s,m),o.e(u,x);this._updateMapTransform(r,s,u),this._changes=[]}_updateMapTransform(r,s,u){const f=this._map,m=f.transform,x=Z=>[Z.x,Z.y,Z.z];if((Z=>{const J=this._eventsInProgress.drag;return J&&!this._handlersById[J.handlerName].isActive()})()&&!Wl(r)){const Z=m.zoom;m.cameraElevationReference="sea",this._originalZoom!=null&&m._orthographicProjectionAtLowPitch&&m.projection.name!=="globe"&&m.pitch===0?(m.cameraElevationReference="ground",m.zoom=this._originalZoom):(m.recenterOnTerrain(),m.cameraElevationReference="ground"),Z!==m.zoom&&this._map._update(!0)}if(m._isCameraConstrained&&f._stop(!0),!Wl(r))return void this._fireEvents(s,u,!0);let{panDelta:b,zoomDelta:E,bearingDelta:M,pitchDelta:I,around:P,aroundCoord:z,pinchAround:O}=r;m._isCameraConstrained&&(E>0&&(E=0),m._isCameraConstrained=!1),O!==void 0&&(P=O),(E||(Z=>s[Z]&&!this._eventsInProgress[Z])("drag"))&&P&&(this._dragOrigin=x(m.pointCoordinate3D(P)),this._originalZoom=m.zoom,this._trackingEllipsoid.setup(m._camera.position,this._dragOrigin)),m.cameraElevationReference="sea",f._stop(!0),P=P||f.transform.centerPoint,M&&(m.bearing+=M),I&&(m.pitch+=I),m._updateCameraState();const j=[0,0,0];if(b)if(m.projection.name==="mercator"){const Z=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(P).dir),J=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(P.sub(b)).dir);j[0]=J[0]-Z[0],j[1]=J[1]-Z[1]}else{const Z=m.pointCoordinate(P);if(m.projection.name==="globe"){b=b.rotate(-m.angle);const J=m._pixelsPerMercatorPixel/m.worldSize;j[0]=-b.x*o.d1(o.au(Z.y))*J,j[1]=-b.y*o.d1(m.center.lat)*J}else{const J=m.pointCoordinate(P.sub(b));Z&&J&&(j[0]=J.x-Z.x,j[1]=J.y-Z.y)}}const U=m.zoom,G=[0,0,0];if(E){const Z=x(z||m.pointCoordinate3D(P)),J={dir:o.N.normalize([],o.N.sub([],Z,m._camera.position))};if(J.dir[2]<0){const W=m.zoomDeltaToMovement(Z,E);o.N.scale(G,J.dir,W)}}const F=o.N.add(j,j,G);m._translateCameraConstrained(F),E&&Math.abs(m.zoom-U)>1e-4&&m.recenterOnTerrain(),m.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(s,u,!0)}_fireEvents(r,s,u){const f=Hl(this._eventsInProgress),m=Hl(r),x={};for(const I in r){const{originalEvent:P}=r[I];this._eventsInProgress[I]||(x[`${I}start`]=P),this._eventsInProgress[I]=r[I]}!f&&m&&this._fireEvent("movestart",m.originalEvent);for(const I in x)this._fireEvent(I,x[I]);m&&this._fireEvent("move",m.originalEvent);for(const I in r){const{originalEvent:P}=r[I];this._fireEvent(I,P)}const b={};let E;for(const I in this._eventsInProgress){const{handlerName:P,originalEvent:z}=this._eventsInProgress[I];this._handlersById[P].isActive()||(delete this._eventsInProgress[I],E=s[P]||z,b[`${I}end`]=E)}for(const I in b)this._fireEvent(I,b[I]);const M=Hl(this._eventsInProgress);if(u&&(f||m)&&!M){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;I?(P(I.bearing||this._map.getBearing())&&(I.bearing=0),this._map.easeTo(I,{originalEvent:E})):(this._map.fire(new o.b("moveend",{originalEvent:E})),P(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,s){this._map.fire(new o.b(r,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Qf("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const tp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Br extends o.E{constructor(r,s){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,o.aY(["_renderFrameCallback"],this)}getCenter(){return new o.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(r,s){return this.jumpTo({center:r},s)}panBy(r,s,u){return r=o.P.convert(r).mult(-1),this.panTo(this.transform.center,o.e({offset:r},s),u)}panTo(r,s,u){return this.easeTo(o.e({center:r},s),u)}getZoom(){return this.transform.zoom}setZoom(r,s){return this.jumpTo({zoom:r},s),this}zoomTo(r,s,u){return this.easeTo(o.e({zoom:r},s),u)}zoomIn(r,s){return this.zoomTo(this.getZoom()+1,r,s),this}zoomOut(r,s){return this.zoomTo(this.getZoom()-1,r,s),this}getBearing(){return this.transform.bearing}setBearing(r,s){return this.jumpTo({bearing:r},s),this}getPadding(){return this.transform.padding}setPadding(r,s){return this.jumpTo({padding:r},s),this}rotateTo(r,s,u){return this.easeTo(o.e({bearing:r},s),u)}resetNorth(r,s){return this.rotateTo(0,o.e({duration:1e3},r),s),this}resetNorthPitch(r,s){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},r),s),this}snapToNorth(r,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,s):this}getPitch(){return this.transform.pitch}setPitch(r,s){return this.jumpTo({pitch:r},s),this}cameraForBounds(r,s){r=o.ad.convert(r);const u=s&&s.bearing||0,f=s&&s.pitch||0,m=r.getNorthWest(),x=r.getSouthEast();return this._cameraForBounds(this.transform,m,x,u,f,s)}_extendCameraOptions(r){const s={top:0,bottom:0,right:0,left:0};if(typeof(r=o.e({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const u=r.padding;r.padding={top:u,bottom:u,right:u,left:u}}return r.padding=o.e(s,r.padding),r}_minimumAABBFrustumDistance(r,s){const u=s.max[0]-s.min[0],f=s.max[1]-s.min[1];return u/f>r.aspect?u/(2*Math.tan(.5*r.fovX)*r.aspect):f/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,s,u,f,m,x){const b=r.clone(),E=this._extendCameraOptions(x);b.bearing=f,b.pitch=m;const M=o.bn.convert(s),I=o.bn.convert(u),P=.5*(M.lat+I.lat),z=.5*(M.lng+I.lng),O=o.d2(P,z),j=o.N.normalize([],O),U=o.N.normalize([],o.N.cross([],j,[0,1,0])),G=o.N.cross([],U,j),F=[U[0],U[1],U[2],0,G[0],G[1],G[2],0,j[0],j[1],j[2],0,0,0,0,1],Z=[O,o.d2(M.lat,M.lng),o.d2(I.lat,M.lng),o.d2(I.lat,I.lng),o.d2(M.lat,I.lng),o.d2(P,M.lng),o.d2(P,I.lng),o.d2(M.lat,z),o.d2(I.lat,z)];let J=o.bS.fromPoints(Z.map(ve=>[o.N.dot(U,ve),o.N.dot(G,ve),o.N.dot(j,ve)]));const W=o.N.transformMat4([],J.center,F);o.N.squaredLength(W)===0&&o.N.set(W,0,0,1),o.N.normalize(W,W),o.N.scale(W,W,o.ab),b.center=o.d3(W);const Q=b.getWorldToCameraMatrix(),$=o.a6.invert(new Float64Array(16),Q);J=o.bS.applyTransform(J,o.a6.multiply([],Q,F)),o.N.transformMat4(W,W,Q);const ee=.5*(J.max[2]-J.min[2]),ae=this._minimumAABBFrustumDistance(b,J),le=o.N.scale([],[0,0,1],ee),fe=o.N.add(le,W,le),Te=ae+(b.pitch===0?0:o.N.distance(W,fe)),_e=b.globeCenterInViewSpace,Le=o.N.sub([],W,[_e[0],_e[1],_e[2]]);o.N.normalize(Le,Le),o.N.scale(Le,Le,Te);const Pe=o.N.add([],W,Le);o.N.transformMat4(Pe,Pe,$);const $e=o.d4/o.ab,ge=o.N.length(Pe),Ae=o.bl(Math.max(ge*$e-o.d4,Number.EPSILON),0),he=Math.min(b.zoomFromMercatorZAdjusted(Ae),E.maxZoom);return he>.5*(o.bG+o.bx)?(b.setProjection({name:"mercator"}),b.zoom=he,this._cameraForBounds(b,s,u,f,m,x)):{center:b.center,zoom:he,bearing:f,pitch:m}}queryTerrainElevation(r,s){const u=this.transform.elevation;return u?(s=o.e({},{exaggerated:!0},s),u.getAtPoint(o.L.fromLngLat(r),null,s.exaggerated)):null}_cameraForBounds(r,s,u,f,m,x){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,s,u,f,m,x);const b=r.clone(),E=this._extendCameraOptions(x),M=b.padding;b.bearing=f,b.pitch=m;const I=o.bn.convert(s),P=o.bn.convert(u),z=new o.bn(I.lng,P.lat),O=new o.bn(P.lng,I.lat),j=b.project(I),U=b.project(P),G=this.queryTerrainElevation(I),F=this.queryTerrainElevation(P),Z=this.queryTerrainElevation(z),J=this.queryTerrainElevation(O),W=[[j.x,j.y,Math.min(G||0,F||0,Z||0,J||0)],[U.x,U.y,Math.max(G||0,F||0,Z||0,J||0)]];let Q=o.bS.fromPoints(W);const $=b.getWorldToCameraMatrix(),ee=o.a6.invert(new Float64Array(16),$);Q=o.bS.applyTransform(Q,$);const ae=o.N.sub([],Q.max,Q.min),le=M.left||0,fe=M.right||0,Te=M.bottom||0,_e=M.top||0,{left:Le,right:Pe,top:$e,bottom:ge}=E.padding,Ae=.5*(le+fe),he=.5*(_e+Te),ve=Math.min(b.scaleZoom(b.scale*Math.min((b.width-(le+fe+Le+Pe))/ae[0],(b.height-(Te+_e+ge+$e))/ae[1])),E.maxZoom),Ze=b.scale/b.zoomScale(ve);Q=new o.bS([Q.min[0]-(Le+Ae)*Ze,Q.min[1]-(ge+he)*Ze,Q.min[2]],[Q.max[0]+(Pe+Ae)*Ze,Q.max[1]+($e+he)*Ze,Q.max[2]]);const Qe=.5*ae[2],Je=this._minimumAABBFrustumDistance(b,Q),dt=[0,0,1,0];o.a7.transformMat4(dt,dt,$),o.a7.normalize(dt,dt);const Ct=o.N.scale([],dt,Je+Qe),Ut=o.N.add([],Q.center,Ct),Rt=(typeof E.offset.x=="number"&&typeof E.offset.y=="number"?new o.P(E.offset.x,E.offset.y):o.P.convert(E.offset)).rotate(-o.bj(f));Q.center[0]-=Rt.x*Ze,Q.center[1]+=Rt.y*Ze,o.N.transformMat4(Q.center,Q.center,ee),o.N.transformMat4(Ut,Ut,ee);const kt=[Q.center[0],Q.center[1],Ut[2]*b.pixelsPerMeter];o.N.scale(kt,kt,1/b.worldSize);const hi=o.at(kt[0]),Qt=o.au(kt[1]),ai=Math.min(b._zoomFromMercatorZ(kt[2]),E.maxZoom),oi=new o.bn(hi,Qt);return b.mercatorFromTransition&&ai<.5*(o.bG+o.bx)?(b.setProjection({name:"globe"}),b.zoom=ai,this._cameraForBounds(b,s,u,f,m,x)):{center:oi,zoom:ai,bearing:f,pitch:m}}fitBounds(r,s,u){const f=this.cameraForBounds(r,s);return this._fitInternal(f,s,u)}fitScreenCoordinates(r,s,u,f,m){const x=o.P.convert(r),b=o.P.convert(s),E=new o.P(Math.min(x.x,b.x),Math.min(x.y,b.y)),M=new o.P(Math.max(x.x,b.x),Math.max(x.y,b.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,b))return this;const I=this.transform.pointLocation3D(E),P=this.transform.pointLocation3D(M),z=this.transform.pointLocation3D(new o.P(E.x,M.y)),O=this.transform.pointLocation3D(new o.P(M.x,E.y)),j=[Math.min(I.lng,P.lng,z.lng,O.lng),Math.min(I.lat,P.lat,z.lat,O.lat)],U=[Math.max(I.lng,P.lng,z.lng,O.lng),Math.max(I.lat,P.lat,z.lat,O.lat)],G=f&&f.pitch?f.pitch:this.getPitch(),F=this._cameraForBounds(this.transform,j,U,u,G,f);return this._fitInternal(F,f,m)}_fitInternal(r,s,u){return r?(delete(s=o.e(r,s)).padding,s.linear?this.easeTo(s,u):this.flyTo(s,u)):this}jumpTo(r,s){this.stop();const u=r.preloadOnly?this.transform.clone():this.transform;let f=!1,m=!1,x=!1;return"zoom"in r&&u.zoom!==+r.zoom&&(f=!0,u.zoom=+r.zoom),r.center!==void 0&&(u.center=o.bn.convert(r.center)),"bearing"in r&&u.bearing!==+r.bearing&&(m=!0,u.bearing=+r.bearing),"pitch"in r&&u.pitch!==+r.pitch&&(x=!0,u.pitch=+r.pitch),r.padding==null||u.isPaddingEqual(r.padding)||(u.padding=r.padding),r.preloadOnly?(this._preloadTiles(u),this):(this.fire(new o.b("movestart",s)).fire(new o.b("move",s)),f&&this.fire(new o.b("zoomstart",s)).fire(new o.b("zoom",s)).fire(new o.b("zoomend",s)),m&&this.fire(new o.b("rotatestart",s)).fire(new o.b("rotate",s)).fire(new o.b("rotateend",s)),x&&this.fire(new o.b("pitchstart",s)).fire(new o.b("pitch",s)).fire(new o.b("pitchend",s)),this.fire(new o.b("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(tp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,s){const u=this.transform;if(!u.projection.supportsFreeCamera)return o.w(tp),this;this.stop();const f=u.zoom,m=u.pitch,x=u.bearing;u.setFreeCameraOptions(r);const b=f!==u.zoom,E=m!==u.pitch,M=x!==u.bearing;return this.fire(new o.b("movestart",s)).fire(new o.b("move",s)),b&&this.fire(new o.b("zoomstart",s)).fire(new o.b("zoom",s)).fire(new o.b("zoomend",s)),M&&this.fire(new o.b("rotatestart",s)).fire(new o.b("rotate",s)).fire(new o.b("rotateend",s)),E&&this.fire(new o.b("pitchstart",s)).fire(new o.b("pitch",s)).fire(new o.b("pitchend",s)),this.fire(new o.b("moveend",s)),this}easeTo(r,s){this._stop(!1,r.easeId),((r=o.e({offset:[0,0],duration:500,easing:o.d0},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const u=this.transform,f=this.getZoom(),m=this.getBearing(),x=this.getPitch(),b=this.getPadding(),E="zoom"in r?+r.zoom:f,M="bearing"in r?this._normalizeBearing(r.bearing,m):m,I="pitch"in r?+r.pitch:x,P="padding"in r?r.padding:u.padding,z=o.P.convert(r.offset);let O,j,U;if(u.projection.name==="globe"){const le=o.L.fromLngLat(u.center),fe=z.rotate(-u.angle);le.x+=fe.x/u.worldSize,le.y+=fe.y/u.worldSize;const Te=le.toLngLat(),_e=o.bn.convert(r.center||Te);this._normalizeCenter(_e),O=u.centerPoint.add(fe),j=new o.P(le.x,le.y).mult(u.worldSize),U=new o.P(o.a5(_e.lng),o.ae(_e.lat)).mult(u.worldSize).sub(j)}else{O=u.centerPoint.add(z);const le=u.pointLocation(O),fe=o.bn.convert(r.center||le);this._normalizeCenter(fe),j=u.project(le),U=u.project(fe).sub(j)}const G=u.zoomScale(E-f);let F,Z;r.around&&(F=o.bn.convert(r.around),Z=u.locationPoint(F));const J=this._zooming||E!==f,W=this._rotating||m!==M,Q=this._pitching||I!==x,$=!u.isPaddingEqual(P),ee=le=>fe=>{if(J&&(le.zoom=o.U(f,E,fe)),W&&(le.bearing=o.U(m,M,fe)),Q&&(le.pitch=o.U(x,I,fe)),$&&(le.interpolatePadding(b,P,fe),O=le.centerPoint.add(z)),F)le.setLocationAtPoint(F,Z);else{const Te=le.zoomScale(le.zoom-f),_e=E>f?Math.min(2,G):Math.max(.5,G),Le=Math.pow(_e,1-fe),Pe=le.unproject(j.add(U.mult(fe*Le)).mult(Te));le.setLocationAtPoint(le.renderWorldCopies?Pe.wrap():Pe,O)}return r.preloadOnly||this._fireMoveEvents(s),le};if(r.preloadOnly){const le=this._emulate(ee,r.duration,u);return this._preloadTiles(le),this}const ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=J,this._rotating=W,this._pitching=Q,this._easeId=r.easeId,this._prepareEase(s,r.noMoveStart,ae),this._ease(ee(u),le=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(s,le)},r),this}_prepareEase(r,s,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||u.moving||this.fire(new o.b("movestart",r)),this._zooming&&!u.zooming&&this.fire(new o.b("zoomstart",r)),this._rotating&&!u.rotating&&this.fire(new o.b("rotatestart",r)),this._pitching&&!u.pitching&&this.fire(new o.b("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.b("move",r)),this._zooming&&this.fire(new o.b("zoom",r)),this._rotating&&this.fire(new o.b("rotate",r)),this._pitching&&this.fire(new o.b("pitch",r))}_afterEase(r,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,f=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,u&&this.fire(new o.b("zoomend",r)),f&&this.fire(new o.b("rotateend",r)),m&&this.fire(new o.b("pitchend",r)),this.fire(new o.b("moveend",r))}flyTo(r,s){if(this._prefersReducedMotion(r)){const ge=o.ac(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ge,s)}this.stop(),r=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.d0},r);const u=this.transform,f=this.getZoom(),m=this.getBearing(),x=this.getPitch(),b="zoom"in r?o.aa(+r.zoom,u.minZoom,u.maxZoom):f,E="bearing"in r?this._normalizeBearing(r.bearing,m):m,M="pitch"in r?+r.pitch:x,I=u.zoomScale(b-f),P=o.P.convert(r.offset),z=u.centerPoint.add(P),O=u.pointLocation(z);let j=r.center;if(j&&r.padding){const ge=this._cameraForBounds(this.transform,j,j,E,M,r);ge&&(j=ge.center)}j=o.bn.convert(j||O),this._normalizeCenter(j);const U=u.project(O),G=u.project(j).sub(U);let F=r.curve;const Z=Math.max(u.width,u.height),J=Z/I,W=G.mag();if("minZoom"in r){const ge=o.aa(Math.min(r.minZoom,f,b),u.minZoom,u.maxZoom),Ae=Z/u.zoomScale(ge-f);F=Math.sqrt(Ae/W*2)}const Q=F*F;function $(ge){const Ae=(J*J-Z*Z+(ge?-1:1)*Q*Q*W*W)/(2*(ge?J:Z)*Q*W);return Math.log(Math.sqrt(Ae*Ae+1)-Ae)}function ee(ge){return(Math.exp(ge)-Math.exp(-ge))/2}function ae(ge){return(Math.exp(ge)+Math.exp(-ge))/2}const le=$(0);let fe=function(ge){return ae(le)/ae(le+F*ge)},Te=function(ge){return Z*((ae(le)*(ee(Ae=le+F*ge)/ae(Ae))-ee(le))/Q)/W;var Ae},_e=($(1)-le)/F;if(Math.abs(W)<1e-6||!isFinite(_e)){if(Math.abs(Z-J)<1e-6)return this.easeTo(r,s);const ge=J<Z?-1:1;_e=Math.abs(Math.log(J/Z))/F,Te=function(){return 0},fe=function(Ae){return Math.exp(ge*F*Ae)}}r.duration="duration"in r?+r.duration:1e3*_e/("screenSpeed"in r?+r.screenSpeed/F:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Le=m!==E,Pe=M!==x,$e=ge=>Ae=>{const he=Ae*_e,ve=1/fe(he);ge.zoom=Ae===1?b:f+ge.scaleZoom(ve),Le&&(ge.bearing=o.U(m,E,Ae)),Pe&&(ge.pitch=o.U(x,M,Ae));const Ze=Ae===1?j:ge.unproject(U.add(G.mult(Te(he))).mult(ve));return ge.setLocationAtPoint(ge.renderWorldCopies?Ze.wrap():Ze,z),ge._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(s),ge};if(r.preloadOnly){const ge=this._emulate($e,r.duration,u);return this._preloadTiles(ge),this}return this._zooming=!0,this._rotating=Le,this._pitching=Pe,this._prepareEase(s,!1),this._ease($e(u),()=>this._afterEase(s),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,s)}if(!r){const u=this.handlers;u&&u.stop(!1)}return this}_ease(r,s,u){u.animate===!1||u.duration===0?(r(1),s()):(this._easeStart=o.f.now(),this._easeOptions=u,this._onEaseFrame=r,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.f.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,s){r=o.bh(r,-180,180);const u=Math.abs(r-s);return Math.abs(r-360-s)<u&&(r-=360),Math.abs(r+360-s)<u&&(r+=360),r}_normalizeCenter(r){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const u=r.lng-s.center.lng;r.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&o.f.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,s,u){const f=Math.ceil(15*s/1e3),m=[],x=r(u.clone());for(let b=0;b<=f;b++){const E=x(b/f);m.push(E.clone())}return m}}class ld{constructor(r={}){this.options=r,o.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const s=this.options&&this.options.compact;return this._map=r,this._container=Ie("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ie("button","mapboxgl-ctrl-attrib-button",this._container),Ie("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ie("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,s){const u=this._map._getUIString(`AttributionControl.${s}`);r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",u)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.d5.ACCESS_TOKEN}];if(r){const u=s.reduce((f,m,x)=>(m.value&&(f+=`${m.key}=${m.value}${x<s.length-1?"&":""}`),f),"?");r.href=`${o.d5.FEEDBACK_URL}/${u}#${Kh(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const s=this._map.style._mergedSourceCaches;for(const f in s){const m=s[f];if(m.used){const x=m.getSource();x.attribution&&r.indexOf(x.attribution)<0&&r.push(x.attribution)}}r.sort((f,m)=>f.length-m.length),r=r.filter((f,m)=>{for(let x=m+1;x<r.length;x++)if(r[x].indexOf(f)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const u=r.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,r.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ip{constructor(){o.aY(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=Ie("div","mapboxgl-ctrl");const s=Ie("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const s in r){const u=r[s].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const s=r[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class rp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const s=++this._id;return this._queue.push({callback:r,id:s,cancelled:!1}),s}remove(r){const s=this._currentlyRunning,u=s?this._queue.concat(s):this._queue;for(const f of u)if(f.id===r)return void(f.cancelled=!0)}run(r=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const u of s)if(!u.cancelled&&(u.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Xl(c,r,s){if(c=new o.bn(c.lng,c.lat),r){const u=new o.bn(c.lng-360,c.lat),f=new o.bn(c.lng+360,c.lat),m=360*Math.ceil(Math.abs(c.lng-s.center.lng)/360),x=s.locationPoint(c).distSqr(r),b=r.x<0||r.y<0||r.x>s.width||r.y>s.height;s.locationPoint(u).distSqr(r)<x&&(b||Math.abs(u.lng-s.center.lng)<m)?c=u:s.locationPoint(f).distSqr(r)<x&&(b||Math.abs(f.lng-s.center.lng)<m)&&(c=f)}for(;Math.abs(c.lng-s.center.lng)>180;){const u=s.locationPoint(c);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;c.lng>s.center.lng?c.lng-=360:c.lng+=360}return c}const Kc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class cd extends o.E{constructor(r,s){if(super(),(r instanceof HTMLElement||s)&&(r=o.e({element:r},s)),o.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=o.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ie("div");const m=41,x=27,b=qe("svg",{display:"block",height:m*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${m}`},this._element),E=qe("radialGradient",{id:"shadowGradient"},qe("defs",{},b));qe("stop",{offset:"10%","stop-opacity":.4},E),qe("stop",{offset:"100%","stop-opacity":.05},E),qe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},b),qe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},b),qe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},b),qe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},b),this._offset=o.P.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()});const u=this._element.classList;for(const m in Kc)u.remove(`mapboxgl-marker-anchor-${m}`);u.add(`mapboxgl-marker-anchor-${this._anchor}`);const f=r&&r.className?r.className.trim().split(/\s+/):[];u.add(...f),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.bn.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const f=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const s=r.code,u=r.charCode||r.keyCode;s!=="Space"&&s!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(r){const s=r.originalEvent.target,u=this._element;this._popup&&(s===u||u.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,s=this._pos;if(!r||!s)return!1;const u=r.unproject(s),f=r.getFreeCameraOptions();if(!f.position)return!1;const m=f.position.toLngLat();return m.distanceTo(u)<.9*m.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const s=this._pos;if(!s||s.x<0||s.x>r.transform.width||s.y<0||s.y>r.transform.height)return void this._clearFadeTimer();const u=r.unproject(s);let f;r._showingGlobe()&&o.d6(r.transform,this._lngLat)?f=0:(f=1-r._queryFogOpacity(u),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(f*=this._occludedOpacity)),this._element.style.opacity=`${f}`,this._element.style.pointerEvents=f>0?"auto":"none",this._popup&&this._popup._setOpacity(f),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${Kc[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const r=this._pos,s=this._map,u=this.getPitchAlignment();if(!s||!r||u!=="map")return"";if(!s._showingGlobe()){const E=s.getPitch();return E?`rotateX(${E}deg)`:""}const f=o.bF(o.d7(s.transform,this._lngLat)),m=r.sub(o.d8(s.transform)),x=Math.abs(m.x)+Math.abs(m.y);if(x===0)return"";const b=f/x;return`rotateX(${-m.y*b}deg) rotateY(${m.x*b}deg)`}_calculateZTransform(){const r=this._pos,s=this._map;if(!s||!r)return"";let u=0;const f=this.getRotationAlignment();if(f==="map")if(s._showingGlobe()){const m=s.project(new o.bn(this._lngLat.lng,this._lngLat.lat+.001)),x=s.project(new o.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(m);u=o.bF(Math.atan2(x.y,x.x))-90}else u=-s.getBearing();else if(f==="horizon"){const m=o.O(4,6,s.getZoom()),x=o.d8(s.transform);x.y+=m*s.transform.height;const b=r.sub(x),E=o.bF(Math.atan2(b.y,b.x));u=(E>90?E-270:E+90)*(1-m)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=Xl(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const s=this._map;if(!s)return;const u=this._pointerdownPos,f=this._positionDelta;if(u&&f){if(!this._isDragging){const m=this._clickTolerance||s._clickTolerance;if(r.point.dist(u)<m)return;this._isDragging=!0}this._pos=r.point.sub(f),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.b("dragstart"))),this.fire(new o.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.b("dragend")),this._state="inactive"}_addDragHandler(r){const s=this._map,u=this._pos;s&&u&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(u),this._pointerdownPos=r.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const s=this._map;return s&&(r?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const np={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},sp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function op(c=new o.P(0,0),r="bottom"){if(typeof c=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(r){case"top":return new o.P(0,c);case"top-left":return new o.P(s,s);case"top-right":return new o.P(-s,s);case"bottom":return new o.P(0,-c);case"bottom-left":return new o.P(s,-s);case"bottom-right":return new o.P(-s,-s);case"left":return new o.P(c,0);case"right":return new o.P(-c,0)}return new o.P(0,0)}return c instanceof o.P||Array.isArray(c)?o.P.convert(c):o.P.convert(c[r]||[0,0])}class ud{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const s=o.cc((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,s,u){this._start=this.getValue(s),this._end=r,this._startTime=s,this._endTime=s+u}}const Yl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ap={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class hd{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const Jc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Zs{constructor(r,s,u=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new jl({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,u&&(this.mousePitch=new Xc({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(r,s){this.mouseRotate.mousedown(r,s),this.mousePitch&&this.mousePitch.mousedown(r,s),ri()}move(r,s){const u=this.map,f=this.mouseRotate.mousemoveWindow(r,s),m=f&&f.bearingDelta;if(m&&u.setBearing(u.getBearing()+m),this.mousePitch){const x=this.mousePitch.mousemoveWindow(r,s),b=x&&x.pitchDelta;b&&u.setPitch(u.getPitch()+b)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Jt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(o.e({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),wi(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,wi(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=vr(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=vr(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Qc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Cn={maxWidth:100,unit:"metric"},Mo={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:o.dk,supported:oe,setRTLTextPlugin:o.dm,getRTLTextPluginStatus:o.dn,Map:class extends Br{constructor(c){const r=c;if((c=o.e({},ap,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&o.d9(window)&&(c.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Tl(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._repaint=!1,this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new rp,this._domRenderTaskQueue=new rp,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.aC(),this._locale=o.e({},Yl,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ud(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.da(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,this._contextCreateOptions=c.contextCreateOptions?{...c.contextCreateOptions}:{},typeof c.container=="string"){const s=document.getElementById(c.container);if(!s)throw new Error(`Container '${c.container.toString()}' not found.`);this._container=s}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),o.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new hd,this._tp=c.devtools?new Ol(this):new Ol,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,s=>{this.repaint=s}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,s=>{this.showTileAABBs=s}),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,s=>{this.showPadding=s}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new M_(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,(c.style||!c.testMode)&&this.setStyle(c.style||o.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),c.hash&&(this._hash=new Zc(typeof c.hash=="string"&&c.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch});const s=c.bounds;s&&(this.resize(),this.fitBounds(s,o.e({},c.fitBoundsOptions,{duration:0})))}this.resize(),c.attributionControl&&this.addControl(new ld({customAttribution:c.customAttribution})),this._logoControl=new ip,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new o.b(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new o.b(`${s.dataType}dataloading`,s))})}_getMapId(){return this._mapId}addControl(c,r){if(r===void 0&&(r=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new o.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=c.onAdd(this);this._controls.push(c);const u=this._controlPositions[r];return r.indexOf("bottom")!==-1?u.insertBefore(s,u.firstChild):u.appendChild(s),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new o.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(c);return r>-1&&this._controls.splice(r,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.b("movestart",c)).fire(new o.b("move",c)),this.fire(new o.b("resize",c)),r&&this.fire(new o.b("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(o.ad.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new o.b("zoomstart")).fire(new o.b("zoom")).fire(new o.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new o.b("zoomstart")).fire(new o.b("zoom")).fire(new o.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new o.b("pitchstart")).fire(new o.b("pitch")).fire(new o.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new o.b("pitchstart")).fire(new o.b("pitch")).fire(new o.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return c==="auto"?navigator.language:Array.isArray(c)?c.length===0?void 0:c.map(r=>r==="auto"?navigator.language:r):c}setLanguage(c){const r=this._parseLanguage(c);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,r=c.projection.name;let s;r==="globe"&&c.zoom>=o.bx?(c.setMercatorFromTransition(),s=!0):r==="mercator"&&c.zoom<o.bx&&(c.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,r){return this._updateProjection(c||r||{name:"mercator"})}_updateProjection(c){let r;return r=c.name==="globe"&&this.transform.zoom>=o.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(c){return this.transform.locationPoint3D(o.bn.convert(c))}unproject(c){return this.transform.pointLocation3D(o.P.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,r,s){if(c==="mouseenter"||c==="mouseover"){let u=!1;const f=x=>{const b=r.filter(M=>this.getLayer(M)),E=b.length?this.queryRenderedFeatures(x.point,{layers:b}):[];E.length?u||(u=!0,s.call(this,new zn(c,this,x.originalEvent,{features:E}))):u=!1},m=()=>{u=!1};return{layers:new Set(r),listener:s,delegates:{mousemove:f,mouseout:m}}}if(c==="mouseleave"||c==="mouseout"){let u=!1;const f=x=>{const b=r.filter(E=>this.getLayer(E));(b.length?this.queryRenderedFeatures(x.point,{layers:b}):[]).length?u=!0:u&&(u=!1,s.call(this,new zn(c,this,x.originalEvent)))},m=x=>{u&&(u=!1,s.call(this,new zn(c,this,x.originalEvent)))};return{layers:new Set(r),listener:s,delegates:{mousemove:f,mouseout:m}}}{const u=f=>{const m=r.filter(b=>this.getLayer(b)),x=m.length?this.queryRenderedFeatures(f.point,{layers:m}):[];x.length&&(f.features=x,s.call(this,f),delete f.features)};return{layers:new Set(r),listener:s,delegates:{[c]:u}}}}on(c,r,s){if(s===void 0)return super.on(c,r);if(Array.isArray(r)||(r=[r]),r){for(const f of r)if(!this._isValidId(f))return this}const u=this._createDelegatedListener(c,r,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(u);for(const f in u.delegates)this.on(f,u.delegates[f]);return this}once(c,r,s){if(s===void 0)return super.once(c,r);if(Array.isArray(r)||(r=[r]),r){for(const f of r)if(!this._isValidId(f))return this}const u=this._createDelegatedListener(c,r,s);for(const f in u.delegates)this.once(f,u.delegates[f]);return this}off(c,r,s){if(s===void 0)return super.off(c,r);r=new Set(Array.isArray(r)?r:[r]);for(const m of r)if(!this._isValidId(m))return this;const u=(m,x)=>{if(m.size!==x.size)return!1;for(const b of m)if(!x.has(b))return!1;return!0},f=this._delegatedListeners?this._delegatedListeners[c]:void 0;return f&&(m=>{for(let x=0;x<m.length;x++){const b=m[x];if(b.listener===s&&u(b.layers,r)){for(const E in b.delegates)this.off(E,b.delegates[E]);return m.splice(x,1),this}}})(f),this}queryRenderedFeatures(c,r){if(!this.style)return[];if(r!==void 0||c===void 0||c instanceof o.P||Array.isArray(c)||(r=c,c=void 0),c=c||[[0,0],[this.transform.width,this.transform.height]],(r=r||{}).layers&&Array.isArray(r.layers)){for(const s of r.layers)if(!this._isValidId(s))return[]}return this.style.queryRenderedFeatures(c,r,this.transform)}querySourceFeatures(c,r){return this._isValidId(c)?this.style.querySourceFeatures(c,r):[]}isPointOnSurface(c){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&o.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(c))}setStyle(c,r){return(r=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&c?(this._diffStyle(c,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(c,r))}_getUIString(c){const r=this._locale[c];if(r==null)throw new Error(`Missing UI string '${c}'`);return r}_updateStyle(c,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c&&(this.style=new xs(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new xs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,r){if(typeof c=="string"){const s=this._requestManager.normalizeStyleURL(c),u=this._requestManager.transformRequest(s,o.R.Style);o.g(u,(f,m)=>{f?this.fire(new o.a(f)):m&&this._updateDiff(m,r)})}else typeof c=="object"&&this._updateDiff(c,r)}_updateDiff(c,r){try{this.style.setState(c)&&this._update(!0)}catch(s){o.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(c,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(c){return c==null?(this.fire(new o.a(new Error("IDs can't be empty."))),!1):!o.c4(c)||(this.fire(new o.a(new Error(`IDs can't contain special symbols: "${c}".`))),!1)}addSource(c,r){return this._isValidId(c)?(this._lazyInitEmptyStyle(),this.style.addSource(c,r),this._update(!0)):this}isSourceLoaded(c){return!!this._isValidId(c)&&!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(c,r,s){this._lazyInitEmptyStyle(),this.style.addSourceType(c,r,s)}removeSource(c){return this._isValidId(c)?(this.style.removeSource(c),this._updateTerrain(),this._update(!0)):this}getSource(c){return this._isValidId(c)?this.style.getOwnSource(c):null}addImage(c,r,{pixelRatio:s=1,sdf:u=!1,stretchX:f,stretchY:m,content:x}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:b,height:E,data:M}=o.f.getImageData(r);this.style.addImage(c,{data:new o.h({width:b,height:E},M),pixelRatio:s,stretchX:f,stretchY:m,content:x,sdf:u,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new o.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:b,height:E}=r,M=r;this.style.addImage(c,{data:new o.h({width:b,height:E},new Uint8Array(M.data)),pixelRatio:s,stretchX:f,stretchY:m,content:x,sdf:u,version:0,userImage:M}),M.onAdd&&M.onAdd(this,c)}}updateImage(c,r){this._lazyInitEmptyStyle();const s=this.style.getImage(c);if(!s)return void this.fire(new o.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?o.f.getImageData(r):r,{width:f,height:m}=u,x=u.data;if(f===void 0||m===void 0)return void this.fire(new o.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==s.data.width||m!==s.data.height)return void this.fire(new o.a(new Error(`The width and height of the updated image (${f}, ${m})
                must be that same as the previous version of the image
                (${s.data.width}, ${s.data.height})`)));const b=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);s.data.replace(x,b),this.style.updateImage(c,s)}hasImage(c){return c?!!this.style&&!!this.style.getImage(c):(this.fire(new o.a(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,r){o.d(this._requestManager.transformRequest(c,o.R.Image),(s,u)=>{r(s,u instanceof HTMLImageElement?o.f.getImageData(u):u)})}listImages(){return this.style.listImages()}addModel(c,r){this._lazyInitEmptyStyle(),this.style.addModel(c,r)}hasModel(c){return c?this.style.hasModel(c):(this.fire(new o.a(new Error("Missing required model id"))),!1)}removeModel(c){this.style.removeModel(c)}listModels(){return this.style.listModels()}addLayer(c,r){return this._isValidId(c.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(c,r),this._update(!0)):this}getSlot(c){const r=this.getLayer(c);return r&&r.slot||null}setSlot(c,r){return this.style.setSlot(c,r),this.style.mergeLayers(),this._update(!0)}addImport(c,r){return this.style.addImport(c,r),this}updateImport(c,r){return typeof r!="string"&&r.id!==c?(this.removeImport(c),this.addImport(r)):(this.style.updateImport(c,r),this._update(!0))}removeImport(c){return this.style.removeImport(c),this}moveImport(c,r){return this.style.moveImport(c,r),this._update(!0)}moveLayer(c,r){return this._isValidId(c)?(this.style.moveLayer(c,r),this._update(!0)):this}removeLayer(c){return this._isValidId(c)?(this.style.removeLayer(c),this._update(!0)):this}getLayer(c){return this._isValidId(c)?this.style.getOwnLayer(c):null}setLayerZoomRange(c,r,s){return this._isValidId(c)?(this.style.setLayerZoomRange(c,r,s),this._update(!0)):this}setFilter(c,r,s={}){return this._isValidId(c)?(this.style.setFilter(c,r,s),this._update(!0)):this}getFilter(c){return this._isValidId(c)?this.style.getFilter(c):null}setPaintProperty(c,r,s,u={}){return this._isValidId(c)?(this.style.setPaintProperty(c,r,s,u),this._update(!0)):this}getPaintProperty(c,r){return this._isValidId(c)?this.style.getPaintProperty(c,r):null}setLayoutProperty(c,r,s,u={}){return this._isValidId(c)?(this.style.setLayoutProperty(c,r,s,u),this._update(!0)):this}getLayoutProperty(c,r){return this._isValidId(c)?this.style.getLayoutProperty(c,r):null}getConfigProperty(c,r){return this.style.getConfigProperty(c,r)}setConfigProperty(c,r,s){return this.style.setConfigProperty(c,r,s),this._update(!0)}setLights(c){if(this._lazyInitEmptyStyle(),c&&c.length===1&&c[0].type==="flat"){const r=c[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(c),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const c=this.style.getLights()||[];return c.length===0&&c.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),c}setLight(c,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:c}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(c){return this.style.setCamera(c),this._triggerCameraUpdate(c)}_triggerCameraUpdate(c){return this._update(this.transform.setOrthographicProjectionAtLowPitch(c["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.bn.convert(c),this.transform):0}setFeatureState(c,r){return this._isValidId(c.source)?(this.style.setFeatureState(c,r),this._update()):this}removeFeatureState(c,r){return this._isValidId(c.source)?(this.style.removeFeatureState(c,r),this._update()):this}getFeatureState(c){return this._isValidId(c.source)?this.style.getFeatureState(c):null}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let s,u,f,m=this._container;for(;m&&(!u||!f);){const x=window.getComputedStyle(m).transform;x&&x!=="none"&&(s=x.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(u=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(f=s[3])),m=m.parentElement}this._containerWidth=u?Math.abs(c/u):c,this._containerHeight=f?Math.abs(r/f):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ie("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=Ie("div","mapboxgl-canvas-container",c);this._canvas=Ie("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=Ie("div","mapboxgl-control-container",c),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(f=>{u[f]=Ie("div",`mapboxgl-ctrl-${f}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,r){const s=o.f.devicePixelRatio||1;this._canvas.width=s*Math.ceil(c),this._canvas.height=s*Math.ceil(r),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${r}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const r=this._markers.indexOf(c);r!==-1&&this._markers.splice(r,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){const r=this._popups.indexOf(c);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const c=o.e({},oe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",c);r?(o.db(r,!0),this.painter=new qf(r,this._contextCreateOptions,this.transform,this._tp),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.dc.testSupport(r)):this.fire(new o.a(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.b("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new o.b("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let r;this.fire(new o.b("renderstart"));const s=this.painter.context.extTimerQuery,u=o.f.now(),f=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=f.createQuery(),f.beginQuery(s.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();const m=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,M=this.transform.pitch,I=o.f.now(),P=new o.K(E,{now:I,fadeDuration:m,pitch:M,transition:this.style.transition});this.style.update(P)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(u),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(u),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,m,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:m,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const E=o.f.now()-u;f.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const M=f.getQueryParameter(r,f.QUERY_RESULT)/1e6;f.deleteQuery(r),this.fire(new o.b("gpu-timing-frame",{cpuTime:E,gpuTime:M}))},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const M=this.painter.queryGpuTimers(E);this.fire(new o.b("gpu-timing-layer",{layerTimes:M}))},50)}if(this.listens("gpu-timing-deferred-render")){const E=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const M=this.painter.queryGpuTimeDeferredRender(E);this.fire(new o.b("gpu-timing-deferred-render",{gpuTime:M}))},50)}const b=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(b||this._repaint)this.triggerRepaint();else{const E=!this.isMoving()&&this.loaded();if(E&&(x=this._updateAverageElevation(u,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),E&&(this.fire(new o.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const M=this._calculateSpeedIndex();this.fire(new o.b("speedindexcompleted",{speedIndex:M})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||b||(this._fullyLoaded=!0,this._performanceMetricsCollection&&o.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(const r of this._markers)c&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!c||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(c,r=!1){const s=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(r||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const f=this.transform.averageElevation;let m=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(m)?m=0:this._averageElevationLastSampledAt=c;const x=Math.abs(f-m);if(x>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(m),s(m);this._averageElevation.easeTo(m,c,300)}else if(x>1e-4)return this._averageElevation.jumpTo(m),s(m)}return!!this._averageElevation.isEasing(c)&&s(this._averageElevation.getValue(c))}_authenticate(){o.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===o.df||c.status===401)){const r=this.painter.context.gl;o.db(r,!1),this._logoControl instanceof ip&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const s=this.painter.context.gl,u=s.createFramebuffer();function f(m){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,m,0);const x=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,x),x}return s.bindFramebuffer(s.FRAMEBUFFER,u),this._canvasPixelComparison(f(c),r.canvasCopies.map(f),r.timeStamps)}_canvasPixelComparison(c,r,s){let u=s[1]-s[0];const f=c.length/4;for(let m=0;m<r.length;m++){const x=r[m];let b=0;for(let E=0;E<x.length;E+=4)x[E]===c[E]&&x[E+1]===c[E+1]&&x[E+2]===c[E+2]&&x[E+3]===c[E+3]&&(b+=1);u+=(s[m+2]-s[m+1])*(1-b/f)}return u}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.dh(this.painter.context.gl),o.di.remove(),o.dj.remove(),this._removed=!0,this.fire(new o.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=o.f.frame(r=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(r)}))}_preloadTiles(c){const r=this.style?Object.values(this.style._sourceCaches):[];return o.b1(r,(s,u)=>s._preloadTiles(c,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(c){this._showParseStatus!==c&&(this._showParseStatus=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(c){this._showLayers2DWireframe!==c&&(this._showLayers2DWireframe=c,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(c){this._showLayers3DWireframe!==c&&(this._showLayers3DWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,c&&this._update())}_setCacheLimits(c,r){o.dl(c,r)}get version(){return o.dk}},NavigationControl:class{constructor(c){this.options=o.e({},Jc,c),this._container=Ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),Ie("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),Ie("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:r}):s.resetNorth({},{originalEvent:r}))}),this._compassIcon=Ie("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const r=c.getZoom(),s=r===c.getMaxZoom(),u=r===c.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Zs(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,r){const s=Ie("button",c,this._container);return s.type="button",s.addEventListener("click",r),s}_setButtonTitle(c,r){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${r}`);c.setAttribute("aria-label",s),c.firstElementChild&&c.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends o.E{constructor(c){super();const r=navigator.geolocation;this.options=o.e({geolocation:r},Qc,c),o.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Fl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=Ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){const r=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,c(s)};this._supportsGeolocation!==void 0?c(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>r(s.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(c){const r=this._map.getMaxBounds(),s=c.coords;return!!r&&(s.longitude<r.getWest()||s.longitude>r.getEast()||s.latitude<r.getSouth()||s.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new o.b("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.b("geolocate",c)),this._finish()}}_updateCamera(c){const r=new o.bn(c.coords.longitude,c.coords.latitude),s=c.coords.accuracy,u=this._map.getBearing(),f=o.e({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(s),f,{geolocateSource:!0})}_updateMarker(c){if(c){const r=new o.bn(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,r=o.bl(1,c._center.lat)*c.worldSize,s=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.b("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=Ie("button","mapboxgl-ctrl-geolocate",this._container),Ie("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ie("div","mapboxgl-user-location"),this._dotElement.appendChild(Ie("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ie("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new cd({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ie("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new cd({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.b("trackuserlocationend")))})}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ld,ScaleControl:class{constructor(c){this.options=o.e({},Cn,c),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,r=this._map,s=r._containerHeight/2,u=r._containerWidth/2-c/2,f=r.unproject([u,s]),m=r.unproject([u+c,s]),x=f.distanceTo(m);if(this.options.unit==="imperial"){const b=3.2808*x;b>5280?this._setScale(c,b/5280,"mile"):this._setScale(c,b,"foot")}else this.options.unit==="nautical"?this._setScale(c,x/1852,"nautical-mile"):x>=1e3?this._setScale(c,x/1e3,"kilometer"):this._setScale(c,x,"meter")}_setScale(c,r,s){this._map._requestDomTask(()=>{const u=function(m){const x=Math.pow(10,`${Math.floor(m)}`.length-1);let b=m/x;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(E){const M=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*M)/M}(b),x*b}(r),f=u/r;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(u):`${u}&nbsp;${Mo[s]}`,this._container.style.width=c*f+"px"})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=Ie("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:o.w("Full screen control 'container' must be a DOM element.")),o.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=Ie("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ie("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(c){super(),this.options=o.e(Object.create(np),c),o.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new o.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new o.b("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=o.bn.convert(c),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const r=document.createDocumentFragment(),s=document.createElement("body");let u;for(s.innerHTML=c;u=s.firstChild,u;)r.appendChild(u);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=Ie("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(c),this.options.closeButton){const s=this._closeButton=Ie("button","mapboxgl-popup-close-button",r);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let r;return this._classList.delete(c)?r=!1:(this._classList.add(c),r=!0),this._updateClassList(),r}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const r=this._map,s=this._container,u=this._pos;if(!r||!s||!u)return"bottom";const f=s.offsetWidth,m=s.offsetHeight,x=u.x<f/2,b=u.x>r.transform.width-f/2;if(u.y+c<m)return x?"top-left":b?"top-right":"top";if(u.y>r.transform.height-m){if(x)return"bottom-left";if(b)return"bottom-right"}return x?"left":b?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),c.className=r.join(" ")}_update(c){const r=this._map,s=this._content;if(!r||!this._lngLat&&!this._trackPointer||!s)return;let u=this._container;if(u||(u=this._container=Ie("div","mapboxgl-popup",r.getContainer()),this._tip=Ie("div","mapboxgl-popup-tip",u),u.appendChild(s)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xl(this._lngLat,this._pos,r.transform)),!this._trackPointer||c){const f=this._pos=this._trackPointer&&c?c:r.project(this._lngLat),m=op(this.options.offset),x=this._anchor=this._getAnchor(m.y),b=op(this.options.offset,x),E=f.add(b).round();r._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${Kc[x]} translate(${E.x}px,${E.y}px)`)})}if(!this._marker&&r._showingGlobe()){const f=o.d6(r.transform,this._lngLat)?0:1;this._setOpacity(f)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(sp);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:cd,Style:xs,LngLat:o.bn,LngLatBounds:o.ad,Point:o.P,MercatorCoordinate:o.L,FreeCameraOptions:bl,Evented:o.E,config:o.d5,prewarm:o.dp,clearPrewarmedResources:o.dq,get accessToken(){return o.d5.ACCESS_TOKEN},set accessToken(c){o.d5.ACCESS_TOKEN=c},get baseApiUrl(){return o.d5.API_URL},set baseApiUrl(c){o.d5.API_URL=c},get workerCount(){return o.dr.workerCount},set workerCount(c){o.dr.workerCount=c},get maxParallelImageRequests(){return o.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){o.d5.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){o.ds(c)},get workerUrl(){return o.dt.workerUrl},set workerUrl(c){o.dt.workerUrl=c},get workerClass(){return o.dt.workerClass},set workerClass(c){o.dt.workerClass=c},get workerParams(){return o.dt.workerParams},set workerParams(c){o.dt.workerParams=c},get dracoUrl(){return o.du()},set dracoUrl(c){o.dv(c)},get meshoptUrl(){return o.dw()},set meshoptUrl(c){o.dx(c)},setNow:o.f.setNow,restoreNow:o.f.restoreNow}});var X=k;return X})})(WT);var sL=WT.exports;const dw=nL(sL),oL=d=>(gc("data-v-62681a9c"),d=d(),yc(),d),aL=oL(()=>Et("div",{id:"map-cont"},null,-1)),lL=[aL],cL={__name:"mapbox",setup(d){const g=ln(null),w=ln(!0),S=ln(!1);dw.accessToken="pk.eyJ1IjoibWFyaW8wMiIsImEiOiJjbHNxMXR6OWUweDZoMmlvOWVtZjJtMDAwIn0.q5mRNtCKJpmnMPRuhrG_XA";const L={pitch:90,zoom:3,center:[100,70],bearing:0};Bu(()=>{window.innerWidth<=450&&(L.zoom=2),g.value=new dw.Map({container:"map-cont",style:"mapbox://styles/mapbox/satellite-v9",projection:"globe",...L}),g.value.on("style.load",()=>{g.value.setFog({color:"rgb(26, 31, 76)","high-color":"rgb(0, 104, 149)","horizon-blend":.02,"space-color":"rgb(11, 11, 25)","star-intensity":1})}),g.value.scrollZoom.disable(),g.value.on("mousedown",()=>{S.value=!0}),g.value.on("mouseup",()=>{S.value=!1,k()}),g.value.on("dragend",()=>{S.value=!1,k()}),g.value.on("pitchend",()=>{S.value=!1,k()}),g.value.on("rotateend",()=>{S.value=!1,k()}),g.value.on("moveend",()=>{k()}),k()});const k=()=>{if(!g.value||S.value)return;const V=g.value.getZoom(),X=120,o=5,re=3;if(w.value&&V<o){let oe=360/X;if(V>re){const Se=(o-V)/(o-re);oe*=Se}const se=g.value.getCenter();se.lng-=oe,g.value.easeTo({center:se,duration:2e3,easing:Se=>Se})}};return(V,X)=>(Wi(),Ji("section",null,lL))}},YT=Fn(cL,[["__scopeId","data-v-62681a9c"]]),uL={id:"content"},hL={id:"txtbox"},dL=["innerHTML"],fL=["innerHTML"],pL={__name:"layer1",setup(d){const g=ao(),w=Ur(()=>oo().get("layer1",g.language));return(S,L)=>(Wi(),Ji("div",uL,[Et("div",hL,[Et("h1",{innerHTML:w.value.txt1},null,8,dL),Et("h2",{innerHTML:w.value.txt2},null,8,fL)])]))}},mL=Fn(pL,[["__scopeId","data-v-4cf58e51"]]),_L="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAC0SURBVEiJ7dWxCkFRAIfx7950B5llvQvlHRgMeASLVzF5QAZSZjKSwWD4DBRuWM65pfiPZ/h9dTp14Oem5upcXaqt2Hiqrr1vEzWiZurB50WPDNVT2ZH+i8hObceMDH4jkqhTYAQkAZ0GUC2cbYFeop6BSgD+aasUsCQcuF7RBBgDaYBTB2qFsy3QCzCvUzvqsZSX9Mff4d0y8UzdF/CN2gzGb4FXH04c/CGSqzN1ER3/yl0ATTCRVV25kfwAAAAASUVORK5CYII=",gL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAACxAAAAsQHGLUmNAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAaJJREFUSInd1b1rFVEQBfDfS9IYEkja4AcGQgpbTaOgVvoPWGoltpZWgTSClSSlbexsLIKVgk2wEdFKWxHiR9TCEKMGdC3u3GRz3yZvl1h5YOAxzJyzs3veDO0xgxU8xqkOfQMxgbvYxtuI7chNHIZ4CNfwEd9xB2M4glvYwFfcxHBX8vN4iT94gBMNNVO4h994jUttiI9iOYhf4FyLnjN4hkr6RtNNRaNYwBbe44ZuY/dwBe/wC0sYrxdcjyfYxFwH4hJzwVEFp6Gi4AtWsYjJDsST0bMaHH3IE4xKrvhm1yEjBxBnp32SnLYgOW1nglIgk9Ud8gaXG8gv4JVdpx2P/EgbgYzT0th1hxyTnFbhOc4WPZ0ESA65ijX8iFiLXK+hfo/AQe83o8J9PMTTyF2U3DIQbQQyNqW1kX+3QmnTf47/T+C2Yod0xHhw9KG+7D7bf8evRJToSf/oD/ZZdhmD1nWTQLmuTzYRl8gHJzflg1MXmKo9TOuDU8ewdBfWJd/P40nEfOTWdb8dfRiTvs9PaaJKOvpLDnn0S8ziUcRs26a/tHlyo5MtwLoAAAAASUVORK5CYII=",yL={id:"content"},xL=["src"],vL=["placeholder"],bL=["innerHTML"],wL=["src"],TL={__name:"search",setup(d){const g=ao(),w=ln(null),S=ln(!1),L=Ur(()=>oo().get("search",g.language));return Bu(()=>{w.value=window.innerWidth,w.value<=750?S.value=!0:S.value=!1}),window.addEventListener("resize",()=>{w.value=window.innerWidth,w.value<=750?S.value=!0:S.value=!1}),(k,V)=>(Wi(),Ji("div",yL,[Et("div",{id:"box",class:Bs({"fit-area":S.value})},[Et("img",{id:"arrow",src:Yn(_L),alt:"flecha"},null,8,xL),Et("input",{type:"text",name:"",id:"txt",placeholder:L.value.txt1},null,8,vL),Et("div",{id:"generate",class:Bs({fit:S.value})},[!S.value&&w.value>=600?(Wi(),Ji("p",{key:0,innerHTML:L.value.txt2},null,8,bL)):Xy("",!0),Et("img",{id:"imgbox",src:Yn(gL),alt:"cubo"},null,8,wL)],2)],2)]))}},EL=Fn(TL,[["__scopeId","data-v-50454516"]]),SL={__name:"home",setup(d){return(g,w)=>(Wi(),Ji("section",null,[nr(HT),nr(mL),nr(YT),nr(EL)]))}},AL=Fn(SL,[["__scopeId","data-v-b9d35bda"]]),ML={__name:"HomeView",setup(d){return(g,w)=>(Wi(),Ji("main",null,[Et("div",null,[nr(AL)])]))}};function KT(d,g){return function(){return d.apply(g,arguments)}}const{toString:IL}=Object.prototype,{getPrototypeOf:Jy}=Object,Xm=(d=>g=>{const w=IL.call(g);return d[w]||(d[w]=w.slice(8,-1).toLowerCase())})(Object.create(null)),No=d=>(d=d.toLowerCase(),g=>Xm(g)===d),Ym=d=>g=>typeof g===d,{isArray:Fu}=Array,of=Ym("undefined");function CL(d){return d!==null&&!of(d)&&d.constructor!==null&&!of(d.constructor)&&Fs(d.constructor.isBuffer)&&d.constructor.isBuffer(d)}const JT=No("ArrayBuffer");function PL(d){let g;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?g=ArrayBuffer.isView(d):g=d&&d.buffer&&JT(d.buffer),g}const RL=Ym("string"),Fs=Ym("function"),QT=Ym("number"),Km=d=>d!==null&&typeof d=="object",LL=d=>d===!0||d===!1,_m=d=>{if(Xm(d)!=="object")return!1;const g=Jy(d);return(g===null||g===Object.prototype||Object.getPrototypeOf(g)===null)&&!(Symbol.toStringTag in d)&&!(Symbol.iterator in d)},DL=No("Date"),zL=No("File"),kL=No("Blob"),OL=No("FileList"),BL=d=>Km(d)&&Fs(d.pipe),FL=d=>{let g;return d&&(typeof FormData=="function"&&d instanceof FormData||Fs(d.append)&&((g=Xm(d))==="formdata"||g==="object"&&Fs(d.toString)&&d.toString()==="[object FormData]"))},NL=No("URLSearchParams"),VL=d=>d.trim?d.trim():d.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function cf(d,g,{allOwnKeys:w=!1}={}){if(d===null||typeof d>"u")return;let S,L;if(typeof d!="object"&&(d=[d]),Fu(d))for(S=0,L=d.length;S<L;S++)g.call(null,d[S],S,d);else{const k=w?Object.getOwnPropertyNames(d):Object.keys(d),V=k.length;let X;for(S=0;S<V;S++)X=k[S],g.call(null,d[X],X,d)}}function eE(d,g){g=g.toLowerCase();const w=Object.keys(d);let S=w.length,L;for(;S-- >0;)if(L=w[S],g===L.toLowerCase())return L;return null}const tE=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,iE=d=>!of(d)&&d!==tE;function Ay(){const{caseless:d}=iE(this)&&this||{},g={},w=(S,L)=>{const k=d&&eE(g,L)||L;_m(g[k])&&_m(S)?g[k]=Ay(g[k],S):_m(S)?g[k]=Ay({},S):Fu(S)?g[k]=S.slice():g[k]=S};for(let S=0,L=arguments.length;S<L;S++)arguments[S]&&cf(arguments[S],w);return g}const UL=(d,g,w,{allOwnKeys:S}={})=>(cf(g,(L,k)=>{w&&Fs(L)?d[k]=KT(L,w):d[k]=L},{allOwnKeys:S}),d),jL=d=>(d.charCodeAt(0)===65279&&(d=d.slice(1)),d),GL=(d,g,w,S)=>{d.prototype=Object.create(g.prototype,S),d.prototype.constructor=d,Object.defineProperty(d,"super",{value:g.prototype}),w&&Object.assign(d.prototype,w)},$L=(d,g,w,S)=>{let L,k,V;const X={};if(g=g||{},d==null)return g;do{for(L=Object.getOwnPropertyNames(d),k=L.length;k-- >0;)V=L[k],(!S||S(V,d,g))&&!X[V]&&(g[V]=d[V],X[V]=!0);d=w!==!1&&Jy(d)}while(d&&(!w||w(d,g))&&d!==Object.prototype);return g},qL=(d,g,w)=>{d=String(d),(w===void 0||w>d.length)&&(w=d.length),w-=g.length;const S=d.indexOf(g,w);return S!==-1&&S===w},ZL=d=>{if(!d)return null;if(Fu(d))return d;let g=d.length;if(!QT(g))return null;const w=new Array(g);for(;g-- >0;)w[g]=d[g];return w},HL=(d=>g=>d&&g instanceof d)(typeof Uint8Array<"u"&&Jy(Uint8Array)),WL=(d,g)=>{const S=(d&&d[Symbol.iterator]).call(d);let L;for(;(L=S.next())&&!L.done;){const k=L.value;g.call(d,k[0],k[1])}},XL=(d,g)=>{let w;const S=[];for(;(w=d.exec(g))!==null;)S.push(w);return S},YL=No("HTMLFormElement"),KL=d=>d.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(w,S,L){return S.toUpperCase()+L}),fw=(({hasOwnProperty:d})=>(g,w)=>d.call(g,w))(Object.prototype),JL=No("RegExp"),rE=(d,g)=>{const w=Object.getOwnPropertyDescriptors(d),S={};cf(w,(L,k)=>{let V;(V=g(L,k,d))!==!1&&(S[k]=V||L)}),Object.defineProperties(d,S)},QL=d=>{rE(d,(g,w)=>{if(Fs(d)&&["arguments","caller","callee"].indexOf(w)!==-1)return!1;const S=d[w];if(Fs(S)){if(g.enumerable=!1,"writable"in g){g.writable=!1;return}g.set||(g.set=()=>{throw Error("Can not rewrite read-only method '"+w+"'")})}})},eD=(d,g)=>{const w={},S=L=>{L.forEach(k=>{w[k]=!0})};return Fu(d)?S(d):S(String(d).split(g)),w},tD=()=>{},iD=(d,g)=>(d=+d,Number.isFinite(d)?d:g),sy="abcdefghijklmnopqrstuvwxyz",pw="0123456789",nE={DIGIT:pw,ALPHA:sy,ALPHA_DIGIT:sy+sy.toUpperCase()+pw},rD=(d=16,g=nE.ALPHA_DIGIT)=>{let w="";const{length:S}=g;for(;d--;)w+=g[Math.random()*S|0];return w};function nD(d){return!!(d&&Fs(d.append)&&d[Symbol.toStringTag]==="FormData"&&d[Symbol.iterator])}const sD=d=>{const g=new Array(10),w=(S,L)=>{if(Km(S)){if(g.indexOf(S)>=0)return;if(!("toJSON"in S)){g[L]=S;const k=Fu(S)?[]:{};return cf(S,(V,X)=>{const o=w(V,L+1);!of(o)&&(k[X]=o)}),g[L]=void 0,k}}return S};return w(d,0)},oD=No("AsyncFunction"),aD=d=>d&&(Km(d)||Fs(d))&&Fs(d.then)&&Fs(d.catch),ut={isArray:Fu,isArrayBuffer:JT,isBuffer:CL,isFormData:FL,isArrayBufferView:PL,isString:RL,isNumber:QT,isBoolean:LL,isObject:Km,isPlainObject:_m,isUndefined:of,isDate:DL,isFile:zL,isBlob:kL,isRegExp:JL,isFunction:Fs,isStream:BL,isURLSearchParams:NL,isTypedArray:HL,isFileList:OL,forEach:cf,merge:Ay,extend:UL,trim:VL,stripBOM:jL,inherits:GL,toFlatObject:$L,kindOf:Xm,kindOfTest:No,endsWith:qL,toArray:ZL,forEachEntry:WL,matchAll:XL,isHTMLForm:YL,hasOwnProperty:fw,hasOwnProp:fw,reduceDescriptors:rE,freezeMethods:QL,toObjectSet:eD,toCamelCase:KL,noop:tD,toFiniteNumber:iD,findKey:eE,global:tE,isContextDefined:iE,ALPHABET:nE,generateString:rD,isSpecCompliantForm:nD,toJSONObject:sD,isAsyncFn:oD,isThenable:aD};function _r(d,g,w,S,L){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=d,this.name="AxiosError",g&&(this.code=g),w&&(this.config=w),S&&(this.request=S),L&&(this.response=L)}ut.inherits(_r,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ut.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const sE=_r.prototype,oE={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(d=>{oE[d]={value:d}});Object.defineProperties(_r,oE);Object.defineProperty(sE,"isAxiosError",{value:!0});_r.from=(d,g,w,S,L,k)=>{const V=Object.create(sE);return ut.toFlatObject(d,V,function(o){return o!==Error.prototype},X=>X!=="isAxiosError"),_r.call(V,d.message,g,w,S,L),V.cause=d,V.name=d.name,k&&Object.assign(V,k),V};const lD=null;function My(d){return ut.isPlainObject(d)||ut.isArray(d)}function aE(d){return ut.endsWith(d,"[]")?d.slice(0,-2):d}function mw(d,g,w){return d?d.concat(g).map(function(L,k){return L=aE(L),!w&&k?"["+L+"]":L}).join(w?".":""):g}function cD(d){return ut.isArray(d)&&!d.some(My)}const uD=ut.toFlatObject(ut,{},null,function(g){return/^is[A-Z]/.test(g)});function Jm(d,g,w){if(!ut.isObject(d))throw new TypeError("target must be an object");g=g||new FormData,w=ut.toFlatObject(w,{metaTokens:!0,dots:!1,indexes:!1},!1,function(at,Ft){return!ut.isUndefined(Ft[at])});const S=w.metaTokens,L=w.visitor||oe,k=w.dots,V=w.indexes,o=(w.Blob||typeof Blob<"u"&&Blob)&&ut.isSpecCompliantForm(g);if(!ut.isFunction(L))throw new TypeError("visitor must be a function");function re(qe){if(qe===null)return"";if(ut.isDate(qe))return qe.toISOString();if(!o&&ut.isBlob(qe))throw new _r("Blob is not supported. Use a Buffer instead.");return ut.isArrayBuffer(qe)||ut.isTypedArray(qe)?o&&typeof Blob=="function"?new Blob([qe]):Buffer.from(qe):qe}function oe(qe,at,Ft){let Nt=qe;if(qe&&!Ft&&typeof qe=="object"){if(ut.endsWith(at,"{}"))at=S?at:at.slice(0,-2),qe=JSON.stringify(qe);else if(ut.isArray(qe)&&cD(qe)||(ut.isFileList(qe)||ut.endsWith(at,"[]"))&&(Nt=ut.toArray(qe)))return at=aE(at),Nt.forEach(function(Jt,Xi){!(ut.isUndefined(Jt)||Jt===null)&&g.append(V===!0?mw([at],Xi,k):V===null?at:at+"[]",re(Jt))}),!1}return My(qe)?!0:(g.append(mw(Ft,at,k),re(qe)),!1)}const se=[],Se=Object.assign(uD,{defaultVisitor:oe,convertValue:re,isVisitable:My});function Ie(qe,at){if(!ut.isUndefined(qe)){if(se.indexOf(qe)!==-1)throw Error("Circular reference detected in "+at.join("."));se.push(qe),ut.forEach(qe,function(Nt,ri){(!(ut.isUndefined(Nt)||Nt===null)&&L.call(g,Nt,ut.isString(ri)?ri.trim():ri,at,Se))===!0&&Ie(Nt,at?at.concat(ri):[ri])}),se.pop()}}if(!ut.isObject(d))throw new TypeError("data must be an object");return Ie(d),g}function _w(d){const g={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(d).replace(/[!'()~]|%20|%00/g,function(S){return g[S]})}function Qy(d,g){this._pairs=[],d&&Jm(d,this,g)}const lE=Qy.prototype;lE.append=function(g,w){this._pairs.push([g,w])};lE.toString=function(g){const w=g?function(S){return g.call(this,S,_w)}:_w;return this._pairs.map(function(L){return w(L[0])+"="+w(L[1])},"").join("&")};function hD(d){return encodeURIComponent(d).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function cE(d,g,w){if(!g)return d;const S=w&&w.encode||hD,L=w&&w.serialize;let k;if(L?k=L(g,w):k=ut.isURLSearchParams(g)?g.toString():new Qy(g,w).toString(S),k){const V=d.indexOf("#");V!==-1&&(d=d.slice(0,V)),d+=(d.indexOf("?")===-1?"?":"&")+k}return d}class gw{constructor(){this.handlers=[]}use(g,w,S){return this.handlers.push({fulfilled:g,rejected:w,synchronous:S?S.synchronous:!1,runWhen:S?S.runWhen:null}),this.handlers.length-1}eject(g){this.handlers[g]&&(this.handlers[g]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(g){ut.forEach(this.handlers,function(S){S!==null&&g(S)})}}const uE={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},dD=typeof URLSearchParams<"u"?URLSearchParams:Qy,fD=typeof FormData<"u"?FormData:null,pD=typeof Blob<"u"?Blob:null,mD={isBrowser:!0,classes:{URLSearchParams:dD,FormData:fD,Blob:pD},protocols:["http","https","file","blob","url","data"]},hE=typeof window<"u"&&typeof document<"u",_D=(d=>hE&&["ReactNative","NativeScript","NS"].indexOf(d)<0)(typeof navigator<"u"&&navigator.product),gD=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",yD=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:hE,hasStandardBrowserEnv:_D,hasStandardBrowserWebWorkerEnv:gD},Symbol.toStringTag,{value:"Module"})),Oo={...yD,...mD};function xD(d,g){return Jm(d,new Oo.classes.URLSearchParams,Object.assign({visitor:function(w,S,L,k){return Oo.isNode&&ut.isBuffer(w)?(this.append(S,w.toString("base64")),!1):k.defaultVisitor.apply(this,arguments)}},g))}function vD(d){return ut.matchAll(/\w+|\[(\w*)]/g,d).map(g=>g[0]==="[]"?"":g[1]||g[0])}function bD(d){const g={},w=Object.keys(d);let S;const L=w.length;let k;for(S=0;S<L;S++)k=w[S],g[k]=d[k];return g}function dE(d){function g(w,S,L,k){let V=w[k++];if(V==="__proto__")return!0;const X=Number.isFinite(+V),o=k>=w.length;return V=!V&&ut.isArray(L)?L.length:V,o?(ut.hasOwnProp(L,V)?L[V]=[L[V],S]:L[V]=S,!X):((!L[V]||!ut.isObject(L[V]))&&(L[V]=[]),g(w,S,L[V],k)&&ut.isArray(L[V])&&(L[V]=bD(L[V])),!X)}if(ut.isFormData(d)&&ut.isFunction(d.entries)){const w={};return ut.forEachEntry(d,(S,L)=>{g(vD(S),L,w,0)}),w}return null}function wD(d,g,w){if(ut.isString(d))try{return(g||JSON.parse)(d),ut.trim(d)}catch(S){if(S.name!=="SyntaxError")throw S}return(w||JSON.stringify)(d)}const e0={transitional:uE,adapter:["xhr","http"],transformRequest:[function(g,w){const S=w.getContentType()||"",L=S.indexOf("application/json")>-1,k=ut.isObject(g);if(k&&ut.isHTMLForm(g)&&(g=new FormData(g)),ut.isFormData(g))return L?JSON.stringify(dE(g)):g;if(ut.isArrayBuffer(g)||ut.isBuffer(g)||ut.isStream(g)||ut.isFile(g)||ut.isBlob(g))return g;if(ut.isArrayBufferView(g))return g.buffer;if(ut.isURLSearchParams(g))return w.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),g.toString();let X;if(k){if(S.indexOf("application/x-www-form-urlencoded")>-1)return xD(g,this.formSerializer).toString();if((X=ut.isFileList(g))||S.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return Jm(X?{"files[]":g}:g,o&&new o,this.formSerializer)}}return k||L?(w.setContentType("application/json",!1),wD(g)):g}],transformResponse:[function(g){const w=this.transitional||e0.transitional,S=w&&w.forcedJSONParsing,L=this.responseType==="json";if(g&&ut.isString(g)&&(S&&!this.responseType||L)){const V=!(w&&w.silentJSONParsing)&&L;try{return JSON.parse(g)}catch(X){if(V)throw X.name==="SyntaxError"?_r.from(X,_r.ERR_BAD_RESPONSE,this,null,this.response):X}}return g}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Oo.classes.FormData,Blob:Oo.classes.Blob},validateStatus:function(g){return g>=200&&g<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ut.forEach(["delete","get","head","post","put","patch"],d=>{e0.headers[d]={}});const t0=e0,TD=ut.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ED=d=>{const g={};let w,S,L;return d&&d.split(`
`).forEach(function(V){L=V.indexOf(":"),w=V.substring(0,L).trim().toLowerCase(),S=V.substring(L+1).trim(),!(!w||g[w]&&TD[w])&&(w==="set-cookie"?g[w]?g[w].push(S):g[w]=[S]:g[w]=g[w]?g[w]+", "+S:S)}),g},yw=Symbol("internals");function Gd(d){return d&&String(d).trim().toLowerCase()}function gm(d){return d===!1||d==null?d:ut.isArray(d)?d.map(gm):String(d)}function SD(d){const g=Object.create(null),w=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let S;for(;S=w.exec(d);)g[S[1]]=S[2];return g}const AD=d=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(d.trim());function oy(d,g,w,S,L){if(ut.isFunction(S))return S.call(this,g,w);if(L&&(g=w),!!ut.isString(g)){if(ut.isString(S))return g.indexOf(S)!==-1;if(ut.isRegExp(S))return S.test(g)}}function MD(d){return d.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(g,w,S)=>w.toUpperCase()+S)}function ID(d,g){const w=ut.toCamelCase(" "+g);["get","set","has"].forEach(S=>{Object.defineProperty(d,S+w,{value:function(L,k,V){return this[S].call(this,g,L,k,V)},configurable:!0})})}class Qm{constructor(g){g&&this.set(g)}set(g,w,S){const L=this;function k(X,o,re){const oe=Gd(o);if(!oe)throw new Error("header name must be a non-empty string");const se=ut.findKey(L,oe);(!se||L[se]===void 0||re===!0||re===void 0&&L[se]!==!1)&&(L[se||o]=gm(X))}const V=(X,o)=>ut.forEach(X,(re,oe)=>k(re,oe,o));return ut.isPlainObject(g)||g instanceof this.constructor?V(g,w):ut.isString(g)&&(g=g.trim())&&!AD(g)?V(ED(g),w):g!=null&&k(w,g,S),this}get(g,w){if(g=Gd(g),g){const S=ut.findKey(this,g);if(S){const L=this[S];if(!w)return L;if(w===!0)return SD(L);if(ut.isFunction(w))return w.call(this,L,S);if(ut.isRegExp(w))return w.exec(L);throw new TypeError("parser must be boolean|regexp|function")}}}has(g,w){if(g=Gd(g),g){const S=ut.findKey(this,g);return!!(S&&this[S]!==void 0&&(!w||oy(this,this[S],S,w)))}return!1}delete(g,w){const S=this;let L=!1;function k(V){if(V=Gd(V),V){const X=ut.findKey(S,V);X&&(!w||oy(S,S[X],X,w))&&(delete S[X],L=!0)}}return ut.isArray(g)?g.forEach(k):k(g),L}clear(g){const w=Object.keys(this);let S=w.length,L=!1;for(;S--;){const k=w[S];(!g||oy(this,this[k],k,g,!0))&&(delete this[k],L=!0)}return L}normalize(g){const w=this,S={};return ut.forEach(this,(L,k)=>{const V=ut.findKey(S,k);if(V){w[V]=gm(L),delete w[k];return}const X=g?MD(k):String(k).trim();X!==k&&delete w[k],w[X]=gm(L),S[X]=!0}),this}concat(...g){return this.constructor.concat(this,...g)}toJSON(g){const w=Object.create(null);return ut.forEach(this,(S,L)=>{S!=null&&S!==!1&&(w[L]=g&&ut.isArray(S)?S.join(", "):S)}),w}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([g,w])=>g+": "+w).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(g){return g instanceof this?g:new this(g)}static concat(g,...w){const S=new this(g);return w.forEach(L=>S.set(L)),S}static accessor(g){const S=(this[yw]=this[yw]={accessors:{}}).accessors,L=this.prototype;function k(V){const X=Gd(V);S[X]||(ID(L,V),S[X]=!0)}return ut.isArray(g)?g.forEach(k):k(g),this}}Qm.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ut.reduceDescriptors(Qm.prototype,({value:d},g)=>{let w=g[0].toUpperCase()+g.slice(1);return{get:()=>d,set(S){this[w]=S}}});ut.freezeMethods(Qm);const ha=Qm;function ay(d,g){const w=this||t0,S=g||w,L=ha.from(S.headers);let k=S.data;return ut.forEach(d,function(X){k=X.call(w,k,L.normalize(),g?g.status:void 0)}),L.normalize(),k}function fE(d){return!!(d&&d.__CANCEL__)}function uf(d,g,w){_r.call(this,d??"canceled",_r.ERR_CANCELED,g,w),this.name="CanceledError"}ut.inherits(uf,_r,{__CANCEL__:!0});function CD(d,g,w){const S=w.config.validateStatus;!w.status||!S||S(w.status)?d(w):g(new _r("Request failed with status code "+w.status,[_r.ERR_BAD_REQUEST,_r.ERR_BAD_RESPONSE][Math.floor(w.status/100)-4],w.config,w.request,w))}const PD=Oo.hasStandardBrowserEnv?{write(d,g,w,S,L,k){const V=[d+"="+encodeURIComponent(g)];ut.isNumber(w)&&V.push("expires="+new Date(w).toGMTString()),ut.isString(S)&&V.push("path="+S),ut.isString(L)&&V.push("domain="+L),k===!0&&V.push("secure"),document.cookie=V.join("; ")},read(d){const g=document.cookie.match(new RegExp("(^|;\\s*)("+d+")=([^;]*)"));return g?decodeURIComponent(g[3]):null},remove(d){this.write(d,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function RD(d){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(d)}function LD(d,g){return g?d.replace(/\/?\/$/,"")+"/"+g.replace(/^\/+/,""):d}function pE(d,g){return d&&!RD(g)?LD(d,g):g}const DD=Oo.hasStandardBrowserEnv?function(){const g=/(msie|trident)/i.test(navigator.userAgent),w=document.createElement("a");let S;function L(k){let V=k;return g&&(w.setAttribute("href",V),V=w.href),w.setAttribute("href",V),{href:w.href,protocol:w.protocol?w.protocol.replace(/:$/,""):"",host:w.host,search:w.search?w.search.replace(/^\?/,""):"",hash:w.hash?w.hash.replace(/^#/,""):"",hostname:w.hostname,port:w.port,pathname:w.pathname.charAt(0)==="/"?w.pathname:"/"+w.pathname}}return S=L(window.location.href),function(V){const X=ut.isString(V)?L(V):V;return X.protocol===S.protocol&&X.host===S.host}}():function(){return function(){return!0}}();function zD(d){const g=/^([-+\w]{1,25})(:?\/\/|:)/.exec(d);return g&&g[1]||""}function kD(d,g){d=d||10;const w=new Array(d),S=new Array(d);let L=0,k=0,V;return g=g!==void 0?g:1e3,function(o){const re=Date.now(),oe=S[k];V||(V=re),w[L]=o,S[L]=re;let se=k,Se=0;for(;se!==L;)Se+=w[se++],se=se%d;if(L=(L+1)%d,L===k&&(k=(k+1)%d),re-V<g)return;const Ie=oe&&re-oe;return Ie?Math.round(Se*1e3/Ie):void 0}}function xw(d,g){let w=0;const S=kD(50,250);return L=>{const k=L.loaded,V=L.lengthComputable?L.total:void 0,X=k-w,o=S(X),re=k<=V;w=k;const oe={loaded:k,total:V,progress:V?k/V:void 0,bytes:X,rate:o||void 0,estimated:o&&V&&re?(V-k)/o:void 0,event:L};oe[g?"download":"upload"]=!0,d(oe)}}const OD=typeof XMLHttpRequest<"u",BD=OD&&function(d){return new Promise(function(w,S){let L=d.data;const k=ha.from(d.headers).normalize();let{responseType:V,withXSRFToken:X}=d,o;function re(){d.cancelToken&&d.cancelToken.unsubscribe(o),d.signal&&d.signal.removeEventListener("abort",o)}let oe;if(ut.isFormData(L)){if(Oo.hasStandardBrowserEnv||Oo.hasStandardBrowserWebWorkerEnv)k.setContentType(!1);else if((oe=k.getContentType())!==!1){const[at,...Ft]=oe?oe.split(";").map(Nt=>Nt.trim()).filter(Boolean):[];k.setContentType([at||"multipart/form-data",...Ft].join("; "))}}let se=new XMLHttpRequest;if(d.auth){const at=d.auth.username||"",Ft=d.auth.password?unescape(encodeURIComponent(d.auth.password)):"";k.set("Authorization","Basic "+btoa(at+":"+Ft))}const Se=pE(d.baseURL,d.url);se.open(d.method.toUpperCase(),cE(Se,d.params,d.paramsSerializer),!0),se.timeout=d.timeout;function Ie(){if(!se)return;const at=ha.from("getAllResponseHeaders"in se&&se.getAllResponseHeaders()),Nt={data:!V||V==="text"||V==="json"?se.responseText:se.response,status:se.status,statusText:se.statusText,headers:at,config:d,request:se};CD(function(Jt){w(Jt),re()},function(Jt){S(Jt),re()},Nt),se=null}if("onloadend"in se?se.onloadend=Ie:se.onreadystatechange=function(){!se||se.readyState!==4||se.status===0&&!(se.responseURL&&se.responseURL.indexOf("file:")===0)||setTimeout(Ie)},se.onabort=function(){se&&(S(new _r("Request aborted",_r.ECONNABORTED,d,se)),se=null)},se.onerror=function(){S(new _r("Network Error",_r.ERR_NETWORK,d,se)),se=null},se.ontimeout=function(){let Ft=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded";const Nt=d.transitional||uE;d.timeoutErrorMessage&&(Ft=d.timeoutErrorMessage),S(new _r(Ft,Nt.clarifyTimeoutError?_r.ETIMEDOUT:_r.ECONNABORTED,d,se)),se=null},Oo.hasStandardBrowserEnv&&(X&&ut.isFunction(X)&&(X=X(d)),X||X!==!1&&DD(Se))){const at=d.xsrfHeaderName&&d.xsrfCookieName&&PD.read(d.xsrfCookieName);at&&k.set(d.xsrfHeaderName,at)}L===void 0&&k.setContentType(null),"setRequestHeader"in se&&ut.forEach(k.toJSON(),function(Ft,Nt){se.setRequestHeader(Nt,Ft)}),ut.isUndefined(d.withCredentials)||(se.withCredentials=!!d.withCredentials),V&&V!=="json"&&(se.responseType=d.responseType),typeof d.onDownloadProgress=="function"&&se.addEventListener("progress",xw(d.onDownloadProgress,!0)),typeof d.onUploadProgress=="function"&&se.upload&&se.upload.addEventListener("progress",xw(d.onUploadProgress)),(d.cancelToken||d.signal)&&(o=at=>{se&&(S(!at||at.type?new uf(null,d,se):at),se.abort(),se=null)},d.cancelToken&&d.cancelToken.subscribe(o),d.signal&&(d.signal.aborted?o():d.signal.addEventListener("abort",o)));const qe=zD(Se);if(qe&&Oo.protocols.indexOf(qe)===-1){S(new _r("Unsupported protocol "+qe+":",_r.ERR_BAD_REQUEST,d));return}se.send(L||null)})},Iy={http:lD,xhr:BD};ut.forEach(Iy,(d,g)=>{if(d){try{Object.defineProperty(d,"name",{value:g})}catch{}Object.defineProperty(d,"adapterName",{value:g})}});const vw=d=>`- ${d}`,FD=d=>ut.isFunction(d)||d===null||d===!1,mE={getAdapter:d=>{d=ut.isArray(d)?d:[d];const{length:g}=d;let w,S;const L={};for(let k=0;k<g;k++){w=d[k];let V;if(S=w,!FD(w)&&(S=Iy[(V=String(w)).toLowerCase()],S===void 0))throw new _r(`Unknown adapter '${V}'`);if(S)break;L[V||"#"+k]=S}if(!S){const k=Object.entries(L).map(([X,o])=>`adapter ${X} `+(o===!1?"is not supported by the environment":"is not available in the build"));let V=g?k.length>1?`since :
`+k.map(vw).join(`
`):" "+vw(k[0]):"as no adapter specified";throw new _r("There is no suitable adapter to dispatch the request "+V,"ERR_NOT_SUPPORT")}return S},adapters:Iy};function ly(d){if(d.cancelToken&&d.cancelToken.throwIfRequested(),d.signal&&d.signal.aborted)throw new uf(null,d)}function bw(d){return ly(d),d.headers=ha.from(d.headers),d.data=ay.call(d,d.transformRequest),["post","put","patch"].indexOf(d.method)!==-1&&d.headers.setContentType("application/x-www-form-urlencoded",!1),mE.getAdapter(d.adapter||t0.adapter)(d).then(function(S){return ly(d),S.data=ay.call(d,d.transformResponse,S),S.headers=ha.from(S.headers),S},function(S){return fE(S)||(ly(d),S&&S.response&&(S.response.data=ay.call(d,d.transformResponse,S.response),S.response.headers=ha.from(S.response.headers))),Promise.reject(S)})}const ww=d=>d instanceof ha?{...d}:d;function ku(d,g){g=g||{};const w={};function S(re,oe,se){return ut.isPlainObject(re)&&ut.isPlainObject(oe)?ut.merge.call({caseless:se},re,oe):ut.isPlainObject(oe)?ut.merge({},oe):ut.isArray(oe)?oe.slice():oe}function L(re,oe,se){if(ut.isUndefined(oe)){if(!ut.isUndefined(re))return S(void 0,re,se)}else return S(re,oe,se)}function k(re,oe){if(!ut.isUndefined(oe))return S(void 0,oe)}function V(re,oe){if(ut.isUndefined(oe)){if(!ut.isUndefined(re))return S(void 0,re)}else return S(void 0,oe)}function X(re,oe,se){if(se in g)return S(re,oe);if(se in d)return S(void 0,re)}const o={url:k,method:k,data:k,baseURL:V,transformRequest:V,transformResponse:V,paramsSerializer:V,timeout:V,timeoutMessage:V,withCredentials:V,withXSRFToken:V,adapter:V,responseType:V,xsrfCookieName:V,xsrfHeaderName:V,onUploadProgress:V,onDownloadProgress:V,decompress:V,maxContentLength:V,maxBodyLength:V,beforeRedirect:V,transport:V,httpAgent:V,httpsAgent:V,cancelToken:V,socketPath:V,responseEncoding:V,validateStatus:X,headers:(re,oe)=>L(ww(re),ww(oe),!0)};return ut.forEach(Object.keys(Object.assign({},d,g)),function(oe){const se=o[oe]||L,Se=se(d[oe],g[oe],oe);ut.isUndefined(Se)&&se!==X||(w[oe]=Se)}),w}const _E="1.6.8",i0={};["object","boolean","number","function","string","symbol"].forEach((d,g)=>{i0[d]=function(S){return typeof S===d||"a"+(g<1?"n ":" ")+d}});const Tw={};i0.transitional=function(g,w,S){function L(k,V){return"[Axios v"+_E+"] Transitional option '"+k+"'"+V+(S?". "+S:"")}return(k,V,X)=>{if(g===!1)throw new _r(L(V," has been removed"+(w?" in "+w:"")),_r.ERR_DEPRECATED);return w&&!Tw[V]&&(Tw[V]=!0,console.warn(L(V," has been deprecated since v"+w+" and will be removed in the near future"))),g?g(k,V,X):!0}};function ND(d,g,w){if(typeof d!="object")throw new _r("options must be an object",_r.ERR_BAD_OPTION_VALUE);const S=Object.keys(d);let L=S.length;for(;L-- >0;){const k=S[L],V=g[k];if(V){const X=d[k],o=X===void 0||V(X,k,d);if(o!==!0)throw new _r("option "+k+" must be "+o,_r.ERR_BAD_OPTION_VALUE);continue}if(w!==!0)throw new _r("Unknown option "+k,_r.ERR_BAD_OPTION)}}const Cy={assertOptions:ND,validators:i0},el=Cy.validators;class Cm{constructor(g){this.defaults=g,this.interceptors={request:new gw,response:new gw}}async request(g,w){try{return await this._request(g,w)}catch(S){if(S instanceof Error){let L;Error.captureStackTrace?Error.captureStackTrace(L={}):L=new Error;const k=L.stack?L.stack.replace(/^.+\n/,""):"";S.stack?k&&!String(S.stack).endsWith(k.replace(/^.+\n.+\n/,""))&&(S.stack+=`
`+k):S.stack=k}throw S}}_request(g,w){typeof g=="string"?(w=w||{},w.url=g):w=g||{},w=ku(this.defaults,w);const{transitional:S,paramsSerializer:L,headers:k}=w;S!==void 0&&Cy.assertOptions(S,{silentJSONParsing:el.transitional(el.boolean),forcedJSONParsing:el.transitional(el.boolean),clarifyTimeoutError:el.transitional(el.boolean)},!1),L!=null&&(ut.isFunction(L)?w.paramsSerializer={serialize:L}:Cy.assertOptions(L,{encode:el.function,serialize:el.function},!0)),w.method=(w.method||this.defaults.method||"get").toLowerCase();let V=k&&ut.merge(k.common,k[w.method]);k&&ut.forEach(["delete","get","head","post","put","patch","common"],qe=>{delete k[qe]}),w.headers=ha.concat(V,k);const X=[];let o=!0;this.interceptors.request.forEach(function(at){typeof at.runWhen=="function"&&at.runWhen(w)===!1||(o=o&&at.synchronous,X.unshift(at.fulfilled,at.rejected))});const re=[];this.interceptors.response.forEach(function(at){re.push(at.fulfilled,at.rejected)});let oe,se=0,Se;if(!o){const qe=[bw.bind(this),void 0];for(qe.unshift.apply(qe,X),qe.push.apply(qe,re),Se=qe.length,oe=Promise.resolve(w);se<Se;)oe=oe.then(qe[se++],qe[se++]);return oe}Se=X.length;let Ie=w;for(se=0;se<Se;){const qe=X[se++],at=X[se++];try{Ie=qe(Ie)}catch(Ft){at.call(this,Ft);break}}try{oe=bw.call(this,Ie)}catch(qe){return Promise.reject(qe)}for(se=0,Se=re.length;se<Se;)oe=oe.then(re[se++],re[se++]);return oe}getUri(g){g=ku(this.defaults,g);const w=pE(g.baseURL,g.url);return cE(w,g.params,g.paramsSerializer)}}ut.forEach(["delete","get","head","options"],function(g){Cm.prototype[g]=function(w,S){return this.request(ku(S||{},{method:g,url:w,data:(S||{}).data}))}});ut.forEach(["post","put","patch"],function(g){function w(S){return function(k,V,X){return this.request(ku(X||{},{method:g,headers:S?{"Content-Type":"multipart/form-data"}:{},url:k,data:V}))}}Cm.prototype[g]=w(),Cm.prototype[g+"Form"]=w(!0)});const ym=Cm;class r0{constructor(g){if(typeof g!="function")throw new TypeError("executor must be a function.");let w;this.promise=new Promise(function(k){w=k});const S=this;this.promise.then(L=>{if(!S._listeners)return;let k=S._listeners.length;for(;k-- >0;)S._listeners[k](L);S._listeners=null}),this.promise.then=L=>{let k;const V=new Promise(X=>{S.subscribe(X),k=X}).then(L);return V.cancel=function(){S.unsubscribe(k)},V},g(function(k,V,X){S.reason||(S.reason=new uf(k,V,X),w(S.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(g){if(this.reason){g(this.reason);return}this._listeners?this._listeners.push(g):this._listeners=[g]}unsubscribe(g){if(!this._listeners)return;const w=this._listeners.indexOf(g);w!==-1&&this._listeners.splice(w,1)}static source(){let g;return{token:new r0(function(L){g=L}),cancel:g}}}const VD=r0;function UD(d){return function(w){return d.apply(null,w)}}function jD(d){return ut.isObject(d)&&d.isAxiosError===!0}const Py={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Py).forEach(([d,g])=>{Py[g]=d});const GD=Py;function gE(d){const g=new ym(d),w=KT(ym.prototype.request,g);return ut.extend(w,ym.prototype,g,{allOwnKeys:!0}),ut.extend(w,g,null,{allOwnKeys:!0}),w.create=function(L){return gE(ku(d,L))},w}const pn=gE(t0);pn.Axios=ym;pn.CanceledError=uf;pn.CancelToken=VD;pn.isCancel=fE;pn.VERSION=_E;pn.toFormData=Jm;pn.AxiosError=_r;pn.Cancel=pn.CanceledError;pn.all=function(g){return Promise.all(g)};pn.spread=UD;pn.isAxiosError=jD;pn.mergeConfig=ku;pn.AxiosHeaders=ha;pn.formToJSON=d=>dE(ut.isHTMLForm(d)?new FormData(d):d);pn.getAdapter=mE.getAdapter;pn.HttpStatusCode=GD;pn.default=pn;const $D={class:"logo"},qD=["src"],ZD=NC('<ul class="col1" data-v-91da9b74><li data-v-91da9b74><a href="" data-v-91da9b74>Inicio</a></li><li data-v-91da9b74><a href="" data-v-91da9b74>Destinos</a></li><li data-v-91da9b74><a href="" data-v-91da9b74>Experiencias</a></li></ul><ul class="col2" data-v-91da9b74><button data-v-91da9b74><a href="" data-v-91da9b74>Explora Ahora</a></button></ul>',2),HD={__name:"HeaderTeo",setup(d){const g=ln(null);return Bu(()=>{g.value.offsetHeight}),(w,S)=>(Wi(),Ji("header",{ref_key:"this_header",ref:g},[Et("div",$D,[Et("img",{src:Yn(qT),alt:"img-logo"},null,8,qD)]),ZD],512))}},WD=Fn(HD,[["__scopeId","data-v-91da9b74"]]),XD={class:"sec1"},YD={class:"title"},KD=["innerHTML"],JD=["innerHTML"],QD=["innerHTML"],ez=["innerHTML"],tz={__name:"AboutSection1",setup(d){const g=ao(),w=oo(),S=Ur(()=>w.get("aboutSection1",g.language)),L=ln(null);return Bu(()=>{L.value.style.height=ln("407px").value}),(k,V)=>(Wi(),Ji(En,null,[Et("section",XD,[Et("h1",YD,[Et("span",{class:"t-part",innerHTML:S.value.span1},null,8,KD),Et("span",{class:"t-part",innerHTML:S.value.span2},null,8,JD)]),Et("p",{class:"mid-title",innerHTML:S.value.txt1},null,8,QD),Et("p",{class:"bottom-title",innerHTML:S.value.txt2},null,8,ez)]),Et("div",{class:"hidden-comp",ref_key:"hiddenHeight",ref:L},null,512)],64))}},iz=Fn(tz,[["__scopeId","data-v-942f16d8"]]),rz=d=>(gc("data-v-7612ce58"),d=d(),yc(),d),nz=rz(()=>Et("section",{class:"sec2"},null,-1)),sz=[nz],oz={__name:"AboutSection2",setup(d){const g=ao(),w=oo();return Ur(()=>w.get("",g.language)),(S,L)=>(Wi(),Ji("div",null,sz))}},az=Fn(oz,[["__scopeId","data-v-7612ce58"]]),lz={class:"col1"},cz=["innerHTML"],uz=["innerHTML"],hz=["innerHTML"],dz=["innerHTML"],fz={key:4,class:"btns"},pz={class:"type1 btn-filled"},mz=["innerHTML"],_z={class:"type1"},gz=["innerHTML"],yz={key:5},xz=["innerHTML"],vz={class:"col2"},bz={class:"img"},wz={key:0,src:"",alt:"foto/"},Tz={key:1,src:"",alt:"foto/"},Ez={__name:"AboutSection3",props:["type"],setup(d){const g=ao(),w=oo(),S=Ur(()=>w.get("aboutSection3",g.language));return(L,k)=>(Wi(),Ji("div",null,[Et("section",{class:Bs(["sec3",{sec3bottom:d.type==1}])},[Et("div",lz,[d.type==0?(Wi(),Ji("h3",{key:0,innerHTML:S.value.type0.txt1},null,8,cz)):(Wi(),Ji("h3",{key:1,class:Bs({biggerh3:d.type==1}),innerHTML:S.value.type1.txt1},null,10,uz)),d.type==0?(Wi(),Ji("p",{key:2,innerHTML:S.value.type0.txt2},null,8,hz)):(Wi(),Ji("p",{key:3,innerHTML:S.value.type1.txt2},null,8,dz)),d.type==1?(Wi(),Ji("div",fz,[Et("button",pz,[Et("a",{href:"",innerHTML:S.value.type1.btn1},null,8,mz)]),Et("button",_z,[Et("a",{href:"",innerHTML:S.value.type1.btn2},null,8,gz)])])):(Wi(),Ji("button",yz,[Et("a",{href:"",innerHTML:S.value.type0.btn1},null,8,xz)]))]),Et("div",vz,[Et("div",bz,[d.type==1?(Wi(),Ji("img",wz)):(Wi(),Ji("img",Tz))])])],2)]))}},Ew=Fn(Ez,[["__scopeId","data-v-a3316c87"]]),hf=d=>(gc("data-v-210d1621"),d=d(),yc(),d),Sz={class:"sec4"},Az={class:"col"},Mz=hf(()=>Et("span",{class:"material-symbols-outlined"},"chat_bubble",-1)),Iz=["innerHTML"],Cz=["innerHTML"],Pz={class:"col"},Rz=hf(()=>Et("span",{class:"material-symbols-outlined"},"photo_camera",-1)),Lz=["innerHTML"],Dz=["innerHTML"],zz={class:"col"},kz=hf(()=>Et("span",{class:"material-symbols-outlined"},"globe",-1)),Oz=["innerHTML"],Bz=["innerHTML"],Fz={class:"col"},Nz=hf(()=>Et("span",{class:"material-symbols-outlined"},"battery_horiz_050",-1)),Vz=["innerHTML"],Uz=["innerHTML"],jz=hf(()=>Et("link",{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"},null,-1)),Gz={__name:"AboutSection4",setup(d){const g=ao(),w=oo(),S=Ur(()=>w.get("aboutSection4",g.language));return(L,k)=>(Wi(),Ji(En,null,[Et("div",null,[Et("section",Sz,[Et("div",Az,[Mz,Et("h5",{innerHTML:S.value.title1},null,8,Iz),Et("p",{innerHTML:S.value.txt1},null,8,Cz)]),Et("div",Pz,[Rz,Et("h5",{innerHTML:S.value.title2},null,8,Lz),Et("p",{innerHTML:S.value.txt2},null,8,Dz)]),Et("div",zz,[kz,Et("h5",{innerHTML:S.value.title3},null,8,Oz),Et("p",{innerHTML:S.value.txt3},null,8,Bz)]),Et("div",Fz,[Nz,Et("h5",{innerHTML:S.value.title4},null,8,Vz),Et("p",{innerHTML:S.value.txt4},null,8,Uz)])])]),jz],64))}},$z=Fn(Gz,[["__scopeId","data-v-210d1621"]]),qz=d=>(gc("data-v-80c5e5bf"),d=d(),yc(),d),Zz=qz(()=>Et("section",{class:"sec5"},null,-1)),Hz=[Zz],Wz={__name:"AboutSection5",setup(d){const g=ao(),w=oo();return Ur(()=>w.get("",g.language)),(S,L)=>(Wi(),Ji("div",null,Hz))}},Xz=Fn(Wz,[["__scopeId","data-v-80c5e5bf"]]),yE=d=>(gc("data-v-f9f0b120"),d=d(),yc(),d),Yz={class:"col1"},Kz=yE(()=>Et("h6",null,"AIVOY",-1)),Jz=["innerHTML"],Qz=yE(()=>Et("div",{class:"col2"},[Et("span",{class:"material-symbols-outlined"},"nest_thermostat_gen_3"),Et("span",{class:"material-symbols-outlined"},"nest_thermostat_gen_3"),Et("span",{class:"material-symbols-outlined"},"nest_thermostat_gen_3")],-1)),e3={__name:"FooterTeo",setup(d){const g=ao(),w=oo(),S=Ur(()=>w.get("footerTeo",g.language));return(L,k)=>(Wi(),Ji("div",null,[Et("footer",null,[Et("div",Yz,[Kz,Et("p",{innerHTML:S.value.txt1},null,8,Jz)]),Qz])]))}},t3=Fn(e3,[["__scopeId","data-v-f9f0b120"]]),i3={class:"allComponents"},r3={__name:"AboutComponent",setup(d){console.log("ESTAS EN bienvenido CLIENTE");const g=$T();return(async()=>{try{const S=await pn.get("/session");console.log("Log client bienvenido=> ",S),S.status===200&&g.push("/about")}catch(S){console.error("Error al iniciar sesión:",S),S.response&&S.response.status===401&&(console.log("La sesión ha caducado, redirigiendo al formulario de inicio de sesión..."),g.push("/login"))}})(),(S,L)=>(Wi(),Ji("section",i3,[nr(WD),nr(iz),nr(az),nr(Ew,{type:"0"}),nr($z),nr(Xz),nr(Ew,{type:"1"}),nr(t3)]))}},n3=Fn(r3,[["__scopeId","data-v-bcecd9e3"]]),s3={class:"container-fluid"},o3={__name:"AboutView",setup(d){return(g,w)=>(Wi(),Ji("main",s3,[Et("div",null,[nr(n3)])]))}},a3={__name:"test",setup(d){return(g,w)=>(Wi(),Ji("div",null,[nr(YT)]))}},l3={__name:"test",setup(d){return(g,w)=>(Wi(),Ji("main",null,[Et("div",null,[nr(a3)])]))}};var e_={library:"https://accounts.google.com/gsi/client",defaultButtonConfig:{theme:"outline",size:"large"},scopes:"email profile openid"};const ns=Fo({clientId:null,popupType:"CODE",prompt:!1,autoLogin:!1,idConfiguration:null,buttonConfig:e_.defaultButtonConfig,callback:()=>{},error:null}),Pu=Fo({apiLoaded:!1,apiLoadIntitited:!1}),c3=d=>{try{const g=d.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),w=decodeURIComponent(atob(g).split("").map(function(S){return"%"+("00"+S.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(w)}catch{throw"JWT provided is invalid"}},xE=new Promise(d=>{const g=typeof window<"u";if(!Pu.apiLoadIntitited&&g){const w=document.createElement("script");Pu.apiLoadIntitited=!0,w.addEventListener("load",()=>{Pu.apiLoaded=!0,d(window.google)}),w.src=e_.library,w.async=!0,w.defer=!0,document.head.appendChild(w)}}),t_=d=>{Pu.apiLoadIntitited?Pu.apiLoaded?d(window.google):Mu(()=>Pu.apiLoaded,g=>{g&&d(window.google)}):xE.then(g=>{d(g)})},u3=(d,g,w,S)=>{if(!d.client_id)throw new Error("Prop client id required since plugin is not initialized with a client id");t_(()=>{((L,k,V,X,o)=>{if(o){const oe=L.callback;L.callback=se=>{se.credential?oe&&oe(se):o(se)}}window.google.accounts.id.initialize(L);const re=k.value;re&&!X&&window.google.accounts.id.renderButton(re,V)})(d,g,w.buttonConfig,S,w.error),w.prompt&&f3({clientId:w.clientId,callback:w.callback,error:w.error,autoLogin:w.autoLogin})})},h3=d=>new Promise((g,w)=>{t_(S=>{if(!(d&&d.clientId||ns.clientId))throw new Error("clientId is required since the plugin is not initialized with a Client Id");S.accounts.oauth2.initCodeClient({client_id:d&&d.clientId||ns.clientId||"",scope:e_.scopes,ux_mode:"popup",callback:L=>{L.code?g(L):w(L)},error_callback:L=>{w(L)}}).requestCode()})}),d3=d=>new Promise((g,w)=>{t_(S=>{if(!(d&&d.clientId||ns.clientId))throw new Error("clientId is required since the plugin is not initialized with a Client Id");S.accounts.oauth2.initTokenClient({client_id:d&&d.clientId||ns.clientId||"",scope:e_.scopes,callback:L=>{L.access_token?g(L):w(L)},error_callback:L=>{w(L)}}).requestAccessToken()})}),f3=d=>{if(!d&&(d={}),!d.clientId&&!ns.clientId)throw new Error("clientId is required");const g={use_fedcm_for_prompt:!0};return d.clientId&&(g.client_id=d.clientId),!d.clientId&&ns.clientId&&(g.client_id=ns.clientId),d.context&&(g.context=d.context),d.autoLogin!=null&&(g.auto_select=d.autoLogin),d.cancelOnTapOutside!=null&&(g.cancel_on_tap_outside=d.cancelOnTapOutside),new Promise((w,S)=>{g.callback=L=>{d&&d.callback&&d.callback(L),L.credential?w(L):S(L)},t_(L=>{L.accounts.id.initialize(g),L.accounts.id.prompt()})})};var Ry=Zy({__name:"GoogleLogin",props:{clientId:{type:String,required:!1},prompt:{type:Boolean,required:!1,default:!1},autoLogin:{type:Boolean,required:!1,default:!1},popupType:{type:String,required:!1},idConfiguration:{type:Object,required:!1},buttonConfig:{type:Object,required:!1},callback:{type:Function,required:!1},error:{type:Function,required:!1}},setup(d){const g=!!_C().default,w=d,S=((V,X)=>{const o={...V};for(const re in X)X[re]!==void 0&&X[re]!==null&&(o[re]=X[re]);return o})(ns,w),L={client_id:S.clientId||null,auto_select:S.autoLogin||!1,callback:S.callback,...S.idConfiguration},k=ln();return Bu(()=>{u3(L,k,S,g),w.popupType&&!g&&console.warn("Option 'popupType' is ignored since a slot which act as a custom login button was not found!!!")}),(V,X)=>(Wi(),Ji("div",{class:"g-btn-wrapper",onClick:X[0]||(X[0]=o=>Yn(g)&&void(Yn(S).popupType==="TOKEN"?d3({clientId:S.clientId}).then(re=>{S.callback&&S.callback(re)}).catch(re=>{S.error&&S.error(re)}):h3({clientId:S.clientId}).then(re=>{S.callback&&S.callback(re)}).catch(re=>{S.error&&S.error(re)})))},[Yn(g)?Xy("v-if",!0):(Wi(),Ji("span",{key:0,ref_key:"buttonRef",ref:k,class:"g-btn"},null,512)),pC(V.$slots,"default")]))}});(function(d,g){g===void 0&&(g={});var w=g.insertAt;if(d&&typeof document<"u"){var S=document.head||document.getElementsByTagName("head")[0],L=document.createElement("style");L.type="text/css",w==="top"&&S.firstChild?S.insertBefore(L,S.firstChild):S.appendChild(L),L.styleSheet?L.styleSheet.cssText=d:L.appendChild(document.createTextNode(d))}})(`
.g-btn-wrapper[data-v-5e610566] {
  display: inline-block;
}
`),Ry.__scopeId="data-v-5e610566",Ry.__file="src/plugin/GoogleLogin.vue";var p3={install:(d,g)=>{g&&(w=>{w.clientId&&(ns.clientId=w.clientId),w.popupType&&(ns.popupType=w.popupType),w.prompt!=null&&(ns.prompt=w.prompt),w.autoLogin!=null&&(ns.autoLogin=w.autoLogin),w.idConfiguration&&(ns.idConfiguration=w.idConfiguration),w.buttonConfig&&(ns.buttonConfig=w.buttonConfig),w.callback&&(ns.callback=w.callback)})(g),xE.then(()=>{if(g.clientId){const w={client_id:g.clientId,auto_select:g.autoLogin===!0,callback:g.callback,use_fedcm_for_prompt:!0,...g.idConfiguration};window.google.accounts.id.initialize(w),g.prompt&&window.google.accounts.id.prompt()}}),d.component("GoogleLogin",Ry)}};const n0=d=>(gc("data-v-4b856842"),d=d(),yc(),d),m3={id:"section"},_3={id:"login"},g3={id:"title"},y3={class:"input-line"},x3={class:"input-line"},v3=n0(()=>Et("div",{class:"input-line regist"},[Et("input",{type:"text",name:"",id:"password",placeholder:"Nombre..."})],-1)),b3=n0(()=>Et("div",{class:"input-line regist"},[Et("input",{type:"text",name:"",id:"password",placeholder:"Apellido..."})],-1)),w3={id:"submit"},T3={id:"google-log"},E3=n0(()=>Et("div",{id:"register"},null,-1)),S3={__name:"Login",setup(d){const g=ln(""),w=ln(""),S=$T(),L=ln(!1),k=ln(!1),V=ln("Iniciar Sesión");var X=document.documentElement,o=.5;X.style.setProperty("--AnimationTime",o+"s");const re=Ur(()=>({animate__animated:!0,animate__flipOutX:k.value,animate__flipInX:!k.value}));function oe(Ie){L.value=Ie,k.value=!0,setTimeout(()=>{k.value=!1},o*1e3),setTimeout(()=>{Ie?V.value="Registrarse":V.value="Iniciar Sesión"},o*1e3)}const se=Ie=>{const qe=c3(Ie.credential);console.log("Handle the userData",qe)},Se=async()=>{try{const Ie=await pn.post("/server/login",{mail:g.value,password:w.value});console.log("Log client login => ",Ie),Ie.status===200?S.push("/about"):Ie.status===401?(console.log("La sesión ha caducado, redirigiendo al formulario de inicio de sesión..."),S.push("/login")):console.error("Inicio de sesión fallido:",Ie.data.message)}catch(Ie){console.error("Error al iniciar sesión:",Ie)}};return(Ie,qe)=>{const at=XI("GoogleLogin");return Wi(),Ji("div",null,[Et("div",m3,[Et("div",_3,[Et("div",{id:"content",class:Bs({"animate-content":L.value})},[Et("div",g3,[Et("h1",{class:Bs(re.value)},Pw(V.value),3)]),Et("form",{onSubmit:ty(Se,["prevent"]),id:"form",class:Bs({"form-Animation":L.value})},[Et("div",y3,[fy(Et("input",{type:"email",name:"",id:"email",placeholder:"Email...","onUpdate:modelValue":qe[0]||(qe[0]=Ft=>g.value=Ft),required:""},null,512),[[$b,g.value]])]),Et("div",x3,[fy(Et("input",{type:"password",name:"",id:"password",placeholder:"Contraseña...","onUpdate:modelValue":qe[1]||(qe[1]=Ft=>w.value=Ft),required:""},null,512),[[$b,w.value]])]),v3,b3],34),Et("div",w3,[Et("button",{type:"submit",id:"regis",form:"form",onClick:qe[2]||(qe[2]=ty(Ft=>oe(!0),["prevent"]))},"Registrarse"),Et("button",{type:"submit",id:"log",form:"form",onClick:qe[3]||(qe[3]=ty(Ft=>oe(!1),["prevent"]))},"Inciar sesión"),Et("div",{class:Bs(["colorbox",{"colorbox-tranform":L.value}])},null,2)]),Et("div",T3,[nr(at,{callback:se,prompt:"","auto-login":""})])],2)]),E3])])}}},A3=Fn(S3,[["__scopeId","data-v-4b856842"]]),M3={id:"body"},I3={__name:"LoginView",setup(d){return(g,w)=>(Wi(),Ji("div",M3,[nr(HT),nr(A3)]))}},C3=Fn(I3,[["__scopeId","data-v-94fe72c5"]]),P3=zR({history:uR("/"),routes:[{path:"/",name:"home",component:ML},{path:"/about",name:"about",component:o3},{path:"/test",name:"test",component:l3},{path:"/login",name:"login",component:C3}]}),i_=EP(OR);i_.use(IP());i_.use(P3);i_.use(p3,{clientId:"585388550874-da88aogj6sqc6he9o5mnmm9ibagborua.apps.googleusercontent.com"});i_.mount("#app");
